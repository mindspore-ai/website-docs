

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Vertical Federated Learning Communication Compression &mdash; MindSpore master documentation</title>
  

  
   
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  
  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        
        
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Federated Server" href="horizontal_server.html" />
    <link rel="prev" title="Device-Cloud Federated Learning Communication Compression" href="communication_compression.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> MindSpore
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Deployment</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="federated_install.html">Obtaining MindSpore Federated</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploy_federated_server.html">Horizontal Federated Cloud-based Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploy_federated_client.html">Horizontal Federated Device-side Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploy_vfl.html">Vertical Federated Deployment</a></li>
</ul>
<p class="caption"><span class="caption-text">Horizontal Application</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="image_classfication_dataset_process.html">Federated Learning Image Classification Dataset Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="image_classification_application.html">Implementing an Image Classification Application of Cross-device Federated Learning (x86)</a></li>
<li class="toctree-l1"><a class="reference internal" href="sentiment_classification_application.html">Implementing a Sentiment Classification Application (Android)</a></li>
<li class="toctree-l1"><a class="reference internal" href="image_classification_application_in_cross_silo.html">Implementing a Cloud-Slio Federated Image Classification Application (x86)</a></li>
<li class="toctree-l1"><a class="reference internal" href="object_detection_application_in_cross_silo.html">Implementing a Cross-Silo Federated Target Detection Application (x86)</a></li>
</ul>
<p class="caption"><span class="caption-text">Vertical Application</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="data_join.html">Vertical Federated Learning Data Access</a></li>
<li class="toctree-l1"><a class="reference internal" href="split_wnd_application.html">Vertical Federated Learning Model Training - Wide&amp;Deep Recommendation Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="split_pangu_alpha_application.html">Vertical Federated Learning Model Training - Pangu Alpha Large Model Cross-Domain Training</a></li>
</ul>
<p class="caption"><span class="caption-text">Security and Privacy</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="local_differential_privacy_training_noise.html">Horizontal FL-Local Differential Privacy Perturbation Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="local_differential_privacy_training_signds.html">Horizontal FL-Local Differential Privacy SignDS training</a></li>
<li class="toctree-l1"><a class="reference internal" href="pairwise_encryption_training.html">Horizontal FL-Pairwise encryption training</a></li>
<li class="toctree-l1"><a class="reference internal" href="private_set_intersection.html">Vertical Federated-Privacy Set Intersection</a></li>
<li class="toctree-l1"><a class="reference internal" href="secure_vertical_federated_learning_with_EmbeddingDP.html">Vertical Federated-Feature Protection Based on Information Obfuscation</a></li>
<li class="toctree-l1"><a class="reference internal" href="secure_vertical_federated_learning_with_TEE.html">Vertical Federated - Feature Protection Based on Trusted Execution Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="secure_vertical_federated_learning_with_DP.html">Vertical Federated - Label Protection Based on Differential Privacy</a></li>
</ul>
<p class="caption"><span class="caption-text">Communication Compression</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="communication_compression.html">Device-Cloud Federated Learning Communication Compression</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Vertical Federated Learning Communication Compression</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overall-process">Overall Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="#compression-method">Compression Method</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#bit-packing-compression-method">Bit Packing Compression Method</a></li>
<li class="toctree-l3"><a class="reference internal" href="#quantization-compression-method">Quantization Compression Method</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#fast-experience">Fast Experience</a></li>
<li class="toctree-l2"><a class="reference internal" href="#deep-experience">Deep Experience</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#obtaining-the-compression-configuration">Obtaining the Compression Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-compression-configuration">Setting Compression Configuration</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Horizontal Federated API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="horizontal_server.html">Federated Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="cross_device.html">Device-side Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="horizontal/cross_silo.html">Cross-Silo</a></li>
</ul>
<p class="caption"><span class="caption-text">Vertical Federated API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Data_Join.html">Data Join</a></li>
<li class="toctree-l1"><a class="reference internal" href="vertical/vertical_communicator.html">Vertical Federated Learning Communicator</a></li>
<li class="toctree-l1"><a class="reference internal" href="vertical_federated_trainer.html">Vertical Federated Trainer</a></li>
</ul>
<p class="caption"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MindSpore</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Vertical Federated Learning Communication Compression</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/vfl_communication_compress.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="vertical-federated-learning-communication-compression">
<h1>Vertical Federated Learning Communication Compression<a class="headerlink" href="#vertical-federated-learning-communication-compression" title="Permalink to this headline">Â¶</a></h1>
<p><a href="https://gitee.com/mindspore/docs/blob/master/docs/federated/docs/source_en/vfl_communication_compress.md" target="_blank"><img src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/master/resource/_static/logo_source_en.png"></a></p>
<p>Vertical federated learning traffic affects user experience (user traffic, communication latency, federated learning training efficiency) and is limited by performance constraints (memory, bandwidth, CPU usage). Small amount of communication helps a lot to improve user experience and reduce performance bottlenecks, so it needs to be compressed. MindSpore Federated implements bi-directional communication compression between Leader and Follower in a vertical federated application scenario.</p>
<div class="section" id="overall-process">
<h2>Overall Process<a class="headerlink" href="#overall-process" title="Permalink to this headline">Â¶</a></h2>
<p><img alt="image1" src="_images/vfl_normal_communication_compress_en.png" /></p>
<p>Figure 1 Framework diagram of general vertical federated learning communication compression process</p>
<p>First perform the Embedding DP (EDP) encryption operation on Follower. Then enter the bit packing process. The bit packing process automatically determines whether the input data can be packed, and only when the input data can be strongly converted to the specified bit storage format with no loss of precision, the bit packing operation is performed. Follower sends the packaged data to Leader, Leader determines whether the data needs to be unpacked based on the reported data information. Before the Leader passes the data to the Follower, it is quantized and compressed. Follower receives the data and decompresses the quantized data.</p>
<p><img alt="image2" src="_images/vfl_pangu_communication_compress_en.png" /></p>
<p>Figure 2 Framework diagram of Pangu vertical federated learning communication compression process</p>
<p>The overall process is the same as the general vertical federated learning communication compression process. Compared to normal vertical federated, each iteration will have one more round of communication in Pangu vertical federated learning, so it needs to perform one more quantization compression and decompression process.</p>
</div>
<div class="section" id="compression-method">
<h2>Compression Method<a class="headerlink" href="#compression-method" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="bit-packing-compression-method">
<h3>Bit Packing Compression Method<a class="headerlink" href="#bit-packing-compression-method" title="Permalink to this headline">Â¶</a></h3>
<p>Bit-packing compression is a method of converting a sequence of data structures into a compact binary representation. Bit packing itself is a lossless compression method, but usually the data input to bit packing is compressed with loss compression.</p>
<p>Taking 3-bit packing as an example:</p>
<p>Quantization bitness bit_num= 3</p>
<p>The data stored in the format of float32 before compression is:</p>
<p>data = [3, -4, 3, -2, 3, -2, -4, 0, 1, 3]</p>
<p>First determine if compression is possible using bit-packing compression:</p>
<p>data_int = int(data)</p>
<p>If the elements in data - data_int are not 0, exit the bit packing process.</p>
<p>Convert the source data to binary format based on bit_num:</p>
<p>data_bin = [011, 100, 011, 110, 011, 110, 100, 000, 001, 011]</p>
<p>Note: Before conversion, you need to determine whether the current data is within the range that bit_num can accommodate. If it exceeds the range exit the bit packing process.</p>
<p>Since native C++ does not have a dedicated binary storage format, multiple binary data need to be stitched together and combined into int8 format data storage. If the number of bits is not enough, zero is added to the last data. Combined data is as follows:</p>
<p>data_int8 = [01110001, 11100111, 10100000, 00101100]</p>
<p>The binary data is then converted to an integer between -128 and 127, and the data type is strongly converted to int8.</p>
<p>data_packed = [113, -25, -96, 44]</p>
<p>Finally, data_packed and bit_num are passed to the receiver.</p>
<p>When unpacking, the receiver simply reverses the above process.</p>
</div>
<div class="section" id="quantization-compression-method">
<h3>Quantization Compression Method<a class="headerlink" href="#quantization-compression-method" title="Permalink to this headline">Â¶</a></h3>
<p>The quantization compression method is that communication data fixpoint of floating is approximated to a finite number of discrete values. The currently supported quantization compression method is minimum-maximum compression (min_max).</p>
<p>Taking the 8-bit quantization as an example:</p>
<p>Quantization bitness bit_num= 8</p>
<p>The float data before compression is:</p>
<p>data = [0.03356021, -0.01842778, -0.009684053, 0.025363436, -0.027571501, 0.0077043395, 0.016391572, -0.03598478, -0.0009508357]</p>
<p>Compute the minimum and maximum values:</p>
<p>min_val = -0.03598478</p>
<p>max_val = 0.03356021</p>
<p>Compute the scaling coefficient:</p>
<p>scale = (max_val - min_val) / (2 ^ bit_num- 1) = 0.000272725450980392</p>
<p>Convert the pre-compressed data to an integer between -128 and 127 with the formula quant_data = round((data - min_val) / scale) - 2 ^ (bit_num - 1). And to directly convert the data type to int8:</p>
<p>quant_data = [127, -64, -32, 97, -97, 32, 64, -128, 0]</p>
<p>After the quantitative encoding, the parameters to be uploaded by the sender are quant_data, bit_num, and the maximum and minimum values min_val and max_val.</p>
<p>After receiving quant_data, min_val and max_val, the receiver uses the inverse quantization formula (quant_data + 2 ^ (bit_num - 1)) * (max_val - min_val) / (2 ^ bit_num - 1) + min_val to restore the weights.</p>
</div>
</div>
<div class="section" id="fast-experience">
<h2>Fast Experience<a class="headerlink" href="#fast-experience" title="Permalink to this headline">Â¶</a></h2>
<p>To use bit packing or quantized compression methods, one first needs to successfully complete the training aggregation process for any of the vertical federated scenarios, such as <a class="reference external" href="https://www.mindspore.cn/federated/docs/en/master/split_wnd_application.html">Vertical Federated Learning Model Training - Wide&amp;Deep Recommended Applications</a>. The preparation work including datasets and network models and the process of simulating the start of federated learning are described in detail in this document.</p>
<ol>
<li><p>For MindSpore and MindSpore Federated installation and data preprocessing, refer to <a class="reference external" href="https://www.mindspore.cn/federated/docs/en/master/split_wnd_application.html">Vertical Federated Learning Model Training - Wide&amp;Deep Recommended Applications</a>.</p></li>
<li><p>Set the configuration related to compression setting in <a class="reference external" href="https://gitee.com/mindspore/federated/tree/master/example/splitnn_criteo/yaml_files">related yaml</a>.</p>
<p>The configuration of <a class="reference external" href="https://gitee.com/mindspore/federated/blob/master/example/splitnn_criteo/yaml_files/leader_top.yaml">leader_top.yaml</a> is as follows:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">leader</span>
<span class="nt">model</span><span class="p">:</span><span class="w"> </span><span class="c1"># define the net of vFL party</span>
<span class="w">  </span><span class="nt">train_net</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">leader_loss_net</span>
<span class="w">    </span><span class="nt">inputs</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">leader_wide_embedding</span>
<span class="w">        </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">leader_deep_embedding</span>
<span class="w">        </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">follower_wide_embedding</span>
<span class="w">        </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">remote</span>
<span class="w">        </span><span class="nt">compress_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">min_max</span>
<span class="w">        </span><span class="nt">bit_num</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">follower_deep_embedding</span>
<span class="w">        </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">remote</span>
<span class="w">        </span><span class="nt">compress_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">min_max</span>
<span class="w">        </span><span class="nt">bit_num</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6</span>
<span class="nn">...</span>
</pre></div>
</div>
<p>The configuration of <a class="reference external" href="https://gitee.com/mindspore/federated/blob/master/example/splitnn_criteo/yaml_files/follower_bottom.yaml">follower_bottom.yaml</a> is as follows:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">follower</span>
<span class="nt">model</span><span class="p">:</span><span class="w"> </span><span class="c1"># define the net of vFL party</span>
<span class="w">  </span><span class="nt">train_net</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">follower_loss_net</span>
<span class="w">    </span><span class="nt">inputs</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">id_hldr0</span>
<span class="w">        </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wt_hldr0</span>
<span class="w">        </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
<span class="w">    </span><span class="nt">outputs</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">follower_wide_embedding</span>
<span class="w">        </span><span class="nt">destination</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">remote</span>
<span class="w">        </span><span class="nt">compress_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">min_max</span>
<span class="w">        </span><span class="nt">bit_num</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">follower_deep_embedding</span>
<span class="w">        </span><span class="nt">destination</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">remote</span>
<span class="w">        </span><span class="nt">compress_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">min_max</span>
<span class="w">        </span><span class="nt">bit_num</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">follower_l2_regu</span>
<span class="w">        </span><span class="nt">destination</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
<span class="nn">...</span>
</pre></div>
</div>
</li>
<li><p>Users can make super-reference modifications according to the actual situation.</p>
<ul class="simple">
<li><p>compress_type: Compression type, string type, including: âmin_maxâ, âbit_packâ.</p></li>
<li><p>bit_num: The number of bits, int type, the definition domain is within [1, 8].</p></li>
</ul>
</li>
<li><p>Run the sample program to start the script.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># Start leader process:</span>
bash<span class="w"> </span>run_vfl_train_leader.sh<span class="w"> </span><span class="m">127</span>.0.0.1:1984<span class="w"> </span><span class="m">127</span>.0.0.1:1230<span class="w"> </span>./mindrecord/<span class="w"> </span>False
<span class="c1"># Start follower process:</span>
bash<span class="w"> </span>run_vfl_train_follower.sh<span class="w"> </span><span class="m">127</span>.0.0.1:1230<span class="w"> </span><span class="m">127</span>.0.0.1:1984<span class="w"> </span>./mindrecord/<span class="w"> </span>False
</pre></div>
</div>
</li>
<li><p>Check the training log <code class="docutils literal notranslate"><span class="pre">vfl_train_leader.log</span></code>. loss converges normally.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>epoch 0 step 0 loss: 0.693124
epoch 0 step 100 loss: 0.512151
epoch 0 step 200 loss: 0.493524
epoch 0 step 300 loss: 0.473054
epoch 0 step 400 loss: 0.466222
epoch 0 step 500 loss: 0.464252
epoch 0 step 600 loss: 0.469296
epoch 0 step 700 loss: 0.451647
epoch 0 step 800 loss: 0.457797
epoch 0 step 900 loss: 0.457930
epoch 0 step 1000 loss: 0.461664
epoch 0 step 1100 loss: 0.460415
epoch 0 step 1200 loss: 0.466883
epoch 0 step 1300 loss: 0.455919
epoch 0 step 1400 loss: 0.466984
epoch 0 step 1500 loss: 0.454486
epoch 0 step 1600 loss: 0.458730
epoch 0 step 1700 loss: 0.451275
epoch 0 step 1800 loss: 0.445938
epoch 0 step 1900 loss: 0.458323
epoch 0 step 2000 loss: 0.446709
...
</pre></div>
</div>
</li>
<li><p>Close the training process</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nv">pid</span><span class="o">=</span><span class="sb">`</span>ps<span class="w"> </span>-ef<span class="p">|</span>grep<span class="w"> </span>run_vfl_train_<span class="w"> </span><span class="p">|</span>grep<span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;grep&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;finish&quot;</span><span class="w"> </span><span class="p">|</span>awk<span class="w"> </span><span class="s1">&#39;{print $2}&#39;</span><span class="sb">`</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>id<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nv">$pid</span><span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nb">kill</span><span class="w"> </span>-9<span class="w"> </span><span class="nv">$id</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;killed </span><span class="nv">$id</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">done</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="deep-experience">
<h2>Deep Experience<a class="headerlink" href="#deep-experience" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="obtaining-the-compression-configuration">
<h3>Obtaining the Compression Configuration<a class="headerlink" href="#obtaining-the-compression-configuration" title="Permalink to this headline">Â¶</a></h3>
<p>The user can use the encapsulated interface to get the configuration related to communication compression. The <a class="reference external" href="https://www.mindspore.cn/federated/docs/en/master/vertical/vertical_federated_yaml.html">Yaml Configuration file for model training of vertical federated learning</a> gives the configuration description of the parameters related to the startup. The <a class="reference external" href="https://www.mindspore.cn/federated/docs/en/master/vertical/vertical_federated_FLModel.html">Model Training Interface</a> provides the interface to get the compression configuration. The example method is as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># parse yaml files</span>
<span class="n">leader_top_yaml_data</span> <span class="o">=</span> <span class="n">FLYamlData</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">leader_top_yaml_path</span><span class="p">)</span>

<span class="c1"># Leader Top Net</span>
<span class="n">leader_top_base_net</span> <span class="o">=</span> <span class="n">LeaderTopNet</span><span class="p">()</span>
<span class="n">leader_top_train_net</span> <span class="o">=</span> <span class="n">LeaderTopLossNet</span><span class="p">(</span><span class="n">leader_top_base_net</span><span class="p">)</span>
<span class="n">leader_top_fl_model</span> <span class="o">=</span> <span class="n">FLModel</span><span class="p">(</span>
    <span class="n">yaml_data</span><span class="o">=</span><span class="n">leader_top_yaml_data</span><span class="p">,</span>
    <span class="n">network</span><span class="o">=</span><span class="n">leader_top_train_net</span>
<span class="p">)</span>

<span class="c1"># get compress config</span>
<span class="n">compress_configs</span> <span class="o">=</span> <span class="n">leader_top_fl_model</span><span class="o">.</span><span class="n">get_compress_configs</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="setting-compression-configuration">
<h3>Setting Compression Configuration<a class="headerlink" href="#setting-compression-configuration" title="Permalink to this headline">Â¶</a></h3>
<p>Users can use the already encapsulated <a class="reference external" href="https://www.mindspore.cn/federated/docs/en/master/vertical/vertical_communicator.html">Vertical Federated Learning Communicator</a> interface to set the configuration related to communication compression to the communicator device by the following method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># build vertical communicator</span>
<span class="n">http_server_config</span> <span class="o">=</span> <span class="n">ServerConfig</span><span class="p">(</span><span class="n">server_name</span><span class="o">=</span><span class="s1">&#39;leader&#39;</span><span class="p">,</span> <span class="n">server_address</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">http_server_address</span><span class="p">)</span>
<span class="n">remote_server_config</span> <span class="o">=</span> <span class="n">ServerConfig</span><span class="p">(</span><span class="n">server_name</span><span class="o">=</span><span class="s1">&#39;follower&#39;</span><span class="p">,</span> <span class="n">server_address</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">remote_server_address</span><span class="p">)</span>
<span class="n">vertical_communicator</span> <span class="o">=</span> <span class="n">VerticalFederatedCommunicator</span><span class="p">(</span>
    <span class="n">http_server_config</span><span class="o">=</span><span class="n">http_server_config</span><span class="p">,</span>
    <span class="n">remote_server_config</span><span class="o">=</span><span class="n">remote_server_config</span><span class="p">,</span>
    <span class="n">compress_configs</span><span class="o">=</span><span class="n">compress_configs</span>
<span class="p">)</span>
<span class="n">vertical_communicator</span><span class="o">.</span><span class="n">launch</span><span class="p">()</span>
</pre></div>
</div>
<p>After setting the communication compression configuration, the vertical federated framework will automatically compress the communication content in the backend.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="horizontal_server.html" class="btn btn-neutral float-right" title="Federated Server" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="communication_compression.html" class="btn btn-neutral float-left" title="Device-Cloud Federated Learning Communication Compression" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2022, MindSpore.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   
	<script async="async" src="https://cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>