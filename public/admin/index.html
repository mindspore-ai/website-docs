<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport"
	content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>MindSpore后台管理系统</title>
<script
	src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<link rel="stylesheet" href="layui/css/layui.css" />
<link rel="stylesheet" href="static/skeleton.css" />
</head>
<body class="layui-layout-body">
	<div class="layui-layout layui-layout-admin">
		<!-- 头部 -->
		<div class="layui-header">
			<div class="layui-logo">MindSpore</div>
			<!-- 头部区域（可配合layui已有的水平导航） -->
			<ul class="layui-nav layui-layout-right">
				<li class="layui-nav-item">
					<a href="javascript:;"> 
						<img src="http://t.cn/RCzsdCq" class="layui-nav-img" /><span id="AdministratorName">超级管理员</span>
					</a>
				</li>
				<li class="layui-nav-item"><a href="/logout"> 退出 </a></li>
			</ul>
		</div>
		<!-- 菜单栏 -->
		<div class="layui-side layui-bg-black">
			<div class="layui-side-scroll">
				<!-- 左侧导航区域（可配合layui已有的垂直导航） -->
				<ul class="layui-nav layui-nav-tree" lay-filter="left-nav"></ul>
			</div>
		</div>
		<!-- 主体 -->
		<div class="layui-body">
			<div class="layui-tab layui-tab-brief" lay-allowClose="true"
				lay-filter="top-tab">
				<div class="page-control">
					<a class="btn layui-icon layui-icon-refresh" title="刷新"
						href="javascript:;" onclick="skeleton.refresh();"></a> <a
						class="btn layui-icon layui-icon-return" title="后退"
						href="javascript:;" onclick="skeleton.back();"></a>
				</div>
				<ul class="layui-tab-title"></ul>
				<div class="layui-tab-content"></div>
			</div>
		</div>
	</div>
	<script src="layui/layui.js"></script>
	<script>
		window.onload = function() {
			//对layui进行全局配置
			layui.config({
				base : "static/", //设定扩展的 layui 模块的所在目录，一般用于外部模块扩展
			});
     
			//模拟的节点--超级管理员 使用管理员
			var node1 = [ {
				name : "资讯管理",
				id : 1,
				pid : 0,
				url : "pages/news/list.html"
			}, {
				name : "邮件管理",
				id : 2,
				pid : 0,
				url : "pages/email/list.html"
			}, {
				name : "评价数据",
				id : 3,
				pid : 0,
				url : "pages/grade/index.html"
			}, {
				name : "布道数据",
				id : 4,
				pid : 0,
				url : "pages/evangelist/index.html",
			}, {
				name : "订阅数据",
				id : 5,
				pid : 0,
				url : "pages/subscribe/index.html",
			}, {
				name : "提问数据",
				id : 6,
				pid : 0,
				url : "pages/forum/index.html",
			}, {
				name : "视频数据",
				id : 7,
				pid : 0,
				url : "pages/video/index.html",
			}, {
				name : "论文管理",
				id : 8,
				pid : 0,
				url : "pages/paper/list.html",
			}, {
				name : "论文类目管理",
				id : 17,
				pid : 0,
				url : "pages/paper/catagory.html",
			}, {
				name : "视频管理",
				id : 9,
				pid : 0,
				url : "pages/videomanage/list.html",
			}, {
				name : "师资管理",
				id : 10,
				pid : 0,
				url : "pages/teachers/list.html",
			}, {
				name : "课程管理",
				id : 11,
				pid : 0,
				url : "pages/courses/list.html",
			}, {
				name : "课程类目管理",
				id : 12,
				pid : 0,
				url : "pages/catalog/list.html",
			}, {
				name : "Lite示例管理",
				id : 13,
				pid : 0,
				url : "pages/liteExample/list.html",
			}, {
				name : "Lite模型管理",
				id : 14,
				pid : 0,
				url : "pages/liteModel/list.html",
			}, {
				name : "应用案例种类管理",
				id : 15,
				pid : 0,
				url : "pages/cases/catagory.html",
			}, {
				name : "应用案例管理",
				id : 16,
				pid : 0,
				url : "pages/cases/list.html",
			} , {
				name : "竞赛管理",
				id : 18,
				pid : 0,
				url : "pages/contested/contested.html",
			} ];
				//初始化页面骨架
				// var skeleton = null;
				// 			layui.use("skeleton", function() {
				// 				skeleton = layui.skeleton("left-nav", "top-tab");
				// 				//初始化菜单栏
				// 				skeleton.menu.init(node1, "id", "pid", "name", "url");
				// 				//打开第一个节点
				// 				skeleton.menu.open(localStorage.getItem("weadmin_menu_id") || node1[0].id);
				// 			});
			function getUserInfo(){
				$.ajax({
					url :'/source/login/getUser',
					method : 'get',
					success : function(res) {
						var node = [];
						if(res.status == 200) {
							if(res.obj === '超级管理员') {
								node = node1;
								$('#AdministratorName').html('超级管理员');
							} else if(res.obj === '使用管理员') {
								node = node1;
								$('#AdministratorName').html('使用管理员');
							} else if(res.obj === '资讯管理员') {
								node = node1.slice(0, 2).concat(node1.slice(6, 7)).concat(node1.slice(9, 10));
								$('#AdministratorName').html('资讯管理员');
							} else if(res.obj === '论文管理员') {
								node = node1.slice(7, 9);
								$('#AdministratorName').html('论文管理员');
							} else if(res.obj === '案例管理员') {
								// 下标10-12是师资管理、课程管理、课程类目管理
								// 下标15到最后是应用案例种类管理、应用案例管理
								// 都属于案例管理员权限下的模块
								node = node1.slice(15)
								$('#AdministratorName').html('案例管理员');
							} else if(res.obj === '端侧管理员') {
								node = node1.slice(13, 15);
								$('#AdministratorName').html('端侧管理员');
							} else if(res.obj === '课程管理员') {
								node = node1.slice(10, 13);
								$('#AdministratorName').html('课程管理员');
							}
							//初始化页面骨架
							var skeleton = null;
							layui.use("skeleton", function() {
								skeleton = layui.skeleton("left-nav", "top-tab");
								//初始化菜单栏
								skeleton.menu.init(node, "id", "pid", "name", "url");
								//打开第一个节点
								skeleton.menu.open(localStorage.getItem("weadmin_menu_id") || node[0].id);
							});
						}
					},
					error : function(err) {
						console.log(err)
					}
				})
			}

			$(document).ready(function() {
				$.ajax({
					url : '/login/getStatus',
					method : 'get',
					success : function(res) {
						if(res.obj.data==='Not logged in'){
							if(window.location.href.indexOf("mindspore")>-1){
								window.location.href = "../login.html";
							}else{
								window.location.href = "https://www.mindspore.cn/login.html";
							}
						} else {
							getUserInfo();
						}
					},
					error : function(err) {
						console.log(err)
						
					}
				})
			});
			
		};
	</script>
</body>
</html>
