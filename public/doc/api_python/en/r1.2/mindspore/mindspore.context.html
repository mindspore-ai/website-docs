

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>mindspore.context &mdash; MindSpore master documentation</title>
  

  
   
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  
  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="mindspore.dataset" href="mindspore.dataset.html" />
    <link rel="prev" title="mindspore.compression" href="mindspore.compression.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> MindSpore
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">MindSpore Python API</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="mindspore.html">mindspore</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindspore.common.initializer.html">mindspore.common.initializer</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindspore.communication.html">mindspore.communication</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindspore.compression.html">mindspore.compression</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">mindspore.context</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindspore.dataset.html">mindspore.dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindspore.dataset.config.html">mindspore.dataset.config</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindspore.dataset.text.html">mindspore.dataset.text</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindspore.dataset.transforms.html">mindspore.dataset.transforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindspore.dataset.vision.html">mindspore.dataset.vision</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindspore.explainer.html">mindspore.explainer</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindspore.mindrecord.html">mindspore.mindrecord</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindspore.nn.html">mindspore.nn</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindspore.numpy.html">mindspore.numpy</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindspore.nn.probability.html">mindspore.nn.probability</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindspore.ops.html">mindspore.ops</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindspore.profiler.html">mindspore.profiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindspore.train.html">mindspore.train</a></li>
</ul>
<p class="caption"><span class="caption-text">MindArmour Python API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../mindarmour/mindarmour.html">mindarmour</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindarmour/mindarmour.adv_robustness.attacks.html">mindarmour.adv_robustness.attacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindarmour/mindarmour.adv_robustness.defenses.html">mindarmour.adv_robustness.defenses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindarmour/mindarmour.adv_robustness.detectors.html">mindarmour.adv_robustness.detectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindarmour/mindarmour.adv_robustness.evaluations.html">mindarmour.adv_robustness.evaluations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindarmour/mindarmour.fuzz_testing.html">mindarmour.fuzz_testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindarmour/mindarmour.privacy.diff_privacy.html">mindarmour.privacy.diff_privacy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindarmour/mindarmour.privacy.evaluation.html">mindarmour.privacy.evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindarmour/mindarmour.privacy.sup_privacy.html">mindarmour.privacy.sup_privacy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindarmour/mindarmour.utils.html">mindarmour.utils</a></li>
</ul>
<p class="caption"><span class="caption-text">MindSpore Hub Python API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../mindspore_hub/mindspore_hub.html">mindspore_hub</a></li>
</ul>
<p class="caption"><span class="caption-text">MindSpore Serving Python API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../mindspore_serving/mindspore_serving.html">mindspore_serving</a></li>
</ul>
<p class="caption"><span class="caption-text">MindQuantum Python API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../mindquantum/mindquantum.html">mindquantum</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MindSpore</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>mindspore.context</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/mindspore/mindspore.context.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-mindspore.context">
<span id="mindspore-context"></span><h1>mindspore.context<a class="headerlink" href="#module-mindspore.context" title="Permalink to this headline">¶</a></h1>
<p>The context of mindspore, used to configure the current execution environment,
includes the execution mode, execution backend and other feature switches.</p>
<dl class="function">
<dt id="mindspore.context.set_context">
<code class="sig-prename descclassname">mindspore.context.</code><code class="sig-name descname">set_context</code><span class="sig-paren">(</span><em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/context.html#set_context"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mindspore.context.set_context" title="Permalink to this definition">¶</a></dt>
<dd><p>Set context for running environment.</p>
<p>Context should be configured before running your program. If there is no configuration,
the “Ascend” device target will be used by default. GRAPH_MODE or
PYNATIVE_MODE can be set by <cite>mode</cite> attribute and both modes support all backends, default
mode is PYNATIVE_MODE.</p>
<p>When the <cite>save_graphs</cite> attribute is set to True, attribute of <cite>save_graphs_path</cite> is used to set the
intermediate compilation graph storage path. By default, the graphs are saved in the current directory.
For other configurations and arguments, please refer to the corresponding module
description, the configuration is optional and can be enabled when needed.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Attribute name is required for setting attributes.
The mode is not recommended to be changed after net was initialized because the implementations of some
operations are different in graph mode and pynative mode. Default: PYNATIVE_MODE.</p>
</div>
<p>Some configurations are device specific, see the below table for details:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 37%" />
<col style="width: 37%" />
<col style="width: 26%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Common(CPU/GPU/Ascend)</p></th>
<th class="head"><p>Ascend</p></th>
<th class="head"><p>GPU</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>check_bprop</p></td>
<td><p>print_file_path</p></td>
<td><p>max_device_memory</p></td>
</tr>
<tr class="row-odd"><td><p>device_id</p></td>
<td><p>enable_dump</p></td>
<td><p>enable_graph_kernel</p></td>
</tr>
<tr class="row-even"><td><p>device_target</p></td>
<td><p>save_dump_path</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>enable_sparse</p></td>
<td><p>enable_graph_kernel</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>max_call_depth</p></td>
<td><p>enable_reduce_precision</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>mode</p></td>
<td><p>enable_profiling</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>reserve_class_name_in_scope</p></td>
<td><p>profiling_options</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>save_graphs</p></td>
<td><p>variable_memory_max_size</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>save_graphs_path</p></td>
<td><p>auto_tune_mode</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>env_config_path</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>grad_for_scalar</p></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mode</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – Running in GRAPH_MODE(0) or PYNATIVE_MODE(1). Default: PYNATIVE_MODE(1).</p></li>
<li><p><strong>device_target</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – The target device to run, support “Ascend”, “GPU”, and “CPU”. Default: “Ascend”.</p></li>
<li><p><strong>device_id</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – ID of the target device, the value must be in [0, device_num_per_host-1],
while device_num_per_host should be no more than 4096. Default: 0.</p></li>
<li><p><strong>save_graphs</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a>) – Whether to save graphs. Default: False.</p></li>
<li><p><strong>save_graphs_path</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – <p>Path to save graphs. Default: “.”.</p>
<p>If the program is executed in the parallel mode, <cite>save_graphs_path</cite> should consist of the path and the
current device id, to ensure that writing file conflicts won’t happen when the different processes try to
create the files in the same directory. For example, the <cite>device_id</cite> can be generated by
<cite>device_id = os.getenv(“DEVICE_ID”)</cite> and the <cite>save_graphs_path</cite> can be set by
<cite>context.set_context(save_graphs_path=”path/to/ir/files”+device_id)</cite>.</p>
</p></li>
<li><p><strong>enable_graph_kernel</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a>) – Whether to enable composition of basic primitives. These primitives would be
compiled into a fused kernel automatically. Default: False.</p></li>
<li><p><strong>reserve_class_name_in_scope</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a>) – Whether to save the network class name in the scope. Default: True.</p></li>
<li><p><strong>enable_reduce_precision</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a>) – Whether to enable precision reduction. Default: True.</p></li>
<li><p><strong>enable_dump</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a>) – Whether to enable dump. Default: False.</p></li>
<li><p><strong>save_dump_path</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – When the program is executed on Ascend, operators can dump data in this path.
The root dump path is configured in /home/HwHiAiUser/ide_daemon/ide_daemon.cfg.
So the real dump path is “{configured root dump path}/{<cite>save_dump_path</cite>}”. Default: “.”.</p></li>
<li><p><strong>variable_memory_max_size</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – Set the maximum size of the variable memory max size. Default: “0GB”.</p></li>
<li><p><strong>enable_profiling</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a>) – Whether to open profiling. Default: False.</p></li>
<li><p><strong>profiling_options</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – <p>Set profiling collection options, operators can profiling data here.
The values of profiling collection options are as follows, supporting the collection of multiple data.</p>
<ul>
<li><p>output: the saving the path of the profiling collection result file. The directory spectified by this
parameter needs to be created in advance on the training environment (container or host side) and ensure
that the running user configured during installation has read and write permissions.It supports the
configuration of absolute or relative paths(relative to the current path when executing the command line).
The absolute path configuration starts with ‘/’, for example:/home/data/output.
The relative path configuration directly starts with the directory name,for example:output.</p></li>
<li><p>training_trace: collect iterative trajectory data, that is, the training task and software information of
the AI software stack, to achieve performance analysis of the training task, focusing on data
enhancement, forward and backward calculation, gradient aggregation update and other related data.
The value is on/off.</p></li>
<li><p>task_trace: collect task trajectory data, that is, the hardware information of the HWTS/AICore of
the Ascend 910 processor, and analyze the information of beginning and ending of the task.
The value is on/off.</p></li>
<li><p>aicpu: collect profiling data enhanced by aicpu data. The value is on/off.</p></li>
<li><p>fp_point: specify the start position of the forward operator of the training network iteration trajectory,
which is used to record the start timestamp of the forward calculation.The configuration value is the name
of the first operator specified in the forward direction. when the value is empty,the system will
automatically obtain the forward operator name.</p></li>
<li><p>bp_point: specify the end position of the iteration trajectory reversal operator of the training network,
record the end timestamp of the backward calculation. The configuration value is the name of the operator
after the specified reverse. when the value is empty,the system will automatically obtain the backward
operator name.</p></li>
<li><p>aic_metrics: the values are as follows:
ArithmeticUtilization: percentage statistics of various calculation indicators.
PipeUtilization: the time-consuming ratio of calculation unit and handling unit,this item is
the default value.
Memory: percentage of external memory read and write instructions.
MemoryL0: percentage of internal memory read and write instructions.
ResourceConflictRatio: proportion of pipline queue instructions.</p></li>
</ul>
<p>The profiling_options is like ‘{“output”:’/home/data/output’,’training_trace’:’on’}’</p>
</p></li>
<li><p><strong>check_bprop</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a>) – Whether to check bprop. Default: False.</p></li>
<li><p><strong>max_device_memory</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – Sets the maximum memory available for devices.
Currently, it is only supported on GPU. The format is “xxGB”. Default: “1024GB”.</p></li>
<li><p><strong>print_file_path</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – The path of saving print data. If this parameter is set, print data is saved to
a file by default, and turns off printing to the screen. If the file already exists, add a timestamp
suffix to the file. Default: ‘’.</p></li>
<li><p><strong>enable_sparse</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a>) – Whether to enable sparsity feature. Default: False.</p></li>
<li><p><strong>max_call_depth</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – Specify the maximum depth of function call. Default: 1000.</p></li>
<li><p><strong>env_config_path</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – Config path for DFX.</p></li>
<li><p><strong>auto_tune_mode</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – The mode of auto tune when op building, get the best tiling performance,
default: NO_TUNE. The value must be in [‘RL’, ‘GA’, ‘RL,GA’].
RL: rl_tune;
GA: ga_tune;
RL,GA: rl_tune/ga_tune(Automatic selection).
- rl_tune: Reinforecement Learning tune.
- ga_tune: Genetic Algorithm tune.</p></li>
<li><p><strong>grad_for_scalar</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a>) – Whether to get gradient for scalar. Default: False.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#ValueError" title="(in Python v3.8)"><strong>ValueError</strong></a> – If input key is not an attribute in context.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">context</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">GRAPH_MODE</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">PYNATIVE_MODE</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">device_target</span><span class="o">=</span><span class="s2">&quot;Ascend&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">device_id</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">save_graphs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save_graphs_path</span><span class="o">=</span><span class="s2">&quot;./model.ms&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">enable_reduce_precision</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">enable_dump</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save_dump_path</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">reserve_class_name_in_scope</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">variable_memory_max_size</span><span class="o">=</span><span class="s2">&quot;6GB&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">GRAPH_MODE</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="n">device_target</span><span class="o">=</span><span class="s2">&quot;Ascend&quot;</span><span class="p">,</span><span class="n">device_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">save_graphs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="n">save_graphs_path</span><span class="o">=</span><span class="s2">&quot;/mindspore&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">enable_profiling</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="n">profiling_options</span><span class="o">=</span><span class="s1">&#39;{&quot;output&quot;:&quot;/home/data/output&quot;,&quot;training_trace&quot;:&quot;on&quot;}&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">max_device_memory</span><span class="o">=</span><span class="s2">&quot;3.5GB&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">print_file_path</span><span class="o">=</span><span class="s2">&quot;print.pb&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">max_call_depth</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">env_config_path</span><span class="o">=</span><span class="s2">&quot;./env_config.json&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="mindspore.context.get_context">
<code class="sig-prename descclassname">mindspore.context.</code><code class="sig-name descname">get_context</code><span class="sig-paren">(</span><em class="sig-param">attr_key</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/context.html#get_context"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mindspore.context.get_context" title="Permalink to this definition">¶</a></dt>
<dd><p>Get context attribute value according to the input key.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>attr_key</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – The key of the attribute.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Object, The value of given attribute key.</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#ValueError" title="(in Python v3.8)"><strong>ValueError</strong></a> – If input key is not an attribute in context.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="mindspore.context.set_auto_parallel_context">
<code class="sig-prename descclassname">mindspore.context.</code><code class="sig-name descname">set_auto_parallel_context</code><span class="sig-paren">(</span><em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/context.html#set_auto_parallel_context"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mindspore.context.set_auto_parallel_context" title="Permalink to this definition">¶</a></dt>
<dd><p>Set auto parallel context, which is valid only for Ascend and GPU target.</p>
<p>Auto parallel context should be configured before the initialization of your network.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Attribute name is required for setting attributes.
If a program has tasks with different parallel modes, then before setting new parallel mode for the
next task, interface mindspore.context.reset_auto_parallel_context() needs to be called to reset
the configuration.
Setting or changing parallel modes must be called before any creating Initializer, otherwise,
RuntimeError may be raised when compiling the network.</p>
</div>
<p>Some configurations are parallel mode specific, see the below table for details:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Common</p></th>
<th class="head"><p>AUTO_PARALLEL</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>device_num</p></td>
<td><p>gradient_fp32_sync</p></td>
</tr>
<tr class="row-odd"><td><p>global_rank</p></td>
<td><p>loss_repeated_mean</p></td>
</tr>
<tr class="row-even"><td><p>gradients_mean</p></td>
<td><p>auto_parallel_search_mode</p></td>
</tr>
<tr class="row-odd"><td><p>parallel_mode</p></td>
<td><p>strategy_ckpt_load_file</p></td>
</tr>
<tr class="row-even"><td><p>all_reduce_fusion_config</p></td>
<td><p>strategy_ckpt_save_file</p></td>
</tr>
<tr class="row-odd"><td><p>enable_parallel_optimizer</p></td>
<td><p>full_batch</p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p>pipeline_stages</p></td>
</tr>
</tbody>
</table>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>device_num</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – Available device number, the value must be in [1, 4096]. Default: 1.</p></li>
<li><p><strong>global_rank</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – Global rank id, the value must be in [0, 4095]. Default: 0.</p></li>
<li><p><strong>gradients_mean</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a>) – Whether to perform mean operator after allreduce of gradients.
“stand_alone” do not support gradients_mean. Default: False.</p></li>
<li><p><strong>gradient_fp32_sync</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a>) – Run allreduce of gradients in fp32.
“stand_alone”, “data_parallel” and “hybrid_parallel” do not support
gradient_fp32_sync. Default: True.</p></li>
<li><p><strong>parallel_mode</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – <p>There are five kinds of parallel modes, “stand_alone”, “data_parallel”,
“hybrid_parallel”, “semi_auto_parallel” and “auto_parallel”. Default: “stand_alone”.</p>
<ul>
<li><p>stand_alone: Only one processor is working.</p></li>
<li><p>data_parallel: Distributes the data across different processors.</p></li>
<li><p>hybrid_parallel: Achieves data parallelism and model parallelism manually.</p></li>
<li><p>semi_auto_parallel: Achieves data parallelism and model parallelism by
setting parallel strategies.</p></li>
<li><p>auto_parallel: Achieving parallelism automatically.</p></li>
</ul>
</p></li>
<li><p><strong>auto_parallel_search_mode</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – <p>There are two kinds of shard strategy search modes, “recursive_programming”
and “dynamic_programming”. Default: “dynamic_programming”.</p>
<ul>
<li><p>recursive_programming: Recursive programming search mode.</p></li>
<li><p>dynamic_programming: Dynamic programming search mode.</p></li>
</ul>
</p></li>
<li><p><strong>parameter_broadcast</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a>) – Whether to broadcast parameters before training. Before training, in order to have
the same network initialization parameter values for all devices, broadcast the parameters
on device 0 to other devices. Parameter broadcasting in different parallel modes is different,
data_parallel mode, all parameters are broadcast except for the parameter whose attribute
layerwise_parallel is True. Hybrid_parallel, semi_auto_parallel and auto_parallel mode, the
segmented parameters do not participate in broadcasting. Default: False.</p></li>
<li><p><strong>strategy_ckpt_load_file</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – The path to load parallel strategy checkpoint. Default: ‘’</p></li>
<li><p><strong>strategy_ckpt_save_file</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – The path to save parallel strategy checkpoint. Default: ‘’</p></li>
<li><p><strong>full_batch</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a>) – If you load whole batch datasets in auto_parallel mode, this parameter
should be set with True. Default: False.</p></li>
<li><p><strong>enable_parallel_optimizer</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a>) – This is a developing feature, which shards the weight update computation for
data parallel training in the benefit of time and memory saving. Currently, auto and semi auto
parallel mode support all optimizers in both Ascend and GPU. Data parallel mode only supports
<cite>Lamb</cite> and <cite>AdamWeightDecay</cite> in Ascend . Default: False.</p></li>
<li><p><strong>all_reduce_fusion_config</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#list" title="(in Python v3.8)"><em>list</em></a>) – Set allreduce fusion strategy by parameters indices. Only support ReduceOp.SUM
and HCCL_WORLD_GROUP/NCCL_WORLD_GROUP. No Default, if it is not set, the fusion is closed.</p></li>
<li><p><strong>pipeline_stages</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – Set the stage information for pipeline parallel. This indicates how
the devices are distributed alone the pipeline. The total devices will be divided into
‘pipeline_stags’ stages. This currently could only be used when
parallel mode semi_auto_parallel is enabled. Default: 1.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#ValueError" title="(in Python v3.8)"><strong>ValueError</strong></a> – If input key is not attribute in auto parallel context.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">context</span><span class="o">.</span><span class="n">set_auto_parallel_context</span><span class="p">(</span><span class="n">device_num</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span><span class="o">.</span><span class="n">set_auto_parallel_context</span><span class="p">(</span><span class="n">global_rank</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span><span class="o">.</span><span class="n">set_auto_parallel_context</span><span class="p">(</span><span class="n">gradients_mean</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span><span class="o">.</span><span class="n">set_auto_parallel_context</span><span class="p">(</span><span class="n">gradient_fp32_sync</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span><span class="o">.</span><span class="n">set_auto_parallel_context</span><span class="p">(</span><span class="n">parallel_mode</span><span class="o">=</span><span class="s2">&quot;auto_parallel&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span><span class="o">.</span><span class="n">set_auto_parallel_context</span><span class="p">(</span><span class="n">auto_parallel_search_mode</span><span class="o">=</span><span class="s2">&quot;dynamic_programming&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span><span class="o">.</span><span class="n">set_auto_parallel_context</span><span class="p">(</span><span class="n">parameter_broadcast</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span><span class="o">.</span><span class="n">set_auto_parallel_context</span><span class="p">(</span><span class="n">strategy_ckpt_load_file</span><span class="o">=</span><span class="s2">&quot;./strategy_stage1.ckpt&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span><span class="o">.</span><span class="n">set_auto_parallel_context</span><span class="p">(</span><span class="n">strategy_ckpt_save_file</span><span class="o">=</span><span class="s2">&quot;./strategy_stage1.ckpt&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span><span class="o">.</span><span class="n">set_auto_parallel_context</span><span class="p">(</span><span class="n">full_batch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span><span class="o">.</span><span class="n">set_auto_parallel_context</span><span class="p">(</span><span class="n">enable_parallel_optimizer</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span><span class="o">.</span><span class="n">set_auto_parallel_context</span><span class="p">(</span><span class="n">all_reduce_fusion_config</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">160</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span><span class="o">.</span><span class="n">set_auto_parallel_context</span><span class="p">(</span><span class="n">pipeline_stages</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="mindspore.context.get_auto_parallel_context">
<code class="sig-prename descclassname">mindspore.context.</code><code class="sig-name descname">get_auto_parallel_context</code><span class="sig-paren">(</span><em class="sig-param">attr_key</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/context.html#get_auto_parallel_context"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mindspore.context.get_auto_parallel_context" title="Permalink to this definition">¶</a></dt>
<dd><p>Get auto parallel context attribute value according to the key.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>attr_key</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – The key of the attribute.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Returns attribute value according to the key.</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#ValueError" title="(in Python v3.8)"><strong>ValueError</strong></a> – If input key is not attribute in auto parallel context.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="mindspore.context.reset_auto_parallel_context">
<code class="sig-prename descclassname">mindspore.context.</code><code class="sig-name descname">reset_auto_parallel_context</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/context.html#reset_auto_parallel_context"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mindspore.context.reset_auto_parallel_context" title="Permalink to this definition">¶</a></dt>
<dd><p>Reset auto parallel context attributes to the default values:</p>
<ul class="simple">
<li><p>device_num: 1.</p></li>
<li><p>global_rank: 0.</p></li>
<li><p>gradients_mean: False.</p></li>
<li><p>gradient_fp32_sync: True.</p></li>
<li><p>parallel_mode: ‘stand_alone’.</p></li>
<li><p>auto_parallel_search_mode: ‘dynamic_programming’.</p></li>
<li><p>parameter_broadcast: False.</p></li>
<li><p>strategy_ckpt_load_file: ‘’.</p></li>
<li><p>strategy_ckpt_save_file: ‘’.</p></li>
<li><p>full_batch: False.</p></li>
<li><p>enable_parallel_optimizer: False.</p></li>
<li><p>pipeline_stages: 1.</p></li>
</ul>
</dd></dl>

<dl class="class">
<dt id="mindspore.context.ParallelMode">
<em class="property">class </em><code class="sig-prename descclassname">mindspore.context.</code><code class="sig-name descname">ParallelMode</code><a class="reference internal" href="../_modules/mindspore/context.html#ParallelMode"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mindspore.context.ParallelMode" title="Permalink to this definition">¶</a></dt>
<dd><p>Parallel mode options.</p>
<p>There are five kinds of parallel modes, “STAND_ALONE”, “DATA_PARALLEL”,
“HYBRID_PARALLEL”, “SEMI_AUTO_PARALLEL” and “AUTO_PARALLEL”. Default: “STAND_ALONE”.</p>
<ul class="simple">
<li><p>STAND_ALONE: Only one processor is working.</p></li>
<li><p>DATA_PARALLEL: Distributes the data across different processors.</p></li>
<li><p>HYBRID_PARALLEL: Achieves data parallelism and model parallelism manually.</p></li>
<li><p>SEMI_AUTO_PARALLEL: Achieves data parallelism and model parallelism by setting parallel strategies.</p></li>
<li><p>AUTO_PARALLEL: Achieves parallelism automatically.</p></li>
</ul>
<p>MODE_LIST: The list of all supported parallel modes.</p>
</dd></dl>

<dl class="function">
<dt id="mindspore.context.set_ps_context">
<code class="sig-prename descclassname">mindspore.context.</code><code class="sig-name descname">set_ps_context</code><span class="sig-paren">(</span><em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/context.html#set_ps_context"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mindspore.context.set_ps_context" title="Permalink to this definition">¶</a></dt>
<dd><p>Set parameter server training mode context.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Some other environment variables should also be set for parameter server training mode.
These environment variables are listed below:</p>
<p>MS_SERVER_NUM  # Server number
MS_WORKER_NUM  # Worker number
MS_SCHED_HOST  # Scheduler IP address
MS_SCHED_PORT  # Scheduler port
MS_ROLE        # The role of this process:
MS_SCHED       #represents the scheduler,
MS_WORKER      #represents the worker,
MS_PSERVER     #represents the Server</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>enable_ps</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a>) – Whether to enable parameter server training mode.
Only after enable_ps is set True, the environment variables will be effective.
Default: False.</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#ValueError" title="(in Python v3.8)"><strong>ValueError</strong></a> – If input key is not the attribute in parameter server training mode context.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">context</span><span class="o">.</span><span class="n">set_ps_context</span><span class="p">(</span><span class="n">enable_ps</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="mindspore.context.get_ps_context">
<code class="sig-prename descclassname">mindspore.context.</code><code class="sig-name descname">get_ps_context</code><span class="sig-paren">(</span><em class="sig-param">attr_key</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/context.html#get_ps_context"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mindspore.context.get_ps_context" title="Permalink to this definition">¶</a></dt>
<dd><p>Get parameter server training mode context attribute value according to the key.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>attr_key</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – The key of the attribute.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Returns attribute value according to the key.</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#ValueError" title="(in Python v3.8)"><strong>ValueError</strong></a> – If input key is not attribute in auto parallel context.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="mindspore.context.reset_ps_context">
<code class="sig-prename descclassname">mindspore.context.</code><code class="sig-name descname">reset_ps_context</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/context.html#reset_ps_context"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mindspore.context.reset_ps_context" title="Permalink to this definition">¶</a></dt>
<dd><p>Reset parameter server training mode context attributes to the default values:</p>
<ul class="simple">
<li><p>enable_ps: False.</p></li>
</ul>
</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="mindspore.dataset.html" class="btn btn-neutral float-right" title="mindspore.dataset" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="mindspore.compression.html" class="btn btn-neutral float-left" title="mindspore.compression" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, MindSpore.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   
	<script async="async" src="https://cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>