<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>静态图语法支持 &mdash; MindSpore r1.1 documentation</title><script>;(()=>{const e=localStorage.getItem("ms-theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;(e?"dark"===e:t)&&document.documentElement.setAttribute("data-o-theme","dark")})();</script><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script><script src="_static/jquery.js"></script>
        <script src="_static/js/theme.js"></script><script src="_static/underscore.js"></script><script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="模型支持（Lite）" href="model_lite.html" />
    <link rel="prev" title="语法支持" href="syntax_list.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> MindSpore
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">设计说明</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="design/overall.html">总体设计</a></li>
<li class="toctree-l1"><a class="reference internal" href="design/mindspore.html">MindSpore设计</a></li>
<li class="toctree-l1"><a class="reference internal" href="design/mindinsight.html">MindInsight设计</a></li>
<li class="toctree-l1"><a class="reference internal" href="design/mindarmour.html">MindArmour设计</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">规格说明</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="benchmark.html">基准性能</a></li>
<li class="toctree-l1"><a class="reference internal" href="network_list.html">网络支持</a></li>
<li class="toctree-l1"><a class="reference internal" href="operator_list.html">算子支持</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="syntax_list.html">语法支持</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">静态图语法支持</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">概述</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">数据类型</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#python">Python内置数据类型</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mindspore">MindSpore自定义数据类型</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id4">运算符</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id5">算术运算符</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id6">赋值运算符</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id7">逻辑运算符</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id8">成员运算符</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id9">身份运算符</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id10">表达式</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id11">条件控制语句</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id12">循环语句</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id13">流程控制语句</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id14">函数定义语句</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id15">函数</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id16">Python内置函数</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id17">函数参数</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id18">网络定义</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id19">整网实例类型</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id20">网络构造组件</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id21">网络使用约束</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="model_lite.html">模型支持（Lite）</a></li>
<li class="toctree-l1"><a class="reference internal" href="env_var_list.html">环境变量</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">其他说明</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">术语</a></li>
<li class="toctree-l1"><a class="reference internal" href="roadmap.html">路标</a></li>
<li class="toctree-l1"><a class="reference internal" href="help_seeking_path.html">如何求助（求助路径）</a></li>
<li class="toctree-l1"><a class="reference internal" href="community.html">如何参与社区</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MindSpore</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="syntax_list.html">语法支持</a> &raquo;</li>
      <li>静态图语法支持</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/static_graph_syntax_support.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="id1">
<h1>静态图语法支持<a class="headerlink" href="#id1" title="Permalink to this headline"></a></h1>
<p><code class="docutils literal notranslate"><span class="pre">Linux</span></code> <code class="docutils literal notranslate"><span class="pre">Ascend</span></code> <code class="docutils literal notranslate"><span class="pre">GPU</span></code> <code class="docutils literal notranslate"><span class="pre">CPU</span></code> <code class="docutils literal notranslate"><span class="pre">模型开发</span></code> <code class="docutils literal notranslate"><span class="pre">初级</span></code> <code class="docutils literal notranslate"><span class="pre">中级</span></code> <code class="docutils literal notranslate"><span class="pre">高级</span></code></p>
<p><a class="reference external" href="https://gitee.com/mindspore/docs/blob/r1.1/docs/note/source_zh_cn/static_graph_syntax_support.md"><img alt="查看源文件" src="_images/logo_source.png" /></a></p>
<section id="id2">
<h2>概述<a class="headerlink" href="#id2" title="Permalink to this headline"></a></h2>
<p>在Graph模式下，Python代码并不是由Python解释器去执行，而是将代码编译成静态计算图，然后执行静态计算图。</p>
<p>关于Graph模式和计算图，可参考文档：<a class="reference external" href="https://www.mindspore.cn/tutorial/training/zh-CN/r1.1/advanced_use/debug_in_pynative_mode.html">https://www.mindspore.cn/tutorial/training/zh-CN/r1.1/advanced_use/debug_in_pynative_mode.html</a></p>
<p>当前仅支持编译<code class="docutils literal notranslate"><span class="pre">&#64;ms_function</span></code>装饰器修饰的函数、Cell及其子类的实例。
对于函数，则编译函数定义；对于网络，则编译<code class="docutils literal notranslate"><span class="pre">construct</span></code>方法及其调用的其他方法或者函数。</p>
<p><code class="docutils literal notranslate"><span class="pre">ms_function</span></code>使用规则可参考文档：<a class="reference external" href="https://www.mindspore.cn/doc/api_python/zh-CN/r1.1/mindspore/mindspore.html#mindspore.ms_function">https://www.mindspore.cn/doc/api_python/zh-CN/r1.1/mindspore/mindspore.html#mindspore.ms_function</a></p>
<p><code class="docutils literal notranslate"><span class="pre">Cell</span></code>定义可参考文档：<a class="reference external" href="https://www.mindspore.cn/doc/programming_guide/zh-CN/r1.1/cell.html">https://www.mindspore.cn/doc/programming_guide/zh-CN/r1.1/cell.html</a></p>
<p>由于语法解析的限制，当前在编译构图时，支持的数据类型、语法以及相关操作并没有完全与Python语法保持一致，部分使用受限。</p>
<p>本文主要介绍，在编译静态图时，支持的数据类型、语法以及相关操作，这些规则仅适用于Graph模式。</p>
<blockquote>
<div><p>以下所有示例都运行在Graph模式下的网络中，为了简洁，并未将网络的定义都写出来。</p>
</div></blockquote>
</section>
<section id="id3">
<h2>数据类型<a class="headerlink" href="#id3" title="Permalink to this headline"></a></h2>
<section id="python">
<h3>Python内置数据类型<a class="headerlink" href="#python" title="Permalink to this headline"></a></h3>
<p>当前支持的<code class="docutils literal notranslate"><span class="pre">Python</span></code>内置数据类型包括：<code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">String</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>和<code class="docutils literal notranslate"><span class="pre">Dictionary</span></code>。</p>
<section id="number">
<h4>Number<a class="headerlink" href="#number" title="Permalink to this headline"></a></h4>
<p>支持<code class="docutils literal notranslate"><span class="pre">int</span></code>、<code class="docutils literal notranslate"><span class="pre">float</span></code>、<code class="docutils literal notranslate"><span class="pre">bool</span></code>，不支持complex（复数）。</p>
<p>支持在网络里定义<code class="docutils literal notranslate"><span class="pre">Number</span></code>，即支持语法：<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">1</span></code>、<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">1.2</span></code>、 <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">True</span></code>。</p>
<p>不支持在网络里强转<code class="docutils literal notranslate"><span class="pre">Number</span></code>，即不支持语法：<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">int(x)</span></code>、<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">float(x)</span></code>、<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">bool(x)</span></code>。</p>
</section>
<section id="string">
<h4>String<a class="headerlink" href="#string" title="Permalink to this headline"></a></h4>
<p>支持在网络里构造<code class="docutils literal notranslate"><span class="pre">String</span></code>，即支持语法<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">&quot;abcd&quot;</span></code>。</p>
<p>不支持在网络里强转<code class="docutils literal notranslate"><span class="pre">String</span></code>，即不支持语法 <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">str(x)</span></code>。</p>
</section>
<section id="list">
<h4>List<a class="headerlink" href="#list" title="Permalink to this headline"></a></h4>
<p>支持在网络里构造<code class="docutils literal notranslate"><span class="pre">List</span></code>，即支持语法<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">[1,</span> <span class="pre">2,</span> <span class="pre">3]</span></code>。</p>
<p>不支持在网络里强转<code class="docutils literal notranslate"><span class="pre">List</span></code>，即不支持语法<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">list(x)</span></code>。</p>
<p>计算图中最终需要输出的<code class="docutils literal notranslate"><span class="pre">List</span></code>会转换为<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>输出。</p>
<ul>
<li><p>支持接口</p>
<p><code class="docutils literal notranslate"><span class="pre">append</span></code>: 向<code class="docutils literal notranslate"><span class="pre">list</span></code>里追加元素。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>x: (1, 2, 3, 4)
</pre></div>
</div>
</li>
<li><p>支持索引取值和赋值</p>
<p>支持单层和多层索引取值以及赋值。</p>
<p>取值和赋值的索引值仅支持<code class="docutils literal notranslate"><span class="pre">int</span></code>。</p>
<p>赋值时，所赋的值支持<code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">String</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>
<span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ok&quot;</span>
<span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">88</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>y: 2
x: ([1, 88], Tensor(shape=[3], dtype=Int64, value=[1, 2, 3]), &#39;ok&#39;, (1, 2, 3))
</pre></div>
</div>
</li>
</ul>
</section>
<section id="tuple">
<h4>Tuple<a class="headerlink" href="#tuple" title="Permalink to this headline"></a></h4>
<p>支持在网络里构造<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>，即支持语法<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">(1,</span> <span class="pre">2,</span> <span class="pre">3)</span></code>。</p>
<p>不支持在网络里强转<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>，即不支持语法<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">tuple(x)</span></code>。</p>
<ul>
<li><p>支持索引取值</p>
<p>索引值支持<code class="docutils literal notranslate"><span class="pre">int</span></code>、<code class="docutils literal notranslate"><span class="pre">slice</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，也支持多层索引取值，即支持语法<code class="docutils literal notranslate"><span class="pre">data</span> <span class="pre">=</span> <span class="pre">tuple_x[index0][index1]...</span></code>。</p>
<p>索引值为<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>有如下限制：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">tuple</span></code>里存放的都是<code class="docutils literal notranslate"><span class="pre">Cell</span></code>，每个<code class="docutils literal notranslate"><span class="pre">Cell</span></code>要在tuple定义之前完成定义，每个<code class="docutils literal notranslate"><span class="pre">Cell</span></code>的入参个数、入参类型和入参<code class="docutils literal notranslate"><span class="pre">shape</span></code>要求一致，每个<code class="docutils literal notranslate"><span class="pre">Cell</span></code>的输出个数、输出类型和输出<code class="docutils literal notranslate"><span class="pre">shape</span></code>也要求一致。</p></li>
<li><p>索引<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>是一个<code class="docutils literal notranslate"><span class="pre">dtype</span></code>为<code class="docutils literal notranslate"><span class="pre">int32</span></code>的标量<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，取值范围在<code class="docutils literal notranslate"><span class="pre">[-tuple_len,</span> <span class="pre">tuple_len)</span></code>。</p></li>
<li><p>该语法不支持<code class="docutils literal notranslate"><span class="pre">if</span></code>、<code class="docutils literal notranslate"><span class="pre">while</span></code>、<code class="docutils literal notranslate"><span class="pre">for</span></code>控制流条件为变量的运行分支，仅支持控制流条件为常量。</p></li>
<li><p>仅支持<code class="docutils literal notranslate"><span class="pre">GPU</span></code>后端。</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">int</span></code>、<code class="docutils literal notranslate"><span class="pre">slice</span></code>索引示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])))</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>y: 3
z: Tensor(shape=[3], dtype=Int64, value=[1, 2, 3])
m: (2, 3, 4), 3, 4)
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Tensor</span></code>索引示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Net</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relu</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">softmax</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Softmax</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">softmax</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="n">index</span><span class="p">](</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="dictionary">
<h4>Dictionary<a class="headerlink" href="#dictionary" title="Permalink to this headline"></a></h4>
<p>支持在网络里构造<code class="docutils literal notranslate"><span class="pre">Dictionary</span></code>，即支持语法<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">{&quot;a&quot;:</span> <span class="pre">1,</span> <span class="pre">&quot;b&quot;:</span> <span class="pre">2}</span></code>，当前仅支持<code class="docutils literal notranslate"><span class="pre">String</span></code>作为<code class="docutils literal notranslate"><span class="pre">key</span></code>值。</p>
<p>计算图中最终需要输出的<code class="docutils literal notranslate"><span class="pre">Dictionary</span></code>，会取出所有的<code class="docutils literal notranslate"><span class="pre">value</span></code>组成<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>输出。</p>
<ul>
<li><p>支持接口</p>
<p><code class="docutils literal notranslate"><span class="pre">keys</span></code>：取出<code class="docutils literal notranslate"><span class="pre">dict</span></code>里所有的<code class="docutils literal notranslate"><span class="pre">key</span></code>值，组成<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>返回。</p>
<p><code class="docutils literal notranslate"><span class="pre">values</span></code>：取出<code class="docutils literal notranslate"><span class="pre">dict</span></code>里所有的<code class="docutils literal notranslate"><span class="pre">value</span></code>值，组成<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>返回。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])),</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])),</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]))}</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>y: (&quot;a&quot;, &quot;b&quot;, &quot;c&quot;)
z: (Tensor(shape=[3], dtype=Int64, value=[1, 2, 3]), Tensor(shape=[3], dtype=Int64, value=[4, 5, 6]), Tensor(shape=[3], dtype=Int64, value=[7, 8, 9]))
</pre></div>
</div>
</li>
<li><p>支持索引取值和赋值</p>
<p>取值和赋值的索引值都仅支持<code class="docutils literal notranslate"><span class="pre">String</span></code>。赋值时，所赋的值支持<code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])),</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])),</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]))}</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">]</span>
<span class="n">x</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>y: Tensor(shape=[3], dtype=Int64, value=[4, 5, 6])
x: {&quot;a&quot;: (2, 3, 4), Tensor(shape=[3], dtype=Int64, value=[4, 5, 6]), Tensor(shape=[3], dtype=Int64, value=[7, 8, 9])}
</pre></div>
</div>
</li>
</ul>
</section>
</section>
<section id="mindspore">
<h3>MindSpore自定义数据类型<a class="headerlink" href="#mindspore" title="Permalink to this headline"></a></h3>
<p>当前MindSpore自定义数据类型包括：<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Primitive</span></code>和<code class="docutils literal notranslate"><span class="pre">Cell</span></code>。</p>
<section id="tensor">
<h4>Tensor<a class="headerlink" href="#tensor" title="Permalink to this headline"></a></h4>
<p>当前不支持在网络里构造Tensor，即不支持语法<code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">Tensor(args...)</span></code>。</p>
<p>可以通过<code class="docutils literal notranslate"><span class="pre">&#64;constexpr</span></code>装饰器修饰函数，在函数里生成<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。</p>
<p>关于<code class="docutils literal notranslate"><span class="pre">&#64;constexpr</span></code>的用法可参考：<a class="reference external" href="https://www.mindspore.cn/doc/api_python/zh-CN/r1.1/mindspore/ops/mindspore.ops.constexpr.html">https://www.mindspore.cn/doc/api_python/zh-CN/r1.1/mindspore/ops/mindspore.ops.constexpr.html</a></p>
<p>对于网络中需要用到的常量<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，可以作为网络的属性，在<code class="docutils literal notranslate"><span class="pre">init</span></code>的时候定义，即<code class="docutils literal notranslate"><span class="pre">self.x</span> <span class="pre">=</span> <span class="pre">Tensor(args...)</span></code>，然后在<code class="docutils literal notranslate"><span class="pre">construct</span></code>里使用。</p>
<p>如下示例，通过<code class="docutils literal notranslate"><span class="pre">&#64;constexpr</span></code>生成一个<code class="docutils literal notranslate"><span class="pre">shape</span> <span class="pre">=</span> <span class="pre">(3,</span> <span class="pre">4),</span> <span class="pre">dtype</span> <span class="pre">=</span> <span class="pre">int64</span></code>的<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@constexpr</span>
<span class="k">def</span> <span class="nf">generate_tensor</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)))</span>
</pre></div>
</div>
<p>下面将介绍下<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>支持的属性、接口、索引取值和索引赋值。</p>
<ul>
<li><p>支持属性：</p>
<p><code class="docutils literal notranslate"><span class="pre">shape</span></code>：获取<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>的shape，返回一个<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>。</p>
<p><code class="docutils literal notranslate"><span class="pre">dtype</span></code>：获取<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>的数据类型，返回一个<code class="docutils literal notranslate"><span class="pre">MindSpore</span></code>定义的数据类型。</p>
</li>
<li><p>支持接口：</p>
<p><code class="docutils literal notranslate"><span class="pre">all</span></code>：对<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>通过<code class="docutils literal notranslate"><span class="pre">all</span></code>操作进行归约，仅支持<code class="docutils literal notranslate"><span class="pre">Bool</span></code>类型的<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。</p>
<p><code class="docutils literal notranslate"><span class="pre">any</span></code>：对<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>通过<code class="docutils literal notranslate"><span class="pre">any</span></code>操作进行归约，仅支持<code class="docutils literal notranslate"><span class="pre">Bool</span></code>类型的<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。</p>
<p><code class="docutils literal notranslate"><span class="pre">view</span></code>：将<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>reshape成输入的<code class="docutils literal notranslate"><span class="pre">shape</span></code>。</p>
<p><code class="docutils literal notranslate"><span class="pre">expand_as</span></code>：将<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>按照广播规则扩展成与另一个<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>相同的<code class="docutils literal notranslate"><span class="pre">shape</span></code>。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]]))</span>
<span class="n">x_shape</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span>
<span class="n">x_dtype</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">dtype</span>
<span class="n">x_all</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="n">x_any</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
<span class="n">x_view</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="n">y_as_z</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">expand_as</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</pre></div>
</div>
<p>结果如下:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>x_shape: (2, 3)
x_dtype: Bool
x_all: Tensor(shape=[], dtype=Bool, value=False)
x_any: Tensor(shape=[], dtype=Bool, value=True)
x_view: Tensor(shape=[1, 6], dtype=Bool, value=[[True, False, True, False, True, False]])

y_as_z: Tensor(shape=[2, 2, 3], dtype=Float32, value=[[[1.0, 1.0, 1.0], [1.0, 1.0, 1.0]], [[1.0, 1.0, 1.0], [1.0, 1.0, 1.0]]])
</pre></div>
</div>
</li>
<li><p>索引取值</p>
<p>索引值支持<code class="docutils literal notranslate"><span class="pre">int</span></code>、<code class="docutils literal notranslate"><span class="pre">True</span></code>、<code class="docutils literal notranslate"><span class="pre">None</span></code>、<code class="docutils literal notranslate"><span class="pre">slice</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">int</span></code>索引取值</p>
<p>支持单层和多层<code class="docutils literal notranslate"><span class="pre">int</span></code>索引取值，单层<code class="docutils literal notranslate"><span class="pre">int</span></code>索引取值：<code class="docutils literal notranslate"><span class="pre">tensor_x[int_index]</span></code>，多层<code class="docutils literal notranslate"><span class="pre">int</span></code>索引取值：<code class="docutils literal notranslate"><span class="pre">tensor_x[int_index0][int_index1]...</span></code>。</p>
<p><code class="docutils literal notranslate"><span class="pre">int</span></code>索引取值操作的是第0维，索引值小于第0维长度，在取出第0维对应位置数据后，会消除第0维。</p>
<p>例如，如果对一个<code class="docutils literal notranslate"><span class="pre">shape</span></code>为<code class="docutils literal notranslate"><span class="pre">(3,</span> <span class="pre">4,</span> <span class="pre">5)</span></code>的tensor进行单层<code class="docutils literal notranslate"><span class="pre">int</span></code>索引取值，取得结果的<code class="docutils literal notranslate"><span class="pre">shape</span></code>是<code class="docutils literal notranslate"><span class="pre">(4,</span> <span class="pre">5)</span></code>。</p>
<p>多层索引取值可以理解为，后一层索引取值在前一层索引取值结果上再进行<code class="docutils literal notranslate"><span class="pre">int</span></code>索引取值。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tensor_x</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
<span class="n">data_single</span> <span class="o">=</span> <span class="n">tensor_x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">data_multi</span> <span class="o">=</span> <span class="n">tensor_x</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>data_single: Tensor(shape=[3, 2], dtype=Int64, value=[[0, 1], [2, 3], [4, 5]])
data_multi: Tensor(shape=[2], dtype=Int64, value=[2, 3])
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">True</span></code>索引取值</p>
<p>支持单层和多层<code class="docutils literal notranslate"><span class="pre">True</span></code>索引取值，单层<code class="docutils literal notranslate"><span class="pre">True</span></code>索引取值：<code class="docutils literal notranslate"><span class="pre">tensor_x[True]</span></code>，多层<code class="docutils literal notranslate"><span class="pre">True</span></code>索引取值：<code class="docutils literal notranslate"><span class="pre">tensor_x[True][True]...</span></code>。</p>
<p><code class="docutils literal notranslate"><span class="pre">True</span></code>索引取值操作的是第0维，在取出所有数据后，会在<code class="docutils literal notranslate"><span class="pre">axis=0</span></code>轴上扩展一维，该维长度为1。</p>
<p>例如，对一个<code class="docutils literal notranslate"><span class="pre">shape</span></code>为<code class="docutils literal notranslate"><span class="pre">(3,</span> <span class="pre">4,</span> <span class="pre">5)</span></code>的tensor进行单层<code class="docutils literal notranslate"><span class="pre">True</span></code>索引取值，取得结果的<code class="docutils literal notranslate"><span class="pre">shape</span></code>是<code class="docutils literal notranslate"><span class="pre">(1,</span> <span class="pre">3,</span> <span class="pre">4,</span> <span class="pre">5)</span></code>。</p>
<p>多层索引取值可以理解为，后一层索引取值在前一层索引取值结果上再进行<code class="docutils literal notranslate"><span class="pre">True</span></code>索引取值。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tensor_x</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">3</span> <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="n">data_single</span> <span class="o">=</span> <span class="n">tensor_x</span><span class="p">[</span><span class="kc">True</span><span class="p">]</span>
<span class="n">data_multi</span> <span class="o">=</span> <span class="n">tensor_x</span><span class="p">[</span><span class="kc">True</span><span class="p">][</span><span class="kc">True</span><span class="p">]</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>data_single: Tensor(shape=[1, 2, 3], dtype=Int64, value=[[[0, 1, 2], [3, 4, 5]]])
data_multi: Tensor(shape=[1, 1, 2, 3], dtype=Int64, value=[[[[0, 1, 2], [3, 4, 5]]]])
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">None</span></code>索引取值</p>
<p><code class="docutils literal notranslate"><span class="pre">None</span></code>索引取值和<code class="docutils literal notranslate"><span class="pre">True</span></code>索引取值一致，可参考<code class="docutils literal notranslate"><span class="pre">True</span></code>索引取值，这里不再赘述。</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ellipsis</span></code>索引取值</p>
<p>支持单层和多层<code class="docutils literal notranslate"><span class="pre">ellipsis</span></code>索引取值，单层<code class="docutils literal notranslate"><span class="pre">ellipsis</span></code>索引取值：<code class="docutils literal notranslate"><span class="pre">tensor_x[...]</span></code>，多层<code class="docutils literal notranslate"><span class="pre">ellipsis</span></code>索引取值：<code class="docutils literal notranslate"><span class="pre">tensor_x[...][...]...</span></code>。</p>
<p><code class="docutils literal notranslate"><span class="pre">ellipsis</span></code>索引取值操作的是所有维度，原样不动取出所有数据。一般多作为<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>索引的组成元素，<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>索引将于下面介绍。</p>
<p>例如，对一个<code class="docutils literal notranslate"><span class="pre">shape</span></code>为<code class="docutils literal notranslate"><span class="pre">(3,</span> <span class="pre">4,</span> <span class="pre">5)</span></code>的tensor进行<code class="docutils literal notranslate"><span class="pre">ellipsis</span></code>索引取值，取得结果的<code class="docutils literal notranslate"><span class="pre">shape</span></code>依然是<code class="docutils literal notranslate"><span class="pre">(3,</span> <span class="pre">4,</span> <span class="pre">5)</span></code>。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tensor_x</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">3</span> <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="n">data_single</span> <span class="o">=</span> <span class="n">tensor_x</span><span class="p">[</span><span class="o">...</span><span class="p">]</span>
<span class="n">data_multi</span> <span class="o">=</span> <span class="n">tensor_x</span><span class="p">[</span><span class="o">...</span><span class="p">][</span><span class="o">...</span><span class="p">]</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>data_single: Tensor(shape=[2, 3], dtype=Int64, value=[[0, 1, 2], [3, 4, 5]])
data_multi: Tensor(shape=[2, 3], dtype=Int64, value=[[0, 1, 2], [3, 4, 5]])
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">slice</span></code>索引取值</p>
<p>支持单层和多层<code class="docutils literal notranslate"><span class="pre">slice</span></code>索引取值，单层<code class="docutils literal notranslate"><span class="pre">slice</span></code>索引取值：<code class="docutils literal notranslate"><span class="pre">tensor_x[slice_index]</span></code>，多层<code class="docutils literal notranslate"><span class="pre">slice</span></code>索引取值：<code class="docutils literal notranslate"><span class="pre">tensor_x[slice_index0][slice_index1]...</span></code>。</p>
<p><code class="docutils literal notranslate"><span class="pre">slice</span></code>索引取值操作的是第0维，取出第0维所切到位置的元素，<code class="docutils literal notranslate"><span class="pre">slice</span></code>不会降维，即使切到长度为1，区别于<code class="docutils literal notranslate"><span class="pre">int</span></code>索引取值。</p>
<p>例如，<code class="docutils literal notranslate"><span class="pre">tensor_x[0:1:1]</span> <span class="pre">!=</span> <span class="pre">tensor_x[0]</span></code>，因为<code class="docutils literal notranslate"><span class="pre">shape_former</span> <span class="pre">=</span> <span class="pre">(1,)</span> <span class="pre">+</span> <span class="pre">shape_latter</span></code>。</p>
<p>多层索引取值可以理解为，后一层索引取值在前一层索引取值结果上再进行<code class="docutils literal notranslate"><span class="pre">slice</span></code>索引取值。</p>
<p><code class="docutils literal notranslate"><span class="pre">slice</span></code>有<code class="docutils literal notranslate"><span class="pre">start</span></code>、<code class="docutils literal notranslate"><span class="pre">stop</span></code>和<code class="docutils literal notranslate"><span class="pre">step</span></code>组成。<code class="docutils literal notranslate"><span class="pre">start</span></code>默认值为0，<code class="docutils literal notranslate"><span class="pre">stop</span></code>默认值为该维长度，<code class="docutils literal notranslate"><span class="pre">step</span></code>默认值为1。</p>
<p>例如，<code class="docutils literal notranslate"><span class="pre">tensor_x[:]</span> <span class="pre">==</span> <span class="pre">tensor_x[0:length:1]</span></code>。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tensor_x</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
<span class="n">data_single</span> <span class="o">=</span> <span class="n">tensor_x</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<span class="n">data_multi</span> <span class="o">=</span> <span class="n">tensor_x</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">:</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>data_single: Tensor(shape=[2, 2, 2], dtype=Int64, value=[[[4, 5], [6, 7]], [[12, 13], [14, 15]]])
data_multi: Tensor(shape=[1, 2, 2], dtype=Int64, value=[[[12, 13], [14, 15]]])
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Tensor</span></code>索引取值</p>
<p>支持单层和多层<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>索引取值，单层<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>索引取值：<code class="docutils literal notranslate"><span class="pre">tensor_x[tensor_index]</span></code>，多层<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>索引取值：<code class="docutils literal notranslate"><span class="pre">tensor_x[tensor_index0][tensor_index1]...</span></code>。</p>
<p><code class="docutils literal notranslate"><span class="pre">Tensor</span></code>索引取值操作的是第0维，取出第0维对应位置的元素。</p>
<p>索引<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>数据类型必须是int32，元素不能是负数，值小于第0维长度。</p>
<p><code class="docutils literal notranslate"><span class="pre">Tensor</span></code>索引取值得到结果的<code class="docutils literal notranslate"><span class="pre">data_shape</span> <span class="pre">=</span> <span class="pre">tensor_index.shape</span> <span class="pre">+</span> <span class="pre">tensor_x.shape[1:]</span></code>。</p>
<p>例如，对一个<code class="docutils literal notranslate"><span class="pre">shape</span></code>为<code class="docutils literal notranslate"><span class="pre">(6,</span> <span class="pre">4,</span> <span class="pre">5)</span></code>的tensor通过<code class="docutils literal notranslate"><span class="pre">shape</span></code>为<code class="docutils literal notranslate"><span class="pre">(2,</span> <span class="pre">3)</span></code>的tensor进行索引取值，取得结果的<code class="docutils literal notranslate"><span class="pre">shape</span></code>为<code class="docutils literal notranslate"><span class="pre">(2,</span> <span class="pre">3,</span> <span class="pre">4,</span> <span class="pre">5)</span></code>。</p>
<p>多层索引取值可以理解为，后一层索引取值在前一层索引取值结果上再进行<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>索引取值。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tensor_x</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="n">tensor_index0</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]),</span> <span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<span class="n">tensor_index1</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]),</span> <span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<span class="n">data_single</span> <span class="o">=</span> <span class="n">tensor_x</span><span class="p">[</span><span class="n">tensor_index0</span><span class="p">]</span>
<span class="n">data_multi</span> <span class="o">=</span> <span class="n">tensor_x</span><span class="p">[</span><span class="n">tensor_index0</span><span class="p">][</span><span class="n">tensor_index1</span><span class="p">]</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>data_single: Tensor(shape=[2, 2, 2, 3], dtype=Int64, value=[[[[4, 5], [6, 7]], [[8, 9], [10, 11]]], [[[0, 1], [2, 3]], [[12, 13], [14, 15]]]])
data_multi: Tensor(shape=[1, 2, 2, 2, 3], dtype=Int64, value=[[[[[4, 5], [6, 7]], [[8, 9], [10, 11]]], [[[4, 5], [6, 7]], [[8, 9], [10, 11]]]]])
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Tuple</span></code>索引取值</p>
<p>索引<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>的数据类型必须是int32，支持单层和多层<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>索引取值，单层<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>索引取值：<code class="docutils literal notranslate"><span class="pre">tensor_x[tuple_index]</span></code>，多层<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>索引取值：<code class="docutils literal notranslate"><span class="pre">tensor_x[tuple_index0][tuple_index1]...</span></code>。</p>
<p><code class="docutils literal notranslate"><span class="pre">Tuple</span></code>索引里的元素可以包含<code class="docutils literal notranslate"><span class="pre">int</span></code>、<code class="docutils literal notranslate"><span class="pre">slice</span></code>、<code class="docutils literal notranslate"><span class="pre">ellipsis</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。</p>
<p>索引里除<code class="docutils literal notranslate"><span class="pre">ellipsis</span></code>外每个元素操作对应位置维度，即<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>中第0个元素操作第0维，第1个元素操作第1维，以此类推，每个元素的索引规则与该元素类型索引取值规则一致。</p>
<p><code class="docutils literal notranslate"><span class="pre">Tuple</span></code>索引里最多只有一个<code class="docutils literal notranslate"><span class="pre">ellipsis</span></code>，<code class="docutils literal notranslate"><span class="pre">ellipsis</span></code>前半部分索引元素从前往后对应<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>第0维往后，后半部分索引元素从后往前对应<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>最后一维往前，其他未指定的维度，代表全取。</p>
<p>元素里包含的<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>数据类型必须是int32，且<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>元素不能是负数，值小于操作维度长度。</p>
<p>例如，<code class="docutils literal notranslate"><span class="pre">tensor_x[0:3,</span> <span class="pre">1,</span> <span class="pre">tensor_index]</span> <span class="pre">==</span> <span class="pre">tensor_x[(0:3,</span> <span class="pre">1,</span> <span class="pre">tensor_index)]</span></code>，因为<code class="docutils literal notranslate"><span class="pre">0:3,</span> <span class="pre">1,</span> <span class="pre">tensor_index</span></code>就是一个<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>。</p>
<p>多层索引取值可以理解为，后一层索引取值在前一层索引取值结果上再进行<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>索引取值。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tensor_x</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)))</span>
<span class="n">tensor_index</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]),</span> <span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">tensor_x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="n">tensor_index</span><span class="p">]</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>data: Tensor(shape=[2, 3, 1], dtype=Int64, value=[[[13], [14], [13]], [[12], [15], [14]]])
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>索引赋值</p>
<p>索引值支持<code class="docutils literal notranslate"><span class="pre">int</span></code>、<code class="docutils literal notranslate"><span class="pre">ellipsis</span></code>、<code class="docutils literal notranslate"><span class="pre">slice</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>。</p>
<p>索引赋值可以理解为对索引到的位置元素按照一定规则进行赋值，所有索引赋值都不会改变原<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>的<code class="docutils literal notranslate"><span class="pre">shape</span></code>。</p>
<p>同时支持增强索引赋值，即支持<code class="docutils literal notranslate"><span class="pre">+=</span></code>、<code class="docutils literal notranslate"><span class="pre">-=</span></code>、<code class="docutils literal notranslate"><span class="pre">*=</span></code>、<code class="docutils literal notranslate"><span class="pre">/=</span></code>、<code class="docutils literal notranslate"><span class="pre">%=</span></code>、<code class="docutils literal notranslate"><span class="pre">**=</span></code>、<code class="docutils literal notranslate"><span class="pre">//=</span></code>。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">int</span></code>索引赋值</p>
<p>支持单层和多层<code class="docutils literal notranslate"><span class="pre">int</span></code>索引赋值，单层<code class="docutils literal notranslate"><span class="pre">int</span></code>索引赋值：<code class="docutils literal notranslate"><span class="pre">tensor_x[int_index]</span> <span class="pre">=</span> <span class="pre">u</span></code>，多层<code class="docutils literal notranslate"><span class="pre">int</span></code>索引赋值：<code class="docutils literal notranslate"><span class="pre">tensor_x[int_index0][int_index1]...</span> <span class="pre">=</span> <span class="pre">u</span></code>。</p>
<p>所赋值支持<code class="docutils literal notranslate"><span class="pre">Number</span></code>和<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，<code class="docutils literal notranslate"><span class="pre">Number</span></code>和<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>都会被转为与被更新<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>数据类型一致。</p>
<p>当所赋值为<code class="docutils literal notranslate"><span class="pre">Number</span></code>时，可以理解为将<code class="docutils literal notranslate"><span class="pre">int</span></code>索引取到位置元素都更新为<code class="docutils literal notranslate"><span class="pre">Number</span></code>。</p>
<p>当所赋值为<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>时，<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>的<code class="docutils literal notranslate"><span class="pre">shape</span></code>必须等于或者可广播为<code class="docutils literal notranslate"><span class="pre">int</span></code>索引取到结果的<code class="docutils literal notranslate"><span class="pre">shape</span></code>，在保持二者<code class="docutils literal notranslate"><span class="pre">shape</span></code>一致后，然后将赋值<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>元素更新到索引取出结果对应元素的原<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>位置。</p>
<p>例如，对<code class="docutils literal notranslate"><span class="pre">shape</span> <span class="pre">=</span> <span class="pre">(2,</span> <span class="pre">3,</span> <span class="pre">4)</span></code>的<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，通过<code class="docutils literal notranslate"><span class="pre">int</span></code>索引1赋值为100，更新后的<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>shape仍为<code class="docutils literal notranslate"><span class="pre">(2,</span> <span class="pre">3,</span> <span class="pre">4)</span></code>，但第0维位置为1的所有元素，值都更新为100。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tensor_x</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="n">tensor_y</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="n">tensor_z</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="n">tensor_x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">88.0</span>
<span class="n">tensor_y</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">88.0</span>
<span class="n">tensor_z</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">66</span><span class="p">,</span> <span class="mi">88</span><span class="p">,</span> <span class="mi">99</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>tensor_x: Tensor(shape=[2, 3], dtype=Float32, value=[[0.0, 1.0, 2.0], [88.0, 88.0, 88.0]])
tensor_y: Tensor(shape=[2, 3], dtype=Float32, value=[[0.0, 1.0, 2.0], [3.0, 88.0, 5.0]])
tensor_z: Tensor(shape=[2, 3], dtype=Float32, value=[[0.0, 1.0, 2.0], [66.0, 88.0, 99.0]])
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ellipsis</span></code>索引赋值</p>
<p>支持单层和多层<code class="docutils literal notranslate"><span class="pre">ellipsis</span></code>索引赋值，单层<code class="docutils literal notranslate"><span class="pre">ellipsis</span></code>索引赋值：<code class="docutils literal notranslate"><span class="pre">tensor_x[...]</span> <span class="pre">=</span> <span class="pre">u</span></code>，多层<code class="docutils literal notranslate"><span class="pre">ellipsis</span></code>索引赋值：<code class="docutils literal notranslate"><span class="pre">tensor_x[...][...]...</span> <span class="pre">=</span> <span class="pre">u</span></code>。</p>
<p>所赋值支持<code class="docutils literal notranslate"><span class="pre">Number</span></code>和<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，<code class="docutils literal notranslate"><span class="pre">Number</span></code>和<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>里的值都会转为与被更新<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>数据类型一致。</p>
<p>当所赋值为<code class="docutils literal notranslate"><span class="pre">Number</span></code>时，可以理解为将所有元素都更新为<code class="docutils literal notranslate"><span class="pre">Number</span></code>。</p>
<p>当所赋值为<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>时，<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>里元素个数必须为1或者等于原<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>里元素个数，元素为1时进行广播，个数相等<code class="docutils literal notranslate"><span class="pre">shape</span></code>不一致时进行<code class="docutils literal notranslate"><span class="pre">reshape</span></code>，
在保证二者<code class="docutils literal notranslate"><span class="pre">shape</span></code>一致后，将赋值<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>元素按照位置逐一更新到原<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>里。</p>
<p>例如，对<code class="docutils literal notranslate"><span class="pre">shape</span> <span class="pre">=</span> <span class="pre">(2,</span> <span class="pre">3,</span> <span class="pre">4)</span></code>的<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，通过<code class="docutils literal notranslate"><span class="pre">...</span></code>索引赋值为100，更新后的<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>shape仍为<code class="docutils literal notranslate"><span class="pre">(2,</span> <span class="pre">3,</span> <span class="pre">4)</span></code>，所有元素都变为100。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tensor_x</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="n">tensor_y</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="n">tensor_z</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="n">tensor_x</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="mf">88.0</span>
<span class="n">tensor_y</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">22</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">55</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>tensor_x: Tensor(shape=[2, 3], dtype=Float32, value=[[88.0, 88.0, 88.0], [88.0, 88.0, 88.0]])
tensor_y: Tensor(shape=[2, 3], dtype=Float32, value=[[22.0, 44.0, 55.0], [22.0, 44.0, 55.0]])
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">slice</span></code>索引赋值</p>
<p>支持单层和多层<code class="docutils literal notranslate"><span class="pre">slice</span></code>索引赋值，单层<code class="docutils literal notranslate"><span class="pre">slice</span></code>索引赋值：<code class="docutils literal notranslate"><span class="pre">tensor_x[slice_index]</span> <span class="pre">=</span> <span class="pre">u</span></code>，多层<code class="docutils literal notranslate"><span class="pre">slice</span></code>索引赋值：<code class="docutils literal notranslate"><span class="pre">tensor_x[slice_index0][slice_index1]...</span> <span class="pre">=</span> <span class="pre">u</span></code>。</p>
<p>所赋值支持<code class="docutils literal notranslate"><span class="pre">Number</span></code>和<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，<code class="docutils literal notranslate"><span class="pre">Number</span></code>和<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>里的值都会转为与被更新<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>数据类型一致。</p>
<p>当所赋值为<code class="docutils literal notranslate"><span class="pre">Number</span></code>时，可以理解为将<code class="docutils literal notranslate"><span class="pre">slice</span></code>索引取到位置元素都更新为<code class="docutils literal notranslate"><span class="pre">Number</span></code>。</p>
<p>当所赋值为<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>时，<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>里元素个数必须为1或者等于<code class="docutils literal notranslate"><span class="pre">slice</span></code>索引取到<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>里元素个数，元素为1时进行广播，个数相等<code class="docutils literal notranslate"><span class="pre">shape</span></code>不一致时进行<code class="docutils literal notranslate"><span class="pre">reshape</span></code>，
在保证二者<code class="docutils literal notranslate"><span class="pre">shape</span></code>一致后，将赋值<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>元素按照位置逐一更新到原<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>里。</p>
<p>例如，对<code class="docutils literal notranslate"><span class="pre">shape</span> <span class="pre">=</span> <span class="pre">(2,</span> <span class="pre">3,</span> <span class="pre">4)</span></code>的<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，通过<code class="docutils literal notranslate"><span class="pre">0:1:1</span></code>索引赋值为100，更新后的<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>shape仍为<code class="docutils literal notranslate"><span class="pre">(2,</span> <span class="pre">3,</span> <span class="pre">4)</span></code>，但第0维位置为0的所有元素，值都更新为100。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tensor_x</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="n">tensor_y</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="n">tensor_z</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="n">tensor_x</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">88.0</span>
<span class="n">tensor_y</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">88.0</span>
<span class="n">tensor_z</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>tensor_x: Tensor(shape=[3, 3], dtype=Float32, value=[[88.0, 88.0, 88.0], [3.0, 4.0, 5.0], [6.0, 7.0, 8.0]])
tensor_y: Tensor(shape=[3, 3], dtype=Float32, value=[[88.0, 88.0, 88.0], [88.0, 88.0, 88.0], [6.0, 7.0, 8.0]])
tensor_z: Tensor(shape=[3, 3], dtype=Float32, value=[[11.0, 12.0, 13.0], [11.0, 12.0, 13.0], [6.0, 7.0, 8.0]])
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Tensor</span></code>索引赋值</p>
<p>仅支持单层<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>索引赋值，即<code class="docutils literal notranslate"><span class="pre">tensor_x[tensor_index]</span> <span class="pre">=</span> <span class="pre">u</span></code>。</p>
<p>索引<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>支持<code class="docutils literal notranslate"><span class="pre">int32</span></code>和<code class="docutils literal notranslate"><span class="pre">bool</span></code>类型。</p>
<p>所赋值支持<code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>和<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，<code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>和<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>里的值必须与原<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>数据类型一致。</p>
<p>当所赋值为<code class="docutils literal notranslate"><span class="pre">Number</span></code>时，可以理解为将<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>索引取到位置元素都更新为<code class="docutils literal notranslate"><span class="pre">Number</span></code>。</p>
<p>当所赋值为<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>时，<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>的<code class="docutils literal notranslate"><span class="pre">shape</span></code>必须等于或者可广播为索引取到结果的<code class="docutils literal notranslate"><span class="pre">shape</span></code>，在保持二者<code class="docutils literal notranslate"><span class="pre">shape</span></code>一致后，然后将赋值<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>元素更新到索引取出结果对应元素的原<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>位置。</p>
<p>当所赋值为<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>时，<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>里元素只能全是<code class="docutils literal notranslate"><span class="pre">Number</span></code>或者全是<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。</p>
<p>当全是<code class="docutils literal notranslate"><span class="pre">Number</span></code>时，<code class="docutils literal notranslate"><span class="pre">Number</span></code>的类型必须与原<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>数据类型是一类，且元素的个数必须等于索引取到结果<code class="docutils literal notranslate"><span class="pre">shape</span></code>的最后一维，然后广播为索引取到结果<code class="docutils literal notranslate"><span class="pre">shape</span></code>；</p>
<p>当全是<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>的时候，这些<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>在<code class="docutils literal notranslate"><span class="pre">axis=0</span></code>轴上打包之后成为一个新的赋值<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，这时按照所赋值为<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>的规则进行赋值。</p>
<p>例如，对一个<code class="docutils literal notranslate"><span class="pre">shape</span></code>为<code class="docutils literal notranslate"><span class="pre">(6,</span> <span class="pre">4,</span> <span class="pre">5)</span></code>、<code class="docutils literal notranslate"><span class="pre">dtype</span></code>为<code class="docutils literal notranslate"><span class="pre">float32</span></code>的tensor通过<code class="docutils literal notranslate"><span class="pre">shape</span></code>为<code class="docutils literal notranslate"><span class="pre">(2,</span> <span class="pre">3)</span></code>的tensor进行索引赋值，如果所赋值为<code class="docutils literal notranslate"><span class="pre">Number</span></code>，则<code class="docutils literal notranslate"><span class="pre">Number</span></code>必须是<code class="docutils literal notranslate"><span class="pre">float</span></code>；
如果所赋值为<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>，则<code class="docutils literal notranslate"><span class="pre">tuple</span></code>里的元素都得是<code class="docutils literal notranslate"><span class="pre">float</span></code>，且个数为5；如果所赋值为<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，则<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>的<code class="docutils literal notranslate"><span class="pre">dtype</span></code>必须为<code class="docutils literal notranslate"><span class="pre">float32</span></code>，且<code class="docutils literal notranslate"><span class="pre">shape</span></code>可广播为<code class="docutils literal notranslate"><span class="pre">(2,</span> <span class="pre">3,</span> <span class="pre">4,</span> <span class="pre">5)</span></code>。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tensor_x</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="n">tensor_y</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="n">tensor_index</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">))</span>
<span class="n">tensor_x</span><span class="p">[</span><span class="n">tensor_index</span><span class="p">]</span> <span class="o">=</span> <span class="mf">88.0</span>
<span class="n">tensor_y</span><span class="p">[</span><span class="n">tensor_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">11.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">13.0</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>tensor_x: Tensor(shape=[3, 3], dtype=Float32, value=[[88.0, 88.0, 88.0], [3.0, 4.0, 5.0], [88.0, 88.0, 88.0]])
tensor_y: Tensor(shape=[3, 3], dtype=Float32, value=[[11.0, 12.0, 13.0], [3.0, 4.0, 5.0], [11.0, 12.0, 13.0]])
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Tuple</span></code>索引赋值</p>
<p>支持单层和多层<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>索引赋值，单层<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>索引赋值：<code class="docutils literal notranslate"><span class="pre">tensor_x[tuple_index]</span> <span class="pre">=</span> <span class="pre">u</span></code>，多层<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>索引赋值：<code class="docutils literal notranslate"><span class="pre">tensor_x[tuple_index0][tuple_index1]...</span> <span class="pre">=</span> <span class="pre">u</span></code>。</p>
<p><code class="docutils literal notranslate"><span class="pre">Tuple</span></code>索引赋值和<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>索引取值对索引的支持一致, 但多层<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>索引赋值不支持<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>里包含<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。</p>
<p>所赋值支持<code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>和<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，<code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>和<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>里的值必须与原<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>数据类型一致。</p>
<p>当所赋值为<code class="docutils literal notranslate"><span class="pre">Number</span></code>时，可以理解为将<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>索引取到位置元素都更新为<code class="docutils literal notranslate"><span class="pre">Number</span></code>。</p>
<p>当所赋值为<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>时，<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>的<code class="docutils literal notranslate"><span class="pre">shape</span></code>必须等于或者可广播为索引取到结果的<code class="docutils literal notranslate"><span class="pre">shape</span></code>，在保持二者<code class="docutils literal notranslate"><span class="pre">shape</span></code>一致后，然后将赋值<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>元素更新到索引取出结果对应元素的原<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>位置。</p>
<p>当所赋值为<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>时，<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>里元素只能全是<code class="docutils literal notranslate"><span class="pre">Number</span></code>或者全是<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。</p>
<p>当全是<code class="docutils literal notranslate"><span class="pre">Number</span></code>时，<code class="docutils literal notranslate"><span class="pre">Number</span></code>的类型必须与原<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>数据类型是一类，且元素的个数必须等于索引取到结果<code class="docutils literal notranslate"><span class="pre">shape</span></code>的最后一维，然后广播为索引取到结果<code class="docutils literal notranslate"><span class="pre">shape</span></code>；</p>
<p>当全是<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>的时候，这些<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>在<code class="docutils literal notranslate"><span class="pre">axis=0</span></code>轴上打包之后成为一个新的赋值<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，这时按照所赋值为<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>的规则进行赋值。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tensor_x</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="n">tensor_y</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="n">tensor_z</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="n">tensor_index</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">))</span>
<span class="n">tensor_x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mf">88.0</span>
<span class="n">tensor_y</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="n">tensor_index</span><span class="p">]</span> <span class="o">=</span> <span class="mf">88.0</span>
<span class="n">tensor_z</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="n">tensor_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>tensor_x: Tensor(shape=[3, 3], dtype=Float32, value=[[0.0, 1.0, 2.0], [3.0, 88.0, 88.0], [6.0, 7.0, 8.0]])
tensor_y: Tensor(shape=[3, 3], dtype=Float32, value=[[0.0, 1.0, 2.0], [88.0, 88.0, 5.0], [88.0, 88.0, 8.0]])
tensor_z: Tensor(shape=[3, 3], dtype=Float32, value=[[0.0, 1.0, 2.0], [12.0, 11.0, 5.0], [12.0, 11.0, 8.0]])
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</section>
<section id="primitive">
<h4>Primitive<a class="headerlink" href="#primitive" title="Permalink to this headline"></a></h4>
<p>当前支持在网络里构造<code class="docutils literal notranslate"><span class="pre">Primitive</span></code>及其子类的实例，即支持语法<code class="docutils literal notranslate"><span class="pre">reduce_sum</span> <span class="pre">=</span> <span class="pre">ReduceSum(True)</span></code>。</p>
<p>但在构造时，参数只能通过位置参数方式传入，不支持通过键值对方式传入，即不支持语法<code class="docutils literal notranslate"><span class="pre">reduce_sum</span> <span class="pre">=</span> <span class="pre">ReduceSum(keep_dims=True)</span></code>。</p>
<p>当前不支持在网络调用<code class="docutils literal notranslate"><span class="pre">Primitive</span></code>及其子类相关属性和接口。</p>
<p><code class="docutils literal notranslate"><span class="pre">Primitive</span></code>定义可参考文档：<a class="reference external" href="https://www.mindspore.cn/doc/programming_guide/zh-CN/r1.1/operators.html">https://www.mindspore.cn/doc/programming_guide/zh-CN/r1.1/operators.html</a></p>
<p>当前已定义的<code class="docutils literal notranslate"><span class="pre">Primitive</span></code>可参考文档：<a class="reference external" href="https://www.mindspore.cn/doc/api_python/zh-CN/r1.1/mindspore/mindspore.ops.html">https://www.mindspore.cn/doc/api_python/zh-CN/r1.1/mindspore/mindspore.ops.html</a></p>
</section>
<section id="cell">
<h4>Cell<a class="headerlink" href="#cell" title="Permalink to this headline"></a></h4>
<p>当前支持在网络里构造<code class="docutils literal notranslate"><span class="pre">Cell</span></code>及其子类的实例，即支持语法<code class="docutils literal notranslate"><span class="pre">cell</span> <span class="pre">=</span> <span class="pre">Cell(args...)</span></code>。</p>
<p>但在构造时，参数只能通过位置参数方式传入，不支持通过键值对方式传入，即不支持在语法<code class="docutils literal notranslate"><span class="pre">cell</span> <span class="pre">=</span> <span class="pre">Cell(arg_name=value)</span></code>。</p>
<p>当前不支持在网络调用<code class="docutils literal notranslate"><span class="pre">Cell</span></code>及其子类相关属性和接口，除非是在<code class="docutils literal notranslate"><span class="pre">Cell</span></code>自己的<code class="docutils literal notranslate"><span class="pre">contrcut</span></code>中通过<code class="docutils literal notranslate"><span class="pre">self</span></code>调用。</p>
<p><code class="docutils literal notranslate"><span class="pre">Cell</span></code>定义可参考文档：<a class="reference external" href="https://www.mindspore.cn/doc/programming_guide/zh-CN/r1.1/cell.html">https://www.mindspore.cn/doc/programming_guide/zh-CN/r1.1/cell.html</a></p>
<p>当前已定义的<code class="docutils literal notranslate"><span class="pre">Cell</span></code>可参考文档：<a class="reference external" href="https://www.mindspore.cn/doc/api_python/zh-CN/r1.1/mindspore/mindspore.nn.html">https://www.mindspore.cn/doc/api_python/zh-CN/r1.1/mindspore/mindspore.nn.html</a></p>
</section>
</section>
</section>
<section id="id4">
<h2>运算符<a class="headerlink" href="#id4" title="Permalink to this headline"></a></h2>
<p>算术运算符和赋值运算符支持<code class="docutils literal notranslate"><span class="pre">Number</span></code>和<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>运算，也支持不同<code class="docutils literal notranslate"><span class="pre">dtype</span></code>的<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>运算。</p>
<p>之所以支持，是因为这些运算符会转换成同名算子进行运算，这些算子支持了隐式类型转换。</p>
<p>规则可参考文档：<a class="reference external" href="https://www.mindspore.cn/doc/note/zh-CN/r1.1/operator_list_implicit.html">https://www.mindspore.cn/doc/note/zh-CN/r1.1/operator_list_implicit.html</a></p>
<section id="id5">
<h3>算术运算符<a class="headerlink" href="#id5" title="Permalink to this headline"></a></h3>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="text-left head"><p>算术运算符</p></th>
<th class="text-left head"><p>支持类型</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">+</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code> + <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> + <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> + <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code> + <code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">String</span></code> + <code class="docutils literal notranslate"><span class="pre">String</span></code>。</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">-</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code> - <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> - <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> - <code class="docutils literal notranslate"><span class="pre">Number</span></code>。</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">*</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code> * <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> * <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> * <code class="docutils literal notranslate"><span class="pre">Number</span></code>。</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">/</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code> / <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> / <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> / <code class="docutils literal notranslate"><span class="pre">Number</span></code>。</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">%</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code> % <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> % <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> % <code class="docutils literal notranslate"><span class="pre">Number</span></code>。</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">**</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code> ** <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> ** <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> ** <code class="docutils literal notranslate"><span class="pre">Number</span></code>。</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">//</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code> // <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> // <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> // <code class="docutils literal notranslate"><span class="pre">Number</span></code>。</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id6">
<h3>赋值运算符<a class="headerlink" href="#id6" title="Permalink to this headline"></a></h3>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="text-left head"><p>赋值运算符</p></th>
<th class="text-left head"><p>支持类型</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">=</span></code></p></td>
<td class="text-left"><p>标量、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">+=</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code> += <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> += <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> += <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code> += <code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">String</span></code> += <code class="docutils literal notranslate"><span class="pre">String</span></code>。</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">-=</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code> -= <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> -= <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> -= <code class="docutils literal notranslate"><span class="pre">Number</span></code>。</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">*=</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code> *= <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> *= <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> *= <code class="docutils literal notranslate"><span class="pre">Number</span></code>。</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">/=</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code> /= <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> /= <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> /= <code class="docutils literal notranslate"><span class="pre">Number</span></code>。</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">%=</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code> %= <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> %= <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> %= <code class="docutils literal notranslate"><span class="pre">Number</span></code>。</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">**=</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code> **= <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> **= <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> **= <code class="docutils literal notranslate"><span class="pre">Number</span></code>。</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">//=</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code> //= <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> //= <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> //= <code class="docutils literal notranslate"><span class="pre">Number</span></code>。</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id7">
<h3>逻辑运算符<a class="headerlink" href="#id7" title="Permalink to this headline"></a></h3>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="text-left head"><p>逻辑运算符</p></th>
<th class="text-left head"><p>支持类型</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">and</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code> and <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> and <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">or</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code> or <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> or<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">not</span></code></p></td>
<td class="text-left"><p>not <code class="docutils literal notranslate"><span class="pre">Number</span></code>、not <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、not <code class="docutils literal notranslate"><span class="pre">tuple</span></code>。</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id8">
<h3>成员运算符<a class="headerlink" href="#id8" title="Permalink to this headline"></a></h3>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="text-left head"><p>成员运算符</p></th>
<th class="text-left head"><p>支持类型</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">in</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code> in <code class="docutils literal notranslate"><span class="pre">tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">String</span></code> in <code class="docutils literal notranslate"><span class="pre">tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> in <code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">Number</span></code> in <code class="docutils literal notranslate"><span class="pre">List</span></code>、<code class="docutils literal notranslate"><span class="pre">String</span></code> in <code class="docutils literal notranslate"><span class="pre">List</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> in <code class="docutils literal notranslate"><span class="pre">List</span></code>、<code class="docutils literal notranslate"><span class="pre">String</span></code> in <code class="docutils literal notranslate"><span class="pre">Dictionary</span></code>。</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">not</span> <span class="pre">in</span></code></p></td>
<td class="text-left"><p>与<code class="docutils literal notranslate"><span class="pre">in</span></code>相同。</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id9">
<h3>身份运算符<a class="headerlink" href="#id9" title="Permalink to this headline"></a></h3>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="text-left head"><p>身份运算符</p></th>
<th class="text-left head"><p>支持类型</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">is</span></code></p></td>
<td class="text-left"><p>仅支持判断是<code class="docutils literal notranslate"><span class="pre">None</span></code>、 <code class="docutils literal notranslate"><span class="pre">True</span></code>或者<code class="docutils literal notranslate"><span class="pre">False</span></code>。</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">is</span> <span class="pre">not</span></code></p></td>
<td class="text-left"><p>仅支持判断不是<code class="docutils literal notranslate"><span class="pre">None</span></code>、 <code class="docutils literal notranslate"><span class="pre">True</span></code>或者<code class="docutils literal notranslate"><span class="pre">False</span></code>。</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="id10">
<h2>表达式<a class="headerlink" href="#id10" title="Permalink to this headline"></a></h2>
<section id="id11">
<h3>条件控制语句<a class="headerlink" href="#id11" title="Permalink to this headline"></a></h3>
<section id="if">
<h4>if<a class="headerlink" href="#if" title="Permalink to this headline"></a></h4>
<p>使用方式：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">(cond):</span> <span class="pre">statements...</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">y</span> <span class="pre">if</span> <span class="pre">(cond)</span> <span class="pre">else</span> <span class="pre">z</span></code></p></li>
</ul>
<p>参数：<code class="docutils literal notranslate"><span class="pre">cond</span></code> – 支持类型<code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code>、<code class="docutils literal notranslate"><span class="pre">String</span></code>、<code class="docutils literal notranslate"><span class="pre">None</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Function</span></code>，也可以是计算结果类型是其中之一的表达式。</p>
<p>限制：</p>
<ul class="simple">
<li><p>在构图时，如果<code class="docutils literal notranslate"><span class="pre">if</span></code>未能消除，则<code class="docutils literal notranslate"><span class="pre">if</span></code>分支<code class="docutils literal notranslate"><span class="pre">return</span></code>的数据类型和<code class="docutils literal notranslate"><span class="pre">shape</span></code>，与<code class="docutils literal notranslate"><span class="pre">if</span></code>分支外<code class="docutils literal notranslate"><span class="pre">return</span></code>的数据类型和<code class="docutils literal notranslate"><span class="pre">shape</span></code>必须一致。</p></li>
<li><p>当只有<code class="docutils literal notranslate"><span class="pre">if</span></code>时，<code class="docutils literal notranslate"><span class="pre">if</span></code>分支变量更新后数据类型和<code class="docutils literal notranslate"><span class="pre">shape</span></code>，与更新前数据类型和<code class="docutils literal notranslate"><span class="pre">shape</span></code>必须一致。</p></li>
<li><p>当即有<code class="docutils literal notranslate"><span class="pre">if</span></code>又有<code class="docutils literal notranslate"><span class="pre">else</span></code>时，<code class="docutils literal notranslate"><span class="pre">if</span></code>分支变量更新后数据类型和<code class="docutils literal notranslate"><span class="pre">shape</span></code>，与<code class="docutils literal notranslate"><span class="pre">else</span></code>分支更新后数据类型和<code class="docutils literal notranslate"><span class="pre">shape</span></code>必须一致。</p></li>
</ul>
<p>示例1：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">:</span>
  <span class="k">return</span> <span class="n">m</span>
<span class="k">else</span><span class="p">:</span>
  <span class="k">return</span> <span class="n">n</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">if</span></code>分支返回的<code class="docutils literal notranslate"><span class="pre">m</span></code>和<code class="docutils literal notranslate"><span class="pre">else</span></code>分支返回的<code class="docutils literal notranslate"><span class="pre">n</span></code>，二者数据类型和<code class="docutils literal notranslate"><span class="pre">shape</span></code>必须一致。</p>
<p>示例2：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">:</span>
  <span class="n">out</span> <span class="o">=</span> <span class="n">m</span>
<span class="k">else</span><span class="p">:</span>
  <span class="n">out</span> <span class="o">=</span> <span class="n">n</span>
<span class="k">return</span> <span class="n">out</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">if</span></code>分支更新后<code class="docutils literal notranslate"><span class="pre">out</span></code>和<code class="docutils literal notranslate"><span class="pre">else</span></code>分支更新后<code class="docutils literal notranslate"><span class="pre">out</span></code>，二者数据类型和<code class="docutils literal notranslate"><span class="pre">shape</span></code>必须一致。</p>
</section>
</section>
<section id="id12">
<h3>循环语句<a class="headerlink" href="#id12" title="Permalink to this headline"></a></h3>
<section id="for">
<h4>for<a class="headerlink" href="#for" title="Permalink to this headline"></a></h4>
<p>使用方式：<code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">i</span> <span class="pre">in</span> <span class="pre">sequence</span></code></p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">z</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
  <span class="n">z</span> <span class="o">+=</span> <span class="n">i</span>
<span class="k">return</span> <span class="n">z</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>z: Tensor(shape=[2, 3], dtype=Int64, value=[[7, 7], [7, 7], [7, 7]])
</pre></div>
</div>
<p>参数：<code class="docutils literal notranslate"><span class="pre">sequence</span></code> – 遍历序列(<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code>)</p>
</section>
<section id="while">
<h4>while<a class="headerlink" href="#while" title="Permalink to this headline"></a></h4>
<p>使用方式：<code class="docutils literal notranslate"><span class="pre">while(cond)</span></code></p>
<p>参数：<code class="docutils literal notranslate"><span class="pre">cond</span></code> – 与<code class="docutils literal notranslate"><span class="pre">if</span></code>一致。</p>
<p>限制：</p>
<ul class="simple">
<li><p>在构图时，如果<code class="docutils literal notranslate"><span class="pre">while</span></code>未能消除，则<code class="docutils literal notranslate"><span class="pre">while</span></code>内<code class="docutils literal notranslate"><span class="pre">return</span></code>的数据类型和<code class="docutils literal notranslate"><span class="pre">shape</span></code>，与<code class="docutils literal notranslate"><span class="pre">while</span></code>外<code class="docutils literal notranslate"><span class="pre">return</span></code>的数据类型和<code class="docutils literal notranslate"><span class="pre">shape</span></code>必须一致。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">while</span></code>内变量更新后数据类型和<code class="docutils literal notranslate"><span class="pre">shape</span></code>，与更新前数据类型和<code class="docutils literal notranslate"><span class="pre">shape</span></code>必须一致。</p></li>
</ul>
<p>示例1：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">:</span>
  <span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span>
  <span class="k">return</span> <span class="n">m</span>
<span class="k">return</span> <span class="n">n</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">while</span></code>内返回的<code class="docutils literal notranslate"><span class="pre">m</span></code>和<code class="docutils literal notranslate"><span class="pre">while</span></code>外返回的<code class="docutils literal notranslate"><span class="pre">n</span></code>数据类型必须和<code class="docutils literal notranslate"><span class="pre">shape</span></code>一致。</p>
<p>示例2：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">out</span> <span class="o">=</span> <span class="n">m</span>
<span class="k">while</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">:</span>
  <span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span>
  <span class="n">out</span> <span class="o">=</span> <span class="n">n</span>
<span class="k">return</span> <span class="n">out</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">while</span></code>内，<code class="docutils literal notranslate"><span class="pre">out</span></code>更新后和更新前的数据类型和<code class="docutils literal notranslate"><span class="pre">shape</span></code>必须一致。</p>
</section>
</section>
<section id="id13">
<h3>流程控制语句<a class="headerlink" href="#id13" title="Permalink to this headline"></a></h3>
<p>当前流程控制语句支持了<code class="docutils literal notranslate"><span class="pre">break</span></code>、<code class="docutils literal notranslate"><span class="pre">continue</span></code>和<code class="docutils literal notranslate"><span class="pre">pass</span></code>。</p>
<section id="break">
<h4>break<a class="headerlink" href="#break" title="Permalink to this headline"></a></h4>
<p>可用于<code class="docutils literal notranslate"><span class="pre">for</span></code>和<code class="docutils literal notranslate"><span class="pre">while</span></code>代码块里，用于终止整个循环。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
  <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
      <span class="k">break</span>
  <span class="n">statement_a</span>
<span class="n">statement_b</span>
</pre></div>
</div>
<p>当 <code class="docutils literal notranslate"><span class="pre">i</span> <span class="pre">==</span> <span class="pre">2</span></code>时，循环终止，执行<code class="docutils literal notranslate"><span class="pre">statement_b</span></code>。</p>
</section>
<section id="continue">
<h4>continue<a class="headerlink" href="#continue" title="Permalink to this headline"></a></h4>
<p>可用于<code class="docutils literal notranslate"><span class="pre">for</span></code>和<code class="docutils literal notranslate"><span class="pre">while</span></code>语句块里，用于终止本轮循环，直接进入下一轮循环。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
  <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
      <span class="k">continue</span>
  <span class="n">statement_a</span>
<span class="n">statement_b</span>
</pre></div>
</div>
<p>当 <code class="docutils literal notranslate"><span class="pre">i</span> <span class="pre">==</span> <span class="pre">2</span></code>时，本轮循环终止，不会往下执行<code class="docutils literal notranslate"><span class="pre">statement_a</span></code>，进入下一轮循环。</p>
</section>
<section id="pass">
<h4>pass<a class="headerlink" href="#pass" title="Permalink to this headline"></a></h4>
<p>不做任何事情，占位语句。</p>
</section>
</section>
<section id="id14">
<h3>函数定义语句<a class="headerlink" href="#id14" title="Permalink to this headline"></a></h3>
<section id="def">
<h4>def关键字<a class="headerlink" href="#def" title="Permalink to this headline"></a></h4>
<p>用于定义函数。</p>
<p>使用方式：</p>
<p><code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">function_name(args):</span> <span class="pre">statements...</span></code></p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">number_add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="n">ret</span> <span class="o">=</span> <span class="n">number_add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ret: 3
</pre></div>
</div>
</section>
<section id="lambda">
<h4>lambda表达式<a class="headerlink" href="#lambda" title="Permalink to this headline"></a></h4>
<p>用于生成函数。</p>
<p>使用方式：<code class="docutils literal notranslate"><span class="pre">lambda</span> <span class="pre">x,</span> <span class="pre">y:</span> <span class="pre">x</span> <span class="pre">+</span> <span class="pre">y</span></code></p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">number_add</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="n">ret</span> <span class="o">=</span> <span class="n">number_add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ret: 5
</pre></div>
</div>
</section>
</section>
</section>
<section id="id15">
<h2>函数<a class="headerlink" href="#id15" title="Permalink to this headline"></a></h2>
<section id="id16">
<h3>Python内置函数<a class="headerlink" href="#id16" title="Permalink to this headline"></a></h3>
<p>当前支持的Python内置函数包括：<code class="docutils literal notranslate"><span class="pre">len</span></code>、<code class="docutils literal notranslate"><span class="pre">isinstance</span></code>、<code class="docutils literal notranslate"><span class="pre">partial</span></code>、<code class="docutils literal notranslate"><span class="pre">map</span></code>、<code class="docutils literal notranslate"><span class="pre">range</span></code>、<code class="docutils literal notranslate"><span class="pre">enumerate</span></code>、<code class="docutils literal notranslate"><span class="pre">super</span></code>和<code class="docutils literal notranslate"><span class="pre">pow</span></code>。</p>
<section id="len">
<h4>len<a class="headerlink" href="#len" title="Permalink to this headline"></a></h4>
<p>功能：求序列的长度。</p>
<p>调用：<code class="docutils literal notranslate"><span class="pre">len(sequence)</span></code></p>
<p>入参：<code class="docutils literal notranslate"><span class="pre">sequence</span></code> – <code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code>、<code class="docutils literal notranslate"><span class="pre">Dictionary</span></code>或者<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。</p>
<p>返回值：序列的长度，类型为<code class="docutils literal notranslate"><span class="pre">int</span></code>。当入参是<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>时，返回的是<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>第0维的长度。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)))</span>
<span class="n">x_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">y_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="n">d_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="n">z_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>x_len: 3
y_len: 3
d_len: 2
z_len: 6
</pre></div>
</div>
</section>
<section id="isinstance">
<h4>isinstance<a class="headerlink" href="#isinstance" title="Permalink to this headline"></a></h4>
<p>功能：判断对象是否为类的实例。区别于算子<code class="docutils literal notranslate"><span class="pre">Isinstance</span></code>，该算子的第二个入参是MindSpore的<code class="docutils literal notranslate"><span class="pre">dtype</span></code>模块下定义的类型。</p>
<p>调用：<code class="docutils literal notranslate"><span class="pre">isinstance(obj,</span> <span class="pre">type)</span></code></p>
<p>入参：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">obj</span></code> – 任意支持类型的任意一个实例。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code> – <code class="docutils literal notranslate"><span class="pre">MindSpore</span> <span class="pre">dtype</span></code>模块下的一个类型。</p></li>
</ul>
<p>返回值：<code class="docutils literal notranslate"><span class="pre">obj</span></code>为<code class="docutils literal notranslate"><span class="pre">type</span></code>的实例，返回<code class="docutils literal notranslate"><span class="pre">True</span></code>，否则返回<code class="docutils literal notranslate"><span class="pre">False</span></code>。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)))</span>
<span class="n">x_is_tuple</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mstype</span><span class="o">.</span><span class="n">tuple_</span><span class="p">)</span>
<span class="n">y_is_list</span><span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">mstype</span><span class="o">.</span><span class="n">list_</span><span class="p">)</span>
<span class="n">z_is_tensor</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">mstype</span><span class="o">.</span><span class="n">tensor</span><span class="p">)</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>x_is_tuple: True
y_is_list: True
z_is_tensor: True
</pre></div>
</div>
</section>
<section id="partial">
<h4>partial<a class="headerlink" href="#partial" title="Permalink to this headline"></a></h4>
<p>功能：偏函数，固定函数入参。</p>
<p>调用：<code class="docutils literal notranslate"><span class="pre">partial(func,</span> <span class="pre">arg,</span> <span class="pre">...)</span></code></p>
<p>入参：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">func</span></code> – 函数。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">arg</span></code> – 一个或多个要固定的参数，支持位置参数和键值对传参。</p></li>
</ul>
<p>返回值：返回某些入参固定了值的函数。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="n">add_</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">add_</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">add_</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>m: 5
n: 7
</pre></div>
</div>
</section>
<section id="map">
<h4>map<a class="headerlink" href="#map" title="Permalink to this headline"></a></h4>
<p>功能：根据提供的函数对一个或者多个序列做映射，由映射的结果生成一个新的序列。
如果多个序列中的元素个数不一致，则生成的新序列与最短的那个长度相同。</p>
<p>调用：<code class="docutils literal notranslate"><span class="pre">map(func,</span> <span class="pre">sequence,</span> <span class="pre">...)</span></code></p>
<p>入参：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">func</span></code> – 函数。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sequence</span></code> – 一个或多个序列（<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>或者<code class="docutils literal notranslate"><span class="pre">List</span></code>）。</p></li>
</ul>
<p>返回值：返回一个<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="n">elements_a</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">elements_b</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">ret</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="n">elements_a</span><span class="p">,</span> <span class="n">elements_b</span><span class="p">)</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ret: (5, 7, 9)
</pre></div>
</div>
</section>
<section id="zip">
<h4>zip<a class="headerlink" href="#zip" title="Permalink to this headline"></a></h4>
<p>功能：将多个序列中对应位置的元素打包成一个个元组，然后由这些元组组成一个新序列，
如果各个序列中的元素个数不一致，则生成的新序列与最短的那个长度相同。</p>
<p>调用：<code class="docutils literal notranslate"><span class="pre">zip(sequence,</span> <span class="pre">...)</span></code></p>
<p>入参：<code class="docutils literal notranslate"><span class="pre">sequence</span></code> – 一个或多个序列(<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>或<code class="docutils literal notranslate"><span class="pre">List</span></code>)`。</p>
<p>返回值：返回一个<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">elements_a</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">elements_b</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">ret</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">elements_a</span><span class="p">,</span> <span class="n">elements_b</span><span class="p">)</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ret: ((1, 4), (2, 5), (3, 6))
</pre></div>
</div>
</section>
<section id="range">
<h4>range<a class="headerlink" href="#range" title="Permalink to this headline"></a></h4>
<p>功能：根据起始值、结束值和步长创建一个<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>。</p>
<p>调用：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">range(start,</span> <span class="pre">stop,</span> <span class="pre">step)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">range(start,</span> <span class="pre">stop)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">range(stop)</span></code></p></li>
</ul>
<p>入参：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">start</span></code> – 计数起始值，类型为<code class="docutils literal notranslate"><span class="pre">int</span></code>，默认为0。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stop</span></code> – 计数结束值，但不包括在内，类型为<code class="docutils literal notranslate"><span class="pre">int</span></code>。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">step</span></code> – 步长，类型为<code class="docutils literal notranslate"><span class="pre">int</span></code>，默认为1。</p></li>
</ul>
<p>返回值：返回一个<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>x: (0, 2, 4)
y: (0, 1, 2, 3, 4)
z: (0, 1, 2)
</pre></div>
</div>
</section>
<section id="enumerate">
<h4>enumerate<a class="headerlink" href="#enumerate" title="Permalink to this headline"></a></h4>
<p>功能：生成一个序列的索引序列，索引序列包含数据和对应下标。</p>
<p>调用：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">enumerate(sequence,</span> <span class="pre">start)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">enumerate(sequence)</span></code></p></li>
</ul>
<p>入参：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sequence</span></code> – 一个序列（<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>）。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">start</span></code> – 下标起始位置，类型为<code class="docutils literal notranslate"><span class="pre">int</span></code>，默认为0。</p></li>
</ul>
<p>返回值：返回一个<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span> <span class="p">,</span><span class="mi">6</span><span class="p">]]))</span>
<span class="n">m</span> <span class="o">=</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>m: ((3, 100), (4, 200), (5, 300), (5, 400))
n: ((0, Tensor(shape=[2], dtype=Int64, value=[1, 2])), (1, Tensor(shape=[2], dtype=Int64, value=[3, 4])), (2, Tensor(shape=[2], dtype=Int64, value=[5, 6])))
</pre></div>
</div>
</section>
<section id="super">
<h4>super<a class="headerlink" href="#super" title="Permalink to this headline"></a></h4>
<p>功能：用于调用父类(超类)的一个方法，一般在<code class="docutils literal notranslate"><span class="pre">super</span></code>之后调用父类的方法。</p>
<p>调用：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">super().xxx()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">super(type,</span> <span class="pre">self).xxx()</span></code></p></li>
</ul>
<p>入参：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code> – 类。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">self</span></code> – 对象。</p></li>
</ul>
<p>返回值：返回父类的方法。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">FatherNet</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
      <span class="nb">super</span><span class="p">(</span><span class="n">FatherNet</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>

  <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span>

  <span class="k">def</span> <span class="nf">test_father</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">x</span>

<span class="k">class</span> <span class="nc">SingleSubNet</span><span class="p">(</span><span class="n">FatherNet</span><span class="p">):</span>
<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">SingleSubNet</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">z</span>

<span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">ret_father_construct</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">ret_father_test</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">SingleSubNet</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">test_father</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ret_father_construct</span><span class="p">,</span> <span class="n">ret_father_test</span>
</pre></div>
</div>
</section>
<section id="pow">
<h4>pow<a class="headerlink" href="#pow" title="Permalink to this headline"></a></h4>
<p>功能：求幂。</p>
<p>调用：<code class="docutils literal notranslate"><span class="pre">pow(x,</span> <span class="pre">y)</span></code></p>
<p>入参：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">x</span></code> – 底数， <code class="docutils literal notranslate"><span class="pre">Number</span></code>或<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">y</span></code> – 幂指数， <code class="docutils literal notranslate"><span class="pre">Number</span></code>或<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。</p></li>
</ul>
<p>返回值：返回<code class="docutils literal notranslate"><span class="pre">x</span></code>的<code class="docutils literal notranslate"><span class="pre">y</span></code>次幂，<code class="docutils literal notranslate"><span class="pre">Number</span></code>或<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>
<span class="n">ret</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ret: Tensor(shape=[3], dtype=Int64, value=[1, 4, 27]))
</pre></div>
</div>
</section>
<section id="print">
<h4>print<a class="headerlink" href="#print" title="Permalink to this headline"></a></h4>
<p>功能：用于打印。</p>
<p>调用：<code class="docutils literal notranslate"><span class="pre">print(arg,</span> <span class="pre">...)</span></code></p>
<p>入参：<code class="docutils literal notranslate"><span class="pre">arg</span></code> – 要打印的信息(<code class="docutils literal notranslate"><span class="pre">String</span></code>或<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>）。</p>
<p>返回值：无返回值。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;result&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>result Tensor(shape=[3], dtype=Int64, value=[1, 2, 3]))
</pre></div>
</div>
</section>
</section>
<section id="id17">
<h3>函数参数<a class="headerlink" href="#id17" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>参数默认值：目前不支持默认值设为<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>类型数据，支持<code class="docutils literal notranslate"><span class="pre">int</span></code>、<code class="docutils literal notranslate"><span class="pre">float</span></code>、<code class="docutils literal notranslate"><span class="pre">bool</span></code>、<code class="docutils literal notranslate"><span class="pre">None</span></code>、<code class="docutils literal notranslate"><span class="pre">str</span></code>、<code class="docutils literal notranslate"><span class="pre">tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">list</span></code>、<code class="docutils literal notranslate"><span class="pre">dict</span></code>类型数据。</p></li>
<li><p>可变参数：支持带可变参数网络的推理和训练。</p></li>
<li><p>键值对参数：目前不支持带键值对参数的函数求反向。</p></li>
<li><p>可变键值对参数：目前不支持带可变键值对的函数求反向。</p></li>
</ul>
</section>
</section>
<section id="id18">
<h2>网络定义<a class="headerlink" href="#id18" title="Permalink to this headline"></a></h2>
<section id="id19">
<h3>整网实例类型<a class="headerlink" href="#id19" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>带<a class="reference external" href="https://www.mindspore.cn/doc/api_python/zh-CN/r1.1/mindspore/mindspore.html#mindspore.ms_function">&#64;ms_function</a>装饰器的普通Python函数。</p></li>
<li><p>继承自<a class="reference external" href="https://www.mindspore.cn/doc/api_python/zh-CN/r1.1/mindspore/nn/mindspore.nn.Cell.html">nn.Cell</a>的Cell子类。</p></li>
</ul>
</section>
<section id="id20">
<h3>网络构造组件<a class="headerlink" href="#id20" title="Permalink to this headline"></a></h3>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="text-left head"><p>类别</p></th>
<th class="text-left head"><p>内容</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Cell</span></code>实例</p></td>
<td class="text-left"><p><a class="reference external" href="https://www.mindspore.cn/doc/api_python/zh-CN/r1.1/mindspore/mindspore.nn.html">mindspore/nn/*</a>、自定义<a class="reference external" href="https://www.mindspore.cn/doc/api_python/zh-CN/r1.1/mindspore/nn/mindspore.nn.Cell.html">Cell</a>。</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Cell</span></code>实例的成员函数</p></td>
<td class="text-left"><p>Cell的construct中可以调用其他类成员函数。</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">dataclass</span></code>实例</p></td>
<td class="text-left"><p>使用&#64;dataclass装饰的类。</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Primitive</span></code>算子</p></td>
<td class="text-left"><p><a class="reference external" href="https://www.mindspore.cn/doc/api_python/zh-CN/r1.1/mindspore/mindspore.ops.html">mindspore/ops/operations/*</a></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Composite</span></code>算子</p></td>
<td class="text-left"><p><a class="reference external" href="https://www.mindspore.cn/doc/api_python/zh-CN/r1.1/mindspore/mindspore.ops.html">mindspore/ops/composite/*</a></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">constexpr</span></code>生成算子</p></td>
<td class="text-left"><p>使用<a class="reference external" href="https://www.mindspore.cn/doc/api_python/zh-CN/r1.1/mindspore/ops/mindspore.ops.constexpr.html">&#64;constexpr</a>生成的值计算算子。</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>函数</p></td>
<td class="text-left"><p>自定义Python函数、前文中列举的系统函数。</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id21">
<h3>网络使用约束<a class="headerlink" href="#id21" title="Permalink to this headline"></a></h3>
<ol class="arabic">
<li><p>当前整网入参（即最外层网络入参）默认仅支持<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，如果要支持非<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，可设置网络的<code class="docutils literal notranslate"><span class="pre">support_non_tensor_inputs</span></code>属性为<code class="docutils literal notranslate"><span class="pre">True</span></code>。</p>
<p>在网络初始化的时候，设置<code class="docutils literal notranslate"><span class="pre">self.support_non_tensor_inputs</span> <span class="pre">=</span> <span class="pre">True</span></code>，该配置目前仅支持正向网络，暂不支持反向网络，即不支持对整网入参有非<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>的网络求反向。</p>
<p>支持最外层传入标量示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ExpandDimsNet</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ExpandDimsNet</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">support_non_tensor_inputs</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expandDims</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">ExpandDims</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_x</span><span class="p">,</span> <span class="n">input_axis</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">expandDims</span><span class="p">(</span><span class="n">input_x</span><span class="p">,</span> <span class="n">input_axis</span><span class="p">)</span>
<span class="n">expand_dim_net</span> <span class="o">=</span> <span class="n">ExpandDimsNet</span><span class="p">()</span>
<span class="n">input_x</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="n">expand_dim_net</span><span class="p">(</span><span class="n">input_x</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>不允许修改网络的非<code class="docutils literal notranslate"><span class="pre">Parameter</span></code>类型数据成员。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Net</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">par</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;par&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</pre></div>
</div>
<p>上面所定义的网络里，<code class="docutils literal notranslate"><span class="pre">self.num</span></code>不是一个<code class="docutils literal notranslate"><span class="pre">Parameter</span></code>，不允许被修改，而<code class="docutils literal notranslate"><span class="pre">self.par</span></code>是一个<code class="docutils literal notranslate"><span class="pre">Parameter</span></code>，可以被修改。</p>
</li>
<li><p>当<code class="docutils literal notranslate"><span class="pre">construct</span></code>函数里，使用未定义的类成员时，不会像Python解释器那样抛出<code class="docutils literal notranslate"><span class="pre">AttributeError</span></code>，而是作为<code class="docutils literal notranslate"><span class="pre">None</span></code>处理。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Net</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
</pre></div>
</div>
<p>上面所定义的网络里，<code class="docutils literal notranslate"><span class="pre">construct</span></code>里使用了并未定义的类成员<code class="docutils literal notranslate"><span class="pre">self.y</span></code>，此时会将<code class="docutils literal notranslate"><span class="pre">self.y</span></code>作为<code class="docutils literal notranslate"><span class="pre">None</span></code>处理。</p>
</li>
</ol>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="syntax_list.html" class="btn btn-neutral float-left" title="语法支持" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="model_lite.html" class="btn btn-neutral float-right" title="模型支持（Lite）" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, MindSpore.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 
</body>
</html>