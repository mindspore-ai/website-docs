<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Single-Node Tensor Cache &mdash; MindSpore master documentation</title><script>;(()=>{const e=localStorage.getItem("ms-theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;(e?"dark"===e:t)&&document.documentElement.setAttribute("data-o-theme","dark")})();</script><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script><script src="_static/jquery.js"></script>
        <script src="_static/js/theme.js"></script><script src="_static/underscore.js"></script><script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Execution Management" href="execution_management.html" />
    <link rel="prev" title="Auto Augmentation" href="auto_augmentation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> MindSpore
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="api_structure.html">MindSpore API Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_type.html">Data Type</a></li>
<li class="toctree-l1"><a class="reference internal" href="compute_component.html">Compute Component</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="data_pipeline.html">Data Pipeline</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="dataset_loading.html">Loading Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="sampler.html">Sampler</a></li>
<li class="toctree-l2"><a class="reference internal" href="pipeline.html">Processing Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="augmentation.html">Data Augmentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="tokenizer.html">Tokenizer</a></li>
<li class="toctree-l2"><a class="reference internal" href="dataset_conversion.html">MindSpore Data Format Conversion</a></li>
<li class="toctree-l2"><a class="reference internal" href="auto_augmentation.html">Auto Augmentation</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Single-Node Tensor Cache</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#basic-cache-usage">Basic Cache Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cache-sharing">Cache Sharing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#limitations">Limitations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cache-performance-tuning">Cache Performance Tuning</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="execution_management.html">Execution Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="auto_parallel.html">Parallel Distributed Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced_usage.html">Advanced Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="network_list.html">Network List</a></li>
<li class="toctree-l1"><a class="reference internal" href="operator_list.html">Operator List</a></li>
<li class="toctree-l1"><a class="reference internal" href="syntax_list.html">Syntax list</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MindSpore</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="data_pipeline.html">Data Pipeline</a> &raquo;</li>
      <li>Single-Node Tensor Cache</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/cache.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="single-node-tensor-cache">
<h1>Single-Node Tensor Cache<a class="headerlink" href="#single-node-tensor-cache" title="Permalink to this headline"></a></h1>
<p><a class="reference external" href="https://gitee.com/mindspore/docs/blob/r1.2/docs/programming_guide/source_en/cache.md"><img alt="View Source On Gitee" src="_images/logo_source.png" /></a></p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline"></a></h2>
<p>If you need to repeatedly access remote datasets or load datasets from disks, you can use the single-node cache operator to cache datasets in the local memory to accelerate dataset loading.</p>
<p>The cache operator depends on the cache server started on the current node. Functioning as a daemon process and independent of the training script, the cache server is mainly used to manage cached data, including storing, querying, and loading data, and writing cached data when the cache is not hit.</p>
<p>If the memory space is insufficient to cache all datasets, you can configure a cache operator to cache the remaining data to disks.</p>
<p>Currently, the cache service supports only single-node cache. That is, the client and server are deployed on the same machine. This service can be used in the following scenarios:</p>
<ul>
<li><p>Cache the loaded original dataset.</p>
<p>You can use the cache in the dataset loading operator. The loaded data is stored in the cache server. If the same data is required subsequently, the data can be directly load from the cache server, avoiding repeated loading from the disk.</p>
<p><img alt="cache on leaf pipeline" src="_images/cache_dataset.png" /></p>
</li>
<li><p>Cache the data processed by argumentation.</p>
<p>You can also use the cache in the <code class="docutils literal notranslate"><span class="pre">map</span></code> operator. The data processed by argumentation (such as image cropping or resizing) is directly cached, avoiding repeated data argumentation operations and reducing unnecessary computations.</p>
<p><img alt="cache on map pipeline" src="_images/cache_processed_data.png" /></p>
<blockquote>
<div><p>You are advised to cache image data in <code class="docutils literal notranslate"><span class="pre">decode</span></code> + <code class="docutils literal notranslate"><span class="pre">resize</span></code> + <code class="docutils literal notranslate"><span class="pre">cache</span></code> mode. The data processed by <code class="docutils literal notranslate"><span class="pre">decode</span></code> can be directly cached only in single-node single-device mode.</p>
</div></blockquote>
</li>
</ul>
</section>
<section id="basic-cache-usage">
<h2>Basic Cache Usage<a class="headerlink" href="#basic-cache-usage" title="Permalink to this headline"></a></h2>
<ol class="arabic">
<li><p>Configure the environment.</p>
<p>Before using the cache service, you need to install MindSpore and set related environment variables. The Conda environment is used as an example. The setting method is as follows:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$LD_LIBRARY_PATH</span>:<span class="o">{</span>path_to_conda<span class="o">}</span>/envs/<span class="o">{</span>your_env_name<span class="o">}</span>/lib/python3.7/site-packages/mindspore:<span class="o">{</span>path_to_conda<span class="o">}</span>/envs/<span class="o">{</span>your_env_name<span class="o">}</span>/lib/python3.7/site-packages/mindspore/lib
<span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="o">{</span>path_to_conda<span class="o">}</span>/envs/<span class="o">{</span>your_env_name<span class="o">}</span>/bin
</pre></div>
</div>
<blockquote>
<div><p>When the cache is used, the server memory may be insufficient. Therefore, you are advised to increase the swap memory space of the server to more than 100 GB before using the cache. For details about how to increase the swap memory space on Ubuntu, EulerOS, or CentOS, see <a class="reference external" href="https://help.ubuntu.com/community/SwapFaq#How_do_I_add_a_swap_file.3F">related tutorials</a>.</p>
</div></blockquote>
</li>
<li><p>Start the cache server.</p>
<p>Before using the single-node cache service, run the following command to start the cache server:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>cache_admin<span class="w"> </span>--start
</pre></div>
</div>
<p>If the following information is displayed, the cache server is started successfully:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Cache server startup completed successfully!
The cache server daemon has been created as process id 10394 and is listening on port 50052

Recommendation:
Since the server is detached into its own daemon process, monitor the server logs (under /tmp/mindspore/cache/log) for any issues that may happen after startup
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">cache_admin</span></code> supports the following commands and options:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--start</span></code>: starts the cache server. The following options are supported:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">--workers</span></code> or <code class="docutils literal notranslate"><span class="pre">-w</span></code>: specifies the number of worker threads on the cache server. By default, the number of worker threads is half of the number of CPUs. This parameter relies on the NUMA architecture of the server. The value will be adjusted automatically by the server if it’s not a multiple of number of NUMA nodes in the machine.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--spilldir</span></code> or <code class="docutils literal notranslate"><span class="pre">-s</span></code>: specifies the disk file path for storing remaining data when the cached data size exceeds the memory space. The default value is ‘’ (which means disabling spilling).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--hostname</span></code> or <code class="docutils literal notranslate"><span class="pre">-h</span></code>: specifies the IP address of the cache server. The default value is 127.0.0.1.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--port</span></code> or <code class="docutils literal notranslate"><span class="pre">-p</span></code>: specifies the port number of the cache server. The default value is 50052.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--loglevel</span></code> or <code class="docutils literal notranslate"><span class="pre">-l</span></code>: sets the log level. The default value is 1 (WARNING). If this option is set to 0 (INFO), excessive logs will be generated, resulting in performance deterioration.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">--stop</span></code>: stops the cache server.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--generate_session</span></code> or <code class="docutils literal notranslate"><span class="pre">-g</span></code>: generates a cache session.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--destroy_session</span></code> or <code class="docutils literal notranslate"><span class="pre">-d</span></code>: deletes a cache session.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--list_sessions</span></code>: displays the list of currently cached sessions and their details.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--server_info</span></code>：displays the configuration parameters and active session list of current server.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--help</span></code>: displays the help information.</p></li>
</ul>
<p>In the preceding options, you can use <code class="docutils literal notranslate"><span class="pre">-h</span></code> and <code class="docutils literal notranslate"><span class="pre">-p</span></code> to specify a server. Users can also set environment variables <code class="docutils literal notranslate"><span class="pre">MS_CACHE_HOST</span></code> and <code class="docutils literal notranslate"><span class="pre">MS_CACHE_PORT</span></code> to specify it. If hostname and port are not set, operations are performed on the server with the IP address 127.0.0.1 and port number 50052 by default.</p>
<p>You can run the <code class="docutils literal notranslate"><span class="pre">ps</span> <span class="pre">-ef|grep</span> <span class="pre">cache_server</span></code> command to check whether the server is started and query server parameters.</p>
<p>You can also run the <code class="docutils literal notranslate"><span class="pre">cache_admin</span> <span class="pre">--server_info</span></code> command to get the full list of configuration of cache server.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cache_admin<span class="w"> </span>--server_info
Cache<span class="w"> </span>Server<span class="w"> </span>Configuration:
----------------------------------------
<span class="w">         </span>config<span class="w"> </span>name<span class="w">          </span>value
----------------------------------------
<span class="w">            </span>hostname<span class="w">      </span><span class="m">127</span>.0.0.1
<span class="w">                </span>port<span class="w">          </span><span class="m">50052</span>
<span class="w">   </span>number<span class="w"> </span>of<span class="w"> </span>workers<span class="w">             </span><span class="m">16</span>
<span class="w">           </span>log<span class="w"> </span>level<span class="w">              </span><span class="m">1</span>
<span class="w">           </span>spill<span class="w"> </span>dir<span class="w">           </span>None
----------------------------------------
Active<span class="w"> </span>sessions:
No<span class="w"> </span>active<span class="w"> </span>sessions.
</pre></div>
</div>
<p>Where, the table of Cache Server Configuration lists five detailed configuration information. Active sessions shows the list of active session ID in current server if any.</p>
<blockquote>
<div><ul class="simple">
<li><p>Before setting cache_server initialization parameters, check the available memory of the system and the size of the dataset to be loaded. If the memory of cache_server or the dataset size exceeds the available memory of the system, the server may break down or restart, the cache_server may automatically shut down, or the training process fails to be executed.</p></li>
<li><p>To enable data spilling, you need to use <code class="docutils literal notranslate"><span class="pre">-s</span></code> to set spilling path when starting cache server. Otherwise, this feature is default to be disabled and it will bring up a memory-only cache server.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Create a cache session.</p>
<p>If no cache session exists on the cache server, a cache session needs to be created to obtain the cache session ID.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cache_admin<span class="w"> </span>-g
Session<span class="w"> </span>created<span class="w"> </span><span class="k">for</span><span class="w"> </span>server<span class="w"> </span>on<span class="w"> </span>port<span class="w"> </span><span class="m">50052</span>:<span class="w"> </span><span class="m">1456416665</span>
</pre></div>
</div>
<p>In the preceding command, 1456416665 is the cache session ID allocated by the server with port number 50052.</p>
<p>You can run the <code class="docutils literal notranslate"><span class="pre">cache_admin</span> <span class="pre">--list_sessions</span></code> command to view all cache sessions on the current server.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cache_admin<span class="w"> </span>--list_sessions
Listing<span class="w"> </span>sessions<span class="w"> </span><span class="k">for</span><span class="w"> </span>server<span class="w"> </span>on<span class="w"> </span>port<span class="w"> </span><span class="m">50052</span>

<span class="w">     </span>Session<span class="w">    </span>Cache<span class="w"> </span>Id<span class="w">  </span>Mem<span class="w"> </span>cached<span class="w"> </span>Disk<span class="w"> </span>cached<span class="w">  </span>Avg<span class="w"> </span>cache<span class="w"> </span>size<span class="w">  </span>Numa<span class="w"> </span>hit
<span class="w">  </span><span class="m">1456416665</span><span class="w">         </span>n/a<span class="w">         </span>n/a<span class="w">         </span>n/a<span class="w">             </span>n/a<span class="w">       </span>n/a
</pre></div>
</div>
<p>Output parameter description:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Session</span></code>: specifies the cache session ID.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Cache</span> <span class="pre">Id</span></code>: specifies the ID of the cache instance in the current cache session. <code class="docutils literal notranslate"><span class="pre">n/a</span></code> indicates that no cache instance is created.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Mem</span> <span class="pre">cached</span></code>: specifies the cached data volume in the memory.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Disk</span> <span class="pre">cached</span></code>: specifies the cached data volume in the disk.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Avg</span> <span class="pre">cache</span> <span class="pre">size</span></code>: specifies the average size of each line of data in the current cache.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Numa</span> <span class="pre">hit</span></code>: specifies the number of NUMA hits. A larger value indicates better time performance.</p></li>
</ul>
</li>
<li><p>Create a cache instance.</p>
<p>In the Python training script, use the <code class="docutils literal notranslate"><span class="pre">DatasetCache</span></code> API to define a cache instance named <code class="docutils literal notranslate"><span class="pre">test_cache</span></code>, and specify the <code class="docutils literal notranslate"><span class="pre">session_id</span></code> parameter to a cache session ID created in the previous step.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore.dataset</span> <span class="k">as</span> <span class="nn">ds</span>

<span class="n">test_cache</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">DatasetCache</span><span class="p">(</span><span class="n">session_id</span><span class="o">=</span><span class="mi">1456416665</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">spilling</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">DatasetCache</span></code> supports the following parameters:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">session_id</span></code>: specifies the cache session ID, which can be created and obtained by running the <code class="docutils literal notranslate"><span class="pre">cache_admin</span> <span class="pre">-g</span></code> command.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">size</span></code>: specifies the maximum memory space occupied by the cache. The unit is MB. For example, if the cache space is 512 GB, set <code class="docutils literal notranslate"><span class="pre">size</span></code> to <code class="docutils literal notranslate"><span class="pre">524288</span></code>. The default value is 0.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spilling</span></code>: determines whether to spill the remaining data to disks when the memory space exceeds the upper limit. The default value is False.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hostname</span></code>: specifies the IP address for connecting to the cache server. The default value is 127.0.0.1.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">port</span></code>: specifies the port number for connecting to the cache server. The default value is 50052.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">num_connections</span></code>: specifies the number of established TCP/IP connections. The default value is 12.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">prefetch_size</span></code>: specifies the number of rows obtained for each access. The default value is 20.</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>In actual use, you are advised to run the <code class="docutils literal notranslate"><span class="pre">cache_admin</span> <span class="pre">-g</span></code> command to obtain a cache session ID from the cache server and use it as the parameter of <code class="docutils literal notranslate"><span class="pre">session_id</span></code> to prevent errors caused by cache session nonexistence.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">size=0</span></code> indicates that the memory space used by the cache is not limited manually, but cannot exceed 80% of the total system memory. Note that <code class="docutils literal notranslate"><span class="pre">size=0</span></code> may cause the out of memory error. Therefore, you are advised to set <code class="docutils literal notranslate"><span class="pre">size</span></code> to a proper value based on the idle memory of the machine.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spilling=True</span></code> indicates that the remaining data is written to disks when the memory space is insufficient. Therefore, ensure that you have the write permission on the configured disk path and the disk space is sufficient to store the remaining cache data. Note that if no spilling path is set when cache server starts, setting <code class="docutils literal notranslate"><span class="pre">spilling=True</span></code> will raise an error when calling the API.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spilling=False</span></code> indicates that no data is written once the configured memory space is used up on the cache server.</p></li>
<li><p>If a dataset that does not support random access (such as <code class="docutils literal notranslate"><span class="pre">TFRecordDataset</span></code>) is used to load data and the cache service is enabled, ensure that the entire dataset is stored locally. In this scenario, if the local memory space is insufficient to store all data, spilling must be enabled to spill data to disks.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">num_connections</span></code> and <code class="docutils literal notranslate"><span class="pre">prefetch_size</span></code> are internal performance tuning parameters. Generally, you do not need to set these two parameters.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Insert a cache instance.</p>
<p>Currently, the cache service can be used to cache both original datasets and datasets processed by argumentation. The following example shows two usage methods.</p>
<p>Note that you need to create a cache instance for each of the two examples according to step 4, and use the created <code class="docutils literal notranslate"><span class="pre">test_cache</span></code> as the <code class="docutils literal notranslate"><span class="pre">cache</span></code> parameter in the dataset loading operator or map operator.</p>
<p>CIFAR-10 dataset is used in the following two examples. Before running the sample, download and store the CIFAR-10 dataset by referring to <a class="reference external" href="https://www.mindspore.cn/doc/programming_guide/en/r1.2/dataset_loading.html#cifar-10-100">Loading Dataset</a>.</p>
<ul>
<li><p>Cache the original loaded dataset.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dataset_dir</span> <span class="o">=</span> <span class="s2">&quot;cifar-10-batches-bin/&quot;</span>

<span class="c1"># apply cache to dataset</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">Cifar10Dataset</span><span class="p">(</span><span class="n">dataset_dir</span><span class="o">=</span><span class="n">dataset_dir</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">num_parallel_workers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="n">test_cache</span><span class="p">)</span>

<span class="n">num_iter</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">create_dict_iterator</span><span class="p">(</span><span class="n">num_epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>  <span class="c1"># each data is a dictionary</span>
    <span class="c1"># in this example, each dictionary has a key &quot;image&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> image shape: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_iter</span><span class="p">,</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
    <span class="n">num_iter</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>The output is as follows:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>0 image shape: (32, 32, 3)
1 image shape: (32, 32, 3)
2 image shape: (32, 32, 3)
3 image shape: (32, 32, 3)
</pre></div>
</div>
<p>You can run the <code class="docutils literal notranslate"><span class="pre">cache_admin</span> <span class="pre">--list_sessions</span></code> command to check whether there are four data records in the current session. If yes, the data is successfully cached.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cache_admin<span class="w"> </span>--list_sessions
Listing<span class="w"> </span>sessions<span class="w"> </span><span class="k">for</span><span class="w"> </span>server<span class="w"> </span>on<span class="w"> </span>port<span class="w"> </span><span class="m">50052</span>

<span class="w">     </span>Session<span class="w">    </span>Cache<span class="w"> </span>Id<span class="w">  </span>Mem<span class="w"> </span>cached<span class="w"> </span>Disk<span class="w"> </span>cached<span class="w">  </span>Avg<span class="w"> </span>cache<span class="w"> </span>size<span class="w">  </span>Numa<span class="w"> </span>hit
<span class="w">  </span><span class="m">1456416665</span><span class="w">   </span><span class="m">821590605</span><span class="w">       </span><span class="m">4</span><span class="w">         </span>n/a<span class="w">          </span><span class="m">3226</span><span class="w">           </span><span class="m">4</span>
</pre></div>
</div>
</li>
<li><p>Cache the data processed by argumentation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore.dataset.vision.c_transforms</span> <span class="k">as</span> <span class="nn">c_vision</span>

<span class="n">dataset_dir</span> <span class="o">=</span> <span class="s2">&quot;cifar-10-batches-bin/&quot;</span>

<span class="c1"># apply cache to dataset</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">Cifar10Dataset</span><span class="p">(</span><span class="n">dataset_dir</span><span class="o">=</span><span class="n">dataset_dir</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">num_parallel_workers</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># apply cache to map</span>
<span class="n">rescale_op</span> <span class="o">=</span> <span class="n">c_vision</span><span class="o">.</span><span class="n">Rescale</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mf">255.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">input_columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">],</span> <span class="n">operations</span><span class="o">=</span><span class="n">rescale_op</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="n">test_cache</span><span class="p">)</span>

<span class="n">num_iter</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">create_dict_iterator</span><span class="p">(</span><span class="n">num_epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>  <span class="c1"># each data is a dictionary</span>
    <span class="c1"># in this example, each dictionary has a keys &quot;image&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> image shape: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_iter</span><span class="p">,</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
    <span class="n">num_iter</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>The output is as follows:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>0 image shape: (32, 32, 3)
1 image shape: (32, 32, 3)
2 image shape: (32, 32, 3)
3 image shape: (32, 32, 3)
4 image shape: (32, 32, 3)
</pre></div>
</div>
<p>You can run the <code class="docutils literal notranslate"><span class="pre">cache_admin</span> <span class="pre">--list_sessions</span></code> command to check whether there are five data records in the current session. If yes, the data is successfully cached.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cache_admin<span class="w"> </span>--list_sessions
Listing<span class="w"> </span>sessions<span class="w"> </span><span class="k">for</span><span class="w"> </span>server<span class="w"> </span>on<span class="w"> </span>port<span class="w"> </span><span class="m">50052</span>

<span class="w">     </span>Session<span class="w">    </span>Cache<span class="w"> </span>Id<span class="w">  </span>Mem<span class="w"> </span>cached<span class="w"> </span>Disk<span class="w"> </span>cached<span class="w">  </span>Avg<span class="w"> </span>cache<span class="w"> </span>size<span class="w">  </span>Numa<span class="w"> </span>hit
<span class="w">  </span><span class="m">1456416665</span><span class="w">  </span><span class="m">3618046178</span><span class="w">       </span><span class="m">5</span><span class="w">         </span>n/a<span class="w">          </span><span class="m">12442</span><span class="w">         </span><span class="m">5</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>Destroy the cache session.</p>
<p>After the training is complete, you can destroy the current cache and release the memory.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cache_admin<span class="w"> </span>--destroy_session<span class="w"> </span><span class="m">1456416665</span>
Drop<span class="w"> </span>session<span class="w"> </span>successfully<span class="w"> </span><span class="k">for</span><span class="w"> </span>server<span class="w"> </span>on<span class="w"> </span>port<span class="w"> </span><span class="m">50052</span>
</pre></div>
</div>
<p>The preceding command is used to destroy the cache with the session ID 1456416665 on the server with the port number 50052.</p>
<p>If you choose not to destroy the cache, the cached data still exists in the cache session. You can use the cache when starting the training script next time.</p>
</li>
<li><p>Stop the cache server.</p>
<p>After using the cache server, you can stop it. This operation will destroy all cache sessions on the current server and release the memory.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cache_admin<span class="w"> </span>--stop
Cache<span class="w"> </span>server<span class="w"> </span>on<span class="w"> </span>port<span class="w"> </span><span class="m">50052</span><span class="w"> </span>has<span class="w"> </span>been<span class="w"> </span>stopped<span class="w"> </span>successfully.
</pre></div>
</div>
<p>The preceding command is used to shut down the server with the port number 50052.</p>
<p>If you choose not to shut down the server, the cache sessions on the server will be retained for future use. During the next training, you can create a cache session or reuse the existing cache.</p>
</li>
</ol>
</section>
<section id="cache-sharing">
<h2>Cache Sharing<a class="headerlink" href="#cache-sharing" title="Permalink to this headline"></a></h2>
<p>During the single-node multi-device distributed training, the cache operator allows multiple same training scripts to share the same cache and read and write data from the cache.</p>
<ol class="arabic">
<li><p>Start the cache server.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cache_admin<span class="w"> </span>--start
Cache<span class="w"> </span>server<span class="w"> </span>startup<span class="w"> </span>completed<span class="w"> </span>successfully!
The<span class="w"> </span>cache<span class="w"> </span>server<span class="w"> </span>daemon<span class="w"> </span>has<span class="w"> </span>been<span class="w"> </span>created<span class="w"> </span>as<span class="w"> </span>process<span class="w"> </span>id<span class="w"> </span><span class="m">39337</span><span class="w"> </span>and<span class="w"> </span>listening<span class="w"> </span>on<span class="w"> </span>port<span class="w"> </span><span class="m">50052</span>

Recommendation:
Since<span class="w"> </span>the<span class="w"> </span>server<span class="w"> </span>is<span class="w"> </span>detached<span class="w"> </span>into<span class="w"> </span>its<span class="w"> </span>own<span class="w"> </span>daemon<span class="w"> </span>process,<span class="w"> </span>monitor<span class="w"> </span>the<span class="w"> </span>server<span class="w"> </span>logs<span class="w"> </span><span class="o">(</span>under<span class="w"> </span>/tmp/mindspore/cache/log<span class="o">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>any<span class="w"> </span>issues<span class="w"> </span>that<span class="w"> </span>may<span class="w"> </span>happen<span class="w"> </span>after<span class="w"> </span>startup
</pre></div>
</div>
</li>
<li><p>Create a cache session.</p>
<p>Create the shell script <code class="docutils literal notranslate"><span class="pre">cache.sh</span></code> for starting Python training and run the following command to generate a cache session ID:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># This shell script will launch parallel pipelines</span>

<span class="c1"># get path to dataset directory</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$#</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">]</span>
<span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Usage: sh cache.sh DATASET_PATH&quot;</span>
<span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="k">fi</span>
<span class="nv">dataset_path</span><span class="o">=</span><span class="nv">$1</span>

<span class="c1"># generate a session id that these parallel pipelines can share</span>
<span class="nv">result</span><span class="o">=</span><span class="k">$(</span>cache_admin<span class="w"> </span>-g<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="k">)</span>
<span class="nv">rc</span><span class="o">=</span><span class="nv">$?</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$rc</span><span class="w"> </span>-ne<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;some error&quot;</span>
<span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="k">fi</span>

<span class="c1"># grab the session id from the result string</span>
<span class="nv">session_id</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="nv">$result</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $NF}&#39;</span><span class="k">)</span>
</pre></div>
</div>
</li>
<li><p>Pass the cache session ID to the training script.</p>
<p>Continue to write the shell script and add the following command to pass <code class="docutils literal notranslate"><span class="pre">session_id</span></code> and other parameters when the Python training is started:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># make the session_id available to the python scripts</span>
<span class="nv">num_devices</span><span class="o">=</span><span class="m">4</span>

<span class="k">for</span><span class="w"> </span>p<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">$(</span>seq<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="k">$((</span><span class="si">${</span><span class="nv">num_devices</span><span class="si">}</span><span class="o">-</span><span class="m">1</span><span class="k">)))</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span>python<span class="w"> </span>my_training_script.py<span class="w"> </span>--num_devices<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$num_devices</span><span class="s2">&quot;</span><span class="w"> </span>--device<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$p</span><span class="s2">&quot;</span><span class="w"> </span>--session_id<span class="w"> </span><span class="nv">$session_id</span><span class="w"> </span>--dataset_path<span class="w"> </span><span class="nv">$dataset_path</span>
<span class="k">done</span>
</pre></div>
</div>
<blockquote>
<div><p>Complete sample code: <a class="reference external" href="https://gitee.com/mindspore/docs/blob/r1.2/tutorials/tutorial_code/cache/cache.sh">cache.sh</a></p>
</div></blockquote>
</li>
<li><p>Create and apply a cache instance.</p>
<p>CIFAR-10 dataset is used in the following example. Before running the sample, download and store the CIFAR-10 dataset by referring to <a class="reference external" href="https://www.mindspore.cn/doc/programming_guide/en/r1.2/dataset_loading.html#cifar-10-100">Loading Dataset</a>. The directory structure is as follows:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>├─cache.sh
├─my_training_script.py
└─cifar-10-batches-bin
    ├── batches.meta.txt
    ├── data_batch_1.bin
    ├── data_batch_2.bin
    ├── data_batch_3.bin
    ├── data_batch_4.bin
    ├── data_batch_5.bin
    ├── readme.html
    └── test_batch.bin
</pre></div>
</div>
<p>Create and write the Python script <code class="docutils literal notranslate"><span class="pre">my_training_script.py</span></code>. Use the following code to receive <code class="docutils literal notranslate"><span class="pre">session_id</span></code> and pass it as a parameter when defining a cache instance.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">mindspore.dataset</span> <span class="k">as</span> <span class="nn">ds</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Cache Example&#39;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--num_devices&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Device num.&#39;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--device&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Device id.&#39;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--session_id&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Session id.&#39;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--dataset_path&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Dataset path&#39;</span><span class="p">)</span>
<span class="n">args_opt</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

<span class="c1"># apply cache to dataset</span>
<span class="n">test_cache</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">DatasetCache</span><span class="p">(</span><span class="n">session_id</span><span class="o">=</span><span class="n">args_opt</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">spilling</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">Cifar10Dataset</span><span class="p">(</span><span class="n">dataset_dir</span><span class="o">=</span><span class="n">args_opt</span><span class="o">.</span><span class="n">dataset_path</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">num_parallel_workers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">num_shards</span><span class="o">=</span><span class="n">args_opt</span><span class="o">.</span><span class="n">num_devices</span><span class="p">,</span> <span class="n">shard_id</span><span class="o">=</span><span class="n">args_opt</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="n">test_cache</span><span class="p">)</span>
<span class="n">num_iter</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">create_dict_iterator</span><span class="p">():</span>
    <span class="n">num_iter</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Got </span><span class="si">{}</span><span class="s2"> samples on device </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_iter</span><span class="p">,</span> <span class="n">args_opt</span><span class="o">.</span><span class="n">device</span><span class="p">))</span>
</pre></div>
</div>
<blockquote>
<div><p>Complete sample code: <a class="reference external" href="https://gitee.com/mindspore/docs/blob/r1.2/tutorials/tutorial_code/cache/my_training_script.py">my_training_script.py</a></p>
</div></blockquote>
</li>
<li><p>Execute the training script.</p>
<p>Execute the shell script <code class="docutils literal notranslate"><span class="pre">cache.sh</span></code> to enable distributed training.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>sh<span class="w"> </span>cache.sh<span class="w"> </span>cifar-10-batches-bin/
Got<span class="w"> </span><span class="m">4</span><span class="w"> </span>samples<span class="w"> </span>on<span class="w"> </span>device<span class="w"> </span><span class="m">0</span>
Got<span class="w"> </span><span class="m">4</span><span class="w"> </span>samples<span class="w"> </span>on<span class="w"> </span>device<span class="w"> </span><span class="m">1</span>
Got<span class="w"> </span><span class="m">4</span><span class="w"> </span>samples<span class="w"> </span>on<span class="w"> </span>device<span class="w"> </span><span class="m">2</span>
Got<span class="w"> </span><span class="m">4</span><span class="w"> </span>samples<span class="w"> </span>on<span class="w"> </span>device<span class="w"> </span><span class="m">3</span>
</pre></div>
</div>
<p>You can run the <code class="docutils literal notranslate"><span class="pre">cache_admin</span> <span class="pre">--list_sessions</span></code> command to check whether only one group of data exists in the current session. If yes, cache sharing is successful.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cache_admin<span class="w"> </span>--list_sessions
Listing<span class="w"> </span>sessions<span class="w"> </span><span class="k">for</span><span class="w"> </span>server<span class="w"> </span>on<span class="w"> </span>port<span class="w"> </span><span class="m">50052</span>

<span class="w">     </span>Session<span class="w">    </span>Cache<span class="w"> </span>Id<span class="w">  </span>Mem<span class="w"> </span>cached<span class="w"> </span>Disk<span class="w"> </span>cached<span class="w">  </span>Avg<span class="w"> </span>cache<span class="w"> </span>size<span class="w">  </span>Numa<span class="w"> </span>hit
<span class="w">  </span><span class="m">3392558708</span><span class="w">   </span><span class="m">821590605</span><span class="w">          </span><span class="m">16</span><span class="w">         </span>n/a<span class="w">            </span><span class="m">3227</span><span class="w">        </span><span class="m">16</span>
</pre></div>
</div>
</li>
<li><p>Destroy the cache session.</p>
<p>After the training is complete, you can destroy the current cache and release the memory.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cache_admin<span class="w"> </span>--destroy_session<span class="w"> </span><span class="m">3392558708</span>
Drop<span class="w"> </span>session<span class="w"> </span>successfully<span class="w"> </span><span class="k">for</span><span class="w"> </span>server<span class="w"> </span>on<span class="w"> </span>port<span class="w"> </span><span class="m">50052</span>
</pre></div>
</div>
</li>
<li><p>Stop the cache server.</p>
<p>After using the cache server, you can stop it.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cache_admin<span class="w"> </span>--stop
Cache<span class="w"> </span>server<span class="w"> </span>on<span class="w"> </span>port<span class="w"> </span><span class="m">50052</span><span class="w"> </span>has<span class="w"> </span>been<span class="w"> </span>stopped<span class="w"> </span>successfully.
</pre></div>
</div>
</li>
</ol>
</section>
<section id="limitations">
<h2>Limitations<a class="headerlink" href="#limitations" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Currently, dataset classes such as <code class="docutils literal notranslate"><span class="pre">MindDataset</span></code>, <code class="docutils literal notranslate"><span class="pre">GraphDataset</span></code>, <code class="docutils literal notranslate"><span class="pre">GeneratorDataset</span></code>, <code class="docutils literal notranslate"><span class="pre">PaddedDataset</span></code>, and <code class="docutils literal notranslate"><span class="pre">NumpySlicesDataset</span></code> do not support cache. <code class="docutils literal notranslate"><span class="pre">GeneratorDataset</span></code>, <code class="docutils literal notranslate"><span class="pre">PaddedDataset</span></code>, and <code class="docutils literal notranslate"><span class="pre">NumpySlicesDataset</span></code> belong to <code class="docutils literal notranslate"><span class="pre">GeneratorOp</span></code>, so their error message is displayed as “There is currently no support for GeneratorOp under cache.”</p></li>
<li><p>Data processed by <code class="docutils literal notranslate"><span class="pre">batch</span></code>, <code class="docutils literal notranslate"><span class="pre">concat</span></code>, <code class="docutils literal notranslate"><span class="pre">filter</span></code>, <code class="docutils literal notranslate"><span class="pre">repeat</span></code>, <code class="docutils literal notranslate"><span class="pre">skip</span></code>, <code class="docutils literal notranslate"><span class="pre">split</span></code>, <code class="docutils literal notranslate"><span class="pre">take</span></code>, and <code class="docutils literal notranslate"><span class="pre">zip</span></code> does not support cache.</p></li>
<li><p>Data processed by random data argumentation operations (such as <code class="docutils literal notranslate"><span class="pre">RandomCrop</span></code>) does not support cache.</p></li>
<li><p>The same cache instance cannot be nested in different locations of the same pipeline.</p></li>
</ul>
</section>
<section id="cache-performance-tuning">
<h2>Cache Performance Tuning<a class="headerlink" href="#cache-performance-tuning" title="Permalink to this headline"></a></h2>
<p>The cache service performance can be significantly improved in following scenarios:</p>
<ul class="simple">
<li><p>Cache the data processed by augmentation, especially when the data processing pipeline contains high complexity operations such as decode. In this scenario, you do not need to perform the data augmentation operation repeatedly on each epoch, which saves a lot of time.</p></li>
<li><p>Use cache services during simple network training and inference. Compared with complex networks, simple networks require less training time. Therefore, the time performance is significantly improved when cache services are used in this scenario.</p></li>
</ul>
<p>However, we may not benefit from cache in the following scenarios:</p>
<ul class="simple">
<li><p>The system memory is insufficient or the cache is not hit, resulting in poor cache service time performance. You can check whether the available system memory is sufficient and set a proper cache size before using the cache.</p></li>
<li><p>Too much cache spilling will deteriorate the time performance. Therefore, try not to spill cache to disks when datasets that support random access (such as <code class="docutils literal notranslate"><span class="pre">ImageFolderDataset</span></code>) are used for data loading.</p></li>
<li><p>Using cache on NLP network such as Bert does not perform. In the NLP scenarios, there are usually no high complexity data augmentation operations like decode.</p></li>
<li><p>There is expectable startup overhead when using cache in non-mappable datasets like <code class="docutils literal notranslate"><span class="pre">TFRecordDataset</span></code>. According to the current design, it is required to cache all rows to the cache server before the first epoch of training. So the first epoch time can be longer than the non-cache case.</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="auto_augmentation.html" class="btn btn-neutral float-left" title="Auto Augmentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="execution_management.html" class="btn btn-neutral float-right" title="Execution Management" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, MindSpore.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 
</body>
</html>