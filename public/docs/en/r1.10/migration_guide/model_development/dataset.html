<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Constructing Dataset &mdash; MindSpore master documentation</title>
      <link rel="stylesheet" href="../../_static/css/bootstrap.min.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/training.css" type="text/css" /><link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/js/training.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Network Entity and Loss Construction" href="model_and_loss.html" />
    <link rel="prev" title="Constructing MindSpore Network" href="model_development.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> MindSpore
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Design</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../design/auto_gradient.html">Functional Differential Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../design/distributed_training_design.html">Distributed Training Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../design/mindir.html">MindSpore IR (MindIR)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../design/thor.html">Second Order Optimizer</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.mindspore.cn/mindinsight/docs/en/r1.10/training_visual_design.html">Design of Visualization↗</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../design/glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Specification</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../note/benchmark.html">Benchmarks</a></li>
<li class="toctree-l1"><a class="reference external" href="https://gitee.com/mindspore/models/blob/r1.10/README.md#table-of-contents">Network List↗</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../note/operator_list.html">API List</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../note/syntax_list.html">Syntax Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api_python/mindspore.html">mindspore</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_python/mindspore.amp.html">mindspore.amp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_python/mindspore.common.initializer.html">mindspore.common.initializer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_python/mindspore.communication.html">mindspore.communication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_python/mindspore.dataset.html">mindspore.dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_python/mindspore.dataset.audio.html">mindspore.dataset.audio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_python/mindspore.dataset.config.html">mindspore.dataset.config</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_python/mindspore.dataset.text.html">mindspore.dataset.text</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_python/mindspore.dataset.transforms.html">mindspore.dataset.transforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_python/mindspore.dataset.vision.html">mindspore.dataset.vision</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_python/mindspore.mindrecord.html">mindspore.mindrecord</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_python/mindspore.nn.html">mindspore.nn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_python/mindspore.nn.probability.html">mindspore.nn.probability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_python/mindspore.nn.transformer.html">mindspore.nn.transformer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_python/mindspore.numpy.html">mindspore.numpy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_python/mindspore.ops.html">mindspore.ops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_python/mindspore.ops.function.html">mindspore.ops.function</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_python/mindspore.rewrite.html">mindspore.rewrite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_python/mindspore.scipy.html">mindspore.scipy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_python/mindspore.boost.html">mindspore.boost</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.mindspore.cn/lite/api/en/r1.10/api_cpp/mindspore.html">C++ API↗</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Mapping</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../note/api_mapping/pytorch_api_mapping.html">PyTorch and MindSpore API Mapping Table</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../note/api_mapping/tensorflow_api_mapping.html">TensorFlow and MindSpore API Mapping Table</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Migration Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../enveriment_preparation.html">Environment Preparation and Information Acquisition</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis_and_preparation.html">Model Analysis and Preparation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="model_development.html">Constructing MindSpore Network</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Constructing Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="model_and_loss.html">Network Entity and Loss Construction</a></li>
<li class="toctree-l2"><a class="reference internal" href="learning_rate_and_optimizer.html">Learning Rate and Optimizer</a></li>
<li class="toctree-l2"><a class="reference internal" href="training_and_gradient.html">Network Training and Gadient Derivation</a></li>
<li class="toctree-l2"><a class="reference internal" href="training_and_evaluation_procession.html">Inference and Training Process</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../debug_and_tune.html">Debugging and Tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sample_code.html">Network Migration Debugging Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../typical_api_comparision.html">Differences Between MindSpore and PyTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../use_third_party_op.html">Using Third-party Operator Libraries Based on Customized Interfaces</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FAQ</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../faq/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/data_processing.html">Data Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/implement_problem.html">Implement Problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/network_compilation.html">Network Compilation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/operators_compile.html">Operators Compile</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/usage_migrate_3rd.html">Migration from a Third-party Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/performance_tuning.html">Performance Tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/precision_tuning.html">Precision Tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/distributed_configure.html">Distributed Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/inference.html">Inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/feature_advice.html">Feature Advice</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">RELEASE NOTES</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../RELEASE.html">Release Notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">MindSpore</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="model_development.html">Constructing MindSpore Network</a> &raquo;</li>
      <li>Constructing Dataset</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/migration_guide/model_development/dataset.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="constructing-dataset">
<h1>Constructing Dataset<a class="headerlink" href="#constructing-dataset" title="Permalink to this headline"></a></h1>
<p><a class="reference external" href="https://gitee.com/mindspore/docs/blob/r1.10/docs/mindspore/source_en/migration_guide/model_development/dataset.md"><img alt="View Source On Gitee" src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/r1.10/resource/_static/logo_source_en.png" /></a></p>
<p>This chapter focuses on considerations related to data processing in network migration. For basic data processing, please refer to:</p>
<p><a class="reference external" href="https://www.mindspore.cn/tutorials/en/r1.10/beginner/dataset.html">Data Processing</a></p>
<p><a class="reference external" href="https://www.mindspore.cn/tutorials/experts/en/r1.10/dataset/augment.html">Auto Augmentation</a></p>
<p><a class="reference external" href="https://www.mindspore.cn/tutorials/experts/en/r1.10/dataset/eager.html">Lightweight Data Processing</a></p>
<p><a class="reference external" href="https://www.mindspore.cn/tutorials/experts/en/r1.10/dataset/optimize.html">Optimizing the Data Processing</a></p>
<section id="basic-process-of-data-construction">
<h2>Basic Process of Data Construction<a class="headerlink" href="#basic-process-of-data-construction" title="Permalink to this headline"></a></h2>
<p>The whole basic process of data construction consists of two main aspects: dataset loading and data augmentation.</p>
<section id="loading-dataset">
<h3>Loading Dataset<a class="headerlink" href="#loading-dataset" title="Permalink to this headline"></a></h3>
<p>MindSpore provides interfaces for loading many common datasets. The most used ones are as follows:</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Data Interfaces</p></th>
<th class="head"><p>Introduction</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference external" href="https://www.mindspore.cn/docs/en/r1.10/api_python/dataset/mindspore.dataset.Cifar10Dataset.html#mindspore.dataset.Cifar10Dataset">Cifar10Dataset</a></p></td>
<td><p>Cifar10 dataset read interface (you need to download the original bin file of Cifar10)</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://www.mindspore.cn/docs/en/r1.10/api_python/dataset/mindspore.dataset.MnistDataset.html#mindspore.dataset.MnistDataset">MNIST</a></p></td>
<td><p>Minist handwritten digit recognition dataset (you need to download the original file)</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="https://www.mindspore.cn/docs/en/r1.10/api_python/dataset/mindspore.dataset.ImageFolderDataset.html">ImageFolderDataset</a></p></td>
<td><p>Dataset reading method of using file directories as the data organization format for classification (common for ImageNet)</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://www.mindspore.cn/docs/en/r1.10/api_python/dataset/mindspore.dataset.MindDataset.html#mindspore.dataset.MindDataset">MindDataset</a></p></td>
<td><p>MindRecord data read interface</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="https://www.mindspore.cn/docs/en/r1.10/api_python/dataset/mindspore.dataset.GeneratorDataset.html">GeneratorDataset</a></p></td>
<td><p>customized data interface</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://www.mindspore.cn/docs/en/r1.10/api_python/dataset/mindspore.dataset.FakeImageDataset.html">FakeImageDataset</a></p></td>
<td><p>Constructing a fake image dataset</p></td>
</tr>
</tbody>
</table>
<p>For common dataset interfaces in different fields, refer to <a class="reference external" href="https://www.mindspore.cn/docs/en/r1.10/api_python/mindspore.dataset.html">Loading interfaces to common datasets</a>.</p>
<section id="generatordataset,-a-custom-dataset">
<h4>GeneratorDataset, A Custom Dataset<a class="headerlink" href="#generatordataset,-a-custom-dataset" title="Permalink to this headline"></a></h4>
<p>The basic process for constructing a custom Dataset object is as follows:</p>
<p>First create an iterator class and define three methods <code class="docutils literal notranslate"><span class="pre">__init__</span></code>, <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code> and <code class="docutils literal notranslate"><span class="pre">__len__</span></code> in that class.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="k">class</span> <span class="nc">MyDataset</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Self Defined dataset.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">)))</span>
    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">label</span>
</pre></div>
</div>
<blockquote>
<div><p>It is better not to use MindSpore operators in the iterator class, because it usually adds multiple threads in the data processing phase, which may cause problems.</p>
<p>The output of the iterator needs to be a numpy array.</p>
<p>The iterator must set the <code class="docutils literal notranslate"><span class="pre">__len__</span></code> method, and the returned result must be the real dataset size. Setting it larger will cause problems when gettingitem takes values.</p>
</div></blockquote>
<p>Then use GeneratorDataset to encapsulate the iterator class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore.dataset</span> <span class="k">as</span> <span class="nn">ds</span>

<span class="n">my_dataset</span> <span class="o">=</span> <span class="n">MyDataset</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="c1"># corresponding to torch.utils.data.DataLoader(my_dataset)</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">GeneratorDataset</span><span class="p">(</span><span class="n">my_dataset</span><span class="p">,</span> <span class="n">column_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>When customizing the dataset, you need to set a name for each output, such as <code class="docutils literal notranslate"><span class="pre">column_names=[&quot;data&quot;,</span> <span class="pre">&quot;label&quot;]</span></code> above, indicating that the first output column of the iterator is <code class="docutils literal notranslate"><span class="pre">data</span></code> and the second is <code class="docutils literal notranslate"><span class="pre">label</span></code>. In the subsequent data augmentation and data iteration obtaining phases, the different columns can be processed separately by name.</p>
<p><strong>All MindSpore data interfaces</strong> have some general attribute controls, and some of the common ones are described here:</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Attributes</p></th>
<th class="head"><p>Introduction</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>num_samples(int)</p></td>
<td><p>Specify the total number of data samples</p></td>
</tr>
<tr class="row-odd"><td><p>shuffle(bool)</p></td>
<td><p>Whether to do random disruptions to the data</p></td>
</tr>
<tr class="row-even"><td><p>sampler(Sampler)</p></td>
<td><p>Data sampler, customizing data disruption, allocation. <code class="docutils literal notranslate"><span class="pre">sampler</span></code> setting and <code class="docutils literal notranslate"><span class="pre">num_shards</span></code>, <code class="docutils literal notranslate"><span class="pre">shard_id</span></code> mutually exclusive</p></td>
</tr>
<tr class="row-odd"><td><p>num_shards(int)</p></td>
<td><p>Used in distributed scenarios to divide data into several parts, used in conjunction with <code class="docutils literal notranslate"><span class="pre">shard_id</span></code></p></td>
</tr>
<tr class="row-even"><td><p>shard_id(int)</p></td>
<td><p>For distributed scenarios, taking nth data (n ranges from 0 to n-1, and n is the set <code class="docutils literal notranslate"><span class="pre">num_shards</span></code>), used in conjunction with <code class="docutils literal notranslate"><span class="pre">num_shards</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>num_parallel_workers(int)</p></td>
<td><p>Number of threads in parallel configuration</p></td>
</tr>
</tbody>
</table>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore.dataset</span> <span class="k">as</span> <span class="nn">ds</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">FakeImageDataset</span><span class="p">(</span><span class="n">num_images</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">image_size</span><span class="o">=</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">num_classes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">base_seed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">get_dataset_size</span><span class="p">())</span>
<span class="c1"># 1000</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">FakeImageDataset</span><span class="p">(</span><span class="n">num_images</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">image_size</span><span class="o">=</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">num_classes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">base_seed</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">get_dataset_size</span><span class="p">())</span>
<span class="c1"># 3</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">FakeImageDataset</span><span class="p">(</span><span class="n">num_images</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">image_size</span><span class="o">=</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">num_classes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">base_seed</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                              <span class="n">num_shards</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">shard_id</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">get_dataset_size</span><span class="p">())</span>
<span class="c1"># 1000 / 8 = 125</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>1000
3
125
</pre></div>
</div>
</section>
</section>
<section id="data-processing-and-augmentation">
<h3>Data Processing and Augmentation<a class="headerlink" href="#data-processing-and-augmentation" title="Permalink to this headline"></a></h3>
<p>MindSpore dataset object uses the map interface for data augmentation. See <a class="reference external" href="https://www.mindspore.cn/docs/en/r1.10/api_python/dataset/mindspore.dataset.GeneratorDataset.html#mindspore.dataset.GeneratorDataset.map">map Interface</a></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>map(operations, input_columns=None, output_columns=None, column_order=None, num_parallel_workers=None, python_multiprocessing=False, cache=None, callbacks=None, max_rowsize=16, offload=None)
</pre></div>
</div>
<p>Given a set of data augmentation lists, data augmentations are applied to the dataset objects in order.</p>
<p>Each data augmentation operation takes one or more data columns in the dataset object as input and outputs the result of the data augmentation as one or more data columns. The first data augmentation operation takes the specified columns in input_columns as input. If there are multiple data augmentation operations in the data augmentation list, the output columns of the previous data augmentation will be used as input columns for the next data augmentation.</p>
<p>The column name of output column in the last data augmentation is specified by <code class="docutils literal notranslate"><span class="pre">output_columns</span></code>. If <code class="docutils literal notranslate"><span class="pre">output_columns</span></code> is not specified, the output column name is the same as <code class="docutils literal notranslate"><span class="pre">input_columns</span></code>.</p>
<p>The above introduction may be tedious, but in short, <code class="docutils literal notranslate"><span class="pre">map</span></code> is to do the operations specified in <code class="docutils literal notranslate"><span class="pre">operations</span></code> on some columns of the dataset. Here <code class="docutils literal notranslate"><span class="pre">operations</span></code> can be the data augmentation provided by MindSpore.</p>
<p><a class="reference external" href="https://www.mindspore.cn/docs/en/r1.10/api_python/mindspore.dataset.audio.html">audio</a>, <a class="reference external" href="https://www.mindspore.cn/docs/en/r1.10/api_python/mindspore.dataset.text.html">text</a>, <a class="reference external" href="https://www.mindspore.cn/docs/en/r1.10/api_python/mindspore.dataset.vision.html">vision</a>, and <a class="reference external" href="https://www.mindspore.cn/docs/en/r1.10/api_python/mindspore.dataset.transforms.html">transforms</a>. For more details, refer to <a class="reference external" href="https://www.mindspore.cn/tutorials/en/r1.10/beginner/transforms.html">Data Transforms</a>, which is also a method of python. You can use opencv, PIL, pandas and some other third party methods, like loading dataset. <strong>Don’t use MindSpore operators</strong>.</p>
<p>MindSpore also provides some common random augmentation methods: <a class="reference external" href="https://www.mindspore.cn/tutorials/experts/en/r1.10/dataset/augment.html">Auto augmentation</a>. When using data augmentation specifically, it is best to read <a class="reference external" href="https://www.mindspore.cn/tutorials/experts/en/r1.10/dataset/optimize.html">Optimizing the Data Processing</a> in the recommended order.</p>
<p>At the end of data augmentation, you can use the batch operator to merge <code class="docutils literal notranslate"><span class="pre">batch_size</span></code> pieces of consecutive data in the dataset into a single batch data. For details, please refer to <a class="reference external" href="https://www.mindspore.cn/docs/en/r1.10/api_python/dataset/mindspore.dataset.GeneratorDataset.html#mindspore.dataset.GeneratorDataset.batch">batch</a>. Note that the parameter <code class="docutils literal notranslate"><span class="pre">drop_remainder</span></code> needs to be set to True during training and False during inference.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore.dataset</span> <span class="k">as</span> <span class="nn">ds</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">FakeImageDataset</span><span class="p">(</span><span class="n">num_images</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">image_size</span><span class="o">=</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">num_classes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">base_seed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">drop_remainder</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">get_dataset_size</span><span class="p">())</span>
<span class="c1"># 1000 // 32 = 31</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">FakeImageDataset</span><span class="p">(</span><span class="n">num_images</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">image_size</span><span class="o">=</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">num_classes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">base_seed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">drop_remainder</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">get_dataset_size</span><span class="p">())</span>
<span class="c1"># ceil(1000 / 32) = 32</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>31
32
</pre></div>
</div>
<p>The batch operator can also use some augmentation operations within batch. For details, see <a class="reference external" href="https://gitee.com/mindspore/models/blob/r1.10/official/cv/yolov3_darknet53/src/yolo_dataset.py#L177">YOLOv3</a>.</p>
</section>
</section>
<section id="data-iteration">
<h2>Data Iteration<a class="headerlink" href="#data-iteration" title="Permalink to this headline"></a></h2>
<p>MindSpore data objects are obtained iteratively in the following ways.</p>
<section id="create-dict-iterator">
<h3><a class="reference external" href="https://www.mindspore.cn/docs/en/r1.10/api_python/dataset/mindspore.dataset.GeneratorDataset.html#mindspore.dataset.GeneratorDataset.create_dict_iterator">create_dict_iterator</a><a class="headerlink" href="#create-dict-iterator" title="Permalink to this headline"></a></h3>
<p>Creates an iterator based on the dataset object, and the output data is of dictionary type.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore.dataset</span> <span class="k">as</span> <span class="nn">ds</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">FakeImageDataset</span><span class="p">(</span><span class="n">num_images</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">image_size</span><span class="o">=</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">num_classes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">base_seed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">drop_remainder</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">iterator</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">create_dict_iterator</span><span class="p">()</span>
<span class="k">for</span> <span class="n">data_dict</span> <span class="ow">in</span> <span class="n">iterator</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">data_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">data_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>image (10, 32, 32, 3)
label (10,)
====================
image (10, 32, 32, 3)
label (10,)
====================
</pre></div>
</div>
</section>
<section id="create-tuple-iterator">
<h3><a class="reference external" href="https://www.mindspore.cn/docs/en/r1.10/api_python/dataset/mindspore.dataset.GeneratorDataset.html#mindspore.dataset.GeneratorDataset.create_tuple_iterator">create_tuple_iterator</a><a class="headerlink" href="#create-tuple-iterator" title="Permalink to this headline"></a></h3>
<p>Create an iterator based on the dataset object, and output data is a list of <code class="docutils literal notranslate"><span class="pre">numpy.ndarray</span></code> data.</p>
<p>You can specify all column names and the order of the columns in the output by the parameter <code class="docutils literal notranslate"><span class="pre">columns</span></code>. If columns is not specified, the order of the columns will remain the same.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore.dataset</span> <span class="k">as</span> <span class="nn">ds</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">FakeImageDataset</span><span class="p">(</span><span class="n">num_images</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">image_size</span><span class="o">=</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">num_classes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">base_seed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">drop_remainder</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">iterator</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">create_tuple_iterator</span><span class="p">()</span>
<span class="k">for</span> <span class="n">data_tuple</span> <span class="ow">in</span> <span class="n">iterator</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">data_tuple</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>(10, 32, 32, 3)
(10,)
====================
(10, 32, 32, 3)
(10,)
====================
</pre></div>
</div>
</section>
<section id="traversing-directly-over-dataset-objects">
<h3>Traversing Directly over dataset Objects<a class="headerlink" href="#traversing-directly-over-dataset-objects" title="Permalink to this headline"></a></h3>
<blockquote>
<div><p>Note that this writing method does not <code class="docutils literal notranslate"><span class="pre">shuffle</span></code> after traversing an epoch, so it may affect the precision when used in training. The above two methods are recommended when direct data iterations are needed during training.</p>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore.dataset</span> <span class="k">as</span> <span class="nn">ds</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">FakeImageDataset</span><span class="p">(</span><span class="n">num_images</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">image_size</span><span class="o">=</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">num_classes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">base_seed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">drop_remainder</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>(10, 32, 32, 3)
(10,)
====================
(10, 32, 32, 3)
(10,)
====================
</pre></div>
</div>
<p>The latter two of these can be used directly when the order of data read is the same as the order required by the network.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">:</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="n">net</span><span class="p">(</span><span class="o">*</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="model_development.html" class="btn btn-neutral float-left" title="Constructing MindSpore Network" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="model_and_loss.html" class="btn btn-neutral float-right" title="Network Entity and Loss Construction" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, MindSpore.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 
</body>
</html>