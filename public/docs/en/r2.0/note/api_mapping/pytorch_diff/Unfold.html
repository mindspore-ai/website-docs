<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Function Differences with torch.nn.Unfold &mdash; MindSpore master documentation</title>
      <link rel="stylesheet" href="../../../_static/css/bootstrap.min.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/training.css" type="text/css" /><link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/js/training.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> MindSpore
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Design</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../design/overview.html">MindSpore Design Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../design/programming_paradigm.html">Programming Paradigm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../design/auto_gradient.html">Functional Differential Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../design/mindir.html">MindSpore IR (MindIR)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../design/all_scenarios.html">Full-scenarios Unification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../design/dynamic_graph_and_static_graph.html">Combination of Dynamic and Static Graphs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../design/pluggable_device.html">Third-Party Hardware Interconnection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../design/distributed_training_design.html">Distributed Training Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../design/graph_fusion_engine.html">Graph-Kernel Fusion Acceleration Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../design/data_engine.html">High Performance Data Processing Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../design/glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Models</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../official_models.html">Official Models</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api_python/mindspore.html">mindspore</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api_python/mindspore.nn.html">mindspore.nn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api_python/mindspore.ops.html">mindspore.ops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api_python/mindspore.ops.primitive.html">mindspore.ops.primitive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api_python/mindspore.amp.html">mindspore.amp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api_python/mindspore.train.html">mindspore.train</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api_python/mindspore.communication.html">mindspore.communication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api_python/mindspore.common.initializer.html">mindspore.common.initializer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api_python/mindspore.dataset.html">mindspore.dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api_python/mindspore.dataset.transforms.html">mindspore.dataset.transforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api_python/mindspore.mindrecord.html">mindspore.mindrecord</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api_python/mindspore.nn.probability.html">mindspore.nn.probability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api_python/mindspore.rewrite.html">mindspore.rewrite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api_python/mindspore.boost.html">mindspore.boost</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api_python/mindspore.numpy.html">mindspore.numpy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api_python/mindspore.scipy.html">mindspore.scipy</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.mindspore.cn/lite/api/en/r2.0/api_cpp/mindspore.html">C++ API↗</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Mapping</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pytorch_api_mapping.html">PyTorch and MindSpore API Mapping Table</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tensorflow_api_mapping.html">TensorFlow and MindSpore API Mapping Table</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Migration Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../migration_guide/overview.html">Overview of Migration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../migration_guide/enveriment_preparation.html">Environment Preparation and Information Acquisition</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../migration_guide/analysis_and_preparation.html">Model Analysis and Preparation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../migration_guide/model_development/model_development.html">Constructing MindSpore Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../migration_guide/debug_and_tune.html">Debugging and Tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../migration_guide/sample_code.html">Network Migration Debugging Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../migration_guide/faq.html">FAQs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Syntax Support</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../static_graph_syntax_support.html">Static Graph Syntax Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../index_support.html">Tensor Index Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FAQ</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../faq/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq/data_processing.html">Data Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq/implement_problem.html">Implement Problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq/network_compilation.html">Network Compilation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq/operators_compile.html">Operators Compile</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq/usage_migrate_3rd.html">Migration from a Third-party Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq/performance_tuning.html">Performance Tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq/precision_tuning.html">Precision Tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq/distributed_parallel.html">Distributed Parallel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq/inference.html">Inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq/feature_advice.html">Feature Advice</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">RELEASE NOTES</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../RELEASE.html">Release Notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">MindSpore</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Function Differences with torch.nn.Unfold</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/note/api_mapping/pytorch_diff/Unfold.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="function-differences-with-torch-nn-unfold">
<h1>Function Differences with torch.nn.Unfold<a class="headerlink" href="#function-differences-with-torch-nn-unfold" title="Permalink to this headline"></a></h1>
<p><a href="https://gitee.com/mindspore/docs/blob/r2.0/docs/mindspore/source_en/note/api_mapping/pytorch_diff/Unfold.md" target="_blank"><img src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/r2.0/resource/_static/logo_source_en.png"></a></p>
<section id="torch-nn-unfold">
<h2>torch.nn.Unfold<a class="headerlink" href="#torch-nn-unfold" title="Permalink to this headline"></a></h2>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>torch.nn.Unfold(kernel_size, dilation=1, padding=0, stride=1)(input) -&gt; Tensor
</pre></div>
</div>
<p>For more information, see <a class="reference external" href="https://pytorch.org/docs/1.8.1/generated/torch.nn.Unfold.html">torch.nn.Unfold</a>.</p>
</section>
<section id="mindspore-nn-unfold">
<h2>mindspore.nn.Unfold<a class="headerlink" href="#mindspore-nn-unfold" title="Permalink to this headline"></a></h2>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>class mindspore.nn.Unfold(ksizes, strides, rates, padding=&#39;valid&#39;)(x) -&gt; Tensor
</pre></div>
</div>
<p>For more information, see <a class="reference external" href="https://mindspore.cn/docs/en/r2.0/api_python/nn/mindspore.nn.Unfold.html">mindspore.nn.Unfold</a>.</p>
</section>
<section id="differences">
<h2>Differences<a class="headerlink" href="#differences" title="Permalink to this headline"></a></h2>
<p>PyTorch: Extracts the sliding local area blocks from the batch input tensor. The shape of the input tensor is (N, C, H, W), where N is the batch size, C is the number of channels, H is the height, and W is the width. The output is a three-dimensional Tensor.</p>
<p>MindSpore: Implementation function of API in MinSpore differs from that of PyTorch. kernel_size, stride, and dilation of PyTorch support int and tuple inputs, and padding supports implicit zero padding added on either side of the input, while MindSpore ksizes, strides and rates three parameters must be the format of (1, row, col, 1), and padding parameters support two formats same and valid. MindSpore input is a four-dimensional tensor with shape (in_batch, in_depth, in_row, int_col), and output is a four-dimensional Tensor with shape (out_batch, out_depth, out_row, out_col), where out_batch and in_batch are the same.</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Categories</p></th>
<th class="head"><p>Subcategories</p></th>
<th class="head"><p>PyTorch</p></th>
<th class="head"><p>MindSpore</p></th>
<th class="head"><p>Difference</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Input</p></td>
<td><p>Single input</p></td>
<td><p>input</p></td>
<td><p>x</p></td>
<td><p>Both are input four-dimensional Tensor with data format NCHW</p></td>
</tr>
<tr class="row-odd"><td><p>Parameters</p></td>
<td><p>Parameter 1</p></td>
<td><p>kernel_size</p></td>
<td><p>ksizes</p></td>
<td><p>The function is the same, but the input format is not. Both indicate the size of the sliding window. PyTorch supports int and tuple inputs. If kernel_size is an int, its value will be replicated in all dimensions. MindSpore supports tuple or list of the format (1, ksize_row, ksize_col, 1)</p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p>Parameter 2</p></td>
<td><p>dilation</p></td>
<td><p>rates</p></td>
<td><p>The function is the same, but the input format is not. dilation indicates the number of elements spanned during the control slide, supports int and tuple input, and default value is 1. If dilation is an int, its value will be replicated in all dimensions. rates indicates the number of holes between slide elements, supports tuple or list of the format (1, rate_row, rate_col, 1)</p></td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p>Parameter 3</p></td>
<td><p>padding</p></td>
<td><p>padding</p></td>
<td><p>The function is the same. Indicating padding mode, PyTorch is zero padding on both sides of the input and supports int and tuple inputs, and the default value is 0. If padding is an int, its value will be copied in all dimensions. MindSpore supports str input, with optional values “same” or “valid”, and the default value is “valid”, which means the extracted region block is covered by the original input. The value “same” means part of the extracted region block can perform zero padding outside the original input.</p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p>Parameter 4</p></td>
<td><p>stride</p></td>
<td><p>strides</p></td>
<td><p>The function is the same, but the input format is not. Both indicate the step size of the sliding window in the spatial dimension. PyTorch supports int and tuple inputs, with a default value of 1. If stride is an int, its value will be replicated in all dimensions. MindSpore supports tuples or lists of the format (1, stride_row, stride_col, 1).</p></td>
</tr>
</tbody>
</table>
<section id="code-example-1">
<h3>Code Example 1<a class="headerlink" href="#code-example-1" title="Permalink to this headline"></a></h3>
<blockquote>
<div><p>PyTorch stride defaults to 1, dilation defaults to 1, and padding defaults to 0. Since the input is a four-dimensional Tensor and the default values of all three parameters are int, they will be replicated in all dimensions. To obtain the same results as PyTorch, MindSpore first sets the strides, rates and padding of the Unfold operator to (1, 1, 1, 1), (1, 1, 1, 1) and “valid”, respectively. Set ksizes to (1, a, a, 1) if kernel_size is an int, i.e., if kernel_size=a. If kernel_size is a tuple, i.e. kernel_size=(a,b), set ksizes to (1, a, b, 1), and secondly, in order to have the same output result, the output result of MindSpore will be Reshape, and then the final result will be obtained by the following operation of Concat.</p>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># PyTorch</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">Tensor</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="nb">input</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="n">torch_unfold</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Unfold</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dilation</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">torch_output</span> <span class="o">=</span> <span class="n">torch_unfold</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
<span class="c1"># torch_output.shape=(1, 8, 9)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">torch_output</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
<span class="c1"># [[[ 0.  1.  2.  4.  5.  6.  8.  9. 10.]</span>
<span class="c1">#   [ 1.  2.  3.  5.  6.  7.  9. 10. 11.]</span>
<span class="c1">#   [ 4.  5.  6.  8.  9. 10. 12. 13. 14.]</span>
<span class="c1">#   [ 5.  6.  7.  9. 10. 11. 13. 14. 15.]</span>
<span class="c1">#   [16. 17. 18. 20. 21. 22. 24. 25. 26.]</span>
<span class="c1">#   [17. 18. 19. 21. 22. 23. 25. 26. 27.]</span>
<span class="c1">#   [20. 21. 22. 24. 25. 26. 28. 29. 30.]</span>
<span class="c1">#   [21. 22. 23. 25. 26. 27. 29. 30. 31.]]]</span>

<span class="c1"># MindSpore</span>
<span class="kn">import</span> <span class="nn">mindspore</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">Tensor</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="nb">input</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="n">ms_unfold</span> <span class="o">=</span> <span class="n">mindspore</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Unfold</span><span class="p">(</span><span class="n">ksizes</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">rates</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;valid&quot;</span><span class="p">,</span> <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">ms_output</span> <span class="o">=</span> <span class="n">ms_unfold</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
<span class="c1"># ms_output.shape = (1, 8, 3, 3)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ms_output</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">())</span>
<span class="c1"># [[[[ 0.  1.  2.]</span>
<span class="c1">#    [ 4.  5.  6.]</span>
<span class="c1">#    [ 8.  9. 10.]]</span>

<span class="c1">#   [[16. 17. 18.]</span>
<span class="c1">#    [20. 21. 22.]</span>
<span class="c1">#    [24. 25. 26.]]</span>

<span class="c1">#   [[ 1.  2.  3.]</span>
<span class="c1">#    [ 5.  6.  7.]</span>
<span class="c1">#    [ 9. 10. 11.]]</span>

<span class="c1">#   [[17. 18. 19.]</span>
<span class="c1">#    [21. 22. 23.]</span>
<span class="c1">#    [25. 26. 27.]]</span>

<span class="c1">#   [[ 4.  5.  6.]</span>
<span class="c1">#    [ 8.  9. 10.]</span>
<span class="c1">#    [12. 13. 14.]]</span>

<span class="c1">#   [[20. 21. 22.]</span>
<span class="c1">#    [24. 25. 26.]</span>
<span class="c1">#    [28. 29. 30.]]</span>

<span class="c1">#   [[ 5.  6.  7.]</span>
<span class="c1">#    [ 9. 10. 11.]</span>
<span class="c1">#    [13. 14. 15.]]</span>

<span class="c1">#   [[21. 22. 23.]</span>
<span class="c1">#    [25. 26. 27.]</span>
<span class="c1">#    [29. 30. 31.]]]]</span>
<span class="n">out_batch</span><span class="p">,</span> <span class="n">out_depth</span><span class="p">,</span> <span class="n">out_row</span><span class="p">,</span> <span class="n">out_col</span> <span class="o">=</span> <span class="n">ms_output</span><span class="o">.</span><span class="n">shape</span>
<span class="n">ms_reshape</span> <span class="o">=</span> <span class="n">mindspore</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Reshape</span><span class="p">()</span>
<span class="n">ms_output</span> <span class="o">=</span> <span class="n">ms_reshape</span><span class="p">(</span><span class="n">ms_output</span><span class="p">,</span> <span class="p">(</span><span class="n">out_batch</span><span class="p">,</span> <span class="n">out_depth</span><span class="p">,</span> <span class="n">out_row</span> <span class="o">*</span> <span class="n">out_col</span><span class="p">))</span>
<span class="c1"># ms_output.shape = (1, 8, 9)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ms_output</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">())</span>
<span class="c1"># [[[ 0.  1.  2.  4.  5.  6.  8.  9. 10.]</span>
<span class="c1">#   [16. 17. 18. 20. 21. 22. 24. 25. 26.]</span>
<span class="c1">#   [ 1.  2.  3.  5.  6.  7.  9. 10. 11.]</span>
<span class="c1">#   [17. 18. 19. 21. 22. 23. 25. 26. 27.]</span>
<span class="c1">#   [ 4.  5.  6.  8.  9. 10. 12. 13. 14.]</span>
<span class="c1">#   [20. 21. 22. 24. 25. 26. 28. 29. 30.]</span>
<span class="c1">#   [ 5.  6.  7.  9. 10. 11. 13. 14. 15.]</span>
<span class="c1">#   [21. 22. 23. 25. 26. 27. 29. 30. 31.]]]</span>
<span class="n">ms_concat</span> <span class="o">=</span> <span class="n">mindspore</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Concat</span><span class="p">()</span>
<span class="n">output</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">out_batch</span><span class="p">):</span>
    <span class="n">odd</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">even</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">out_depth</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">ms_output</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,:]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">ms_reshape</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">j</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">even</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">even</span> <span class="o">=</span> <span class="n">data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">even</span> <span class="o">=</span> <span class="n">ms_concat</span><span class="p">((</span><span class="n">even</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">odd</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">odd</span> <span class="o">=</span> <span class="n">data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">odd</span> <span class="o">=</span> <span class="n">ms_concat</span><span class="p">((</span><span class="n">odd</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">ms_concat</span><span class="p">((</span><span class="n">even</span><span class="p">,</span> <span class="n">odd</span><span class="p">))</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">ms_reshape</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">temp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">temp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">temp</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">ms_concat</span><span class="p">((</span><span class="n">output</span><span class="p">,</span> <span class="n">temp</span><span class="p">))</span>
<span class="n">ms_output</span> <span class="o">=</span> <span class="n">output</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ms_output</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">())</span>
<span class="c1"># [[[ 0.  1.  2.  4.  5.  6.  8.  9. 10.]</span>
<span class="c1">#   [ 1.  2.  3.  5.  6.  7.  9. 10. 11.]</span>
<span class="c1">#   [ 4.  5.  6.  8.  9. 10. 12. 13. 14.]</span>
<span class="c1">#   [ 5.  6.  7.  9. 10. 11. 13. 14. 15.]</span>
<span class="c1">#   [16. 17. 18. 20. 21. 22. 24. 25. 26.]</span>
<span class="c1">#   [17. 18. 19. 21. 22. 23. 25. 26. 27.]</span>
<span class="c1">#   [20. 21. 22. 24. 25. 26. 28. 29. 30.]</span>
<span class="c1">#   [21. 22. 23. 25. 26. 27. 29. 30. 31.]]]</span>
</pre></div>
</div>
</section>
<section id="code-example-2">
<h3>Code Example 2<a class="headerlink" href="#code-example-2" title="Permalink to this headline"></a></h3>
<blockquote>
<div><p>With the default value of 0 for PyTorch padding parameter and “valid” for MindSpore padding, set ksizes to (1, a, a, 1) if kernel_size is an int, i.e. kernel_size=a, when the remaining three parameters are set correspondingly. If kernel_size is a tuple, i.e. kernel_size=(a,b), set ksizes to (1, a, b, 1). If stride is an int, i.e. stride=a, set strides to (1, a, a, 1). If stride is a tuple, i.e. stride=(a,b), set strides to (1, a, b, 1). If dilation is an int, i.e. dilation=a, set rates to (1, a, a, 1); and if dilation is a tuple, i.e. dilation=(a,b), set rates to (1, a, b, 1). Secondly, in order to get the same output result, the output of MindSpore is Reshape, and then the final result is Concat by the following operation.</p>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># PyTorch</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">Tensor</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="nb">input</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="n">torch_unfold</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Unfold</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">dilation</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">torch_output</span> <span class="o">=</span> <span class="n">torch_unfold</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
<span class="c1"># torch_output.shape=(1, 8, 9)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">torch_output</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
<span class="c1"># [[[ 0.  1.  2.  4.  5.  6.  8.  9. 10.]</span>
<span class="c1">#   [ 1.  2.  3.  5.  6.  7.  9. 10. 11.]</span>
<span class="c1">#   [ 4.  5.  6.  8.  9. 10. 12. 13. 14.]</span>
<span class="c1">#   [ 5.  6.  7.  9. 10. 11. 13. 14. 15.]</span>
<span class="c1">#   [16. 17. 18. 20. 21. 22. 24. 25. 26.]</span>
<span class="c1">#   [17. 18. 19. 21. 22. 23. 25. 26. 27.]</span>
<span class="c1">#   [20. 21. 22. 24. 25. 26. 28. 29. 30.]</span>
<span class="c1">#   [21. 22. 23. 25. 26. 27. 29. 30. 31.]]]</span>

<span class="c1"># MindSpore</span>
<span class="kn">import</span> <span class="nn">mindspore</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">Tensor</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="nb">input</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="n">ms_unfold</span> <span class="o">=</span> <span class="n">mindspore</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Unfold</span><span class="p">(</span><span class="n">ksizes</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">rates</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;valid&quot;</span><span class="p">,</span> <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">ms_output</span> <span class="o">=</span> <span class="n">ms_unfold</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
<span class="c1"># ms_output.shape = (1, 8, 3, 3)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ms_output</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">())</span>
<span class="c1"># [[[[ 0.  1.  2.]</span>
<span class="c1">#    [ 4.  5.  6.]</span>
<span class="c1">#    [ 8.  9. 10.]]</span>

<span class="c1">#   [[16. 17. 18.]</span>
<span class="c1">#    [20. 21. 22.]</span>
<span class="c1">#    [24. 25. 26.]]</span>

<span class="c1">#   [[ 1.  2.  3.]</span>
<span class="c1">#    [ 5.  6.  7.]</span>
<span class="c1">#    [ 9. 10. 11.]]</span>

<span class="c1">#   [[17. 18. 19.]</span>
<span class="c1">#    [21. 22. 23.]</span>
<span class="c1">#    [25. 26. 27.]]</span>

<span class="c1">#   [[ 4.  5.  6.]</span>
<span class="c1">#    [ 8.  9. 10.]</span>
<span class="c1">#    [12. 13. 14.]]</span>

<span class="c1">#   [[20. 21. 22.]</span>
<span class="c1">#    [24. 25. 26.]</span>
<span class="c1">#    [28. 29. 30.]]</span>

<span class="c1">#   [[ 5.  6.  7.]</span>
<span class="c1">#    [ 9. 10. 11.]</span>
<span class="c1">#    [13. 14. 15.]]</span>

<span class="c1">#   [[21. 22. 23.]</span>
<span class="c1">#    [25. 26. 27.]</span>
<span class="c1">#    [29. 30. 31.]]]]</span>
<span class="n">out_batch</span><span class="p">,</span> <span class="n">out_depth</span><span class="p">,</span> <span class="n">out_row</span><span class="p">,</span> <span class="n">out_col</span> <span class="o">=</span> <span class="n">ms_output</span><span class="o">.</span><span class="n">shape</span>
<span class="n">ms_reshape</span> <span class="o">=</span> <span class="n">mindspore</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Reshape</span><span class="p">()</span>
<span class="n">ms_output</span> <span class="o">=</span> <span class="n">ms_reshape</span><span class="p">(</span><span class="n">ms_output</span><span class="p">,</span> <span class="p">(</span><span class="n">out_batch</span><span class="p">,</span> <span class="n">out_depth</span><span class="p">,</span> <span class="n">out_row</span> <span class="o">*</span> <span class="n">out_col</span><span class="p">))</span>
<span class="c1"># ms_output.shape = (1, 8, 9)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ms_output</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">())</span>
<span class="c1"># [[[ 0.  1.  2.  4.  5.  6.  8.  9. 10.]</span>
<span class="c1">#   [16. 17. 18. 20. 21. 22. 24. 25. 26.]</span>
<span class="c1">#   [ 1.  2.  3.  5.  6.  7.  9. 10. 11.]</span>
<span class="c1">#   [17. 18. 19. 21. 22. 23. 25. 26. 27.]</span>
<span class="c1">#   [ 4.  5.  6.  8.  9. 10. 12. 13. 14.]</span>
<span class="c1">#   [20. 21. 22. 24. 25. 26. 28. 29. 30.]</span>
<span class="c1">#   [ 5.  6.  7.  9. 10. 11. 13. 14. 15.]</span>
<span class="c1">#   [21. 22. 23. 25. 26. 27. 29. 30. 31.]]]</span>
<span class="n">ms_concat</span> <span class="o">=</span> <span class="n">mindspore</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Concat</span><span class="p">()</span>
<span class="n">output</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">out_batch</span><span class="p">):</span>
    <span class="n">odd</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">even</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">out_depth</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">ms_output</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,:]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">ms_reshape</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">j</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">even</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">even</span> <span class="o">=</span> <span class="n">data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">even</span> <span class="o">=</span> <span class="n">ms_concat</span><span class="p">((</span><span class="n">even</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">odd</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">odd</span> <span class="o">=</span> <span class="n">data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">odd</span> <span class="o">=</span> <span class="n">ms_concat</span><span class="p">((</span><span class="n">odd</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">ms_concat</span><span class="p">((</span><span class="n">even</span><span class="p">,</span> <span class="n">odd</span><span class="p">))</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">ms_reshape</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">temp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">temp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">temp</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">ms_concat</span><span class="p">((</span><span class="n">output</span><span class="p">,</span> <span class="n">temp</span><span class="p">))</span>
<span class="n">ms_output</span> <span class="o">=</span> <span class="n">output</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ms_output</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">())</span>
<span class="c1"># [[[ 0.  1.  2.  4.  5.  6.  8.  9. 10.]</span>
<span class="c1">#   [ 1.  2.  3.  5.  6.  7.  9. 10. 11.]</span>
<span class="c1">#   [ 4.  5.  6.  8.  9. 10. 12. 13. 14.]</span>
<span class="c1">#   [ 5.  6.  7.  9. 10. 11. 13. 14. 15.]</span>
<span class="c1">#   [16. 17. 18. 20. 21. 22. 24. 25. 26.]</span>
<span class="c1">#   [17. 18. 19. 21. 22. 23. 25. 26. 27.]</span>
<span class="c1">#   [20. 21. 22. 24. 25. 26. 28. 29. 30.]</span>
<span class="c1">#   [21. 22. 23. 25. 26. 27. 29. 30. 31.]]]</span>
</pre></div>
</div>
</section>
<section id="code-example-3">
<h3>Code Example 3<a class="headerlink" href="#code-example-3" title="Permalink to this headline"></a></h3>
<blockquote>
<div><p>PyTorch padding means zero padding on both sides of the input, and supports both int and tuple inputs. The default value is 0, which corresponds to MindSpore padding taking the default value of “valid”. When PyTorch padding takes other values, and MindSpore padding only has the values “valid” and “same”, there is no corresponding value, so the output is inconsistent.</p>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># PyTorch</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">Tensor</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="nb">input</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="n">torch_unfold</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Unfold</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">dilation</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">torch_output</span> <span class="o">=</span> <span class="n">torch_unfold</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
<span class="c1"># ms_output.shape = (1, 8, 25)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">torch_output</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
<span class="c1"># [[[ 0.  0.  0.  0.  0.  0.  0.  1.  2.  3.  0.  4.  5.  6.  7.  0.  8.</span>
<span class="c1">#     9. 10. 11.  0. 12. 13. 14. 15.]</span>
<span class="c1">#   [ 0.  0.  0.  0.  0.  0.  1.  2.  3.  0.  4.  5.  6.  7.  0.  8.  9.</span>
<span class="c1">#    10. 11.  0. 12. 13. 14. 15.  0.]</span>
<span class="c1">#   [ 0.  0.  1.  2.  3.  0.  4.  5.  6.  7.  0.  8.  9. 10. 11.  0. 12.</span>
<span class="c1">#    13. 14. 15.  0.  0.  0.  0.  0.]</span>
<span class="c1">#   [ 0.  1.  2.  3.  0.  4.  5.  6.  7.  0.  8.  9. 10. 11.  0. 12. 13.</span>
<span class="c1">#    14. 15.  0.  0.  0.  0.  0.  0.]</span>
<span class="c1">#   [ 0.  0.  0.  0.  0.  0. 16. 17. 18. 19.  0. 20. 21. 22. 23.  0. 24.</span>
<span class="c1">#    25. 26. 27.  0. 28. 29. 30. 31.]</span>
<span class="c1">#   [ 0.  0.  0.  0.  0. 16. 17. 18. 19.  0. 20. 21. 22. 23.  0. 24. 25.</span>
<span class="c1">#    26. 27.  0. 28. 29. 30. 31.  0.]</span>
<span class="c1">#   [ 0. 16. 17. 18. 19.  0. 20. 21. 22. 23.  0. 24. 25. 26. 27.  0. 28.</span>
<span class="c1">#    29. 30. 31.  0.  0.  0.  0.  0.]</span>
<span class="c1">#   [16. 17. 18. 19.  0. 20. 21. 22. 23.  0. 24. 25. 26. 27.  0. 28. 29.</span>
<span class="c1">#    30. 31.  0.  0.  0.  0.  0.  0.]]]</span>

<span class="c1"># MindSpore</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">mindspore</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">Tensor</span>
<span class="c1"># MindSpore</span>
<span class="kn">import</span> <span class="nn">mindspore</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">Tensor</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="nb">input</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="n">ms_unfold</span> <span class="o">=</span> <span class="n">mindspore</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Unfold</span><span class="p">(</span><span class="n">ksizes</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">rates</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;same&quot;</span><span class="p">,</span> <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">ms_output</span> <span class="o">=</span> <span class="n">ms_unfold</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
<span class="c1"># ms_output.shape = (1, 8, 4, 4)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ms_output</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">())</span>
<span class="c1"># [[[[ 0.  1.  2.  3.]</span>
<span class="c1">#    [ 4.  5.  6.  7.]</span>
<span class="c1">#    [ 8.  9. 10. 11.]</span>
<span class="c1">#    [12. 13. 14. 15.]]</span>

<span class="c1">#   [[16. 17. 18. 19.]</span>
<span class="c1">#    [20. 21. 22. 23.]</span>
<span class="c1">#    [24. 25. 26. 27.]</span>
<span class="c1">#    [28. 29. 30. 31.]]</span>

<span class="c1">#   [[ 1.  2.  3.  0.]</span>
<span class="c1">#    [ 5.  6.  7.  0.]</span>
<span class="c1">#    [ 9. 10. 11.  0.]</span>
<span class="c1">#    [13. 14. 15.  0.]]</span>

<span class="c1">#   [[17. 18. 19.  0.]</span>
<span class="c1">#    [21. 22. 23.  0.]</span>
<span class="c1">#    [25. 26. 27.  0.]</span>
<span class="c1">#    [29. 30. 31.  0.]]</span>

<span class="c1">#   [[ 4.  5.  6.  7.]</span>
<span class="c1">#    [ 8.  9. 10. 11.]</span>
<span class="c1">#    [12. 13. 14. 15.]</span>
<span class="c1">#    [ 0.  0.  0.  0.]]</span>

<span class="c1">#   [[20. 21. 22. 23.]</span>
<span class="c1">#    [24. 25. 26. 27.]</span>
<span class="c1">#    [28. 29. 30. 31.]</span>
<span class="c1">#    [ 0.  0.  0.  0.]]</span>

<span class="c1">#   [[ 5.  6.  7.  0.]</span>
<span class="c1">#    [ 9. 10. 11.  0.]</span>
<span class="c1">#    [13. 14. 15.  0.]</span>
<span class="c1">#    [ 0.  0.  0.  0.]]</span>

<span class="c1">#   [[21. 22. 23.  0.]</span>
<span class="c1">#    [25. 26. 27.  0.]</span>
<span class="c1">#    [29. 30. 31.  0.]</span>
<span class="c1">#    [ 0.  0.  0.  0.]]]]</span>
<span class="n">out_batch</span><span class="p">,</span> <span class="n">out_depth</span><span class="p">,</span> <span class="n">out_row</span><span class="p">,</span> <span class="n">out_col</span> <span class="o">=</span> <span class="n">ms_output</span><span class="o">.</span><span class="n">shape</span>
<span class="n">ms_reshape</span> <span class="o">=</span> <span class="n">mindspore</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Reshape</span><span class="p">()</span>
<span class="n">ms_output</span> <span class="o">=</span> <span class="n">ms_reshape</span><span class="p">(</span><span class="n">ms_output</span><span class="p">,</span> <span class="p">(</span><span class="n">out_batch</span><span class="p">,</span> <span class="n">out_depth</span><span class="p">,</span> <span class="n">out_row</span> <span class="o">*</span> <span class="n">out_col</span><span class="p">))</span>
<span class="c1"># ms_output.shape = (1, 8, 16)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ms_output</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">())</span>
<span class="c1"># [[[ 0.  1.  2.  4.  5.  6.  8.  9. 10.]</span>
<span class="c1">#   [16. 17. 18. 20. 21. 22. 24. 25. 26.]</span>
<span class="c1">#   [ 1.  2.  3.  5.  6.  7.  9. 10. 11.]</span>
<span class="c1">#   [17. 18. 19. 21. 22. 23. 25. 26. 27.]</span>
<span class="c1">#   [ 4.  5.  6.  8.  9. 10. 12. 13. 14.]</span>
<span class="c1">#   [20. 21. 22. 24. 25. 26. 28. 29. 30.]</span>
<span class="c1">#   [ 5.  6.  7.  9. 10. 11. 13. 14. 15.]</span>
<span class="c1">#   [21. 22. 23. 25. 26. 27. 29. 30. 31.]]]</span>
<span class="n">ms_concat</span> <span class="o">=</span> <span class="n">mindspore</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Concat</span><span class="p">()</span>
<span class="n">output</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">out_batch</span><span class="p">):</span>
    <span class="n">odd</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">even</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">out_depth</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">ms_output</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,:]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">ms_reshape</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">j</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">even</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">even</span> <span class="o">=</span> <span class="n">data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">even</span> <span class="o">=</span> <span class="n">ms_concat</span><span class="p">((</span><span class="n">even</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">odd</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">odd</span> <span class="o">=</span> <span class="n">data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">odd</span> <span class="o">=</span> <span class="n">ms_concat</span><span class="p">((</span><span class="n">odd</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">ms_concat</span><span class="p">((</span><span class="n">even</span><span class="p">,</span> <span class="n">odd</span><span class="p">))</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">ms_reshape</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">temp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">temp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">temp</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">ms_concat</span><span class="p">((</span><span class="n">output</span><span class="p">,</span> <span class="n">temp</span><span class="p">))</span>
<span class="n">ms_output</span> <span class="o">=</span> <span class="n">output</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ms_output</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">())</span>
<span class="c1"># [[[ 0.  1.  2.  3.  4.  5.  6.  7.  8.  9. 10. 11. 12. 13. 14. 15.]</span>
<span class="c1">#   [ 1.  2.  3.  0.  5.  6.  7.  0.  9. 10. 11.  0. 13. 14. 15.  0.]</span>
<span class="c1">#   [ 4.  5.  6.  7.  8.  9. 10. 11. 12. 13. 14. 15.  0.  0.  0.  0.]</span>
<span class="c1">#   [ 5.  6.  7.  0.  9. 10. 11.  0. 13. 14. 15.  0.  0.  0.  0.  0.]</span>
<span class="c1">#   [16. 17. 18. 19. 20. 21. 22. 23. 24. 25. 26. 27. 28. 29. 30. 31.]</span>
<span class="c1">#   [17. 18. 19.  0. 21. 22. 23.  0. 25. 26. 27.  0. 29. 30. 31.  0.]</span>
<span class="c1">#   [20. 21. 22. 23. 24. 25. 26. 27. 28. 29. 30. 31.  0.  0.  0.  0.]</span>
<span class="c1">#   [21. 22. 23.  0. 25. 26. 27.  0. 29. 30. 31.  0.  0.  0.  0.  0.]]]</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, MindSpore.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 
</body>
</html>