<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>mindspore.set_auto_parallel_context &mdash; MindSpore master documentation</title><script>;(()=>{const e=localStorage.getItem("ms-theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;(e?"dark"===e:t)&&document.documentElement.setAttribute("data-o-theme","dark")})();</script><link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script><script src="../../_static/jquery.js"></script>
        <script src="../../_static/js/theme.js"></script><script src="../../_static/underscore.js"></script><script src="../../_static/doctools.js"></script><script src="../../_static/js/mermaid-9.3.0.js"></script><script crossorigin="anonymous" integrity="sha256-1fEPhSsRKlFKGfK3eO710tEweHh1fwokU5wFGDHO+vg=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="mindspore.get_auto_parallel_context" href="mindspore.get_auto_parallel_context.html" />
    <link rel="prev" title="mindspore.get_context" href="mindspore.get_context.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> MindSpore
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Design</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../design/overview.html">MindSpore Design Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../design/programming_paradigm.html">Functional and Object-Oriented Fusion Programming Paradigm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../design/dynamic_graph_and_static_graph.html">Combination of Dynamic and Static Graphs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../design/distributed_training_design.html">Distributed Parallel Native</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../design/data_engine.html">High Performance Data Processing Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../design/all_scenarios.html">Full-scenarios Unified Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../design/graph_fusion_engine.html">Graph-Kernel Fusion Acceleration Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../design/pluggable_device.html">Third-Party Hardware Interconnection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../design/glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Models</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../note/official_models.html">Official Models</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../mindspore.html">mindspore</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../mindspore.html#data-presentation">Data Presentation</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../mindspore.html#context">Context</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="mindspore.set_context.html">mindspore.set_context</a></li>
<li class="toctree-l3"><a class="reference internal" href="mindspore.get_context.html">mindspore.get_context</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">mindspore.set_auto_parallel_context</a></li>
<li class="toctree-l3"><a class="reference internal" href="mindspore.get_auto_parallel_context.html">mindspore.get_auto_parallel_context</a></li>
<li class="toctree-l3"><a class="reference internal" href="mindspore.reset_auto_parallel_context.html">mindspore.reset_auto_parallel_context</a></li>
<li class="toctree-l3"><a class="reference internal" href="mindspore.ParallelMode.html">mindspore.ParallelMode</a></li>
<li class="toctree-l3"><a class="reference internal" href="mindspore.set_ps_context.html">mindspore.set_ps_context</a></li>
<li class="toctree-l3"><a class="reference internal" href="mindspore.get_ps_context.html">mindspore.get_ps_context</a></li>
<li class="toctree-l3"><a class="reference internal" href="mindspore.reset_ps_context.html">mindspore.reset_ps_context</a></li>
<li class="toctree-l3"><a class="reference internal" href="mindspore.set_algo_parameters.html">mindspore.set_algo_parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="mindspore.get_algo_parameters.html">mindspore.get_algo_parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="mindspore.reset_algo_parameters.html">mindspore.reset_algo_parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="mindspore.set_offload_context.html">mindspore.set_offload_context</a></li>
<li class="toctree-l3"><a class="reference internal" href="mindspore.get_offload_context.html">mindspore.get_offload_context</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../mindspore.html#seed">Seed</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mindspore.html#serialization">Serialization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mindspore.html#automatic-differentiation">Automatic Differentiation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mindspore.html#parallel-optimization">Parallel Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mindspore.html#jit">JIT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mindspore.html#tool">Tool</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../mindspore.nn.html">mindspore.nn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindspore.ops.html">mindspore.ops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindspore.ops.primitive.html">mindspore.ops.primitive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindspore.amp.html">mindspore.amp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindspore.train.html">mindspore.train</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindspore.communication.html">mindspore.communication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindspore.common.initializer.html">mindspore.common.initializer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindspore.dataset.html">mindspore.dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindspore.dataset.transforms.html">mindspore.dataset.transforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindspore.mindrecord.html">mindspore.mindrecord</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindspore.nn.probability.html">mindspore.nn.probability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindspore.rewrite.html">mindspore.rewrite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindspore.multiprocessing.html">mindspore.multiprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindspore.boost.html">mindspore.boost</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindspore.numpy.html">mindspore.numpy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindspore.scipy.html">mindspore.scipy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindspore.experimental.html">mindspore.experimental</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Mapping</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../note/api_mapping/pytorch_api_mapping.html">PyTorch and MindSpore API Mapping Table</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Migration Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../migration_guide/overview.html">Overview of Migration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../migration_guide/enveriment_preparation.html">Environment Preparation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../migration_guide/analysis_and_preparation.html">Model Analysis and Preparation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../migration_guide/model_development/model_development.html">Network Constructing Comparison</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../migration_guide/debug_and_tune.html">Debugging and Tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../migration_guide/sample_code.html">Network Migration Debugging Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../migration_guide/faq.html">FAQs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Syntax Support</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../note/static_graph_syntax_support.html">Static Graph Syntax Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../note/static_graph_syntax/operators.html">Static Graph Syntax - Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../note/static_graph_syntax/statements.html">Static Graph Syntax - Python Statements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../note/static_graph_syntax/python_builtin_functions.html">Static Graph Syntax - Python Built-in Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../note/index_support.html">Tensor Index Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Environment Variables</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../note/env_var_list.html">Environment Variables</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FAQ</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../faq/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/data_processing.html">Data Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/implement_problem.html">Implement Problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/network_compilation.html">Network Compilation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/operators_compile.html">Operators Compile</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/usage_migrate_3rd.html">Migration from a Third-party Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/performance_tuning.html">Performance Tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/precision_tuning.html">Precision Tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/distributed_parallel.html">Distributed Parallel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/inference.html">Inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/feature_advice.html">Feature Advice</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">RELEASE NOTES</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../RELEASE.html">Release Notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">MindSpore</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../mindspore.html">mindspore</a> &raquo;</li>
      <li>mindspore.set_auto_parallel_context</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/api_python/mindspore/mindspore.set_auto_parallel_context.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="mindspore-set-auto-parallel-context">
<h1>mindspore.set_auto_parallel_context<a class="headerlink" href="#mindspore-set-auto-parallel-context" title="Permalink to this headline"></a></h1>
<a class="reference external image-reference" href="https://gitee.com/mindspore/mindspore/blob/r2.3/mindspore/python/mindspore/_checkparam.py"><img alt="View Source On Gitee" src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/r2.3/resource/_static/logo_source_en.svg" /></a>
<dl class="py function">
<dt class="sig sig-object py" id="mindspore.set_auto_parallel_context">
<span class="sig-prename descclassname"><span class="pre">mindspore.</span></span><span class="sig-name descname"><span class="pre">set_auto_parallel_context</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/mindspore/context.html#set_auto_parallel_context"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindspore.set_auto_parallel_context" title="Permalink to this definition"></a></dt>
<dd><p>Set auto parallel context, only data parallel supported on CPU.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Attribute name is required for setting attributes.
If a program has tasks on different parallel modes, before setting a new parallel mode for the
next task, interface <a class="reference internal" href="mindspore.reset_auto_parallel_context.html#mindspore.reset_auto_parallel_context" title="mindspore.reset_auto_parallel_context"><code class="xref py py-func docutils literal notranslate"><span class="pre">mindspore.reset_auto_parallel_context()</span></code></a> should be called to reset
the configuration.
Setting or changing parallel modes must be called before creating any Initializer, otherwise,
it may have RuntimeError when compiling the network.</p>
</div>
<p>Some configurations are parallel mode specific, see the below table for details:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Common</p></th>
<th class="head"><p>AUTO_PARALLEL</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>device_num</p></td>
<td><p>gradient_fp32_sync</p></td>
</tr>
<tr class="row-odd"><td><p>global_rank</p></td>
<td><p>loss_repeated_mean</p></td>
</tr>
<tr class="row-even"><td><p>gradients_mean</p></td>
<td><p>search_mode</p></td>
</tr>
<tr class="row-odd"><td><p>parallel_mode</p></td>
<td><p>parameter_broadcast</p></td>
</tr>
<tr class="row-even"><td><p>all_reduce_fusion_config</p></td>
<td><p>strategy_ckpt_load_file</p></td>
</tr>
<tr class="row-odd"><td><p>enable_parallel_optimizer</p></td>
<td><p>strategy_ckpt_save_file</p></td>
</tr>
<tr class="row-even"><td><p>parallel_optimizer_config</p></td>
<td><p>dataset_strategy</p></td>
</tr>
<tr class="row-odd"><td><p>enable_alltoall</p></td>
<td><p>pipeline_stages</p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p>auto_parallel_search_mode</p></td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p>comm_fusion</p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p>strategy_ckpt_config</p></td>
</tr>
</tbody>
</table>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>device_num</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – Available device number, the value must be in [1, 4096]. Default: <code class="docutils literal notranslate"><span class="pre">1</span></code> .</p></li>
<li><p><strong>global_rank</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – Global rank id, the value must be in [0, 4095]. Default: <code class="docutils literal notranslate"><span class="pre">0</span></code> .</p></li>
<li><p><strong>gradients_mean</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a>) – Whether to perform mean operator after allreduce of gradients.
“stand_alone” do not support gradients_mean. Default: <code class="docutils literal notranslate"><span class="pre">False</span></code> .</p></li>
<li><p><strong>gradient_fp32_sync</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a>) – Run allreduce of gradients in fp32. “stand_alone”, “data_parallel”
and “hybrid_parallel” do not support gradient_fp32_sync. Default: <code class="docutils literal notranslate"><span class="pre">True</span></code> .</p></li>
<li><p><strong>parallel_mode</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – <p>There are five kinds of parallel modes, <code class="docutils literal notranslate"><span class="pre">&quot;stand_alone&quot;</span></code> , <code class="docutils literal notranslate"><span class="pre">&quot;data_parallel&quot;</span></code> ,
<code class="docutils literal notranslate"><span class="pre">&quot;hybrid_parallel&quot;</span></code> , <code class="docutils literal notranslate"><span class="pre">&quot;semi_auto_parallel&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;auto_parallel&quot;</span></code> . Note the pynative mode
only supports the <code class="docutils literal notranslate"><span class="pre">&quot;stand_alone&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;data_parallel&quot;</span></code> mode. Default: <code class="docutils literal notranslate"><span class="pre">&quot;stand_alone&quot;</span></code> .</p>
<ul>
<li><p>stand_alone: Only one processor is working.</p></li>
<li><p>data_parallel: Distributes the data across different processors.</p></li>
<li><p>hybrid_parallel: Achieves data parallelism and model parallelism manually.</p></li>
<li><p>semi_auto_parallel: Achieves data and model parallelism by setting parallel strategies.</p></li>
<li><p>auto_parallel: Achieving parallelism automatically.</p></li>
</ul>
</p></li>
<li><p><strong>search_mode</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – <p>There are three kinds of shard strategy search modes: <code class="docutils literal notranslate"><span class="pre">&quot;recursive_programming&quot;</span></code> ,
<code class="docutils literal notranslate"><span class="pre">&quot;dynamic_programming&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;sharding_propagation&quot;</span></code> . Default: <code class="docutils literal notranslate"><span class="pre">&quot;recursive_programming&quot;</span></code> .</p>
<ul>
<li><p>recursive_programming: Recursive programming search mode. In order to obtain optimal performance,
it is recommended that users set the batch size to be greater than or equal to the product of
the number of devices and the number of multi-copy parallelism.</p></li>
<li><p>dynamic_programming: Dynamic programming search mode.</p></li>
<li><p>sharding_propagation: Propagate shardings from configured ops to non-configured ops.</p></li>
</ul>
</p></li>
<li><p><strong>auto_parallel_search_mode</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – This is the old version of ‘search_mode’. Here, remaining this attribute is
for forward compatibility, and this attribute will be deleted in a future MindSpore version.</p></li>
<li><p><strong>parameter_broadcast</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a>) – Whether to broadcast parameters before training. Before training, in order to have
the same network initialization parameter values for all devices, broadcast the parameters
on device 0 to other devices. Parameter broadcasting in different parallel modes is different,
<code class="docutils literal notranslate"><span class="pre">data_parallel</span></code> mode, all parameters are broadcast except for the parameter whose attribute
layerwise_parallel is <code class="docutils literal notranslate"><span class="pre">True</span></code> . <code class="docutils literal notranslate"><span class="pre">Hybrid_parallel</span></code> , <code class="docutils literal notranslate"><span class="pre">semi_auto_parallel</span></code>  and
<code class="docutils literal notranslate"><span class="pre">auto_parallel</span> <span class="pre">mode</span></code> , the segmented parameters do not participate in broadcasting.
Default: <code class="docutils literal notranslate"><span class="pre">False</span></code> .</p></li>
<li><p><strong>strategy_ckpt_load_file</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – The path to load parallel strategy checkpoint. The parameter is not to be
recommended currently, it is better using ‘strategy_ckpt_config’ to replace it. Default: <code class="docutils literal notranslate"><span class="pre">''</span></code></p></li>
<li><p><strong>strategy_ckpt_save_file</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – The path to save parallel strategy checkpoint. The parameter is not to be
recommended currently, it is better using ‘strategy_ckpt_config’ to replace it. Default: <code class="docutils literal notranslate"><span class="pre">''</span></code></p></li>
<li><p><strong>full_batch</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a>) – If you load whole batch datasets in <code class="docutils literal notranslate"><span class="pre">auto_parallel</span></code> mode, this parameter
should be set as <code class="docutils literal notranslate"><span class="pre">True</span></code> . Default: <code class="docutils literal notranslate"><span class="pre">False</span></code> . The interface is not to be recommended
currently, it is better using ‘dataset_strategy’ to replace it.</p></li>
<li><p><strong>dataset_strategy</strong> (<em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#tuple" title="(in Python v3.8)"><em>tuple</em></a><em>]</em>) – Dataset sharding strategy. Default: <code class="docutils literal notranslate"><span class="pre">&quot;data_parallel&quot;</span></code> .
dataset_strategy=”data_parallel” is equal to full_batch=False, dataset_strategy=”full_batch” is
equal to full_batch=True. For execution mode is ‘GRAPH_MODE’ and dataset load into net by model
parallel strategy likes ds_stra ((1, 8), (1, 8)), it requires using
set_auto_parallel_context(dataset_strategy=ds_stra).</p></li>
<li><p><strong>enable_parallel_optimizer</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a>) – This is a developing feature, which shards the weight update computation for
data parallel training in the benefit of time and memory saving. Currently, auto and semi auto
parallel mode support all optimizers in both Ascend and GPU. Data parallel mode only supports
<cite>Lamb</cite> and <cite>AdamWeightDecay</cite> in Ascend . Default: <code class="docutils literal notranslate"><span class="pre">False</span></code> .</p></li>
<li><p><strong>enable_alltoall</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a>) – A switch that allows AllToAll operators to be generated during communication. If its
value is <code class="docutils literal notranslate"><span class="pre">False</span></code> , there will be a combination of operators such as AllGather, Split and
Concat instead of AllToAll. Default: <code class="docutils literal notranslate"><span class="pre">False</span></code> .</p></li>
<li><p><strong>all_reduce_fusion_config</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#list" title="(in Python v3.8)"><em>list</em></a>) – Set allreduce fusion strategy by parameters indices. Only support ReduceOp.SUM
and HCCL_WORLD_GROUP/NCCL_WORLD_GROUP. No Default, if it is not set, the fusion is closed.</p></li>
<li><p><strong>pipeline_stages</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – Set the stage information for pipeline parallel. This indicates how the devices are
distributed alone in the pipeline. The total devices will be divided into ‘pipeline_stags’
stages.
Default: <code class="docutils literal notranslate"><span class="pre">1</span></code> .</p></li>
<li><p><strong>parallel_optimizer_config</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#dict" title="(in Python v3.8)"><em>dict</em></a>) – <p>A dict contains the keys and values for setting the parallel optimizer
configure. The configure provides more detailed behavior control about parallel training
when parallel optimizer is enabled. The configure will be effective when we use
mindspore.set_auto_parallel_context(enable_parallel_optimizer=True).
It supports the following keys.</p>
<ul>
<li><p>gradient_accumulation_shard(bool): If <code class="docutils literal notranslate"><span class="pre">true</span></code> , the accumulation gradient parameters will be
sharded across the data parallel devices. This will
introduce additional communication(ReduceScatter) at
each step when accumulate the gradients, but saves a
lot of device memories, thus can make model be trained
with larger batch size. This configure is effective only
when the model runs on pipeline training or gradient
accumulation with data parallel. Default <code class="docutils literal notranslate"><span class="pre">False</span></code> .</p></li>
<li><p>parallel_optimizer_threshold(int): Set the threshold of parallel optimizer. When parallel
optimizer is enabled, parameters with size smaller than this threshold will not be sharded
across the devices. Parameter size = shape[0] * … * shape[n] * size(dtype). Non-negative.
Unit: KB. Default: <code class="docutils literal notranslate"><span class="pre">64</span></code> .</p></li>
<li><p>optimizer_weight_shard_size(int): Set the optimizer weight shard group size, if you want to
specific the maximum group size across devices when the parallel optimizer is enabled.
The numerical range can be (0, device_num]. If pipeline parallel is enabled, the numerical
range is (0, device_num/stage]. If the size of data parallel communication domain
of the parameter cannot be divided by <cite>optimizer_weight_shard_size</cite>, then the specified
communication group size will not take effect. Default value is <code class="docutils literal notranslate"><span class="pre">-1</span></code> , which means the
optimizer weight shard group size will be the size of data parallel group of each parameter.</p></li>
</ul>
</p></li>
<li><p><strong>comm_fusion</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#dict" title="(in Python v3.8)"><em>dict</em></a>) – <p>A dict contains the types and configurations for setting the communication fusion. each
communication fusion config has two keys: “mode” and “config”.
It supports following communication fusion types and configurations:</p>
<ul>
<li><p>openstate: Whether turn on the communication fusion or not. If <cite>openstate</cite> is <code class="docutils literal notranslate"><span class="pre">True</span></code> ,
turn on the communication fusion, otherwise, turn off the communication fusion.
Default: <code class="docutils literal notranslate"><span class="pre">True</span></code> .</p></li>
<li><p>allreduce: If communication fusion type is <cite>allreduce</cite>. The <cite>mode</cite> contains: <cite>auto</cite>, <cite>size</cite>
and <cite>index</cite>. In <cite>auto</cite> mode, AllReduce fusion is configured by gradients size and the default
fusion threshold is <cite>64</cite> MB. In ‘size’ mode, AllReduce fusion is configured by gradients size
manually, and the fusion threshold must be larger than <cite>0</cite> MB. In <cite>index</cite> mode, it is same as
<cite>all_reduce_fusion_config</cite>.</p></li>
<li><p>allgather: If communication fusion type is <cite>allgather</cite>. The <cite>mode</cite> contains: <cite>auto</cite>, <cite>size</cite>.
In <cite>auto</cite> mode, AllGather fusion is configured by gradients size, and the default fusion
threshold is <cite>64</cite> MB. In ‘size’ mode, AllGather fusion is configured by gradients size
manually, and the fusion threshold must be larger than <cite>0</cite> MB.</p></li>
<li><p>reducescatter: If communication fusion type is <cite>reducescatter</cite>. The <cite>mode</cite> contains: <cite>auto</cite>
and <cite>size</cite>. Config is same as <cite>allgather</cite>.</p></li>
</ul>
</p></li>
<li><p><strong>strategy_ckpt_config</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#dict" title="(in Python v3.8)"><em>dict</em></a>) – <p>A dict contains the configurations for setting the parallel strategy file. This
interface contains the functions of parameter <cite>strategy_ckpt_load_file</cite> and
<cite>strategy_ckpt_save_file</cite>, it is recommonded to use this parameter to replace those two
parameters.
It contains following configurations:</p>
<ul>
<li><p>load_file (str): The path to load parallel strategy checkpoint. If the file name extension is
<cite>.json</cite>, the file is loaded in JSON format. Otherwise, the file is loaded in ProtoBuf
format.
Default: ‘’</p></li>
<li><p>save_file (str): The path to save parallel strategy checkpoint. If the file name extension is
<cite>.json</cite>, the file is saved in JSON format. Otherwise, the file is saved in ProtoBuf format.
Default: ‘’</p></li>
<li><p>only_trainable_params (bool): Only save/load the strategy information for trainable parameter.
Default: <code class="docutils literal notranslate"><span class="pre">True</span></code> .</p></li>
</ul>
</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#ValueError" title="(in Python v3.8)"><strong>ValueError</strong></a> – If input key is not attribute in auto parallel context.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ms</span><span class="o">.</span><span class="n">set_auto_parallel_context</span><span class="p">(</span><span class="n">device_num</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ms</span><span class="o">.</span><span class="n">set_auto_parallel_context</span><span class="p">(</span><span class="n">global_rank</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ms</span><span class="o">.</span><span class="n">set_auto_parallel_context</span><span class="p">(</span><span class="n">gradients_mean</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ms</span><span class="o">.</span><span class="n">set_auto_parallel_context</span><span class="p">(</span><span class="n">gradient_fp32_sync</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ms</span><span class="o">.</span><span class="n">set_auto_parallel_context</span><span class="p">(</span><span class="n">parallel_mode</span><span class="o">=</span><span class="s2">&quot;auto_parallel&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ms</span><span class="o">.</span><span class="n">set_auto_parallel_context</span><span class="p">(</span><span class="n">search_mode</span><span class="o">=</span><span class="s2">&quot;dynamic_programming&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ms</span><span class="o">.</span><span class="n">set_auto_parallel_context</span><span class="p">(</span><span class="n">auto_parallel_search_mode</span><span class="o">=</span><span class="s2">&quot;dynamic_programming&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ms</span><span class="o">.</span><span class="n">set_auto_parallel_context</span><span class="p">(</span><span class="n">parameter_broadcast</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ms</span><span class="o">.</span><span class="n">set_auto_parallel_context</span><span class="p">(</span><span class="n">strategy_ckpt_load_file</span><span class="o">=</span><span class="s2">&quot;./strategy_stage1.ckpt&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ms</span><span class="o">.</span><span class="n">set_auto_parallel_context</span><span class="p">(</span><span class="n">strategy_ckpt_save_file</span><span class="o">=</span><span class="s2">&quot;./strategy_stage1.ckpt&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ms</span><span class="o">.</span><span class="n">set_auto_parallel_context</span><span class="p">(</span><span class="n">dataset_strategy</span><span class="o">=</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ms</span><span class="o">.</span><span class="n">set_auto_parallel_context</span><span class="p">(</span><span class="n">enable_parallel_optimizer</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ms</span><span class="o">.</span><span class="n">set_auto_parallel_context</span><span class="p">(</span><span class="n">enable_alltoall</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ms</span><span class="o">.</span><span class="n">set_auto_parallel_context</span><span class="p">(</span><span class="n">all_reduce_fusion_config</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">160</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ms</span><span class="o">.</span><span class="n">set_auto_parallel_context</span><span class="p">(</span><span class="n">pipeline_stages</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parallel_config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;gradient_accumulation_shard&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;parallel_optimizer_threshold&quot;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
<span class="gp">... </span>                   <span class="s2">&quot;optimizer_weight_shard_size&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ms</span><span class="o">.</span><span class="n">set_auto_parallel_context</span><span class="p">(</span><span class="n">parallel_optimizer_config</span><span class="o">=</span><span class="n">parallel_config</span><span class="p">,</span> <span class="n">enable_parallel_optimizer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;allreduce&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;size&quot;</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="mi">32</span><span class="p">},</span> <span class="s2">&quot;allgather&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;size&quot;</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="mi">32</span><span class="p">}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ms</span><span class="o">.</span><span class="n">set_auto_parallel_context</span><span class="p">(</span><span class="n">comm_fusion</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stra_ckpt_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;load_file&quot;</span><span class="p">:</span> <span class="s2">&quot;./stra0.ckpt&quot;</span><span class="p">,</span> <span class="s2">&quot;save_file&quot;</span><span class="p">:</span> <span class="s2">&quot;./stra1.ckpt&quot;</span><span class="p">,</span> <span class="s2">&quot;only_trainable_params&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ms</span><span class="o">.</span><span class="n">set_auto_parallel_context</span><span class="p">(</span><span class="n">strategy_ckpt_config</span><span class="o">=</span><span class="n">stra_ckpt_dict</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="mindspore.get_context.html" class="btn btn-neutral float-left" title="mindspore.get_context" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="mindspore.get_auto_parallel_context.html" class="btn btn-neutral float-right" title="mindspore.get_auto_parallel_context" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright MindSpore.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 
</body>
</html>