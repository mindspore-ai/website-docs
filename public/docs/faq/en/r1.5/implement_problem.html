<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Implement Problem &mdash; MindSpore master documentation</title><script>;(()=>{const e=localStorage.getItem("ms-theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;(e?"dark"===e:t)&&document.documentElement.setAttribute("data-o-theme","dark")})();</script><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script><script src="_static/jquery.js"></script>
        <script src="_static/js/theme.js"></script><script src="_static/underscore.js"></script><script src="_static/doctools.js"></script><script async="async" src="https://cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Operators Compile" href="operators_compile.html" />
    <link rel="prev" title="Data Processing" href="data_processing.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> MindSpore
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_processing.html">Data Processing</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Implement Problem</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#network-compilation-problems">Network Compilation Problems</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="operators_compile.html">Operators Compile</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage_migrate_3rd.html">Migration from a Third-party Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="performance_tuning.html">Performance Tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="precision_tuning.html">Precision Tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed_configure.html">Distributed Configure</a></li>
<li class="toctree-l1"><a class="reference internal" href="inference.html">Inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="feature_advice.html">Feature Advice</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MindSpore</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Implement Problem</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/implement_problem.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="implement-problem">
<h1>Implement Problem<a class="headerlink" href="#implement-problem" title="Permalink to this headline">ÔÉÅ</a></h1>
<p><a class="reference external" href="https://gitee.com/mindspore/docs/blob/r1.5/docs/mindspore/faq/source_en/implement_problem.md"><img alt="View Source On Gitee" src="https://gitee.com/mindspore/docs/raw/r1.5/resource/_static/logo_source_en.png" /></a></p>
<p><font size=3><strong>Q: How do I use MindSpore to implement multi-scale training?</strong></font></p>
<p>A: During multi-scale training, when different <code class="docutils literal notranslate"><span class="pre">shape</span></code> are used to call <code class="docutils literal notranslate"><span class="pre">Cell</span></code> objects, different graphs are automatically built and called based on different <code class="docutils literal notranslate"><span class="pre">shape</span></code>. Note that multi-scale training supports only the non-data sink mode and does not support the data offloading mode. For details, see the multi-scale training of the <a class="reference external" href="https://gitee.com/mindspore/models/tree/r1.5/official/cv/yolov3_darknet53">yolov3</a>.</p>
<br/>
<p><font size=3><strong>Q: If a <code class="docutils literal notranslate"><span class="pre">tensor</span></code> whose <code class="docutils literal notranslate"><span class="pre">requirements_grad</span></code> is set to <code class="docutils literal notranslate"><span class="pre">False</span></code> is converted into <code class="docutils literal notranslate"><span class="pre">numpy</span></code> for processing and then converted into <code class="docutils literal notranslate"><span class="pre">tensor</span></code>, will the computational graph and backward propagation be affected?</strong></font></p>
<p>A: In PyNative mode, if <code class="docutils literal notranslate"><span class="pre">numpy</span></code> is used for computation, gradient transfer will be interrupted. In the scenario where <code class="docutils literal notranslate"><span class="pre">requirements_grad</span></code> is set to <code class="docutils literal notranslate"><span class="pre">False</span></code>, if the backward propagation of <code class="docutils literal notranslate"><span class="pre">tensor</span></code> is not transferred to other parameters, there is no impact. If <code class="docutils literal notranslate"><span class="pre">requirements_grad</span></code> is set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, there is an impact.</p>
<br/>
<p><font size=3><strong>Q: How do I modify the <code class="docutils literal notranslate"><span class="pre">weight</span></code> and <code class="docutils literal notranslate"><span class="pre">bias</span></code> of the fully-connected layer like <code class="docutils literal notranslate"><span class="pre">torch.nn.functional.linear()</span></code>?</strong></font></p>
<p>A: The <code class="docutils literal notranslate"><span class="pre">nn.Dense</span></code> interface is similar to <code class="docutils literal notranslate"><span class="pre">torch.nn.functional.linear()</span></code>. <code class="docutils literal notranslate"><span class="pre">nn.Dense</span></code> can specify the initial values of <code class="docutils literal notranslate"><span class="pre">weight</span></code> and <code class="docutils literal notranslate"><span class="pre">bias</span></code>. Subsequent changes are automatically updated by the optimizer. During the training, you do not need to change the values of the two parameters.</p>
<br/>
<p><font size=3><strong>Q: What is the function of the <code class="docutils literal notranslate"><span class="pre">.meta</span></code> file generated after the model is saved using MindSpore? Can the <code class="docutils literal notranslate"><span class="pre">.meta</span></code> file be used to import the graph structure?</strong></font></p>
<p>A: The <code class="docutils literal notranslate"><span class="pre">.meta</span></code> file is a built graph structure. However, this structure cannot be directly imported currently. If you do not know the graph structure, you still need to use the MindIR file to import the network.</p>
<br/>
<p><font size=3><strong>Q: Can the <code class="docutils literal notranslate"><span class="pre">yolov4-tiny-3l.weights</span></code> model file be directly converted into a MindSpore model?</strong></font></p>
<p>A: No. You need to convert the parameters trained by other frameworks into the MindSpore format, and then convert the model file into a MindSpore model.</p>
<br/>
<p><font size=3><strong>Q: Why an error is reported when MindSpore is used to set <code class="docutils literal notranslate"><span class="pre">model.train</span></code>?</strong></font></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="n">LossMonitor</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">dataset_sink_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="n">LossMonitor</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">dataset_sink_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>A: If the offloading mode has been set, it cannot be set to non-offloading mode. This is a restriction on the running mechanism.</p>
<br/>
<p><font size=3><strong>Q: What should I pay attention to when using MindSpore to train a model in the <code class="docutils literal notranslate"><span class="pre">eval</span></code> phase? Can the network and parameters be loaded directly? Does the optimizer need to be used in the model?</strong></font></p>
<p>A: It mainly depends on what is required in the <code class="docutils literal notranslate"><span class="pre">eval</span></code> phase. For example, the output of the <code class="docutils literal notranslate"><span class="pre">eval</span></code> network of the image classification task is the probability value of each class, and the <code class="docutils literal notranslate"><span class="pre">acc</span></code> is computed with the corresponding label.
In most cases, the training network and parameters can be directly reused. Note that the inference mode needs to be set.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">net</span><span class="o">.</span><span class="n">set_train</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>The optimizer is not required in the <code class="docutils literal notranslate"><span class="pre">eval</span></code> phase. However, if the <code class="docutils literal notranslate"><span class="pre">model.eval</span></code> API of MindSpore needs to be used, the <code class="docutils literal notranslate"><span class="pre">loss</span> <span class="pre">function</span></code> needs to be configured. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define a model.</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">loss_fn</span><span class="o">=</span><span class="n">loss</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;top_1_accuracy&#39;</span><span class="p">,</span> <span class="s1">&#39;top_5_accuracy&#39;</span><span class="p">})</span>
<span class="c1"># Evaluate the model.</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
</pre></div>
</div>
<br/>
<p><font size=3><strong>Q: How do I use <code class="docutils literal notranslate"><span class="pre">param_group</span></code> in SGD to reduce the learning rate?</strong></font></p>
<p>A: To change the value according to <code class="docutils literal notranslate"><span class="pre">epoch</span></code>, use <a class="reference external" href="https://www.mindspore.cn/docs/api/en/r1.5/api_python/mindspore.nn.html#dynamic-lr">Dynamic LR</a> and set <code class="docutils literal notranslate"><span class="pre">step_per_epoch</span></code> to <code class="docutils literal notranslate"><span class="pre">step_size</span></code>. To change the value according to <code class="docutils literal notranslate"><span class="pre">step</span></code>, set <code class="docutils literal notranslate"><span class="pre">step_per_epoch</span></code> to 1. You can also use <a class="reference external" href="https://www.mindspore.cn/docs/api/en/r1.5/api_python/mindspore.nn.html#dynamic-learning-rate">LearningRateSchedule</a>.</p>
<br/>
<p><font size=3><strong>Q: How do I modify parameters (such as the dropout value) on MindSpore?</strong></font></p>
<p>A: When building a network, use <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">self.training:</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">dropput(x)</span></code>. When reasoning, set <code class="docutils literal notranslate"><span class="pre">network.set_train(mode_false)</span></code> before execution to disable the dropout function. During training, set <code class="docutils literal notranslate"><span class="pre">network.set_train(mode_false)</span></code> to True to enable the dropout function.</p>
<br/>
<p><font size=3><strong>Q: How do I view the number of model parameters?</strong></font></p>
<p>A: You can load the checkpoint to count the parameter number. Variables in the momentum and optimizer may be counted, so you need to filter them out.
You can refer to the following APIs to collect the number of network parameters:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">count_params</span><span class="p">(</span><span class="n">net</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Count number of parameters in the network</span>
<span class="sd">    Args:</span>
<span class="sd">        net (mindspore.nn.Cell): Mindspore network instance</span>
<span class="sd">    Returns:</span>
<span class="sd">        total_params (int): Total number of trainable params</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">total_params</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">net</span><span class="o">.</span><span class="n">trainable_params</span><span class="p">():</span>
        <span class="n">total_params</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">total_params</span>
</pre></div>
</div>
<p><a class="reference external" href="https://gitee.com/mindspore/models/blob/r1.5/research/cv/tinynet/src/utils.py">Script Link</a>.</p>
<br/>
<p><font size=3><strong>Q: How do I monitor the loss during training and save the training parameters when the <code class="docutils literal notranslate"><span class="pre">loss</span></code> is the lowest?</strong></font></p>
<p>A: You can customize a <code class="docutils literal notranslate"><span class="pre">callback</span></code>.For details, see the writing method of <code class="docutils literal notranslate"><span class="pre">ModelCheckpoint</span></code>. In addition, the logic for determining loss is added.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">EarlyStop</span><span class="p">(</span><span class="n">Callback</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loss</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">def</span> <span class="nf">step_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_context</span><span class="p">):</span>
        <span class="n">loss</span> <span class="o">=</span>  <span class="o">****</span><span class="p">(</span><span class="n">get</span> <span class="n">current</span> <span class="n">loss</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loss</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">loss</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">loss</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loss</span> <span class="o">=</span> <span class="n">loss</span>
            <span class="c1"># do save ckpt</span>
</pre></div>
</div>
<br/>
<p><font size=3><strong>Q: How do I obtain the expected <code class="docutils literal notranslate"><span class="pre">feature</span> <span class="pre">map</span></code> when <code class="docutils literal notranslate"><span class="pre">nn.Conv2d</span></code> is used?</strong></font></p>
<p>A: For details about how to derive the <code class="docutils literal notranslate"><span class="pre">Conv2d</span> <span class="pre">shape</span></code>, click <a class="reference external" href="https://www.mindspore.cn/docs/api/en/r1.5/api_python/nn/mindspore.nn.Conv2d.html#mindspore.nn.Conv2d">here</a> Change <code class="docutils literal notranslate"><span class="pre">pad_mode</span></code> of <code class="docutils literal notranslate"><span class="pre">Conv2d</span></code> to <code class="docutils literal notranslate"><span class="pre">same</span></code>. Alternatively, you can calculate the <code class="docutils literal notranslate"><span class="pre">pad</span></code> based on the Conv2d shape derivation formula to keep the <code class="docutils literal notranslate"><span class="pre">shape</span></code> unchanged. Generally, the pad is <code class="docutils literal notranslate"><span class="pre">(kernel_size-1)//2</span></code>.</p>
<br/>
<p><font size=3><strong>Q: Can MindSpore be used to customize a loss function that can return multiple values?</strong></font></p>
<p>A: After customizing the <code class="docutils literal notranslate"><span class="pre">loss</span> <span class="pre">function</span></code>, you need to customize <code class="docutils literal notranslate"><span class="pre">TrainOneStepCell</span></code>. The number of <code class="docutils literal notranslate"><span class="pre">sens</span></code> for implementing gradient calculation is the same as the number of <code class="docutils literal notranslate"><span class="pre">network</span></code> outputs. For details, see the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">net</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
<span class="n">loss_fn</span> <span class="o">=</span> <span class="n">MyLoss</span><span class="p">()</span>
<span class="n">loss_with_net</span> <span class="o">=</span> <span class="n">MyWithLossCell</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">loss_fn</span><span class="p">)</span>
<span class="n">train_net</span> <span class="o">=</span> <span class="n">MyTrainOneStepCell</span><span class="p">(</span><span class="n">loss_with_net</span><span class="p">,</span> <span class="n">optim</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">net</span><span class="o">=</span><span class="n">train_net</span><span class="p">,</span> <span class="n">loss_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<br/>
<p><font size=3><strong>Q: How does MindSpore implement the early stopping function?</strong></font></p>
<p>A: You can customize the <code class="docutils literal notranslate"><span class="pre">callback</span></code> method to implement the early stopping function.
Example: When the loss value decreases to a certain value, the training stops.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">EarlyStop</span><span class="p">(</span><span class="n">Callback</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">control_loss</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">EarlyStep</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_control_loss</span> <span class="o">=</span> <span class="n">control_loss</span>

    <span class="k">def</span> <span class="nf">step_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_context</span><span class="p">):</span>
        <span class="n">cb_params</span> <span class="o">=</span> <span class="n">run_context</span><span class="o">.</span><span class="n">original_args</span><span class="p">()</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">cb_params</span><span class="o">.</span><span class="n">net_outputs</span>
        <span class="k">if</span> <span class="n">loss</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_control_loss</span><span class="p">:</span>
            <span class="c1"># Stop training.</span>
            <span class="n">run_context</span><span class="o">.</span><span class="n">_stop_requested</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">stop_cb</span> <span class="o">=</span> <span class="n">EarlyStop</span><span class="p">(</span><span class="n">control_loss</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">epoch_size</span><span class="p">,</span> <span class="n">ds_train</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">stop_cb</span><span class="p">])</span>
</pre></div>
</div>
<br/>
<p><font size=3><strong>Q: After a model is trained, how do I save the model output in text or <code class="docutils literal notranslate"><span class="pre">npy</span></code> format?</strong></font></p>
<p>A: The network output is <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>. You need to use the <code class="docutils literal notranslate"><span class="pre">asnumpy()</span></code> method to convert the <code class="docutils literal notranslate"><span class="pre">Tensor</span></code> to <code class="docutils literal notranslate"><span class="pre">NumPy</span></code> and then save the data. For details, see the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">out</span> <span class="o">=</span> <span class="n">net</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;output.npy&quot;</span><span class="p">,</span> <span class="n">out</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">())</span>
</pre></div>
</div>
<br/>
<p><font size=3><strong>Q: Can the <code class="docutils literal notranslate"><span class="pre">vgg16</span></code> model be loaded and transferred on a GPU using the Hub?</strong></font></p>
<p>A: Yes, but you need to manually modify the following two arguments:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add the **kwargs argument as follows:</span>
<span class="k">def</span> <span class="nf">vgg16</span><span class="p">(</span><span class="n">num_classes</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add the **kwargs argument as follows:</span>
<span class="n">net</span> <span class="o">=</span> <span class="n">Vgg</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;16&#39;</span><span class="p">],</span> <span class="n">num_classes</span><span class="o">=</span><span class="n">num_classes</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">batch_norm</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">batch_norm</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="n">phase</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<br/>
<p><font size=3><strong>Q: How to obtain middle-layer features of a VGG model?</strong></font></p>
<p>A: Obtaining the middle-layer features of a network is not closely related to the specific framework. For the <code class="docutils literal notranslate"><span class="pre">vgg</span></code> model defined in <code class="docutils literal notranslate"><span class="pre">torchvison</span></code>, the <code class="docutils literal notranslate"><span class="pre">features</span></code> field can be used to obtain the middle-layer features. The <code class="docutils literal notranslate"><span class="pre">vgg</span></code> source code of <code class="docutils literal notranslate"><span class="pre">torchvison</span></code> is as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">VGG</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">num_classes</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">init_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">VGG</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="n">features</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">avgpool</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">AdaptiveAvgPool2d</span><span class="p">((</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">vgg16</span></code> defined in ModelZoo of MindSpore can be obtained through the <code class="docutils literal notranslate"><span class="pre">layers</span></code> field as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">network</span> <span class="o">=</span> <span class="n">vgg16</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">layers</span><span class="p">)</span>
</pre></div>
</div>
<br/>
<p><font size=3><strong>Q: When MindSpore is used for model training, there are four input parameters for <code class="docutils literal notranslate"><span class="pre">CTCLoss</span></code>: <code class="docutils literal notranslate"><span class="pre">inputs</span></code>, <code class="docutils literal notranslate"><span class="pre">labels_indices</span></code>, <code class="docutils literal notranslate"><span class="pre">labels_values</span></code>, and <code class="docutils literal notranslate"><span class="pre">sequence_length</span></code>. How do I use <code class="docutils literal notranslate"><span class="pre">CTCLoss</span></code> for model training?</strong></font></p>
<p>A: The <code class="docutils literal notranslate"><span class="pre">dataset</span></code> received by the defined <code class="docutils literal notranslate"><span class="pre">model.train</span></code> API can consist of multiple pieces of data, for example, (<code class="docutils literal notranslate"><span class="pre">data1</span></code>, <code class="docutils literal notranslate"><span class="pre">data2</span></code>, <code class="docutils literal notranslate"><span class="pre">data3</span></code>, ‚Ä¶). Therefore, the <code class="docutils literal notranslate"><span class="pre">dataset</span></code> can contain <code class="docutils literal notranslate"><span class="pre">inputs</span></code>, <code class="docutils literal notranslate"><span class="pre">labels_indices</span></code>, <code class="docutils literal notranslate"><span class="pre">labels_values</span></code>, and <code class="docutils literal notranslate"><span class="pre">sequence_length</span></code> information. You only need to define the dataset in the corresponding format and transfer it to <code class="docutils literal notranslate"><span class="pre">model.train</span></code>. For details, see <a class="reference external" href="https://www.mindspore.cn/docs/programming_guide/en/r1.5/dataset_loading.html">Data Processing API</a>.</p>
<br/>
<p><font size=3><strong>Q: How do I load the PyTorch weight to MindSpore during model transfer?</strong></font></p>
<p>A: First, enter the <code class="docutils literal notranslate"><span class="pre">PTH</span></code> file of PyTorch. Take <code class="docutils literal notranslate"><span class="pre">ResNet-18</span></code> as an example. The network structure of MindSpore is the same as that of PyTorch. After transferring, the file can be directly loaded to the network. Only <code class="docutils literal notranslate"><span class="pre">BN</span></code> and <code class="docutils literal notranslate"><span class="pre">Conv2D</span></code> are used during loading. If the network names of MindSpore and PyTorch at other layers are different, change the names to the same.</p>
<br/>
<p><font size=3><strong>Q: What are the available recommendation or text generation networks or models provided by MindSpore?</strong></font></p>
<p>A: Currently, recommendation models such as Wide &amp; Deep, DeepFM, and NCF are under development. In the natural language processing (NLP) field, Bert_NEZHA is available and models such as MASS are under development. You can rebuild the network into a text generation network based on the scenario requirements. Please stay tuned for updates on the <a class="reference external" href="https://gitee.com/mindspore/mindspore/tree/r1.5/model_zoo">MindSpore Model Zoo</a>.</p>
<br/>
<p><font size=3><strong>Q: How do I use MindSpore to fit functions such as <span class="math notranslate nohighlight">\(f(x)=a \times sin(x)+b\)</span>?</strong></font></p>
<p>A: The following is based on the official MindSpore linear fitting case.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># The fitting function is: f(x)=2*sin(x)+3.</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">dataset</span> <span class="k">as</span> <span class="n">ds</span>
<span class="kn">from</span> <span class="nn">mindspore.common.initializer</span> <span class="kn">import</span> <span class="n">Normal</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">nn</span><span class="p">,</span> <span class="n">Model</span><span class="p">,</span> <span class="n">context</span>
<span class="kn">from</span> <span class="nn">mindspore.train.callback</span> <span class="kn">import</span> <span class="n">LossMonitor</span>

<span class="n">context</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">GRAPH_MODE</span><span class="p">,</span> <span class="n">device_target</span><span class="o">=</span><span class="s2">&quot;CPU&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">3.0</span><span class="p">):</span>
    <span class="c1"># f(x)=w * sin(x) + b</span>
    <span class="c1"># f(x)=2 * sin(x) +3</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="n">noise</span>
        <span class="k">yield</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">y</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">create_dataset</span><span class="p">(</span><span class="n">num_data</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">repeat_size</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">input_data</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">GeneratorDataset</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">get_data</span><span class="p">(</span><span class="n">num_data</span><span class="p">)),</span> <span class="n">column_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">,</span><span class="s1">&#39;label&#39;</span><span class="p">])</span>
    <span class="n">input_data</span> <span class="o">=</span> <span class="n">input_data</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">batch_size</span><span class="p">)</span>
    <span class="n">input_data</span> <span class="o">=</span> <span class="n">input_data</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">repeat_size</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">input_data</span>

<span class="k">class</span> <span class="nc">LinearNet</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LinearNet</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Normal</span><span class="p">(</span><span class="mf">0.02</span><span class="p">),</span> <span class="n">Normal</span><span class="p">(</span><span class="mf">0.02</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="n">num_data</span> <span class="o">=</span> <span class="mi">1600</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">16</span>
    <span class="n">repeat_size</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">lr</span> <span class="o">=</span> <span class="mf">0.005</span>
    <span class="n">momentum</span> <span class="o">=</span> <span class="mf">0.9</span>

    <span class="n">net</span> <span class="o">=</span> <span class="n">LinearNet</span><span class="p">()</span>
    <span class="n">net_loss</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">loss</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()</span>
    <span class="n">opt</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Momentum</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">trainable_params</span><span class="p">(),</span> <span class="n">lr</span><span class="p">,</span> <span class="n">momentum</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">net_loss</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>

    <span class="n">ds_train</span> <span class="o">=</span> <span class="n">create_dataset</span><span class="p">(</span><span class="n">num_data</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">repeat_size</span><span class="o">=</span><span class="n">repeat_size</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ds_train</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="n">LossMonitor</span><span class="p">(),</span> <span class="n">dataset_sink_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">trainable_params</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">net</span><span class="o">.</span><span class="n">trainable_params</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<br/>
<p><font size=3><strong>Q: How do I use MindSpore to fit quadratic functions such as <span class="math notranslate nohighlight">\(f(x)=ax^2+bx+c\)</span>?</strong></font></p>
<p>A: The following code is referenced from the official <a class="reference external" href="https://gitee.com/mindspore/docs/blob/r1.5/docs/sample_code/linear_regression.py">MindSpore tutorial code</a>.</p>
<p>Modify the following items to fit <span class="math notranslate nohighlight">\(f(x) = ax^2 + bx + c\)</span>:</p>
<ol class="arabic simple">
<li><p>Dataset generation.</p></li>
<li><p>Network fitting.</p></li>
<li><p>Optimizer.</p></li>
</ol>
<p>The following explains detailed information about the modification:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># The selected optimizer does not support CPUs. Therefore, the GPU computing platform is used for training. You need to install MindSpore of the GPU version.</span>
<span class="n">context</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">GRAPH_MODE</span><span class="p">,</span> <span class="n">device_target</span><span class="o">=</span><span class="s2">&quot;GPU&quot;</span><span class="p">)</span>

<span class="c1"># Assume that the function to be fitted is f(x)=2x^2+3x+4. Modify the data generation function as follows:</span>
<span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">3.0</span> <span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="mi">4</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">)</span>
        <span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># For details about how to generate the value of y, see the to-be-fitted objective function ax^2+bx+c.</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">a</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">b</span> <span class="o">+</span> <span class="n">c</span> <span class="o">+</span> <span class="n">noise</span>
        <span class="c1"># When fitting a*x^2 + b*x +c, a and b are weight parameters, and c is the offset parameter bias. The training data corresponding to the two weights is x^2 and x, respectively. Therefore, the dataset generation mode is changed as follows:</span>
        <span class="k">yield</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">y</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">create_dataset</span><span class="p">(</span><span class="n">num_data</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">repeat_size</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">input_data</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">GeneratorDataset</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">get_data</span><span class="p">(</span><span class="n">num_data</span><span class="p">)),</span> <span class="n">column_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">,</span><span class="s1">&#39;label&#39;</span><span class="p">])</span>
    <span class="n">input_data</span> <span class="o">=</span> <span class="n">input_data</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">batch_size</span><span class="p">)</span>
    <span class="n">input_data</span> <span class="o">=</span> <span class="n">input_data</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">repeat_size</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">input_data</span>

<span class="k">class</span> <span class="nc">LinearNet</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LinearNet</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># Two training parameters are input for the full connection function. Therefore, the input value is changed to 2. The first Normal(0.02) automatically allocates random weights to the two input parameters, and the second Normal is the random bias.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Normal</span><span class="p">(</span><span class="mf">0.02</span><span class="p">),</span> <span class="n">Normal</span><span class="p">(</span><span class="mf">0.02</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">num_data</span> <span class="o">=</span> <span class="mi">1600</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">16</span>
    <span class="n">repeat_size</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">lr</span> <span class="o">=</span> <span class="mf">0.005</span>
    <span class="n">momentum</span> <span class="o">=</span> <span class="mf">0.9</span>

    <span class="n">net</span> <span class="o">=</span> <span class="n">LinearNet</span><span class="p">()</span>
    <span class="n">net_loss</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">loss</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()</span>
    <span class="c1"># RMSProp optimizer with better effect is selected for quadratic function fitting. Currently, Ascend and GPU computing platforms are supported.</span>
    <span class="n">opt</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">RMSProp</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">trainable_params</span><span class="p">(),</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">net_loss</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>

    <span class="n">ds_train</span> <span class="o">=</span> <span class="n">create_dataset</span><span class="p">(</span><span class="n">num_data</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">repeat_size</span><span class="o">=</span><span class="n">repeat_size</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ds_train</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="n">LossMonitor</span><span class="p">(),</span> <span class="n">dataset_sink_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">trainable_params</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">net</span><span class="o">.</span><span class="n">trainable_params</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<br/>
<p><font size=3><strong>Q: How do I execute a single <code class="docutils literal notranslate"><span class="pre">ut</span></code> case in <code class="docutils literal notranslate"><span class="pre">mindspore/tests</span></code>?</strong></font></p>
<p>A: <code class="docutils literal notranslate"><span class="pre">ut</span></code> cases are usually based on the MindSpore package of the debug version, which is not provided on the official website. You can run <code class="docutils literal notranslate"><span class="pre">sh</span> <span class="pre">build.sh</span></code> to compile the source code and then run the <code class="docutils literal notranslate"><span class="pre">pytest</span></code> command. The compilation in debug mode does not depend on the backend. Run the <code class="docutils literal notranslate"><span class="pre">sh</span> <span class="pre">build.sh</span> <span class="pre">-t</span> <span class="pre">on</span></code> command. For details about how to execute cases, see the <code class="docutils literal notranslate"><span class="pre">tests/runtest.sh</span></code> script.</p>
<br/>
<p><font size=3><strong>Q: For Ascend users, how to get more detailed logs when the <code class="docutils literal notranslate"><span class="pre">run</span> <span class="pre">task</span> <span class="pre">error</span></code> is reported?</strong></font></p>
<p>A: Use the msnpureport tool to set the on-device log level. The tool is stored in <code class="docutils literal notranslate"><span class="pre">/usr/local/Ascend/driver/tools/msnpureport</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>-<span class="w"> </span>Global:<span class="w"> </span>/usr/local/Ascend/driver/tools/msnpureport<span class="w"> </span>-g<span class="w"> </span>info
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>-<span class="w"> </span>Module-level:<span class="w"> </span>/usr/local/Ascend/driver/tools/msnpureport<span class="w"> </span>-m<span class="w"> </span>SLOG:error
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>-<span class="w"> </span>Event-level:<span class="w"> </span>/usr/local/Ascend/driver/tools/msnpureport<span class="w"> </span>-e<span class="w"> </span>disable/enable
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>-<span class="w"> </span>Multi-device<span class="w"> </span>ID-level:<span class="w"> </span>/usr/local/Ascend/driver/tools/msnpureport<span class="w"> </span>-d<span class="w"> </span><span class="m">1</span><span class="w"> </span>-g<span class="w"> </span>warning
</pre></div>
</div>
<p>Assume that the value range of deviceID is [0, 7], and <code class="docutils literal notranslate"><span class="pre">devices</span> <span class="pre">0‚Äì3</span></code> and <code class="docutils literal notranslate"><span class="pre">devices</span> <span class="pre">4‚Äì7</span></code> are on the same OS. <code class="docutils literal notranslate"><span class="pre">Devices</span> <span class="pre">0‚Äì3</span></code> share the same log configuration file and <code class="docutils literal notranslate"><span class="pre">devices</span> <span class="pre">4‚Äì7</span></code> share the same configuration file. In this way, changing the log level of any device (for example device 0) will change that of other devices (for example <code class="docutils literal notranslate"><span class="pre">devices</span> <span class="pre">1‚Äì3</span></code>). This rule also applies to <code class="docutils literal notranslate"><span class="pre">devices</span> <span class="pre">4‚Äì7</span></code>.</p>
<p>After the driver package is installed (assuming that the installation path is /usr/local/HiAI and the execution file <code class="docutils literal notranslate"><span class="pre">msnpureport.exe</span></code> is in the C:\ProgramFiles\Huawei\Ascend\Driver\tools\ directory on Windows), run the command in the /home/shihangbo/ directory to export logs on the device to the current directory and store logs in a folder named after the timestamp.</p>
<br/>
<p><font size=3><strong>Q: How do I change hyperparameters for calculating loss values during neural network training?</strong></font></p>
<p>A: Sorry, this function is not available yet. You can find the optimal hyperparameters by training, redefining an optimizer, and then training.</p>
<br/>
<p><font size=3><strong>Q: What should I do when error <code class="docutils literal notranslate"><span class="pre">error</span> <span class="pre">while</span> <span class="pre">loading</span> <span class="pre">shared</span> <span class="pre">libraries:</span> <span class="pre">libge_compiler.so:</span> <span class="pre">cannot</span> <span class="pre">open</span> <span class="pre">shared</span> <span class="pre">object</span> <span class="pre">file:</span> <span class="pre">No</span> <span class="pre">such</span> <span class="pre">file</span> <span class="pre">or</span> <span class="pre">directory</span></code> prompts during application running?</strong></font></p>
<p>A: While installing Ascend 310 AI Processor software packagesÔºåthe <code class="docutils literal notranslate"><span class="pre">CANN</span></code> package should install the full-featured <code class="docutils literal notranslate"><span class="pre">toolkit</span></code> version instead of the <code class="docutils literal notranslate"><span class="pre">nnrt</span></code> version.</p>
<br/>
<p><font size=3><strong>Q: Why does context.set_ps_context(enable_ps=True) in model_zoo/official/cv/resnet/train.py in the MindSpore code have to be set before init?</strong></font></p>
<p>A: In MindSpore Ascend mode, if init is called first, then all processes will be allocated cards, but in parameter server training mode, the server does not need to allocate cards, then the worker and server will use the same card, resulting in an error: HCCL dependent tsd is not open.</p>
<br/>
<p><font size=3><strong>Q: What should I do if the memory continues to increase when resnet50 training is being performed on the CPU ARM platform?</strong></font></p>
<p>A: When performing resnet50 training on the CPU ARM, some operators are implemented based on the oneDNN library, and the oneDNN library is based on the libgomp library to achieve multi-threaded parallelism. Currently, libgomp has multiple parallel domain configurations. The number of threads is different and the memory usage continues to increase. The continuous growth of memory can be controlled by configuring a uniform number of threads globally. For comprehensive performance considerations, it is recommended to configure a unified configuration to 1/4 of the number of physical cores, such as export <code class="docutils literal notranslate"><span class="pre">OMP_NUM_THREADS=32</span></code>.</p>
<p><font size=3><strong>Q: Why report an error that the stream exceeds the limit when executing the model on the Ascend platformÔºü</strong></font></p>
<p>A: Stream represents an operation queue. Tasks on the same stream are executed in sequence, and different streams can be executed in parallel. Various operations in the network generate tasks and are assigned to streams to control the concurrent mode of task execution. Ascend platform has a limit on the number of tasks on the same stream, and tasks that exceed the limit will be assigned to new streams. The multiple parallel methods of MindSpore will also assign new streams, such as parallel communication operators. Therefore, when the number of assigned streams exceeds the resource limit of the Ascend platform, an error will be reported. Reference solution:</p>
<ul class="simple">
<li><p>Reduce the size of the network model</p></li>
<li><p>Reduce the use of communication operators in the network</p></li>
<li><p>Reduce conditional control statements in the network</p></li>
</ul>
<br/>
<p><font size=3><strong>Q: On the Ascend platform, if an error ‚ÄúAscend error occurred, error message:‚Äù is reported and followed by an error code, such as ‚ÄúE40011‚Äù, how to find the cause of the error code?</strong></font></p>
<p>A: When ‚ÄúAscend error occurred, error message:‚Äù appears, it indicates that a module of Ascend CANN is abnormal and the error code is reported.</p>
<p>At this time, there is an error message after the error code. If you need a more detailed possible cause and solution for this exception, please refer to the ‚Äúerror code troubleshooting‚Äù section of the corresponding Ascend version document, such as <a class="reference external" href="https://support.huaweicloud.com/trouble-cann503alpha2training/atlaspd_15_0001.html">CANN Community 5.0.3 alpha 002 (training) Error Code troubleshooting</a>.</p>
<br/>
<p><font size=3><strong>Q: When the third-party component gensim is used to train the NLP network, the error ‚ÄúValueError‚Äù may be reported. What can I do?</strong></font></p>
<p>A: The following error information is displayed:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt;<span class="w"> </span>import<span class="w"> </span>gensim
Traceback<span class="w"> </span><span class="o">(</span>most<span class="w"> </span>recent<span class="w"> </span>call<span class="w"> </span>last<span class="o">)</span>:
<span class="w">  </span>File<span class="w"> </span><span class="s2">&quot;&lt;stdin&gt;&quot;</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">1</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>&lt;module&gt;
<span class="w">  </span>File<span class="w"> </span><span class="s2">&quot;/home/miniconda3/envs/ci39_cj/lib/python3.9/site-packages/gensim/__init__.py&quot;</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">11</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>&lt;module&gt;
<span class="w">    </span>from<span class="w"> </span>gensim<span class="w"> </span>import<span class="w"> </span>parsing,<span class="w"> </span>corpora,<span class="w"> </span>matutils,<span class="w"> </span>interfaces,<span class="w"> </span>models,<span class="w"> </span>similarities,<span class="w"> </span>utils<span class="w">  </span><span class="c1"># noqa:F401</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">&quot;/home/miniconda3/envs/ci39_cj/lib/python3.9/site-packages/gensim/corpora/__init__.py&quot;</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">6</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>&lt;module&gt;
<span class="w">    </span>from<span class="w"> </span>.indexedcorpus<span class="w"> </span>import<span class="w"> </span>IndexedCorpus<span class="w">  </span><span class="c1"># noqa:F401 must appear before the other classes</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">&quot;/home/miniconda3/envs/ci39_cj/lib/python3.9/site-packages/gensim/corpora/indexedcorpus.py&quot;</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">14</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>&lt;module&gt;
<span class="w">    </span>from<span class="w"> </span>gensim<span class="w"> </span>import<span class="w"> </span>interfaces,<span class="w"> </span>utils
<span class="w">  </span>File<span class="w"> </span><span class="s2">&quot;/home/miniconda3/envs/ci39_cj/lib/python3.9/site-packages/gensim/interfaces.py&quot;</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">19</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>&lt;module&gt;
<span class="w">    </span>from<span class="w"> </span>gensim<span class="w"> </span>import<span class="w"> </span>utils,<span class="w"> </span>matutils
<span class="w">  </span>File<span class="w"> </span><span class="s2">&quot;/home/miniconda3/envs/ci39_cj/lib/python3.9/site-packages/gensim/matutils.py&quot;</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">1024</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>&lt;module&gt;
<span class="w">    </span>from<span class="w"> </span>gensim._matutils<span class="w"> </span>import<span class="w"> </span>logsumexp,<span class="w"> </span>mean_absolute_difference,<span class="w"> </span>dirichlet_expectation
<span class="w">  </span>File<span class="w"> </span><span class="s2">&quot;gensim/_matutils.pyx&quot;</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">1</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>init<span class="w"> </span>gensim._matutils
ValueError:<span class="w"> </span>numpy.ndarray<span class="w"> </span>size<span class="w"> </span>changed,<span class="w"> </span>may<span class="w"> </span>indicate<span class="w"> </span>binary<span class="w"> </span>incompatibility.<span class="w"> </span>Expected<span class="w"> </span><span class="m">88</span><span class="w"> </span>from<span class="w"> </span>C<span class="w"> </span>header,<span class="w"> </span>got<span class="w"> </span><span class="m">80</span><span class="w"> </span>from<span class="w"> </span>PyObject
</pre></div>
</div>
<p>For details about the error cause, see the <a class="reference external" href="https://github.com/RaRe-Technologies/gensim/issues/3095">gensim</a> or <a class="reference external" href="https://github.com/numpy/numpy/issues/18709">numpy</a> official website.</p>
<p>Solutions:</p>
<p>Method 1: Reinstall the Numpy and Gensim and run the following commands: <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">uninstall</span> <span class="pre">gensim</span> <span class="pre">numpy</span> <span class="pre">-y</span> <span class="pre">&amp;&amp;</span> <span class="pre">pip</span> <span class="pre">install</span> <span class="pre">numpy==1.18.5</span> <span class="pre">gensim</span></code></p>
<p>Method 2: If the problem persists, delete the cache file of the wheel installation package and then perform method 1. (The cache directory of the wheel installation package is <code class="docutils literal notranslate"><span class="pre">~/.cache/pip/wheels</span></code>)</p>
<br/>
<section id="network-compilation-problems">
<h2>Network Compilation Problems<a class="headerlink" href="#network-compilation-problems" title="Permalink to this headline">ÔÉÅ</a></h2>
<p><font size=3><strong>Q: What can I do if an error ‚ÄúCreate python object `&lt;class ‚Äòmindspore.common.tensor.Tensor‚Äô&gt;` failed, only support create Cell or Primitive object.‚Äù is reported?</strong></font></p>
<p>A: Currently in graph mode, the <code class="docutils literal notranslate"><span class="pre">construct</span></code> function (or the function decorated by the <code class="docutils literal notranslate"><span class="pre">&#64;ms_function</span></code> decorator) only supports the construction of <code class="docutils literal notranslate"><span class="pre">Cell</span></code> and <code class="docutils literal notranslate"><span class="pre">Primitive</span> <span class="pre">object</span></code>. The construction of <code class="docutils literal notranslate"><span class="pre">Tensor</span></code> is not supported, that is, the syntax <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">Tensor(args...)</span></code> is not supported.</p>
<p>If it is a constant tensor, please define it in the function <code class="docutils literal notranslate"><span class="pre">__init__</span></code>. If not, you can use the <code class="docutils literal notranslate"><span class="pre">&#64;constexpr</span></code> decorator to modify the function and generate the <code class="docutils literal notranslate"><span class="pre">Tensor</span></code> in the function.</p>
<p>Please see the usage of <code class="docutils literal notranslate"><span class="pre">&#64;constexpr</span></code> in <a class="reference external" href="https://www.mindspore.cn/docs/api/en/master/api_python/ops/mindspore.ops.constexpr.html">https://www.mindspore.cn/docs/api/en/master/api_python/ops/mindspore.ops.constexpr.html</a>.</p>
<p>The constant <code class="docutils literal notranslate"><span class="pre">Tensor</span></code> used on the network can be used as a network attribute and defined in <code class="docutils literal notranslate"><span class="pre">init</span></code>, that is, <code class="docutils literal notranslate"><span class="pre">self.x</span> <span class="pre">=</span> <span class="pre">Tensor(args...)</span></code>. Then the constant can be used in the <code class="docutils literal notranslate"><span class="pre">construct</span></code> function (or the function decorated by the <code class="docutils literal notranslate"><span class="pre">&#64;ms_function</span></code> decorator).</p>
<p>In the following example, <code class="docutils literal notranslate"><span class="pre">Tensor</span></code> of <code class="docutils literal notranslate"><span class="pre">shape</span> <span class="pre">=</span> <span class="pre">(3,</span> <span class="pre">4),</span> <span class="pre">dtype</span> <span class="pre">=</span> <span class="pre">int64</span></code> is generated by <code class="docutils literal notranslate"><span class="pre">&#64;constexpr</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@constexpr</span>
<span class="k">def</span> <span class="nf">generate_tensor</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)))</span>
</pre></div>
</div>
<br/>
<p><font size=3><strong>Q: What can I do if an error ‚Äú‚Äòself.xx‚Äô should be defined in the class ‚Äò<strong>init</strong>‚Äô function.‚Äù is reported?</strong></font></p>
<p>A: If you want to assign for a class member such as <code class="docutils literal notranslate"><span class="pre">self.xx</span></code> in the function <code class="docutils literal notranslate"><span class="pre">construct</span></code>, <code class="docutils literal notranslate"><span class="pre">self.xx</span></code> must have been defined to a <a class="reference external" href="https://www.mindspore.cn/docs/api/en/master/api_python/mindspore/mindspore.Parameter.html">Parameter</a> type firstly while the other types are not supported. But the local variable <code class="docutils literal notranslate"><span class="pre">xx</span></code> is not under the regulation.</p>
<br/>
<p><font size=3><strong>Q: What can I do if an error ‚ÄúThis comparator ‚ÄòAnyValue‚Äô is not supported. For statement ‚Äòis‚Äô, only support compare with ‚ÄòNone‚Äô, ‚ÄòFalse‚Äô or ‚ÄòTrue‚Äô‚Äù is reported?</strong></font></p>
<p>A: For the syntax <code class="docutils literal notranslate"><span class="pre">is</span></code> or <code class="docutils literal notranslate"><span class="pre">is</span> <span class="pre">not</span></code>, currently <code class="docutils literal notranslate"><span class="pre">MindSpore</span></code> only supports comparisons with <code class="docutils literal notranslate"><span class="pre">True</span></code>, <code class="docutils literal notranslate"><span class="pre">False</span></code> and <code class="docutils literal notranslate"><span class="pre">None</span></code>. Other types, such as strings, are not supported.</p>
<br/>
<p><font size=3><strong>Q: What can I do if an error ‚ÄúMindSpore does not support comparison with operators more than one now, ops size =2‚Äù is reported?</strong></font></p>
<p>A: For comparison statements, <code class="docutils literal notranslate"><span class="pre">MindSpore</span></code> supports at most one operator. Please modify your code. For example, you can use <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">&lt;</span> <span class="pre">x</span> <span class="pre">and</span> <span class="pre">x</span> <span class="pre">&lt;</span> <span class="pre">3</span></code> to take the place of <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">&lt;</span> <span class="pre">x</span> <span class="pre">&lt;</span> <span class="pre">3</span></code>.</p>
<br/>
<p><font size=3><strong>Q: What can I do if an error ‚ÄúTypeError: The function construct need 1 positional argument and 0 default argument, but provided 2‚Äù is reported?</strong></font></p>
<p>A: When you call the instance of a network, the function <code class="docutils literal notranslate"><span class="pre">construct</span></code> will be executed. And the program will check the number of parameters required by the function <code class="docutils literal notranslate"><span class="pre">construct</span></code> and the number of parameters actually given. If they are not equal, the above exception will be thrown.
Please check your code to make sure they are equal.</p>
<br/>
<p><font size=3><strong>Q: What can I do if an error ‚ÄúType Join Failed‚Äù or ‚ÄúShape Join Failed‚Äù is reported?</strong></font></p>
<p>A: In the inference stage of front-end compilation, the abstract types of nodes, including <code class="docutils literal notranslate"><span class="pre">type</span></code> and <code class="docutils literal notranslate"><span class="pre">shape</span></code>, will be inferred. Common abstract types include <code class="docutils literal notranslate"><span class="pre">AbstractScalar</span></code>, <code class="docutils literal notranslate"><span class="pre">AbstractTensor</span></code>, <code class="docutils literal notranslate"><span class="pre">AbstractFunction</span></code>, <code class="docutils literal notranslate"><span class="pre">AbstractTuple</span></code>, <code class="docutils literal notranslate"><span class="pre">AbstractList</span></code>, etc. In some scenarios, such as multi-branch scenarios, the abstract types of the return values of different branches will be joined to infer the abstract type of the returned result. If these abstract types do not match, or <code class="docutils literal notranslate"><span class="pre">type</span></code>/<code class="docutils literal notranslate"><span class="pre">shape</span></code> are inconsistent, the above exception will be thrown.</p>
<p>When an error similar to ‚ÄúType Join Failed: dtype1 = Float32, dtype2 = Float16‚Äù appears, it means that the data types are inconsistent, resulting in an exception when joining abstract. According to the provided data types and code line, the error can be quickly located. In addition, the specific abstract information and node information are provided in the error message. You can view the MindIR information through the <code class="docutils literal notranslate"><span class="pre">analyze_fail.dat</span></code> file to locate and solve the problem. For specific introduction of MindIR, please refer to <a class="reference external" href="https://www.mindspore.cn/docs/programming_guide/en/master/design/mindir.html">MindSpore IR (MindIR)</a>. The code sample is as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">import</span> <span class="nn">mindspore.ops</span> <span class="k">as</span> <span class="nn">ops</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">nn</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">context</span>

<span class="n">context</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">GRAPH_MODE</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relu</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">ReLU</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cast</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">Cast</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">ms</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span>

<span class="n">input_x</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="n">input_a</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">ms</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">input_b</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">ms</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">net</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
<span class="n">out_me</span> <span class="o">=</span> <span class="n">net</span><span class="p">(</span><span class="n">input_x</span><span class="p">,</span> <span class="n">input_a</span><span class="p">,</span> <span class="n">input_b</span><span class="p">)</span>
</pre></div>
</div>
<p>The result is as follows:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>TypeError: The return values of different branches do not match. Type Join Failed: dtype1 = Float32, dtype2 = Float16. The abstract type of the return value of the current branch is AbstractTensor(shape: (2, 3, 4, 5), element: AbstractScalar(Type: Float16, Value: AnyValue, Shape: NoShape), value_ptr: 0x32ed00e0, value: AnyValue), and that of the previous branch is AbstractTensor(shape: (2, 3, 4, 5), element: AbstractScalar(Type: Float32, Value: AnyValue, Shape: NoShape), value_ptr: 0x32ed00e0, value: AnyValue). Please check the node construct.4:[CNode]5{[0]: [CNode]6}, true branch: ‚úìconstruct.2, false branch: ‚úóconstruct.3. trace:
In file test_join.py(14)/        if a &gt; b:/

The function call stack (See file &#39;analyze_fail.dat&#39; for more details):
# 0 In file test_join.py(14)
        if a &gt; b:
</pre></div>
</div>
<p>When an error similar to ‚ÄúShape Join Failed: shape1 = (2, 3, 4, 5), shape2 = ()‚Äù appears, it means that the shapes are inconsistent, resulting in an exception when joining abstract. The code sample is as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">import</span> <span class="nn">mindspore.ops</span> <span class="k">as</span> <span class="nn">ops</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">nn</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">context</span>

<span class="n">context</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">GRAPH_MODE</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relu</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">ReLU</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reducesum</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">ReduceSum</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reducesum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">input_x</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="n">input_a</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">ms</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">input_b</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">ms</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">net</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">net</span><span class="p">(</span><span class="n">input_x</span><span class="p">,</span> <span class="n">input_a</span><span class="p">,</span> <span class="n">input_b</span><span class="p">)</span>
</pre></div>
</div>
<p>The result is as follows:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ValueError: The return values of different branches do not match. Shape Join Failed: shape1 = (2, 3, 4, 5), shape2 = (). The abstract type of the return value of the current branch is AbstractTensor(shape: (), element: AbstractScalar(Type: Float32, Value: AnyValue, Shape: NoShape), value_ptr: 0x239b5120, value: AnyValue), and that of the previous branch is AbstractTensor(shape: (2, 3, 4, 5), element: AbstractScalar(Type: Float32, Value: AnyValue, Shape: NoShape), value_ptr: 0x239b5120, value: AnyValue). Please check the node construct.4:[CNode]5{[0]: [CNode]6}, true branch: ‚úìconstruct.2, false branch: ‚úóconstruct.3. trace:
In file test_join1.py(14)/        if a &gt; b:/

The function call stack (See file &#39;analyze_fail.dat&#39; for more details):
# 0 In file test_join1.py(14)
        if a &gt; b:
</pre></div>
</div>
<p>When an error similar to ‚ÄúType Join Failed: abstract type AbstractTensor can not join with AbstractTuple‚Äù appears, it means that the two abstract types are mismatched. You need to review the code and modify it based on the provided code line and other error information.</p>
<br/>
<p><font size=3><strong>Q: What can I do if an error ‚ÄúThe params of function ‚Äòbprop‚Äô of Primitive or Cell requires the forward inputs as well as the ‚Äòout‚Äô and ‚Äòdout‚Äù is reported?</strong></font></p>
<p>A: The inputs of user-defined back propagation function <code class="docutils literal notranslate"><span class="pre">bprop</span></code> should contain all the inputs of the forward pass, <code class="docutils literal notranslate"><span class="pre">out</span></code> and <code class="docutils literal notranslate"><span class="pre">dout</span></code>. The example is as follow:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BpropUserDefinedNet</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">BpropUserDefinedNet</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zeros_like</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">ZerosLike</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

        <span class="k">def</span> <span class="nf">bprop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">dout</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">out</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</pre></div>
</div>
<br/>
<p><font size=3><strong>Q: What can I do if an error ‚ÄúThere isn‚Äôt any branch that can be evaluated‚Äú is reported?</strong></font>
When an error similar to ‚ÄúThere isn‚Äôt any branch that can be evaluated‚Äù appears.
it means that there may be infinite recursion or loop in the code, which causes each branch of the if condition to be unable to deduce the correct type and dimension information.</p>
<p>The example is as follow:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">ms_function</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">dtype</span> <span class="k">as</span> <span class="n">mstype</span>
<span class="kn">import</span> <span class="nn">mindspore.context</span> <span class="k">as</span> <span class="nn">context</span>
<span class="n">ZERO</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<span class="n">ONE</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span> <span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<span class="nd">@ms_function</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">ZERO</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">z</span>

<span class="k">def</span> <span class="nf">test_endless</span><span class="p">():</span>
    <span class="n">context</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">GRAPH_MODE</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">([</span><span class="mi">5</span><span class="p">],</span> <span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

</pre></div>
</div>
<p>the f(x)‚Äôs each branch of the if condition cannot deduce the correct type and dimension information</p>
<br/>
<p><font size=3><strong>Q: What can I do if an error ‚ÄúExceed function call depth limit 1000‚Äù is reported?</strong></font></p>
<p>This indicates that there is an infinite recursive loop in the code, or the code is too complex, that caused the stack depth exceed.</p>
<p>At this time, you can set context.set_context(max_call_depth = value) to change the maximum depth of the stack, and consider simplifying the code logic or checking whether there is infinite recursion or loop in the code.</p>
<p>Otherwise, set max_call_depth can change the recursive depth of MindSpore, it may also cause exceed the maximum depth of the system stack and cause segment fault. At this time, you may also need to set the system stack depth.</p>
<br/>
<p><font size=3><strong>Q: Why report an error that ‚Äòcould not get source code‚Äô and ‚ÄòMindspore can not compile temporary source code in terminal. Please write source code to a python file and run the file.‚Äô?</strong></font></p>
<p>A: When compiling a network, MindSpore use <code class="docutils literal notranslate"><span class="pre">inspect.getsourcelines(self.fn)</span></code> to get the code file. If the network is the temporary code which edited in terminal, MindSpore will report an error as the title. It can be solved if writing the network to a python file.</p>
<br/>
<p><font size=3><strong>Q: What should I do if I encounter <code class="docutils literal notranslate"><span class="pre">matplotlib.pyplot.show()</span></code> (most often plt.show()) cannot be executed during the tutorial is running?</strong></font></p>
<p>A: First confirm whether <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> is installed. If it is not installed, you can execute <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">matplotlib</span></code> on the command line to install it.</p>
<p>Secondly, because the function of <code class="docutils literal notranslate"><span class="pre">matplotlib.pyplot.show()</span></code> is to display graph data graphically, it is necessary to run the system to support the graph display function. If the system cannot support graph display, the reader needs to comment out the command line of the graph display. Operation will not affect the results of the overall code.</p>
<br/>
<p><font size=3><strong>Q: What issues should be paid attention to when using the <em>Run in ModelArts</em> in tutorials?</strong></font></p>
<p>A: Need to confirm that the following preparations have been done.</p>
<ul class="simple">
<li><p>First, you need to log in to ModelArts through your HUAWEI CLOUD account.</p></li>
<li><p>Secondly, note that the hardware environment supported by the tags in the tutorial document is Ascend, GPU or CPU. Since the hardware environment used by default after login is CPU, the Ascend environment and GPU environment need to be switched manually by the user.</p></li>
<li><p>Finally, confirm that the current <code class="docutils literal notranslate"><span class="pre">Kernel</span></code> of Jupyter Notebook is MindSpore.</p></li>
</ul>
<p>After completing the above steps, you can run the tutorial.</p>
<p>For the specific operation process, please refer to <a class="reference external" href="https://bbs.huaweicloud.com/forum/thread-168982-1-1.html">Based on ModelArts Online Experience MindSpore</a>.</p>
<br/></section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="data_processing.html" class="btn btn-neutral float-left" title="Data Processing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="operators_compile.html" class="btn btn-neutral float-right" title="Operators Compile" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, MindSpore.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 
</body>
</html>