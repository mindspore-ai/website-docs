<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>执行问题 &mdash; MindSpore master documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="算子编译" href="operators_compile.html" />
    <link rel="prev" title="数据处理" href="data_processing.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> MindSpore
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">安装</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_processing.html">数据处理</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">执行问题</a></li>
<li class="toctree-l1"><a class="reference internal" href="operators_compile.html">算子编译</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage_migrate_3rd.html">第三方框架迁移使用</a></li>
<li class="toctree-l1"><a class="reference internal" href="performance_tuning.html">性能调优</a></li>
<li class="toctree-l1"><a class="reference internal" href="precision_tuning.html">精度调优</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed_configure.html">分布式配置</a></li>
<li class="toctree-l1"><a class="reference internal" href="inference.html">推理</a></li>
<li class="toctree-l1"><a class="reference internal" href="feature_advice.html">特性咨询</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MindSpore</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>执行问题</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/implement_problem.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="id1">
<h1>执行问题<a class="headerlink" href="#id1" title="Permalink to this headline"></a></h1>
<p><code class="docutils literal notranslate"><span class="pre">Linux</span></code> <code class="docutils literal notranslate"><span class="pre">Windows</span></code> <code class="docutils literal notranslate"><span class="pre">Ascend</span></code> <code class="docutils literal notranslate"><span class="pre">GPU</span></code> <code class="docutils literal notranslate"><span class="pre">CPU</span></code> <code class="docutils literal notranslate"><span class="pre">环境准备</span></code> <code class="docutils literal notranslate"><span class="pre">初级</span></code> <code class="docutils literal notranslate"><span class="pre">中级</span></code></p>
<p><a href="https://gitee.com/mindspore/docs/blob/r1.3/docs/mindspore/faq/source_zh_cn/implement_problem.md" target="_blank"><img src="https://gitee.com/mindspore/docs/raw/r1.3/resource/_static/logo_source.png"></a></p>
<p><font size=3><strong>Q: 使用MindSpore在模型保存后生成的<code class="docutils literal notranslate"><span class="pre">.meta</span></code>文件作用是什么，可以用<code class="docutils literal notranslate"><span class="pre">.meta</span></code>文件导入图结构吗？</strong></font></p>
<p>A: 这里的<code class="docutils literal notranslate"><span class="pre">.meta</span></code>文件是编译好的图结构，但是目前并不支持直接导入这种结构。如果不知道图结构的情况下想要导入网络，还是需要用MindIR格式的文件。</p>
<br/>
<p><font size=3><strong>Q: 请问<code class="docutils literal notranslate"><span class="pre">yolov4-tiny-3l.weights</span></code>模型文件可以直接转换成MindSpore模型吗？</strong></font></p>
<p>A: 不能的，需要把其他框架训练好的参数转换成MindSpore的格式，才能转成MindSpore的模型。</p>
<br/>
<p><font size=3><strong>Q: 使用MindSpore进行<code class="docutils literal notranslate"><span class="pre">model.train</span></code>的时候进行了如下设置，为什么会报错呢？</strong></font></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="n">LossMonitor</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">dataset_sink_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="n">LossMonitor</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">dataset_sink_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>A: 因为在已经设置为下沉模式的情况下，就不能再设置为非下沉了，是运行机制上的限制。</p>
<br/>
<p><font size=3><strong>Q: 使用MindSpore训练模型在<code class="docutils literal notranslate"><span class="pre">eval</span></code>阶段，需要注意什么？能够直接加载网络和参数吗？需要在Model中使用优化器吗？</strong></font></p>
<p>A: 在<code class="docutils literal notranslate"><span class="pre">eval</span></code>阶段主要看需要什么，比如图像分类任务<code class="docutils literal notranslate"><span class="pre">eval</span></code>网络的输出是各个类的概率值，与对应标签计算<code class="docutils literal notranslate"><span class="pre">acc</span></code>。
大多数情况是可以直接复用训练的网络和参数的，需要注意的是需要设置推理模式。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">net</span><span class="o">.</span><span class="n">set_train</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>在eval阶段不需要优化器，但是需要使用MindSpore的<code class="docutils literal notranslate"><span class="pre">model.eval</span></code>接口的话需要配置一下<code class="docutils literal notranslate"><span class="pre">loss</span> <span class="pre">function</span></code>，如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 定义模型</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">loss_fn</span><span class="o">=</span><span class="n">loss</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;top_1_accuracy&#39;</span><span class="p">,</span> <span class="s1">&#39;top_5_accuracy&#39;</span><span class="p">})</span>
<span class="c1"># 评估模型</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
</pre></div>
</div>
<br/>
<p><font size=3><strong>Q: 如何使用SGD里的<code class="docutils literal notranslate"><span class="pre">param_group</span></code>来实现学习率的衰减？</strong></font></p>
<p>A: 如果需要按照<code class="docutils literal notranslate"><span class="pre">epoch</span></code>来变化，可以使用<a class="reference external" href="https://mindspore.cn/docs/api/zh-CN/r1.3/api_python/mindspore.nn.html#dynamic-lr">Dynamic LR</a>,把其中的<code class="docutils literal notranslate"><span class="pre">step_per_epoch</span></code>设置成<code class="docutils literal notranslate"><span class="pre">step_size</span></code>，如果需要按照<code class="docutils literal notranslate"><span class="pre">step</span></code>来变化，可以把其中的<code class="docutils literal notranslate"><span class="pre">step_per_epoch</span></code>设置成1，也可以用<a class="reference external" href="https://mindspore.cn/docs/api/zh-CN/r1.3/api_python/mindspore.nn.html#dynamic-learning-rate">LearningRateSchedule</a>。</p>
<br/>
<p><font size=3><strong>Q: MindSpore如何进行参数（如dropout值）修改？</strong></font></p>
<p>A: 在构造网络的时候可以通过 <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">self.training:</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">dropput(x)</span></code>，推理时，执行前设置<code class="docutils literal notranslate"><span class="pre">network.set_train(mode_false)</span></code>，就可以不使用dropout，训练时设置为True就可以使用dropout。</p>
<br/>
<p><font size=3><strong>Q: 如何查看模型参数量？</strong></font></p>
<p>A: 可以直接加载CheckPoint统计，可能额外统计了动量和optimizer中的变量，需要过滤下相关变量。
您可以参考如下接口统计网络参数量:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">count_params</span><span class="p">(</span><span class="n">net</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Count number of parameters in the network</span>
<span class="sd">    Args:</span>
<span class="sd">        net (mindspore.nn.Cell): Mindspore network instance</span>
<span class="sd">    Returns:</span>
<span class="sd">        total_params (int): Total number of trainable params</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">total_params</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">net</span><span class="o">.</span><span class="n">trainable_params</span><span class="p">():</span>
        <span class="n">total_params</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">total_params</span>
</pre></div>
</div>
<p>具体<a class="reference external" href="https://gitee.com/mindspore/mindspore/blob/r1.3/model_zoo/research/cv/tinynet/src/utils.py">脚本链接</a>。</p>
<br/>
<p><font size=3><strong>Q: 如何在训练过程中监控<code class="docutils literal notranslate"><span class="pre">loss</span></code>在最低的时候并保存训练参数？</strong></font></p>
<p>A: 可以自定义一个<code class="docutils literal notranslate"><span class="pre">Callback</span></code>。参考<code class="docutils literal notranslate"><span class="pre">ModelCheckpoint</span></code>的写法，此外再增加判断<code class="docutils literal notranslate"><span class="pre">loss</span></code>的逻辑:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">EarlyStop</span><span class="p">(</span><span class="n">Callback</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loss</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">def</span> <span class="nf">step_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_context</span><span class="p">):</span>
        <span class="n">loss</span> <span class="o">=</span>  <span class="o">****</span><span class="p">(</span><span class="n">get</span> <span class="n">current</span> <span class="n">loss</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loss</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">loss</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">loss</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loss</span> <span class="o">=</span> <span class="n">loss</span>
            <span class="c1"># do save ckpt</span>
</pre></div>
</div>
<br/>
<p><font size=3><strong>Q: 使用<code class="docutils literal notranslate"><span class="pre">nn.Conv2d</span></code>时，怎样获取期望大小的<code class="docutils literal notranslate"><span class="pre">feature</span> <span class="pre">map</span></code>？</strong></font></p>
<p>A: <code class="docutils literal notranslate"><span class="pre">Conv2d shape</span></code>推导方法可以<a class="reference external" href="https://www.mindspore.cn/docs/api/zh-CN/r1.3/api_python/nn/mindspore.nn.Conv2d.html#mindspore.nn.Conv2d">参考这里</a>，<code class="docutils literal notranslate"><span class="pre">Conv2d</span></code>的<code class="docutils literal notranslate"><span class="pre">pad_mode</span></code>改成<code class="docutils literal notranslate"><span class="pre">same</span></code>，或者可以根据<code class="docutils literal notranslate"><span class="pre">Conv2d shape</span></code>推导公式自行计算<code class="docutils literal notranslate"><span class="pre">pad</span></code>，想要使得<code class="docutils literal notranslate"><span class="pre">shape</span></code>不变，一般pad为<code class="docutils literal notranslate"><span class="pre">(kernel_size-1)//2</span></code>。</p>
<br/>
<p><font size=3><strong>Q: 使用MindSpore可以自定义一个可以返回多个值的loss函数？</strong></font></p>
<p>A: 自定义<code class="docutils literal notranslate"><span class="pre">loss</span> <span class="pre">function</span></code>后还需自定义<code class="docutils literal notranslate"><span class="pre">TrainOneStepCell</span></code>，实现梯度计算时<code class="docutils literal notranslate"><span class="pre">sens</span></code>的个数和<code class="docutils literal notranslate"><span class="pre">network</span></code>的输出个数相同。具体可参考:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">net</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
<span class="n">loss_fn</span> <span class="o">=</span> <span class="n">MyLoss</span><span class="p">()</span>
<span class="n">loss_with_net</span> <span class="o">=</span> <span class="n">MyWithLossCell</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">loss_fn</span><span class="p">)</span>
<span class="n">train_net</span> <span class="o">=</span> <span class="n">MyTrainOneStepCell</span><span class="p">(</span><span class="n">loss_with_net</span><span class="p">,</span> <span class="n">optim</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">net</span><span class="o">=</span><span class="n">train_net</span><span class="p">,</span> <span class="n">loss_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<br/>
<p><font size=3><strong>Q: MindSpore如何实现早停功能？</strong></font></p>
<p>A: 可以自定义<code class="docutils literal notranslate"><span class="pre">callback</span></code>方法实现早停功能。
例子: 当loss降到一定数值后，停止训练。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">EarlyStop</span><span class="p">(</span><span class="n">Callback</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">control_loss</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">EarlyStep</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_control_loss</span> <span class="o">=</span> <span class="n">control_loss</span>

    <span class="k">def</span> <span class="nf">step_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_context</span><span class="p">):</span>
        <span class="n">cb_params</span> <span class="o">=</span> <span class="n">run_context</span><span class="o">.</span><span class="n">original_args</span><span class="p">()</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">cb_params</span><span class="o">.</span><span class="n">net_outputs</span>
        <span class="k">if</span> <span class="n">loss</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_control_loss</span><span class="p">:</span>
            <span class="c1"># Stop training</span>
            <span class="n">run_context</span><span class="o">.</span><span class="n">_stop_requested</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">stop_cb</span> <span class="o">=</span> <span class="n">EarlyStop</span><span class="p">(</span><span class="n">control_loss</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">epoch_size</span><span class="p">,</span> <span class="n">ds_train</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">stop_cb</span><span class="p">])</span>
</pre></div>
</div>
<br/>
<p><font size=3><strong>Q: 模型已经训练好，如何将模型的输出结果保存为文本或者<code class="docutils literal notranslate"><span class="pre">npy</span></code>的格式？</strong></font></p>
<p>A: 您好，我们网络的输出为<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，需要使用<code class="docutils literal notranslate"><span class="pre">asnumpy()</span></code>方法将<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>转换为<code class="docutils literal notranslate"><span class="pre">numpy</span></code>，再进行下一步保存。具体可参考:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">out</span> <span class="o">=</span> <span class="n">net</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;output.npy&quot;</span><span class="p">,</span> <span class="n">out</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">())</span>
</pre></div>
</div>
<br/>
<p><font size=3><strong>Q: 运行时报错“Create python object `&lt;class ‘mindspore.common.tensor.Tensor’&gt;` failed, only support create Cell or Primitive object.”怎么办？</strong></font></p>
<p>A: 当前在图模式下，<code class="docutils literal notranslate"><span class="pre">construct</span></code>函数(或<code class="docutils literal notranslate"><span class="pre">&#64;ms_function</span></code>装饰器修饰的函数)仅支持构造<code class="docutils literal notranslate"><span class="pre">Cell</span></code>和<code class="docutils literal notranslate"><span class="pre">Primitive</span> <span class="pre">object</span></code>，不支持构造<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，即不支持语法<code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">Tensor(args...)</span></code>。</p>
<p>如果是常量<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，请在<code class="docutils literal notranslate"><span class="pre">__init__</span></code>函数中定义。如果不是常量<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，可以通过<code class="docutils literal notranslate"><span class="pre">&#64;constexpr</span></code>装饰器修饰函数，在函数里生成<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。</p>
<p>关于<code class="docutils literal notranslate"><span class="pre">&#64;constexpr</span></code>的用法可参考: <a class="reference external" href="https://www.mindspore.cn/docs/api/zh-CN/r1.3/api_python/ops/mindspore.ops.constexpr.html">https://www.mindspore.cn/docs/api/zh-CN/r1.3/api_python/ops/mindspore.ops.constexpr.html</a>。</p>
<p>对于网络中需要用到的常量<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，可以作为网络的属性，在<code class="docutils literal notranslate"><span class="pre">init</span></code>的时候定义，即<code class="docutils literal notranslate"><span class="pre">self.x</span> <span class="pre">=</span> <span class="pre">Tensor(args...)</span></code>，然后在<code class="docutils literal notranslate"><span class="pre">construct</span></code>函数(或<code class="docutils literal notranslate"><span class="pre">&#64;ms_function</span></code>装饰器修饰的函数)里使用。</p>
<p>如下示例，通过<code class="docutils literal notranslate"><span class="pre">&#64;constexpr</span></code>生成一个<code class="docutils literal notranslate"><span class="pre">shape</span> <span class="pre">=</span> <span class="pre">(3,</span> <span class="pre">4),</span> <span class="pre">dtype</span> <span class="pre">=</span> <span class="pre">int64</span></code>的<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@constexpr</span>
<span class="k">def</span> <span class="nf">generate_tensor</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)))</span>
</pre></div>
</div>
<br/>
<p><font size=3><strong>Q: 运行时报错“’self.xx’ should be defined in the class ‘<strong>init</strong>’ function.”怎么办？</strong></font></p>
<p>A: 如果在<code class="docutils literal notranslate"><span class="pre">construct</span></code>函数里，想对类成员<code class="docutils literal notranslate"><span class="pre">self.xx</span></code>赋值，那么<code class="docutils literal notranslate"><span class="pre">self.xx</span></code>必须已经在<code class="docutils literal notranslate"><span class="pre">__init__</span></code>函数中被定义为<a class="reference external" href="https://www.mindspore.cn/docs/api/zh-CN/r1.3/api_python/mindspore.html#mindspore.Parameter"><code class="docutils literal notranslate"><span class="pre">Parameter</span></code></a>类型，其他类型则不支持。局部变量<code class="docutils literal notranslate"><span class="pre">xx</span></code>不受这个限制。</p>
<br/>
<p><font size=3><strong>Q: 运行时报错“This comparator ‘AnyValue’ is not supported. For statement ‘is’, only support compare with ‘None’, ‘False’ or ‘True’”怎么办？</strong></font></p>
<p>A: 对于语法<code class="docutils literal notranslate"><span class="pre">is</span></code> 或 <code class="docutils literal notranslate"><span class="pre">is</span> <span class="pre">not</span></code>而言，当前<code class="docutils literal notranslate"><span class="pre">MindSpore</span></code>仅支持与<code class="docutils literal notranslate"><span class="pre">True</span></code>、<code class="docutils literal notranslate"><span class="pre">False</span></code>和<code class="docutils literal notranslate"><span class="pre">None</span></code>的比较。暂不支持其他类型，如字符串等。</p>
<br/>
<p><font size=3><strong>Q: 运行时报错“MindSpore does not support comparison with operators more than one now, ops size =2”怎么办？</strong></font></p>
<p>A: 对于比较语句，<code class="docutils literal notranslate"><span class="pre">MindSpore</span></code>最多支持一个操作数。例如不支持语句<code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">&lt;</span> <span class="pre">x</span> <span class="pre">&lt;</span> <span class="pre">3</span></code>，请使用<code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">&lt;</span> <span class="pre">x</span> <span class="pre">and</span> <span class="pre">x</span> <span class="pre">&lt;</span> <span class="pre">3</span></code>的方式代替。</p>
<br/>
<p><font size=3><strong>Q: 运行时报错“TypeError: The function construct need 1 positional argument and 0 default argument, but provided 2”怎么办？</strong></font></p>
<p>A: 网络的实例被调用时，会执行<code class="docutils literal notranslate"><span class="pre">construct</span></code>方法，然后会检查<code class="docutils literal notranslate"><span class="pre">construct</span></code>方法需要的参数个数和实际传入的参数个数，如果不一致则会抛出以上异常。
请检查脚本中调用网络实例时传入的参数个数，和定义的网络中<code class="docutils literal notranslate"><span class="pre">construct</span></code>函数需要的参数个数是否一致。</p>
<br/>
<p><font size=3><strong>Q: 运行时报错“Type Join Failed”或“Shape Join Failed”怎么办？</strong></font></p>
<p>A: 在前端编译的推理阶段，会对节点的抽象类型(包含<code class="docutils literal notranslate"><span class="pre">type</span></code>、<code class="docutils literal notranslate"><span class="pre">shape</span></code>等)进行推导，常见抽象类型包括<code class="docutils literal notranslate"><span class="pre">AbstractScalar</span></code>、<code class="docutils literal notranslate"><span class="pre">AbstractTensor</span></code>、<code class="docutils literal notranslate"><span class="pre">AbstractFunction</span></code>、<code class="docutils literal notranslate"><span class="pre">AbstractTuple</span></code>、<code class="docutils literal notranslate"><span class="pre">AbstractList</span></code>等。在一些场景比如多分支场景，会对不同分支返回值的抽象类型进行<code class="docutils literal notranslate"><span class="pre">join</span></code>合并，推导出返回结果的抽象类型。如果抽象类型不匹配，或者<code class="docutils literal notranslate"><span class="pre">type</span></code>/<code class="docutils literal notranslate"><span class="pre">shape</span></code>不一致，则会抛出以上异常。</p>
<p>当出现类似“Type Join Failed: dtype1 = Float32, dtype2 = Float16”的报错时，说明数据类型不一致，导致抽象类型合并失败。根据提供的数据类型和代码行信息，可以快速定位出错范围。此外，报错信息中提供了具体的抽象类型信息、节点信息，可以通过<code class="docutils literal notranslate"><span class="pre">analyze_fail.dat</span></code>文件查看MindIR信息，定位解决问题。关于MindIR的具体介绍，可以参考<a class="reference external" href="https://www.mindspore.cn/docs/note/zh-CN/r1.3/design/mindir.html">MindSpore IR（MindIR）</a>。代码样例如下:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">import</span> <span class="nn">mindspore.ops</span> <span class="k">as</span> <span class="nn">ops</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">nn</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">context</span>

<span class="n">context</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">GRAPH_MODE</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relu</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">ReLU</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cast</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">Cast</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">ms</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span>

<span class="n">input_x</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="n">input_a</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">ms</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">input_b</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">ms</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">net</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
<span class="n">out_me</span> <span class="o">=</span> <span class="n">net</span><span class="p">(</span><span class="n">input_x</span><span class="p">,</span> <span class="n">input_a</span><span class="p">,</span> <span class="n">input_b</span><span class="p">)</span>
</pre></div>
</div>
<p>执行结果如下:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>TypeError: The return values of different branches do not match. Type Join Failed: dtype1 = Float32, dtype2 = Float16. The abstract type of the return value of the current branch is AbstractTensor(shape: (2, 3, 4, 5), element: AbstractScalar(Type: Float16, Value: AnyValue, Shape: NoShape), value_ptr: 0x32ed00e0, value: AnyValue), and that of the previous branch is AbstractTensor(shape: (2, 3, 4, 5), element: AbstractScalar(Type: Float32, Value: AnyValue, Shape: NoShape), value_ptr: 0x32ed00e0, value: AnyValue). Please check the node construct.4:[CNode]5{[0]: [CNode]6}, true branch: ✓construct.2, false branch: ✗construct.3. trace:
In file test_type_join_failed.py(14)/        if a &gt; b:/

The function call stack (See file &#39;analyze_fail.dat&#39; for more details):
# 0 In file test_type_join_failed.py(14)
        if a &gt; b:
</pre></div>
</div>
<p>当出现类似“Shape Join Failed: shape1 = (2, 3, 4, 5), shape2 = ()”的报错时，说明<code class="docutils literal notranslate"><span class="pre">shape</span></code>不一致，导致抽象类型合并失败。代码样例如下:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">import</span> <span class="nn">mindspore.ops</span> <span class="k">as</span> <span class="nn">ops</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">nn</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">context</span>

<span class="n">context</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">GRAPH_MODE</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relu</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">ReLU</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reducesum</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">ReduceSum</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reducesum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">input_x</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="n">input_a</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">ms</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">input_b</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">ms</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">net</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">net</span><span class="p">(</span><span class="n">input_x</span><span class="p">,</span> <span class="n">input_a</span><span class="p">,</span> <span class="n">input_b</span><span class="p">)</span>
</pre></div>
</div>
<p>执行结果如下:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ValueError: The return values of different branches do not match. Shape Join Failed: shape1 = (2, 3, 4, 5), shape2 = (). The abstract type of the return value of the current branch is AbstractTensor(shape: (), element: AbstractScalar(Type: Float32, Value: AnyValue, Shape: NoShape), value_ptr: 0x239b5120, value: AnyValue), and that of the previous branch is AbstractTensor(shape: (2, 3, 4, 5), element: AbstractScalar(Type: Float32, Value: AnyValue, Shape: NoShape), value_ptr: 0x239b5120, value: AnyValue). Please check the node construct.4:[CNode]5{[0]: [CNode]6}, true branch: ✓construct.2, false branch: ✗construct.3. trace:
In file test_shape_join_failed.py(14)/        if a &gt; b:/

The function call stack (See file &#39;analyze_fail.dat&#39; for more details):
# 0 In file test_shape_join_failed.py(14)
        if a &gt; b:
</pre></div>
</div>
<p>当出现如“Type Join Failed: abstract type AbstractTensor can not join with AbstractTuple”的报错时，说明这两种抽象类型无法匹配，需要根据提供的代码行等报错信息，重新检视代码并修改。</p>
<br/>
<p><font size=3><strong>Q: 缓存服务器异常关闭如何处理？</strong></font></p>
<p>A: 缓存服务器使用过程中，会进行IPC共享内存和socket文件等系统资源的分配。若允许溢出，在磁盘空间还会存在溢出的数据文件。一般情况下，如果通过<code class="docutils literal notranslate"><span class="pre">cache_admin</span> <span class="pre">--stop</span></code>命令正常关闭服务器，这些资源将会被自动清理。</p>
<p>但如果缓存服务器被异常关闭，例如缓存服务进程被杀等，用户需要首先尝试重新启动服务器，若启动失败，则应该依照以下步骤手动清理系统资源:</p>
<ul>
<li><p>删除IPC资源。</p>
<ol class="arabic">
<li><p>检查是否有IPC共享内存残留。</p>
<p>一般情况下，系统会为缓存服务分配4GB的共享内存。通过以下命令可以查看系统中的共享内存块使用情况。</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ ipcs -m
------ Shared Memory Segments --------
key        shmid      owner      perms      bytes      nattch     status
0x61020024 15532037   root       666        4294967296 1
</pre></div>
</div>
<p>其中，<code class="docutils literal notranslate"><span class="pre">shmid</span></code>为共享内存块id，<code class="docutils literal notranslate"><span class="pre">bytes</span></code>为共享内存块的大小，<code class="docutils literal notranslate"><span class="pre">nattch</span></code>为链接到该共享内存块的进程数量。<code class="docutils literal notranslate"><span class="pre">nattch</span></code>不为0表示仍有进程使用该共享内存块。在删除共享内存前，需要停止使用该内存块的所有进程。</p>
</li>
<li><p>删除IPC共享内存。</p>
<p>找到对应的共享内存id，并通过以下命令删除。</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ipcrm -m {shmid}
</pre></div>
</div>
</li>
</ol>
</li>
<li><p>删除socket文件。</p>
<p>一般情况下，socket文件位于<code class="docutils literal notranslate"><span class="pre">/tmp/mindspore/cache</span></code>。进入文件夹，执行以下命令删除socket文件。</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>rm cache_server_p{port_number}
</pre></div>
</div>
<p>其中<code class="docutils literal notranslate"><span class="pre">port_number</span></code>为用户创建缓存服务器时指定的端口号，默认为50052。</p>
</li>
<li><p>删除溢出到磁盘空间的数据文件。</p>
<p>进入启用缓存服务器时指定的溢出数据路径。通常，默认溢出路径为<code class="docutils literal notranslate"><span class="pre">/tmp/mindspore/cache</span></code>。找到路径下对应的数据文件夹并逐一删除。</p>
</li>
</ul>
<br/>
<p><font size=3><strong>Q: 通过Hub可以使用GPU加载<code class="docutils literal notranslate"><span class="pre">vgg16</span></code>模型以及是否可以做迁移模型吗？</strong></font></p>
<p>A: 请手动修改如下两处参数即可:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 增加**kwargs参数: 如下</span>
<span class="k">def</span> <span class="nf">vgg16</span><span class="p">(</span><span class="n">num_classes</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 增加**kwargs参数: 如下</span>
<span class="n">net</span> <span class="o">=</span> <span class="n">Vgg</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;16&#39;</span><span class="p">],</span> <span class="n">num_classes</span><span class="o">=</span><span class="n">num_classes</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">batch_norm</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">batch_norm</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="n">phase</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<br/>
<p><font size=3><strong>Q: 如何得到VGG模型中间层特征？</strong></font></p>
<p>A: 你好，获取网络中间层的特征，其实跟具体框架没有太大关系了。<code class="docutils literal notranslate"><span class="pre">torchvison</span></code>里定义的<code class="docutils literal notranslate"><span class="pre">vgg</span></code>模型，可以通过<code class="docutils literal notranslate"><span class="pre">features</span></code>字段获取”中间层特征”，<code class="docutils literal notranslate"><span class="pre">torchvison</span></code>的<code class="docutils literal notranslate"><span class="pre">vgg</span></code>源码如下:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">VGG</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">num_classes</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">init_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">VGG</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="n">features</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">avgpool</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">AdaptiveAvgPool2d</span><span class="p">((</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
</pre></div>
</div>
<p>在MindSpore的ModelZoo里定义的<code class="docutils literal notranslate"><span class="pre">vgg16</span></code>，可以通过<code class="docutils literal notranslate"><span class="pre">layers</span></code>字段获取，如下:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">network</span> <span class="o">=</span> <span class="n">vgg16</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">layers</span><span class="p">)</span>
</pre></div>
</div>
<br/>
<p><font size=3><strong>Q: 使用MindSpore进行模型训练时，<code class="docutils literal notranslate"><span class="pre">CTCLoss</span></code>的输入参数有四个: <code class="docutils literal notranslate"><span class="pre">inputs</span></code>, <code class="docutils literal notranslate"><span class="pre">labels_indices</span></code>, <code class="docutils literal notranslate"><span class="pre">labels_values</span></code>, <code class="docutils literal notranslate"><span class="pre">sequence_length</span></code>，如何使用<code class="docutils literal notranslate"><span class="pre">CTCLoss</span></code>进行训练？</strong></font></p>
<p>A: 定义的<code class="docutils literal notranslate"><span class="pre">model.train</span></code>接口里接收的<code class="docutils literal notranslate"><span class="pre">dataset</span></code>可以是多个数据组成，形如(<code class="docutils literal notranslate"><span class="pre">data1</span></code>, <code class="docutils literal notranslate"><span class="pre">data2</span></code>, <code class="docutils literal notranslate"><span class="pre">data3</span></code>, …)，所以<code class="docutils literal notranslate"><span class="pre">dataset</span></code>是可以包含<code class="docutils literal notranslate"><span class="pre">inputs</span></code>,<code class="docutils literal notranslate"><span class="pre">labels_indices</span></code>,<code class="docutils literal notranslate"><span class="pre">labels_values</span></code>,<code class="docutils literal notranslate"><span class="pre">sequence_length</span></code>的信息的。只需要定义好相应形式的<code class="docutils literal notranslate"><span class="pre">dataset</span></code>，传入<code class="docutils literal notranslate"><span class="pre">model.train</span></code>里就可以。具体的可以了解下相应的<a class="reference external" href="https://www.mindspore.cn/docs/programming_guide/zh-CN/r1.3/dataset_loading.html">数据处理接口</a></p>
<br/>
<p><font size=3><strong>Q: 模型转移时如何把PyTorch的权重加载到MindSpore中？</strong></font></p>
<p>A: 首先输入PyTorch的<code class="docutils literal notranslate"><span class="pre">pth</span></code>文件，以<code class="docutils literal notranslate"><span class="pre">ResNet-18</span></code>为例，MindSpore的网络结构和PyTorch保持一致，转完之后可直接加载进网络，这边参数只用到<code class="docutils literal notranslate"><span class="pre">BN</span></code>和<code class="docutils literal notranslate"><span class="pre">Conv2D</span></code>，若有其他层<code class="docutils literal notranslate"><span class="pre">ms</span></code>和PyTorch名称不一致，需要同样的修改名称。</p>
<br/>
<p><font size=3><strong>Q: MindSpore有哪些现成的推荐类或生成类网络或模型可用？</strong></font></p>
<p>A: 目前正在开发Wide &amp; Deep、DeepFM、NCF等推荐类模型，NLP领域已经支持Bert_NEZHA，正在开发MASS等模型，用户可根据场景需要改造为生成类网络，可以关注<a class="reference external" href="https://gitee.com/mindspore/mindspore/tree/r1.3/model_zoo">MindSpore Model Zoo</a>。</p>
<br/>
<p><font size=3><strong>Q: 如何使用MindSpore拟合<span class="math notranslate nohighlight">\(f(x)=a \times sin(x)+b\)</span>这类函数？</strong></font></p>
<p>A: 以下拟合案例是基于MindSpore线性拟合官方案例改编而成。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># The fitting function is: f(x)=2*sin(x)+3.</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">dataset</span> <span class="k">as</span> <span class="n">ds</span>
<span class="kn">from</span> <span class="nn">mindspore.common.initializer</span> <span class="kn">import</span> <span class="n">Normal</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">nn</span><span class="p">,</span> <span class="n">Model</span><span class="p">,</span> <span class="n">context</span>
<span class="kn">from</span> <span class="nn">mindspore.train.callback</span> <span class="kn">import</span> <span class="n">LossMonitor</span>

<span class="n">context</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">GRAPH_MODE</span><span class="p">,</span> <span class="n">device_target</span><span class="o">=</span><span class="s2">&quot;CPU&quot;</span><span class="p">)</span>

 <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">3.0</span><span class="p">):</span>
    <span class="c1"># f(x)=w * sin(x) + b</span>
    <span class="c1"># f(x)=2 * sin(x) +3</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="n">noise</span>
        <span class="k">yield</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">y</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">create_dataset</span><span class="p">(</span><span class="n">num_data</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">repeat_size</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">input_data</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">GeneratorDataset</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">get_data</span><span class="p">(</span><span class="n">num_data</span><span class="p">)),</span> <span class="n">column_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">,</span><span class="s1">&#39;label&#39;</span><span class="p">])</span>
    <span class="n">input_data</span> <span class="o">=</span> <span class="n">input_data</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">batch_size</span><span class="p">)</span>
    <span class="n">input_data</span> <span class="o">=</span> <span class="n">input_data</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">repeat_size</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">input_data</span>

<span class="k">class</span> <span class="nc">LinearNet</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LinearNet</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Normal</span><span class="p">(</span><span class="mf">0.02</span><span class="p">),</span> <span class="n">Normal</span><span class="p">(</span><span class="mf">0.02</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">num_data</span> <span class="o">=</span> <span class="mi">1600</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">16</span>
    <span class="n">repeat_size</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">lr</span> <span class="o">=</span> <span class="mf">0.005</span>
    <span class="n">momentum</span> <span class="o">=</span> <span class="mf">0.9</span>

    <span class="n">net</span> <span class="o">=</span> <span class="n">LinearNet</span><span class="p">()</span>
    <span class="n">net_loss</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">loss</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()</span>
    <span class="n">opt</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Momentum</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">trainable_params</span><span class="p">(),</span> <span class="n">lr</span><span class="p">,</span> <span class="n">momentum</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">net_loss</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>

    <span class="n">ds_train</span> <span class="o">=</span> <span class="n">create_dataset</span><span class="p">(</span><span class="n">num_data</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">repeat_size</span><span class="o">=</span><span class="n">repeat_size</span><span class="p">)</span>

    <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ds_train</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="n">LossMonitor</span><span class="p">(),</span> <span class="n">dataset_sink_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">trainable_params</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">net</span><span class="o">.</span><span class="n">trainable_params</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<br/>
<p><font size=3><strong>Q: 如何使用MindSpore拟合<span class="math notranslate nohighlight">\(f(x)=ax^2+bx+c\)</span>这类的二次函数？</strong></font></p>
<p>A: 以下代码引用自MindSpore的官方教程的<a class="reference external" href="https://gitee.com/mindspore/docs/blob/r1.3/docs/sample_code/linear_regression.py">代码仓</a></p>
<p>在以下几处修改即可很好的拟合<span class="math notranslate nohighlight">\(f(x)=ax^2+bx+c\)</span>:</p>
<ol class="arabic simple">
<li><p>数据集生成。</p></li>
<li><p>拟合网络。</p></li>
<li><p>优化器。</p></li>
</ol>
<p>修改的详细信息如下，附带解释。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Since the selected optimizer does not support CPU, so the training computing platform is changed to GPU, which requires readers to install the corresponding GPU version of MindSpore.</span>
<span class="n">context</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">GRAPH_MODE</span><span class="p">,</span> <span class="n">device_target</span><span class="o">=</span><span class="s2">&quot;GPU&quot;</span><span class="p">)</span>

<span class="c1"># Assuming that the function to be fitted this time is f(x)=2x^2+3x+4, the data generation function is modified as follows:</span>
<span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">3.0</span> <span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="mi">4</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">)</span>
        <span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># The y value is generated by the fitting target function ax^2+bx+c.</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">a</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">b</span> <span class="o">+</span> <span class="n">c</span> <span class="o">+</span> <span class="n">noise</span>
        <span class="c1"># When a*x^2+b*x+c is fitted, a and b are weight parameters and c is offset parameter bias. The training data corresponding to the two weights are x^2 and x respectively, so the data set generation mode  is changed as follows:</span>
        <span class="k">yield</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">y</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">create_dataset</span><span class="p">(</span><span class="n">num_data</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">repeat_size</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">input_data</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">GeneratorDataset</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">get_data</span><span class="p">(</span><span class="n">num_data</span><span class="p">)),</span> <span class="n">column_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">,</span><span class="s1">&#39;label&#39;</span><span class="p">])</span>
    <span class="n">input_data</span> <span class="o">=</span> <span class="n">input_data</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">batch_size</span><span class="p">)</span>
    <span class="n">input_data</span> <span class="o">=</span> <span class="n">input_data</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">repeat_size</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">input_data</span>

<span class="k">class</span> <span class="nc">LinearNet</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LinearNet</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># Because the full join function inputs two training parameters, the input value is changed to 2, the first Nomral(0.02) will automatically assign random weights to the input two parameters, and the second Normal is the random bias.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Normal</span><span class="p">(</span><span class="mf">0.02</span><span class="p">),</span> <span class="n">Normal</span><span class="p">(</span><span class="mf">0.02</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">num_data</span> <span class="o">=</span> <span class="mi">1600</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">16</span>
    <span class="n">repeat_size</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">lr</span> <span class="o">=</span> <span class="mf">0.005</span>
    <span class="n">momentum</span> <span class="o">=</span> <span class="mf">0.9</span>

    <span class="n">net</span> <span class="o">=</span> <span class="n">LinearNet</span><span class="p">()</span>
    <span class="n">net_loss</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">loss</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()</span>
    <span class="c1"># RMSProp optimalizer with better effect is selected for quadratic function fitting, Currently, Ascend and GPU computing platforms are supported.</span>
    <span class="n">opt</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">RMSProp</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">trainable_params</span><span class="p">(),</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">net_loss</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>

    <span class="n">ds_train</span> <span class="o">=</span> <span class="n">create_dataset</span><span class="p">(</span><span class="n">num_data</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">repeat_size</span><span class="o">=</span><span class="n">repeat_size</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ds_train</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="n">LossMonitor</span><span class="p">(),</span> <span class="n">dataset_sink_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">trainable_params</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">net</span><span class="o">.</span><span class="n">trainable_params</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<br/>
<p><font size=3><strong>Q: <code class="docutils literal notranslate"><span class="pre">mindspore/tests</span></code>下怎样执行单个<code class="docutils literal notranslate"><span class="pre">ut</span></code>用例？</strong></font></p>
<p>A: <code class="docutils literal notranslate"><span class="pre">ut</span></code>用例通常需要基于debug版本的MindSpore包，官网并没有提供。可以基于源码使用<code class="docutils literal notranslate"><span class="pre">sh</span> <span class="pre">build.sh</span></code>编译，然后通过<code class="docutils literal notranslate"><span class="pre">pytest</span></code>指令执行，debug模式编包不依赖后端。编译选项<code class="docutils literal notranslate"><span class="pre">sh</span> <span class="pre">build.sh</span> <span class="pre">-t</span> <span class="pre">on</span></code>，用例执行可以参考<code class="docutils literal notranslate"><span class="pre">tests/runtest.sh</span></code>脚本。</p>
<br/>
<p><font size=3><strong>Q: 在Ascend平台上，执行用例有时候会报错<code class="docutils literal notranslate"><span class="pre">run</span> <span class="pre">task</span> <span class="pre">error</span></code>，如何获取更详细的日志帮助问题定位？</strong></font></p>
<p>A: 使用msnpureport工具设置device侧日志级别，工具位置在: <code class="docutils literal notranslate"><span class="pre">/usr/local/Ascend/driver/tools/msnpureport</span></code>。</p>
<ul class="simple">
<li><p>全局级别:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/usr/local/Ascend/driver/tools/msnpureport<span class="w"> </span>-g<span class="w"> </span>info
</pre></div>
</div>
<ul class="simple">
<li><p>模块级别:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/usr/local/Ascend/driver/tools/msnpureport<span class="w"> </span>-m<span class="w"> </span>SLOG:error
</pre></div>
</div>
<ul class="simple">
<li><p>Event级别:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/usr/local/Ascend/driver/tools/msnpureport<span class="w"> </span>-e<span class="w"> </span>disable/enable
</pre></div>
</div>
<ul class="simple">
<li><p>多device id级别:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/usr/local/Ascend/driver/tools/msnpureport<span class="w"> </span>-d<span class="w"> </span><span class="m">1</span><span class="w"> </span>-g<span class="w"> </span>warning
</pre></div>
</div>
<p>假设deviceID的取值范围是[0-7]，<code class="docutils literal notranslate"><span class="pre">device0</span></code>-<code class="docutils literal notranslate"><span class="pre">device3</span></code>和<code class="docutils literal notranslate"><span class="pre">device4</span></code>-<code class="docutils literal notranslate"><span class="pre">device7</span></code>分别在一个os上。其中<code class="docutils literal notranslate"><span class="pre">device0</span></code>-<code class="docutils literal notranslate"><span class="pre">device3</span></code>共用一个日志配置文件；<code class="docutils literal notranslate"><span class="pre">device4</span></code>-<code class="docutils literal notranslate"><span class="pre">device7</span></code>共用一个配置文件。如果修改了<code class="docutils literal notranslate"><span class="pre">device0</span></code>-<code class="docutils literal notranslate"><span class="pre">device3</span></code>中的任意一个日志级别，其他<code class="docutils literal notranslate"><span class="pre">device</span></code>的日志级别也会被修改。如果修改了<code class="docutils literal notranslate"><span class="pre">device4</span></code>-<code class="docutils literal notranslate"><span class="pre">device7</span></code>中的任意一个日志级别，其他device的日志级别也会被修改。</p>
<p><code class="docutils literal notranslate"><span class="pre">Driver</span></code>包安装以后（假设安装路径为/usr/local/HiAI，在Windows环境下，<code class="docutils literal notranslate"><span class="pre">msnpureport.exe</span></code>执行文件在C:\ProgramFiles\Huawei\Ascend\Driver\tools\目录下），假设用户在/home/shihangbo/目录下直接执行命令行，则Device侧日志被导出到当前目录下，并以时间戳命名文件夹进行存放。</p>
<br/>
<p><font size=3><strong>Q: 使用Ascend平台执行训练过程，出现报错: <code class="docutils literal notranslate"><span class="pre">Out</span> <span class="pre">of</span> <span class="pre">Memory!!!</span> <span class="pre">total[3212254720]</span> <span class="pre">(dynamic[0]</span> <span class="pre">memory</span> <span class="pre">poll[524288000])</span> <span class="pre">malloc[32611480064]</span> <span class="pre">failed!</span></code> 如何解决？</strong></font></p>
<p>A: 此问题属于内存占用过多导致的内存不够问题，可能原因有两种:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">batch_size</span></code>的值设置过大。解决办法: 将<code class="docutils literal notranslate"><span class="pre">batch_size</span></code>的值设置减小。</p></li>
<li><p>引入了异常大的<code class="docutils literal notranslate"><span class="pre">Parameter</span></code>，例如单个数据shape为[640,1024,80,81]，数据类型为float32，单个数据大小超过15G，这样差不多大小的两个数据相加时，占用内存超过3*15G，容易造成<code class="docutils literal notranslate"><span class="pre">Out</span> <span class="pre">of</span> <span class="pre">Memory</span></code>。解决办法: 检查参数的<code class="docutils literal notranslate"><span class="pre">shape</span></code>，如果异常过大，减少shape。</p></li>
<li><p>如果以上操作还是未能解决，可以上<a class="reference external" href="https://bbs.huaweicloud.com/forum/forum-1076-1.html">官方论坛</a>发帖提出问题，将会有专门的技术人员帮助解决。</p></li>
</ul>
<br/>
<p><font size=3><strong>Q: 如何在训练神经网络过程中对计算损失的超参数进行改变？</strong></font></p>
<p>A: 您好，很抱歉暂时还未有这样的功能。目前只能通过训练–&gt;重新定义优化器–&gt;训练，这样的过程寻找较优的超参数。</p>
<br/>
<p><font size=3><strong>Q: 运行应用时报错<code class="docutils literal notranslate"><span class="pre">error</span> <span class="pre">while</span> <span class="pre">loading</span> <span class="pre">shared</span> <span class="pre">libraries:</span> <span class="pre">libge_compiler.so:</span> <span class="pre">cannot</span> <span class="pre">open</span> <span class="pre">shared</span> <span class="pre">object</span> <span class="pre">file:</span> <span class="pre">No</span> <span class="pre">such</span> <span class="pre">file</span> <span class="pre">or</span> <span class="pre">directory</span></code>怎么办？</strong></font></p>
<p>A: 安装MindSpore所依赖的Ascend 310 AI处理器配套软件包时，<code class="docutils literal notranslate"><span class="pre">CANN</span></code>包不能安装<code class="docutils literal notranslate"><span class="pre">nnrt</span></code>版本，而是需要安装功能完整的<code class="docutils literal notranslate"><span class="pre">toolkit</span></code>版本。</p>
<br/>
<p><font size=3><strong>Q: MindSpore代码里面的model_zoo/official/cv/resnet/train.py中context.set_ps_context(enable_ps=True)为什么一定要在init之前设置</strong></font></p>
<p>A: MindSpore Ascend模式下，如果先调用init，那么会为所有的进程都分配卡，但是parameter server训练模式下server是不需要分配卡的，那么worker和server就会去使用同一块卡，导致会报错: Hccl dependent tsd is not open。</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="data_processing.html" class="btn btn-neutral float-left" title="数据处理" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="operators_compile.html" class="btn btn-neutral float-right" title="算子编译" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, MindSpore.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>