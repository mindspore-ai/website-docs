

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>静态图语法支持 &mdash; MindSpore master documentation</title>
  

  
   
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  
  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tensor索引支持" href="index_support.html" />
    <link rel="prev" title="语法支持" href="syntax_list.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> MindSpore
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">规格说明</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="benchmark.html">基准性能</a></li>
<li class="toctree-l1"><a class="reference internal" href="network_list.html">网络支持</a></li>
<li class="toctree-l1"><a class="reference internal" href="operator_list.html">算子支持</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="syntax_list.html">语法支持</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">静态图语法支持</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">概述</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">数据类型</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#python">Python内置数据类型</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mindspore">MindSpore自定义数据类型</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id4">原型</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#a-id-attr-ref-a"><a id="attr_ref">属性引用</a></a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">索引取值</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id6">调用</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id7">运算符</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id8">单目算术运算符</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id9">二元算术运算符</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id10">赋值运算符</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id11">逻辑运算符</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id12">比较运算符</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id13">复合语句</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id14">条件控制语句</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id15">循环语句</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id16">函数定义语句</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id17">列表生成式和生成器表达式</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id20">函数</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id21">Python内置函数</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id22">函数参数</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id23">网络定义</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id24">网络入参</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id25">网络实例类型</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id26">网络构造组件</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id27">网络使用约束</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index_support.html">Tensor索引支持</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="env_var_list.html">环境变量</a></li>
</ul>
<p class="caption"><span class="caption-text">其他说明</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="roadmap.html">路标</a></li>
<li class="toctree-l1"><a class="reference internal" href="help_seeking_path.html">如何求助（求助路径）</a></li>
<li class="toctree-l1"><a class="reference internal" href="community.html">如何参与社区</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MindSpore</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="syntax_list.html">语法支持</a> &raquo;</li>
        
      <li>静态图语法支持</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/static_graph_syntax_support.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="id1">
<h1>静态图语法支持<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<!-- TOC -->
<ul class="simple">
<li><p><a class="reference external" href="#%E9%9D%99%E6%80%81%E5%9B%BE%E8%AF%AD%E6%B3%95%E6%94%AF%E6%8C%81">静态图语法支持</a></p>
<ul>
<li><p><a class="reference external" href="#%E6%A6%82%E8%BF%B0">概述</a></p></li>
<li><p><a class="reference external" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B">数据类型</a></p>
<ul>
<li><p><a class="reference external" href="#python%E5%86%85%E7%BD%AE%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B">Python内置数据类型</a></p>
<ul>
<li><p><a class="reference external" href="#number">Number</a></p></li>
<li><p><a class="reference external" href="#string">String</a></p></li>
<li><p><a class="reference external" href="#list">List</a></p></li>
<li><p><a class="reference external" href="#tuple">Tuple</a></p></li>
<li><p><a class="reference external" href="#dictionary">Dictionary</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#mindspore%E8%87%AA%E5%AE%9A%E4%B9%89%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B">MindSpore自定义数据类型</a></p>
<ul>
<li><p><a class="reference external" href="#tensor">Tensor</a></p></li>
<li><p><a class="reference external" href="#primitive">Primitive</a></p></li>
<li><p><a class="reference external" href="#cell">Cell</a></p></li>
<li><p><a class="reference external" href="#parameter">Parameter</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference external" href="#%E5%8E%9F%E5%9E%8B">原型</a></p>
<ul>
<li><p><a class="reference external" href="#a-idattr_ref%E5%B1%9E%E6%80%A7%E5%BC%95%E7%94%A8a"><a id="attr_ref">属性引用</a></a></p></li>
<li><p><a class="reference external" href="#%E7%B4%A2%E5%BC%95%E5%8F%96%E5%80%BC">索引取值</a></p></li>
<li><p><a class="reference external" href="#%E8%B0%83%E7%94%A8">调用</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#%E8%BF%90%E7%AE%97%E7%AC%A6">运算符</a></p>
<ul>
<li><p><a class="reference external" href="#%E5%8D%95%E7%9B%AE%E7%AE%97%E6%9C%AF%E8%BF%90%E7%AE%97%E7%AC%A6">单目算术运算符</a></p></li>
<li><p><a class="reference external" href="#%E4%BA%8C%E5%85%83%E7%AE%97%E6%9C%AF%E8%BF%90%E7%AE%97%E7%AC%A6">二元算术运算符</a></p></li>
<li><p><a class="reference external" href="#%E8%B5%8B%E5%80%BC%E8%BF%90%E7%AE%97%E7%AC%A6">赋值运算符</a></p></li>
<li><p><a class="reference external" href="#%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6">逻辑运算符</a></p></li>
<li><p><a class="reference external" href="#%E6%AF%94%E8%BE%83%E8%BF%90%E7%AE%97%E7%AC%A6">比较运算符</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#%E5%A4%8D%E5%90%88%E8%AF%AD%E5%8F%A5">复合语句</a></p>
<ul>
<li><p><a class="reference external" href="#%E6%9D%A1%E4%BB%B6%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5">条件控制语句</a></p>
<ul>
<li><p><a class="reference external" href="#if%E8%AF%AD%E5%8F%A5">if语句</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5">循环语句</a></p>
<ul>
<li><p><a class="reference external" href="#for%E8%AF%AD%E5%8F%A5">for语句</a></p></li>
<li><p><a class="reference external" href="#while%E8%AF%AD%E5%8F%A5">while语句</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#%E5%87%BD%E6%95%B0%E5%AE%9A%E4%B9%89%E8%AF%AD%E5%8F%A5">函数定义语句</a></p>
<ul>
<li><p><a class="reference external" href="#def%E5%85%B3%E9%94%AE%E5%AD%97">def关键字</a></p></li>
<li><p><a class="reference external" href="#lambda%E8%A1%A8%E8%BE%BE%E5%BC%8F">lambda表达式</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#%E5%88%97%E8%A1%A8%E7%94%9F%E6%88%90%E5%BC%8F%E5%92%8C%E7%94%9F%E6%88%90%E5%99%A8%E8%A1%A8%E8%BE%BE%E5%BC%8F">列表生成式和生成器表达式</a></p>
<ul>
<li><p><a class="reference external" href="#%E5%88%97%E8%A1%A8%E7%94%9F%E6%88%90%E5%BC%8F">列表生成式</a></p></li>
<li><p><a class="reference external" href="#%E7%94%9F%E6%88%90%E5%99%A8%E8%A1%A8%E8%BE%BE%E5%BC%8F">生成器表达式</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference external" href="#%E5%87%BD%E6%95%B0">函数</a></p>
<ul>
<li><p><a class="reference external" href="#python%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0">Python内置函数</a></p>
<ul>
<li><p><a class="reference external" href="#len">len</a></p></li>
<li><p><a class="reference external" href="#isinstance">isinstance</a></p></li>
<li><p><a class="reference external" href="#partial">partial</a></p></li>
<li><p><a class="reference external" href="#map">map</a></p></li>
<li><p><a class="reference external" href="#zip">zip</a></p></li>
<li><p><a class="reference external" href="#range">range</a></p></li>
<li><p><a class="reference external" href="#enumerate">enumerate</a></p></li>
<li><p><a class="reference external" href="#super">super</a></p></li>
<li><p><a class="reference external" href="#pow">pow</a></p></li>
<li><p><a class="reference external" href="#print">print</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0">函数参数</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#%E7%BD%91%E7%BB%9C%E5%AE%9A%E4%B9%89">网络定义</a></p>
<ul>
<li><p><a class="reference external" href="#%E7%BD%91%E7%BB%9C%E5%85%A5%E5%8F%82">网络入参</a></p></li>
<li><p><a class="reference external" href="#%E7%BD%91%E7%BB%9C%E5%AE%9E%E4%BE%8B%E7%B1%BB%E5%9E%8B">网络实例类型</a></p></li>
<li><p><a class="reference external" href="#%E7%BD%91%E7%BB%9C%E6%9E%84%E9%80%A0%E7%BB%84%E4%BB%B6">网络构造组件</a></p></li>
<li><p><a class="reference external" href="#%E7%BD%91%E7%BB%9C%E4%BD%BF%E7%94%A8%E7%BA%A6%E6%9D%9F">网络使用约束</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- /TOC -->
<p><a href="https://gitee.com/mindspore/docs/blob/r1.5/docs/mindspore/note/source_zh_cn/static_graph_syntax_support.md" target="_blank"><img src="https://gitee.com/mindspore/docs/raw/r1.5/resource/_static/logo_source.png"></a></p>
<div class="section" id="id2">
<h2>概述<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>在Graph模式下，Python代码并不是由Python解释器去执行，而是将代码编译成静态计算图，然后执行静态计算图。</p>
<p>当前仅支持编译<code class="docutils literal notranslate"><span class="pre">&#64;ms_function</span></code>装饰器修饰的函数、Cell及其子类的实例。
对于函数，则编译函数定义；对于网络，则编译<code class="docutils literal notranslate"><span class="pre">construct</span></code>方法及其调用的其他方法或者函数。</p>
<p><code class="docutils literal notranslate"><span class="pre">ms_function</span></code>使用规则可参考文档：<a class="reference external" href="https://www.mindspore.cn/docs/api/zh-CN/r1.5/api_python/mindspore/mindspore.ms_function.html#mindspore.ms_function">https://www.mindspore.cn/docs/api/zh-CN/r1.5/api_python/mindspore/mindspore.ms_function.html#mindspore.ms_function</a></p>
<p><code class="docutils literal notranslate"><span class="pre">Cell</span></code>定义可参考文档：<a class="reference external" href="https://www.mindspore.cn/docs/programming_guide/zh-CN/r1.5/cell.html">https://www.mindspore.cn/docs/programming_guide/zh-CN/r1.5/cell.html</a></p>
<p>由于语法解析的限制，当前在编译构图时，支持的数据类型、语法以及相关操作并没有完全与Python语法保持一致，部分使用受限。</p>
<p>本文主要介绍，在编译静态图时，支持的数据类型、语法以及相关操作，这些规则仅适用于Graph模式。</p>
<blockquote>
<div><p>以下所有示例都运行在Graph模式下的网络中，为了简洁，并未将网络的定义都写出来。</p>
</div></blockquote>
</div>
<div class="section" id="id3">
<h2>数据类型<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<div class="section" id="python">
<h3>Python内置数据类型<a class="headerlink" href="#python" title="Permalink to this headline">¶</a></h3>
<p>当前支持的<code class="docutils literal notranslate"><span class="pre">Python</span></code>内置数据类型包括：<code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">String</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>和<code class="docutils literal notranslate"><span class="pre">Dictionary</span></code>。</p>
<div class="section" id="number">
<h4>Number<a class="headerlink" href="#number" title="Permalink to this headline">¶</a></h4>
<p>支持<code class="docutils literal notranslate"><span class="pre">int</span></code>、<code class="docutils literal notranslate"><span class="pre">float</span></code>、<code class="docutils literal notranslate"><span class="pre">bool</span></code>，不支持complex（复数）。</p>
<p>支持在网络里定义<code class="docutils literal notranslate"><span class="pre">Number</span></code>，即支持语法：<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">1</span></code>、<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">1.2</span></code>、 <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">True</span></code>。</p>
<p>不支持在网络里强转<code class="docutils literal notranslate"><span class="pre">Number</span></code>，即不支持语法：<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">int(x)</span></code>、<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">float(x)</span></code>、<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">bool(x)</span></code>。</p>
</div>
<div class="section" id="string">
<h4>String<a class="headerlink" href="#string" title="Permalink to this headline">¶</a></h4>
<p>支持在网络里构造<code class="docutils literal notranslate"><span class="pre">String</span></code>，即支持语法<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">&quot;abcd&quot;</span></code>。</p>
<p>不支持在网络里强转<code class="docutils literal notranslate"><span class="pre">String</span></code>，即不支持语法 <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">str(x)</span></code>。</p>
</div>
<div class="section" id="list">
<h4>List<a class="headerlink" href="#list" title="Permalink to this headline">¶</a></h4>
<p>支持在网络里构造<code class="docutils literal notranslate"><span class="pre">List</span></code>，即支持语法<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">[1,</span> <span class="pre">2,</span> <span class="pre">3]</span></code>。</p>
<p>不支持在网络里强转<code class="docutils literal notranslate"><span class="pre">List</span></code>，即不支持语法<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">list(x)</span></code>。</p>
<p>计算图中最终需要输出的<code class="docutils literal notranslate"><span class="pre">List</span></code>会转换为<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>输出。</p>
<ul>
<li><p>支持接口</p>
<p><code class="docutils literal notranslate"><span class="pre">append</span></code>: 向<code class="docutils literal notranslate"><span class="pre">list</span></code>里追加元素。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>x: (1, 2, 3, 4)
</pre></div>
</div>
</li>
<li><p>支持索引取值和赋值</p>
<p>支持单层和多层索引取值以及赋值。</p>
<p>取值和赋值的索引值仅支持<code class="docutils literal notranslate"><span class="pre">int</span></code>。</p>
<p>赋值时，所赋的值支持<code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">String</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>
<span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ok&quot;</span>
<span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">88</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>m: 2
x: ([1, 88], Tensor(shape=[3], dtype=Int64, value=[1, 2, 3]), &#39;ok&#39;, (1, 2, 3))
n: Tensor(shape=[3], dtype=Int64, value=[1, 2, 3])
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="tuple">
<h4>Tuple<a class="headerlink" href="#tuple" title="Permalink to this headline">¶</a></h4>
<p>支持在网络里构造<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>，即支持语法<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">(1,</span> <span class="pre">2,</span> <span class="pre">3)</span></code>。</p>
<p>不支持在网络里强转<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>，即不支持语法<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">tuple(x)</span></code>。</p>
<ul>
<li><p>支持索引取值</p>
<p>索引值支持<code class="docutils literal notranslate"><span class="pre">int</span></code>、<code class="docutils literal notranslate"><span class="pre">slice</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，也支持多层索引取值，即支持语法<code class="docutils literal notranslate"><span class="pre">data</span> <span class="pre">=</span> <span class="pre">tuple_x[index0][index1]...</span></code>。</p>
<p>索引值为<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>有如下限制：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">tuple</span></code>里存放的都是<code class="docutils literal notranslate"><span class="pre">Cell</span></code>，每个<code class="docutils literal notranslate"><span class="pre">Cell</span></code>要在tuple定义之前完成定义，每个<code class="docutils literal notranslate"><span class="pre">Cell</span></code>的入参个数、入参类型和入参<code class="docutils literal notranslate"><span class="pre">shape</span></code>要求一致，每个<code class="docutils literal notranslate"><span class="pre">Cell</span></code>的输出个数、输出类型和输出<code class="docutils literal notranslate"><span class="pre">shape</span></code>也要求一致。</p></li>
<li><p>索引<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>是一个<code class="docutils literal notranslate"><span class="pre">dtype</span></code>为<code class="docutils literal notranslate"><span class="pre">int32</span></code>的标量<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，取值范围在<code class="docutils literal notranslate"><span class="pre">[-tuple_len,</span> <span class="pre">tuple_len)</span></code>，<code class="docutils literal notranslate"><span class="pre">Ascend</span></code>后端不支持负数索引。</p></li>
<li><p>该语法不支持<code class="docutils literal notranslate"><span class="pre">if</span></code>、<code class="docutils literal notranslate"><span class="pre">while</span></code>、<code class="docutils literal notranslate"><span class="pre">for</span></code>控制流条件为变量的运行分支，仅支持控制流条件为常量。</p></li>
<li><p>支持<code class="docutils literal notranslate"><span class="pre">GPU</span></code>和<code class="docutils literal notranslate"><span class="pre">Ascend</span></code>后端。</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">int</span></code>、<code class="docutils literal notranslate"><span class="pre">slice</span></code>索引示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])))</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>y: 3
z: Tensor(shape=[3], dtype=Int64, value=[1, 2, 3])
m: ((2, 3, 4), 3, 4)
n: (2, 3, 4)
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Tensor</span></code>索引示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Net</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relu</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">softmax</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Softmax</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">softmax</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="n">index</span><span class="p">](</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="dictionary">
<h4>Dictionary<a class="headerlink" href="#dictionary" title="Permalink to this headline">¶</a></h4>
<p>支持在网络里构造<code class="docutils literal notranslate"><span class="pre">Dictionary</span></code>，即支持语法<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">{&quot;a&quot;:</span> <span class="pre">1,</span> <span class="pre">&quot;b&quot;:</span> <span class="pre">2}</span></code>，当前仅支持<code class="docutils literal notranslate"><span class="pre">String</span></code>作为<code class="docutils literal notranslate"><span class="pre">key</span></code>值。</p>
<p>计算图中最终需要输出的<code class="docutils literal notranslate"><span class="pre">Dictionary</span></code>，会取出所有的<code class="docutils literal notranslate"><span class="pre">value</span></code>组成<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>输出。</p>
<ul>
<li><p>支持接口</p>
<p><code class="docutils literal notranslate"><span class="pre">keys</span></code>：取出<code class="docutils literal notranslate"><span class="pre">dict</span></code>里所有的<code class="docutils literal notranslate"><span class="pre">key</span></code>值，组成<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>返回。</p>
<p><code class="docutils literal notranslate"><span class="pre">values</span></code>：取出<code class="docutils literal notranslate"><span class="pre">dict</span></code>里所有的<code class="docutils literal notranslate"><span class="pre">value</span></code>值，组成<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>返回。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])),</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])),</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]))}</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>y: (&quot;a&quot;, &quot;b&quot;, &quot;c&quot;)
z: (Tensor(shape=[3], dtype=Int64, value=[1, 2, 3]), Tensor(shape=[3], dtype=Int64, value=[4, 5, 6]), Tensor(shape=[3], dtype=Int64, value=[7, 8, 9]))
</pre></div>
</div>
</li>
<li><p>支持索引取值和赋值</p>
<p>取值和赋值的索引值都仅支持<code class="docutils literal notranslate"><span class="pre">String</span></code>。赋值时，所赋的值支持<code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])),</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])),</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]))}</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">]</span>
<span class="n">x</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>y: Tensor(shape=[3], dtype=Int64, value=[4, 5, 6])
x: {&quot;a&quot;: (2, 3, 4), Tensor(shape=[3], dtype=Int64, value=[4, 5, 6]), Tensor(shape=[3], dtype=Int64, value=[7, 8, 9])}
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="mindspore">
<h3>MindSpore自定义数据类型<a class="headerlink" href="#mindspore" title="Permalink to this headline">¶</a></h3>
<p>当前MindSpore自定义数据类型包括：<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Primitive</span></code>、<code class="docutils literal notranslate"><span class="pre">Cell</span></code>和<code class="docutils literal notranslate"><span class="pre">Parameter</span></code>。</p>
<div class="section" id="tensor">
<h4>Tensor<a class="headerlink" href="#tensor" title="Permalink to this headline">¶</a></h4>
<p>当前不支持在网络里构造Tensor，即不支持语法<code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">Tensor(args...)</span></code>。</p>
<p>可以通过<code class="docutils literal notranslate"><span class="pre">&#64;constexpr</span></code>装饰器修饰函数，在函数里生成<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。</p>
<p>关于<code class="docutils literal notranslate"><span class="pre">&#64;constexpr</span></code>的用法可参考：<a class="reference external" href="https://www.mindspore.cn/docs/api/zh-CN/r1.5/api_python/ops/mindspore.ops.constexpr.html">https://www.mindspore.cn/docs/api/zh-CN/r1.5/api_python/ops/mindspore.ops.constexpr.html</a></p>
<p>对于网络中需要用到的常量<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，可以作为网络的属性，在<code class="docutils literal notranslate"><span class="pre">init</span></code>的时候定义，即<code class="docutils literal notranslate"><span class="pre">self.x</span> <span class="pre">=</span> <span class="pre">Tensor(args...)</span></code>，然后在<code class="docutils literal notranslate"><span class="pre">construct</span></code>里使用。</p>
<p>如下示例，通过<code class="docutils literal notranslate"><span class="pre">&#64;constexpr</span></code>生成一个<code class="docutils literal notranslate"><span class="pre">shape</span> <span class="pre">=</span> <span class="pre">(3,</span> <span class="pre">4),</span> <span class="pre">dtype</span> <span class="pre">=</span> <span class="pre">int64</span></code>的<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@constexpr</span>
<span class="k">def</span> <span class="nf">generate_tensor</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)))</span>
</pre></div>
</div>
<p>下面将介绍下<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>支持的属性和接口。</p>
<ul>
<li><p>支持属性：</p>
<p><code class="docutils literal notranslate"><span class="pre">shape</span></code>：获取<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>的shape，返回一个<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>。</p>
<p><code class="docutils literal notranslate"><span class="pre">dtype</span></code>：获取<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>的数据类型，返回一个<code class="docutils literal notranslate"><span class="pre">MindSpore</span></code>定义的数据类型。</p>
</li>
<li><p>支持接口：</p>
<p><code class="docutils literal notranslate"><span class="pre">all</span></code>：对<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>通过<code class="docutils literal notranslate"><span class="pre">all</span></code>操作进行归约，仅支持<code class="docutils literal notranslate"><span class="pre">Bool</span></code>类型的<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。</p>
<p><code class="docutils literal notranslate"><span class="pre">any</span></code>：对<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>通过<code class="docutils literal notranslate"><span class="pre">any</span></code>操作进行归约，仅支持<code class="docutils literal notranslate"><span class="pre">Bool</span></code>类型的<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。</p>
<p><code class="docutils literal notranslate"><span class="pre">view</span></code>：将<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>reshape成输入的<code class="docutils literal notranslate"><span class="pre">shape</span></code>。</p>
<p><code class="docutils literal notranslate"><span class="pre">expand_as</span></code>：将<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>按照广播规则扩展成与另一个<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>相同的<code class="docutils literal notranslate"><span class="pre">shape</span></code>。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]]))</span>
<span class="n">x_shape</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span>
<span class="n">x_dtype</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">dtype</span>
<span class="n">x_all</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="n">x_any</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
<span class="n">x_view</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="n">y_as_z</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">expand_as</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</pre></div>
</div>
<p>结果如下:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>x_shape: (2, 3)
x_dtype: Bool
x_all: Tensor(shape=[], dtype=Bool, value=False)
x_any: Tensor(shape=[], dtype=Bool, value=True)
x_view: Tensor(shape=[1, 6], dtype=Bool, value=[[True, False, True, False, True, False]])
y_as_z: Tensor(shape=[2, 2, 3], dtype=Float32, value=[[[1.0, 1.0, 1.0], [1.0, 1.0, 1.0]], [[1.0, 1.0, 1.0], [1.0, 1.0, 1.0]]])
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="primitive">
<h4>Primitive<a class="headerlink" href="#primitive" title="Permalink to this headline">¶</a></h4>
<p>当前支持在网络里构造<code class="docutils literal notranslate"><span class="pre">Primitive</span></code>及其子类的实例，即支持语法<code class="docutils literal notranslate"><span class="pre">reduce_sum</span> <span class="pre">=</span> <span class="pre">ReduceSum(True)</span></code>。</p>
<p>但在构造时，参数只能通过位置参数方式传入，不支持通过键值对方式传入，即不支持语法<code class="docutils literal notranslate"><span class="pre">reduce_sum</span> <span class="pre">=</span> <span class="pre">ReduceSum(keep_dims=True)</span></code>。</p>
<p>当前不支持在网络调用<code class="docutils literal notranslate"><span class="pre">Primitive</span></code>及其子类相关属性和接口。</p>
<p><code class="docutils literal notranslate"><span class="pre">Primitive</span></code>定义可参考文档：<a class="reference external" href="https://www.mindspore.cn/docs/programming_guide/zh-CN/r1.5/operators_classification.html">https://www.mindspore.cn/docs/programming_guide/zh-CN/r1.5/operators_classification.html</a></p>
<p>当前已定义的<code class="docutils literal notranslate"><span class="pre">Primitive</span></code>可参考文档：<a class="reference external" href="https://www.mindspore.cn/docs/api/zh-CN/r1.5/api_python/mindspore.ops.html">https://www.mindspore.cn/docs/api/zh-CN/r1.5/api_python/mindspore.ops.html</a></p>
</div>
<div class="section" id="cell">
<h4>Cell<a class="headerlink" href="#cell" title="Permalink to this headline">¶</a></h4>
<p>当前支持在网络里构造<code class="docutils literal notranslate"><span class="pre">Cell</span></code>及其子类的实例，即支持语法<code class="docutils literal notranslate"><span class="pre">cell</span> <span class="pre">=</span> <span class="pre">Cell(args...)</span></code>。</p>
<p>但在构造时，参数只能通过位置参数方式传入，不支持通过键值对方式传入，即不支持在语法<code class="docutils literal notranslate"><span class="pre">cell</span> <span class="pre">=</span> <span class="pre">Cell(arg_name=value)</span></code>。</p>
<p>当前不支持在网络调用<code class="docutils literal notranslate"><span class="pre">Cell</span></code>及其子类相关属性和接口，除非是在<code class="docutils literal notranslate"><span class="pre">Cell</span></code>自己的<code class="docutils literal notranslate"><span class="pre">contrcut</span></code>中通过<code class="docutils literal notranslate"><span class="pre">self</span></code>调用。</p>
<p><code class="docutils literal notranslate"><span class="pre">Cell</span></code>定义可参考文档：<a class="reference external" href="https://www.mindspore.cn/docs/programming_guide/zh-CN/r1.5/cell.html">https://www.mindspore.cn/docs/programming_guide/zh-CN/r1.5/cell.html</a></p>
<p>当前已定义的<code class="docutils literal notranslate"><span class="pre">Cell</span></code>可参考文档：<a class="reference external" href="https://www.mindspore.cn/docs/api/zh-CN/r1.5/api_python/mindspore.nn.html">https://www.mindspore.cn/docs/api/zh-CN/r1.5/api_python/mindspore.nn.html</a></p>
</div>
<div class="section" id="parameter">
<h4>Parameter<a class="headerlink" href="#parameter" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">Parameter</span></code>是变量张量，代表在训练网络时，需要被更新的参数。</p>
<p><code class="docutils literal notranslate"><span class="pre">Parameter</span></code>的定义和使用参考：<a class="reference external" href="https://www.mindspore.cn/docs/programming_guide/zh-CN/r1.5/parameter.html">https://www.mindspore.cn/docs/programming_guide/zh-CN/r1.5/parameter.html</a></p>
</div>
</div>
</div>
<div class="section" id="id4">
<h2>原型<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>原型代表编程语言中最紧密绑定的操作。</p>
<div class="section" id="a-id-attr-ref-a">
<h3><a id="attr_ref">属性引用</a><a class="headerlink" href="#a-id-attr-ref-a" title="Permalink to this headline">¶</a></h3>
<p>属性引用是后面带有一个句点加一个名称的原型。</p>
<p>在MindSpore的Cell 实例中使用属性引用作为左值需满足如下要求：</p>
<ul class="simple">
<li><p>被修改的属性属于本<code class="docutils literal notranslate"><span class="pre">cell</span></code>对象，即必须为<code class="docutils literal notranslate"><span class="pre">self.xxx</span></code>。</p></li>
<li><p>该属性在Cell的<code class="docutils literal notranslate"><span class="pre">__init__</span></code>函数中完成初始化且其为Parameter类型。</p></li>
</ul>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">Tensor</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">mindspore</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">x</span>     <span class="c1"># 满足条件可以修改</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="mi">3</span>               <span class="c1"># self.m 非Parameter类型禁止修改</span>
        <span class="n">y</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">x</span>          <span class="c1"># y不是self，禁止修改</span>
        <span class="k">return</span> <span class="n">x</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h3>索引取值<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>对序列<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code>、<code class="docutils literal notranslate"><span class="pre">Dictionary</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>的索引取值操作(Python称为抽取)。</p>
<p><code class="docutils literal notranslate"><span class="pre">Tuple</span></code>的索引取值请参考本文的<a class="reference external" href="#tuple">Tuple</a>章节。</p>
<p><code class="docutils literal notranslate"><span class="pre">List</span></code>的索引取值请参考本文的<a class="reference external" href="#list">List</a>章节。</p>
<p><code class="docutils literal notranslate"><span class="pre">Dictionary</span></code>的索引取值请参考本文的<a class="reference external" href="#dictionary">Dictionary</a>章节。</p>
<p><code class="docutils literal notranslate"><span class="pre">Tensor</span></code>的索引取请参考:<a class="reference external" href="https://www.mindspore.cn/docs/note/zh-CN/r1.5/index_support.html">https://www.mindspore.cn/docs/note/zh-CN/r1.5/index_support.html</a></p>
</div>
<div class="section" id="id6">
<h3>调用<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>所谓调用就是附带可能为空的一系列参数来执行一个可调用对象(例如：<code class="docutils literal notranslate"><span class="pre">Cell</span></code>、<code class="docutils literal notranslate"><span class="pre">Primitive</span></code>)。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matmul</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">MatMul</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>  <span class="c1"># Primitive调用</span>
        <span class="k">return</span> <span class="n">out</span>

<span class="k">def</span> <span class="nf">test_call</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span> <span class="n">mindspore</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]),</span> <span class="n">mindspore</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">net</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">net</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id7">
<h2>运算符<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<p>算术运算符和赋值运算符支持<code class="docutils literal notranslate"><span class="pre">Number</span></code>和<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>运算，也支持不同<code class="docutils literal notranslate"><span class="pre">dtype</span></code>的<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>运算。</p>
<p>之所以支持，是因为这些运算符会转换成同名算子进行运算，这些算子支持了隐式类型转换。</p>
<p>规则可参考文档：<a class="reference external" href="https://www.mindspore.cn/docs/note/zh-CN/r1.5/operator_list_implicit.html">https://www.mindspore.cn/docs/note/zh-CN/r1.5/operator_list_implicit.html</a></p>
<div class="section" id="id8">
<h3>单目算术运算符<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<thead>
<tr>
<th align="left">单目算术运算符</th>
<th align="left">支持类型</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>+</code></td>
<td align="left"><code>Number</code>、<code>Tensor</code>，取正值。</td>
</tr>
<tr>
<td align="left"><code>-</code></td>
<td align="left"><code>Number</code>、<code>Tensor</code>，取负值。</td>
</tr>
<tr>
<td align="left">~</td>
<td align="left"><code>Tensor</code>， 且其数据类型为<code>Bool</code>。成员逐个取反。</td>
</tr>
</tbody>
</table>
<p>说明：</p>
<ul class="simple">
<li><p>在Python中<code class="docutils literal notranslate"><span class="pre">~</span></code>操作符对输入的整数安位取反; MindSpore对<code class="docutils literal notranslate"><span class="pre">~</span></code>的功能重新定义为对<code class="docutils literal notranslate"><span class="pre">Tensor(Bool)</span></code>的逻辑取反。</p></li>
</ul>
</div>
<div class="section" id="id9">
<h3>二元算术运算符<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<thead>
<tr>
<th align="left">二元算术运算符</th>
<th align="left">支持类型</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>+</code></td>
<td align="left"><code>Number</code> + <code>Number</code>、<code>String</code> + <code>String</code>、<code>Number</code> + <code>Tensor</code>、<code>Tensor</code> + <code>Number</code>、<code>Tuple</code> + <code>Tensor</code>、<code>Tensor</code> + <code>Tuple</code>、<code>List</code> + <code>Tensor</code>、<code>Tensor</code>+<code>List</code>、<code>List</code>+<code>List</code>、<code>Tensor</code> + <code>Tensor</code>、<code>Tuple</code> + <code>Tuple</code>。</td>
</tr>
<tr>
<td align="left"><code>-</code></td>
<td align="left"><code>Number</code> - <code>Number</code>、<code>Tensor</code> - <code>Tensor</code>、<code>Number</code> - <code>Tensor</code>、<code>Tensor</code> - <code>Number</code>、<code>Tuple</code> - <code>Tensor</code>、<code>Tensor</code> - <code>Tuple</code>、<code>List</code> - <code>Tensor</code>、<code>Tensor</code> - <code>List</code>。</td>
</tr>
<tr>
<td align="left"><code>*</code></td>
<td align="left"><code>Number</code> * <code>Number</code>、<code>Tensor</code> * <code>Tensor</code>、<code>Number</code> * <code>Tensor</code>、<code>Tensor</code> * <code>Number</code>、<code>List</code> * <code>Number</code>、<code>Number</code> * <code>List</code>、<code>Tuple</code> * <code>Number</code>、<code>Number</code> * <code>Tuple</code>、<code>Tuple</code> * <code>Tensor</code>、<code>Tensor</code> * <code>Tuple</code>、 <code>List</code> * <code>Tensor</code>、<code>Tensor</code> * <code>List</code>。</td>
</tr>
<tr>
<td align="left"><code>/</code></td>
<td align="left"><code>Number</code> / <code>Number</code>、<code>Tensor</code> / <code>Tensor</code>、<code>Number</code> / <code>Tensor</code>、<code>Tensor</code> / <code>Number</code>、<code>Tuple</code> / <code>Tensor</code>、<code>Tensor</code> / <code>Tuple</code>、<code>List</code> / <code>Tensor</code>、<code>Tensor</code> / <code>List</code>。</td>
</tr>
<tr>
<td align="left"><code>%</code></td>
<td align="left"><code>Number</code> % <code>Number</code>、<code>Tensor</code> % <code>Tensor</code>、<code>Number</code> % <code>Tensor</code>、<code>Tensor</code> % <code>Number</code>、<code>Tuple</code> % <code>Tensor</code>、<code>Tensor</code> % <code>Tuple</code>、<code>List</code> % <code>Tensor</code>、<code>Tensor</code> % <code>List</code>。</td>
</tr>
<tr>
<td align="left"><code>**</code></td>
<td align="left"><code>Number</code> ** <code>Number</code>、<code>Tensor</code> ** <code>Tensor</code>、<code>Number</code> ** <code>Tensor</code>、<code>Tensor</code> ** <code>Number</code>、<code>Tuple</code> ** <code>Tensor</code>、<code>Tensor</code> ** <code>Tuple</code>、 <code>List</code> ** <code>Tensor</code>、<code>Tensor</code> ** <code>List</code>。</td>
</tr>
<tr>
<td align="left"><code>//</code></td>
<td align="left"><code>Number</code> // <code>Number</code>、<code>Tensor</code> // <code>Tensor</code>、<code>Number</code> // <code>Tensor</code>、<code>Tensor</code> // <code>Number</code>、<code>Tuple</code> // <code>Tensor</code>、<code>Tensor</code> // <code>Tuple</code>、<code>List</code> // <code>Tensor</code>、<code>Tensor</code> // <code>List</code>。</td>
</tr>
</tbody>
</table>
<p>限制：</p>
<ul class="simple">
<li><p>当左右操作数都为<code class="docutils literal notranslate"><span class="pre">Number</span></code>类型时，<code class="docutils literal notranslate"><span class="pre">Number</span></code>的值不可为<code class="docutils literal notranslate"><span class="pre">Bool</span></code> 类型。</p></li>
<li><p>当左右操作数都为<code class="docutils literal notranslate"><span class="pre">Number</span></code>类型时，不支持<code class="docutils literal notranslate"><span class="pre">Float64</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Int32</span></code>间的运算。</p></li>
<li><p>当任一操作数为<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>类型时，左右操作数的值不可同时为<code class="docutils literal notranslate"><span class="pre">Bool</span></code>。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">List/Tuple</span></code>和<code class="docutils literal notranslate"><span class="pre">Number</span></code>进行<code class="docutils literal notranslate"><span class="pre">*</span></code>运算时表示将<code class="docutils literal notranslate"><span class="pre">List/Tuple</span></code>复制<code class="docutils literal notranslate"><span class="pre">Number</span></code>份后串联起来，<code class="docutils literal notranslate"><span class="pre">List/Tuple</span></code>内的数据类型必须为<code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">String</span></code>、<code class="docutils literal notranslate"><span class="pre">None</span></code>或由以上类型构成的<code class="docutils literal notranslate"><span class="pre">List/Tuple</span></code>。</p></li>
</ul>
</div>
<div class="section" id="id10">
<h3>赋值运算符<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<thead>
<tr>
<th align="left">赋值运算符</th>
<th align="left">支持类型</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>=</code></td>
<td align="left">MindSpore支持的Python内置数据类型和MindSpore自定义数据类型</td>
</tr>
<tr>
<td align="left"><code>+=</code></td>
<td align="left"><code>Number</code> += <code>Number</code>、<code>String</code> += <code>String</code>、<code>Number</code> += <code>Tensor</code>、<code>Tensor</code> += <code>Number</code>、<code>Tuple</code> += <code>Tensor</code>、<code>Tensor</code> += <code>Tuple</code>、<code>List</code> += <code>Tensor</code>、<code>Tensor</code> += <code>List</code>、<code>List</code> += <code>List</code>、<code>Tensor</code> += <code>Tensor</code>、<code>Tuple</code> += <code>Tuple</code>。</td>
</tr>
<tr>
<td align="left"><code>-=</code></td>
<td align="left"><code>Number</code> -= <code>Number</code>、<code>Tensor</code> -= <code>Tensor</code>、<code>Number</code> -= <code>Tensor</code>、<code>Tensor</code> -= <code>Number</code>、<code>Tuple</code> -= <code>Tensor</code>、<code>Tensor</code> -= <code>Tuple</code>、<code>List</code> -= <code>Tensor</code>、<code>Tensor</code> -= <code>List</code>。</td>
</tr>
<tr>
<td align="left"><code>*=</code></td>
<td align="left"><code>Number</code> *= <code>Number</code>、<code>Tensor</code> *= <code>Tensor</code>、<code>Number</code> *= <code>Tensor</code>、<code>Tensor</code> *= <code>Number</code>、<code>List</code> *= <code>Number</code>、<code>Number</code> *= <code>List</code>、<code>Tuple</code> *= <code>Number</code>、<code>Number</code> *= <code>Tuple</code>、<code>Tuple</code> *= <code>Tensor</code>、<code>Tensor</code> *= <code>Tuple</code>、 <code>List</code> *= <code>Tensor</code>、<code>Tensor</code> *= <code>List</code>。</td>
</tr>
<tr>
<td align="left"><code>/=</code></td>
<td align="left"><code>Number</code> /= <code>Number</code>、<code>Tensor</code> /= <code>Tensor</code>、<code>Number</code> /= <code>Tensor</code>、<code>Tensor</code> /= <code>Number</code>、<code>Tuple</code> /= <code>Tensor</code>、<code>Tensor</code> /= <code>Tuple</code>、<code>List</code> /= <code>Tensor</code>、<code>Tensor</code> /= <code>List</code>。</td>
</tr>
<tr>
<td align="left"><code>%=</code></td>
<td align="left"><code>Number</code> %= <code>Number</code>、<code>Tensor</code> %= <code>Tensor</code>、<code>Number</code> %= <code>Tensor</code>、<code>Tensor</code> %= <code>Number</code>、<code>Tuple</code> %= <code>Tensor</code>、<code>Tensor</code> %= <code>Tuple</code>、<code>List</code> %= <code>Tensor</code>、<code>Tensor</code> %= <code>List</code>。</td>
</tr>
<tr>
<td align="left"><code>**=</code></td>
<td align="left"><code>Number</code> **= <code>Number</code>、<code>Tensor</code> **= <code>Tensor</code>、<code>Number</code> **= <code>Tensor</code>、<code>Tensor</code> **= <code>Number</code>、<code>Tuple</code> **= <code>Tensor</code>、<code>Tensor</code> **= <code>Tuple</code>、 <code>List</code> **= <code>Tensor</code>、<code>Tensor</code> **= <code>List</code>。</td>
</tr>
<tr>
<td align="left"><code>//=</code></td>
<td align="left"><code>Number</code> //= <code>Number</code>、<code>Tensor</code> //= <code>Tensor</code>、<code>Number</code> //= <code>Tensor</code>、<code>Tensor</code> //= <code>Number</code>、<code>Tuple</code> //= <code>Tensor</code>、<code>Tensor</code> //= <code>Tuple</code>、<code>List</code> //= <code>Tensor</code>、<code>Tensor</code> //= <code>List</code>。</td>
</tr>
</tbody>
</table>
<p>限制：</p>
<ul>
<li><p>对于 <code class="docutils literal notranslate"><span class="pre">=</span></code>来说，不支持下列场景:</p>
<p>在<code class="docutils literal notranslate"><span class="pre">construct</span></code>函数中仅支持创建<code class="docutils literal notranslate"><span class="pre">Cell</span></code>和<code class="docutils literal notranslate"><span class="pre">Primitive</span></code>类型对象，使用<code class="docutils literal notranslate"><span class="pre">xx</span> <span class="pre">=</span> <span class="pre">Tensor(...)</span></code>的方式创建<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>会失败。</p>
<p>在<code class="docutils literal notranslate"><span class="pre">construct</span></code>函数中仅支持为self 的<code class="docutils literal notranslate"><span class="pre">Parameter</span></code>类型的属性赋值, 详情参考：<a class="reference external" href="#a-id-attr-ref-a">属性引用</a>。</p>
</li>
<li><p>当<code class="docutils literal notranslate"><span class="pre">AugAssign</span></code>的左右操作数都为<code class="docutils literal notranslate"><span class="pre">Number</span></code>类型时，<code class="docutils literal notranslate"><span class="pre">Number</span></code>的值不可为<code class="docutils literal notranslate"><span class="pre">Bool</span></code> 类型。</p></li>
<li><p>当<code class="docutils literal notranslate"><span class="pre">AugAssign</span></code>的左右操作数都为<code class="docutils literal notranslate"><span class="pre">Number</span></code>类型时，不支持<code class="docutils literal notranslate"><span class="pre">Float64</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Int32</span></code>间的运算。</p></li>
<li><p>当<code class="docutils literal notranslate"><span class="pre">AugAssign</span></code>的任一操作数为<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>类型时，左右操作数的值不可同时为<code class="docutils literal notranslate"><span class="pre">Bool</span></code>。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">List/Tuple</span></code>和<code class="docutils literal notranslate"><span class="pre">Number</span></code>进行<code class="docutils literal notranslate"><span class="pre">*=</span></code>运算时表示将<code class="docutils literal notranslate"><span class="pre">List/Tuple</span></code>复制<code class="docutils literal notranslate"><span class="pre">Number</span></code>份后串联起来，<code class="docutils literal notranslate"><span class="pre">List/Tuple</span></code>内的数据类型必须为<code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">String</span></code>、<code class="docutils literal notranslate"><span class="pre">None</span></code>或由以上类型构成的<code class="docutils literal notranslate"><span class="pre">List/Tuple</span></code>。</p></li>
</ul>
</div>
<div class="section" id="id11">
<h3>逻辑运算符<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<thead>
<tr>
<th align="left">逻辑运算符</th>
<th align="left">支持类型</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>and</code></td>
<td align="left"><code>String</code>、 <code>Number</code>、 <code>Tuple</code>、<code>List</code> 、<code>Dict</code>、<code>None</code>、标量、Tensor。</td>
</tr>
<tr>
<td align="left"><code>or</code></td>
<td align="left"><code>String</code>、 <code>Number</code>、 <code>Tuple</code>、<code>List</code> 、<code>Dict</code>、<code>None</code>、标量、Tensor。</td>
</tr>
<tr>
<td align="left"><code>not</code></td>
<td align="left"><code>Number</code>、<code>Tuple</code>、<code>List</code>、只有一个成员的Tensor。</td>
</tr>
</tbody>
</table>
<p>限制：</p>
<ul class="simple">
<li><p>当and/or的左操作数是Tensor类型时，左右操作数类型必须保持一致且Tensor成员个数只能有一个。</p></li>
<li><p>当and/or的左操作数不是Tensor类型时，右操作数可以为支持的任意类型。</p></li>
</ul>
</div>
<div class="section" id="id12">
<h3>比较运算符<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<thead>
<tr>
<th align="left">比较运算符</th>
<th align="left">支持类型</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>in</code></td>
<td align="left"><code>Number</code> in <code>tuple</code>、<code>String</code> in <code>tuple</code>、<code>Tensor</code> in <code>Tuple</code>、<code>Number</code> in <code>List</code>、<code>String</code> in <code>List</code>、<code>Tensor</code> in <code>List</code>、<code>String</code> in <code>Dictionary</code>。</td>
</tr>
<tr>
<td align="left"><code>not in</code></td>
<td align="left">与<code>in</code>相同。</td>
</tr>
<tr>
<td align="left"><code>is</code></td>
<td align="left">仅支持判断是<code>None</code>、 <code>True</code>或者<code>False</code>。</td>
</tr>
<tr>
<td align="left"><code>is not</code></td>
<td align="left">仅支持判断不是<code>None</code>、 <code>True</code>或者<code>False</code>。</td>
</tr>
<tr>
<td align="left">&lt;</td>
<td align="left"><code>Number</code> &lt; <code>Number</code>、<code>Number</code> &lt; <code>Tensor</code>、<code>Tensor</code> &lt; <code>Tensor</code>、<code>Tensor</code> &lt; <code>Number</code>。</td>
</tr>
<tr>
<td align="left">&lt;=</td>
<td align="left"><code>Number</code> &lt;= <code>Number</code>、<code>Number</code> &lt;= <code>Tensor</code>、<code>Tensor</code> &lt;= <code>Tensor</code>、<code>Tensor</code> &lt;= <code>Number</code>。</td>
</tr>
<tr>
<td align="left">&gt;</td>
<td align="left"><code>Number</code> &gt; <code>Number</code>、<code>Number</code> &gt; <code>Tensor</code>、<code>Tensor</code> &gt; <code>Tensor</code>、<code>Tensor</code> &gt; <code>Number</code>。</td>
</tr>
<tr>
<td align="left">&gt;=</td>
<td align="left"><code>Number</code> &gt;= <code>Number</code>、<code>Number</code> &gt;= <code>Tensor</code>、<code>Tensor</code> &gt;= <code>Tensor</code>、<code>Tensor</code> &gt;= <code>Number</code>。</td>
</tr>
<tr>
<td align="left">!=</td>
<td align="left"><code>Number</code> != <code>Number</code>、<code>Number</code> != <code>Tensor</code>、<code>Tensor</code> != <code>Tensor</code>、<code>Tensor</code> != <code>Number</code>、<code>mstype</code> != <code>mstype</code>、<code>String</code> != <code>String</code>、<code>Tuple !</code> = <code>Tuple</code>、<code>List</code> != <code>List</code>。</td>
</tr>
<tr>
<td align="left">==</td>
<td align="left"><code>Number</code> == <code>Number</code>、<code>Number</code> == <code>Tensor</code>、<code>Tensor</code> == <code>Tensor</code>、<code>Tensor</code> == <code>Number</code>、<code>mstype</code> == <code>mstype</code>、<code>String</code> == <code>String</code>、<code>Tuple</code> == <code>Tuple</code>、<code>List</code> == <code>List</code>。</td>
</tr>
</tbody>
</table>
<p>限制：</p>
<ul class="simple">
<li><p>对于<code class="docutils literal notranslate"><span class="pre">&lt;</span></code>、<code class="docutils literal notranslate"><span class="pre">&lt;=</span></code>、<code class="docutils literal notranslate"><span class="pre">&gt;</span></code>、<code class="docutils literal notranslate"><span class="pre">&gt;=</span></code>、<code class="docutils literal notranslate"><span class="pre">!=</span></code>来说，当左右操作数都为<code class="docutils literal notranslate"><span class="pre">Number</span></code>类型时，<code class="docutils literal notranslate"><span class="pre">Number</span></code>的值不可为<code class="docutils literal notranslate"><span class="pre">Bool</span></code> 类型。</p></li>
<li><p>对于<code class="docutils literal notranslate"><span class="pre">&lt;</span></code>、<code class="docutils literal notranslate"><span class="pre">&lt;=</span></code>、<code class="docutils literal notranslate"><span class="pre">&gt;</span></code>、<code class="docutils literal notranslate"><span class="pre">&gt;=</span></code>、<code class="docutils literal notranslate"><span class="pre">!=</span></code>、<code class="docutils literal notranslate"><span class="pre">==</span></code>来说，当左右操作数都为<code class="docutils literal notranslate"><span class="pre">Number</span></code>类型时，不支持<code class="docutils literal notranslate"><span class="pre">Float64</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Int32</span></code>间的运算。</p></li>
<li><p>对于<code class="docutils literal notranslate"><span class="pre">&lt;</span></code>、<code class="docutils literal notranslate"><span class="pre">&lt;=</span></code>、<code class="docutils literal notranslate"><span class="pre">&gt;</span></code>、<code class="docutils literal notranslate"><span class="pre">&gt;=</span></code>、<code class="docutils literal notranslate"><span class="pre">!=</span></code>、<code class="docutils literal notranslate"><span class="pre">==</span></code>来说，当左右任一操作数为<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>类型时，左右操作数的值不可同时为<code class="docutils literal notranslate"><span class="pre">Bool</span></code>。</p></li>
<li><p>对于<code class="docutils literal notranslate"><span class="pre">==</span></code>来说，当左右操作数都为<code class="docutils literal notranslate"><span class="pre">Number</span></code>类型时，支持左右操作数同时为<code class="docutils literal notranslate"><span class="pre">Bool</span></code>，不支持只有一个操作数为<code class="docutils literal notranslate"><span class="pre">Bool</span></code>。</p></li>
<li><p>对于<code class="docutils literal notranslate"><span class="pre">!=</span></code>、<code class="docutils literal notranslate"><span class="pre">==</span></code>来说除<code class="docutils literal notranslate"><span class="pre">mstype</span></code>外，其他取值均可和<code class="docutils literal notranslate"><span class="pre">None</span></code>进行比较来判空。</p></li>
<li><p>不支持链式比较，如: <code class="docutils literal notranslate"><span class="pre">a&gt;b&gt;c</span></code>。</p></li>
</ul>
</div>
</div>
<div class="section" id="id13">
<h2>复合语句<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id14">
<h3>条件控制语句<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<div class="section" id="if">
<h4>if语句<a class="headerlink" href="#if" title="Permalink to this headline">¶</a></h4>
<p>使用方式：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">(cond):</span> <span class="pre">statements...</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">y</span> <span class="pre">if</span> <span class="pre">(cond)</span> <span class="pre">else</span> <span class="pre">z</span></code></p></li>
</ul>
<p>参数：<code class="docutils literal notranslate"><span class="pre">cond</span></code> – 支持<code class="docutils literal notranslate"><span class="pre">Bool</span></code>类型的变量，也支持类型为<code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">Dict</span></code>、<code class="docutils literal notranslate"><span class="pre">String</span></code>类型的常量。</p>
<p>限制：</p>
<ul class="simple">
<li><p>如果<code class="docutils literal notranslate"><span class="pre">cond</span></code>不为常量，在不同分支中同一符号被赋予的变量或者常量的数据类型应一致，如果是被赋予变量或者常量数据类型是<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，则要求<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>的type和shape也应一致。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">if</span></code>的使用数量不能超过100个。</p></li>
</ul>
<p>示例1：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
  <span class="k">return</span> <span class="n">m</span>
<span class="k">else</span><span class="p">:</span>
  <span class="k">return</span> <span class="n">n</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">if</span></code>分支返回的<code class="docutils literal notranslate"><span class="pre">m</span></code>和<code class="docutils literal notranslate"><span class="pre">else</span></code>分支返回的<code class="docutils literal notranslate"><span class="pre">n</span></code>，二者数据类型必须一致。</p>
<p>示例2：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">out</span> <span class="o">=</span> <span class="n">init</span>
<span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
  <span class="n">out</span> <span class="o">=</span> <span class="n">m</span>
<span class="k">else</span><span class="p">:</span>
  <span class="n">out</span> <span class="o">=</span> <span class="n">n</span>
<span class="k">return</span> <span class="n">out</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">if</span></code>分支中<code class="docutils literal notranslate"><span class="pre">out</span></code>被赋值的变量或者常量<code class="docutils literal notranslate"><span class="pre">m</span></code>与<code class="docutils literal notranslate"><span class="pre">else</span></code>分支中<code class="docutils literal notranslate"><span class="pre">out</span></code>被赋值的变量或者常量<code class="docutils literal notranslate"><span class="pre">n</span></code>的数据类型必须一致。</p>
<p>示例3：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">out</span> <span class="o">=</span> <span class="n">init</span>
<span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
  <span class="n">out</span> <span class="o">=</span> <span class="n">m</span>
<span class="k">return</span> <span class="n">out</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">if</span></code>分支中<code class="docutils literal notranslate"><span class="pre">out</span></code>被赋值的变量或者常量<code class="docutils literal notranslate"><span class="pre">m</span></code>与<code class="docutils literal notranslate"><span class="pre">out</span></code>初始赋值的变量或者常量<code class="docutils literal notranslate"><span class="pre">init</span></code>的数据类型必须一致。</p>
</div>
</div>
<div class="section" id="id15">
<h3>循环语句<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h3>
<div class="section" id="for">
<h4>for语句<a class="headerlink" href="#for" title="Permalink to this headline">¶</a></h4>
<p>使用方式：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">i</span> <span class="pre">in</span> <span class="pre">sequence</span>&#160; <span class="pre">statements...</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">i</span> <span class="pre">in</span> <span class="pre">sequence</span>&#160; <span class="pre">statements...</span> <span class="pre">if</span> <span class="pre">(cond)</span> <span class="pre">break</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">i</span> <span class="pre">in</span> <span class="pre">sequence</span>&#160; <span class="pre">statements...</span> <span class="pre">if</span> <span class="pre">(cond)</span> <span class="pre">continue</span></code></p></li>
</ul>
<p>参数：<code class="docutils literal notranslate"><span class="pre">sequence</span></code> – 遍历序列(<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code>、<code class="docutils literal notranslate"><span class="pre">range</span></code>等)</p>
<p>限制：</p>
<ul class="simple">
<li><p>图的算子数量和<code class="docutils literal notranslate"><span class="pre">for</span></code>循环的迭代次数成倍数关系，<code class="docutils literal notranslate"><span class="pre">for</span></code>循环迭代次数过大可能会导致图占用内存超过使用限制。</p></li>
<li><p>不支持<code class="docutils literal notranslate"><span class="pre">for...else...</span></code>语句。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">for</span></code>的循环体内部不能包含<code class="docutils literal notranslate"><span class="pre">while</span></code>语句。</p></li>
</ul>
<p>示例：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">z</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
  <span class="n">z</span> <span class="o">+=</span> <span class="n">i</span>
<span class="k">return</span> <span class="n">z</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>z: Tensor(shape=[2, 3], dtype=Int64, value=[[7, 7, 7], [7, 7, 7]])
</pre></div>
</div>
</div>
<div class="section" id="while">
<h4>while语句<a class="headerlink" href="#while" title="Permalink to this headline">¶</a></h4>
<p>使用方式：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">while</span> <span class="pre">(cond)</span>&#160; <span class="pre">statements...</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">while</span> <span class="pre">(cond)</span>&#160; <span class="pre">statements...</span> <span class="pre">if</span> <span class="pre">(cond1)</span> <span class="pre">break</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">while</span> <span class="pre">(cond)</span>&#160; <span class="pre">statements...</span> <span class="pre">if</span> <span class="pre">(cond1)</span> <span class="pre">continue</span></code></p></li>
</ul>
<p>参数：<code class="docutils literal notranslate"><span class="pre">cond</span></code> – 支持<code class="docutils literal notranslate"><span class="pre">Bool</span></code>类型的变量，也支持类型为<code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">Dict</span></code>、<code class="docutils literal notranslate"><span class="pre">String</span></code>类型的常量。</p>
<p>限制：</p>
<ul class="simple">
<li><p>如果<code class="docutils literal notranslate"><span class="pre">cond</span></code>不为常量，在循环体内外同一符号被赋值的变量或者常量的数据类型应一致，如果是被赋予数据类型<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，则要求<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>的type和shape也应一致。</p></li>
<li><p>不支持<code class="docutils literal notranslate"><span class="pre">while...else...</span></code>语句</p></li>
<li><p>如果<code class="docutils literal notranslate"><span class="pre">cond</span></code>不为常量， 循环体内部不能更新循环体外的<code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>类型数据， 不能更改<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>类型数据的shape。</p></li>
<li><p>while的数量不能超过100个。</p></li>
</ul>
<p>示例1：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">:</span>
  <span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span>
  <span class="k">return</span> <span class="n">m</span>
<span class="k">return</span> <span class="n">n</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">while</span></code>循环内返回的<code class="docutils literal notranslate"><span class="pre">m</span></code>和<code class="docutils literal notranslate"><span class="pre">while</span></code>外返回的<code class="docutils literal notranslate"><span class="pre">n</span></code>数据类型必须一致。</p>
<p>示例2：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">out</span> <span class="o">=</span> <span class="n">m</span>
<span class="k">while</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">:</span>
  <span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span>
  <span class="n">out</span> <span class="o">=</span> <span class="n">op1</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
<span class="k">return</span> <span class="n">out</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">while</span></code>内，<code class="docutils literal notranslate"><span class="pre">out</span></code>在循环体内被赋值的变量<code class="docutils literal notranslate"><span class="pre">op1</span></code>的输出类型和初始类型<code class="docutils literal notranslate"><span class="pre">m</span></code>必须一致。</p>
</div>
</div>
<div class="section" id="id16">
<h3>函数定义语句<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h3>
<div class="section" id="def">
<h4>def关键字<a class="headerlink" href="#def" title="Permalink to this headline">¶</a></h4>
<p>用于定义函数。</p>
<p>使用方式：</p>
<p><code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">function_name(args):</span> <span class="pre">statements...</span></code></p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">number_add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="n">ret</span> <span class="o">=</span> <span class="n">number_add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ret: 3
</pre></div>
</div>
<p>限制：</p>
<ul class="simple">
<li><p>函数必须有返回语句。</p></li>
<li><p>最外层网络模型的<code class="docutils literal notranslate"><span class="pre">construct</span></code>函数不支持kwargs，即不支持 <code class="docutils literal notranslate"><span class="pre">def</span>&#160; <span class="pre">construct(**kwargs):</span></code>。</p></li>
<li><p>不支持变参和非变参的混合使用，即不支持 <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">function(x,</span> <span class="pre">y,</span> <span class="pre">*args):</span></code>和 <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">function(x</span> <span class="pre">=</span> <span class="pre">1,</span> <span class="pre">y</span> <span class="pre">=</span> <span class="pre">1,</span> <span class="pre">**kwargs):</span></code>。</p></li>
</ul>
</div>
<div class="section" id="lambda">
<h4>lambda表达式<a class="headerlink" href="#lambda" title="Permalink to this headline">¶</a></h4>
<p>用于生成函数。</p>
<p>使用方式：<code class="docutils literal notranslate"><span class="pre">lambda</span> <span class="pre">x,</span> <span class="pre">y:</span> <span class="pre">x</span> <span class="pre">+</span> <span class="pre">y</span></code></p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">number_add</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="n">ret</span> <span class="o">=</span> <span class="n">number_add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ret: 5
</pre></div>
</div>
</div>
</div>
<div class="section" id="id17">
<h3>列表生成式和生成器表达式<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h3>
<p>支持列表生成式（List Comprehension）和生成器表达式（Generator Expression）。</p>
<div class="section" id="id18">
<h4>列表生成式<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h4>
<p>用于生成列表。由于编译器会自动把List类型转换成Tuple类型，经过编译后最终输出类型为Tuple。</p>
<p>使用方式：参考Python语法说明。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>(4, 16, 36, 64, 100)
</pre></div>
</div>
<p>限制：</p>
<p>不支持多层嵌套迭代器的使用方式。</p>
<p>限制用法示例如下（使用了两层迭代器）：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
</pre></div>
</div>
<p>会提示错误：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>TypeError:  The `generators` supports one `comprehension` in ListComp/GeneratorExp, but got 2 comprehensions.
</pre></div>
</div>
</div>
<div class="section" id="id19">
<h4>生成器表达式<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h4>
<p>用于生成列表，与列表生成式动作完全一致，最终的输出类型同样是Tuple。此表达式即刻产生List值，与Python解释器中列表生成式的动作有所差异。</p>
<p>使用方式：同列表生成式。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">l</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>(4, 16, 36, 64, 100)
</pre></div>
</div>
<p>使用限制同列表生成式。</p>
</div>
</div>
</div>
<div class="section" id="id20">
<h2>函数<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id21">
<h3>Python内置函数<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h3>
<p>当前支持的Python内置函数包括：<code class="docutils literal notranslate"><span class="pre">len</span></code>、<code class="docutils literal notranslate"><span class="pre">isinstance</span></code>、<code class="docutils literal notranslate"><span class="pre">partial</span></code>、<code class="docutils literal notranslate"><span class="pre">map</span></code>、<code class="docutils literal notranslate"><span class="pre">range</span></code>、<code class="docutils literal notranslate"><span class="pre">enumerate</span></code>、<code class="docutils literal notranslate"><span class="pre">super</span></code>和<code class="docutils literal notranslate"><span class="pre">pow</span></code>。</p>
<div class="section" id="len">
<h4>len<a class="headerlink" href="#len" title="Permalink to this headline">¶</a></h4>
<p>功能：求序列的长度。</p>
<p>调用：<code class="docutils literal notranslate"><span class="pre">len(sequence)</span></code></p>
<p>入参：<code class="docutils literal notranslate"><span class="pre">sequence</span></code> – <code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code>、<code class="docutils literal notranslate"><span class="pre">Dictionary</span></code>或者<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。</p>
<p>返回值：序列的长度，类型为<code class="docutils literal notranslate"><span class="pre">int</span></code>。当入参是<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>时，返回的是<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>第0维的长度。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)))</span>
<span class="n">x_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">y_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="n">d_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="n">z_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>x_len: 3
y_len: 3
d_len: 2
z_len: 6
</pre></div>
</div>
</div>
<div class="section" id="isinstance">
<h4>isinstance<a class="headerlink" href="#isinstance" title="Permalink to this headline">¶</a></h4>
<p>功能：判断对象是否为类的实例。区别于算子Isinstance，该算子的第二个入参是MindSpore的dtype模块下定义的类型。</p>
<p>调用：<code class="docutils literal notranslate"><span class="pre">isinstance(obj,</span> <span class="pre">type)</span></code></p>
<p>入参：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">obj</span></code> – MindSpore支持类型的一个实例。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code> – <code class="docutils literal notranslate"><span class="pre">bool</span></code>、<code class="docutils literal notranslate"><span class="pre">int</span></code>、<code class="docutils literal notranslate"><span class="pre">float</span></code>、<code class="docutils literal notranslate"><span class="pre">str</span></code>、<code class="docutils literal notranslate"><span class="pre">list</span></code>、<code class="docutils literal notranslate"><span class="pre">tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">dict</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Parameter</span></code>，或者是一个只包含这些类型的<code class="docutils literal notranslate"><span class="pre">tuple</span></code>。</p></li>
</ul>
<p>返回值：<code class="docutils literal notranslate"><span class="pre">obj</span></code>为<code class="docutils literal notranslate"><span class="pre">type</span></code>的实例，返回<code class="docutils literal notranslate"><span class="pre">True</span></code>，否则返回<code class="docutils literal notranslate"><span class="pre">False</span></code>。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)))</span>
<span class="n">x_is_tuple</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
<span class="n">y_is_list</span><span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
<span class="n">z_is_tensor</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">)</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>x_is_tuple: True
y_is_list: True
z_is_tensor: True
</pre></div>
</div>
</div>
<div class="section" id="partial">
<h4>partial<a class="headerlink" href="#partial" title="Permalink to this headline">¶</a></h4>
<p>功能：偏函数，固定函数入参。</p>
<p>调用：<code class="docutils literal notranslate"><span class="pre">partial(func,</span> <span class="pre">arg,</span> <span class="pre">...)</span></code></p>
<p>入参：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">func</span></code> – 函数。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">arg</span></code> – 一个或多个要固定的参数，支持位置参数和键值对传参。</p></li>
</ul>
<p>返回值：返回某些入参固定了值的函数。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="n">add_</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">add_</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">add_</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>m: 5
n: 7
</pre></div>
</div>
</div>
<div class="section" id="map">
<h4>map<a class="headerlink" href="#map" title="Permalink to this headline">¶</a></h4>
<p>功能：根据提供的函数对一个或者多个序列做映射，由映射的结果生成一个新的序列。
如果多个序列中的元素个数不一致，则生成的新序列与最短的那个长度相同。</p>
<p>调用：<code class="docutils literal notranslate"><span class="pre">map(func,</span> <span class="pre">sequence,</span> <span class="pre">...)</span></code></p>
<p>入参：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">func</span></code> – 函数。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sequence</span></code> – 一个或多个序列（<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>或者<code class="docutils literal notranslate"><span class="pre">List</span></code>）。</p></li>
</ul>
<p>返回值：返回一个<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="n">elements_a</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">elements_b</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">ret</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="n">elements_a</span><span class="p">,</span> <span class="n">elements_b</span><span class="p">)</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ret: (5, 7, 9)
</pre></div>
</div>
</div>
<div class="section" id="zip">
<h4>zip<a class="headerlink" href="#zip" title="Permalink to this headline">¶</a></h4>
<p>功能：将多个序列中对应位置的元素打包成一个个元组，然后由这些元组组成一个新序列，
如果各个序列中的元素个数不一致，则生成的新序列与最短的那个长度相同。</p>
<p>调用：<code class="docutils literal notranslate"><span class="pre">zip(sequence,</span> <span class="pre">...)</span></code></p>
<p>入参：<code class="docutils literal notranslate"><span class="pre">sequence</span></code> – 一个或多个序列(<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>或<code class="docutils literal notranslate"><span class="pre">List</span></code>)`。</p>
<p>返回值：返回一个<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">elements_a</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">elements_b</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">ret</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">elements_a</span><span class="p">,</span> <span class="n">elements_b</span><span class="p">)</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ret: ((1, 4), (2, 5), (3, 6))
</pre></div>
</div>
</div>
<div class="section" id="range">
<h4>range<a class="headerlink" href="#range" title="Permalink to this headline">¶</a></h4>
<p>功能：根据起始值、结束值和步长创建一个<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>。</p>
<p>调用：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">range(start,</span> <span class="pre">stop,</span> <span class="pre">step)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">range(start,</span> <span class="pre">stop)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">range(stop)</span></code></p></li>
</ul>
<p>入参：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">start</span></code> – 计数起始值，类型为<code class="docutils literal notranslate"><span class="pre">int</span></code>，默认为0。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stop</span></code> – 计数结束值，但不包括在内，类型为<code class="docutils literal notranslate"><span class="pre">int</span></code>。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">step</span></code> – 步长，类型为<code class="docutils literal notranslate"><span class="pre">int</span></code>，默认为1。</p></li>
</ul>
<p>返回值：返回一个<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>x: (0, 2, 4)
y: (0, 1, 2, 3, 4)
z: (0, 1, 2)
</pre></div>
</div>
</div>
<div class="section" id="enumerate">
<h4>enumerate<a class="headerlink" href="#enumerate" title="Permalink to this headline">¶</a></h4>
<p>功能：生成一个序列的索引序列，索引序列包含数据和对应下标。</p>
<p>调用：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">enumerate(sequence,</span> <span class="pre">start)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">enumerate(sequence)</span></code></p></li>
</ul>
<p>入参：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sequence</span></code> – 一个序列（<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>）。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">start</span></code> – 下标起始位置，类型为<code class="docutils literal notranslate"><span class="pre">int</span></code>，默认为0。</p></li>
</ul>
<p>返回值：返回一个<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span> <span class="p">,</span><span class="mi">6</span><span class="p">]]))</span>
<span class="n">m</span> <span class="o">=</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>m: ((3, 100), (4, 200), (5, 300), (5, 400))
n: ((0, Tensor(shape=[2], dtype=Int64, value=[1, 2])), (1, Tensor(shape=[2], dtype=Int64, value=[3, 4])), (2, Tensor(shape=[2], dtype=Int64, value=[5, 6])))
</pre></div>
</div>
</div>
<div class="section" id="super">
<h4>super<a class="headerlink" href="#super" title="Permalink to this headline">¶</a></h4>
<p>功能：用于调用父类(超类)的一个方法，一般在<code class="docutils literal notranslate"><span class="pre">super</span></code>之后调用父类的方法。</p>
<p>调用：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">super().xxx()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">super(type,</span> <span class="pre">self).xxx()</span></code></p></li>
</ul>
<p>入参：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code> – 类。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">self</span></code> – 对象。</p></li>
</ul>
<p>返回值：返回父类的方法。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">FatherNet</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
      <span class="nb">super</span><span class="p">(</span><span class="n">FatherNet</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>

  <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span>

  <span class="k">def</span> <span class="nf">test_father</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">x</span>

<span class="k">class</span> <span class="nc">SingleSubNet</span><span class="p">(</span><span class="n">FatherNet</span><span class="p">):</span>
<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">SingleSubNet</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">z</span>

<span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">ret_father_construct</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">ret_father_test</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">SingleSubNet</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">test_father</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ret_father_construct</span><span class="p">,</span> <span class="n">ret_father_test</span>
</pre></div>
</div>
</div>
<div class="section" id="pow">
<h4>pow<a class="headerlink" href="#pow" title="Permalink to this headline">¶</a></h4>
<p>功能：求幂。</p>
<p>调用：<code class="docutils literal notranslate"><span class="pre">pow(x,</span> <span class="pre">y)</span></code></p>
<p>入参：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">x</span></code> – 底数， <code class="docutils literal notranslate"><span class="pre">Number</span></code>或<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">y</span></code> – 幂指数， <code class="docutils literal notranslate"><span class="pre">Number</span></code>或<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。</p></li>
</ul>
<p>返回值：返回<code class="docutils literal notranslate"><span class="pre">x</span></code>的<code class="docutils literal notranslate"><span class="pre">y</span></code>次幂，<code class="docutils literal notranslate"><span class="pre">Number</span></code>或<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>
<span class="n">ret</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ret: Tensor(shape=[3], dtype=Int64, value=[1, 4, 27]))
</pre></div>
</div>
</div>
<div class="section" id="print">
<h4>print<a class="headerlink" href="#print" title="Permalink to this headline">¶</a></h4>
<p>功能：用于打印。</p>
<p>调用：<code class="docutils literal notranslate"><span class="pre">print(arg,</span> <span class="pre">...)</span></code></p>
<p>入参：<code class="docutils literal notranslate"><span class="pre">arg</span></code> – 要打印的信息(<code class="docutils literal notranslate"><span class="pre">int</span></code> 、<code class="docutils literal notranslate"><span class="pre">float</span></code>、<code class="docutils literal notranslate"><span class="pre">bool</span></code>、<code class="docutils literal notranslate"><span class="pre">String</span></code>或<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>)。
当打印的数据是<code class="docutils literal notranslate"><span class="pre">int</span></code>，<code class="docutils literal notranslate"><span class="pre">float</span></code>或者<code class="docutils literal notranslate"><span class="pre">bool</span></code>时，会将其包成一个<code class="docutils literal notranslate"><span class="pre">0-D</span></code>的tensor打印出来。</p>
<p>返回值：无返回值。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>
<span class="n">y</span> <span class="o">=</span> <span class="mi">3</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>x Tensor(shape=[3], dtype=Int64, value=[1, 2, 3]))
y Tensor(shape=[], dtype=Int64, value=3))
</pre></div>
</div>
</div>
</div>
<div class="section" id="id22">
<h3>函数参数<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>参数默认值：目前不支持默认值设为<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>类型数据，支持<code class="docutils literal notranslate"><span class="pre">int</span></code>、<code class="docutils literal notranslate"><span class="pre">float</span></code>、<code class="docutils literal notranslate"><span class="pre">bool</span></code>、<code class="docutils literal notranslate"><span class="pre">None</span></code>、<code class="docutils literal notranslate"><span class="pre">str</span></code>、<code class="docutils literal notranslate"><span class="pre">tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">list</span></code>、<code class="docutils literal notranslate"><span class="pre">dict</span></code>类型数据。</p></li>
<li><p>可变参数：支持带可变参数网络的推理和训练。</p></li>
<li><p>键值对参数：目前不支持带键值对参数的函数求反向。</p></li>
<li><p>可变键值对参数：目前不支持带可变键值对的函数求反向。</p></li>
</ul>
</div>
</div>
<div class="section" id="id23">
<h2>网络定义<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id24">
<h3>网络入参<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h3>
<p>整网（最外层网络）入参仅支持<code class="docutils literal notranslate"><span class="pre">bool</span></code>、<code class="docutils literal notranslate"><span class="pre">int</span></code>、<code class="docutils literal notranslate"><span class="pre">float</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">mstype.number(mstype.bool_、mstype.int、mstype.float、mstype.uint)</span></code>，以及只包含这些类型对象的<code class="docutils literal notranslate"><span class="pre">list</span></code>或者<code class="docutils literal notranslate"><span class="pre">tuple</span></code>，和<code class="docutils literal notranslate"><span class="pre">value</span></code>值是这些类型的<code class="docutils literal notranslate"><span class="pre">Dictionary</span></code>。同时需要注意整网（最外层网络）入参不支持显示传入None，需要使用None时可通过默认值来实现。</p>
<p>在对整网入参求梯度的时候，会忽略非<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>的入参，只计算<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>入参的梯度。例如整网入参<code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">z)</span></code>中，<code class="docutils literal notranslate"><span class="pre">x</span></code>和<code class="docutils literal notranslate"><span class="pre">z</span></code>是<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，<code class="docutils literal notranslate"><span class="pre">y</span></code>是非<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>时，在对整网入参求梯度的时候，只会计算<code class="docutils literal notranslate"><span class="pre">x</span></code>和<code class="docutils literal notranslate"><span class="pre">z</span></code>的梯度，返回<code class="docutils literal notranslate"><span class="pre">(grad_x,</span> <span class="pre">grad_z)</span></code>。</p>
<p>如果网络里要使用其他类型，可在初始化网络的时候，传入该类型对象，作为网络属性保存起来，然后在<code class="docutils literal notranslate"><span class="pre">construct</span></code>里使用。
内层调用的网络入参无此限制。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Net</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flag</span> <span class="o">=</span> <span class="n">flag</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag</span> <span class="o">==</span> <span class="s2">&quot;ok&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">+</span> <span class="n">z</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span> <span class="o">-</span> <span class="n">z</span>

<span class="k">class</span> <span class="nc">GradNet</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">net</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">GradNet</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grad_all</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">GradOperation</span><span class="p">(</span><span class="n">get_all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forward_net</span> <span class="o">=</span> <span class="n">net</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">grad_all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forward_net</span><span class="p">)(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>

<span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;ok&quot;</span>
<span class="n">input_x</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="n">input_y</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">input_z</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">net</span> <span class="o">=</span> <span class="n">Net</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<span class="n">grad_net</span> <span class="o">=</span> <span class="n">GradNet</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
<span class="n">ret</span> <span class="o">=</span> <span class="n">grad_net</span><span class="p">(</span><span class="n">input_x</span><span class="p">,</span> <span class="n">input_y</span><span class="p">,</span> <span class="n">input_z</span><span class="p">)</span>
</pre></div>
</div>
<p>上面定义的Net网络里，在初始化时传入一个<code class="docutils literal notranslate"><span class="pre">string</span></code> flag，作为网络的属性保存起来，然后在<code class="docutils literal notranslate"><span class="pre">construct</span></code>里使用<code class="docutils literal notranslate"><span class="pre">self.flag</span></code>这个属性。</p>
<p>整网入参<code class="docutils literal notranslate"><span class="pre">x</span></code>和<code class="docutils literal notranslate"><span class="pre">z</span></code>是<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，<code class="docutils literal notranslate"><span class="pre">y</span></code>是<code class="docutils literal notranslate"><span class="pre">int</span></code>数，<code class="docutils literal notranslate"><span class="pre">grad_net</span></code>在对整网入参<code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">z)</span></code>求梯度时，会自动忽略<code class="docutils literal notranslate"><span class="pre">y</span></code>的梯度，只计算<code class="docutils literal notranslate"><span class="pre">x</span></code>和<code class="docutils literal notranslate"><span class="pre">z</span></code>的梯度，<code class="docutils literal notranslate"><span class="pre">ret</span> <span class="pre">=</span> <span class="pre">(grad_x,</span> <span class="pre">grad_z)</span></code>。</p>
</div>
<div class="section" id="id25">
<h3>网络实例类型<a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>带<a class="reference external" href="https://www.mindspore.cn/docs/api/zh-CN/r1.5/api_python/mindspore/mindspore.ms_function.html">&#64;ms_function</a>装饰器的普通Python函数。</p></li>
<li><p>继承自<a class="reference external" href="https://www.mindspore.cn/docs/api/zh-CN/r1.5/api_python/nn/mindspore.nn.Cell.html">nn.Cell</a>的Cell子类。</p></li>
</ul>
</div>
<div class="section" id="id26">
<h3>网络构造组件<a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<thead>
<tr>
<th align="left">类别</th>
<th align="left">内容</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>Cell</code>实例</td>
<td align="left"><a href="https://www.mindspore.cn/docs/api/zh-CN/r1.5/api_python/mindspore.nn.html">mindspore/nn/*</a>、自定义<a href="https://www.mindspore.cn/docs/api/zh-CN/r1.5/api_python/nn/mindspore.nn.Cell.html">Cell</a>。</td>
</tr>
<tr>
<td align="left"><code>Cell</code>实例的成员函数</td>
<td align="left">Cell的construct中可以调用其他类成员函数。</td>
</tr>
<tr>
<td align="left"><code>dataclass</code>实例</td>
<td align="left">使用@dataclass装饰的类。</td>
</tr>
<tr>
<td align="left"><code>Primitive</code>算子</td>
<td align="left"><a href="https://www.mindspore.cn/docs/api/zh-CN/r1.5/api_python/mindspore.ops.html">mindspore/ops/operations/*</a></td>
</tr>
<tr>
<td align="left"><code>Composite</code>算子</td>
<td align="left"><a href="https://www.mindspore.cn/docs/api/zh-CN/r1.5/api_python/mindspore.ops.html">mindspore/ops/composite/*</a></td>
</tr>
<tr>
<td align="left"><code>constexpr</code>生成算子</td>
<td align="left">使用<a href="https://www.mindspore.cn/docs/api/zh-CN/r1.5/api_python/ops/mindspore.ops.constexpr.html">@constexpr</a>生成的值计算算子。</td>
</tr>
<tr>
<td align="left">函数</td>
<td align="left">自定义Python函数、前文中列举的系统函数。</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id27">
<h3>网络使用约束<a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h3>
<ol>
<li><p>不允许修改网络的非<code class="docutils literal notranslate"><span class="pre">Parameter</span></code>类型数据成员。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Net</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">par</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;par&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</pre></div>
</div>
<p>上面所定义的网络里，<code class="docutils literal notranslate"><span class="pre">self.num</span></code>不是一个<code class="docutils literal notranslate"><span class="pre">Parameter</span></code>，不允许被修改，而<code class="docutils literal notranslate"><span class="pre">self.par</span></code>是一个<code class="docutils literal notranslate"><span class="pre">Parameter</span></code>，可以被修改。</p>
</li>
<li><p>当<code class="docutils literal notranslate"><span class="pre">construct</span></code>函数里，使用未定义的类成员时，不会像Python解释器那样抛出<code class="docutils literal notranslate"><span class="pre">AttributeError</span></code>，而是作为<code class="docutils literal notranslate"><span class="pre">None</span></code>处理。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Net</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
</pre></div>
</div>
<p>上面所定义的网络里，<code class="docutils literal notranslate"><span class="pre">construct</span></code>里使用了并未定义的类成员<code class="docutils literal notranslate"><span class="pre">self.y</span></code>，此时会将<code class="docutils literal notranslate"><span class="pre">self.y</span></code>作为<code class="docutils literal notranslate"><span class="pre">None</span></code>处理。</p>
</li>
</ol>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="index_support.html" class="btn btn-neutral float-right" title="Tensor索引支持" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="syntax_list.html" class="btn btn-neutral float-left" title="语法支持" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, MindSpore.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   
</body>
</html>