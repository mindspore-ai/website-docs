<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SPONGE Molecular Simulation Practice &mdash; MindSpore master documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Using MindSpore on the Cloud" href="use_on_the_cloud.html" />
    <link rel="prev" title="Implementing Regional Ocean Model GOMO" href="hpc_gomo.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> MindSpore
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Overall Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_structure.html">MindSpore API Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Quickstart</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="quick_start/linear_regression.html">Implementing Simple Linear Function Fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="quick_start/quick_start.html">Implementing an Image Classification Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="quick_start/quick_video.html">Hands-on Installation and Experience</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Basic Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="dtype.html">dtype</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensor.html">Tensor</a></li>
<li class="toctree-l1"><a class="reference internal" href="operators.html">Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="cell.html">Cell</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Numpy</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="numpy.html">NumPy Interfaces in MindSpore</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Execution Management</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="context.html">Configuring Running Information</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Pipeline</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="dataset_sample.html">Quick Start of Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataset.html">Loading Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="pipeline.html">Processing Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataset_advanced.html">Advanced Usage of Pipeline</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Build the Network</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="initializer.html">Initialization of Network Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="parameter.html">Updating Network Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="layer.html">Model Layers</a></li>
<li class="toctree-l1"><a class="reference internal" href="loss.html">Loss Function</a></li>
<li class="toctree-l1"><a class="reference internal" href="optim.html">Optimization Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom_net.html">Building a Customized Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="network_component.html">Common Network Components</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Train Models</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="run.html">Running Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="callback.html">Callback Mechanism</a></li>
<li class="toctree-l1"><a class="reference internal" href="save_model.html">Saving Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="load_model_for_inference_and_transfer.html">Loading a Model for Inference and Transfer Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="train.html">Advanced Usage of Training</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Inference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="multi_platform_inference.html">Inference Model Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="multi_platform_inference_ascend_910.html">Inference on the Ascend 910 AI processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="multi_platform_inference_ascend_310.html">Inference on Ascend 310</a></li>
<li class="toctree-l1"><a class="reference internal" href="multi_platform_inference_gpu.html">Inference on a GPU</a></li>
<li class="toctree-l1"><a class="reference internal" href="multi_platform_inference_cpu.html">Inference on a CPU</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Distributed Training</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="distributed_training.html">Distributed Training Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed_training_ascend.html">Parallel Distributed Training (Ascend)</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed_training_gpu.html">Distributed Parallel Training (GPU)</a></li>
<li class="toctree-l1"><a class="reference internal" href="apply_pipeline_parallel.html">Pipeline Parallelism Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="apply_host_device_training.html">Applying Host&amp;Device Hybrid Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="apply_parameter_server_training.html">Training with Parameter Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="save_load_model_hybrid_parallel.html">Saving and Loading Models in Hybrid Parallel Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed_inference.html">Distributed Inference With Multi Devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="auto_parallel.html">Parallel Distributed Training Interfaces</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Function Debugging</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="debug_in_pynative_mode.html">Debugging in PyNative Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="dump_in_graph_mode.html">Using Dump in the Graph Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom_debugging_info.html">Custom Debugging Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="evaluate_the_model_during_training.html">Evaluating the Model during Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="incremental_operator_build.html">Incremental Operator Build</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Performance Optimization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="optimize_data_processing.html">Optimizing the Data Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="enable_mixed_precision.html">Enabling Mixed Precision</a></li>
<li class="toctree-l1"><a class="reference internal" href="enable_graph_kernel_fusion.html">Enabling Graph Kernel Fusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="apply_gradient_accumulation.html">Applying a Gradient Accumulation Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="apply_quantization_aware_training.html">Applying Quantization Aware Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="apply_post_training_quantization.html">Applying Post Training Quantization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Application</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="cv.html">Computer Vision</a></li>
<li class="toctree-l1"><a class="reference internal" href="nlp.html">Natural Language Processing</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="hpc.html">High Performance Computing</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="hpc_gomo.html">Implementing Regional Ocean Model GOMO</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">SPONGE Molecular Simulation Practice</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#overall-execution">Overall Execution</a></li>
<li class="toctree-l3"><a class="reference internal" href="#preparation">Preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-of-simulated-polypeptide-aqueous-solution-system">Example of Simulated Polypeptide Aqueous Solution System</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#preparing-input-files">Preparing Input Files</a></li>
<li class="toctree-l4"><a class="reference internal" href="#loading-data">Loading Data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#constructing-simulation-process">Constructing Simulation Process</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-script">Running Script</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-result">Running Result</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="use_on_the_cloud.html">Using MindSpore on the Cloud</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MindSpore</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="hpc.html">High Performance Computing</a> &raquo;</li>
      <li>SPONGE Molecular Simulation Practice</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/hpc_sponge.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="sponge-molecular-simulation-practice">
<h1>SPONGE Molecular Simulation Practice<a class="headerlink" href="#sponge-molecular-simulation-practice" title="Permalink to this headline"></a></h1>
<p>Translator: <a class="reference external" href="https://gitee.com/liangrio">LiangRio</a></p>
<p><code class="docutils literal notranslate"><span class="pre">Linux</span></code> <code class="docutils literal notranslate"><span class="pre">GPU</span></code> <code class="docutils literal notranslate"><span class="pre">Model</span> <span class="pre">Development</span></code> <code class="docutils literal notranslate"><span class="pre">Expert</span></code></p>
<p><a href="https://gitee.com/mindspore/docs/blob/r1.3/docs/mindspore/programming_guide/source_en/hpc_sponge.md" target="_blank"><img src="https://gitee.com/mindspore/docs/raw/r1.3/resource/_static/logo_source.png"></a>  </p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline"></a></h2>
<p>Molecular simulation is a method of exploiting computer to simulate the structure and behavior of molecules by using the molecular model at the atomic-level, and then simulate the physical and chemical properties of the molecular system. It builds a set of models and algorithms based on the experiment and through the basic principles, so as to calculate the reasonable molecular structure and molecular behavior.</p>
<p>In recent years, molecular simulation technology has been developed rapidly and widely used in many fields. In the field of medical design, it can be used to study the mechanism of action of virus and drugs. In the field of biological science, it can be used to characterize the multi-level structure and properties of proteins. In the field of materials science, it can be used to study the structure and mechanical properties, material optimization design. In the field of chemistry, it can be used to study surface catalysis and mechanism. In the field of petrochemical industry, it can be used for structure characterization, synthesis design, adsorption and diffusion of molecular sieve catalyst, construction and characterization of polymer chain and structure of crystalline or amorphous bulk polymer, and prediction of important properties including blending behavior, mechanical properties, diffusion, cohesion and so on.</p>
<p>SPONGE in MindSpore is molecular simulation library jointly developed by the Gao Yiqin research group of PKU and Shenzhen Bay Laboratory and Huawei MindSpore team. SPONGE has the features like high-performance, modularization, etc. SPONGE can complete the traditional molecular simulation process efficiently based on MindSpore’s automatic parallelism, graph-computing fusion and other features. SPONGE can combine AI methods such as neural networks with traditional molecular simulations by utilizing MindSpore’s feature of automatic differentiation.</p>
<p>This tutorial mainly introduces how to use SPONGE, which is built in MindSpore, to perform high performance molecular simulation on the GPU.</p>
<blockquote>
<div><p>Here you can download the complete sample code: <a class="reference external" href="https://gitee.com/mindspore/mindspore/tree/r1.3/model_zoo/research/hpc/sponge">https://gitee.com/mindspore/mindspore/tree/r1.3/model_zoo/research/hpc/sponge</a>.</p>
</div></blockquote>
</section>
<section id="overall-execution">
<h2>Overall Execution<a class="headerlink" href="#overall-execution" title="Permalink to this headline"></a></h2>
<ol class="arabic simple">
<li><p>Prepare input files of molecular simulation, load data, and determine the molecular system of calculation;</p></li>
<li><p>Define and initialize the SPONGE module, make sure the calculation process;</p></li>
<li><p>Run training script, output thermodynamic information of the simulation, and check the result.</p></li>
</ol>
</section>
<section id="preparation">
<h2>Preparation<a class="headerlink" href="#preparation" title="Permalink to this headline"></a></h2>
<p>Before practicing, make sure you have MindSpore installed correctly. If not, you can turn to <a class="reference external" href="https://www.mindspore.cn/install/en">MindSpore Installation</a>.</p>
</section>
<section id="example-of-simulated-polypeptide-aqueous-solution-system">
<h2>Example of Simulated Polypeptide Aqueous Solution System<a class="headerlink" href="#example-of-simulated-polypeptide-aqueous-solution-system" title="Permalink to this headline"></a></h2>
<p>SPONGE has advantages of high-performance and usability, and this tutorial uses SPONGE to simulate polypeptide aqueous solution system. The simulated system is an alanine tripeptide aqueous solution system.</p>
<section id="preparing-input-files">
<h3>Preparing Input Files<a class="headerlink" href="#preparing-input-files" title="Permalink to this headline"></a></h3>
<p>The simulated system of this tutorial requires 3 input files:</p>
<ul class="simple">
<li><p>Property file (file suffix<code class="docutils literal notranslate"><span class="pre">.in</span></code>), declares the basic conditions for the simulation, parameter control to the whole simulation process.</p></li>
<li><p>Topology file (file suffix<code class="docutils literal notranslate"><span class="pre">.param7</span></code>), describes the topological relations and parameters of the internal molecules in the system.</p></li>
<li><p>Coordinate file (file suffix<code class="docutils literal notranslate"><span class="pre">.rst7</span></code>), describes the initial coordinates of each atom in the system.</p></li>
</ul>
<p>Topology and Coordinate files can be modeling completed by tleap (download address <a class="reference external" href="http://ambermd.org/GetAmber.php">http://ambermd.org/GetAmber.php</a>, comply with the GPL), which is a built-in tool in AmberTools, through the modeling process.</p>
<p>The modeling process is as follows:</p>
<ul class="simple">
<li><p>Open tleap</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tleap
</pre></div>
</div>
<ul class="simple">
<li><p>Load force field ff14SB that built-in in tleap</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt;<span class="w"> </span><span class="nb">source</span><span class="w"> </span>leaprc.protein.ff14SB
</pre></div>
</div>
<ul class="simple">
<li><p>Build model of alanine tripeptide</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt;<span class="w"> </span><span class="nv">ala</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>sequence<span class="w"> </span><span class="o">{</span>ALA<span class="w"> </span>ALA<span class="w"> </span>ALA<span class="o">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Use tleap to load its force field tip3p</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt;<span class="w"> </span><span class="nb">source</span><span class="w"> </span>leaprc.water.tip3p
</pre></div>
</div>
<ul class="simple">
<li><p>Use <code class="docutils literal notranslate"><span class="pre">slovatebox</span></code> in tleap to dissolve alanine tripeptide chain, complete the system construction. <code class="docutils literal notranslate"><span class="pre">10.0</span></code>, represents the water we add is over 10 Angstrom far away from the border of molecular we dissolve and the system.</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt;<span class="w"> </span>solvatebox<span class="w"> </span>ala<span class="w"> </span>TIP3PBOX<span class="w"> </span><span class="m">10</span>.0
</pre></div>
</div>
<ul class="simple">
<li><p>Save constructed system as file suffix <code class="docutils literal notranslate"><span class="pre">parm7</span></code> and <code class="docutils literal notranslate"><span class="pre">rst7</span></code></p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt;<span class="w"> </span>saveamberparm<span class="w"> </span>ala<span class="w"> </span>ala.parm7<span class="w"> </span>ala_350_cool_290.rst7
</pre></div>
</div>
<p>After constructing the Topology file(<code class="docutils literal notranslate"><span class="pre">WATER_ALA.parm7</span></code>) and Coordinate file(<code class="docutils literal notranslate"><span class="pre">WATER_ALA_350_COOL_290.RST7</span></code>) that needed through tleap, it is required to declare basic conditions of simulation by Property file, which executes parameter control to the whole simulation process. Take Property file <code class="docutils literal notranslate"><span class="pre">NVT_299_10ns.in</span></code> in this tutorial as an example, contents are as follows:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>NVT 290k
   mode = 1,                              # Simulation mode ; mode=1 for NVT ensemble
   dt= 0.001,                             # Time step in picoseconds (ps). The time length of each MD step
   step_limit = 1,                        # Total step limit, number of MD steps run
   thermostat=1,                          # Thermostat for temperature ; thermostat=0 for Langevin thermostat
   langevin_gamma=1.0,                    # Gamma_ln for Langevin thermostat represents coupling strength between thermostat and system
   target_temperature=290,               # Target temperature
   write_information_interval=1000,       # Output frequency
   amber_irest=0,                         # Input style ;  amber_irest=1 for using amber style input &amp; rst7 file contains veclocity
   cut=10.0,                              # Nonbonded cutoff distance in Angstroms
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">mode</span></code>, Molecular Dynamics (MD) mode, <code class="docutils literal notranslate"><span class="pre">1</span></code> represents the simulation uses <code class="docutils literal notranslate"><span class="pre">NVT</span></code> ensemble.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dt</span></code>, represents the step size in the simulation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">step_limit</span></code>, represents total steps in the simulation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">thermostat</span></code>, represents the method of temperature control, <code class="docutils literal notranslate"><span class="pre">1</span></code> represents to use <code class="docutils literal notranslate"><span class="pre">Liujian-Langevin</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">langevin_gamma</span></code>, represents <code class="docutils literal notranslate"><span class="pre">Gamma_In</span></code> parameters in the thermostat.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">target_temperature</span></code>, represents the target temperature.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amber_irest</span></code>, represents the input mode, <code class="docutils literal notranslate"><span class="pre">0</span></code> represents to use the amber mode to input, and files suffix <code class="docutils literal notranslate"><span class="pre">rst7</span></code> do not include the attribute <code class="docutils literal notranslate"><span class="pre">veclocity</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cut</span></code>, represents the distance of non-bonding interaction.</p></li>
</ul>
</section>
<section id="loading-data">
<h3>Loading Data<a class="headerlink" href="#loading-data" title="Permalink to this headline"></a></h3>
<p>After completing the construction of input files, save files under the path <code class="docutils literal notranslate"><span class="pre">sponge_in</span></code> to local workplace, the directory structure is as follows:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>└─sponge
    ├─sponge_in
    │      NVT_290_10ns.in                 # specific MD simulation setting
    │      WATER_ALA.parm7                 # topology file include atom &amp; residue &amp; bond &amp; nonbond information
    │      WATER_ALA_350_cool_290.rst7     # restart file record atom coordinate &amp; velocity and box information
</pre></div>
</div>
<p>Read the parameters needed by the simulation system from three input files, and use them for calculation in MindSpore. The loading code is as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">context</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Sponge Controller&#39;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--i&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;input file&#39;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--amber_parm&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;paramter file in AMBER type&#39;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--c&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;initial coordinates file&#39;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--r&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;restrt&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--x&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;mdcrd&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--o&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;mdout&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--box&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;mdbox&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--device_id&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">args_opt</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

<span class="n">context</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">GRAPH_MODE</span><span class="p">,</span> <span class="n">device_target</span><span class="o">=</span><span class="s2">&quot;GPU&quot;</span><span class="p">,</span> <span class="n">device_id</span><span class="o">=</span><span class="n">args_opt</span><span class="o">.</span><span class="n">device_id</span><span class="p">,</span> <span class="n">save_graphs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="constructing-simulation-process">
<h3>Constructing Simulation Process<a class="headerlink" href="#constructing-simulation-process" title="Permalink to this headline"></a></h3>
<p>By using computational force module and computational energy module defined in SPONGE, the system reaches the equilibrium state we need through multiple iterations of molecular dynamics process evolves, and energy and other data obtained in each simulation step is recorded. For convenience, this tutorial set <code class="docutils literal notranslate"><span class="pre">1</span></code> as the number of iterations, the code for constructing the simulation process is as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">src.simulation_initial</span> <span class="kn">import</span> <span class="n">Simulation</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">Tensor</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">simulation</span> <span class="o">=</span> <span class="n">Simulation</span><span class="p">(</span><span class="n">args_opt</span><span class="p">)</span>
    <span class="n">save_path</span> <span class="o">=</span> <span class="n">args_opt</span><span class="o">.</span><span class="n">o</span>
    <span class="k">for</span> <span class="n">steps</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">simulation</span><span class="o">.</span><span class="n">md_info</span><span class="o">.</span><span class="n">step_limit</span><span class="p">):</span>
        <span class="n">print_step</span> <span class="o">=</span> <span class="n">steps</span> <span class="o">%</span> <span class="n">simulation</span><span class="o">.</span><span class="n">ntwx</span>
        <span class="k">if</span> <span class="n">steps</span> <span class="o">==</span> <span class="n">simulation</span><span class="o">.</span><span class="n">md_info</span><span class="o">.</span><span class="n">step_limit</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">print_step</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">temperature</span><span class="p">,</span> <span class="n">total_potential_energy</span><span class="p">,</span> <span class="n">sigma_of_bond_ene</span><span class="p">,</span> <span class="n">sigma_of_angle_ene</span><span class="p">,</span> <span class="n">sigma_of_dihedral_ene</span><span class="p">,</span> \
        <span class="n">nb14_lj_energy_sum</span><span class="p">,</span> <span class="n">nb14_cf_energy_sum</span><span class="p">,</span> <span class="n">LJ_energy_sum</span><span class="p">,</span> <span class="n">ee_ene</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">simulation</span><span class="p">(</span><span class="n">Tensor</span><span class="p">(</span><span class="n">steps</span><span class="p">),</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">print_step</span><span class="p">))</span>
        <span class="c1"># compute energy and temperature</span>

</pre></div>
</div>
</section>
<section id="running-script">
<h3>Running Script<a class="headerlink" href="#running-script" title="Permalink to this headline"></a></h3>
<p>Execute the following command, start <code class="docutils literal notranslate"><span class="pre">main.py</span></code> training script for training:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>python main.py --i /path/NVT_290_10ns.in \
               --amber_parm /path/WATER_ALA.parm7 \
               --c /path/WATER_ALA_350_cool_290.rst7 \
               --o /path/ala_NVT_290_10ns.out
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">i</span></code> is property file of MD simulation, which control simulation process.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amber_parm</span></code> is topology file of MD simulation system.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">c</span></code> is initial coordinate file we input.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">o</span></code> is log file output after simulation, which records energy and other data obtained in each simulation step.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">path</span></code> is the path to the file, this path is denoted as <code class="docutils literal notranslate"><span class="pre">sponge_in</span></code> in this tutorial.</p></li>
</ul>
<p>During training, property file (file suffix<code class="docutils literal notranslate"><span class="pre">.in</span></code>), topology file (file suffix<code class="docutils literal notranslate"><span class="pre">.param7</span></code>) and coordinate file (file suffix<code class="docutils literal notranslate"><span class="pre">.rst7</span></code>) can be used under specified temperatures to perform simulation, compute force and energy, perform molecular dynamics process evolves.</p>
</section>
<section id="running-result">
<h3>Running Result<a class="headerlink" href="#running-result" title="Permalink to this headline"></a></h3>
<p>After training, output file <code class="docutils literal notranslate"><span class="pre">ala_NVT_290_10ns.out</span></code> can be obtained, which records the change of system energy and can be viewed for thermodynamic information of the simulation system. When viewing <code class="docutils literal notranslate"><span class="pre">ala_NVT_290_10ns.out</span></code>, contents are as follows:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>_steps_ _TEMP_ _TOT_POT_ENE_ _BOND_ENE_ _ANGLE_ENE_ _DIHEDRAL_ENE_ _14LJ_ENE_ _14CF_ENE_ _LJ_ENE_ _CF_PME_ENE_
      0 0.000   -5713.804         0.037       0.900         14.909      9.072    194.477  765.398    -6698.648
   ...
</pre></div>
</div>
<p>Types of energy output in the simulation process are recorded, namely iterations(steps), temperature(TEMP), total energy(TOT_POT_E), bond length(BOND_ENE), bond angle(ANGLE_ENE), dihedral angle interactions(DIHEDRAL_ENE), and none-bonded interaction that includes electrostatic force and Leonard-Jones interaction.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="hpc_gomo.html" class="btn btn-neutral float-left" title="Implementing Regional Ocean Model GOMO" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="use_on_the_cloud.html" class="btn btn-neutral float-right" title="Using MindSpore on the Cloud" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, MindSpore.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>