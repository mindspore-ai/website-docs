<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Realizing Sentiment Classification With SentimentNet &mdash; MindSpore master documentation</title><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Using the BERT Network to Implement Intelligent Poem Writing" href="nlp_bert_poetry.html" />
    <link rel="prev" title="Natural Language Processing" href="nlp.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> MindSpore
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Overall Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_structure.html">MindSpore API Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Design</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="design/technical_white_paper.html">Technical White Paper</a></li>
<li class="toctree-l1"><a class="reference internal" href="design/gradient.html">MindSpore Automatic Differentiation</a></li>
<li class="toctree-l1"><a class="reference internal" href="design/distributed_training_design.html">Distributed Training Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="design/mindir.html">MindSpore IR (MindIR)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.mindspore.cn/mindinsight/docs/en/r1.5/training_visual_design.html">Design of Visualization↗</a></li>
<li class="toctree-l1"><a class="reference internal" href="design/glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Quickstart</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://www.mindspore.cn/tutorials/en/r1.5/linear_regression.html">Implementing Simple Linear Function Fitting↗</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.mindspore.cn/tutorials/en/r1.5/quick_start.html">Implementing an Image Classification Application↗</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Basic Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="dtype.html">DataType</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensor.html">Tensor</a></li>
<li class="toctree-l1"><a class="reference internal" href="parameter_introduction.html">Parameter</a></li>
<li class="toctree-l1"><a class="reference internal" href="operators.html">Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="cell.html">Cell</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataset_introduction.html">Dataset</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Pipeline</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="dataset_sample.html">Quick Start of Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataset.html">Loading Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="pipeline.html">Processing Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataset_advanced.html">Advanced Usage of Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataset_usage.html">Data Iteration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Build the Network</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="build_net.html">Constructing Single Operator Network and Multi-layer Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="initializer.html">Initializer</a></li>
<li class="toctree-l1"><a class="reference internal" href="parameter.html">Network Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="control_flow.html">Using the Process Control Statement</a></li>
<li class="toctree-l1"><a class="reference internal" href="loss.html">Loss Function</a></li>
<li class="toctree-l1"><a class="reference internal" href="grad_operation.html">Gradient Operation</a></li>
<li class="toctree-l1"><a class="reference internal" href="indefinite_parameter.html">Parameter Passing</a></li>
<li class="toctree-l1"><a class="reference internal" href="constexpr.html">Construct Constants In the Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="hypermap.html">Operation Overloading</a></li>
<li class="toctree-l1"><a class="reference internal" href="optim.html">Optimization Algorithms</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Model Running</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="context.html">Configuring Running Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="run.html">Running Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="save_and_load_models.html">Save and Load Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="model.html">Application of Model</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Inference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="multi_platform_inference.html">Inference Model Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="online_inference.html">Online Inference with Checkpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="offline_inference.html">Using Offline Model for Inference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Distributed Training</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="distributed_training.html">Distributed Parallel Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed_advanced.html">Distributed Parallel Advanced Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed_example.html">Distributed Parallel Usage Example</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">PyNative</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="debug_in_pynative_mode.html">Debugging in PyNative Mode</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Numpy</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="numpy.html">NumPy Interfaces in MindSpore</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Features</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="second_order_optimizer.html">Second Order Optimizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="apply_quantization_aware_training.html">Applying Quantization Aware Training</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Function Debugging</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="read_ir_files.html">Reading IR</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.mindspore.cn/docs/programming_guide/en/r1.5/debug_in_pynative_mode.html">Debugging in PyNative Mode↗</a></li>
<li class="toctree-l1"><a class="reference internal" href="dump_in_graph_mode.html">Using Dump in the Graph Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom_debugging_info.html">Custom Debugging Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="incremental_operator_build.html">Incremental Operator Build</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Performance Optimization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="enable_mixed_precision.html">Enabling Mixed Precision</a></li>
<li class="toctree-l1"><a class="reference internal" href="enable_graph_kernel_fusion.html">Enabling Graph Kernel Fusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="enable_auto_tune.html">Enabling AutoTune</a></li>
<li class="toctree-l1"><a class="reference internal" href="apply_gradient_accumulation.html">Applying a Gradient Accumulation Algorithm</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.mindspore.cn/mindinsight/docs/en/r1.5/performance_profiling.html">Debugging performance with Profiler↗</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Application</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="cv.html">Computer Vision</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="nlp.html">Natural Language Processing</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Realizing Sentiment Classification With SentimentNet</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#preparation-and-design">Preparation and Design</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#downloading-the-dataset">Downloading the Dataset</a></li>
<li class="toctree-l4"><a class="reference internal" href="#determining-evaluation-criteria">Determining Evaluation Criteria</a></li>
<li class="toctree-l4"><a class="reference internal" href="#determining-the-network-and-process">Determining the Network and Process</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#implementation">Implementation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#importing-library-files">Importing Library Files</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuring-environment-information">Configuring Environment Information</a></li>
<li class="toctree-l4"><a class="reference internal" href="#preprocessing-the-dataset">Preprocessing the Dataset</a></li>
<li class="toctree-l4"><a class="reference internal" href="#defining-the-network">Defining the Network</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pre-training">Pre-Training</a></li>
<li class="toctree-l4"><a class="reference internal" href="#defining-the-optimizer-and-loss-function">Defining the Optimizer and Loss Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="#training-and-saving-the-model">Training and Saving the Model</a></li>
<li class="toctree-l4"><a class="reference internal" href="#validating-the-model">Validating the Model</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#experimental-result">Experimental Result</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="nlp_bert_poetry.html">Using the BERT Network to Implement Intelligent Poem Writing</a></li>
<li class="toctree-l2"><a class="reference internal" href="nlp_tprr.html">Multi-hop Knowledge Reasoning Question-answering Model TPRR</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="hpc.html">High Performance Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="use_on_the_cloud.html">Using MindSpore on the Cloud</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MindSpore</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="nlp.html">Natural Language Processing</a> &raquo;</li>
      <li>Realizing Sentiment Classification With SentimentNet</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/nlp_sentimentnet.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="realizing-sentiment-classification-with-sentimentnet">
<h1>Realizing Sentiment Classification With SentimentNet<a class="headerlink" href="#realizing-sentiment-classification-with-sentimentnet" title="Permalink to this headline"></a></h1>
<p><code class="docutils literal notranslate"><span class="pre">CPU</span></code> <code class="docutils literal notranslate"><span class="pre">CPU</span></code> <code class="docutils literal notranslate"><span class="pre">Natural</span> <span class="pre">Language</span> <span class="pre">Processing</span></code> <code class="docutils literal notranslate"><span class="pre">Whole</span> <span class="pre">Process</span></code></p>
<p><a href="https://gitee.com/mindspore/docs/blob/r1.5/docs/mindspore/programming_guide/source_en/nlp_sentimentnet.md" target="_blank"><img src="https://gitee.com/mindspore/docs/raw/r1.5/resource/_static/logo_source_en.png"></a></p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline"></a></h2>
<p>Sentiment classification is a subset of text classification in NLP, and is one of the most basic applications of NLP. It is a process of analyzing and inferencing affective states and subjective information, that is, analyzing whether a person’s sentiment is positive or negative.</p>
<blockquote>
<div><p>Generally, sentiments are classified into three categories: positive, negative, and neutral. In most cases, only positive and negative sentiments are used for training regardless of the neutral sentiments. The following dataset is a good example.</p>
</div></blockquote>
<p><a class="reference external" href="http://qwone.com/~jason/20Newsgroups/">20 Newsgroups</a> is a typical reference dataset for traditional text classification. It is a collection of approximately 20,000 news documents partitioned across 20 different newsgroups.
Some of the newsgroups are very closely related to each other (such as comp.sys.ibm.pc.hardware and comp.sys.mac.hardware), while others are highly unrelated (such as misc.forsale and soc.religion.christian).</p>
<p>In terms of the network itself, the network structure of text classification is roughly similar to that of sentiment classification. After mastering how to construct the sentiment classification network, it is easy to construct a similar network which can be used in a text classification task after fine-tuning some parameters.</p>
<p>In the service context, text classification is to analyze the objective content discussed in the text, but sentiment classification is to find a viewpoint, which is supported by the content in the text. For example, “Forrest Gump has a clear theme and smooth pacing, which is excellent.” In the text classification, this sentence is classified into a “movie” theme, but in the sentiment classification, this movie review is used to explore whether the sentiment is positive or negative.</p>
<p>Compared with traditional text classification, sentiment classification is simpler and more practical. High-quality datasets can be collected from common shopping websites and movie websites to benefit the business domains. For example, based on the domain context, the system can automatically analyze opinions of specific types of customers on the current product, analyze sentiments by subject and user type, and even recommend products based on the analysis result, therefore to improve the conversion rate and bring more business benefits.</p>
<p>In special fields, some non-polar words also fully express a sentimental tendency of a user. For example, when an app is downloaded and used, “the app is stuck” and “the download speed is so slow” express users’ negative sentiments. In the stock market, “bullish” and “bull market” express users’ positive sentiments. Therefore, in essence, we hope that the model can be used to mine special expressions in the vertical field as polarity words for the sentiment classification system.</p>
<p>Vertical polarity word = General polarity word + Domain-specific polarity word</p>
<p>According to the text processing granularity, sentiment analysis can be divided into word, phrase, sentence, paragraph, and chapter levels. A sentiment analysis at paragraph level is used as an example. The input is a paragraph, and the output is information about whether the movie review is positive or negative.</p>
</section>
<section id="preparation-and-design">
<h2>Preparation and Design<a class="headerlink" href="#preparation-and-design" title="Permalink to this headline"></a></h2>
<section id="downloading-the-dataset">
<h3>Downloading the Dataset<a class="headerlink" href="#downloading-the-dataset" title="Permalink to this headline"></a></h3>
<p>The IMDb movie review dataset is used as experimental data.</p>
<blockquote>
<div><p>Dataset download address: <a class="reference external" href="http://ai.stanford.edu/~amaas/data/sentiment/">http://ai.stanford.edu/~amaas/data/sentiment/</a></p>
</div></blockquote>
<p>The following are cases of negative and positive reviews.</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Review</p></th>
<th class="head"><p>Label</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>“Quitting” may be as much about exiting a pre-ordained identity as about drug withdrawal. As a rural guy coming to Beijing, class and success must have struck this young artist face on as an appeal to separate from his roots and far surpass his peasant parents’ acting success. Troubles arise, however, when the new man is too new, when it demands too big a departure from family, history, nature, and personal identity. The ensuing splits, and confusion between the imaginary and the real and the dissonance between the ordinary and the heroic are the stuff of a gut check on the one hand or a complete escape from self on the other.</p></td>
<td><p>Negative</p></td>
</tr>
<tr class="row-odd"><td><p>This movie is amazing because the fact that the real people portray themselves and their real life experience and do such a good job it’s like they’re almost living the past over again. Jia Hongsheng plays himself an actor who quit everything except music and drugs struggling with depression and searching for the meaning of life while being angry at everyone especially the people who care for him most.</p></td>
<td><p>Positive</p></td>
</tr>
</tbody>
</table>
<p>Download and unzip the Glove file, add a new line at the beginning of each unzipped file, which means that a total of 400,000 words are read, and each word is represented by a word vector of 300 latitudes.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>400000 300
</pre></div>
</div>
<p>GloVe file download address: <a class="reference external" href="http://nlp.stanford.edu/data/glove.6B.zip">http://nlp.stanford.edu/data/glove.6B.zip</a></p>
</section>
<section id="determining-evaluation-criteria">
<h3>Determining Evaluation Criteria<a class="headerlink" href="#determining-evaluation-criteria" title="Permalink to this headline"></a></h3>
<p>As a typical classification, the evaluation criteria of sentiment classification can be determined by referring to that of the common classification. For example, accuracy, precision, recall, and F_beta scores can be used as references.</p>
<p>Accuracy = Number of accurately classified samples/Total number of samples</p>
<p>Precision = True positives/(True positives + False positives)</p>
<p>Recall = True positives/(True positives + False negatives)</p>
<p>F1 score = (2 x Precision x Recall)/(Precision + Recall)</p>
<p>In the IMDb dataset, the number of positive and negative samples does not vary greatly. Accuracy can be used as the evaluation criterion of the classification system.</p>
</section>
<section id="determining-the-network-and-process">
<h3>Determining the Network and Process<a class="headerlink" href="#determining-the-network-and-process" title="Permalink to this headline"></a></h3>
<p>Currently, MindSpore GPU and CPU supports SentimentNet network based on the long short-term memory (LSTM) network for NLP.</p>
<ol class="arabic simple">
<li><p>Load the dataset in use and process data if necessary.</p></li>
<li><p>Use the SentimentNet network based on LSTM to train data and generate a model.
Long short-term memory (LSTM) is an artificial recurrent neural network (RNN) architecture used for processing and predicting an important event with a long interval and delay in a time sequence. For details, refer to the online documentation.</p></li>
<li><p>After the model is obtained, use the validation dataset to check the accuracy of model.</p></li>
</ol>
<blockquote>
<div><p>The current sample is for the Ascend 910 AI processor. You can find the complete executable sample code at <a class="reference external" href="https://gitee.com/mindspore/models/tree/r1.5/official/nlp/lstm">https://gitee.com/mindspore/models/tree/r1.5/official/nlp/lstm</a>.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">default_config.yaml,</span> <span class="pre">config_ascend.yaml</span></code>: some configurations in the network, including <code class="docutils literal notranslate"><span class="pre">batch</span> <span class="pre">size</span></code>, several epoch training, etc.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">src/config.py</span></code>: some configurations of the network, including the batch size and number of training epochs.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">src/dataset.py</span></code>: dataset related definition, including converted MindRecord file and preprocessed data.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">src/imdb.py</span></code>: the utility class for parsing IMDb dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">src/lstm.py</span></code>: the definition of semantic net.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">train.py</span></code>: the training script.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">eval.py</span></code>: the evaluation script.</p></li>
</ul>
</div></blockquote>
</section>
</section>
<section id="implementation">
<h2>Implementation<a class="headerlink" href="#implementation" title="Permalink to this headline"></a></h2>
<section id="importing-library-files">
<h3>Importing Library Files<a class="headerlink" href="#importing-library-files" title="Permalink to this headline"></a></h3>
<p>The following are the required public modules and MindSpore modules and library files.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">src.model_utils.config</span> <span class="kn">import</span> <span class="n">config</span>
<span class="kn">from</span> <span class="nn">src.model_utils.moxing_adapter</span> <span class="kn">import</span> <span class="n">moxing_wrapper</span>
<span class="kn">from</span> <span class="nn">src.dataset</span> <span class="kn">import</span> <span class="n">convert_to_mindrecord</span>
<span class="kn">from</span> <span class="nn">src.dataset</span> <span class="kn">import</span> <span class="n">lstm_create_dataset</span>
<span class="kn">from</span> <span class="nn">src.lr_schedule</span> <span class="kn">import</span> <span class="n">get_lr</span>
<span class="kn">from</span> <span class="nn">src.lstm</span> <span class="kn">import</span> <span class="n">SentimentNet</span>

<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">nn</span><span class="p">,</span> <span class="n">Model</span><span class="p">,</span> <span class="n">context</span>
<span class="kn">from</span> <span class="nn">mindspore.nn</span> <span class="kn">import</span> <span class="n">Accuracy</span>
<span class="kn">from</span> <span class="nn">mindspore.train.callback</span> <span class="kn">import</span> <span class="n">LossMonitor</span><span class="p">,</span> <span class="n">CheckpointConfig</span><span class="p">,</span> <span class="n">ModelCheckpoint</span><span class="p">,</span> <span class="n">TimeMonitor</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">load_param_into_net</span><span class="p">,</span> <span class="n">load_checkpoint</span>
<span class="kn">from</span> <span class="nn">mindspore.communication</span> <span class="kn">import</span> <span class="n">init</span><span class="p">,</span> <span class="n">get_rank</span>
<span class="kn">from</span> <span class="nn">mindspore.context</span> <span class="kn">import</span> <span class="n">ParallelMode</span>
</pre></div>
</div>
</section>
<section id="configuring-environment-information">
<h3>Configuring Environment Information<a class="headerlink" href="#configuring-environment-information" title="Permalink to this headline"></a></h3>
<ol class="arabic">
<li><p>The <code class="docutils literal notranslate"><span class="pre">parser</span></code> module is used to transfer necessary information for running, such as storage paths of the dataset and the GloVe file. In this way, the frequently changed configurations can be entered during runtime, which is more flexible.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">parse_cli_to_yaml</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">cfg</span><span class="p">,</span> <span class="n">helper</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cfg_path</span><span class="o">=</span><span class="s2">&quot;default_config.yaml&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse command line arguments to the configuration according to the default yaml.</span>
<span class="sd">    Args:</span>
<span class="sd">        parser: Parent parser.</span>
<span class="sd">        cfg: Base configuration.</span>
<span class="sd">        helper: Helper description.</span>
<span class="sd">        cfg_path: Path to the default yaml config.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;[REPLACE THIS at config.py]&quot;</span><span class="p">,</span>
                                     <span class="n">parents</span><span class="o">=</span><span class="p">[</span><span class="n">parser</span><span class="p">])</span>
    <span class="n">helper</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">helper</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">helper</span>
    <span class="n">choices</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">choices</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">choices</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">cfg</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="n">item</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="n">item</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">help_description</span> <span class="o">=</span> <span class="n">helper</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">helper</span> <span class="k">else</span> <span class="s2">&quot;Please reference to </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cfg_path</span><span class="p">)</span>
            <span class="n">choice</span> <span class="o">=</span> <span class="n">choices</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">choices</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="n">item</span><span class="p">],</span> <span class="nb">bool</span><span class="p">):</span>
                <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--&quot;</span> <span class="o">+</span> <span class="n">item</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">cfg</span><span class="p">[</span><span class="n">item</span><span class="p">],</span> <span class="n">choices</span><span class="o">=</span><span class="n">choice</span><span class="p">,</span>
                                    <span class="n">help</span><span class="o">=</span><span class="n">help_description</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--&quot;</span> <span class="o">+</span> <span class="n">item</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="n">item</span><span class="p">]),</span> <span class="n">default</span><span class="o">=</span><span class="n">cfg</span><span class="p">[</span><span class="n">item</span><span class="p">],</span> <span class="n">choices</span><span class="o">=</span><span class="n">choice</span><span class="p">,</span>
                                    <span class="n">help</span><span class="o">=</span><span class="n">help_description</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">args</span>
</pre></div>
</div>
</li>
<li><p>Before implementing code, configure the necessary information, including the environment information, execution mode, backend information, and hardware information.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">context</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span>
    <span class="n">mode</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">GRAPH_MODE</span><span class="p">,</span>
    <span class="n">save_graphs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">device_target</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">device_target</span><span class="p">)</span>
</pre></div>
</div>
<p>For details about the API configuration, see the <code class="docutils literal notranslate"><span class="pre">context.set_context</span></code>.</p>
</li>
</ol>
</section>
<section id="preprocessing-the-dataset">
<h3>Preprocessing the Dataset<a class="headerlink" href="#preprocessing-the-dataset" title="Permalink to this headline"></a></h3>
<p>Convert the dataset format to the MindRecord format for MindSpore to read.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">preprocess</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;============== Starting Data Pre-processing ==============&quot;</span><span class="p">)</span>
    <span class="n">convert_to_mindrecord</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">embed_size</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">aclimdb_path</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">preprocess_path</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">glove_path</span><span class="p">)</span>
</pre></div>
</div>
<blockquote>
<div><p>After successful conversion, <code class="docutils literal notranslate"><span class="pre">mindrecord</span></code> files are generated under the directory <code class="docutils literal notranslate"><span class="pre">preprocess_path</span></code>. Usually, this operation does not need to be performed every time if the dataset is unchanged.
For <code class="docutils literal notranslate"><span class="pre">convert_to_mindrecord</span></code>, you can find the complete definition at: <a class="reference external" href="https://gitee.com/mindspore/models/blob/r1.5/official/nlp/lstm/src/dataset.py">https://gitee.com/mindspore/models/blob/r1.5/official/nlp/lstm/src/dataset.py</a>.
It consists of two steps:</p>
<ol class="arabic simple">
<li><p>Process the text dataset, including encoding, word segmentation, alignment, and processing the original GloVe data to adapt to the network structure.</p></li>
<li><p>Convert the dataset format to the MindRecord format.</p></li>
</ol>
</div></blockquote>
</section>
<section id="defining-the-network">
<h3>Defining the Network<a class="headerlink" href="#defining-the-network" title="Permalink to this headline"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">embedding_table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">preprocess_path</span><span class="p">,</span> <span class="s2">&quot;weight.txt&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">device_target</span> <span class="o">==</span> <span class="s1">&#39;Ascend&#39;</span><span class="p">:</span>
    <span class="n">pad_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">embed_size</span> <span class="o">/</span> <span class="mi">16</span><span class="p">)</span> <span class="o">*</span> <span class="mi">16</span> <span class="o">-</span> <span class="n">config</span><span class="o">.</span><span class="n">embed_size</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pad_num</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">embedding_table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">embedding_table</span><span class="p">,</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pad_num</span><span class="p">)],</span> <span class="s1">&#39;constant&#39;</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">embed_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">embed_size</span> <span class="o">/</span> <span class="mi">16</span><span class="p">)</span> <span class="o">*</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">network</span> <span class="o">=</span> <span class="n">SentimentNet</span><span class="p">(</span><span class="n">vocab_size</span><span class="o">=</span><span class="n">embedding_table</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                       <span class="n">embed_size</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">embed_size</span><span class="p">,</span>
                       <span class="n">num_hiddens</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">num_hiddens</span><span class="p">,</span>
                       <span class="n">num_layers</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">num_layers</span><span class="p">,</span>
                       <span class="n">bidirectional</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">bidirectional</span><span class="p">,</span>
                       <span class="n">num_classes</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">num_classes</span><span class="p">,</span>
                       <span class="n">weight</span><span class="o">=</span><span class="n">Tensor</span><span class="p">(</span><span class="n">embedding_table</span><span class="p">),</span>
                       <span class="n">batch_size</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">batch_size</span><span class="p">)</span>
</pre></div>
</div>
<blockquote>
<div><p>For <code class="docutils literal notranslate"><span class="pre">SentimentNet</span></code>, you can find the complete definition at: <a class="reference external" href="https://gitee.com/mindspore/models/blob/r1.5/official/nlp/lstm/src/lstm.py">https://gitee.com/mindspore/models/blob/r1.5/official/nlp/lstm/src/lstm.py</a>.</p>
</div></blockquote>
</section>
<section id="pre-training">
<h3>Pre-Training<a class="headerlink" href="#pre-training" title="Permalink to this headline"></a></h3>
<p>The parameter <code class="docutils literal notranslate"><span class="pre">pre_trained</span></code> specifies the preloading CheckPoint file for pre-training, which is empty by default.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">pre_trained</span><span class="p">:</span>
    <span class="n">load_param_into_net</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">load_checkpoint</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">pre_trained</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="defining-the-optimizer-and-loss-function">
<h3>Defining the Optimizer and Loss Function<a class="headerlink" href="#defining-the-optimizer-and-loss-function" title="Permalink to this headline"></a></h3>
<p>The sample code for defining the optimizer and loss function is as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">loss</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">SoftmaxCrossEntropyWithLogits</span><span class="p">(</span><span class="n">sparse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">reduction</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
<span class="n">opt</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Momentum</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">trainable_params</span><span class="p">(),</span> <span class="n">config</span><span class="o">.</span><span class="n">learning_rate</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">momentum</span><span class="p">)</span>
<span class="n">loss_cb</span> <span class="o">=</span> <span class="n">LossMonitor</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="training-and-saving-the-model">
<h3>Training and Saving the Model<a class="headerlink" href="#training-and-saving-the-model" title="Permalink to this headline"></a></h3>
<p>Load the corresponding dataset, configure the CheckPoint generation information, and train the model using the <code class="docutils literal notranslate"><span class="pre">model.train</span></code> API.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">loss</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;acc&#39;</span><span class="p">:</span> <span class="n">Accuracy</span><span class="p">()})</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;============== Starting Training ==============&quot;</span><span class="p">)</span>
<span class="n">config_ck</span> <span class="o">=</span> <span class="n">CheckpointConfig</span><span class="p">(</span><span class="n">save_checkpoint_steps</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">save_checkpoint_steps</span><span class="p">,</span>
                             <span class="n">keep_checkpoint_max</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">keep_checkpoint_max</span><span class="p">)</span>
<span class="n">ckpoint_cb</span> <span class="o">=</span> <span class="n">ModelCheckpoint</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;lstm&quot;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">ckpt_path</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config_ck</span><span class="p">)</span>
<span class="n">time_cb</span> <span class="o">=</span> <span class="n">TimeMonitor</span><span class="p">(</span><span class="n">data_size</span><span class="o">=</span><span class="n">ds_train</span><span class="o">.</span><span class="n">get_dataset_size</span><span class="p">())</span>
<span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">device_target</span> <span class="o">==</span> <span class="s2">&quot;CPU&quot;</span><span class="p">:</span>
    <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">num_epochs</span><span class="p">,</span> <span class="n">ds_train</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">time_cb</span><span class="p">,</span> <span class="n">ckpoint_cb</span><span class="p">,</span> <span class="n">loss_cb</span><span class="p">],</span> <span class="n">dataset_sink_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">num_epochs</span><span class="p">,</span> <span class="n">ds_train</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">time_cb</span><span class="p">,</span> <span class="n">ckpoint_cb</span><span class="p">,</span> <span class="n">loss_cb</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;============== Training Success ==============&quot;</span><span class="p">)</span>
</pre></div>
</div>
<blockquote>
<div><p>For <code class="docutils literal notranslate"><span class="pre">lstm_create_dataset</span></code>, you can find the complete definition at: <a class="reference external" href="https://gitee.com/mindspore/models/blob/r1.5/official/nlp/lstm/src/dataset.py">https://gitee.com/mindspore/models/blob/r1.5/official/nlp/lstm/src/dataset.py</a>.</p>
</div></blockquote>
</section>
<section id="validating-the-model">
<h3>Validating the Model<a class="headerlink" href="#validating-the-model" title="Permalink to this headline"></a></h3>
<p>Load the validation dataset and saved CheckPoint file, perform validation, and view the model quality.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">loss</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;acc&#39;</span><span class="p">:</span> <span class="n">Accuracy</span><span class="p">(),</span> <span class="s1">&#39;recall&#39;</span><span class="p">:</span> <span class="n">Recall</span><span class="p">(),</span> <span class="s1">&#39;f1&#39;</span><span class="p">:</span> <span class="n">F1</span><span class="p">()})</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;============== Starting Testing ==============&quot;</span><span class="p">)</span>
<span class="n">param_dict</span> <span class="o">=</span> <span class="n">load_checkpoint</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">ckpt_file</span><span class="p">)</span>
<span class="n">load_param_into_net</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">param_dict</span><span class="p">)</span>
<span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">device_target</span> <span class="o">==</span> <span class="s2">&quot;CPU&quot;</span><span class="p">:</span>
    <span class="n">acc</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">ds_eval</span><span class="p">,</span> <span class="n">dataset_sink_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">acc</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">ds_eval</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;============== </span><span class="si">{}</span><span class="s2"> ==============&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">acc</span><span class="p">))</span>
</pre></div>
</div>
</section>
</section>
<section id="experimental-result">
<h2>Experimental Result<a class="headerlink" href="#experimental-result" title="Permalink to this headline"></a></h2>
<p>After 20 epochs, the accuracy on the test set is about 84.19%.</p>
<p><strong>Training Execution:</strong></p>
<ol class="arabic">
<li><p>Run the training code and view the running result.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>train.py<span class="w"> </span>--config_path<span class="o">=</span>CONFIG_FILE<span class="w"> </span>--device_target<span class="o">=</span><span class="s2">&quot;Ascend&quot;</span><span class="w"> </span>--aclimdb_path<span class="o">=</span><span class="nv">$ACLIMDB_DIR</span><span class="w"> </span>--glove_path<span class="o">=</span><span class="nv">$GLOVE_DIR</span><span class="w"> </span>--preprocess<span class="o">=</span><span class="nb">true</span><span class="w"> </span>--preprocess_path<span class="o">=</span>./preprocess<span class="w"> </span>&gt;<span class="w"> </span>log.txt<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">&amp;</span>
</pre></div>
</div>
<p>As shown in the following output, the loss value decreases gradually with the training process and reaches about 0.2855.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>============== Starting Data Pre-processing ==============
vocab_size:  252192
============== Starting Training ==============
epoch: 1 step: 1, loss is 0.6935
epoch: 1 step: 2, loss is 0.6924
...
epoch: 10 step: 389, loss is 0.2675
epoch: 10 step: 390, loss is 0.3232
...
epoch: 20 step: 389, loss is 0.1354
epoch: 20 step: 390, loss is 0.2855
</pre></div>
</div>
</li>
<li><p>Check the saved CheckPoint files.</p>
<p>CheckPoint files (model files) are saved during the training. You can view all saved files in the file path.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ls<span class="w"> </span>./ckpt_lstm/*.ckpt
</pre></div>
</div>
<p>The output is as follows:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>lstm-11_390.ckpt  lstm-12_390.ckpt  lstm-13_390.ckpt  lstm-14_390.ckpt  lstm-15_390.ckpt  lstm-16_390.ckpt  lstm-17_390.ckpt  lstm-18_390.ckpt  lstm-19_390.ckpt  lstm-20_390.ckpt
</pre></div>
</div>
</li>
</ol>
<p><strong>Model Validation:</strong></p>
<p>Use the last saved CheckPoint file to load and validate the dataset.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>eval.py<span class="w"> </span>--config_path<span class="o">=</span><span class="nv">$CONFIG_FILE</span><span class="w"> </span>--device_target<span class="o">=</span><span class="s2">&quot;Ascend&quot;</span><span class="w"> </span>--preprocess<span class="o">=</span><span class="nb">false</span><span class="w"> </span>--preprocess_path<span class="o">=</span><span class="nv">$PREPROCESS_DIR</span><span class="w"> </span>--ckpt_file<span class="o">=</span><span class="nv">$CKPT_FILE</span><span class="w"> </span>&gt;<span class="w"> </span>log.txt<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">&amp;</span>
</pre></div>
</div>
<p>Parameter interpretation:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--config_path</span></code>: The path of the parameter file, i.e. the source code <code class="docutils literal notranslate"><span class="pre">default_config.yaml</span></code> file.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--device_target</span></code>: The device used for model training, <code class="docutils literal notranslate"><span class="pre">Ascend</span></code> is selected in this article, The options are <code class="docutils literal notranslate"><span class="pre">CPU</span></code>、<code class="docutils literal notranslate"><span class="pre">GPU</span></code> and <code class="docutils literal notranslate"><span class="pre">Ascend</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--preprocess</span></code>: Preprocess data or not.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--preprocess_path</span></code>: Preprocessed dataset path.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--ckpt_file</span></code>: The path to load the model weights file. (use <code class="docutils literal notranslate"><span class="pre">./ckpt_lstm/lstm-20_390.ckpt</span></code>)</p></li>
</ul>
<p>As shown in the following output, the sentiment analysis accuracy of the text is about 84.19%, which is basically satisfactory.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>============== Starting Testing ==============
============== {&#39;acc&#39;: 0.8419471153846154} ==============
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="nlp.html" class="btn btn-neutral float-left" title="Natural Language Processing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="nlp_bert_poetry.html" class="btn btn-neutral float-right" title="Using the BERT Network to Implement Intelligent Poem Writing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, MindSpore.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 
</body>
</html>