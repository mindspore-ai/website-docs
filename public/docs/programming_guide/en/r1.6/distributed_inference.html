<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Distributed Inference &mdash; MindSpore master documentation</title>
      <link rel="stylesheet" href="_static/css/bootstrap.min.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/training.css" type="text/css" /><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/js/training.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Recomputation" href="apply_recompute.html" />
    <link rel="prev" title="Parameter Server Mode" href="apply_parameter_server_training.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> MindSpore
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Overall Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_structure.html">MindSpore API Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Design</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="design/technical_white_paper.html">Technical White Paper</a></li>
<li class="toctree-l1"><a class="reference internal" href="design/gradient.html">MindSpore Automatic Differentiation</a></li>
<li class="toctree-l1"><a class="reference internal" href="design/distributed_training_design.html">Distributed Training Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="design/mindir.html">MindSpore IR (MindIR)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.mindspore.cn/mindinsight/docs/en/r1.6/training_visual_design.html">Design of Visualization↗</a></li>
<li class="toctree-l1"><a class="reference internal" href="design/glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Quickstart</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://www.mindspore.cn/tutorials/en/r1.6/linear_regression.html">Implementing Simple Linear Function Fitting↗</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.mindspore.cn/tutorials/en/r1.6/quick_start.html">Implementing an Image Classification Application↗</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Basic Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="dtype.html">DataType</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensor.html">Tensor</a></li>
<li class="toctree-l1"><a class="reference internal" href="parameter_introduction.html">Parameter</a></li>
<li class="toctree-l1"><a class="reference internal" href="operators.html">Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="cell.html">Cell</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataset_introduction.html">Dataset</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Pipeline</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="dataset_sample.html">Quick Start of Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataset.html">Loading Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="pipeline.html">Processing Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataset_advanced.html">Advanced Usage of Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataset_usage.html">Data Iteration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Build the Network</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="build_net.html">Constructing Single Operator Network and Multi-layer Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="initializer.html">Initializer</a></li>
<li class="toctree-l1"><a class="reference internal" href="parameter.html">Network Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="control_flow.html">Using the Process Control Statement</a></li>
<li class="toctree-l1"><a class="reference internal" href="indefinite_parameter.html">Parameter Passing</a></li>
<li class="toctree-l1"><a class="reference internal" href="loss.html">Loss Function</a></li>
<li class="toctree-l1"><a class="reference internal" href="grad_operation.html">Gradient Operation</a></li>
<li class="toctree-l1"><a class="reference internal" href="constexpr.html">Construct Constants In the Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="hypermap.html">Operation Overloading</a></li>
<li class="toctree-l1"><a class="reference internal" href="optim.html">Optimization Algorithms</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Model Running</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="context.html">Configuring Running Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="run.html">Running Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="save_and_load_models.html">Save and Load Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="model.html">Application of Model</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Inference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="multi_platform_inference.html">Inference Model Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="online_inference.html">Online Inference with Checkpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="offline_inference.html">Using Offline Model for Inference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Distributed Training</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="distributed_training.html">Distributed Parallel Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="distributed_advanced.html">Distributed Parallel Advanced Features</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="apply_pipeline_parallel.html">Pipeline Parallelism</a></li>
<li class="toctree-l2"><a class="reference internal" href="apply_host_device_training.html">Host&amp;Device Heterogeneous</a></li>
<li class="toctree-l2"><a class="reference internal" href="apply_parameter_server_training.html">Parameter Server Mode</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Distributed Inference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#process-of-distributed-inference">Process of Distributed Inference</a></li>
<li class="toctree-l3"><a class="reference internal" href="#distributed-export-mindir-file-with-multi-devices">Distributed Export MindIR File With Multi Devices</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="apply_recompute.html">Recomputation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="distributed_example.html">Distributed Parallel Usage Example</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">PyNative</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="debug_in_pynative_mode.html">Debugging in PyNative Mode</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Numpy</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="numpy.html">NumPy Interfaces in MindSpore</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Function Debugging</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="read_ir_files.html">Reading IR</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.mindspore.cn/docs/programming_guide/en/r1.6/debug_in_pynative_mode.html">Debugging in PyNative Mode↗</a></li>
<li class="toctree-l1"><a class="reference internal" href="dump_in_graph_mode.html">Using Dump in the Graph Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom_debugging_info.html">Custom Debugging Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="incremental_operator_build.html">Incremental Operator Build</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Performance Optimization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="enable_mixed_precision.html">Enabling Mixed Precision</a></li>
<li class="toctree-l1"><a class="reference internal" href="enable_auto_tune.html">AutoTune</a></li>
<li class="toctree-l1"><a class="reference internal" href="enable_dataset_autotune.html">Dataset AutoTune for Dataset Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="enable_dataset_offload.html">Enabling Offload for Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="apply_gradient_accumulation.html">Gradient Accumulation Algorithm</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.mindspore.cn/mindinsight/docs/en/r1.6/performance_profiling.html">Debugging performance with Profiler↗</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Features</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="second_order_optimizer.html">Second Order Optimizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="graph_kernel_fusion.html">Graph Kernel Fusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="apply_quantization_aware_training.html">Quantization Aware Training</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Application</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="cv.html">Computer Vision</a></li>
<li class="toctree-l1"><a class="reference internal" href="nlp.html">Natural Language Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="hpc.html">High Performance Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="use_on_the_cloud.html">Using MindSpore on the Cloud</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MindSpore</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="distributed_advanced.html">Distributed Parallel Advanced Features</a> &raquo;</li>
      <li>Distributed Inference</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/distributed_inference.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="distributed-inference">
<h1>Distributed Inference<a class="headerlink" href="#distributed-inference" title="Permalink to this headline"></a></h1>
<p><code class="docutils literal notranslate"><span class="pre">Ascend</span></code> <code class="docutils literal notranslate"><span class="pre">Inference</span> <span class="pre">Application</span></code></p>
<p><a href="https://gitee.com/mindspore/docs/blob/r1.6/docs/mindspore/programming_guide/source_en/distributed_inference.md" target="_blank"><img src="https://gitee.com/mindspore/docs/raw/r1.6/resource/_static/logo_source_en.png"></a></p>
<p>Distributed inference means use multiple devices for prediction. If data parallel or integrated save is used in training, the method of distributed inference is same with the above description. It is noted that each device should load one same checkpoint file.</p>
<section id="process-of-distributed-inference">
<h2>Process of Distributed Inference<a class="headerlink" href="#process-of-distributed-inference" title="Permalink to this headline"></a></h2>
<p>This tutorial would focus on the process that the model slices are saved on each device in the distributed training process, and the model is reloaded according to the predication strategy in the inference stage. In view of the problem that there are too many parameters in the super large scale neural network model, the model can not be fully loaded into a single device for inference, so multiple devices can be used for distributed inference.</p>
<blockquote>
<div><p>Distributed inference sample code:</p>
<p><a class="reference external" href="https://gitee.com/mindspore/docs/tree/r1.6/docs/sample_code/distributed_inference">https://gitee.com/mindspore/docs/tree/r1.6/docs/sample_code/distributed_inference</a></p>
</div></blockquote>
<p>The process of distributed inference is as follows:</p>
<ol class="arabic">
<li><p>Execute training, generate the checkpoint file and the model strategy file.</p>
<blockquote>
<div><ul class="simple">
<li><p>The distributed training tutorial and sample code can be referred to the link: <a class="reference external" href="https://www.mindspore.cn/docs/programming_guide/zh-CN/r1.6/distributed_training_ascend.html">https://www.mindspore.cn/docs/programming_guide/zh-CN/r1.6/distributed_training_ascend.html</a>.</p></li>
<li><p>In the distributed Inference scenario, during the training phase, the <code class="docutils literal notranslate"><span class="pre">integrated_save</span></code> of <code class="docutils literal notranslate"><span class="pre">CheckpointConfig</span></code> interface should be set to <code class="docutils literal notranslate"><span class="pre">False</span></code>, which means that each device only saves the slice of model instead of the full model.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">parallel_mode</span></code> of <code class="docutils literal notranslate"><span class="pre">set_auto_parallel_context</span></code> interface should be set to <code class="docutils literal notranslate"><span class="pre">auto_parallel</span></code> or <code class="docutils literal notranslate"><span class="pre">semi_auto_parallel</span></code>.</p></li>
<li><p>In addition, you need to specify <code class="docutils literal notranslate"><span class="pre">strategy_ckpt_save_file</span></code> to indicate the path of the strategy file.</p></li>
<li><p>If pipeline distributed inference is used, then the pipeline parallel training also must be used. And the <code class="docutils literal notranslate"><span class="pre">device_num</span></code> and <code class="docutils literal notranslate"><span class="pre">pipeline_stages</span></code> used for pipeline training and inference must be the same.  While applying pipeline inference, <code class="docutils literal notranslate"><span class="pre">micro_size</span></code> is 1 and there is no need to use <code class="docutils literal notranslate"><span class="pre">PipelineCell</span></code>. The pipeline distributed training tutorial can be referred the link: <a class="reference external" href="https://mindspore.cn/docs/programming_guide/en/r1.6/apply_pipeline_parallel.html">https://mindspore.cn/docs/programming_guide/en/r1.6/apply_pipeline_parallel.html</a>.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Set context and infer predication strategy according to the predication data.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">context</span><span class="o">.</span><span class="n">set_auto_parallel_context</span><span class="p">(</span><span class="n">full_batch</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parallel_mode</span><span class="o">=</span><span class="s1">&#39;semi_auto_parallel&#39;</span><span class="p">,</span> <span class="n">strategy_ckpt_load_file</span><span class="o">=</span><span class="s1">&#39;./train_strategy.ckpt&#39;</span><span class="p">)</span>
<span class="n">network</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
<span class="n">predict_data</span> <span class="o">=</span> <span class="n">create_predict_data</span><span class="p">()</span>
<span class="n">predict_strategy</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">infer_predict_layout</span><span class="p">(</span><span class="n">predict_data</span><span class="p">)</span>
</pre></div>
</div>
<p>In the preceding information:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">full_batch</span></code>: whether to load the dataset in full or not. When <code class="docutils literal notranslate"><span class="pre">True</span></code>, it indicates full load, and data of each device is the same. It must be set to <code class="docutils literal notranslate"><span class="pre">True</span></code> in this scenario.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">parallel_mode</span></code>: parallel mode, it must be <code class="docutils literal notranslate"><span class="pre">auto_parallel</span></code> or <code class="docutils literal notranslate"><span class="pre">semi_auto_parallel</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">strategy_ckpt_load_file</span></code>: file path of the strategy generated in the training phase, which must be set in the distributed inference scenario.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">create_predict_data</span></code>: user-defined interface that returns predication data whose type is <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">infer_predict_layout</span></code>: generates predication strategy based on predication data.</p></li>
</ul>
</li>
<li><p>Load checkpoint files, and load the corresponding model slice into each device based on the predication strategy.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ckpt_file_list</span> <span class="o">=</span> <span class="n">create_ckpt_file_list</span><span class="p">()</span>
<span class="n">load_distributed_checkpoint</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">ckpt_file_list</span><span class="p">,</span> <span class="n">predict_strategy</span><span class="p">)</span>
</pre></div>
</div>
<p>In the preceding information:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">create_ckpt_file_list</span></code>：user-defined interface that returns a list of checkpoint file path in order of rank id.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">load_distributed_checkpoint</span></code>：merges model slices, then splits it according to the predication strategy, and loads it into the network.</p></li>
</ul>
<blockquote>
<div><p>For pipeline inference, each <code class="docutils literal notranslate"><span class="pre">stage</span></code> only needs to load the checkpoint file of self_stage.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">load_distributed_checkpoint</span></code> interface supports that predict_strategy is <code class="docutils literal notranslate"><span class="pre">None</span></code>, which is single device inference, and the process is different from distributed inference. The detailed usage can be referred to the link:
<a class="reference external" href="https://www.mindspore.cn/docs/api/zh-CN/r1.6/api_python/mindspore.html#mindspore.load_distributed_checkpoint">https://www.mindspore.cn/docs/api/zh-CN/r1.6/api_python/mindspore.html#mindspore.load_distributed_checkpoint</a>.</p>
</div></blockquote>
</li>
<li><p>Execute inference.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">predict_data</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="distributed-export-mindir-file-with-multi-devices">
<h2>Distributed Export MindIR File With Multi Devices<a class="headerlink" href="#distributed-export-mindir-file-with-multi-devices" title="Permalink to this headline"></a></h2>
<p>When the super-large-scale neural network model has too many parameters, the MindIR format model cannot be completely loaded into a single card for reasoning. Multi-card should be used for distributed reasoning. In this case, multiple MindIRs need to be exported before the reasoning task. file.
For Multi-card training and distributed reasoning, it is necessary to export MindIR files in a distributed manner. The specific methods are as follows:</p>
<p>First, you need to prepare checkpoint files and training strategy files.</p>
<p>The checkpoint file is generated during the training process. For specific usage of checkpoint, please refer to: <a class="reference external" href="https://www.mindspore.cn/docs/programming_guide/en/r1.6/save_model.html#checkpoint">checkpoint usage</a>.</p>
<p>The training strategy file needs to be generated by setting the context during training. The context configuration items are as follows:
<code class="docutils literal notranslate"><span class="pre">context.set_auto_parallel_context(strategy_ckpt_save_file='train_strategy.ckpt')</span></code></p>
<p>In this way, after training, a training strategy file named <code class="docutils literal notranslate"><span class="pre">train_strategy.ckpt</span></code> will be generated in the set directory.</p>
<p>Before exporting the MindIR file, it is necessary to load the checkpoint file, the distributed training checkpoint file, the training strategy and the reasoning strategy need to be combined, so the reasoning strategy file can be generated.
The code to generate the inference strategy is as follows:
<code class="docutils literal notranslate"><span class="pre">predict_strategy</span> <span class="pre">=</span> <span class="pre">model.infer_predict_layout(predict_data)</span></code></p>
<p>Then, use the method of loading distributed checkpoints to load the previously trained parameters to the network.
code show as below:
<code class="docutils literal notranslate"><span class="pre">load_distributed_checkpoint(model,</span> <span class="pre">ckpt_file_list,</span> <span class="pre">predict_strategy)</span></code></p>
<p>For the specific usage of <code class="docutils literal notranslate"><span class="pre">load_distributed_checkpoint</span></code>, please refer to: <a class="reference external" href="https://www.mindspore.cn/docs/programming_guide/en/r1.6/multi_platform_inference_ascend_910.html#distributed-inference-with-multi-devices">Distributed Inference</a>.</p>
<p>Finally, you can export the MindIR file in the distributed reasoning scenario.</p>
<p>The core code is as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Configure the strategy file generated during the training process in the context</span>
<span class="n">context</span><span class="o">.</span><span class="n">set_auto_parallel_context</span><span class="p">(</span><span class="n">strategy_ckpt_load_file</span><span class="o">=</span><span class="s1">&#39;train_strategy.ckpt&#39;</span><span class="p">)</span>
<span class="c1"># Define network structure</span>
<span class="n">network</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
<span class="c1"># Get the reasoning strategy file</span>
<span class="n">predict_strategy</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">infer_predict_layout</span><span class="p">(</span><span class="n">predict_data</span><span class="p">)</span>
<span class="c1"># Create checkpoint list</span>
<span class="n">ckpt_file_list</span> <span class="o">=</span> <span class="n">create_ckpt_file_list</span><span class="p">()</span>
<span class="c1"># Load distributed parameters</span>
<span class="n">load_distributed_checkpoint</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">ckpt_file_list</span><span class="p">,</span> <span class="n">predict_strategy</span><span class="p">)</span>
<span class="c1"># Export distributed MindIR file</span>
<span class="n">export</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">(</span><span class="nb">input</span><span class="p">),</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;net&#39;</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="s1">&#39;MINDIR&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>In the case of multi-card training and single-card inference, the usage of exporting MindIR is the same as that of single machine. For the usage of loading checkpoint, please refer to: <a class="reference external" href="https://www.mindspore.cn/docs/programming_guide/en/r1.6/multi_platform_inference_ascend_910.html#ascend-910-ai">Distributed Inference</a>.</p>
<blockquote>
<div><p>Distributed scene export MindIR file sample code:</p>
<p><a class="reference external" href="https://gitee.com/mindspore/docs/tree/r1.6/docs/sample_code/distributed_export">https://gitee.com/mindspore/docs/tree/r1.6/docs/sample_code/distributed_export</a></p>
</div></blockquote>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="apply_parameter_server_training.html" class="btn btn-neutral float-left" title="Parameter Server Mode" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="apply_recompute.html" class="btn btn-neutral float-right" title="Recomputation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, MindSpore.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>