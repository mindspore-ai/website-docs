<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AutoTune &mdash; MindSpore master documentation</title>
      <link rel="stylesheet" href="_static/css/bootstrap.min.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/training.css" type="text/css" /><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/js/training.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Dataset AutoTune for Dataset Pipeline" href="enable_dataset_autotune.html" />
    <link rel="prev" title="Enabling Mixed Precision" href="enable_mixed_precision.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> MindSpore
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Overall Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_structure.html">MindSpore API Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Design</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="design/technical_white_paper.html">Technical White Paper</a></li>
<li class="toctree-l1"><a class="reference internal" href="design/gradient.html">MindSpore Automatic Differentiation</a></li>
<li class="toctree-l1"><a class="reference internal" href="design/distributed_training_design.html">Distributed Training Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="design/mindir.html">MindSpore IR (MindIR)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.mindspore.cn/mindinsight/docs/en/r1.6/training_visual_design.html">Design of Visualization↗</a></li>
<li class="toctree-l1"><a class="reference internal" href="design/glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Quickstart</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://www.mindspore.cn/tutorials/en/r1.6/linear_regression.html">Implementing Simple Linear Function Fitting↗</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.mindspore.cn/tutorials/en/r1.6/quick_start.html">Implementing an Image Classification Application↗</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Basic Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="dtype.html">DataType</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensor.html">Tensor</a></li>
<li class="toctree-l1"><a class="reference internal" href="parameter_introduction.html">Parameter</a></li>
<li class="toctree-l1"><a class="reference internal" href="operators.html">Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="cell.html">Cell</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataset_introduction.html">Dataset</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Pipeline</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="dataset_sample.html">Quick Start of Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataset.html">Loading Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="pipeline.html">Processing Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataset_advanced.html">Advanced Usage of Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataset_usage.html">Data Iteration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Build the Network</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="build_net.html">Constructing Single Operator Network and Multi-layer Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="initializer.html">Initializer</a></li>
<li class="toctree-l1"><a class="reference internal" href="parameter.html">Network Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="control_flow.html">Using the Process Control Statement</a></li>
<li class="toctree-l1"><a class="reference internal" href="indefinite_parameter.html">Parameter Passing</a></li>
<li class="toctree-l1"><a class="reference internal" href="loss.html">Loss Function</a></li>
<li class="toctree-l1"><a class="reference internal" href="grad_operation.html">Gradient Operation</a></li>
<li class="toctree-l1"><a class="reference internal" href="constexpr.html">Construct Constants In the Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="hypermap.html">Operation Overloading</a></li>
<li class="toctree-l1"><a class="reference internal" href="optim.html">Optimization Algorithms</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Model Running</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="context.html">Configuring Running Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="run.html">Running Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="save_and_load_models.html">Save and Load Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="model.html">Application of Model</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Inference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="multi_platform_inference.html">Inference Model Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="online_inference.html">Online Inference with Checkpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="offline_inference.html">Using Offline Model for Inference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Distributed Training</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="distributed_training.html">Distributed Parallel Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed_advanced.html">Distributed Parallel Advanced Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed_example.html">Distributed Parallel Usage Example</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">PyNative</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="debug_in_pynative_mode.html">Debugging in PyNative Mode</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Numpy</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="numpy.html">NumPy Interfaces in MindSpore</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Function Debugging</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="read_ir_files.html">Reading IR</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.mindspore.cn/docs/programming_guide/en/r1.6/debug_in_pynative_mode.html">Debugging in PyNative Mode↗</a></li>
<li class="toctree-l1"><a class="reference internal" href="dump_in_graph_mode.html">Using Dump in the Graph Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom_debugging_info.html">Custom Debugging Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="incremental_operator_build.html">Incremental Operator Build</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Performance Optimization</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="enable_mixed_precision.html">Enabling Mixed Precision</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">AutoTune</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tunemode">TuneMode</a></li>
<li class="toctree-l2"><a class="reference internal" href="#environmentvariables">EnvironmentVariables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#enablingtune">EnablingTune</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tuningresult">TuningResult</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mergeknowledgebase">MergeKnowledgeBase</a></li>
<li class="toctree-l2"><a class="reference internal" href="#notice">Notice</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="enable_dataset_autotune.html">Dataset AutoTune for Dataset Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="enable_dataset_offload.html">Enabling Offload for Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="apply_gradient_accumulation.html">Gradient Accumulation Algorithm</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.mindspore.cn/mindinsight/docs/en/r1.6/performance_profiling.html">Debugging performance with Profiler↗</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Features</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="second_order_optimizer.html">Second Order Optimizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="graph_kernel_fusion.html">Graph Kernel Fusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="apply_quantization_aware_training.html">Quantization Aware Training</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Application</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="cv.html">Computer Vision</a></li>
<li class="toctree-l1"><a class="reference internal" href="nlp.html">Natural Language Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="hpc.html">High Performance Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="use_on_the_cloud.html">Using MindSpore on the Cloud</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MindSpore</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>AutoTune</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/enable_auto_tune.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="autotune">
<h1>AutoTune<a class="headerlink" href="#autotune" title="Permalink to this headline"></a></h1>
<p><code class="docutils literal notranslate"><span class="pre">Ascend</span></code> <code class="docutils literal notranslate"><span class="pre">Model</span> <span class="pre">Optimization</span></code></p>
<p><a href="https://gitee.com/mindspore/docs/blob/r1.6/docs/mindspore/programming_guide/source_en/enable_auto_tune.md" target="_blank"><img src="https://gitee.com/mindspore/docs/raw/r1.6/resource/_static/logo_source_en.png"></a>  </p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline"></a></h2>
<p>AutoTune is a tool that uses hardware resources and automatically tune the performance of TBE operators. Comparing with manually debugging the performance of operator, it takes less time and labor cost, and a model with better performance can be obtained. This document mainly introduces how to use the AutoTune tool to Online tune. The detail guidelines about the AutoTune framework, function description, and the fault handling can be got in <a class="reference external" href="https://support.huawei.com/enterprise/en/doc/EDOC1100206689/31d1d888/about-this-document">AutoTune Guides</a>.</p>
</section>
<section id="tunemode">
<h2>TuneMode<a class="headerlink" href="#tunemode" title="Permalink to this headline"></a></h2>
<p>The AutoTune tool includes <code class="docutils literal notranslate"><span class="pre">RL</span></code> and <code class="docutils literal notranslate"><span class="pre">GA</span></code> tuning modes. The<code class="docutils literal notranslate"><span class="pre">RL</span></code>tuning mode mainly supports<code class="docutils literal notranslate"><span class="pre">broadcast</span></code>,<code class="docutils literal notranslate"><span class="pre">reduce</span></code>, and<code class="docutils literal notranslate"><span class="pre">elewise</span></code>operators. The<code class="docutils literal notranslate"><span class="pre">GA</span></code>tuning mode mainly supports<code class="docutils literal notranslate"><span class="pre">cube</span></code>operators. The more information about the GA, RL, and the operators supported by the two tune mode can be got in <a class="reference external" href="https://support.huawei.com/enterprise/en/doc/EDOC1100206689/41bb2c07">Tune Mode</a> and <a class="reference external" href="https://support.huawei.com/enterprise/en/doc/EDOC1100206689/74e08a9c/operator-list">Operators</a>.</p>
</section>
<section id="environmentvariables">
<h2>EnvironmentVariables<a class="headerlink" href="#environmentvariables" title="Permalink to this headline"></a></h2>
<p>When using the AutoTune tool to tune the operators, some environment variables need to be configured (Required).</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run package installation directory</span>
<span class="nv">LOCAL_ASCEND</span><span class="o">=</span>/usr/local/Ascend
<span class="c1"># Run package startup depends path</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="si">${</span><span class="nv">LOCAL_ASCEND</span><span class="si">}</span>/fwkacllib/lib64:<span class="nv">$LD_LIBRARY_PATH</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="si">${</span><span class="nv">LOCAL_ASCEND</span><span class="si">}</span>/fwkacllib/ccec_compiler/bin:<span class="si">${</span><span class="nv">LOCAL_ASCEND</span><span class="si">}</span>/fwkacllib/bin:<span class="nv">$PATH</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">PYTHONPATH</span><span class="o">=</span><span class="si">${</span><span class="nv">LOCAL_ASCEND</span><span class="si">}</span>/fwkacllib/python/site-packages:<span class="nv">$PYTHONPATH</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">ASCEND_OPP_PATH</span><span class="o">=</span><span class="si">${</span><span class="nv">LOCAL_ASCEND</span><span class="si">}</span>/opp

<span class="c1"># Offline tuning environment variables</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">ENABLE_TUNE_DUMP</span><span class="o">=</span>True
</pre></div>
</div>
<p>Try to find the detailed description of environment variables, or other optional environment variables descriptions in <a class="reference external" href="https://support.huawei.com/enterprise/en/doc/EDOC1100206689/3f0a50ba/environment-variable-configuration">Environment Variable</a>.</p>
</section>
<section id="enablingtune">
<h2>EnablingTune<a class="headerlink" href="#enablingtune" title="Permalink to this headline"></a></h2>
<p>The AutoTune tool supports two tuning modes, <code class="docutils literal notranslate"><span class="pre">Online</span> <span class="pre">tune</span></code> and <code class="docutils literal notranslate"><span class="pre">Offline</span> <span class="pre">Tune</span></code>.</p>
<ol class="arabic simple">
<li><p>Online Tune</p></li>
</ol>
<p>Set <code class="docutils literal notranslate"><span class="pre">auto_tune_mode</span></code> in context to turn on Online tune. The value of <code class="docutils literal notranslate"><span class="pre">auto_tune_mode</span></code> should be in <code class="docutils literal notranslate"><span class="pre">[&quot;NO_TUNE&quot;,</span> <span class="pre">&quot;RL&quot;,</span> <span class="pre">&quot;GA&quot;,</span> <span class="pre">&quot;RL,GA&quot;]</span></code>.</p>
<p>NO_TUNE: turn off tune.</p>
<p>RL: turn on RL tune.</p>
<p>GA: turn on GA tune.</p>
<p>RL,GA: turn on GA and RL at the same time, the tool will select RL or GA automatically according to different types of operators which are used in the network.</p>
<p>Example of online tuning:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore.context</span> <span class="k">as</span> <span class="nn">context</span>
<span class="n">context</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">GRAPH_MODE</span><span class="p">,</span> <span class="n">device_target</span><span class="o">=</span><span class="s2">&quot;Ascend&quot;</span><span class="p">,</span> <span class="n">auto_tune_mode</span><span class="o">=</span><span class="s2">&quot;GA,RL&quot;</span><span class="p">)</span>
<span class="o">....</span>
</pre></div>
</div>
<p>After setting the above context, you can start the tuning according to the normal execution of the training script. During the execution of the use case, no operation is required. The result of the model is the result after tuning.</p>
<ol class="arabic simple" start="2">
<li><p>Offline Tune</p></li>
</ol>
<p>The Offline Tune is using the dump data (The output description file, and the binary file of operators) of network model (Generate when training network) to tune the operators. The method of Offline Tune and related environment variables can be found in <a class="reference external" href="https://support.huawei.com/enterprise/en/doc/EDOC1100206689/2fa72dd0">Offline Tune</a> in <code class="docutils literal notranslate"><span class="pre">CANN</span></code> development tool guide, which is not described here.</p>
</section>
<section id="tuningresult">
<h2>TuningResult<a class="headerlink" href="#tuningresult" title="Permalink to this headline"></a></h2>
<p>After the tuning starts, a file named <code class="docutils literal notranslate"><span class="pre">tune_result_{timestamp}_pidxxx.json</span></code> will be generated in the working directory to record the tuning process and tuning results. Please refer to <a class="reference external" href="https://support.huawei.com/enterprise/en/doc/EDOC1100206689/b6ae7c6a">tuning result file analysis</a> for specific analysis of this file.</p>
<p>After the tuning is complete. The custom knowledge base will be generated if the conditions are met. If the <code class="docutils literal notranslate"><span class="pre">TUNE_BANK_PATH</span></code>(Environment variable of the knowledge base storage path) is specified, the knowledge base(generated after tuning) will be saved in the specified directory. Otherwise, the knowledge base will be in the following default path. Please refer to <a class="reference external" href="https://support.huawei.com/enterprise/en/doc/EDOC1100206689/b6ae7c6a">Custom knowledge base</a> for the storage path.</p>
</section>
<section id="mergeknowledgebase">
<h2>MergeKnowledgeBase<a class="headerlink" href="#mergeknowledgebase" title="Permalink to this headline"></a></h2>
<p>After operator tuning, the generated tuning knowledge base supports merging, which is convenient for re-executing, or the other models.(Only the same Ascend AI Processor can be merged). The more specific merging methods can be found in <a class="reference external" href="https://support.huawei.com/enterprise/en/doc/EDOC1100206689/c1a94cfc/repository-merging">merging knowledge base</a>.</p>
</section>
<section id="notice">
<h2>Notice<a class="headerlink" href="#notice" title="Permalink to this headline"></a></h2>
<p>Pay attention to the following points when using the AutoTune tool:</p>
<ol class="arabic simple">
<li><p>The AutoTune tool can only be used on <code class="docutils literal notranslate"><span class="pre">Ascend</span></code> platform.</p></li>
<li><p>Ensure that the available disk space in the home directory of the user who performs tuning in the operating environment is at least 20 GB.</p></li>
<li><p>The AutoTune tool depends on some third-party software, For example: <code class="docutils literal notranslate"><span class="pre">TensorFlow</span></code> and <code class="docutils literal notranslate"><span class="pre">pciutils</span></code>. Get more information about the <a class="reference external" href="https://support.huawei.com/enterprise/en/doc/EDOC1100206689/480d602c/environment-setup">Depends</a>.</p></li>
<li><p>The AutoTune tool can not support all TBE operators, and can not guarantee the operator will have a performance benefit after tune (The operator has reached the best performance after multi-networks and multi-debugging manually).</p></li>
<li><p>After the tuning tool is turned on, it is obvious that the compilation time of the perception operator becomes longer.</p></li>
</ol>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="enable_mixed_precision.html" class="btn btn-neutral float-left" title="Enabling Mixed Precision" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="enable_dataset_autotune.html" class="btn btn-neutral float-right" title="Dataset AutoTune for Dataset Pipeline" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, MindSpore.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>