<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Using the BERT Network to Implement Intelligent Poem Writing &mdash; MindSpore master documentation</title><script>;(()=>{const e=localStorage.getItem("ms-theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;(e?"dark"===e:t)&&document.documentElement.setAttribute("data-o-theme","dark")})();</script>
      
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script><script src="_static/jquery.js"></script>
        <script src="_static/js/theme.js"></script><script src="_static/underscore.js"></script><script src="_static/doctools.js"></script><script crossorigin="anonymous" integrity="sha256-1fEPhSsRKlFKGfK3eO710tEweHh1fwokU5wFGDHO+vg=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Multi-hop Knowledge Reasoning Question-answering Model TPRR" href="nlp_tprr.html" />
    <link rel="prev" title="Realizing Sentiment Classification With SentimentNet" href="nlp_sentimentnet.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> MindSpore
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Overall Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_structure.html">MindSpore API Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Design</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="design/technical_white_paper.html">Technical White Paper</a></li>
<li class="toctree-l1"><a class="reference internal" href="design/gradient.html">MindSpore Automatic Differentiation</a></li>
<li class="toctree-l1"><a class="reference internal" href="design/distributed_training_design.html">Distributed Training Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="design/mindir.html">MindSpore IR (MindIR)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.mindspore.cn/mindinsight/docs/en/r1.6/training_visual_design.html">Design of Visualization↗</a></li>
<li class="toctree-l1"><a class="reference internal" href="design/glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Quickstart</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://www.mindspore.cn/tutorials/en/r1.6/linear_regression.html">Implementing Simple Linear Function Fitting↗</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.mindspore.cn/tutorials/en/r1.6/quick_start.html">Implementing an Image Classification Application↗</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Basic Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="dtype.html">DataType</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensor.html">Tensor</a></li>
<li class="toctree-l1"><a class="reference internal" href="parameter_introduction.html">Parameter</a></li>
<li class="toctree-l1"><a class="reference internal" href="operators.html">Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="cell.html">Cell</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataset_introduction.html">Dataset</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Pipeline</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="dataset_sample.html">Quick Start of Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataset.html">Loading Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="pipeline.html">Processing Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataset_advanced.html">Advanced Usage of Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataset_usage.html">Data Iteration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Build the Network</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="build_net.html">Constructing Single Operator Network and Multi-layer Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="initializer.html">Initializer</a></li>
<li class="toctree-l1"><a class="reference internal" href="parameter.html">Network Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="control_flow.html">Using the Process Control Statement</a></li>
<li class="toctree-l1"><a class="reference internal" href="indefinite_parameter.html">Parameter Passing</a></li>
<li class="toctree-l1"><a class="reference internal" href="loss.html">Loss Function</a></li>
<li class="toctree-l1"><a class="reference internal" href="grad_operation.html">Gradient Operation</a></li>
<li class="toctree-l1"><a class="reference internal" href="constexpr.html">Construct Constants In the Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="hypermap.html">Operation Overloading</a></li>
<li class="toctree-l1"><a class="reference internal" href="optim.html">Optimization Algorithms</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Model Running</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="context.html">Configuring Running Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="run.html">Running Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="save_and_load_models.html">Save and Load Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="model.html">Application of Model</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Inference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="multi_platform_inference.html">Inference Model Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="online_inference.html">Online Inference with Checkpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="offline_inference.html">Using Offline Model for Inference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Distributed Training</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="distributed_training.html">Distributed Parallel Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed_advanced.html">Distributed Parallel Advanced Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed_example.html">Distributed Parallel Usage Example</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">PyNative</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="debug_in_pynative_mode.html">Debugging in PyNative Mode</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Numpy</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="numpy.html">NumPy Interfaces in MindSpore</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Function Debugging</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="read_ir_files.html">Reading IR</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.mindspore.cn/docs/programming_guide/en/r1.6/debug_in_pynative_mode.html">Debugging in PyNative Mode↗</a></li>
<li class="toctree-l1"><a class="reference internal" href="dump_in_graph_mode.html">Using Dump in the Graph Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom_debugging_info.html">Custom Debugging Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="incremental_operator_build.html">Incremental Operator Build</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Performance Optimization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="enable_mixed_precision.html">Enabling Mixed Precision</a></li>
<li class="toctree-l1"><a class="reference internal" href="enable_auto_tune.html">AutoTune</a></li>
<li class="toctree-l1"><a class="reference internal" href="enable_dataset_autotune.html">Dataset AutoTune for Dataset Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="enable_dataset_offload.html">Enabling Offload for Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="apply_gradient_accumulation.html">Gradient Accumulation Algorithm</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.mindspore.cn/mindinsight/docs/en/r1.6/performance_profiling.html">Debugging performance with Profiler↗</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Features</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="second_order_optimizer.html">Second Order Optimizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="graph_kernel_fusion.html">Graph Kernel Fusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="apply_quantization_aware_training.html">Quantization Aware Training</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Application</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="cv.html">Computer Vision</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="nlp.html">Natural Language Processing</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="nlp_sentimentnet.html">Realizing Sentiment Classification With SentimentNet</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Using the BERT Network to Implement Intelligent Poem Writing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#case-overview">Case Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#model-description">Model Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#model-training">Model Training</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#pre-training">Pre-training</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fine-tuning">Fine-tuning</a></li>
<li class="toctree-l4"><a class="reference internal" href="#modifying-a-model">Modifying a Model</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#sample-code">Sample Code</a></li>
<li class="toctree-l3"><a class="reference internal" href="#implementation-procedure">Implementation Procedure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#basic-information">Basic Information</a></li>
<li class="toctree-l4"><a class="reference internal" href="#data-preparation">Data Preparation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#training">Training</a></li>
<li class="toctree-l4"><a class="reference internal" href="#inference-validation">Inference Validation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#service-deployment">Service Deployment</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="nlp_tprr.html">Multi-hop Knowledge Reasoning Question-answering Model TPRR</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="hpc.html">High Performance Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="use_on_the_cloud.html">Using MindSpore on the Cloud</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MindSpore</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="nlp.html">Natural Language Processing</a> &raquo;</li>
      <li>Using the BERT Network to Implement Intelligent Poem Writing</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/nlp_bert_poetry.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="using-the-bert-network-to-implement-intelligent-poem-writing">
<h1>Using the BERT Network to Implement Intelligent Poem Writing<a class="headerlink" href="#using-the-bert-network-to-implement-intelligent-poem-writing" title="Permalink to this headline"></a></h1>
<p><code class="docutils literal notranslate"><span class="pre">Ascend</span></code> <code class="docutils literal notranslate"><span class="pre">Natural</span> <span class="pre">Language</span> <span class="pre">Processing</span></code> <code class="docutils literal notranslate"><span class="pre">Whole</span> <span class="pre">Process</span></code></p>
<p><a class="reference external" href="https://gitee.com/mindspore/docs/blob/r1.6/docs/mindspore/programming_guide/source_en/nlp_bert_poetry.md"><img alt="View Source On Gitee" src="https://gitee.com/mindspore/docs/raw/r1.6/resource/_static/logo_source_en.png" /></a></p>
<p>Poetry is an indispensable part of the five-millennium-old Chinese culture. When appreciating poetry, you can perceive the pure and vast world with ultimate sensibility and reduce stress and anxiety brought by the fast-paced world. As we know, one has to practice a skill a lot to become good at it. Today, let’s see how the science-backed MindSpore trains a model to show its sense of arts!</p>
<section id="case-overview">
<h2>Case Overview<a class="headerlink" href="#case-overview" title="Permalink to this headline"></a></h2>
<p>Use MindSpore to train an intelligent poem writing model and deploy the prediction service. The following flowchart shows the process:</p>
<p><img alt="introduce image" src="_images/introduce.PNG" /></p>
<p><em>Figure 1: Case flowchart</em></p>
<p>The following skips the process of pre-training BERT and directly describes the process of fine-tuning a pre-trained BERT-base model of MindSpore.</p>
</section>
<section id="model-description">
<h2>Model Description<a class="headerlink" href="#model-description" title="Permalink to this headline"></a></h2>
<p>NLP-related networks are required to deal with poems. BERT, as a milestone model in the NLP domain, greatly promotes the development of the NLP community. The BERT model is proposed by Google and uses the Encoder structure in Transformer. It stacks multiple layers of Encoders and uses the attention mechanism to achieve the state of the art (SOTA) effect in multiple general language understanding evaluation (GLUE) tasks.</p>
<p>This attention mechanism is different from the RNN structure and can be used for high-level parallel computing. In this way, the computing power of the Ascend 910 AI Processor can be fully utilized to achieve optimal performance.</p>
</section>
<section id="model-training">
<h2>Model Training<a class="headerlink" href="#model-training" title="Permalink to this headline"></a></h2>
<p>There are two steps: pre-training and fine-tuning. Pre-training is first performed on a large amount of unlabeled data. It is expected that the model can master a common human language semantic mechanism through this process. Then, in the fine-tuning phase, training is performed on labeled data in a specific segmented domain to complete a specific task.</p>
<section id="pre-training">
<h3>Pre-training<a class="headerlink" href="#pre-training" title="Permalink to this headline"></a></h3>
<p>Pre-training is self-coding training performed on unlabeled data. Therefore, the design of training tasks is especially important. Pre-training in BERT includes two tasks: masked language model (MLM) and next sentence prediction (NSP).</p>
<ul class="simple">
<li><p>The <strong>MLM task</strong> randomly replaces some tokens with the [MASK] labels during input, and then predicts the original tokens based on the context through the attention mechanism.</p></li>
<li><p>The input of a BERT model is two sentences: A and B. When data is built, positions of A and B are randomly exchanged at a 50% probability. The <strong>NSP task</strong> is used to predict whether A and B are originally connected.</p></li>
</ul>
<p>Since the MLM task does not exist in the actual task, a pre-training NSP task that better matches the actual task type is added based on the MLM task.</p>
<p>In the preceding description, the pre-training process does not require a task data label. Such an MLM training task is essentially a denoising self-coding model. Therefore, BERT may perform pre-training by using massive unlabeled data. Through tasks set in the pre-training stage, BERT can learn basic semantic logic from unlabeled data and then complete specific task training in cooperation with the fine-tuning process.</p>
<p>The following figure shows the BERT model structure. If you enter two sentences in a Chinese model, each token corresponds to a Chinese character. [CLS] and [SEP] are inserted special tokens.</p>
<p><img alt="Teaser image" src="_images/bert_model.PNG" /></p>
<p><em>Figure 2: BERT model structure [1]</em></p>
</section>
<section id="fine-tuning">
<h3>Fine-tuning<a class="headerlink" href="#fine-tuning" title="Permalink to this headline"></a></h3>
<p>Fine-tuning is used to add a layer of adaptation task to the end of the pre-trained BERT model and then perform a small amount of training on labeled data.</p>
<p>Fine-tuning modes are classified into two types: end-to-end fine-tuning and feature-based approach. The difference between the two modes lies in whether to modify parameters in the pre-trained BERT model at the fine-tuning stage. In most cases, end-to-end fine-tuning is used.</p>
</section>
<section id="modifying-a-model">
<h3>Modifying a Model<a class="headerlink" href="#modifying-a-model" title="Permalink to this headline"></a></h3>
<p>BERT uses the Encoder structure. <code class="docutils literal notranslate"><span class="pre">attention_mask</span></code> is an all-ones vector. That is, each token can view tokens before and after it. This helps each token learn the entire sentence information and enhance the semantic understanding capability, therefore, BERT is not a generative model.</p>
<p>In the statement generation task, when the next token is generated, only the information about the previous token can be viewed. You need to change <code class="docutils literal notranslate"><span class="pre">attention_mask</span></code> to the lower triangular matrix so that the current token can view only the information about itself and the previous token.</p>
<p>The data used for fine-tuning is more than 40,000 poems without labels. The output of each token must be close to the output of the next labeled token, and the cross entropy is used as the loss function.</p>
<p><img alt="Teaser image" src="_images/finetune.PNG" /></p>
<p><em>Figure 3 Training process</em></p>
</section>
</section>
<section id="sample-code">
<h2>Sample Code<a class="headerlink" href="#sample-code" title="Permalink to this headline"></a></h2>
<p>Download the <a class="reference external" href="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com:443/DemoCode/bert_poetry_c.rar">sample code</a> and run the sample code to view the poem writing effect. The code structure is as follows:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>└─bert_poetry
  ├── src
    ├── bert_for_pre_training.py           # Encapsulating BERT-base forward and backward network class
    ├── bert_model.py                      # Defining the BERT forward network structure
    ├── finetune_config.py                 # Fine-tuning configuration file
    ├── fused_layer_norm.py                # Defining fused_layer_norm
    ├── __init__.py                        # __init__
    ├── utils.py                           # Defining the fine-tuning forward network structure
    ├── poetry_utils.py                    # Tokenizer
    └── poetry_dataset.py                  # Parsing poetry.txt and generating the required dataset
  ├── serving
    ├── bert
      ├── 1
        ├── poetry.mindir                  # exported MindIR file
      ├── servable_config.py               # Serving inference script
    ├── poetry_client.py                   # Serving client script
    ├── serving_server.py                  # Serving server script
  ├── vocab.txt                            # Vocabulary
  ├── generator.py                         # Function used for generating poems during inference
  ├── poetry.py                            # Training, inference, and export functions
</pre></div>
</div>
</section>
<section id="implementation-procedure">
<h2>Implementation Procedure<a class="headerlink" href="#implementation-procedure" title="Permalink to this headline"></a></h2>
<section id="basic-information">
<h3>Basic Information<a class="headerlink" href="#basic-information" title="Permalink to this headline"></a></h3>
<p>Perform training and inference on the Ascend 910 AI Processor using MindSpore 0.7.0-beta.</p>
</section>
<section id="data-preparation">
<h3>Data Preparation<a class="headerlink" href="#data-preparation" title="Permalink to this headline"></a></h3>
<p>A dataset containing <a class="reference external" href="https://github.com/AaronJny/DeepLearningExamples/tree/master/keras-bert-poetry-generator">43030 poems</a>: <code class="docutils literal notranslate"><span class="pre">poetry.txt</span></code>.</p>
<p>Pre-trained checkpoints of a BERT-base model: <a class="reference external" href="https://www.mindspore.cn/resources/hub/details/en?MindSpore/ascend/1.0/bert_base_v1.0_cn-wiki">Download from MindSpore</a>.</p>
</section>
<section id="training">
<h3>Training<a class="headerlink" href="#training" title="Permalink to this headline"></a></h3>
<p>Modify the <code class="docutils literal notranslate"><span class="pre">pre_training_ckpt</span></code> path in <code class="docutils literal notranslate"><span class="pre">src/finetune_config.py</span></code>, load pre-trained checkpoints, set <code class="docutils literal notranslate"><span class="pre">batch_size</span></code> to bs, and set <code class="docutils literal notranslate"><span class="pre">dataset_path</span></code> to the path for storing poems. <code class="docutils literal notranslate"><span class="pre">BertConfig</span></code> is set to the base model by default.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&#39;dataset_path&#39;: &#39;/your/path/to/poetry.txt&#39;,
&#39;batch_size&#39;: bs,
&#39;pre_training_ckpt&#39;: &#39;/your/path/to/pre_training_ckpt&#39;,
</pre></div>
</div>
<p>Run the training command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>poetry.py
</pre></div>
</div>
</section>
<section id="inference-validation">
<h3>Inference Validation<a class="headerlink" href="#inference-validation" title="Permalink to this headline"></a></h3>
<p>Modify the <code class="docutils literal notranslate"><span class="pre">test_eval</span></code> function in <code class="docutils literal notranslate"><span class="pre">poetry.py</span></code> to randomly generate a poem, continue to complete a poem, or generate an acrostic poem.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">generate_random_poetry</span></code> function is used to randomly generate and continue to complete a poem. If the input parameter <code class="docutils literal notranslate"><span class="pre">s</span></code> is empty, a poem is randomly generated. If the input parameter <code class="docutils literal notranslate"><span class="pre">s</span></code> is not empty, the poem writing continues based on the input value.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">output</span> <span class="o">=</span> <span class="n">generate_random_poetry</span><span class="p">(</span><span class="n">poetrymodel</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>         <span class="c1">#随机生成</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">generate_random_poetry</span><span class="p">(</span><span class="n">poetrymodel</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="s1">&#39;天下为公&#39;</span><span class="p">)</span>  <span class="c1">#续写诗句</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">generate_hidden</span></code> function is used to generate an acrostic poem. The value of the input parameter <code class="docutils literal notranslate"><span class="pre">head</span></code> is the first word in each line of a poem.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">output</span> <span class="o">=</span> <span class="n">generate_hidden</span><span class="p">(</span><span class="n">poetrymodel</span><span class="p">,</span> <span class="n">head</span><span class="o">=</span><span class="s2">&quot;人工智能&quot;</span><span class="p">)</span>  <span class="c1">#藏头诗</span>
</pre></div>
</div>
<p>Run the inference command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>poetry.py<span class="w"> </span>--train<span class="o">=</span>False<span class="w">  </span>--ckpt_path<span class="o">=</span>/your/ckpt/path
</pre></div>
</div>
<p>By default, a randomly generated poem, a poem completed based on the input value, and an acrostic poem are generated in the script. The output poems are as follows:</p>
<p>A randomly generated poem:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>大堤柳暗，
春深树根。
东望一望，
断回还家。
山色渐风雨，
东风多雨禾。
无情与去，
万里所思。
</pre></div>
</div>
<p>A poem completed based on the input value:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>天下为公少，
唯君北向西。
远山无路见，
长水见人偏。
一路巴猿啸，
千峰楚客啼。
幽深有诗策，
无以话年华。
</pre></div>
</div>
<p>An acrostic poem:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>人君离别难堪望，
工部张机自少年。
智士不知身没处，
能令圣德属何年。
</pre></div>
</div>
</section>
<section id="service-deployment">
<h3>Service Deployment<a class="headerlink" href="#service-deployment" title="Permalink to this headline"></a></h3>
<p>Use MindSpore Serving to deploy the trained model as an inference service. Server-side deployment includes the following three steps: model export, Serving server startup, Serving client startup. The processor utilizes Serving service for inference and the generated poem will be sent back to the client. Notice, you need to startup Serving server before Serving client.</p>
<ul>
<li><p>Model export</p>
<p>Before using Serving to deploy a service, export the MindIR model using <code class="docutils literal notranslate"><span class="pre">export_net</span></code> function provided in <code class="docutils literal notranslate"><span class="pre">poetry.py</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>poetry.py<span class="w"> </span>--export<span class="o">=</span>True<span class="w"> </span>--ckpt_path<span class="o">=</span>/your/ckpt/path
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">poetry.mindir</span></code> file is generated in the path of <code class="docutils literal notranslate"><span class="pre">serving/bert/1</span></code>.</p>
</li>
<li><p>Serving server startup</p>
<p>Start Serving server and load the exported MindIR file.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>serving
python<span class="w"> </span>serving_server.py
</pre></div>
</div>
</li>
<li><p>Serving client startup</p>
<p>Start Serving client and send inference request.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>serving
python<span class="w"> </span>poetry_client.py
</pre></div>
</div>
<p>Select a certain mode and the inference will be called through Serving. The generated poem will be displayed on the client.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>选择模式： 0-随机生成，1：续写，2：藏头诗
</pre></div>
</div>
</li>
</ul>
</section>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline"></a></h2>
<p>[1] <a class="reference external" href="https://arxiv.org/abs/1810.04805">BERT:Pre-training of Deep Bidirectional Transformers for Language Understanding</a></p>
<p>[2] <a class="reference external" href="https://github.com/AaronJny/DeepLearningExamples/">https://github.com/AaronJny/DeepLearningExamples/</a></p>
<p>[3] <a class="reference external" href="https://github.com/bojone/bert4keras">https://github.com/bojone/bert4keras</a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="nlp_sentimentnet.html" class="btn btn-neutral float-left" title="Realizing Sentiment Classification With SentimentNet" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="nlp_tprr.html" class="btn btn-neutral float-right" title="Multi-hop Knowledge Reasoning Question-answering Model TPRR" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright MindSpore.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 
</body>
</html>