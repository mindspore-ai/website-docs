<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>静态图语法支持 &mdash; MindSpore master 文档</title><script>;(()=>{const e=localStorage.getItem("ms-theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;(e?"dark"===e:t)&&document.documentElement.setAttribute("data-o-theme","dark")})();</script>
      <link rel="stylesheet" href="../_static/css/bootstrap.min.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/training.css" type="text/css" /><link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script><script src="../_static/jquery.js"></script>
        <script src="../_static/js/theme.js"></script><script src="../_static/underscore.js"></script><script src="../_static/doctools.js"></script><script src="../_static/js/training.js"></script><script src="../_static/translations.js"></script><script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="静态图语法-运算符" href="static_graph_syntax/operators.html" />
    <link rel="prev" title="TensorFlow模型转换MindSpore模型的方法" href="../migration_guide/tensorflow2mindspore.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> MindSpore
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="在文档中搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">设计</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../design/overview.html">MindSpore设计概览</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/programming_paradigm.html">函数式和对象式融合编程范式</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/all_scenarios.html">全场景统一架构</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/dynamic_graph_and_static_graph.html">动静态图结合</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/pluggable_device.html">三方硬件对接</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/distributed_training_design.html">原生分布式并行架构</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/graph_fusion_engine.html">图算融合加速引擎</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/data_engine.html">高性能数据处理引擎</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/glossary.html">术语</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">模型库</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="official_models.html">官方模型库</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api_python/mindspore.html">mindspore</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_python/mindspore.nn.html">mindspore.nn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_python/mindspore.ops.html">mindspore.ops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_python/mindspore.ops.primitive.html">mindspore.ops.primitive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_python/mindspore.amp.html">mindspore.amp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_python/mindspore.train.html">mindspore.train</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_python/mindspore.communication.html">mindspore.communication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_python/mindspore.common.initializer.html">mindspore.common.initializer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_python/mindspore.dataset.html">mindspore.dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_python/mindspore.dataset.transforms.html">mindspore.dataset.transforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_python/mindspore.mindrecord.html">mindspore.mindrecord</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_python/mindspore.nn.probability.html">mindspore.nn.probability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_python/mindspore.rewrite.html">mindspore.rewrite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_python/mindspore.boost.html">mindspore.boost</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_python/mindspore.numpy.html">mindspore.numpy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_python/mindspore.scipy.html">mindspore.scipy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_python/mindspore.experimental.html">mindspore.experimental</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API映射</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api_mapping/pytorch_api_mapping.html">PyTorch与MindSpore API映射表</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">迁移指南</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../migration_guide/overview.html">迁移指南概述</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration_guide/enveriment_preparation.html">环境准备与资料获取</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration_guide/analysis_and_preparation.html">模型分析与准备</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration_guide/typical_api_comparision.html">PyTorch对比</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration_guide/model_development/model_development.html">MindSpore网络搭建</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration_guide/debug_and_tune.html">调试调优</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration_guide/sample_code.html">网络迁移调试实例</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration_guide/migrator_with_tools.html">网络迁移工具应用实践指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration_guide/faq.html">常见问题</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">语法支持</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">静态图语法支持</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#概述">概述</a></li>
<li class="toctree-l2"><a class="reference internal" href="#基础语法strict级别">基础语法（STRICT级别）</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#静态图内的常量与变量">静态图内的常量与变量</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#常量产生场景">常量产生场景</a></li>
<li class="toctree-l4"><a class="reference internal" href="#变量产生场景">变量产生场景</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#数据类型">数据类型</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#python内置数据类型">Python内置数据类型</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mindspore自定义数据类型">MindSpore自定义数据类型</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#运算符">运算符</a></li>
<li class="toctree-l3"><a class="reference internal" href="#原型">原型</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#属性引用与修改">属性引用与修改</a></li>
<li class="toctree-l4"><a class="reference internal" href="#索引取值">索引取值</a></li>
<li class="toctree-l4"><a class="reference internal" href="#调用">调用</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#语句">语句</a></li>
<li class="toctree-l3"><a class="reference internal" href="#python内置函数">Python内置函数</a></li>
<li class="toctree-l3"><a class="reference internal" href="#网络定义">网络定义</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#网络入参">网络入参</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#基础语法的语法约束">基础语法的语法约束</a></li>
<li class="toctree-l2"><a class="reference internal" href="#扩展语法lax级别">扩展语法（LAX级别）</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#调用第三方库">调用第三方库</a></li>
<li class="toctree-l3"><a class="reference internal" href="#支持自定义类的使用">支持自定义类的使用</a></li>
<li class="toctree-l3"><a class="reference internal" href="#基础运算符支持更多数据类型">基础运算符支持更多数据类型</a></li>
<li class="toctree-l3"><a class="reference internal" href="#基础类型">基础类型</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#支持列表就地修改操作">支持列表就地修改操作</a></li>
<li class="toctree-l4"><a class="reference internal" href="#支持dictionary的高阶用法">支持Dictionary的高阶用法</a></li>
<li class="toctree-l4"><a class="reference internal" href="#支持使用none">支持使用None</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#内置函数支持更多数据类型">内置函数支持更多数据类型</a></li>
<li class="toctree-l3"><a class="reference internal" href="#支持控制流">支持控制流</a></li>
<li class="toctree-l3"><a class="reference internal" href="#支持属性设置与修改">支持属性设置与修改</a></li>
<li class="toctree-l3"><a class="reference internal" href="#支持求导">支持求导</a></li>
<li class="toctree-l3"><a class="reference internal" href="#annotation-type">Annotation Type</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#扩展语法的语法约束">扩展语法的语法约束</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="static_graph_syntax/operators.html">静态图语法-运算符</a></li>
<li class="toctree-l1"><a class="reference internal" href="static_graph_syntax/statements.html">静态图语法-Python语句</a></li>
<li class="toctree-l1"><a class="reference internal" href="static_graph_syntax/python_builtin_functions.html">静态图语法-Python内置函数</a></li>
<li class="toctree-l1"><a class="reference internal" href="index_support.html">Tensor索引支持</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">环境变量</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="env_var_list.html">环境变量</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FAQ</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../faq/installation.html">安装</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/data_processing.html">数据处理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/implement_problem.html">执行问题</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/network_compilation.html">网络编译</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/operators_compile.html">算子编译</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/usage_migrate_3rd.html">第三方框架迁移使用</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/performance_tuning.html">性能调优</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/precision_tuning.html">精度调优</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/distributed_parallel.html">分布式并行</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/inference.html">推理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/feature_advice.html">特性咨询</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">RELEASE NOTES</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../RELEASE.html">Release Notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MindSpore</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>静态图语法支持</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/note/static_graph_syntax_support.md.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="静态图语法支持">
<h1>静态图语法支持<a class="headerlink" href="#静态图语法支持" title="永久链接至标题"></a></h1>
<p><a class="reference external" href="https://gitee.com/mindspore/docs/blob/master/docs/mindspore/source_zh_cn/note/static_graph_syntax_support.md"><img alt="查看源文件" src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/master/resource/_static/logo_source.png" /></a></p>
<section id="概述">
<h2>概述<a class="headerlink" href="#概述" title="永久链接至标题"></a></h2>
<p>在Graph模式下，Python代码并不是由Python解释器去执行，而是将代码编译成静态计算图，然后执行静态计算图。</p>
<p>在静态图模式下，MindSpore通过源码转换的方式，将Python的源码转换成中间表达IR（Intermediate Representation），并在此基础上对IR图进行优化，最终在硬件设备上执行优化后的图。MindSpore使用基于图表示的函数式IR，称为MindIR，详情可参考<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/master/design/all_scenarios.html#%E4%B8%AD%E9%97%B4%E8%A1%A8%E7%A4%BAmindir">中间表示MindIR</a>。</p>
<p>MindSpore的静态图执行过程实际包含两步，对应静态图的Define和Run阶段，但在实际使用中，在实例化的Cell对象被调用时用户并不会分别感知到这两阶段，MindSpore将两阶段均封装在Cell的<code class="docutils literal notranslate"><span class="pre">__call__</span></code>方法中，因此实际调用过程为：</p>
<p><code class="docutils literal notranslate"><span class="pre">model(inputs)</span> <span class="pre">=</span> <span class="pre">model.compile(inputs)</span> <span class="pre">+</span> <span class="pre">model.construct(inputs)</span></code>，其中<code class="docutils literal notranslate"><span class="pre">model</span></code>为实例化Cell对象。</p>
<p>使用Graph模式有两种方式：一是调用<code class="docutils literal notranslate"><span class="pre">&#64;jit</span></code>装饰器修饰函数或者类的成员方法，所修饰的函数或方法将会被编译成静态计算图。<code class="docutils literal notranslate"><span class="pre">jit</span></code>使用规则详见<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/master/api_python/mindspore/mindspore.jit.html#mindspore.jit">jit API文档</a>。二是设置<code class="docutils literal notranslate"><span class="pre">ms.set_context(mode=ms.GRAPH_MODE)</span></code>，使用<code class="docutils literal notranslate"><span class="pre">Cell</span></code>类并且在<code class="docutils literal notranslate"><span class="pre">construct</span></code>函数中编写执行代码，此时<code class="docutils literal notranslate"><span class="pre">construct</span></code>函数的代码将会被编译成静态计算图。<code class="docutils literal notranslate"><span class="pre">Cell</span></code>定义详见<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/master/api_python/nn/mindspore.nn.Cell.html">Cell API文档</a>。</p>
<p>由于语法解析的限制，当前在编译构图时，支持的数据类型、语法以及相关操作并没有完全与Python语法保持一致，部分使用受限。借鉴传统JIT编译的思路，从图模式的角度考虑动静图的统一，扩展图模式的语法能力，使得静态图提供接近动态图的语法使用体验，从而实现动静统一。为了便于用户选择是否扩展静态图语法，提供了JIT语法支持级别选项<code class="docutils literal notranslate"><span class="pre">jit_syntax_level</span></code>，其值必须在[STRICT，LAX]范围内，选择<code class="docutils literal notranslate"><span class="pre">STRICT</span></code>则认为使用基础语法，不扩展静态图语法。默认值为<code class="docutils literal notranslate"><span class="pre">LAX</span></code>，更多请参考本文的<a class="reference internal" href="#扩展语法lax级别"><span class="std std-doc">扩展语法（LAX级别）</span></a>章节。全部级别都支持所有后端。</p>
<ul class="simple">
<li><p>STRICT: 仅支持基础语法，且执行性能最佳。可用于MindIR导入导出。</p></li>
<li><p>LAX: 支持更多复杂语法，最大程度地兼容Python所有语法。由于存在可能无法导出的语法，不能用于MindIR导入导出。</p></li>
</ul>
<p>本文主要介绍，在编译静态图时，支持的数据类型、语法以及相关操作，这些规则仅适用于Graph模式。</p>
</section>
<section id="基础语法strict级别">
<h2>基础语法（STRICT级别）<a class="headerlink" href="#基础语法strict级别" title="永久链接至标题"></a></h2>
<section id="静态图内的常量与变量">
<h3>静态图内的常量与变量<a class="headerlink" href="#静态图内的常量与变量" title="永久链接至标题"></a></h3>
<p>在静态图中，常量与变量是理解静态图语法的一个重要概念，很多语法在常量输入和变量输入情况下支持的方法与程度是不同的。因此，在介绍静态图具体支持的语法之前，本小节先会对静态图中常量与变量的概念进行说明。</p>
<p>在静态图模式下，一段程序的运行会被分为编译期以及执行期。 在编译期，程序会被编译成一张中间表示图，并且程序不会真正的执行，而是通过抽象推导的方式对中间表示进行静态解析。这使得在编译期时，我们无法保证能获取到所有中间表示中节点的值。 常量和变量也就是通过能否能在编译器获取到其真实值来区分的。</p>
<ul class="simple">
<li><p>常量： 编译期内可以获取到值的量。</p></li>
<li><p>变量： 编译期内无法获取到值的量。</p></li>
</ul>
<p>在有些情况下，一个量是常量还是变量是很难判断的，此时我们可以通过<code class="docutils literal notranslate"><span class="pre">ops.isconstant</span></code>来判断其是否为常量。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">jit</span><span class="p">,</span> <span class="n">ops</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>

<span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">([</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">isconstant</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">isconstant</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span>
</pre></div>
</div>
<p>上述代码中，<code class="docutils literal notranslate"><span class="pre">a</span></code>为变量，因此<code class="docutils literal notranslate"><span class="pre">m</span></code>为<code class="docutils literal notranslate"><span class="pre">False</span></code>。<code class="docutils literal notranslate"><span class="pre">b</span></code>为常量，因此<code class="docutils literal notranslate"><span class="pre">n</span></code>为<code class="docutils literal notranslate"><span class="pre">True</span></code>。</p>
<section id="常量产生场景">
<h4>常量产生场景<a class="headerlink" href="#常量产生场景" title="永久链接至标题"></a></h4>
<ul>
<li><p>作为图模式输入的标量，列表以及元组均为常量（在不使用mutable接口的情况下）。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">jit</span>

<span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="n">Tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">]),</span> <span class="n">Tensor</span><span class="p">([</span><span class="mi">2</span><span class="p">])]</span>
<span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">]</span>

<span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span>
</pre></div>
</div>
<p>上述代码中，输入<code class="docutils literal notranslate"><span class="pre">a</span></code>，<code class="docutils literal notranslate"><span class="pre">b</span></code>，<code class="docutils literal notranslate"><span class="pre">c</span></code>均为常量。</p>
</li>
<li><p>图模式内生成的标量或者Tensor为常量。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">jit</span><span class="p">,</span> <span class="n">Tensor</span>

<span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">b</span> <span class="o">=</span> <span class="s2">&quot;2&quot;</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span>
</pre></div>
</div>
<p>上述代码中， <code class="docutils literal notranslate"><span class="pre">a</span></code>，<code class="docutils literal notranslate"><span class="pre">b</span></code>，<code class="docutils literal notranslate"><span class="pre">c</span></code>均为常量。</p>
</li>
<li><p>常量运算得到的结果为常量。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">jit</span><span class="p">,</span> <span class="n">Tensor</span>

<span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
    <span class="k">return</span> <span class="n">c</span>
</pre></div>
</div>
<p>上述代码中，<code class="docutils literal notranslate"><span class="pre">a</span></code>、<code class="docutils literal notranslate"><span class="pre">b</span></code>均为图模式内产生的Tensor为常量，因此其计算得到的结果也是常量。但如果其中之一为变量时，其返回值也会为变量。</p>
</li>
</ul>
</section>
<section id="变量产生场景">
<h4>变量产生场景<a class="headerlink" href="#变量产生场景" title="永久链接至标题"></a></h4>
<ul>
<li><p>所有mutable接口的返回值均为变量(无论是在图外使用mutable还是在图内使用)。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">jit</span>
<span class="kn">from</span> <span class="nn">mindspore.common</span> <span class="kn">import</span> <span class="n">mutable</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">mutable</span><span class="p">([</span><span class="n">Tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">]),</span> <span class="n">Tensor</span><span class="p">([</span><span class="mi">2</span><span class="p">])])</span>

<span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">mutable</span><span class="p">(</span><span class="n">Tensor</span><span class="p">([</span><span class="mi">3</span><span class="p">]))</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">mutable</span><span class="p">((</span><span class="n">Tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">]),</span> <span class="n">Tensor</span><span class="p">([</span><span class="mi">2</span><span class="p">])))</span>
    <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span>
</pre></div>
</div>
<p>上述代码中，<code class="docutils literal notranslate"><span class="pre">a</span></code>是在图外调用mutable接口的，<code class="docutils literal notranslate"><span class="pre">b</span></code>和<code class="docutils literal notranslate"><span class="pre">c</span></code>是在图内调用mutable接口生成的，<code class="docutils literal notranslate"><span class="pre">a</span></code>、<code class="docutils literal notranslate"><span class="pre">b</span></code>、<code class="docutils literal notranslate"><span class="pre">c</span></code>均为变量。</p>
</li>
<li><p>作为静态图的输入的Tensor都是变量。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">jit</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
<span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">Tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">]),</span> <span class="n">Tensor</span><span class="p">([</span><span class="mi">2</span><span class="p">]))</span>

<span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span>
</pre></div>
</div>
<p>上述代码中，<code class="docutils literal notranslate"><span class="pre">a</span></code>是作为图模式输入的Tensor，因此其为变量。但<code class="docutils literal notranslate"><span class="pre">b</span></code>是作为图模式输入的元组，非Tensor类型，即使其内部的元素均为Tensor，<code class="docutils literal notranslate"><span class="pre">b</span></code>也是常量。</p>
</li>
<li><p>通过变量计算得到的是变量。</p>
<p>如果一个量是算子的输出，那么其多数情况下为常量。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">jit</span><span class="p">,</span> <span class="n">ops</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">([</span><span class="mi">2</span><span class="p">])</span>

<span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
    <span class="k">return</span> <span class="n">c</span>
</pre></div>
</div>
<p>在这种情况下，<code class="docutils literal notranslate"><span class="pre">c</span></code>是<code class="docutils literal notranslate"><span class="pre">a</span></code>和<code class="docutils literal notranslate"><span class="pre">b</span></code>计算来的结果，且用来计算的输入<code class="docutils literal notranslate"><span class="pre">a</span></code>、<code class="docutils literal notranslate"><span class="pre">b</span></code>均为变量，因此<code class="docutils literal notranslate"><span class="pre">c</span></code>也是变量。</p>
</li>
</ul>
</section>
</section>
<section id="数据类型">
<h3>数据类型<a class="headerlink" href="#数据类型" title="永久链接至标题"></a></h3>
<section id="python内置数据类型">
<h4>Python内置数据类型<a class="headerlink" href="#python内置数据类型" title="永久链接至标题"></a></h4>
<p>当前支持的<code class="docutils literal notranslate"><span class="pre">Python</span></code>内置数据类型包括：<code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">String</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>和<code class="docutils literal notranslate"><span class="pre">Dictionary</span></code>。</p>
<section id="number">
<h5>Number<a class="headerlink" href="#number" title="永久链接至标题"></a></h5>
<p>支持<code class="docutils literal notranslate"><span class="pre">int</span></code>（整型）、<code class="docutils literal notranslate"><span class="pre">float</span></code>（浮点型）、<code class="docutils literal notranslate"><span class="pre">bool</span></code>（布尔类型），不支持<code class="docutils literal notranslate"><span class="pre">complex</span></code>（复数）。</p>
<p>支持在网络里定义<code class="docutils literal notranslate"><span class="pre">Number</span></code>，即支持语法：<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">1</span></code>、<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">1.2</span></code>、<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">True</span></code>。</p>
<p>当数据为常量时，编译时期可以获取到数值，在网络中可以支持强转<code class="docutils literal notranslate"><span class="pre">Number</span></code>的语法：<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">int(x)</span></code>、<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">float(x)</span></code>、<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">bool(x)</span></code>。
当数据为变量时，即需要在运行时期才可以获取到数值，也支持使用int()，float()，bool()等内置函数<a class="reference internal" href="#python内置函数"><span class="std std-doc">Python内置函数</span></a>进行数据类型的转换。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">jit</span>

<span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="n">out1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">11.1</span><span class="p">)</span>
  <span class="n">out2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Tensor</span><span class="p">([</span><span class="mi">10</span><span class="p">]))</span>
  <span class="n">out3</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">())</span>
  <span class="k">return</span> <span class="n">out1</span><span class="p">,</span> <span class="n">out2</span><span class="p">,</span> <span class="n">out3</span>

<span class="n">res</span> <span class="o">=</span> <span class="n">foo</span><span class="p">(</span><span class="n">Tensor</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;res[0]:&quot;</span><span class="p">,</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;res[1]:&quot;</span><span class="p">,</span> <span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;res[2]:&quot;</span><span class="p">,</span> <span class="n">res</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>res[0]: 11
res[1]: 10
res[2]: 2
</pre></div>
</div>
<p>支持返回Number类型。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>

<span class="nd">@ms</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">test_return_scalar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="n">res</span> <span class="o">=</span> <span class="n">test_return_scalar</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">mutable</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">ms</span><span class="o">.</span><span class="n">mutable</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>3
</pre></div>
</div>
</section>
<section id="string">
<h5>String<a class="headerlink" href="#string" title="永久链接至标题"></a></h5>
<p>支持在网络里构造<code class="docutils literal notranslate"><span class="pre">String</span></code>，即支持使用引号（<code class="docutils literal notranslate"><span class="pre">'</span></code>或<code class="docutils literal notranslate"><span class="pre">&quot;</span></code>）来创建字符串，如<code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">'abcd'</span></code>或<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">&quot;efgh&quot;</span></code>。可以通过<code class="docutils literal notranslate"><span class="pre">str()</span></code>的方式进行将常量转换成字符串。支持对字符串连接，截取，以及使用成员运算符（<code class="docutils literal notranslate"><span class="pre">in</span></code>或<code class="docutils literal notranslate"><span class="pre">not</span> <span class="pre">in</span></code>）判断字符串是否包含指定的字符。支持格式化字符串的输出，将一个值插入到一个有字符串格式符<code class="docutils literal notranslate"><span class="pre">%s</span></code>的字符串中。支持在常量场景下使用格式化字符串函数<code class="docutils literal notranslate"><span class="pre">str.format()</span></code>。</p>
<p>例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">jit</span>

<span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
  <span class="n">var1</span> <span class="o">=</span> <span class="s1">&#39;Hello!&#39;</span>
  <span class="n">var2</span> <span class="o">=</span> <span class="s2">&quot;MindSpore&quot;</span>
  <span class="n">var3</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
  <span class="n">var4</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> is </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="n">var3</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">var1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">var2</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">9</span><span class="p">],</span> <span class="n">var1</span> <span class="o">+</span> <span class="n">var2</span><span class="p">,</span> <span class="n">var2</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span> <span class="ow">in</span> <span class="n">var1</span><span class="p">,</span> <span class="s2">&quot;My name is </span><span class="si">%s</span><span class="s2">!&quot;</span> <span class="o">%</span> <span class="n">var2</span><span class="p">,</span> <span class="n">var4</span>

<span class="n">res</span> <span class="o">=</span> <span class="n">foo</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;res:&quot;</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>res: (&#39;H&#39;, &#39;Spore&#39;, &#39;Hello!MindSpore&#39;, &#39;MindSporeMindSpore&#39;, True, &#39;My name is MindSpore!&#39;, &#39;string is 123&#39;)
</pre></div>
</div>
</section>
<section id="list">
<h5>List<a class="headerlink" href="#list" title="永久链接至标题"></a></h5>
<p>在<code class="docutils literal notranslate"><span class="pre">JIT_SYNTAX_LEVEL</span></code>设置为<code class="docutils literal notranslate"><span class="pre">LAX</span></code>的情况下，静态图模式可以支持部分<code class="docutils literal notranslate"><span class="pre">List</span></code>对象的inplace操作，具体介绍详见<a class="reference internal" href="#支持列表就地修改操作"><span class="std std-doc">支持列表就地修改操作</span></a>章节。</p>
<p><code class="docutils literal notranslate"><span class="pre">List</span></code>的基础使用场景如下：</p>
<ul>
<li><p>图模式支持图内创建<code class="docutils literal notranslate"><span class="pre">List</span></code>。</p>
<p>支持在图模式内创建<code class="docutils literal notranslate"><span class="pre">List</span></code>对象，且<code class="docutils literal notranslate"><span class="pre">List</span></code>内对象的元素可以包含任意图模式支持的类型，也支持多层嵌套。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>

<span class="nd">@ms</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">generate_list</span><span class="p">():</span>
  <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
  <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">]</span>
  <span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">]),</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span><span class="mi">2</span><span class="p">])]</span>
  <span class="n">d</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)]</span>
  <span class="k">return</span> <span class="n">d</span>
</pre></div>
</div>
<p>上述示例代码中，所有的<code class="docutils literal notranslate"><span class="pre">List</span></code>对象都可以被正常的创建。</p>
</li>
<li><p>图模式支持返回<code class="docutils literal notranslate"><span class="pre">List</span></code>。</p>
<p>在MindSpore2.0版本之前，当图模式返回<code class="docutils literal notranslate"><span class="pre">List</span></code> 对象时，<code class="docutils literal notranslate"><span class="pre">List</span></code>会被转换为<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>。MindSpore2.0版本已经可以支持返回<code class="docutils literal notranslate"><span class="pre">List</span></code>对象。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>

<span class="nd">@ms</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">list_func</span><span class="p">():</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">a</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">list_func</span><span class="p">()</span>  <span class="c1"># output: [1, 2, 3, 4]</span>
</pre></div>
</div>
<p>与图模式内创建<code class="docutils literal notranslate"><span class="pre">List</span></code> 相同，图模式返回<code class="docutils literal notranslate"><span class="pre">List</span></code>对象可以包括任意图模式支持的类型，也支持多层嵌套。</p>
</li>
<li><p>图模式支持从全局变量中获取<code class="docutils literal notranslate"><span class="pre">List</span></code>对象。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>

<span class="n">global_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>

<span class="nd">@ms</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">list_func</span><span class="p">():</span>
    <span class="n">global_list</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">global_list</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">list_func</span><span class="p">()</span>  <span class="c1"># output: [4, 3, 2, 1]</span>
</pre></div>
</div>
<p>需要注意的是，在基础场景下图模式返回的列表与全局变量的列表不是同一个对象，当<code class="docutils literal notranslate"><span class="pre">JIT_SYNTAX_LEVEL</span></code>设置为<code class="docutils literal notranslate"><span class="pre">LAX</span></code>时，返回的对象与全局对象为统一对象。</p>
</li>
<li><p>图模式支持以<code class="docutils literal notranslate"><span class="pre">List</span></code>作为输入。</p>
<p>图模式支持<code class="docutils literal notranslate"><span class="pre">List</span></code>作为静态图的输入，作为输入的<code class="docutils literal notranslate"><span class="pre">List</span></code>对象的元素必须为图模式支持的输入类型，也支持多层嵌套。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>

<span class="n">list_input</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>

<span class="nd">@ms</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">list_func</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">list_func</span><span class="p">()</span>  <span class="c1"># output: [1, 2, 3, 4]</span>
</pre></div>
</div>
<p>需要注意的是，<code class="docutils literal notranslate"><span class="pre">List</span></code>作为静态图输入时，无论其内部的元素是什么类型，一律被视为常量。</p>
</li>
<li><p>图模式支持List的内置方法。</p>
<p><code class="docutils literal notranslate"><span class="pre">List</span></code> 内置方法的详细介绍如下：</p>
<ul>
<li><p>List索引取值</p>
<p>基础语法：<code class="docutils literal notranslate"><span class="pre">element</span> <span class="pre">=</span> <span class="pre">list_object[index]</span></code>。</p>
<p>基础语义：将<code class="docutils literal notranslate"><span class="pre">List</span></code>对象中位于第<code class="docutils literal notranslate"><span class="pre">index</span></code>位的元素提取出来（<code class="docutils literal notranslate"><span class="pre">index</span></code>从0开始）。支持多层索引取值。</p>
<p>索引值<code class="docutils literal notranslate"><span class="pre">index</span></code>支持类型包括<code class="docutils literal notranslate"><span class="pre">int</span></code>，<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>和<code class="docutils literal notranslate"><span class="pre">slice</span></code>。其中，<code class="docutils literal notranslate"><span class="pre">int</span></code>以及<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>类型的输入可以支持常量以及变量，<code class="docutils literal notranslate"><span class="pre">slice</span></code>内部数据必须为编译时能够确定的常量。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="nd">@ms</span><span class="o">.</span><span class="n">jit</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">list_getitem_func</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">])]</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span>

<span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">list_getitem_func</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;a:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;b:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;c:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>a:[1, 2]
b:2
c:[3, 4]
</pre></div>
</div>
</li>
<li><p>List索引赋值</p>
<p>基础语法：<code class="docutils literal notranslate"><span class="pre">list_object[index]</span> <span class="pre">=</span> <span class="pre">target_element</span></code>。</p>
<p>基础语义：将<code class="docutils literal notranslate"><span class="pre">List</span></code>对象中位于第<code class="docutils literal notranslate"><span class="pre">index</span></code>位的元素赋值为 <code class="docutils literal notranslate"><span class="pre">target_element</span></code>（<code class="docutils literal notranslate"><span class="pre">index</span></code>从0开始）。支持多层索引赋值。</p>
<p>索引值<code class="docutils literal notranslate"><span class="pre">index</span></code>支持类型包括<code class="docutils literal notranslate"><span class="pre">int</span></code>，<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>和<code class="docutils literal notranslate"><span class="pre">slice</span></code>。其中，<code class="docutils literal notranslate"><span class="pre">int</span></code> 以及<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>类型的输入可以支持常量以及变量，<code class="docutils literal notranslate"><span class="pre">slice</span></code>内部数据必须为编译时能够确定的常量。</p>
<p>索引赋值对象<code class="docutils literal notranslate"><span class="pre">target_element</span></code>支持所有图模式支持的数据类型。</p>
<p>目前，<code class="docutils literal notranslate"><span class="pre">List</span></code>索引赋值不支持inplace操作, 索引赋值后将会生成一个新的对象。该操作后续将会支持inplace操作。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>

<span class="nd">@ms</span><span class="o">.</span><span class="n">jit</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test_setitem_func</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
    <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ok&quot;</span>
    <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">88</span>
    <span class="k">return</span> <span class="n">x</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">test_setitem_func</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;output:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>output:[[0, 88], 10, &#39;ok&#39;, (1, 2, 3)]
</pre></div>
</div>
</li>
<li><p>List.append</p>
<p>基础语法：<code class="docutils literal notranslate"><span class="pre">list_object.append(target_element)</span></code>。</p>
<p>基础语义：向<code class="docutils literal notranslate"><span class="pre">List</span></code>对象<code class="docutils literal notranslate"><span class="pre">list_object</span></code>的最后追加元素<code class="docutils literal notranslate"><span class="pre">target_element</span></code>。</p>
<p>目前，<code class="docutils literal notranslate"><span class="pre">List.append</span></code>不支持inplace操作, 索引赋值后将会生成一个新的对象。该操作后续将会支持inplace操作。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>

<span class="nd">@ms</span><span class="o">.</span><span class="n">jit</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test_list</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">test_list</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>x:[1, 2, 3, 4]
</pre></div>
</div>
</li>
<li><p>List.clear</p>
<p>基础语法：<code class="docutils literal notranslate"><span class="pre">list_object.clear()</span></code>。</p>
<p>基础语义：清空<code class="docutils literal notranslate"><span class="pre">List</span></code>对象 <code class="docutils literal notranslate"><span class="pre">list_object</span></code>中包含的元素。</p>
<p>目前，<code class="docutils literal notranslate"><span class="pre">List.clear</span></code>不支持inplace, 索引赋值后将会生成一个新的对象。该操作后续将会支持inplace。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>

<span class="nd">@ms</span><span class="o">.</span><span class="n">jit</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test_list_clear</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
    <span class="n">x</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">x</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">test_list_clear</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>x:[]
</pre></div>
</div>
</li>
<li><p>List.extend</p>
<p>基础语法：<code class="docutils literal notranslate"><span class="pre">list_object.extend(target)</span></code>。</p>
<p>基础语义：向<code class="docutils literal notranslate"><span class="pre">List</span></code>对象<code class="docutils literal notranslate"><span class="pre">list_object</span></code>的最后依次插入<code class="docutils literal notranslate"><span class="pre">target</span></code>内的所有元素。</p>
<p><code class="docutils literal notranslate"><span class="pre">target</span></code>支持的类型为<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>，<code class="docutils literal notranslate"><span class="pre">List</span></code>以及<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。其中，如果<code class="docutils literal notranslate"><span class="pre">target</span></code>类型为<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>的情况下，会先将该<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>转换为<code class="docutils literal notranslate"><span class="pre">List</span></code>，再进行插入操作。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>

<span class="nd">@ms</span><span class="o">.</span><span class="n">jit</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test_list_extend</span><span class="p">():</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="n">x1</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">))</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="n">x2</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span>

<span class="n">output1</span><span class="p">,</span> <span class="n">output2</span> <span class="o">=</span> <span class="n">test_list_extend</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;output1:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;output2:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output2</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>output1:[1, 2, 3, 4, &#39;a&#39;]
output2:[1, 2, 3, Tensor(shape=[1], dtype=Int64, value= [4]), Tensor(shape=[1], dtype=Int64, value= [5])]
</pre></div>
</div>
</li>
<li><p>List.pop</p>
<p>基础语法：<code class="docutils literal notranslate"><span class="pre">pop_element</span> <span class="pre">=</span> <span class="pre">list_object.pop(index=-1)</span></code>。</p>
<p>基础语义：将<code class="docutils literal notranslate"><span class="pre">List</span></code>对象<code class="docutils literal notranslate"><span class="pre">list_object</span></code> 的第<code class="docutils literal notranslate"><span class="pre">index</span></code>个元素从<code class="docutils literal notranslate"><span class="pre">list_object</span></code>中删除，并返回该元素。</p>
<p><code class="docutils literal notranslate"><span class="pre">index</span></code> 要求必须为常量<code class="docutils literal notranslate"><span class="pre">int</span></code>, 当<code class="docutils literal notranslate"><span class="pre">list_object</span></code>的长度为<code class="docutils literal notranslate"><span class="pre">list_obj_size</span></code>时，<code class="docutils literal notranslate"><span class="pre">index</span></code>的取值范围为：<code class="docutils literal notranslate"><span class="pre">[-list_obj_size，list_obj_size-1]</span></code>。<code class="docutils literal notranslate"><span class="pre">index</span></code>为负数，代表从后往前的位数。当没有输入<code class="docutils literal notranslate"><span class="pre">index</span></code>时，默认值为-1，即删除最后一个元素。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>

<span class="nd">@ms</span><span class="o">.</span><span class="n">jit</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test_list_pop</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">b</span><span class="p">,</span> <span class="n">x</span>

<span class="n">pop_element</span><span class="p">,</span> <span class="n">res_list</span> <span class="o">=</span> <span class="n">test_list_pop</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;pop_element:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pop_element</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;res_list:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">res_list</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>pop_element:3
res_list:[1, 2]
</pre></div>
</div>
</li>
<li><p>List.reverse</p>
<p>基础语法：<code class="docutils literal notranslate"><span class="pre">list_object.reverse()</span></code>。</p>
<p>基础语义：将<code class="docutils literal notranslate"><span class="pre">List</span></code>对象<code class="docutils literal notranslate"><span class="pre">list_object</span></code>的元素顺序倒转。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>

<span class="nd">@ms</span><span class="o">.</span><span class="n">jit</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test_list_reverse</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="n">x</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">x</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">test_list_reverse</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;output:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>output1:[3, 2, 1]
</pre></div>
</div>
</li>
<li><p>List.insert</p>
<p>基础语法：<code class="docutils literal notranslate"><span class="pre">list_object.insert(index,</span> <span class="pre">target_obj)</span></code>。</p>
<p>基础语义：将<code class="docutils literal notranslate"><span class="pre">target_obj</span></code>插入到<code class="docutils literal notranslate"><span class="pre">list_object</span></code>的第<code class="docutils literal notranslate"><span class="pre">index</span></code>位。</p>
<p><code class="docutils literal notranslate"><span class="pre">index</span></code>要求必须为常量<code class="docutils literal notranslate"><span class="pre">int</span></code>。如果<code class="docutils literal notranslate"><span class="pre">list_object</span></code>的长度为<code class="docutils literal notranslate"><span class="pre">list_obj_size</span></code>。当<code class="docutils literal notranslate"><span class="pre">index</span> <span class="pre">&lt;</span> <span class="pre">-list_obj_size</span></code>时，插入到<code class="docutils literal notranslate"><span class="pre">List</span></code>的第一位。当<code class="docutils literal notranslate"><span class="pre">index</span> <span class="pre">&gt;=</span> <span class="pre">-list_obj_size</span></code>时，插入到<code class="docutils literal notranslate"><span class="pre">List</span></code>的最后。<code class="docutils literal notranslate"><span class="pre">index</span></code>为负数代表从后往前的位数。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>

<span class="nd">@ms</span><span class="o">.</span><span class="n">jit</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test_list_insert</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="n">x</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">test_list_insert</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;output:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>output:[1, 2, 3, 4]
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</section>
<section id="tuple">
<h5>Tuple<a class="headerlink" href="#tuple" title="永久链接至标题"></a></h5>
<p>支持在网络里构造元组<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>，使用小括号包含元素，即支持语法<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">(1,</span> <span class="pre">2,</span> <span class="pre">3)</span></code>。元组<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>的元素不能修改，但支持索引访问元组<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>中的元素，支持对元组进行连接组合。</p>
<ul>
<li><p>支持索引取值。</p>
<p>支持使用方括号加下标索引的形式来访问元组<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>中的元素，索引值支持<code class="docutils literal notranslate"><span class="pre">int</span></code>、<code class="docutils literal notranslate"><span class="pre">slice</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，也支持多层索引取值，即支持语法<code class="docutils literal notranslate"><span class="pre">data</span> <span class="pre">=</span> <span class="pre">tuple_x[index0][index1]...</span></code>。</p>
<p>索引值为<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>有如下限制：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Tuple</span></code>里存放的都是<code class="docutils literal notranslate"><span class="pre">Cell</span></code>，每个<code class="docutils literal notranslate"><span class="pre">Cell</span></code>要在<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>定义之前完成定义，每个<code class="docutils literal notranslate"><span class="pre">Cell</span></code>的入参个数、入参类型和入参<code class="docutils literal notranslate"><span class="pre">shape</span></code>要求一致，每个<code class="docutils literal notranslate"><span class="pre">Cell</span></code>的输出个数、输出类型和输出<code class="docutils literal notranslate"><span class="pre">shape</span></code>也要求一致。</p></li>
<li><p>索引<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>是一个<code class="docutils literal notranslate"><span class="pre">dtype</span></code>为<code class="docutils literal notranslate"><span class="pre">int32</span></code>的标量<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，取值范围在<code class="docutils literal notranslate"><span class="pre">[-tuple_len,</span> <span class="pre">tuple_len)</span></code>，<code class="docutils literal notranslate"><span class="pre">Ascend</span></code>后端不支持负数索引。</p></li>
<li><p>支持<code class="docutils literal notranslate"><span class="pre">CPU</span></code>、<code class="docutils literal notranslate"><span class="pre">GPU</span></code>和<code class="docutils literal notranslate"><span class="pre">Ascend</span></code>后端。</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">int</span></code>、<code class="docutils literal notranslate"><span class="pre">slice</span></code>索引示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>

<span class="nd">@ms</span><span class="o">.</span><span class="n">jit</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test_index</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span>

<span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">test_index</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;y:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;z:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;m:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;n:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>y:3
z:[1 2 3]
m:((2, 3, 4), 3, 4)
n:(2, 3, 4)
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Tensor</span></code>索引示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">nn</span><span class="p">,</span> <span class="n">set_context</span>

<span class="n">set_context</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">GRAPH_MODE</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Net</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relu</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">softmax</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Softmax</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">softmax</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="n">index</span><span class="p">](</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">],</span> <span class="n">ms</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="n">net</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
<span class="n">ret</span> <span class="o">=</span> <span class="n">net</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ret:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ret:[0.]
</pre></div>
</div>
</li>
<li><p>支持连接组合。</p>
<p>与字符串<code class="docutils literal notranslate"><span class="pre">String</span></code>类似，元组支持使用<code class="docutils literal notranslate"><span class="pre">+</span></code>和<code class="docutils literal notranslate"><span class="pre">*</span></code>进行组合，得到一个新的元组<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>，例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>

<span class="nd">@ms</span><span class="o">.</span><span class="n">jit</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test_index</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span>

<span class="n">out1</span><span class="p">,</span> <span class="n">out2</span> <span class="o">=</span> <span class="n">test_index</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;out1:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">out1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;out2:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">out2</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>out1:(1, 2, 3, 4, 5, 6)
out2:(1, 2, 3, 1, 2, 3)
</pre></div>
</div>
</li>
</ul>
</section>
<section id="dictionary">
<h5>Dictionary<a class="headerlink" href="#dictionary" title="永久链接至标题"></a></h5>
<p>支持在网络里构造字典<code class="docutils literal notranslate"><span class="pre">Dictionary</span></code>，每个键值<code class="docutils literal notranslate"><span class="pre">key:value</span></code>用冒号<code class="docutils literal notranslate"><span class="pre">:</span></code>分割，每个键值对之间用逗号<code class="docutils literal notranslate"><span class="pre">,</span></code>分割，整个字典使用大括号<code class="docutils literal notranslate"><span class="pre">{}</span></code>包含键值对，即支持语法<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">{&quot;a&quot;:</span> <span class="pre">1,</span> <span class="pre">&quot;b&quot;:</span> <span class="pre">2}</span></code>。</p>
<p>键<code class="docutils literal notranslate"><span class="pre">key</span></code>是唯一的，如果字典中存在多个相同的<code class="docutils literal notranslate"><span class="pre">key</span></code>，则重复的<code class="docutils literal notranslate"><span class="pre">key</span></code>以最后一个作为最终结果；而值<code class="docutils literal notranslate"><span class="pre">value</span></code>可以不是唯一的。键<code class="docutils literal notranslate"><span class="pre">key</span></code>需要保证是不可变的。当前键<code class="docutils literal notranslate"><span class="pre">key</span></code>支持<code class="docutils literal notranslate"><span class="pre">String</span></code>、<code class="docutils literal notranslate"><span class="pre">Number</span></code>、常量<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>以及只包含这些类型对象的<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>；值<code class="docutils literal notranslate"><span class="pre">value</span></code>支持<code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code>、<code class="docutils literal notranslate"><span class="pre">Dictionary</span></code>和<code class="docutils literal notranslate"><span class="pre">None</span></code>。</p>
<ul>
<li><p>支持接口。</p>
<p><code class="docutils literal notranslate"><span class="pre">keys</span></code>：取出<code class="docutils literal notranslate"><span class="pre">dict</span></code>里所有的<code class="docutils literal notranslate"><span class="pre">key</span></code>值，组成<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>返回。</p>
<p><code class="docutils literal notranslate"><span class="pre">values</span></code>：取出<code class="docutils literal notranslate"><span class="pre">dict</span></code>里所有的<code class="docutils literal notranslate"><span class="pre">value</span></code>值，组成<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>返回。</p>
<p><code class="docutils literal notranslate"><span class="pre">items</span></code>：取出<code class="docutils literal notranslate"><span class="pre">dict</span></code>里每一对<code class="docutils literal notranslate"><span class="pre">key</span></code>和<code class="docutils literal notranslate"><span class="pre">value</span></code>组成的<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>，最终组成<code class="docutils literal notranslate"><span class="pre">List</span></code>返回。</p>
<p><code class="docutils literal notranslate"><span class="pre">get</span></code>：<code class="docutils literal notranslate"><span class="pre">dict.get(key[,</span> <span class="pre">value])</span></code>返回指定<code class="docutils literal notranslate"><span class="pre">key</span></code>对应的<code class="docutils literal notranslate"><span class="pre">value</span></code>值，如果指定<code class="docutils literal notranslate"><span class="pre">key</span></code>不存在，返回默认值<code class="docutils literal notranslate"><span class="pre">None</span></code>或者设置的默认值<code class="docutils literal notranslate"><span class="pre">value</span></code>。</p>
<p><code class="docutils literal notranslate"><span class="pre">clear</span></code>：删除<code class="docutils literal notranslate"><span class="pre">dict</span></code>里所有的元素。</p>
<p><code class="docutils literal notranslate"><span class="pre">has_key</span></code>：<code class="docutils literal notranslate"><span class="pre">dict.has_key(key)</span></code>判断<code class="docutils literal notranslate"><span class="pre">dict</span></code>里是否存在指定<code class="docutils literal notranslate"><span class="pre">key</span></code>。</p>
<p><code class="docutils literal notranslate"><span class="pre">update</span></code>：<code class="docutils literal notranslate"><span class="pre">dict1.update(dict2)</span></code>把<code class="docutils literal notranslate"><span class="pre">dict2</span></code>中的元素更新到<code class="docutils literal notranslate"><span class="pre">dict1</span></code>中。</p>
<p><code class="docutils literal notranslate"><span class="pre">fromkeys</span></code>：<code class="docutils literal notranslate"><span class="pre">dict.fromkeys(seq([,</span> <span class="pre">value]))</span></code>用于创建新的<code class="docutils literal notranslate"><span class="pre">Dictionary</span></code>，以序列<code class="docutils literal notranslate"><span class="pre">seq</span></code>中的元素做<code class="docutils literal notranslate"><span class="pre">Dictionary</span></code>的<code class="docutils literal notranslate"><span class="pre">key</span></code>，<code class="docutils literal notranslate"><span class="pre">value</span></code>为所有<code class="docutils literal notranslate"><span class="pre">key</span></code>对应的初始值。</p>
<p>示例如下，其中返回值中的<code class="docutils literal notranslate"><span class="pre">x</span></code>和<code class="docutils literal notranslate"><span class="pre">new_dict</span></code>是一个<code class="docutils literal notranslate"><span class="pre">Dictionary</span></code>，在图模式JIT语法支持级别选项为LAX下扩展支持，更多Dictionary的高阶使用请参考本文的<a class="reference internal" href="#支持dictionary的高阶用法"><span class="std std-doc">支持Dictionary的高阶用法</span></a>章节。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">x</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])),</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])),</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]))}</span>

<span class="nd">@ms</span><span class="o">.</span><span class="n">jit</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test_dict</span><span class="p">():</span>
    <span class="n">x_keys</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="n">x_values</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
    <span class="n">x_items</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="n">value_a</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>
    <span class="n">check_key</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))}</span>
    <span class="n">x</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">new_dict</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="s2">&quot;abcd&quot;</span><span class="p">,</span> <span class="mi">123</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x_keys</span><span class="p">,</span> <span class="n">x_values</span><span class="p">,</span> <span class="n">x_items</span><span class="p">,</span> <span class="n">value_a</span><span class="p">,</span> <span class="n">check_key</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">new_dict</span>

<span class="n">x_keys</span><span class="p">,</span> <span class="n">x_values</span><span class="p">,</span> <span class="n">x_items</span><span class="p">,</span> <span class="n">value_a</span><span class="p">,</span> <span class="n">check_key</span><span class="p">,</span> <span class="n">new_x</span><span class="p">,</span> <span class="n">new_dict</span> <span class="o">=</span> <span class="n">test_dict</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x_keys:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x_keys</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x_values:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x_values</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x_items:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x_items</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;value_a:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value_a</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;check_key:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">check_key</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;new_x:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_x</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;new_dict:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_dict</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>x_keys:(&#39;a&#39;, &#39;b&#39;, &#39;c&#39;)
x_values:(Tensor(shape=[3], dtype=Int64, value= [1, 2, 3]), Tensor(shape=[3], dtype=Int64, value= [4, 5, 6]), Tensor(shape=[3], dtype=Int64, value= [7, 8, 9]))
x_items:[(&#39;a&#39;, Tensor(shape=[3], dtype=Int64, value= [1, 2, 3])), (&#39;b&#39;, Tensor(shape=[3], dtype=Int64, value= [4, 5, 6])), (&#39;c&#39;, Tensor(shape=[3], dtype=Int64, value= [7, 8, 9]))]
value_a:[1 2 3]
check_key:True
new_x:{&#39;a&#39;: Tensor(shape=[3], dtype=Int64, value= [0, 0, 0]), &#39;b&#39;: Tensor(shape=[3], dtype=Int64, value= [4, 5, 6]), &#39;c&#39;: Tensor(shape=[3], dtype=Int64, value= [7, 8, 9])}
new_dict:{&#39;a&#39;: 123, &#39;b&#39;: 123, &#39;c&#39;: 123, &#39;d&#39;: 123}
</pre></div>
</div>
</li>
</ul>
</section>
</section>
<section id="mindspore自定义数据类型">
<h4>MindSpore自定义数据类型<a class="headerlink" href="#mindspore自定义数据类型" title="永久链接至标题"></a></h4>
<p>当前MindSpore自定义数据类型包括：<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Primitive</span></code>、<code class="docutils literal notranslate"><span class="pre">Cell</span></code>和<code class="docutils literal notranslate"><span class="pre">Parameter</span></code>。</p>
<section id="tensor">
<h5>Tensor<a class="headerlink" href="#tensor" title="永久链接至标题"></a></h5>
<p>Tensor的属性与接口详见<a class="reference external" href="https://mindspore.cn/docs/zh-CN/master/api_python/mindspore/mindspore.Tensor.html#mindspore-tensor">Tensor API文档</a>。</p>
<p>支持在静态图模式下创建和使用Tensor。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore.nn</span> <span class="k">as</span> <span class="nn">nn</span>
<span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>

<span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Net</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

<span class="n">ms</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">GRAPH_MODE</span><span class="p">)</span>

<span class="n">net</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">net</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>1
</pre></div>
</div>
<p>上述例子，使用了<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>类接口创建<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，有些情况下可能会需要创建运行时的<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，即在编译时期获取不到值的<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>数据，即需要在图模式JIT语法支持级别选项为LAX下扩展支持。此时既可以采用上述类<code class="docutils literal notranslate"><span class="pre">ms.Tensor</span></code>接口来创建<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，也可以采用 <a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/master/api_python/mindspore/mindspore.tensor.html#mindspore.tensor">tensor函数接口</a>来创建<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，代码用例如下。</p>
<p>其与<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>类接口的区别在于，其内部增加了<a class="reference internal" href="#annotation-type"><span class="std std-doc">Annotation Type</span></a>的标记，在设定了<code class="docutils literal notranslate"><span class="pre">dtype</span></code>的情况下，在类型推导阶段能够指定其输出的<code class="docutils literal notranslate"><span class="pre">Tensor</span> <span class="pre">dtype</span></code>，从而避免<code class="docutils literal notranslate"><span class="pre">AnyType</span></code>的产生。在需要动态地创建运行时的<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>时，我们推荐使用这种方式来进行<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>创建，并希望用户能够传入期待的dtype类型。以此避免<code class="docutils literal notranslate"><span class="pre">AnyType</span></code>的产生。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">import</span> <span class="nn">mindspore.nn</span> <span class="k">as</span> <span class="nn">nn</span>

<span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Net</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="nd">@ms</span><span class="o">.</span><span class="n">jit</span>
    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ms</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="n">ms</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">GRAPH_MODE</span><span class="p">)</span>
<span class="n">net</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">net</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>1.0
</pre></div>
</div>
</section>
<section id="primitive">
<h5>Primitive<a class="headerlink" href="#primitive" title="永久链接至标题"></a></h5>
<p>当前支持在construct里构造<code class="docutils literal notranslate"><span class="pre">Primitive</span></code>及其子类的实例。</p>
<p>但在调用时，参数只能通过位置参数方式传入，不支持通过键值对方式传入。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">nn</span><span class="p">,</span> <span class="n">ops</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">set_context</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">set_context</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">GRAPH_MODE</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">reduce_sum</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">ReduceSum</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span> <span class="c1">#支持在construct里构造`Primitive`及其子类的实例</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">reduce_sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="n">net</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
<span class="n">ret</span> <span class="o">=</span> <span class="n">net</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ret.shape:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
</pre></div>
</div>
<p>上面所定义的网络里，reduce_sum(x, axis=2)的参数不支持通过键值对方式传入，只能通过位置参数方式传入，即reduce_sum(x, 2)。</p>
<p>结果报错如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>TypeError: Only supported positional parameter type for python primitive, but got keyword parameter type.
</pre></div>
</div>
<p>当前不支持在网络调用<code class="docutils literal notranslate"><span class="pre">Primitive</span></code>及其子类相关属性和接口。</p>
<p>当前已定义的<code class="docutils literal notranslate"><span class="pre">Primitive</span></code>详见<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/master/api_python/ops/mindspore.ops.Primitive.html#mindspore.ops.Primitive">Primitive API文档</a>。</p>
</section>
<section id="cell">
<h5>Cell<a class="headerlink" href="#cell" title="永久链接至标题"></a></h5>
<p>当前支持在网络里构造<code class="docutils literal notranslate"><span class="pre">Cell</span></code>及其子类的实例，即支持语法<code class="docutils literal notranslate"><span class="pre">cell</span> <span class="pre">=</span> <span class="pre">Cell(args...)</span></code>。</p>
<p>但在调用时，参数只能通过位置参数方式传入，不支持通过键值对方式传入，即不支持在语法<code class="docutils literal notranslate"><span class="pre">cell</span> <span class="pre">=</span> <span class="pre">Cell(arg_name=value)</span></code>。</p>
<p>当前不支持在网络调用<code class="docutils literal notranslate"><span class="pre">Cell</span></code>及其子类相关属性和接口，除非是在<code class="docutils literal notranslate"><span class="pre">Cell</span></code>自己的<code class="docutils literal notranslate"><span class="pre">construct</span></code>中通过<code class="docutils literal notranslate"><span class="pre">self</span></code>调用。</p>
<p><code class="docutils literal notranslate"><span class="pre">Cell</span></code>定义详见<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/master/api_python/nn/mindspore.nn.Cell.html">Cell API文档</a>。</p>
</section>
<section id="parameter">
<h5>Parameter<a class="headerlink" href="#parameter" title="永久链接至标题"></a></h5>
<p><code class="docutils literal notranslate"><span class="pre">Parameter</span></code>是变量张量，代表在训练网络时，需要被更新的参数。</p>
<p><code class="docutils literal notranslate"><span class="pre">Parameter</span></code>的定义和使用详见<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/master/api_python/mindspore/mindspore.Parameter.html#mindspore.Parameter">Parameter API文档</a>。</p>
</section>
</section>
</section>
<section id="运算符">
<h3>运算符<a class="headerlink" href="#运算符" title="永久链接至标题"></a></h3>
<p>算术运算符和赋值运算符支持<code class="docutils literal notranslate"><span class="pre">Number</span></code>和<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>运算，也支持不同<code class="docutils literal notranslate"><span class="pre">dtype</span></code>的<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>运算。详见<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/master/note/static_graph_syntax/operators.html">运算符</a>。</p>
</section>
<section id="原型">
<h3>原型<a class="headerlink" href="#原型" title="永久链接至标题"></a></h3>
<p>原型代表编程语言中最紧密绑定的操作。</p>
<section id="属性引用与修改">
<h4>属性引用与修改<a class="headerlink" href="#属性引用与修改" title="永久链接至标题"></a></h4>
<p>属性引用是后面带有一个句点加一个名称的原型。</p>
<p>在MindSpore的Cell 实例中使用属性引用作为左值需满足如下要求：</p>
<ul class="simple">
<li><p>被修改的属性属于本<code class="docutils literal notranslate"><span class="pre">cell</span></code>对象，即必须为<code class="docutils literal notranslate"><span class="pre">self.xxx</span></code>。</p></li>
<li><p>该属性在Cell的<code class="docutils literal notranslate"><span class="pre">__init__</span></code>函数中完成初始化且其为Parameter类型。</p></li>
</ul>
<p>在JIT语法支持级别选项为<code class="docutils literal notranslate"><span class="pre">LAX</span></code>时，可以支持更多情况的属性修改，具体详见<a class="reference internal" href="#支持属性设置与修改"><span class="std std-doc">支持属性设置与修改</span></a>。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">nn</span><span class="p">,</span> <span class="n">set_context</span>

<span class="n">set_context</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">GRAPH_MODE</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">ms</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">x</span>  <span class="c1"># 满足条件可以修改</span>
        <span class="c1"># self.m = 3     # self.m 非Parameter类型禁止修改</span>
        <span class="c1"># y.weight = x   # y不是self，禁止修改</span>
        <span class="k">return</span> <span class="n">x</span>

<span class="n">net</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
<span class="n">ret</span> <span class="o">=</span> <span class="n">net</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ret:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ret:1
</pre></div>
</div>
</section>
<section id="索引取值">
<h4>索引取值<a class="headerlink" href="#索引取值" title="永久链接至标题"></a></h4>
<p>对序列<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code>、<code class="docutils literal notranslate"><span class="pre">Dictionary</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>的索引取值操作(Python称为抽取)。</p>
<p><code class="docutils literal notranslate"><span class="pre">Tuple</span></code>的索引取值请参考本文的<a class="reference internal" href="#tuple"><span class="std std-doc">Tuple</span></a>章节。</p>
<p><code class="docutils literal notranslate"><span class="pre">List</span></code>的索引取值请参考本文的<a class="reference internal" href="#list"><span class="std std-doc">List</span></a>章节。</p>
<p><code class="docutils literal notranslate"><span class="pre">Dictionary</span></code>的索引取值请参考本文的<a class="reference internal" href="#dictionary"><span class="std std-doc">Dictionary</span></a>章节。</p>
<p><code class="docutils literal notranslate"><span class="pre">Tensor</span></code>的索引取详见<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/master/note/index_support.html#%E7%B4%A2%E5%BC%95%E5%8F%96%E5%80%BC">Tensor 索引取值文档</a>。</p>
</section>
<section id="调用">
<h4>调用<a class="headerlink" href="#调用" title="永久链接至标题"></a></h4>
<p>所谓调用就是附带可能为空的一系列参数来执行一个可调用对象(例如：<code class="docutils literal notranslate"><span class="pre">Cell</span></code>、<code class="docutils literal notranslate"><span class="pre">Primitive</span></code>)。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">nn</span><span class="p">,</span> <span class="n">ops</span><span class="p">,</span> <span class="n">set_context</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">set_context</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">GRAPH_MODE</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matmul</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">MatMul</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>  <span class="c1"># Primitive调用</span>
        <span class="k">return</span> <span class="n">out</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span> <span class="n">ms</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]),</span> <span class="n">ms</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">net</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
<span class="n">ret</span> <span class="o">=</span> <span class="n">net</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ret:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ret:[[3. 3. 3. 3.]]
</pre></div>
</div>
</section>
</section>
<section id="语句">
<h3>语句<a class="headerlink" href="#语句" title="永久链接至标题"></a></h3>
<p>当前静态图模式支持部分Python语句，包括raise语句、assert语句、pass语句、return语句、break语句、continue语句、if语句、for语句、while语句、with语句、列表生成式、生成器表达式、函数定义语句等，详见<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/master/note/static_graph_syntax/statements.html">Python语句</a>。</p>
</section>
<section id="python内置函数">
<h3>Python内置函数<a class="headerlink" href="#python内置函数" title="永久链接至标题"></a></h3>
<p>当前静态图模式支持部分Python内置函数，其使用方法与对应的Python内置函数类似，详见<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/master/note/static_graph_syntax/python_builtin_functions.html">Python内置函数</a>。</p>
</section>
<section id="网络定义">
<h3>网络定义<a class="headerlink" href="#网络定义" title="永久链接至标题"></a></h3>
<section id="网络入参">
<h4>网络入参<a class="headerlink" href="#网络入参" title="永久链接至标题"></a></h4>
<p>在对整网入参求梯度的时候，会忽略非<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>的入参，只计算<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>入参的梯度。</p>
<p>示例如下。整网入参<code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">z)</span></code>中，<code class="docutils literal notranslate"><span class="pre">x</span></code>和<code class="docutils literal notranslate"><span class="pre">z</span></code>是<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，<code class="docutils literal notranslate"><span class="pre">y</span></code>是非<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。因此，<code class="docutils literal notranslate"><span class="pre">grad_net</span></code>在对整网入参<code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">z)</span></code>求梯度的时候，会自动忽略<code class="docutils literal notranslate"><span class="pre">y</span></code>的梯度，只计算<code class="docutils literal notranslate"><span class="pre">x</span></code>和<code class="docutils literal notranslate"><span class="pre">z</span></code>的梯度，返回<code class="docutils literal notranslate"><span class="pre">(grad_x,</span> <span class="pre">grad_z)</span></code>。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">nn</span>

<span class="n">ms</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">GRAPH_MODE</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Net</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">+</span> <span class="n">z</span>

<span class="k">class</span> <span class="nc">GradNet</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">net</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">GradNet</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forward_net</span> <span class="o">=</span> <span class="n">net</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ms</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forward_net</span><span class="p">,</span> <span class="n">grad_position</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>

<span class="n">input_x</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
<span class="n">input_y</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">input_z</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span><span class="mi">3</span><span class="p">])</span>

<span class="n">net</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
<span class="n">grad_net</span> <span class="o">=</span> <span class="n">GradNet</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
<span class="n">ret</span> <span class="o">=</span> <span class="n">grad_net</span><span class="p">(</span><span class="n">input_x</span><span class="p">,</span> <span class="n">input_y</span><span class="p">,</span> <span class="n">input_z</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ret:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ret:(Tensor(shape=[1], dtype=Int64, value= [1]), Tensor(shape=[1], dtype=Int64, value= [1]))
</pre></div>
</div>
</section>
</section>
</section>
<section id="基础语法的语法约束">
<h2>基础语法的语法约束<a class="headerlink" href="#基础语法的语法约束" title="永久链接至标题"></a></h2>
<p>图模式下的执行图是从源码转换而来，并不是所有的Python语法都能支持。下面介绍在基础语法下存在的一些语法约束。更多网络编译问题可见<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/master/faq/network_compilation.html">网络编译</a>。</p>
<ol class="arabic">
<li><p>当<code class="docutils literal notranslate"><span class="pre">construct</span></code>函数里，使用未定义的类成员时，将抛出<code class="docutils literal notranslate"><span class="pre">AttributeError</span></code>异常。示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">nn</span><span class="p">,</span> <span class="n">set_context</span>

<span class="n">set_context</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">GRAPH_MODE</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Net</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>

<span class="n">net</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
<span class="n">net</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>结果报错如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>AttributeError: External object has no attribute y
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">nn.Cell</span></code>不支持<code class="docutils literal notranslate"><span class="pre">classmethod</span></code>修饰的类方法。示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>

<span class="n">ms</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">GRAPH_MODE</span><span class="p">)</span>

 <span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
 <span class="nd">@classmethod</span>
 <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
     <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

 <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

 <span class="n">net</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
 <span class="n">out</span> <span class="o">=</span> <span class="n">net</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
 <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</pre></div>
</div>
<p>结果报错如下：</p>
<div class="highlight-Text notranslate"><div class="highlight"><pre><span></span>TypeError: too many positional arguments
</pre></div>
</div>
</li>
<li><p>在图模式下，有些Python语法难以转换成图模式下的<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/master/design/all_scenarios.html#%E4%B8%AD%E9%97%B4%E8%A1%A8%E7%A4%BAmindir">中间表示MindIR</a>。对标Python的关键字，存在部分关键字在图模式下是不支持的：AsyncFunctionDef、ClassDef、Delete、AnnAssign、AsyncFor、AsyncWith、Match、Try、Import、ImportFrom、Nonlocal、NamedExpr、Set、SetComp、DictComp、Await、Yield、YieldFrom、Starred。如果在图模式下使用相关的语法，将会有相应的报错信息提醒用户。</p>
<p>如果使用Try语句，示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>

<span class="nd">@ms</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">test_try_except</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">global_out</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">global_out</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="n">y</span>
    <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;division by zero, y is zero.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">global_out</span>

<span class="n">test_try_except_out</span> <span class="o">=</span> <span class="n">test_try_except</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;out:&quot;</span><span class="p">,</span> <span class="n">test_try_except_out</span><span class="p">)</span>
</pre></div>
</div>
<p>结果报错如下：</p>
<div class="highlight-Text notranslate"><div class="highlight"><pre><span></span>RuntimeError: Unsupported statement &#39;Try&#39;.
</pre></div>
</div>
</li>
<li><p>对标Python内置数据类型，除去当前图模式下支持的<a class="reference internal" href="#python内置数据类型"><span class="std std-doc">Python内置数据类型</span></a>，复数<code class="docutils literal notranslate"><span class="pre">complex</span></code>和集合<code class="docutils literal notranslate"><span class="pre">set</span></code>类型是不支持的。列表<code class="docutils literal notranslate"><span class="pre">list</span></code>和字典<code class="docutils literal notranslate"><span class="pre">dictionary</span></code>的一些高阶用法在基础语法场景下是不支持的，需要在JIT语法支持级别选项<code class="docutils literal notranslate"><span class="pre">jit_syntax_level</span></code>为<code class="docutils literal notranslate"><span class="pre">LAX</span></code>时才支持，更多请参考本文的<a class="reference internal" href="#扩展语法lax级别"><span class="std std-doc">扩展语法（LAX级别）</span></a>章节。</p></li>
<li><p>对标Python的内置函数，在基础语法场景下，除去当前图模式下支持的<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/master/note/static_graph_syntax/python_builtin_functions.html">Python内置函数</a>，仍存在部分内置函数在图模式下是不支持的，例如：basestring、bin、bytearray、callable、chr、cmp、compile、 delattr、dir、divmod、eval、execfile、file、frozenset、hash、hex、id、input、issubclass、iter、locals、long、memoryview、next、object、oct、open、ord、property、raw_input、reduce、reload、repr、reverse、set、slice、sorted、unichr、unicode、vars、xrange、__import__。</p></li>
<li><p>Python提供了很多第三方库，通常需要通过import语句调用。在图模式下JIT语法支持级别为STRICT时，不能直接使用第三方库。如果需要在图模式下使用第三方库的数据类型或者调用第三方库的方法，需要在JIT语法支持级别选项<code class="docutils literal notranslate"><span class="pre">jit_syntax_level</span></code>为<code class="docutils literal notranslate"><span class="pre">LAX</span></code>时才支持，更多请参考本文的<a class="reference internal" href="#扩展语法lax级别"><span class="std std-doc">扩展语法（LAX级别）</span></a>中的<a class="reference internal" href="#调用第三方库"><span class="std std-doc">调用第三方库</span></a>章节。</p></li>
<li><p>在图模式下JIT语法支持级别为STRICT时，不能直接使用自定义类的对象，属性和方法。如果需要在图模式下使用自定义类的信息，更多请参考本文的<a class="reference internal" href="#扩展语法lax级别"><span class="std std-doc">扩展语法（LAX级别）</span></a>中的<a class="reference internal" href="#支持自定义类的使用"><span class="std std-doc">支持自定义类的使用</span></a>章节。</p>
<p>例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>

<span class="n">ms</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">GRAPH_MODE</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">GetattrClass</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attr1</span> <span class="o">=</span> <span class="mi">99</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attr2</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">method1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">attr2</span>

<span class="k">class</span> <span class="nc">GetattrClassNet</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">GetattrClassNet</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cls</span> <span class="o">=</span> <span class="n">GetattrClass</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cls</span><span class="o">.</span><span class="n">method1</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cls</span><span class="o">.</span><span class="n">attr1</span><span class="p">)</span>

<span class="n">net</span> <span class="o">=</span> <span class="n">GetattrClassNet</span><span class="p">()</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">net</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">out</span> <span class="o">==</span> <span class="mi">100</span>
</pre></div>
</div>
<p>将会有相关报错：</p>
<div class="highlight-Text notranslate"><div class="highlight"><pre><span></span>TypeError: Do not support to convert &lt;class &#39;__main__.GetattrClass&#39;&gt; object into graph node.
</pre></div>
</div>
</li>
</ol>
</section>
<section id="扩展语法lax级别">
<h2>扩展语法（LAX级别）<a class="headerlink" href="#扩展语法lax级别" title="永久链接至标题"></a></h2>
<p>下面主要介绍当前扩展支持的静态图语法。</p>
<section id="调用第三方库">
<h3>调用第三方库<a class="headerlink" href="#调用第三方库" title="永久链接至标题"></a></h3>
<ul>
<li><p>第三方库</p>
<ol class="arabic simple">
<li><p>Python内置模块和Python标准库。例如<code class="docutils literal notranslate"><span class="pre">os</span></code>、<code class="docutils literal notranslate"><span class="pre">sys</span></code>、<code class="docutils literal notranslate"><span class="pre">math</span></code>、<code class="docutils literal notranslate"><span class="pre">time</span></code>等模块。</p></li>
<li><p>第三方代码库。路径在Python安装目录的<code class="docutils literal notranslate"><span class="pre">site-packages</span></code>目录下，需要先安装后导入，例如<code class="docutils literal notranslate"><span class="pre">NumPy</span></code>、<code class="docutils literal notranslate"><span class="pre">SciPy</span></code>等。需要注意的是，<code class="docutils literal notranslate"><span class="pre">mindyolo</span></code>、<code class="docutils literal notranslate"><span class="pre">mindflow</span></code>等MindSpore套件不被视作第三方库。</p></li>
<li><p>通过环境变量<code class="docutils literal notranslate"><span class="pre">MS_JIT_IGNORE_MODULES</span></code>指定的模块。与之相对的有环境变量<code class="docutils literal notranslate"><span class="pre">MS_JIT_MODULES</span></code>，具体使用方法请参考<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/master/note/env_var_list.html">环境变量</a>。</p></li>
</ol>
</li>
<li><p>支持第三方库的数据类型，允许调用和返回第三方库的对象。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>

<span class="nd">@ms</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
    <span class="k">return</span> <span class="n">out</span>

<span class="nb">print</span><span class="p">(</span><span class="n">func</span><span class="p">())</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[5 7 9]
</pre></div>
</div>
</li>
<li><p>支持调用第三方库的方法。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">linalg</span>
<span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>

<span class="nd">@ms</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]</span>
    <span class="k">return</span> <span class="n">linalg</span><span class="o">.</span><span class="n">qr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">out</span> <span class="o">=</span> <span class="n">func</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>(2, 2)
</pre></div>
</div>
</li>
<li><p>支持使用NumPy第三方库数据类型创建Tensor对象。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>

<span class="nd">@ms</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">out</span>

<span class="nb">print</span><span class="p">(</span><span class="n">func</span><span class="p">())</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[2, 3, 4]
</pre></div>
</div>
</li>
<li><p>暂不支持对第三方库数据类型的下标索引赋值。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>

<span class="nd">@ms</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
    <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">res</span> <span class="o">=</span> <span class="n">func</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;res: &quot;</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
</pre></div>
</div>
<p>报错信息如下:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>RuntimeError: For operation &#39;setitem&#39;, current input arguments types are &lt;External, Number, Number&gt;. The 1-th argument type &#39;External&#39; is not supported now.
</pre></div>
</div>
</li>
</ul>
</section>
<section id="支持自定义类的使用">
<h3>支持自定义类的使用<a class="headerlink" href="#支持自定义类的使用" title="永久链接至标题"></a></h3>
<p>支持在图模式下使用用户自定义的类，可以对类进行实例化，使用对象的属性及方法。</p>
<p>例如下面的例子，其中<code class="docutils literal notranslate"><span class="pre">GetattrClass</span></code>是用户自定义的类，没有使用<code class="docutils literal notranslate"><span class="pre">&#64;ms_class</span></code>修饰，也没有继承<code class="docutils literal notranslate"><span class="pre">nn.Cell</span></code>。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>

<span class="n">ms</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">GRAPH_MODE</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">GetattrClass</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attr1</span> <span class="o">=</span> <span class="mi">99</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attr2</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">method1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">attr2</span>

<span class="k">class</span> <span class="nc">GetattrClassNet</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">GetattrClassNet</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cls</span> <span class="o">=</span> <span class="n">GetattrClass</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cls</span><span class="o">.</span><span class="n">method1</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cls</span><span class="o">.</span><span class="n">attr1</span><span class="p">)</span>

<span class="n">net</span> <span class="o">=</span> <span class="n">GetattrClassNet</span><span class="p">()</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">net</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">out</span> <span class="o">==</span> <span class="mi">100</span>
</pre></div>
</div>
</section>
<section id="基础运算符支持更多数据类型">
<h3>基础运算符支持更多数据类型<a class="headerlink" href="#基础运算符支持更多数据类型" title="永久链接至标题"></a></h3>
<p>在静态图语法重载了以下运算符: [‘+’, ‘-’, ‘*’, ‘/’, ‘//’, ‘%’, ‘**’, ‘&lt;&lt;’, ‘&gt;&gt;’, ‘&amp;’, ‘|’, ‘^’, ‘not’, ‘==’, ‘!=’, ‘&lt;’, ‘&gt;’, ‘&lt;=’, ‘&gt;=’, ‘in’, ‘not in’, ‘y=x[0]’]。图模式重载的运算符详见<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/master/note/static_graph_syntax/operators.html">运算符</a>。列表中的运算符在输入图模式中不支持的输入类型时将使用扩展静态图语法支持，并使输出结果与动态图模式下的输出结果一致。</p>
<p>代码用例如下。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">import</span> <span class="nn">mindspore.nn</span> <span class="k">as</span> <span class="nn">nn</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">Tensor</span>
<span class="n">ms</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">GRAPH_MODE</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">InnerClass</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">()</span> <span class="o">+</span> <span class="n">y</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">()</span>

<span class="n">net</span> <span class="o">=</span> <span class="n">InnerClass</span><span class="p">()</span>
<span class="n">ret</span> <span class="o">=</span> <span class="n">net</span><span class="p">(</span><span class="n">Tensor</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]),</span> <span class="n">Tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[5 7]
</pre></div>
</div>
<p>上述例子中，<code class="docutils literal notranslate"><span class="pre">.asnumpy()</span></code>输出的数据类型:  <code class="docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>为运算符<code class="docutils literal notranslate"><span class="pre">+</span></code>在图模式中不支持的输入类型。因此<code class="docutils literal notranslate"><span class="pre">x.asnumpy()</span> <span class="pre">+</span> <span class="pre">y.asnumpy()</span></code>将使用扩展语法支持。</p>
<p>在另一个用例中：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">InnerClass</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">in</span> <span class="p">((</span><span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="n">net</span> <span class="o">=</span> <span class="n">InnerClass</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">net</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">tuple</span></code> in <code class="docutils literal notranslate"><span class="pre">tuple</span></code>在原本的图模式中是不支持的运算，现已使用扩展静态图语法支持。</p>
</section>
<section id="基础类型">
<h3>基础类型<a class="headerlink" href="#基础类型" title="永久链接至标题"></a></h3>
<p>扩展对Python原生数据类型<code class="docutils literal notranslate"><span class="pre">List</span></code>、<code class="docutils literal notranslate"><span class="pre">Dictionary</span></code>、<code class="docutils literal notranslate"><span class="pre">None</span></code>的支持。</p>
<section id="支持列表就地修改操作">
<h4>支持列表就地修改操作<a class="headerlink" href="#支持列表就地修改操作" title="永久链接至标题"></a></h4>
<p>列表<code class="docutils literal notranslate"><span class="pre">List</span></code>以及元组<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>是Python中最基本的序列内置类型，<code class="docutils literal notranslate"><span class="pre">List</span></code>与<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>最核心的区别是<code class="docutils literal notranslate"><span class="pre">List</span></code>是可以改变的对象，而<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>是不可以更改的。这意味着<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>一旦被创建，就不可以在对象地址不变的情况下更改。而<code class="docutils literal notranslate"><span class="pre">List</span></code>则可以通过一系列inplace操作，在不改变对象地址的情况下，对对象进行修改。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="n">a_id</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">a_after_id</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">a_id</span> <span class="o">==</span> <span class="n">a_after_id</span>
</pre></div>
</div>
<p>上述示例代码中，通过<code class="docutils literal notranslate"><span class="pre">append</span></code>这个inplace语法更改<code class="docutils literal notranslate"><span class="pre">List</span></code>对象的时候，其对象的地址并没有被修改。而<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>是不支持这种inplace操作的。在<code class="docutils literal notranslate"><span class="pre">JIT_SYNTAX_LEVEL</span></code>设置为<code class="docutils literal notranslate"><span class="pre">LAX</span></code>的情况下，静态图模式可以支持部分<code class="docutils literal notranslate"><span class="pre">List</span></code>对象的inplace操作。</p>
<p>具体使用场景如下：</p>
<ul>
<li><p>支持从全局变量中获取原<code class="docutils literal notranslate"><span class="pre">List</span></code>对象。</p>
<p>在下面示例中，静态图获取到<code class="docutils literal notranslate"><span class="pre">List</span></code>对象，并在原有对象上进行了图模式支持的inplace操作<code class="docutils literal notranslate"><span class="pre">list.reverse()</span></code>, 并将原有对象返回。可以看到图模式返回的对象与原有的全局变量对象id相同，即两者为同一对象。若<code class="docutils literal notranslate"><span class="pre">JIT_SYNTAX_LEVEL</span></code>设置为<code class="docutils literal notranslate"><span class="pre">STRICT</span></code>选项，则返回的<code class="docutils literal notranslate"><span class="pre">List</span></code>对象与全局对象为两个不同的对象。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>

<span class="n">global_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>

<span class="nd">@ms</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">list_func</span><span class="p">():</span>
    <span class="n">global_list</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">global_list</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">list_func</span><span class="p">()</span>  <span class="c1"># output: [4, 3, 2, 1]</span>
<span class="k">assert</span> <span class="nb">id</span><span class="p">(</span><span class="n">global_list</span><span class="p">)</span> <span class="o">==</span> <span class="nb">id</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>不支持对输入<code class="docutils literal notranslate"><span class="pre">List</span></code>对象进行inplace操作。</p>
<p><code class="docutils literal notranslate"><span class="pre">List</span></code>作为静态图输入时，会对该<code class="docutils literal notranslate"><span class="pre">List</span></code>对象进行一次复制，并使用该复制对象进行后续的计算，因此无法对原输入对象进行inplace操作。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>

<span class="n">list_input</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>

<span class="nd">@ms</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">list_func</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">x</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">x</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">list_func</span><span class="p">()</span>  <span class="c1"># output: [4, 3, 2, 1]  list_input: [1, 2, 3, 4]</span>
<span class="k">assert</span> <span class="nb">id</span><span class="p">(</span><span class="n">output</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">id</span><span class="p">(</span><span class="n">list_input</span><span class="p">)</span>
</pre></div>
</div>
<p>如上述用例所示，<code class="docutils literal notranslate"><span class="pre">List</span></code>对象作为图模式输入时无法在原有对象上进行inplace操作。图模式返回的对象与输入的对象id不同，为不同对象。</p>
</li>
<li><p>支持部分<code class="docutils literal notranslate"><span class="pre">List</span></code>内置函数的就地修改操作。</p>
<p>在<code class="docutils literal notranslate"><span class="pre">JIT_SYNTAX_LEVEL</span></code>设置为<code class="docutils literal notranslate"><span class="pre">LAX</span></code>的情况下，图模式部分<code class="docutils literal notranslate"><span class="pre">List</span></code>内置函数支持inplace。在 <code class="docutils literal notranslate"><span class="pre">JIT_SYNTAX_LEVEL</span></code>为 <code class="docutils literal notranslate"><span class="pre">STRICT</span></code> 的情况下，所有方法均不支持inplace操作。</p>
<p>目前，图模式支持的<code class="docutils literal notranslate"><span class="pre">List</span></code>就地修改内置方法有<code class="docutils literal notranslate"><span class="pre">extend</span></code>、<code class="docutils literal notranslate"><span class="pre">pop</span></code>、<code class="docutils literal notranslate"><span class="pre">reverse</span></code>以及<code class="docutils literal notranslate"><span class="pre">insert</span></code>。内置方法<code class="docutils literal notranslate"><span class="pre">append</span></code>、<code class="docutils literal notranslate"><span class="pre">clear</span></code>以及索引赋值暂不支持就地修改，后续版本将会支持。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>

<span class="n">list_input</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>

<span class="nd">@ms</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">list_func</span><span class="p">():</span>
    <span class="n">list_input</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">list_input</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">list_func</span><span class="p">()</span>  <span class="c1"># output: [4, 3, 2, 1]  list_input: [4, 3, 2, 1]</span>
<span class="k">assert</span> <span class="nb">id</span><span class="p">(</span><span class="n">output</span><span class="p">)</span> <span class="o">==</span> <span class="nb">id</span><span class="p">(</span><span class="n">list_input</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="支持dictionary的高阶用法">
<h4>支持Dictionary的高阶用法<a class="headerlink" href="#支持dictionary的高阶用法" title="永久链接至标题"></a></h4>
<ul>
<li><p>支持顶图返回Dictionary。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>

<span class="nd">@ms</span><span class="o">.</span><span class="n">jit</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test_dict</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="s1">&#39;b&#39;</span><span class="p">}</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">z</span>

<span class="n">out</span> <span class="o">=</span> <span class="n">test_dict</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;out:&quot;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>out:{&#39;y&#39;: &#39;a&#39;}
</pre></div>
</div>
</li>
<li><p>支持Dictionary索引取值和赋值。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">x</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])),</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])),</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]))}</span>

<span class="nd">@ms</span><span class="o">.</span><span class="n">jit</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test_dict</span><span class="p">():</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">]</span>
    <span class="n">x</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

<span class="n">out1</span><span class="p">,</span> <span class="n">out2</span> <span class="o">=</span> <span class="n">test_dict</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;out1:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">out1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;out2:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">out2</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>out1:{&#39;a&#39;: (2, 3, 4), &#39;b&#39;: Tensor(shape=[3], dtype=Int64, value= [4, 5, 6]), &#39;c&#39;: Tensor(shape=[3], dtype=Int64, value= [7, 8, 9])}
out2:[4 5 6]
</pre></div>
</div>
</li>
</ul>
</section>
<section id="支持使用none">
<h4>支持使用None<a class="headerlink" href="#支持使用none" title="永久链接至标题"></a></h4>
<p><code class="docutils literal notranslate"><span class="pre">None</span></code>是Python中的一个特殊值，表示空，可以赋值给任何变量。对于没有返回值语句的函数认为返回<code class="docutils literal notranslate"><span class="pre">None</span></code>。同时也支持<code class="docutils literal notranslate"><span class="pre">None</span></code>作为顶图或者子图的入参或者返回值。支持<code class="docutils literal notranslate"><span class="pre">None</span></code>作为切片的下标，作为<code class="docutils literal notranslate"><span class="pre">List</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">Dictionary</span></code>的输入。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>

<span class="nd">@ms</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">test_return_none</span><span class="p">():</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="kc">None</span>

<span class="n">res</span> <span class="o">=</span> <span class="n">test_return_none</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></div>
</div>
<p>输出结果：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>(1, &#39;a&#39;, None)
</pre></div>
</div>
<p>对于没有返回值的函数，默认返回<code class="docutils literal notranslate"><span class="pre">None</span></code>对象。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>

<span class="nd">@ms</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;x:&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

<span class="n">res</span> <span class="o">=</span> <span class="n">foo</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">res</span> <span class="ow">is</span> <span class="kc">None</span>
</pre></div>
</div>
<p>如下面例子，<code class="docutils literal notranslate"><span class="pre">None</span></code>作为顶图的默认入参。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>

<span class="nd">@ms</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;y:&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;y is None&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;x:&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">y</span>

<span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">foo</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">res</span> <span class="ow">is</span> <span class="kc">None</span>
</pre></div>
</div>
</section>
</section>
<section id="内置函数支持更多数据类型">
<h3>内置函数支持更多数据类型<a class="headerlink" href="#内置函数支持更多数据类型" title="永久链接至标题"></a></h3>
<p>扩展内置函数的支持范围。Python内置函数完善支持更多输入类型，例如第三方库数据类型。</p>
<p>例如下面的例子，<code class="docutils literal notranslate"><span class="pre">x.asnumpy()</span></code>和<code class="docutils literal notranslate"><span class="pre">np.ndarray</span></code>均是扩展支持的类型。更多内置函数的支持情况可见<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/master/note/static_graph_syntax/python_builtin_functions.html">Python内置函数</a>章节。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">import</span> <span class="nn">mindspore.nn</span> <span class="k">as</span> <span class="nn">nn</span>

<span class="n">ms</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">GRAPH_MODE</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(),</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]))</span>
<span class="n">net</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">net</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">out</span>
</pre></div>
</div>
</section>
<section id="支持控制流">
<h3>支持控制流<a class="headerlink" href="#支持控制流" title="永久链接至标题"></a></h3>
<p>为了提高Python标准语法支持度，实现动静统一，扩展支持更多数据类型在控制流语句的使用。控制流语句是指<code class="docutils literal notranslate"><span class="pre">if</span></code>、<code class="docutils literal notranslate"><span class="pre">for</span></code>、<code class="docutils literal notranslate"><span class="pre">while</span></code>等流程控制语句。理论上，通过扩展支持的语法，在控制流场景中也支持。代码用例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>

<span class="nd">@ms</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">res</span> <span class="o">=</span> <span class="n">func</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;res: &quot;</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>res: 2
</pre></div>
</div>
</section>
<section id="支持属性设置与修改">
<h3>支持属性设置与修改<a class="headerlink" href="#支持属性设置与修改" title="永久链接至标题"></a></h3>
<p>具体使用场景如下：</p>
<ul>
<li><p>对自定义类对象以及第三方类型的属性进行设置与修改。</p>
<p>图模式下支持对自定义类对象的属性进行设置与修改，例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="nn">jit</span>

<span class="k">class</span> <span class="nc">AssignClass</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">obj</span> <span class="o">=</span> <span class="n">AssignClass</span><span class="p">()</span>

<span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="k">return</span>

<span class="n">foo</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;obj.x is: </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>运行结果为：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>obj.x is: 100
</pre></div>
</div>
<p>图模式下支持对第三方库对象的属性进行设置与修改，例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="nn">jit</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
    <span class="n">a</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span>

<span class="n">shape</span> <span class="o">=</span> <span class="n">foo</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;shape is </span><span class="si">{</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>运行结果为：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>shape is (2, 2)
</pre></div>
</div>
</li>
<li><p>对Cell的self对象进行修改，例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">nn</span><span class="p">,</span> <span class="n">set_context</span>
<span class="n">set_context</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">GRAPH_MODE</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="mi">2</span>

  <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="mi">3</span>
      <span class="k">return</span>

<span class="n">net</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
<span class="n">net</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;net.m is </span><span class="si">{</span><span class="n">net</span><span class="o">.</span><span class="n">m</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>运行结果为：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>net.m is 3
</pre></div>
</div>
<p>注意，self对象只支持属性修改，而不支持属性的设置，即只支持对<code class="docutils literal notranslate"><span class="pre">__init__</span></code>函数内设置的属性进行修改。若<code class="docutils literal notranslate"><span class="pre">__init__</span></code>内没有定义某个属性，则图模式内不允许设置此属性。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">nn</span><span class="p">,</span> <span class="n">set_context</span>
<span class="n">set_context</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">GRAPH_MODE</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="mi">2</span>

  <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">m2</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1"># self.m2在__init__内没有被设置，因此无法在图模式内进行设置</span>
      <span class="k">return</span>

<span class="n">net</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
<span class="n">net</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p>对静态图内的Cell对象以及jit_class对象进行设置与修改。</p>
<p>支持对图模式Cell对象进行属性修改，例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">nn</span><span class="p">,</span> <span class="n">set_context</span>
<span class="n">set_context</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">GRAPH_MODE</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">InnerNet</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">InnerNet</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">10</span>

<span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="nb">super</span><span class="p">(</span><span class="n">Net</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">inner</span> <span class="o">=</span> <span class="n">InnerNet</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">100</span>
      <span class="k">return</span>

<span class="n">net</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
<span class="n">net</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;net.inner.x is </span><span class="si">{</span><span class="n">net</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>运行结果为：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>net.inner.x is 100
</pre></div>
</div>
<p>支持对图模式jit_class对象进行属性修改，例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">nn</span><span class="p">,</span> <span class="n">set_context</span><span class="p">,</span> <span class="n">jit_class</span>
<span class="n">set_context</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">GRAPH_MODE</span><span class="p">)</span>

<span class="nd">@jit_class</span>
<span class="k">class</span> <span class="nc">InnerClass</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">10</span>

<span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="nb">super</span><span class="p">(</span><span class="n">Net</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">inner</span> <span class="o">=</span> <span class="n">InnerClass</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">100</span>
      <span class="k">return</span>

<span class="n">net</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
<span class="n">net</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;net.inner.x is </span><span class="si">{</span><span class="n">net</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>运行结果为：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>net.inner.x is 100
</pre></div>
</div>
<p>注意，若在图模式内对Cell/jit_class对象进行属性修改前也获取了相同属性，该获取到的属性会被解析为常量。在多次运行相同网络时可能会造成问题，例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">nn</span><span class="p">,</span> <span class="n">set_context</span>
<span class="n">set_context</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">GRAPH_MODE</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">InnerNet</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">inner</span> <span class="o">=</span> <span class="n">InnerNet</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">x</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">1</span>
      <span class="k">return</span>

<span class="n">net</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
<span class="n">value0</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">x</span>
<span class="n">net</span><span class="p">()</span>
<span class="n">value1</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">x</span>
<span class="n">net</span><span class="p">()</span>
<span class="n">value2</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">x</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;value0 is </span><span class="si">{</span><span class="n">value0</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;value1 is </span><span class="si">{</span><span class="n">value1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;value2 is </span><span class="si">{</span><span class="n">value2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>运行结果为：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>value0 is 1
value1 is 2
value2 is 2
</pre></div>
</div>
<p>但是在动态图模式下，<code class="docutils literal notranslate"><span class="pre">value2</span></code>的值应该为3。但因为语句<code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">=</span> <span class="pre">self.inner.x</span></code>中的<code class="docutils literal notranslate"><span class="pre">self.inner.x</span></code>被固化为常量2，导致两次运行时<code class="docutils literal notranslate"><span class="pre">self.inner.x</span></code>被设置的值均为2。此问题将在后续版本解决。</p>
</li>
</ul>
</section>
<section id="支持求导">
<h3>支持求导<a class="headerlink" href="#支持求导" title="永久链接至标题"></a></h3>
<p>扩展支持的静态图语法，同样支持其在求导中使用，例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">ops</span>

<span class="nd">@ms</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">dict_net</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">a</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

<span class="n">out</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">dict_net</span><span class="p">)(</span><span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">]))</span>
<span class="k">assert</span> <span class="n">out</span> <span class="o">==</span> <span class="mi">2</span>
</pre></div>
</div>
</section>
<section id="annotation-type">
<h3>Annotation Type<a class="headerlink" href="#annotation-type" title="永久链接至标题"></a></h3>
<p>对于运行时的扩展支持的语法，会产生一些无法被类型推导出的节点，比如动态创建Tensor等。这种类型称为<code class="docutils literal notranslate"><span class="pre">Any</span></code>类型。因为该类型无法在编译时推导出正确的类型，所以这种<code class="docutils literal notranslate"><span class="pre">Any</span></code>将会以一种默认最大精度<code class="docutils literal notranslate"><span class="pre">Float64</span></code>进行运算，防止其精度丢失。为了能更好的优化相关性能，需要减少<code class="docutils literal notranslate"><span class="pre">Any</span></code>类型数据的产生。当用户可以明确知道当前通过扩展支持的语句会产生具体类型的时候，我们推荐使用<code class="docutils literal notranslate"><span class="pre">Annotation</span> <span class="pre">&#64;jit.typing:</span></code>的方式进行指定对应Python语句类型，从而确定解释节点的类型避免<code class="docutils literal notranslate"><span class="pre">Any</span></code>类型的生成。</p>
<p>例如，<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/master/api_python/mindspore/mindspore.Tensor.html#mindspore.Tensor">Tensor</a>类和<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/master/api_python/mindspore/mindspore.tensor.html#mindspore.tensor">tensor</a>接口的区别就在于在<code class="docutils literal notranslate"><span class="pre">tensor</span></code>接口内部运用了Annotation Type机制。当<code class="docutils literal notranslate"><span class="pre">tensor</span></code>函数的<code class="docutils literal notranslate"><span class="pre">dtype</span></code>确定时，函数内部会利用<code class="docutils literal notranslate"><span class="pre">Annotation</span></code>指定输出类型从而避免<code class="docutils literal notranslate"><span class="pre">Any</span></code>类型的产生。<code class="docutils literal notranslate"><span class="pre">Annotation</span> <span class="pre">Type</span></code>的使用只需要在对应Python语句上面或者后面加上注释 <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">&#64;jit.typing:</span> <span class="pre">()</span> <span class="pre">-&gt;</span> <span class="pre">tensor_type[float32]</span></code> 即可，其中 <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> 后面的 <code class="docutils literal notranslate"><span class="pre">tensor_type[float32]</span></code> 指示了被注释的语句输出类型。</p>
<p>代码用例如下。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">import</span> <span class="nn">mindspore.nn</span> <span class="k">as</span> <span class="nn">nn</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">ops</span><span class="p">,</span> <span class="n">Tensor</span>

<span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Net</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abs</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">Abs</span><span class="p">()</span>

    <span class="nd">@ms</span><span class="o">.</span><span class="n">jit</span>
    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">()</span> <span class="o">+</span> <span class="n">y</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">()</span> <span class="o">+</span> <span class="n">y</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="c1"># @jit.typing: () -&gt; tensor_type[float32]</span>
        <span class="n">y3</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">()</span> <span class="o">+</span> <span class="n">y</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">())</span>
        <span class="n">y4</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">()</span> <span class="o">+</span> <span class="n">y</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y1</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y2</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y3</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y4</span><span class="p">)</span>

<span class="n">ms</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">GRAPH_MODE</span><span class="p">)</span>
<span class="n">net</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span> <span class="n">y4</span> <span class="o">=</span> <span class="n">net</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;y1 value is </span><span class="si">{</span><span class="n">y1</span><span class="si">}</span><span class="s2">, dtype is </span><span class="si">{</span><span class="n">y1</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;y2 value is </span><span class="si">{</span><span class="n">y2</span><span class="si">}</span><span class="s2">, dtype is </span><span class="si">{</span><span class="n">y2</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;y3 value is </span><span class="si">{</span><span class="n">y3</span><span class="si">}</span><span class="s2">, dtype is </span><span class="si">{</span><span class="n">y3</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;y4 value is </span><span class="si">{</span><span class="n">y4</span><span class="si">}</span><span class="s2">, dtype is </span><span class="si">{</span><span class="n">y4</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>y1 value is 2.0, dtype is Float32
y2 value is 2.0, dtype is Float32
y3 value is 2.0, dtype is Float64
y4 value is 2.0, dtype is Float64
</pre></div>
</div>
<p>上述例子，可以看到创建了<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>的相关区别。对于<code class="docutils literal notranslate"><span class="pre">y3</span></code>、<code class="docutils literal notranslate"><span class="pre">y4</span></code>，因为<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>类没有增加<code class="docutils literal notranslate"><span class="pre">Annotation</span></code>指示，<code class="docutils literal notranslate"><span class="pre">y3</span></code>、<code class="docutils literal notranslate"><span class="pre">y4</span></code>没有办法推出正确的类型，导致只能按照最高精度<code class="docutils literal notranslate"><span class="pre">Float64</span></code>进行运算。
对于<code class="docutils literal notranslate"><span class="pre">y2</span></code>，由于创建<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>时，通过<code class="docutils literal notranslate"><span class="pre">Annotation</span></code>指定了对应类型，使得其类型可以按照指定类型进行运算。
对于<code class="docutils literal notranslate"><span class="pre">y1</span></code>，由于使用了<code class="docutils literal notranslate"><span class="pre">tensor</span></code>函数接口创建<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，传入的<code class="docutils literal notranslate"><span class="pre">dtype</span></code>参数作为<code class="docutils literal notranslate"><span class="pre">Annotation</span></code>的指定类型，所以也避免了<code class="docutils literal notranslate"><span class="pre">Any</span></code>类型的产生。</p>
</section>
</section>
<section id="扩展语法的语法约束">
<h2>扩展语法的语法约束<a class="headerlink" href="#扩展语法的语法约束" title="永久链接至标题"></a></h2>
<p>在使用静态图扩展支持语法时，请注意以下几点：</p>
<ol class="arabic simple">
<li><p>对标动态图的支持能力，即：须在动态图语法范围内，包括但不限于数据类型等。</p></li>
<li><p>在扩展静态图语法时，支持了更多的语法，但执行性能可能会受影响，不是最佳。</p></li>
<li><p>在扩展静态图语法时，支持了更多的语法，由于使用Python的能力，不能使用MindIR导入导出的能力。</p></li>
<li><p>暂不支持跨Python文件重复定义同名的全局变量，且这些全局变量在网络中会被用到。</p></li>
</ol>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../migration_guide/tensorflow2mindspore.html" class="btn btn-neutral float-left" title="TensorFlow模型转换MindSpore模型的方法" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="static_graph_syntax/operators.html" class="btn btn-neutral float-right" title="静态图语法-运算符" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2022, MindSpore.</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用了 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a>开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 
</body>
</html>