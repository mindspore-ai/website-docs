

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>静态图语法支持 &mdash; MindSpore master documentation</title>
  

  
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/bootstrap.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/training.css" type="text/css" />
   
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  
  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/js/training.js"></script>
        
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tensor索引支持" href="index_support.html" />
    <link rel="prev" title="语法支持" href="syntax_list.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> MindSpore
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">设计</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../design/all_scenarios.html">全场景统一</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/auto_gradient.html">函数式微分编程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/dynamic_graph_and_static_graph.html">动静态图结合</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/heterogeneous_training.html">异构并行训练</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/distributed_training_design.html">分布式并行</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/mindir.html">中间表达MindIR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/data_engine.html">高性能数据处理引擎</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/graph_fusion_engine.html">图算融合加速引擎</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/thor.html">二阶优化</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.mindspore.cn/mindinsight/docs/zh-CN/r1.8/training_visual_design.html">可视化调试调优↗</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.mindspore.cn/mindarmour/docs/zh-CN/r1.8/design.html">安全可信↗</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/glossary.html">术语</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">规格</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="benchmark.html">基准性能</a></li>
<li class="toctree-l1"><a class="reference internal" href="network_list.html">网络支持</a></li>
<li class="toctree-l1"><a class="reference internal" href="operator_list.html">算子支持</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="syntax_list.html">语法支持</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">静态图语法支持</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#概述">概述</a></li>
<li class="toctree-l3"><a class="reference internal" href="#数据类型">数据类型</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#python内置数据类型">Python内置数据类型</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mindspore自定义数据类型">MindSpore自定义数据类型</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#原型">原型</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#属性引用">属性引用</a></li>
<li class="toctree-l4"><a class="reference internal" href="#索引取值">索引取值</a></li>
<li class="toctree-l4"><a class="reference internal" href="#调用">调用</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#运算符">运算符</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#单目算术运算符">单目算术运算符</a></li>
<li class="toctree-l4"><a class="reference internal" href="#二元算术运算符">二元算术运算符</a></li>
<li class="toctree-l4"><a class="reference internal" href="#赋值运算符">赋值运算符</a></li>
<li class="toctree-l4"><a class="reference internal" href="#逻辑运算符">逻辑运算符</a></li>
<li class="toctree-l4"><a class="reference internal" href="#比较运算符">比较运算符</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#复合语句">复合语句</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#条件控制语句">条件控制语句</a></li>
<li class="toctree-l4"><a class="reference internal" href="#循环语句">循环语句</a></li>
<li class="toctree-l4"><a class="reference internal" href="#函数定义语句">函数定义语句</a></li>
<li class="toctree-l4"><a class="reference internal" href="#列表生成式和生成器表达式">列表生成式和生成器表达式</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#函数">函数</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#python内置函数">Python内置函数</a></li>
<li class="toctree-l4"><a class="reference internal" href="#函数参数">函数参数</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#网络定义">网络定义</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#网络入参">网络入参</a></li>
<li class="toctree-l4"><a class="reference internal" href="#网络实例类型">网络实例类型</a></li>
<li class="toctree-l4"><a class="reference internal" href="#网络构造组件">网络构造组件</a></li>
<li class="toctree-l4"><a class="reference internal" href="#网络使用约束">网络使用约束</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index_support.html">Tensor索引支持</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api_python/mindspore.html">mindspore</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_python/mindspore.amp.html">mindspore.amp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_python/mindspore.common.initializer.html">mindspore.common.initializer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_python/mindspore.communication.html">mindspore.communication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_python/mindspore.dataset.html">mindspore.dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_python/mindspore.dataset.audio.html">mindspore.dataset.audio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_python/mindspore.dataset.config.html">mindspore.dataset.config</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_python/mindspore.dataset.text.html">mindspore.dataset.text</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_python/mindspore.dataset.transforms.html">mindspore.dataset.transforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_python/mindspore.dataset.vision.html">mindspore.dataset.vision</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_python/mindspore.mindrecord.html">mindspore.mindrecord</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_python/mindspore.nn.html">mindspore.nn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_python/mindspore.nn.probability.html">mindspore.nn.probability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_python/mindspore.nn.transformer.html">mindspore.nn.transformer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_python/mindspore.numpy.html">mindspore.numpy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_python/mindspore.ops.html">mindspore.ops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_python/mindspore.ops.functional.html">mindspore.ops.functional</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_python/mindspore.parallel.nn.html">mindspore.parallel.nn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_python/mindspore.scipy.html">mindspore.scipy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_python/mindspore.boost.html">mindspore.boost</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.mindspore.cn/lite/api/zh-CN/r1.8/api_cpp/mindspore.html">C++ API↗</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API映射</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api_mapping/pytorch_api_mapping.html">PyTorch与MindSpore</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_mapping/tensorflow_api_mapping.html">TensorFlow与MindSpore</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">迁移指南</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../migration_guide/overview.html">概述</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration_guide/preparation.html">准备工作</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration_guide/script_analysis.html">网络脚本分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration_guide/script_development.html">网络脚本开发</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration_guide/neural_network_debug.html">网络调试</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration_guide/accuracy_optimization.html">精度调优</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration_guide/performance_optimization.html">性能调试</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration_guide/inference.html">推理执行</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration_guide/sample_code.html">网络迁移调试实例</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration_guide/faq.html">常见问题</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FAQ</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../faq/installation.html">安装</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/data_processing.html">数据处理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/implement_problem.html">执行问题</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/network_compilation.html">网络编译</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/operators_compile.html">算子编译</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/usage_migrate_3rd.html">第三方框架迁移使用</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/performance_tuning.html">性能调优</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/precision_tuning.html">精度调优</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/distributed_configure.html">分布式配置</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/inference.html">推理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/feature_advice.html">特性咨询</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">RELEASE NOTES</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../RELEASE.html">Release Notes</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MindSpore</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="syntax_list.html">语法支持</a> &raquo;</li>
      <li>静态图语法支持</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/note/static_graph_syntax_support.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section class="tex2jax_ignore mathjax_ignore" id="静态图语法支持">
<h1>静态图语法支持<a class="headerlink" href="#静态图语法支持" title="Permalink to this headline"></a></h1>
<p><a href="https://gitee.com/mindspore/docs/blob/r1.8/docs/mindspore/source_zh_cn/note/static_graph_syntax_support.md" target="_blank"><img src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/r1.8/resource/_static/logo_source.png"></a></p>
<section id="概述">
<h2>概述<a class="headerlink" href="#概述" title="Permalink to this headline"></a></h2>
<p>在Graph模式下，Python代码并不是由Python解释器去执行，而是将代码编译成静态计算图，然后执行静态计算图。</p>
<p>当前仅支持编译<code class="docutils literal notranslate"><span class="pre">&#64;ms_function</span></code>装饰器修饰的函数、Cell及其子类的实例。
对于函数，则编译函数定义；对于网络，则编译<code class="docutils literal notranslate"><span class="pre">construct</span></code>方法及其调用的其他方法或者函数。</p>
<p><code class="docutils literal notranslate"><span class="pre">ms_function</span></code>使用规则可参考文档：<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/r1.8/api_python/mindspore/mindspore.ms_function.html#mindspore.ms_function">https://www.mindspore.cn/docs/zh-CN/r1.8/api_python/mindspore/mindspore.ms_function.html#mindspore.ms_function</a></p>
<p><code class="docutils literal notranslate"><span class="pre">Cell</span></code>定义可参考文档：<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/r1.8/api_python/nn/mindspore.nn.Cell.html">https://www.mindspore.cn/docs/zh-CN/r1.8/api_python/nn/mindspore.nn.Cell.html</a></p>
<p>由于语法解析的限制，当前在编译构图时，支持的数据类型、语法以及相关操作并没有完全与Python语法保持一致，部分使用受限。</p>
<p>本文主要介绍，在编译静态图时，支持的数据类型、语法以及相关操作，这些规则仅适用于Graph模式。</p>
<blockquote>
<div><p>以下所有示例都运行在Graph模式下的网络中，为了简洁，并未将网络的定义都写出来。</p>
</div></blockquote>
</section>
<section id="数据类型">
<h2>数据类型<a class="headerlink" href="#数据类型" title="Permalink to this headline"></a></h2>
<section id="python内置数据类型">
<h3>Python内置数据类型<a class="headerlink" href="#python内置数据类型" title="Permalink to this headline"></a></h3>
<p>当前支持的<code class="docutils literal notranslate"><span class="pre">Python</span></code>内置数据类型包括：<code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">String</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>和<code class="docutils literal notranslate"><span class="pre">Dictionary</span></code>。</p>
<section id="number">
<h4>Number<a class="headerlink" href="#number" title="Permalink to this headline"></a></h4>
<p>支持<code class="docutils literal notranslate"><span class="pre">int</span></code>、<code class="docutils literal notranslate"><span class="pre">float</span></code>、<code class="docutils literal notranslate"><span class="pre">bool</span></code>，不支持complex（复数）。</p>
<p>支持在网络里定义<code class="docutils literal notranslate"><span class="pre">Number</span></code>，即支持语法：<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">1</span></code>、<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">1.2</span></code>、 <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">True</span></code>。</p>
<p>当数据为常量时，编译时期可以获取到数值，因此在网络中可以支持强转<code class="docutils literal notranslate"><span class="pre">Number</span></code>的语法：<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">int(x)</span></code>、<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">float(x)</span></code>、<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">bool(x)</span></code>。</p>
</section>
<section id="string">
<h4>String<a class="headerlink" href="#string" title="Permalink to this headline"></a></h4>
<p>支持在网络里构造<code class="docutils literal notranslate"><span class="pre">String</span></code>，即支持语法<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">&quot;abcd&quot;</span></code>。</p>
<p>可以通过str()的方式进行将常量转换成字符串，支持str.format() 对字符串进行格式化，但是不支持format内部参数为变量和kwargs输入场景。</p>
<p>例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">ms_function</span>

<span class="nd">@ms_function</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test_str_format</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> is zero&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">test_str_format</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>0 is zero
</pre></div>
</div>
</section>
<section id="list">
<h4>List<a class="headerlink" href="#list" title="Permalink to this headline"></a></h4>
<p>支持在网络里构造<code class="docutils literal notranslate"><span class="pre">List</span></code>，即支持语法<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">[1,</span> <span class="pre">2,</span> <span class="pre">3]</span></code>。</p>
<p>计算图中最终需要输出的<code class="docutils literal notranslate"><span class="pre">List</span></code>会转换为<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>输出。</p>
<p>需要注意的是MindSpore的List取值由于将其转换成了ListGetItem 算子，该算子返回的始终为原List的一个拷贝，所以有时可能会和Python的List的引用表示有差异。</p>
<p>比如：</p>
<p>原生Python：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="go">&gt;&gt;&gt;a = [[1,2,3],4,5]</span>
<span class="go">&gt;&gt;&gt;b = a[0]</span>
<span class="go">&gt;&gt;&gt;b[0] = 123123</span>
<span class="go">&gt;&gt;&gt;a</span>
<span class="go">[123123, 2, 3], 4, 5]</span>
</pre></div>
</div>
<p>MindSpore:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">ms_function</span>

<span class="nd">@ms_function</span>
<span class="k">def</span> <span class="nf">test_list</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">123123</span>
    <span class="k">return</span> <span class="n">x</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">test_list</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>x: ((1, 2, 3), 4, 5)
</pre></div>
</div>
<ul>
<li><p>支持接口</p>
<p><code class="docutils literal notranslate"><span class="pre">append</span></code>: 向<code class="docutils literal notranslate"><span class="pre">list</span></code>里追加元素。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">ms_function</span>

<span class="nd">@ms_function</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test_list</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">test_list</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>x: (1, 2, 3, 4)
</pre></div>
</div>
</li>
<li><p>支持索引取值和赋值</p>
<p>支持单层和多层索引取值以及赋值。</p>
<p>索引值仅支持<code class="docutils literal notranslate"><span class="pre">int</span></code>和<code class="docutils literal notranslate"><span class="pre">slice</span></code>。
<code class="docutils literal notranslate"><span class="pre">slice</span></code>内部数据必须为编译时能够确定的常量，即不能为计算后的<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。
赋值时，所赋的值支持<code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">String</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。
当前切片赋值右值为Tensor时，需要将Tenor转换为List，在MindSpore静态图模式下这种转化目前是通过<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/r1.8/design/jit_fallback.html?highlight=Fallback">JIT Fallback</a>实现，所以暂时不能支持变量场景。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">ms_function</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>

<span class="nd">@ms_function</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test_index</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span>
    <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ok&quot;</span>
    <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">88</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">m</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">n</span>

<span class="n">m</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">test_index</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;m:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;z:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;n:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>m:2
z:[2, 4]
x:[[1, 88], Tensor(shape=[3], dtype=Int64, value= [1, 2, 3]), &#39;ok&#39;, (1, 2, 3)]
n:[1 2 3]
</pre></div>
</div>
</li>
</ul>
</section>
<section id="tuple">
<h4>Tuple<a class="headerlink" href="#tuple" title="Permalink to this headline"></a></h4>
<p>支持在网络里构造<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>，即支持语法<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">(1,</span> <span class="pre">2,</span> <span class="pre">3)</span></code>。</p>
<p>不支持在网络里强转<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>，即不支持语法<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">tuple(x)</span></code>。</p>
<p>关于Tuple取值的引用类型问题与List相同，请见List的相关介绍。</p>
<ul>
<li><p>支持索引取值</p>
<p>索引值支持<code class="docutils literal notranslate"><span class="pre">int</span></code>、<code class="docutils literal notranslate"><span class="pre">slice</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，也支持多层索引取值，即支持语法<code class="docutils literal notranslate"><span class="pre">data</span> <span class="pre">=</span> <span class="pre">tuple_x[index0][index1]...</span></code>。</p>
<p>索引值为<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>有如下限制：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">tuple</span></code>里存放的都是<code class="docutils literal notranslate"><span class="pre">Cell</span></code>，每个<code class="docutils literal notranslate"><span class="pre">Cell</span></code>要在tuple定义之前完成定义，每个<code class="docutils literal notranslate"><span class="pre">Cell</span></code>的入参个数、入参类型和入参<code class="docutils literal notranslate"><span class="pre">shape</span></code>要求一致，每个<code class="docutils literal notranslate"><span class="pre">Cell</span></code>的输出个数、输出类型和输出<code class="docutils literal notranslate"><span class="pre">shape</span></code>也要求一致。</p></li>
<li><p>索引<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>是一个<code class="docutils literal notranslate"><span class="pre">dtype</span></code>为<code class="docutils literal notranslate"><span class="pre">int32</span></code>的标量<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，取值范围在<code class="docutils literal notranslate"><span class="pre">[-tuple_len,</span> <span class="pre">tuple_len)</span></code>，<code class="docutils literal notranslate"><span class="pre">Ascend</span></code>后端不支持负数索引。</p></li>
<li><p>该语法不支持<code class="docutils literal notranslate"><span class="pre">if</span></code>、<code class="docutils literal notranslate"><span class="pre">while</span></code>、<code class="docutils literal notranslate"><span class="pre">for</span></code>控制流条件为变量的运行分支，仅支持控制流条件为常量。</p></li>
<li><p>支持<code class="docutils literal notranslate"><span class="pre">GPU</span></code>和<code class="docutils literal notranslate"><span class="pre">Ascend</span></code>后端。</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">int</span></code>、<code class="docutils literal notranslate"><span class="pre">slice</span></code>索引示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">ms_function</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>

<span class="nd">@ms_function</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test_index</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span>

<span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">test_index</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;y:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;z:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;m:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;n:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>y:3
z:[1 2 3]
m:((2, 3, 4), 3, 4)
n:(2, 3, 4)
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Tensor</span></code>索引示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">nn</span>

<span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Net</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relu</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">softmax</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Softmax</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">softmax</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="n">index</span><span class="p">](</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">],</span> <span class="n">ms</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="n">net</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
<span class="n">ret</span> <span class="o">=</span> <span class="n">net</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ret:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ret:[0.]
</pre></div>
</div>
</li>
</ul>
</section>
<section id="dictionary">
<h4>Dictionary<a class="headerlink" href="#dictionary" title="Permalink to this headline"></a></h4>
<p>支持在网络里构造<code class="docutils literal notranslate"><span class="pre">Dictionary</span></code>，即支持语法<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">{&quot;a&quot;:</span> <span class="pre">1,</span> <span class="pre">&quot;b&quot;:</span> <span class="pre">2}</span></code>，当前仅支持<code class="docutils literal notranslate"><span class="pre">String</span></code>作为<code class="docutils literal notranslate"><span class="pre">key</span></code>值。</p>
<p>计算图中最终需要输出的<code class="docutils literal notranslate"><span class="pre">Dictionary</span></code>，会取出所有的<code class="docutils literal notranslate"><span class="pre">value</span></code>组成<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>输出。</p>
<ul>
<li><p>支持接口</p>
<p><code class="docutils literal notranslate"><span class="pre">keys</span></code>：取出<code class="docutils literal notranslate"><span class="pre">dict</span></code>里所有的<code class="docutils literal notranslate"><span class="pre">key</span></code>值，组成<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>返回。</p>
<p><code class="docutils literal notranslate"><span class="pre">values</span></code>：取出<code class="docutils literal notranslate"><span class="pre">dict</span></code>里所有的<code class="docutils literal notranslate"><span class="pre">value</span></code>值，组成<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>返回。</p>
<p><code class="docutils literal notranslate"><span class="pre">items</span></code>：取出<code class="docutils literal notranslate"><span class="pre">dict</span></code>里每一对<code class="docutils literal notranslate"><span class="pre">key</span></code>和<code class="docutils literal notranslate"><span class="pre">value</span></code>组成的<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>，组成<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>返回。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">ms_function</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">x</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])),</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])),</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]))}</span>

<span class="nd">@ms_function</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test_dict</span><span class="p">():</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">q</span>

<span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">test_dict</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;y:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;z:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;q:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>y:(&#39;a&#39;, &#39;b&#39;, &#39;c&#39;)
z:(Tensor(shape=[3], dtype=Int64, value= [1, 2, 3]), Tensor(shape=[3], dtype=Int64, value= [4, 5, 6]), Tensor(shape=[3], dtype=Int64, value= [7, 8, 9]))
q:[(&#39;a&#39;, Tensor(shape=[3], dtype=Int64, value= [1, 2, 3])), (&#39;b&#39;, Tensor(shape=[3], dtype=Int64, value= [4, 5, 6])), (&#39;c&#39;, Tensor(shape=[3], dtype=Int64, value= [7, 8, 9]))]
</pre></div>
</div>
</li>
<li><p>支持索引取值和赋值</p>
<p>取值和赋值的索引值都仅支持<code class="docutils literal notranslate"><span class="pre">String</span></code>。赋值时，所赋的值支持<code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">ms_function</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">x</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])),</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])),</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]))}</span>

<span class="nd">@ms_function</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test_dict</span><span class="p">():</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">]</span>
    <span class="n">x</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">test_dict</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;y:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>x:{&#39;a&#39;: (2, 3, 4), &#39;b&#39;: Tensor(shape=[3], dtype=Int64, value= [4, 5, 6]), &#39;c&#39;: Tensor(shape=[3], dtype=Int64, value= [7, 8, 9])}
y:[4 5 6]
</pre></div>
</div>
</li>
</ul>
</section>
</section>
<section id="mindspore自定义数据类型">
<h3>MindSpore自定义数据类型<a class="headerlink" href="#mindspore自定义数据类型" title="Permalink to this headline"></a></h3>
<p>当前MindSpore自定义数据类型包括：<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Primitive</span></code>、<code class="docutils literal notranslate"><span class="pre">Cell</span></code>和<code class="docutils literal notranslate"><span class="pre">Parameter</span></code>。</p>
<section id="tensor">
<h4>Tensor<a class="headerlink" href="#tensor" title="Permalink to this headline"></a></h4>
<p>当前不支持在网络里构造Tensor，即不支持语法<code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">Tensor(args...)</span></code>。</p>
<p>可以通过<code class="docutils literal notranslate"><span class="pre">&#64;constexpr</span></code>装饰器修饰函数，在函数里生成<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。</p>
<p>关于<code class="docutils literal notranslate"><span class="pre">&#64;constexpr</span></code>的用法可参考：<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/r1.8/api_python/ops/mindspore.ops.constexpr.html">https://www.mindspore.cn/docs/zh-CN/r1.8/api_python/ops/mindspore.ops.constexpr.html</a></p>
<p>对于网络中需要用到的常量<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，可以作为网络的属性，在<code class="docutils literal notranslate"><span class="pre">init</span></code>的时候定义，即<code class="docutils literal notranslate"><span class="pre">self.x</span> <span class="pre">=</span> <span class="pre">Tensor(args...)</span></code>，然后在<code class="docutils literal notranslate"><span class="pre">construct</span></code>里使用。</p>
<p>如下示例，通过<code class="docutils literal notranslate"><span class="pre">&#64;constexpr</span></code>生成一个<code class="docutils literal notranslate"><span class="pre">shape</span> <span class="pre">=</span> <span class="pre">(3,</span> <span class="pre">4),</span> <span class="pre">dtype</span> <span class="pre">=</span> <span class="pre">int64</span></code>的<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">from</span> <span class="nn">mindspore.ops</span> <span class="kn">import</span> <span class="n">constexpr</span>

<span class="nd">@constexpr</span>
<span class="k">def</span> <span class="nf">generate_tensor</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)))</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">generate_tensor</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-Text notranslate"><div class="highlight"><pre><span></span>x:[[1. 1. 1. 1.]
 [1. 1. 1. 1.]
 [1. 1. 1. 1.]]
</pre></div>
</div>
<p>下面将介绍下<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>支持的属性和接口。</p>
<ul>
<li><p>支持属性：</p>
<p><code class="docutils literal notranslate"><span class="pre">shape</span></code>：获取<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>的shape，返回一个<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>。</p>
<p><code class="docutils literal notranslate"><span class="pre">dtype</span></code>：获取<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>的数据类型，返回一个<code class="docutils literal notranslate"><span class="pre">MindSpore</span></code>定义的数据类型。</p>
</li>
<li><p>支持接口：</p>
<p><code class="docutils literal notranslate"><span class="pre">all</span></code>：对<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>通过<code class="docutils literal notranslate"><span class="pre">all</span></code>操作进行归约，仅支持<code class="docutils literal notranslate"><span class="pre">Bool</span></code>类型的<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。</p>
<p><code class="docutils literal notranslate"><span class="pre">any</span></code>：对<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>通过<code class="docutils literal notranslate"><span class="pre">any</span></code>操作进行归约，仅支持<code class="docutils literal notranslate"><span class="pre">Bool</span></code>类型的<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。</p>
<p><code class="docutils literal notranslate"><span class="pre">view</span></code>：将<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>reshape成输入的<code class="docutils literal notranslate"><span class="pre">shape</span></code>。</p>
<p><code class="docutils literal notranslate"><span class="pre">expand_as</span></code>：将<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>按照广播规则扩展成与另一个<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>相同的<code class="docutils literal notranslate"><span class="pre">shape</span></code>。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">ms_function</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]]))</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>

<span class="n">x_shape</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span>
<span class="n">x_dtype</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">dtype</span>
<span class="n">x_all</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="n">x_any</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
<span class="n">x_view</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">y_as_z</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">expand_as</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x_shape:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x_shape</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x_dtype:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x_dtype</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x_all:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x_all</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x_any:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x_any</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x_view:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x_view</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;y_as_z:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y_as_z</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>x_shape:(2, 3)
x_dtype:Bool
x_all:False
x_any:True
x_view:[[ True False  True False  True False]]
y_as_z:[[[1. 1. 1.]
  [1. 1. 1.]]

 [[1. 1. 1.]
  [1. 1. 1.]]]
</pre></div>
</div>
</li>
</ul>
</section>
<section id="primitive">
<h4>Primitive<a class="headerlink" href="#primitive" title="Permalink to this headline"></a></h4>
<p>当前支持在网络里构造<code class="docutils literal notranslate"><span class="pre">Primitive</span></code>及其子类的实例，即支持语法<code class="docutils literal notranslate"><span class="pre">reduce_sum</span> <span class="pre">=</span> <span class="pre">ReduceSum(True)</span></code>。</p>
<p>但在构造时，参数只能通过位置参数方式传入，不支持通过键值对方式传入，即不支持语法<code class="docutils literal notranslate"><span class="pre">reduce_sum</span> <span class="pre">=</span> <span class="pre">ReduceSum(keep_dims=True)</span></code>。</p>
<p>当前不支持在网络调用<code class="docutils literal notranslate"><span class="pre">Primitive</span></code>及其子类相关属性和接口。</p>
<p>当前已定义的<code class="docutils literal notranslate"><span class="pre">Primitive</span></code>可参考文档：<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/r1.8/api_python/ops/mindspore.ops.Primitive.html#mindspore.ops.Primitive">https://www.mindspore.cn/docs/zh-CN/r1.8/api_python/ops/mindspore.ops.Primitive.html#mindspore.ops.Primitive</a></p>
</section>
<section id="cell">
<h4>Cell<a class="headerlink" href="#cell" title="Permalink to this headline"></a></h4>
<p>当前支持在网络里构造<code class="docutils literal notranslate"><span class="pre">Cell</span></code>及其子类的实例，即支持语法<code class="docutils literal notranslate"><span class="pre">cell</span> <span class="pre">=</span> <span class="pre">Cell(args...)</span></code>。</p>
<p>但在构造时，参数只能通过位置参数方式传入，不支持通过键值对方式传入，即不支持在语法<code class="docutils literal notranslate"><span class="pre">cell</span> <span class="pre">=</span> <span class="pre">Cell(arg_name=value)</span></code>。</p>
<p>当前不支持在网络调用<code class="docutils literal notranslate"><span class="pre">Cell</span></code>及其子类相关属性和接口，除非是在<code class="docutils literal notranslate"><span class="pre">Cell</span></code>自己的<code class="docutils literal notranslate"><span class="pre">construct</span></code>中通过<code class="docutils literal notranslate"><span class="pre">self</span></code>调用。</p>
<p><code class="docutils literal notranslate"><span class="pre">Cell</span></code>定义可参考文档：<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/r1.8/api_python/nn/mindspore.nn.Cell.html">https://www.mindspore.cn/docs/zh-CN/r1.8/api_python/nn/mindspore.nn.Cell.html</a></p>
<p>当前已定义的<code class="docutils literal notranslate"><span class="pre">Cell</span></code>可参考文档：<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/r1.8/api_python/nn/mindspore.nn.Cell.html#mindspore.nn.Cell">https://www.mindspore.cn/docs/zh-CN/r1.8/api_python/nn/mindspore.nn.Cell.html#mindspore.nn.Cell</a></p>
</section>
<section id="parameter">
<h4>Parameter<a class="headerlink" href="#parameter" title="Permalink to this headline"></a></h4>
<p><code class="docutils literal notranslate"><span class="pre">Parameter</span></code>是变量张量，代表在训练网络时，需要被更新的参数。</p>
<p><code class="docutils literal notranslate"><span class="pre">Parameter</span></code>的定义和使用参考：<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/r1.8/api_python/mindspore/mindspore.Parameter.html#mindspore.Parameter">https://www.mindspore.cn/docs/zh-CN/r1.8/api_python/mindspore/mindspore.Parameter.html#mindspore.Parameter</a></p>
</section>
</section>
</section>
<section id="原型">
<h2>原型<a class="headerlink" href="#原型" title="Permalink to this headline"></a></h2>
<p>原型代表编程语言中最紧密绑定的操作。</p>
<section id="属性引用">
<h3>属性引用<a class="headerlink" href="#属性引用" title="Permalink to this headline"></a></h3>
<p>属性引用是后面带有一个句点加一个名称的原型。</p>
<p>在MindSpore的Cell 实例中使用属性引用作为左值需满足如下要求：</p>
<ul class="simple">
<li><p>被修改的属性属于本<code class="docutils literal notranslate"><span class="pre">cell</span></code>对象，即必须为<code class="docutils literal notranslate"><span class="pre">self.xxx</span></code>。</p></li>
<li><p>该属性在Cell的<code class="docutils literal notranslate"><span class="pre">__init__</span></code>函数中完成初始化且其为Parameter类型。</p></li>
</ul>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">ms_function</span><span class="p">,</span> <span class="n">nn</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">mindspore.ops</span> <span class="kn">import</span> <span class="n">constexpr</span>

<span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">ms</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">x</span>  <span class="c1"># 满足条件可以修改</span>
        <span class="c1"># self.m = 3  # self.m 非Parameter类型禁止修改</span>
        <span class="c1"># y.weight = x  # y不是self，禁止修改</span>
        <span class="k">return</span> <span class="n">x</span>

<span class="n">net</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
<span class="n">ret</span> <span class="o">=</span> <span class="n">net</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ret:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ret:1
</pre></div>
</div>
</section>
<section id="索引取值">
<h3>索引取值<a class="headerlink" href="#索引取值" title="Permalink to this headline"></a></h3>
<p>对序列<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code>、<code class="docutils literal notranslate"><span class="pre">Dictionary</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>的索引取值操作(Python称为抽取)。</p>
<p><code class="docutils literal notranslate"><span class="pre">Tuple</span></code>的索引取值请参考本文的<span class="xref myst">Tuple</span>章节。</p>
<p><code class="docutils literal notranslate"><span class="pre">List</span></code>的索引取值请参考本文的<span class="xref myst">List</span>章节。</p>
<p><code class="docutils literal notranslate"><span class="pre">Dictionary</span></code>的索引取值请参考本文的<span class="xref myst">Dictionary</span>章节。</p>
<p><code class="docutils literal notranslate"><span class="pre">Tensor</span></code>的索引取请参考:<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/r1.8/note/index_support.html#%E7%B4%A2%E5%BC%95%E5%8F%96%E5%80%BC">https://www.mindspore.cn/docs/zh-CN/r1.8/note/index_support.html#索引取值</a></p>
</section>
<section id="调用">
<h3>调用<a class="headerlink" href="#调用" title="Permalink to this headline"></a></h3>
<p>所谓调用就是附带可能为空的一系列参数来执行一个可调用对象(例如：<code class="docutils literal notranslate"><span class="pre">Cell</span></code>、<code class="docutils literal notranslate"><span class="pre">Primitive</span></code>)。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">nn</span><span class="p">,</span> <span class="n">ops</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matmul</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">MatMul</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>  <span class="c1"># Primitive调用</span>
        <span class="k">return</span> <span class="n">out</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span> <span class="n">ms</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]),</span> <span class="n">ms</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">net</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
<span class="n">ret</span> <span class="o">=</span> <span class="n">net</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ret:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ret:[[3. 3. 3. 3.]]
</pre></div>
</div>
</section>
</section>
<section id="运算符">
<h2>运算符<a class="headerlink" href="#运算符" title="Permalink to this headline"></a></h2>
<p>算术运算符和赋值运算符支持<code class="docutils literal notranslate"><span class="pre">Number</span></code>和<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>运算，也支持不同<code class="docutils literal notranslate"><span class="pre">dtype</span></code>的<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>运算。</p>
<p>之所以支持，是因为这些运算符会转换成同名算子进行运算，这些算子支持了隐式类型转换。</p>
<p>规则可参考文档：<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/r1.8/note/operator_list_implicit.html#%E8%BD%AC%E6%8D%A2%E8%A7%84%E5%88%99">https://www.mindspore.cn/docs/zh-CN/r1.8/note/operator_list_implicit.html#转换规则</a></p>
<section id="单目算术运算符">
<h3>单目算术运算符<a class="headerlink" href="#单目算术运算符" title="Permalink to this headline"></a></h3>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="text-left head"><p>单目算术运算符</p></th>
<th class="text-left head"><p>支持类型</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">+</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，取正值。</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">-</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，取负值。</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">~</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Tensor</span></code>， 且其数据类型为<code class="docutils literal notranslate"><span class="pre">Bool</span></code>。成员逐个取反。</p></td>
</tr>
</tbody>
</table>
<p>说明：</p>
<ul class="simple">
<li><p>在Python中<code class="docutils literal notranslate"><span class="pre">~</span></code>操作符对输入的整数按位取反; MindSpore对<code class="docutils literal notranslate"><span class="pre">~</span></code>的功能重新定义为对<code class="docutils literal notranslate"><span class="pre">Tensor(Bool)</span></code>的逻辑取反。</p></li>
</ul>
</section>
<section id="二元算术运算符">
<h3>二元算术运算符<a class="headerlink" href="#二元算术运算符" title="Permalink to this headline"></a></h3>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="text-left head"><p>二元算术运算符</p></th>
<th class="text-left head"><p>支持类型</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">+</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code> + <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">String</span></code> + <code class="docutils literal notranslate"><span class="pre">String</span></code>、<code class="docutils literal notranslate"><span class="pre">Number</span></code> + <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> + <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code> + <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> + <code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code> + <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>+<code class="docutils literal notranslate"><span class="pre">List</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code>+<code class="docutils literal notranslate"><span class="pre">List</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> + <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code> + <code class="docutils literal notranslate"><span class="pre">Tuple</span></code>。</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">-</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code> - <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> - <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Number</span></code> - <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> - <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code> - <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> - <code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code> - <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> - <code class="docutils literal notranslate"><span class="pre">List</span></code>。</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">*</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code> * <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> * <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Number</span></code> * <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> * <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code> * <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Number</span></code> * <code class="docutils literal notranslate"><span class="pre">List</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code> * <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Number</span></code> * <code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code> * <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> * <code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、 <code class="docutils literal notranslate"><span class="pre">List</span></code> * <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> * <code class="docutils literal notranslate"><span class="pre">List</span></code>。</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">/</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code> / <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> / <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Number</span></code> / <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> / <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code> / <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> / <code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code> / <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> / <code class="docutils literal notranslate"><span class="pre">List</span></code>。</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">%</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code> % <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> % <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Number</span></code> % <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> % <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code> % <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> % <code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code> % <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> % <code class="docutils literal notranslate"><span class="pre">List</span></code>。</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">**</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code> ** <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> ** <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Number</span></code> ** <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> ** <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code> ** <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> ** <code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、 <code class="docutils literal notranslate"><span class="pre">List</span></code> ** <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> ** <code class="docutils literal notranslate"><span class="pre">List</span></code>。</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">//</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code> // <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> // <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Number</span></code> // <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> // <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code> // <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> // <code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code> // <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> // <code class="docutils literal notranslate"><span class="pre">List</span></code>。</p></td>
</tr>
</tbody>
</table>
<p>限制：</p>
<ul class="simple">
<li><p>当左右操作数都为<code class="docutils literal notranslate"><span class="pre">Number</span></code>类型时，<code class="docutils literal notranslate"><span class="pre">Number</span></code>的值不可为<code class="docutils literal notranslate"><span class="pre">Bool</span></code> 类型。</p></li>
<li><p>当左右操作数都为<code class="docutils literal notranslate"><span class="pre">Number</span></code>类型时，不支持<code class="docutils literal notranslate"><span class="pre">Float64</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Int32</span></code>间的运算。</p></li>
<li><p>当任一操作数为<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>类型时，左右操作数的值不可同时为<code class="docutils literal notranslate"><span class="pre">Bool</span></code>。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">List/Tuple</span></code>和<code class="docutils literal notranslate"><span class="pre">Number</span></code>进行<code class="docutils literal notranslate"><span class="pre">*</span></code>运算时表示将<code class="docutils literal notranslate"><span class="pre">List/Tuple</span></code>复制<code class="docutils literal notranslate"><span class="pre">Number</span></code>份后串联起来，<code class="docutils literal notranslate"><span class="pre">List/Tuple</span></code>内的数据类型必须为<code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">String</span></code>、<code class="docutils literal notranslate"><span class="pre">None</span></code>或由以上类型构成的<code class="docutils literal notranslate"><span class="pre">List/Tuple</span></code>。</p></li>
</ul>
</section>
<section id="赋值运算符">
<h3>赋值运算符<a class="headerlink" href="#赋值运算符" title="Permalink to this headline"></a></h3>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="text-left head"><p>赋值运算符</p></th>
<th class="text-left head"><p>支持类型</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">=</span></code></p></td>
<td class="text-left"><p>MindSpore支持的Python内置数据类型和MindSpore自定义数据类型</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">+=</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code> += <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">String</span></code> += <code class="docutils literal notranslate"><span class="pre">String</span></code>、<code class="docutils literal notranslate"><span class="pre">Number</span></code> += <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> += <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code> += <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> += <code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code> += <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> += <code class="docutils literal notranslate"><span class="pre">List</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code> += <code class="docutils literal notranslate"><span class="pre">List</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> += <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code> += <code class="docutils literal notranslate"><span class="pre">Tuple</span></code>。</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">-=</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code> -= <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> -= <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Number</span></code> -= <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> -= <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code> -= <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> -= <code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code> -= <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> -= <code class="docutils literal notranslate"><span class="pre">List</span></code>。</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">*=</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code> *= <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> *= <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Number</span></code> *= <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> *= <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code> *= <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Number</span></code> *= <code class="docutils literal notranslate"><span class="pre">List</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code> *= <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Number</span></code> *= <code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code> *= <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> *= <code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、 <code class="docutils literal notranslate"><span class="pre">List</span></code> *= <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> *= <code class="docutils literal notranslate"><span class="pre">List</span></code>。</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">/=</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code> /= <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> /= <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Number</span></code> /= <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> /= <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code> /= <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> /= <code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code> /= <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> /= <code class="docutils literal notranslate"><span class="pre">List</span></code>。</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">%=</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code> %= <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> %= <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Number</span></code> %= <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> %= <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code> %= <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> %= <code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code> %= <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> %= <code class="docutils literal notranslate"><span class="pre">List</span></code>。</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">**=</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code> **= <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> **= <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Number</span></code> **= <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> **= <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code> **= <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> **= <code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、 <code class="docutils literal notranslate"><span class="pre">List</span></code> **= <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> **= <code class="docutils literal notranslate"><span class="pre">List</span></code>。</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">//=</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code> //= <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> //= <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Number</span></code> //= <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> //= <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code> //= <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> //= <code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code> //= <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> //= <code class="docutils literal notranslate"><span class="pre">List</span></code>。</p></td>
</tr>
</tbody>
</table>
<p>限制：</p>
<ul>
<li><p>对于 <code class="docutils literal notranslate"><span class="pre">=</span></code>来说，不支持下列场景:</p>
<p>在<code class="docutils literal notranslate"><span class="pre">construct</span></code>函数中仅支持创建<code class="docutils literal notranslate"><span class="pre">Cell</span></code>和<code class="docutils literal notranslate"><span class="pre">Primitive</span></code>类型对象，使用<code class="docutils literal notranslate"><span class="pre">xx</span> <span class="pre">=</span> <span class="pre">Tensor(...)</span></code>的方式创建<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>会失败。</p>
<p>在<code class="docutils literal notranslate"><span class="pre">construct</span></code>函数中仅支持为self 的<code class="docutils literal notranslate"><span class="pre">Parameter</span></code>类型的属性赋值, 详情参考：<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/r1.8/note/static_graph_syntax_support.html#%E5%B1%9E%E6%80%A7%E5%BC%95%E7%94%A8">属性引用</a>。</p>
</li>
<li><p>当<code class="docutils literal notranslate"><span class="pre">AugAssign</span></code>的左右操作数都为<code class="docutils literal notranslate"><span class="pre">Number</span></code>类型时，<code class="docutils literal notranslate"><span class="pre">Number</span></code>的值不可为<code class="docutils literal notranslate"><span class="pre">Bool</span></code> 类型。</p></li>
<li><p>当<code class="docutils literal notranslate"><span class="pre">AugAssign</span></code>的左右操作数都为<code class="docutils literal notranslate"><span class="pre">Number</span></code>类型时，不支持<code class="docutils literal notranslate"><span class="pre">Float64</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Int32</span></code>间的运算。</p></li>
<li><p>当<code class="docutils literal notranslate"><span class="pre">AugAssign</span></code>的任一操作数为<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>类型时，左右操作数的值不可同时为<code class="docutils literal notranslate"><span class="pre">Bool</span></code>。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">List/Tuple</span></code>和<code class="docutils literal notranslate"><span class="pre">Number</span></code>进行<code class="docutils literal notranslate"><span class="pre">*=</span></code>运算时表示将<code class="docutils literal notranslate"><span class="pre">List/Tuple</span></code>复制<code class="docutils literal notranslate"><span class="pre">Number</span></code>份后串联起来，<code class="docutils literal notranslate"><span class="pre">List/Tuple</span></code>内的数据类型必须为<code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">String</span></code>、<code class="docutils literal notranslate"><span class="pre">None</span></code>或由以上类型构成的<code class="docutils literal notranslate"><span class="pre">List/Tuple</span></code>。</p></li>
</ul>
</section>
<section id="逻辑运算符">
<h3>逻辑运算符<a class="headerlink" href="#逻辑运算符" title="Permalink to this headline"></a></h3>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="text-left head"><p>逻辑运算符</p></th>
<th class="text-left head"><p>支持类型</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">and</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">String</span></code>、 <code class="docutils literal notranslate"><span class="pre">Number</span></code>、 <code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code> 、<code class="docutils literal notranslate"><span class="pre">Dict</span></code>、<code class="docutils literal notranslate"><span class="pre">None</span></code>、标量、Tensor。</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">or</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">String</span></code>、 <code class="docutils literal notranslate"><span class="pre">Number</span></code>、 <code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code> 、<code class="docutils literal notranslate"><span class="pre">Dict</span></code>、<code class="docutils literal notranslate"><span class="pre">None</span></code>、标量、Tensor。</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">not</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code>、只有一个成员的Tensor。</p></td>
</tr>
</tbody>
</table>
<p>限制：</p>
<ul class="simple">
<li><p>当and/or的左操作数是Tensor类型时，左右操作数类型必须保持一致且Tensor成员个数只能有一个。</p></li>
<li><p>当and/or的左操作数不是Tensor类型时，右操作数可以为支持的任意类型。</p></li>
</ul>
</section>
<section id="比较运算符">
<h3>比较运算符<a class="headerlink" href="#比较运算符" title="Permalink to this headline"></a></h3>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="text-left head"><p>比较运算符</p></th>
<th class="text-left head"><p>支持类型</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">in</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code> in <code class="docutils literal notranslate"><span class="pre">tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">String</span></code> in <code class="docutils literal notranslate"><span class="pre">tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> in <code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">Number</span></code> in <code class="docutils literal notranslate"><span class="pre">List</span></code>、<code class="docutils literal notranslate"><span class="pre">String</span></code> in <code class="docutils literal notranslate"><span class="pre">List</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> in <code class="docutils literal notranslate"><span class="pre">List</span></code>、<code class="docutils literal notranslate"><span class="pre">String</span></code> in <code class="docutils literal notranslate"><span class="pre">Dictionary</span></code>。</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">not</span> <span class="pre">in</span></code></p></td>
<td class="text-left"><p>与<code class="docutils literal notranslate"><span class="pre">in</span></code>相同。</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">is</span></code></p></td>
<td class="text-left"><p>仅支持判断是<code class="docutils literal notranslate"><span class="pre">None</span></code>、 <code class="docutils literal notranslate"><span class="pre">True</span></code>或者<code class="docutils literal notranslate"><span class="pre">False</span></code>。</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">is</span> <span class="pre">not</span></code></p></td>
<td class="text-left"><p>仅支持判断不是<code class="docutils literal notranslate"><span class="pre">None</span></code>、 <code class="docutils literal notranslate"><span class="pre">True</span></code>或者<code class="docutils literal notranslate"><span class="pre">False</span></code>。</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>&lt;</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code> &lt; <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Number</span></code> &lt; <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> &lt; <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> &lt; <code class="docutils literal notranslate"><span class="pre">Number</span></code>。</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>&lt;=</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code> &lt;= <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Number</span></code> &lt;= <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> &lt;= <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> &lt;= <code class="docutils literal notranslate"><span class="pre">Number</span></code>。</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>&gt;</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Number</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Number</span></code>。</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>&gt;=</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code> &gt;= <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Number</span></code> &gt;= <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> &gt;= <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> &gt;= <code class="docutils literal notranslate"><span class="pre">Number</span></code>。</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>!=</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code> != <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Number</span></code> != <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> != <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> != <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">mstype</span></code> != <code class="docutils literal notranslate"><span class="pre">mstype</span></code>、<code class="docutils literal notranslate"><span class="pre">String</span></code> != <code class="docutils literal notranslate"><span class="pre">String</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span> <span class="pre">!</span></code> = <code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code> != <code class="docutils literal notranslate"><span class="pre">List</span></code>。</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>==</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Number</span></code> == <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">Number</span></code> == <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> == <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code> == <code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">mstype</span></code> == <code class="docutils literal notranslate"><span class="pre">mstype</span></code>、<code class="docutils literal notranslate"><span class="pre">String</span></code> == <code class="docutils literal notranslate"><span class="pre">String</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code> == <code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code> == <code class="docutils literal notranslate"><span class="pre">List</span></code>。</p></td>
</tr>
</tbody>
</table>
<p>限制：</p>
<ul class="simple">
<li><p>对于<code class="docutils literal notranslate"><span class="pre">&lt;</span></code>、<code class="docutils literal notranslate"><span class="pre">&lt;=</span></code>、<code class="docutils literal notranslate"><span class="pre">&gt;</span></code>、<code class="docutils literal notranslate"><span class="pre">&gt;=</span></code>、<code class="docutils literal notranslate"><span class="pre">!=</span></code>来说，当左右操作数都为<code class="docutils literal notranslate"><span class="pre">Number</span></code>类型时，<code class="docutils literal notranslate"><span class="pre">Number</span></code>的值不可为<code class="docutils literal notranslate"><span class="pre">Bool</span></code> 类型。</p></li>
<li><p>对于<code class="docutils literal notranslate"><span class="pre">&lt;</span></code>、<code class="docutils literal notranslate"><span class="pre">&lt;=</span></code>、<code class="docutils literal notranslate"><span class="pre">&gt;</span></code>、<code class="docutils literal notranslate"><span class="pre">&gt;=</span></code>、<code class="docutils literal notranslate"><span class="pre">!=</span></code>、<code class="docutils literal notranslate"><span class="pre">==</span></code>来说，当左右操作数都为<code class="docutils literal notranslate"><span class="pre">Number</span></code>类型时，不支持<code class="docutils literal notranslate"><span class="pre">Float64</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Int32</span></code>间的运算。</p></li>
<li><p>对于<code class="docutils literal notranslate"><span class="pre">&lt;</span></code>、<code class="docutils literal notranslate"><span class="pre">&lt;=</span></code>、<code class="docutils literal notranslate"><span class="pre">&gt;</span></code>、<code class="docutils literal notranslate"><span class="pre">&gt;=</span></code>、<code class="docutils literal notranslate"><span class="pre">!=</span></code>、<code class="docutils literal notranslate"><span class="pre">==</span></code>来说，当左右任一操作数为<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>类型时，左右操作数的值不可同时为<code class="docutils literal notranslate"><span class="pre">Bool</span></code>。</p></li>
<li><p>对于<code class="docutils literal notranslate"><span class="pre">==</span></code>来说，当左右操作数都为<code class="docutils literal notranslate"><span class="pre">Number</span></code>类型时，支持左右操作数同时为<code class="docutils literal notranslate"><span class="pre">Bool</span></code>，不支持只有一个操作数为<code class="docutils literal notranslate"><span class="pre">Bool</span></code>。</p></li>
<li><p>对于<code class="docutils literal notranslate"><span class="pre">!=</span></code>、<code class="docutils literal notranslate"><span class="pre">==</span></code>来说除<code class="docutils literal notranslate"><span class="pre">mstype</span></code>外，其他取值均可和<code class="docutils literal notranslate"><span class="pre">None</span></code>进行比较来判空。</p></li>
<li><p>不支持链式比较，如: <code class="docutils literal notranslate"><span class="pre">a&gt;b&gt;c</span></code>。</p></li>
</ul>
</section>
</section>
<section id="复合语句">
<h2>复合语句<a class="headerlink" href="#复合语句" title="Permalink to this headline"></a></h2>
<section id="条件控制语句">
<h3>条件控制语句<a class="headerlink" href="#条件控制语句" title="Permalink to this headline"></a></h3>
<section id="if语句">
<h4>if语句<a class="headerlink" href="#if语句" title="Permalink to this headline"></a></h4>
<p>使用方式：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">(cond):</span> <span class="pre">statements...</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">y</span> <span class="pre">if</span> <span class="pre">(cond)</span> <span class="pre">else</span> <span class="pre">z</span></code></p></li>
</ul>
<p>参数：<code class="docutils literal notranslate"><span class="pre">cond</span></code> – 支持<code class="docutils literal notranslate"><span class="pre">Bool</span></code>类型的变量，也支持类型为<code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">Dict</span></code>、<code class="docutils literal notranslate"><span class="pre">String</span></code>类型的常量。</p>
<p>限制：</p>
<ul class="simple">
<li><p>如果<code class="docutils literal notranslate"><span class="pre">cond</span></code>不为常量，在不同分支中同一符号被赋予的变量或者常量的数据类型应一致，如果是被赋予变量或者常量数据类型是<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，则要求<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>的type和shape也应一致。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">if</span></code>的使用数量不能超过100个。</p></li>
</ul>
<p>示例1：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">ms_function</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">ms</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">ms</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="s1">&#39;xx&#39;</span>
<span class="n">n</span> <span class="o">=</span> <span class="s1">&#39;yy&#39;</span>

<span class="nd">@ms_function</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test_cond</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">m</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">n</span>

<span class="n">ret</span> <span class="o">=</span> <span class="n">test_cond</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ret:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret</span><span class="p">))</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">if</span></code>分支返回的<code class="docutils literal notranslate"><span class="pre">m</span></code>和<code class="docutils literal notranslate"><span class="pre">else</span></code>分支返回的<code class="docutils literal notranslate"><span class="pre">n</span></code>，二者数据类型必须一致。</p>
<p>结果如下:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ret:xx
</pre></div>
</div>
<p>示例2：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">ms_function</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">ms</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">ms</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="s1">&#39;xx&#39;</span>
<span class="n">n</span> <span class="o">=</span> <span class="s1">&#39;yy&#39;</span>

<span class="nd">@ms_function</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test_cond</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;init&#39;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">m</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">n</span>
    <span class="k">return</span> <span class="n">out</span>

<span class="n">ret</span> <span class="o">=</span> <span class="n">test_cond</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ret:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret</span><span class="p">))</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">if</span></code>分支中<code class="docutils literal notranslate"><span class="pre">out</span></code>被赋值的变量或者常量<code class="docutils literal notranslate"><span class="pre">m</span></code>与<code class="docutils literal notranslate"><span class="pre">else</span></code>分支中<code class="docutils literal notranslate"><span class="pre">out</span></code>被赋值的变量或者常量<code class="docutils literal notranslate"><span class="pre">n</span></code>的数据类型必须一致。</p>
<p>结果如下:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ret:xx
</pre></div>
</div>
<p>示例3：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">ms_function</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">ms</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">ms</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="s1">&#39;xx&#39;</span>

<span class="nd">@ms_function</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test_cond</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;init&#39;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">m</span>
    <span class="k">return</span> <span class="n">out</span>

<span class="n">ret</span> <span class="o">=</span> <span class="n">test_cond</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ret:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret</span><span class="p">))</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">if</span></code>分支中<code class="docutils literal notranslate"><span class="pre">out</span></code>被赋值的变量或者常量<code class="docutils literal notranslate"><span class="pre">m</span></code>与<code class="docutils literal notranslate"><span class="pre">out</span></code>初始赋值的变量或者常量<code class="docutils literal notranslate"><span class="pre">init</span></code>的数据类型必须一致。</p>
<p>结果如下:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ret:xx
</pre></div>
</div>
</section>
</section>
<section id="循环语句">
<h3>循环语句<a class="headerlink" href="#循环语句" title="Permalink to this headline"></a></h3>
<section id="for语句">
<h4>for语句<a class="headerlink" href="#for语句" title="Permalink to this headline"></a></h4>
<p>使用方式：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">i</span> <span class="pre">in</span> <span class="pre">sequence</span>&#160; <span class="pre">statements...</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">i</span> <span class="pre">in</span> <span class="pre">sequence</span>&#160; <span class="pre">statements...</span> <span class="pre">if</span> <span class="pre">(cond)</span> <span class="pre">break</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">i</span> <span class="pre">in</span> <span class="pre">sequence</span>&#160; <span class="pre">statements...</span> <span class="pre">if</span> <span class="pre">(cond)</span> <span class="pre">continue</span></code></p></li>
</ul>
<p>参数：<code class="docutils literal notranslate"><span class="pre">sequence</span></code> – 遍历序列(<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code>、<code class="docutils literal notranslate"><span class="pre">range</span></code>等)</p>
<p>限制：</p>
<ul class="simple">
<li><p>图的算子数量和<code class="docutils literal notranslate"><span class="pre">for</span></code>循环的迭代次数成倍数关系，<code class="docutils literal notranslate"><span class="pre">for</span></code>循环迭代次数过大可能会导致图占用内存超过使用限制。</p></li>
<li><p>不支持<code class="docutils literal notranslate"><span class="pre">for...else...</span></code>语句。</p></li>
</ul>
<p>示例：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">ms_function</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">z</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>

<span class="nd">@ms_function</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test_cond</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
        <span class="n">z</span> <span class="o">+=</span> <span class="n">i</span>
    <span class="k">return</span> <span class="n">z</span>

<span class="n">ret</span> <span class="o">=</span> <span class="n">test_cond</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ret:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ret:[[7. 7. 7.]
 [7. 7. 7.]]
</pre></div>
</div>
</section>
<section id="while语句">
<h4>while语句<a class="headerlink" href="#while语句" title="Permalink to this headline"></a></h4>
<p>使用方式：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">while</span> <span class="pre">(cond)</span>&#160; <span class="pre">statements...</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">while</span> <span class="pre">(cond)</span>&#160; <span class="pre">statements...</span> <span class="pre">if</span> <span class="pre">(cond1)</span> <span class="pre">break</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">while</span> <span class="pre">(cond)</span>&#160; <span class="pre">statements...</span> <span class="pre">if</span> <span class="pre">(cond1)</span> <span class="pre">continue</span></code></p></li>
</ul>
<p>参数：<code class="docutils literal notranslate"><span class="pre">cond</span></code> – 支持<code class="docutils literal notranslate"><span class="pre">Bool</span></code>类型的变量，也支持类型为<code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">Dict</span></code>、<code class="docutils literal notranslate"><span class="pre">String</span></code>类型的常量。</p>
<p>限制：</p>
<ul class="simple">
<li><p>如果<code class="docutils literal notranslate"><span class="pre">cond</span></code>不为常量，在循环体内外同一符号被赋值的变量或者常量的数据类型应一致，如果是被赋予数据类型<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，则要求<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>的type和shape也应一致。</p></li>
<li><p>不支持<code class="docutils literal notranslate"><span class="pre">while...else...</span></code>语句</p></li>
<li><p>如果<code class="docutils literal notranslate"><span class="pre">cond</span></code>不为常量， 循环体内部不能更新循环体外的<code class="docutils literal notranslate"><span class="pre">Number</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code>、<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>类型数据， 不能更改<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>类型数据的shape。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">while</span></code>的数量不能超过100个。</p></li>
</ul>
<p>示例1：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">ms_function</span>

<span class="n">m</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">2</span>

<span class="nd">@ms_function</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test_cond</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">while</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">m</span>
    <span class="k">return</span> <span class="n">n</span>

<span class="n">ret</span> <span class="o">=</span> <span class="n">test_cond</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ret:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret</span><span class="p">))</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">while</span></code>循环内返回的<code class="docutils literal notranslate"><span class="pre">m</span></code>和<code class="docutils literal notranslate"><span class="pre">while</span></code>外返回的<code class="docutils literal notranslate"><span class="pre">n</span></code>数据类型必须一致。</p>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ret:1
</pre></div>
</div>
<p>示例2：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">ms_function</span>

<span class="n">m</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">2</span>

<span class="k">def</span> <span class="nf">ops1</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="nd">@ms_function</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test_cond</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">m</span>
    <span class="k">while</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">ops1</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span>

<span class="n">ret</span> <span class="o">=</span> <span class="n">test_cond</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ret:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret</span><span class="p">))</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">while</span></code>内，<code class="docutils literal notranslate"><span class="pre">out</span></code>在循环体内被赋值的变量<code class="docutils literal notranslate"><span class="pre">op1</span></code>的输出类型和初始类型<code class="docutils literal notranslate"><span class="pre">m</span></code>必须一致。</p>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ret:15
</pre></div>
</div>
</section>
</section>
<section id="函数定义语句">
<h3>函数定义语句<a class="headerlink" href="#函数定义语句" title="Permalink to this headline"></a></h3>
<section id="def关键字">
<h4>def关键字<a class="headerlink" href="#def关键字" title="Permalink to this headline"></a></h4>
<p>用于定义函数。</p>
<p>使用方式：</p>
<p><code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">function_name(args):</span> <span class="pre">statements...</span></code></p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">ms_function</span>

<span class="k">def</span> <span class="nf">number_add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="nd">@ms_function</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">number_add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="n">ret</span> <span class="o">=</span> <span class="n">test</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ret:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ret: 6
</pre></div>
</div>
<p>限制：</p>
<ul class="simple">
<li><p>函数必须有返回语句。</p></li>
<li><p>最外层网络模型的<code class="docutils literal notranslate"><span class="pre">construct</span></code>函数不支持kwargs，即不支持 <code class="docutils literal notranslate"><span class="pre">def</span>&#160; <span class="pre">construct(**kwargs):</span></code>。</p></li>
<li><p>不支持变参和非变参的混合使用，即不支持 <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">function(x,</span> <span class="pre">y,</span> <span class="pre">*args):</span></code>和 <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">function(x</span> <span class="pre">=</span> <span class="pre">1,</span> <span class="pre">y</span> <span class="pre">=</span> <span class="pre">1,</span> <span class="pre">**kwargs):</span></code>。</p></li>
</ul>
</section>
<section id="lambda表达式">
<h4>lambda表达式<a class="headerlink" href="#lambda表达式" title="Permalink to this headline"></a></h4>
<p>用于生成函数。</p>
<p>使用方式：<code class="docutils literal notranslate"><span class="pre">lambda</span> <span class="pre">x,</span> <span class="pre">y:</span> <span class="pre">x</span> <span class="pre">+</span> <span class="pre">y</span></code></p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">ms_function</span>

<span class="nd">@ms_function</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">number_add</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
    <span class="k">return</span> <span class="n">number_add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="n">ret</span> <span class="o">=</span> <span class="n">test</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ret:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ret: 6
</pre></div>
</div>
</section>
</section>
<section id="列表生成式和生成器表达式">
<h3>列表生成式和生成器表达式<a class="headerlink" href="#列表生成式和生成器表达式" title="Permalink to this headline"></a></h3>
<p>支持列表生成式（List Comprehension）和生成器表达式（Generator Expression）。</p>
<section id="列表生成式">
<h4>列表生成式<a class="headerlink" href="#列表生成式" title="Permalink to this headline"></a></h4>
<p>用于生成列表。由于编译器会自动把List类型转换成Tuple类型，经过编译后最终输出类型为Tuple。</p>
<p>使用方式：参考Python语法说明。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">ms_function</span>

<span class="nd">@ms_function</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">l</span>

<span class="n">ret</span> <span class="o">=</span> <span class="n">test</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ret:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ret:(4, 16, 36, 64, 100)
</pre></div>
</div>
<p>限制：</p>
<p>不支持多层嵌套迭代器的使用方式。</p>
<p>限制用法示例如下（使用了两层迭代器）：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
</pre></div>
</div>
<p>会提示错误：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>TypeError:  The `generators` supports one `comprehension` in ListComp/GeneratorExp, but got 2 comprehensions.
</pre></div>
</div>
</section>
<section id="生成器表达式">
<h4>生成器表达式<a class="headerlink" href="#生成器表达式" title="Permalink to this headline"></a></h4>
<p>用于生成列表，与列表生成式动作完全一致，最终的输出类型同样是Tuple。此表达式即刻产生List值，与Python解释器中列表生成式的动作有所差异。</p>
<p>使用方式：同列表生成式。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">ms_function</span>

<span class="nd">@ms_function</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">l</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">l</span>

<span class="n">ret</span> <span class="o">=</span> <span class="n">test</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ret:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ret:(4, 16, 36, 64, 100)
</pre></div>
</div>
<p>使用限制同列表生成式。</p>
</section>
</section>
</section>
<section id="函数">
<h2>函数<a class="headerlink" href="#函数" title="Permalink to this headline"></a></h2>
<section id="python内置函数">
<h3>Python内置函数<a class="headerlink" href="#python内置函数" title="Permalink to this headline"></a></h3>
<p>当前支持的Python内置函数包括：<code class="docutils literal notranslate"><span class="pre">len</span></code>、<code class="docutils literal notranslate"><span class="pre">isinstance</span></code>、<code class="docutils literal notranslate"><span class="pre">partial</span></code>、<code class="docutils literal notranslate"><span class="pre">map</span></code>、<code class="docutils literal notranslate"><span class="pre">range</span></code>、<code class="docutils literal notranslate"><span class="pre">enumerate</span></code>、<code class="docutils literal notranslate"><span class="pre">super</span></code>、<code class="docutils literal notranslate"><span class="pre">pow</span></code>和<code class="docutils literal notranslate"><span class="pre">filter</span></code>。</p>
<section id="len">
<h4>len<a class="headerlink" href="#len" title="Permalink to this headline"></a></h4>
<p>功能：求序列的长度。</p>
<p>调用：<code class="docutils literal notranslate"><span class="pre">len(sequence)</span></code></p>
<p>入参：<code class="docutils literal notranslate"><span class="pre">sequence</span></code> – <code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code>、<code class="docutils literal notranslate"><span class="pre">Dictionary</span></code>或者<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。</p>
<p>返回值：序列的长度，类型为<code class="docutils literal notranslate"><span class="pre">int</span></code>。当入参是<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>时，返回的是<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>第0维的长度。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">ms_function</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">z</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)))</span>

<span class="nd">@ms_function</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
    <span class="n">x_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">y_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">d_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="n">z_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x_len</span><span class="p">,</span> <span class="n">y_len</span><span class="p">,</span> <span class="n">d_len</span><span class="p">,</span> <span class="n">z_len</span>

<span class="n">x_len</span><span class="p">,</span> <span class="n">y_len</span><span class="p">,</span> <span class="n">d_len</span><span class="p">,</span> <span class="n">z_len</span> <span class="o">=</span> <span class="n">test</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x_len:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x_len</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;y_len:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y_len</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;d_len:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">d_len</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;z_len:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">z_len</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>x_len:3
y_len:3
d_len:2
z_len:6
</pre></div>
</div>
</section>
<section id="isinstance">
<h4>isinstance<a class="headerlink" href="#isinstance" title="Permalink to this headline"></a></h4>
<p>功能：判断对象是否为类的实例。区别于算子Isinstance，该算子的第二个入参是MindSpore的dtype模块下定义的类型。</p>
<p>调用：<code class="docutils literal notranslate"><span class="pre">isinstance(obj,</span> <span class="pre">type)</span></code></p>
<p>入参：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">obj</span></code> – MindSpore支持类型的一个实例。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code> – <code class="docutils literal notranslate"><span class="pre">bool</span></code>、<code class="docutils literal notranslate"><span class="pre">int</span></code>、<code class="docutils literal notranslate"><span class="pre">float</span></code>、<code class="docutils literal notranslate"><span class="pre">str</span></code>、<code class="docutils literal notranslate"><span class="pre">list</span></code>、<code class="docutils literal notranslate"><span class="pre">tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">dict</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">Parameter</span></code>，或者是一个只包含这些类型的<code class="docutils literal notranslate"><span class="pre">tuple</span></code>。</p></li>
</ul>
<p>返回值：<code class="docutils literal notranslate"><span class="pre">obj</span></code>为<code class="docutils literal notranslate"><span class="pre">type</span></code>的实例，返回<code class="docutils literal notranslate"><span class="pre">True</span></code>，否则返回<code class="docutils literal notranslate"><span class="pre">False</span></code>。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">ms_function</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">z</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)))</span>

<span class="nd">@ms_function</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
    <span class="n">x_is_tuple</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
    <span class="n">y_is_list</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
    <span class="n">z_is_tensor</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x_is_tuple</span><span class="p">,</span> <span class="n">y_is_list</span><span class="p">,</span> <span class="n">z_is_tensor</span>

<span class="n">x_is_tuple</span><span class="p">,</span> <span class="n">y_is_list</span><span class="p">,</span> <span class="n">z_is_tensor</span> <span class="o">=</span> <span class="n">test</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x_is_tuple:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x_is_tuple</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;y_is_list:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y_is_list</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;z_is_tensor:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">z_is_tensor</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>x_is_tuple:True
y_is_list:True
z_is_tensor:True
</pre></div>
</div>
</section>
<section id="partial">
<h4>partial<a class="headerlink" href="#partial" title="Permalink to this headline"></a></h4>
<p>功能：偏函数，固定函数入参。</p>
<p>调用：<code class="docutils literal notranslate"><span class="pre">partial(func,</span> <span class="pre">arg,</span> <span class="pre">...)</span></code></p>
<p>入参：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">func</span></code> – 函数。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">arg</span></code> – 一个或多个要固定的参数，支持位置参数和键值对传参。</p></li>
</ul>
<p>返回值：返回某些入参固定了值的函数。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">ms_function</span><span class="p">,</span> <span class="n">ops</span>

<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="nd">@ms_function</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="n">add_</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">add_</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">add_</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span>

<span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">test</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;m:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;n:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>m:5
n:7
</pre></div>
</div>
</section>
<section id="map">
<h4>map<a class="headerlink" href="#map" title="Permalink to this headline"></a></h4>
<p>功能：根据提供的函数对一个或者多个序列做映射，由映射的结果生成一个新的序列。
如果多个序列中的元素个数不一致，则生成的新序列与最短的那个长度相同。</p>
<p>调用：<code class="docutils literal notranslate"><span class="pre">map(func,</span> <span class="pre">sequence,</span> <span class="pre">...)</span></code></p>
<p>入参：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">func</span></code> – 函数。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sequence</span></code> – 一个或多个序列（<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>或者<code class="docutils literal notranslate"><span class="pre">List</span></code>）。</p></li>
</ul>
<p>返回值：返回一个<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">ms_function</span>

<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="nd">@ms_function</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="n">elements_a</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">elements_b</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="n">elements_a</span><span class="p">,</span> <span class="n">elements_b</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ret</span>

<span class="n">ret</span> <span class="o">=</span> <span class="n">test</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ret:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ret: (5, 7, 9)
</pre></div>
</div>
</section>
<section id="zip">
<h4>zip<a class="headerlink" href="#zip" title="Permalink to this headline"></a></h4>
<p>功能：将多个序列中对应位置的元素打包成一个个元组，然后由这些元组组成一个新序列，
如果各个序列中的元素个数不一致，则生成的新序列与最短的那个长度相同。</p>
<p>调用：<code class="docutils literal notranslate"><span class="pre">zip(sequence,</span> <span class="pre">...)</span></code></p>
<p>入参：<code class="docutils literal notranslate"><span class="pre">sequence</span></code> – 一个或多个序列(<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>或<code class="docutils literal notranslate"><span class="pre">List</span></code>)`。</p>
<p>返回值：返回一个<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">ms_function</span>

<span class="nd">@ms_function</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="n">elements_a</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">elements_b</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">elements_a</span><span class="p">,</span> <span class="n">elements_b</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ret</span>

<span class="n">ret</span> <span class="o">=</span> <span class="n">test</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ret:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ret:((1, 4), (2, 5), (3, 6))
</pre></div>
</div>
</section>
<section id="range">
<h4>range<a class="headerlink" href="#range" title="Permalink to this headline"></a></h4>
<p>功能：根据起始值、结束值和步长创建一个<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>。</p>
<p>调用：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">range(start,</span> <span class="pre">stop,</span> <span class="pre">step)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">range(start,</span> <span class="pre">stop)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">range(stop)</span></code></p></li>
</ul>
<p>入参：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">start</span></code> – 计数起始值，类型为<code class="docutils literal notranslate"><span class="pre">int</span></code>，默认为0。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stop</span></code> – 计数结束值，但不包括在内，类型为<code class="docutils literal notranslate"><span class="pre">int</span></code>。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">step</span></code> – 步长，类型为<code class="docutils literal notranslate"><span class="pre">int</span></code>，默认为1。</p></li>
</ul>
<p>返回值：返回一个<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">ms_function</span>

<span class="nd">@ms_function</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span>

<span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">test</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;y:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;z:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>x:(0, 2, 4)
y:(0, 1, 2, 3, 4)
z:(0, 1, 2)
</pre></div>
</div>
</section>
<section id="enumerate">
<h4>enumerate<a class="headerlink" href="#enumerate" title="Permalink to this headline"></a></h4>
<p>功能：生成一个序列的索引序列，索引序列包含数据和对应下标。</p>
<p>调用：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">enumerate(sequence,</span> <span class="pre">start)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">enumerate(sequence)</span></code></p></li>
</ul>
<p>入参：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sequence</span></code> – 一个序列（<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">List</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>）。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">start</span></code> – 下标起始位置，类型为<code class="docutils literal notranslate"><span class="pre">int</span></code>，默认为0。</p></li>
</ul>
<p>返回值：返回一个<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">ms_function</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]]))</span>

<span class="nd">@ms_function</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span>

<span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">test</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;m:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;n:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>m:((3, 100), (4, 200), (5, 300), (6, 400))
n:((0, Tensor(shape=[2], dtype=Int64, value= [1, 2])), (1, Tensor(shape=[2], dtype=Int64, value= [3, 4])), (2, Tensor(shape=[2], dtype=Int64, value= [5, 6])))
</pre></div>
</div>
</section>
<section id="super">
<h4>super<a class="headerlink" href="#super" title="Permalink to this headline"></a></h4>
<p>功能：用于调用父类(超类)的一个方法，一般在<code class="docutils literal notranslate"><span class="pre">super</span></code>之后调用父类的方法。</p>
<p>调用：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">super().xxx()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">super(type,</span> <span class="pre">self).xxx()</span></code></p></li>
</ul>
<p>入参：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code> – 类。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">self</span></code> – 对象。</p></li>
</ul>
<p>返回值：返回父类的方法。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">nn</span>

<span class="k">class</span> <span class="nc">FatherNet</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">FatherNet</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span>

    <span class="k">def</span> <span class="nf">test_father</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">x</span>

<span class="k">class</span> <span class="nc">SingleSubNet</span><span class="p">(</span><span class="n">FatherNet</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SingleSubNet</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">z</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="n">ret_father_construct</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">ret_father_test</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">SingleSubNet</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">test_father</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret_father_construct</span><span class="p">,</span> <span class="n">ret_father_test</span>
</pre></div>
</div>
</section>
<section id="pow">
<h4>pow<a class="headerlink" href="#pow" title="Permalink to this headline"></a></h4>
<p>功能：求幂。</p>
<p>调用：<code class="docutils literal notranslate"><span class="pre">pow(x,</span> <span class="pre">y)</span></code></p>
<p>入参：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">x</span></code> – 底数， <code class="docutils literal notranslate"><span class="pre">Number</span></code>或<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">y</span></code> – 幂指数， <code class="docutils literal notranslate"><span class="pre">Number</span></code>或<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。</p></li>
</ul>
<p>返回值：返回<code class="docutils literal notranslate"><span class="pre">x</span></code>的<code class="docutils literal notranslate"><span class="pre">y</span></code>次幂，<code class="docutils literal notranslate"><span class="pre">Number</span></code>或<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">ms_function</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>

<span class="nd">@ms_function</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="n">ret</span> <span class="o">=</span> <span class="n">test</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ret:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ret:[ 1  4 27]
</pre></div>
</div>
</section>
<section id="print">
<h4>print<a class="headerlink" href="#print" title="Permalink to this headline"></a></h4>
<p>功能：用于打印。</p>
<p>调用：<code class="docutils literal notranslate"><span class="pre">print(arg,</span> <span class="pre">...)</span></code></p>
<p>入参：<code class="docutils literal notranslate"><span class="pre">arg</span></code> – 要打印的信息(<code class="docutils literal notranslate"><span class="pre">int</span></code> 、<code class="docutils literal notranslate"><span class="pre">float</span></code>、<code class="docutils literal notranslate"><span class="pre">bool</span></code>、<code class="docutils literal notranslate"><span class="pre">String</span></code>或<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>)。
当打印的数据是<code class="docutils literal notranslate"><span class="pre">int</span></code>，<code class="docutils literal notranslate"><span class="pre">float</span></code>或者<code class="docutils literal notranslate"><span class="pre">bool</span></code>时，会将其包成一个<code class="docutils literal notranslate"><span class="pre">0-D</span></code>的tensor打印出来。</p>
<p>返回值：无返回值。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">ms_function</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span> <span class="n">ms</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">ms</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

<span class="nd">@ms_function</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

<span class="n">ret</span> <span class="o">=</span> <span class="n">test</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Tensor(shape=[3], dtype=Int32, value= [1 2 3])
3
</pre></div>
</div>
</section>
<section id="filter">
<h4>filter<a class="headerlink" href="#filter" title="Permalink to this headline"></a></h4>
<p>功能：根据提供的函数对一个序列的元素做判断，每个元素依次作为参数传入函数中，将返回结果不为0或False的元素组成新的序列。</p>
<p>调用：<code class="docutils literal notranslate"><span class="pre">filter(func,</span> <span class="pre">sequence)</span></code></p>
<p>入参：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">func</span></code> – 函数。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sequence</span></code> – 序列（<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>或<code class="docutils literal notranslate"><span class="pre">List</span></code>）。</p></li>
</ul>
<p>返回值：返回一个<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">ms_function</span>

<span class="k">def</span> <span class="nf">is_odd</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>

<span class="nd">@ms_function</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="n">elements</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="n">is_odd</span><span class="p">,</span> <span class="n">elements</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ret</span>

<span class="n">ret</span> <span class="o">=</span> <span class="n">test</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ret:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ret:(1, 3, 5)
</pre></div>
</div>
</section>
</section>
<section id="函数参数">
<h3>函数参数<a class="headerlink" href="#函数参数" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>参数默认值：目前不支持默认值设为<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>类型数据，支持<code class="docutils literal notranslate"><span class="pre">int</span></code>、<code class="docutils literal notranslate"><span class="pre">float</span></code>、<code class="docutils literal notranslate"><span class="pre">bool</span></code>、<code class="docutils literal notranslate"><span class="pre">None</span></code>、<code class="docutils literal notranslate"><span class="pre">str</span></code>、<code class="docutils literal notranslate"><span class="pre">tuple</span></code>、<code class="docutils literal notranslate"><span class="pre">list</span></code>、<code class="docutils literal notranslate"><span class="pre">dict</span></code>类型数据。</p></li>
<li><p>可变参数：支持带可变参数网络的推理和训练。</p></li>
<li><p>键值对参数：目前不支持带键值对参数的函数求反向。</p></li>
<li><p>可变键值对参数：目前不支持带可变键值对的函数求反向。</p></li>
</ul>
</section>
</section>
<section id="网络定义">
<h2>网络定义<a class="headerlink" href="#网络定义" title="Permalink to this headline"></a></h2>
<section id="网络入参">
<h3>网络入参<a class="headerlink" href="#网络入参" title="Permalink to this headline"></a></h3>
<p>整网（最外层网络）入参仅支持<code class="docutils literal notranslate"><span class="pre">bool</span></code>、<code class="docutils literal notranslate"><span class="pre">int</span></code>、<code class="docutils literal notranslate"><span class="pre">float</span></code>、<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>、<code class="docutils literal notranslate"><span class="pre">None</span></code>、<code class="docutils literal notranslate"><span class="pre">mstype.number(mstype.bool_、mstype.int、mstype.float、mstype.uint)</span></code>，以及只包含这些类型对象的<code class="docutils literal notranslate"><span class="pre">list</span></code>或者<code class="docutils literal notranslate"><span class="pre">tuple</span></code>，和<code class="docutils literal notranslate"><span class="pre">value</span></code>值是这些类型的<code class="docutils literal notranslate"><span class="pre">Dictionary</span></code>。</p>
<p>在对整网入参求梯度的时候，会忽略非<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>的入参，只计算<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>入参的梯度。例如整网入参<code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">z)</span></code>中，<code class="docutils literal notranslate"><span class="pre">x</span></code>和<code class="docutils literal notranslate"><span class="pre">z</span></code>是<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，<code class="docutils literal notranslate"><span class="pre">y</span></code>是非<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>时，在对整网入参求梯度的时候，只会计算<code class="docutils literal notranslate"><span class="pre">x</span></code>和<code class="docutils literal notranslate"><span class="pre">z</span></code>的梯度，返回<code class="docutils literal notranslate"><span class="pre">(grad_x,</span> <span class="pre">grad_z)</span></code>。</p>
<p>如果网络里要使用其他类型，可在初始化网络的时候，传入该类型对象，作为网络属性保存起来，然后在<code class="docutils literal notranslate"><span class="pre">construct</span></code>里使用。
内层调用的网络入参无此限制。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">nn</span><span class="p">,</span> <span class="n">ops</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Net</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flag</span> <span class="o">=</span> <span class="n">flag</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag</span> <span class="o">==</span> <span class="s2">&quot;ok&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">+</span> <span class="n">z</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span> <span class="o">-</span> <span class="n">z</span>

<span class="k">class</span> <span class="nc">GradNet</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">net</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">GradNet</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grad_all</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">GradOperation</span><span class="p">(</span><span class="n">get_all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forward_net</span> <span class="o">=</span> <span class="n">net</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">grad_all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forward_net</span><span class="p">)(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>

<span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;ok&quot;</span>
<span class="n">input_x</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="n">input_y</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">input_z</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">net</span> <span class="o">=</span> <span class="n">Net</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<span class="n">grad_net</span> <span class="o">=</span> <span class="n">GradNet</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
<span class="n">ret</span> <span class="o">=</span> <span class="n">grad_net</span><span class="p">(</span><span class="n">input_x</span><span class="p">,</span> <span class="n">input_y</span><span class="p">,</span> <span class="n">input_z</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ret:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret</span><span class="p">))</span>
</pre></div>
</div>
<p>结果如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ret:(Tensor(shape=[2, 3], dtype=Float32, value=
[[ 1.00000000e+00,  1.00000000e+00,  1.00000000e+00],
 [ 1.00000000e+00,  1.00000000e+00,  1.00000000e+00]]), Tensor(shape=[2, 3], dtype=Float32, value=
[[ 1.00000000e+00,  1.00000000e+00,  1.00000000e+00],
 [ 1.00000000e+00,  1.00000000e+00,  1.00000000e+00]]))
</pre></div>
</div>
<p>上面定义的Net网络里，在初始化时传入一个<code class="docutils literal notranslate"><span class="pre">string</span></code> flag，作为网络的属性保存起来，然后在<code class="docutils literal notranslate"><span class="pre">construct</span></code>里使用<code class="docutils literal notranslate"><span class="pre">self.flag</span></code>这个属性。</p>
<p>整网入参<code class="docutils literal notranslate"><span class="pre">x</span></code>和<code class="docutils literal notranslate"><span class="pre">z</span></code>是<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>，<code class="docutils literal notranslate"><span class="pre">y</span></code>是<code class="docutils literal notranslate"><span class="pre">int</span></code>数，<code class="docutils literal notranslate"><span class="pre">grad_net</span></code>在对整网入参<code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">z)</span></code>求梯度时，会自动忽略<code class="docutils literal notranslate"><span class="pre">y</span></code>的梯度，只计算<code class="docutils literal notranslate"><span class="pre">x</span></code>和<code class="docutils literal notranslate"><span class="pre">z</span></code>的梯度，<code class="docutils literal notranslate"><span class="pre">ret</span> <span class="pre">=</span> <span class="pre">(grad_x,</span> <span class="pre">grad_z)</span></code>。</p>
</section>
<section id="网络实例类型">
<h3>网络实例类型<a class="headerlink" href="#网络实例类型" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>带<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/r1.8/api_python/mindspore/mindspore.ms_function.html">&#64;ms_function</a>装饰器的普通Python函数。</p></li>
<li><p>继承自<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/r1.8/api_python/nn/mindspore.nn.Cell.html">nn.Cell</a>的Cell子类。</p></li>
</ul>
</section>
<section id="网络构造组件">
<h3>网络构造组件<a class="headerlink" href="#网络构造组件" title="Permalink to this headline"></a></h3>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="text-left head"><p>类别</p></th>
<th class="text-left head"><p>内容</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Cell</span></code>实例</p></td>
<td class="text-left"><p><a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/r1.8/api_python/mindspore.nn.html">mindspore/nn/*</a>、自定义<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/r1.8/api_python/nn/mindspore.nn.Cell.html">Cell</a>。</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Cell</span></code>实例的成员函数</p></td>
<td class="text-left"><p>Cell的construct中可以调用其他类成员函数。</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">ms_class</span></code>实例</p></td>
<td class="text-left"><p>使用<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/r1.8/api_python/mindspore/mindspore.ms_class.html">&#64;ms_class</a>装饰的类。</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Primitive</span></code>算子</p></td>
<td class="text-left"><p><a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/r1.8/api_python/mindspore.ops.html">mindspore/ops/operations/*</a></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">Composite</span></code>算子</p></td>
<td class="text-left"><p><a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/r1.8/api_python/mindspore.ops.html">mindspore/ops/composite/*</a></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">constexpr</span></code>生成算子</p></td>
<td class="text-left"><p>使用<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/r1.8/api_python/ops/mindspore.ops.constexpr.html">&#64;constexpr</a>生成的值计算算子。</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>函数</p></td>
<td class="text-left"><p>自定义Python函数、前文中列举的系统函数。</p></td>
</tr>
</tbody>
</table>
</section>
<section id="网络使用约束">
<h3>网络使用约束<a class="headerlink" href="#网络使用约束" title="Permalink to this headline"></a></h3>
<ol class="arabic">
<li><p>不允许修改网络的非<code class="docutils literal notranslate"><span class="pre">Parameter</span></code>类型数据成员。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">nn</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Net</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">par</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;par&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">par</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="n">net</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
<span class="n">net</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>上面所定义的网络里，<code class="docutils literal notranslate"><span class="pre">self.x</span></code>不是一个<code class="docutils literal notranslate"><span class="pre">Parameter</span></code>，不允许被修改，而<code class="docutils literal notranslate"><span class="pre">self.par</span></code>是一个<code class="docutils literal notranslate"><span class="pre">Parameter</span></code>，可以被修改。</p>
<p>结果报错如下：</p>
<div class="highlight-Text notranslate"><div class="highlight"><pre><span></span>TypeError: &#39;self.x&#39; should be initialized as a &#39;Parameter&#39; type in the &#39;__init__&#39; function
</pre></div>
</div>
</li>
<li><p>当<code class="docutils literal notranslate"><span class="pre">construct</span></code>函数里，使用未定义的类成员时，不会像Python解释器那样抛出<code class="docutils literal notranslate"><span class="pre">AttributeError</span></code>，而是作为<code class="docutils literal notranslate"><span class="pre">None</span></code>处理。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">nn</span>

<span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Net</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>

<span class="n">net</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
<span class="n">net</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>上面所定义的网络里，<code class="docutils literal notranslate"><span class="pre">construct</span></code>里使用了并未定义的类成员<code class="docutils literal notranslate"><span class="pre">self.y</span></code>，此时会将<code class="docutils literal notranslate"><span class="pre">self.y</span></code>作为<code class="docutils literal notranslate"><span class="pre">None</span></code>处理。</p>
<p>结果报错如下：</p>
<div class="highlight-Text notranslate"><div class="highlight"><pre><span></span>RuntimeError: mindspore/ccsrc/frontend/operator/composite/multitype_funcgraph.cc:161 GenerateFromTypes] The &#39;add&#39; operation does not support the type [Int64, kMetaTypeNone]
</pre></div>
</div>
</li>
</ol>
</section>
</section>
</section>


           </div>
           
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="syntax_list.html" class="btn btn-neutral float-left" title="语法支持" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="index_support.html" class="btn btn-neutral float-right" title="Tensor索引支持" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, MindSpore.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   
</body>
</html>