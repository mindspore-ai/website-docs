<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>mindspore.rewrite &mdash; MindSpore master 文档</title>
      <link rel="stylesheet" href="../_static/css/bootstrap.min.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/training.css" type="text/css" /><link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/js/training.js"></script>
        <script src="../_static/translations.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="mindspore.boost" href="mindspore.boost.html" />
    <link rel="prev" title="mindspore.nn.probability.distribution.Uniform" href="nn_probability/mindspore.nn.probability.distribution.Uniform.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> MindSpore
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="在文档中搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">设计</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../design/overview.html">MindSpore设计概览</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/programming_paradigm.html">编程范式</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/auto_gradient.html">函数式微分编程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/mindir.html">中间表示MindIR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/all_scenarios.html">全场景统一</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/dynamic_graph_and_static_graph.html">动静态图结合</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/pluggable_device.html">三方硬件对接</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/distributed_training_design.html">分布式并行</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/graph_fusion_engine.html">图算融合加速引擎</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/data_engine.html">高性能数据处理引擎</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/glossary.html">术语</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">模型库</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../note/official_models.html">官方模型库</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="mindspore.html">mindspore</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindspore.nn.html">mindspore.nn</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindspore.ops.html">mindspore.ops</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindspore.ops.primitive.html">mindspore.ops.primitive</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindspore.amp.html">mindspore.amp</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindspore.train.html">mindspore.train</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindspore.communication.html">mindspore.communication</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindspore.common.initializer.html">mindspore.common.initializer</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindspore.dataset.html">mindspore.dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindspore.dataset.transforms.html">mindspore.dataset.transforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindspore.mindrecord.html">mindspore.mindrecord</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindspore.nn.probability.html">mindspore.nn.probability</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">mindspore.rewrite</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindspore.boost.html">mindspore.boost</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindspore.numpy.html">mindspore.numpy</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindspore.scipy.html">mindspore.scipy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API映射</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../note/api_mapping/pytorch_api_mapping.html">PyTorch与MindSpore API映射表</a></li>
<li class="toctree-l1"><a class="reference internal" href="../note/api_mapping/tensorflow_api_mapping.html">TensorFlow与MindSpore API映射表</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">迁移指南</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../migration_guide/overview.html">迁移指南概述</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration_guide/enveriment_preparation.html">环境准备与资料获取</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration_guide/analysis_and_preparation.html">模型分析与准备</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration_guide/model_development/model_development.html">MindSpore网络搭建</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration_guide/debug_and_tune.html">调试调优</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration_guide/sample_code.html">网络迁移调试实例</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration_guide/faq.html">常见问题</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">语法支持</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../note/static_graph_syntax_support.html">静态图语法支持</a></li>
<li class="toctree-l1"><a class="reference internal" href="../note/index_support.html">Tensor索引支持</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FAQ</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../faq/installation.html">安装</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/data_processing.html">数据处理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/implement_problem.html">执行问题</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/network_compilation.html">网络编译</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/operators_compile.html">算子编译</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/usage_migrate_3rd.html">第三方框架迁移使用</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/performance_tuning.html">性能调优</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/precision_tuning.html">精度调优</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/distributed_parallel.html">分布式并行</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/inference.html">推理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/feature_advice.html">特性咨询</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">RELEASE NOTES</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../RELEASE.html">Release Notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MindSpore</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>mindspore.rewrite</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/api_python/mindspore.rewrite.rst.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="mindspore-rewrite">
<h1>mindspore.rewrite<a class="headerlink" href="#mindspore-rewrite" title="永久链接至标题"></a></h1>
<p>MindSpore的ReWrite功能用于修改网络前向的计算过程，对网络进行插入、删除和替换语句。该功能目前处于开发调试阶段，可能会更改或删除。</p>
<p>ReWrite完整示例请参考
<a class="reference external" href="https://gitee.com/mindspore/mindspore/tree/r2.0/docs/api/api_python/rewrite_example.py">rewrite_example.py</a> 。
该样例代码的主要功能包括：怎么通过网络创建SymbolTree，并且对SymbolTree中的节点进行插入删除替换等操作，其中还包含了对子网络的修改和通过模式匹配进行节点替换。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">mindspore</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">export</span>
<span class="kn">from</span> <span class="nn">mindspore.rewrite</span> <span class="kn">import</span> <span class="n">SymbolTree</span><span class="p">,</span> <span class="n">ScopedValue</span><span class="p">,</span> <span class="n">Node</span><span class="p">,</span> <span class="n">NodeType</span><span class="p">,</span> <span class="n">Replacement</span><span class="p">,</span> <span class="n">PatternEngine</span><span class="p">,</span> <span class="n">PatternNode</span><span class="p">,</span> \
    <span class="n">TreeNodeHelper</span>
<span class="kn">import</span> <span class="nn">mindspore.nn</span> <span class="k">as</span> <span class="nn">nn</span>
<span class="kn">import</span> <span class="nn">mindspore.ops</span> <span class="k">as</span> <span class="nn">ops</span>


<span class="k">class</span> <span class="nc">SubNet</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;子网络定义&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dense</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">out_channels</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">weight_init</span><span class="o">=</span><span class="s2">&quot;ones&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">ReduceMean</span><span class="p">(</span><span class="n">keep_dims</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conv1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dense</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>


<span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;网络定义&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Net</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conv1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">pad_mode</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conv2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">pad_mode</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relu</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_pool2d</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">MaxPool2d</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flatten</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Flatten</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simnet</span> <span class="o">=</span> <span class="n">SubNet</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;网络的前向计算过程&quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_pool2d</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_pool2d</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simnet</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>


<span class="k">def</span> <span class="nf">create_stree</span><span class="p">(</span><span class="n">network</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;创建SymbolTree&quot;&quot;&quot;</span>
    <span class="n">stree</span> <span class="o">=</span> <span class="n">SymbolTree</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
    <span class="n">stree</span><span class="o">.</span><span class="n">dump</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">stree</span>


<span class="k">def</span> <span class="nf">insert_node</span><span class="p">(</span><span class="n">stree</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;在网络中插入节点&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">stree</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;conv2&quot;</span><span class="p">:</span> <span class="c1"># 在名称为&#39;conv2&#39;的节点前面插入新的节点</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">stree</span><span class="o">.</span><span class="n">before</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="n">new_conv</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">new_conv_node</span> <span class="o">=</span> <span class="n">Node</span><span class="o">.</span><span class="n">create_call_cell</span><span class="p">(</span><span class="n">new_conv</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x_1&#39;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;new_conv&#39;</span><span class="p">,</span>
                                                  <span class="n">args</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">get_args</span><span class="p">())</span>
            <span class="n">stree</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">new_conv_node</span><span class="p">)</span>
            <span class="k">break</span>
    <span class="c1"># 使用新节点更新已有节点的输入</span>
    <span class="k">if</span> <span class="n">new_conv_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">stree</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;relu_1&quot;</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">set_arg_by_node</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">new_conv_node</span><span class="p">)</span>
                <span class="k">break</span>


<span class="k">def</span> <span class="nf">insert_node_to_subtree</span><span class="p">(</span><span class="n">stree</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;在子网络中插入节点&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_insert_conv</span><span class="p">(</span><span class="n">stree</span><span class="p">:</span> <span class="n">SymbolTree</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">stree</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">get_instance_type</span><span class="p">()</span> <span class="o">==</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">:</span>
                <span class="n">position</span> <span class="o">=</span> <span class="n">stree</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="n">new_conv</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">new_conv_node</span> <span class="o">=</span> <span class="n">Node</span><span class="o">.</span><span class="n">create_call_cell</span><span class="p">(</span><span class="n">new_conv</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x_1&#39;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;new_conv&#39;</span><span class="p">,</span>
                                                      <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">ScopedValue</span><span class="o">.</span><span class="n">create_naming_value</span><span class="p">(</span><span class="s1">&#39;x_1&#39;</span><span class="p">)])</span>
                <span class="n">stree</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">new_conv_node</span><span class="p">)</span>
                <span class="k">break</span>
    <span class="c1"># 在名称为&#39;simnet&#39;的子网络中插入新节点</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">stree</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">get_node_type</span><span class="p">()</span> <span class="o">==</span> <span class="n">NodeType</span><span class="o">.</span><span class="n">Tree</span> <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;simnet&quot;</span><span class="p">:</span>
            <span class="n">_insert_conv</span><span class="p">(</span><span class="n">TreeNodeHelper</span><span class="o">.</span><span class="n">get_sub_tree</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
            <span class="k">break</span>


<span class="k">def</span> <span class="nf">delete_node</span><span class="p">(</span><span class="n">stree</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;删除类型为nn.Flatten的节点&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">stree</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">get_instance_type</span><span class="p">()</span> <span class="o">==</span> <span class="n">nn</span><span class="o">.</span><span class="n">Flatten</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">get_users</span><span class="p">():</span>
                <span class="n">n</span><span class="o">.</span><span class="n">set_arg</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;x_7&quot;</span><span class="p">)</span>
            <span class="n">stree</span><span class="o">.</span><span class="n">erase_node</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="k">break</span>


<span class="k">def</span> <span class="nf">replace_node</span><span class="p">(</span><span class="n">stree</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;替换网络中的节点&quot;&quot;&quot;</span>
    <span class="n">new_conv</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">new_conv_node</span> <span class="o">=</span> <span class="n">Node</span><span class="o">.</span><span class="n">create_call_cell</span><span class="p">(</span><span class="n">new_conv</span><span class="p">,</span> <span class="p">[</span><span class="n">ScopedValue</span><span class="o">.</span><span class="n">create_naming_value</span><span class="p">(</span><span class="s2">&quot;replace_conv&quot;</span><span class="p">)],</span>
                                          <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">ScopedValue</span><span class="o">.</span><span class="n">create_naming_value</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)])</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">stree</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;conv1&quot;</span><span class="p">:</span>
            <span class="n">new_conv_node</span> <span class="o">=</span> <span class="n">stree</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="p">[</span><span class="n">new_conv_node</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">pattern_replace</span><span class="p">(</span><span class="n">stree</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;通过模式匹配的方式替换节点&quot;&quot;&quot;</span>
    <span class="k">class</span> <span class="nc">ConvReplacement</span><span class="p">(</span><span class="n">Replacement</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;创建新节点类的实现&quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">:</span> <span class="n">PatternNode</span><span class="p">,</span> <span class="n">is_chain_pattern</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">matched</span><span class="p">:</span> <span class="n">OrderedDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
            <span class="n">bn_node</span><span class="p">:</span> <span class="n">Node</span> <span class="o">=</span> <span class="n">matched</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pattern</span><span class="o">.</span><span class="n">name</span><span class="p">())</span>

            <span class="n">conv</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">conv_node</span> <span class="o">=</span> <span class="n">Node</span><span class="o">.</span><span class="n">create_call_cell</span><span class="p">(</span><span class="n">conv</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;x1&#39;</span><span class="p">],</span> <span class="n">bn_node</span><span class="o">.</span><span class="n">get_args</span><span class="p">(),</span> <span class="n">bn_node</span><span class="o">.</span><span class="n">get_kwargs</span><span class="p">(),</span>
                                              <span class="n">name</span><span class="o">=</span><span class="s2">&quot;pattern_conv&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">conv_node</span><span class="p">]</span>

    <span class="k">class</span> <span class="nc">BnReplace</span><span class="p">(</span><span class="n">PatternEngine</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;替换网络中nn.MaxPool2d类型的节点&quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">([</span><span class="n">nn</span><span class="o">.</span><span class="n">MaxPool2d</span><span class="p">],</span> <span class="n">ConvReplacement</span><span class="p">())</span>

    <span class="n">bn_replace</span> <span class="o">=</span> <span class="n">BnReplace</span><span class="p">()</span>
    <span class="n">bn_replace</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">stree</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_net</span><span class="p">(</span><span class="n">stree</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;获取修改后的网络&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">stree</span><span class="o">.</span><span class="n">get_network</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">get_code</span><span class="p">(</span><span class="n">stree</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;获取修改后的网络代码&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">stree</span><span class="o">.</span><span class="n">get_code</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">test_rewrite</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ReWrite测试函数&quot;&quot;&quot;</span>
    <span class="n">net</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
    <span class="n">stree</span> <span class="o">=</span> <span class="n">create_stree</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;origin code: </span><span class="si">{</span><span class="n">stree</span><span class="o">.</span><span class="n">get_code</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">insert_node</span><span class="p">(</span><span class="n">stree</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;after inser node code: </span><span class="si">{</span><span class="n">stree</span><span class="o">.</span><span class="n">get_code</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">insert_node_to_subtree</span><span class="p">(</span><span class="n">stree</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;after inser node to subtree code: </span><span class="si">{</span><span class="n">stree</span><span class="o">.</span><span class="n">get_code</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">delete_node</span><span class="p">(</span><span class="n">stree</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;after remove node code: </span><span class="si">{</span><span class="n">stree</span><span class="o">.</span><span class="n">get_code</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">replace_node</span><span class="p">(</span><span class="n">stree</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;after replace node code: </span><span class="si">{</span><span class="n">stree</span><span class="o">.</span><span class="n">get_code</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">pattern_replace</span><span class="p">(</span><span class="n">stree</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;after pattern replace node code: </span><span class="si">{</span><span class="n">stree</span><span class="o">.</span><span class="n">get_code</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">inputs</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">]),</span> <span class="n">mindspore</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="c1"># pylint: disable=not-callable</span>
    <span class="n">new_net</span> <span class="o">=</span> <span class="n">get_net</span><span class="p">(</span><span class="n">stree</span><span class="p">)</span>
    <span class="n">source_code</span> <span class="o">=</span> <span class="n">get_code</span><span class="p">(</span><span class="n">stree</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">source_code</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">new_net</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;out: &quot;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
    <span class="n">export</span><span class="p">(</span><span class="n">new_net</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">&quot;new_net&quot;</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="s2">&quot;MINDIR&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">test_rewrite</span><span class="p">()</span>
</pre></div>
</div>
<dl class="py class">
<dt class="sig sig-object py" id="mindspore.rewrite.SymbolTree">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mindspore.rewrite.</span></span><span class="sig-name descname"><span class="pre">SymbolTree</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">handler</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">SymbolTreeImpl</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/api/symbol_tree.html#SymbolTree"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.SymbolTree" title="打开链接"></a></dt>
<dd><p>SymbolTree通常对应于网络的前向计算过程。</p>
<dl class="simple">
<dt>参数：</dt><dd><ul class="simple">
<li><p><strong>handler</strong> (SymbolTreeImpl) - SymbolTree内部实现实例。</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mindspore.rewrite.SymbolTree.after">
<span class="sig-name descname"><span class="pre">after</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#mindspore.rewrite.Node" title="mindspore.rewrite.Node"><span class="pre">Node</span></a></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/api/symbol_tree.html#SymbolTree.after"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.SymbolTree.after" title="打开链接"></a></dt>
<dd><p>获取插入位置，位置为 <cite>node</cite> 之后。
返回值用于指示插入节点的位置，它指示在源代码中的位置，而不是在拓扑顺序中的位置。不需要关心 Position是什么，只需将其视为处理程序并将其用作SymbolTree的插入接口的参数。</p>
<dl class="simple">
<dt>参数：</dt><dd><ul class="simple">
<li><p><strong>node</strong> (Node) - 指定插入位置在哪个节点之后，可以是Node或者Node的名称。</p></li>
</ul>
</dd>
<dt>返回：</dt><dd><p>Position，指定插入节点的位置。</p>
</dd>
<dt>异常：</dt><dd><ul class="simple">
<li><p><strong>TypeError</strong> - 参数不是Node类型。</p></li>
</ul>
</dd>
</dl>
<p><strong>样例：</strong></p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore.rewrite</span> <span class="kn">import</span> <span class="n">SymbolTree</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Define the network structure of LeNet5. Refer to</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># https://gitee.com/mindspore/docs/blob/r2.0/docs/mindspore/code/lenet.py</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net</span> <span class="o">=</span> <span class="n">LeNet5</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stree</span> <span class="o">=</span> <span class="n">SymbolTree</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">stree</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;conv1&quot;</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">position</span> <span class="o">=</span> <span class="n">stree</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mindspore.rewrite.SymbolTree.before">
<span class="sig-name descname"><span class="pre">before</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#mindspore.rewrite.Node" title="mindspore.rewrite.Node"><span class="pre">Node</span></a></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/api/symbol_tree.html#SymbolTree.before"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.SymbolTree.before" title="打开链接"></a></dt>
<dd><p>与after的区别是，该接口返回的位置为 <cite>node</cite> 之前。
返回值用于指示插入节点的位置，它指示在源代码中的位置，而不是在拓扑顺序中的位置。不需要关心 <cite>Position</cite> 是什么，只需将其视为处理程序并将其用作 <cite>SymbolTree</cite> 的插入接口的参数。</p>
<dl class="simple">
<dt>参数：</dt><dd><ul class="simple">
<li><p><strong>node</strong> (Node) - 指定插入位置在哪个节点之前，可以是Node或者Node的名称。</p></li>
</ul>
</dd>
<dt>返回：</dt><dd><p>Position，指定插入节点的位置。</p>
</dd>
<dt>异常：</dt><dd><ul class="simple">
<li><p><strong>TypeError</strong> - 参数不是Node类型。</p></li>
</ul>
</dd>
</dl>
<p><strong>样例：</strong></p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore.rewrite</span> <span class="kn">import</span> <span class="n">SymbolTree</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Define the network structure of LeNet5. Refer to</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># https://gitee.com/mindspore/docs/blob/r2.0/docs/mindspore/code/lenet.py</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net</span> <span class="o">=</span> <span class="n">LeNet5</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stree</span> <span class="o">=</span> <span class="n">SymbolTree</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">stree</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;conv1&quot;</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">position</span> <span class="o">=</span> <span class="n">stree</span><span class="o">.</span><span class="n">before</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mindspore.rewrite.SymbolTree.create">
<span class="sig-name descname"><span class="pre">create</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">network</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/api/symbol_tree.html#SymbolTree.create"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.SymbolTree.create" title="打开链接"></a></dt>
<dd><p>根据传入的 <cite>network</cite> 创建SymbolTree对象。</p>
<dl class="simple">
<dt>参数：</dt><dd><ul class="simple">
<li><p><strong>network</strong> (Cell) - 重写的网络。</p></li>
</ul>
</dd>
<dt>返回：</dt><dd><p>SymbolTree，基于 <cite>network</cite> 创建的符号树。</p>
</dd>
<dt>异常：</dt><dd><ul class="simple">
<li><p><strong>TypeError</strong> - 参数 <cite>network</cite> 不是Cell类型对象。</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mindspore.rewrite.SymbolTree.dump">
<span class="sig-name descname"><span class="pre">dump</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/api/symbol_tree.html#SymbolTree.dump"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.SymbolTree.dump" title="打开链接"></a></dt>
<dd><p>将 <cite>SymbolTree</cite> 中network对应的ir图信息打印到屏幕。</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mindspore.rewrite.SymbolTree.erase_node">
<span class="sig-name descname"><span class="pre">erase_node</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#mindspore.rewrite.Node" title="mindspore.rewrite.Node"><span class="pre">Node</span></a></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/api/symbol_tree.html#SymbolTree.erase_node"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.SymbolTree.erase_node" title="打开链接"></a></dt>
<dd><p>删除SymbolTree中的一个节点。被删除的节点必须不被其他节点依赖。</p>
<dl class="simple">
<dt>参数：</dt><dd><ul class="simple">
<li><p><strong>node</strong> (Node) - 被删除的节点。可以是Node或者Node的名称。</p></li>
</ul>
</dd>
<dt>返回：</dt><dd><p>如果 <cite>node</cite> 属于当前的SymbolTree则返回被删除节点。否则返回None。</p>
</dd>
<dt>异常：</dt><dd><ul class="simple">
<li><p><strong>TypeError</strong> - 如果参数不是Node类型。</p></li>
</ul>
</dd>
</dl>
<p><strong>样例：</strong></p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore.rewrite</span> <span class="kn">import</span> <span class="n">SymbolTree</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Define the network structure of LeNet5. Refer to</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># https://gitee.com/mindspore/docs/blob/r2.0/docs/mindspore/code/lenet.py</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net</span> <span class="o">=</span> <span class="n">LeNet5</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stree</span> <span class="o">=</span> <span class="n">SymbolTree</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">node</span> <span class="o">=</span> <span class="n">stree</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;conv1&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">input_node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get_inputs</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">output_nodes</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get_users</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">output_nodes</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">n</span><span class="o">.</span><span class="n">set_arg</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stree</span><span class="o">.</span><span class="n">erase_node</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mindspore.rewrite.SymbolTree.get_code">
<span class="sig-name descname"><span class="pre">get_code</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/api/symbol_tree.html#SymbolTree.get_code"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.SymbolTree.get_code" title="打开链接"></a></dt>
<dd><p>获取SymbolTree所对应的源代码。</p>
<dl class="simple">
<dt>返回：</dt><dd><p>str，SymbolTree对应的源码字符串。</p>
</dd>
</dl>
<p><strong>样例：</strong></p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore.rewrite</span> <span class="kn">import</span> <span class="n">SymbolTree</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Define the network structure of LeNet5. Refer to</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># https://gitee.com/mindspore/docs/blob/r2.0/docs/mindspore/code/lenet.py</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net</span> <span class="o">=</span> <span class="n">LeNet5</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stree</span> <span class="o">=</span> <span class="n">SymbolTree</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">codes</span> <span class="o">=</span> <span class="n">stree</span><span class="o">.</span><span class="n">get_code</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">codes</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mindspore.rewrite.SymbolTree.get_network">
<span class="sig-name descname"><span class="pre">get_network</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/api/symbol_tree.html#SymbolTree.get_network"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.SymbolTree.get_network" title="打开链接"></a></dt>
<dd><p>获取SymbolTree所对应的生成的网络对象。源码会保存到文件中，默认的文件名为 <cite>network_define.py</cite>。</p>
<dl class="simple">
<dt>返回：</dt><dd><p>根据SymbolTree生成的网络对象。</p>
</dd>
</dl>
<p><strong>样例：</strong></p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore.rewrite</span> <span class="kn">import</span> <span class="n">SymbolTree</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Define the network structure of LeNet5. Refer to</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># https://gitee.com/mindspore/docs/blob/r2.0/docs/mindspore/code/lenet.py</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net</span> <span class="o">=</span> <span class="n">LeNet5</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stree</span> <span class="o">=</span> <span class="n">SymbolTree</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_net</span> <span class="o">=</span> <span class="n">stree</span><span class="o">.</span><span class="n">get_network</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mindspore.rewrite.SymbolTree.insert">
<span class="sig-name descname"><span class="pre">insert</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">position</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">node</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#mindspore.rewrite.Node" title="mindspore.rewrite.Node"><span class="pre">Node</span></a></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/api/symbol_tree.html#SymbolTree.insert"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.SymbolTree.insert" title="打开链接"></a></dt>
<dd><p>在SymbolTree的 <cite>position</cite> 位置插入一个节点。 <cite>position</cite> 可以通过 <cite>before</cite> 或 <cite>after</cite> 来获得。</p>
<dl class="simple">
<dt>参数：</dt><dd><ul class="simple">
<li><p><strong>position</strong> (Position) - 插入位置。</p></li>
<li><p><strong>node</strong> (Node) - 要插入的节点。</p></li>
</ul>
</dd>
<dt>返回：</dt><dd><p><cite>Node</cite>，被插入的节点, 当调用此方法时会对参数进行唯一性处理， <cite>node</cite> 会被修改。</p>
</dd>
<dt>异常：</dt><dd><ul class="simple">
<li><p><strong>RuntimeError</strong> - 如果 <cite>position</cite> 指定的不是该SymbolTree内的位置。</p></li>
<li><p><strong>TypeError</strong> - 如果参数 <cite>position</cite> 不是Position类型。</p></li>
<li><p><strong>TypeError</strong> - 如果参数 <cite>node</cite> 不是Node类型。</p></li>
</ul>
</dd>
</dl>
<p><strong>样例：</strong></p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore.rewrite</span> <span class="kn">import</span> <span class="n">SymbolTree</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore.ops</span> <span class="kn">import</span> <span class="nb">abs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Define the network structure of LeNet5. Refer to</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># https://gitee.com/mindspore/docs/blob/r2.0/docs/mindspore/code/lenet.py</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net</span> <span class="o">=</span> <span class="n">LeNet5</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stree</span> <span class="o">=</span> <span class="n">SymbolTree</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">node</span> <span class="o">=</span> <span class="n">stree</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;conv1&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">position</span> <span class="o">=</span> <span class="n">stree</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_node</span> <span class="o">=</span> <span class="n">stree</span><span class="o">.</span><span class="n">create_call_function</span><span class="p">(</span><span class="nb">abs</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">node</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stree</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">new_node</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mindspore.rewrite.SymbolTree.nodes">
<span class="sig-name descname"><span class="pre">nodes</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/api/symbol_tree.html#SymbolTree.nodes"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.SymbolTree.nodes" title="打开链接"></a></dt>
<dd><p>获取当前SymbolTree的节点，用于遍历。</p>
<dl class="simple">
<dt>返回：</dt><dd><p>当前SymbolTree中节点的生成器。</p>
</dd>
</dl>
<p><strong>样例：</strong></p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore.rewrite</span> <span class="kn">import</span> <span class="n">SymbolTree</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Define the network structure of LeNet5. Refer to</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># https://gitee.com/mindspore/docs/blob/r2.0/docs/mindspore/code/lenet.py</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net</span> <span class="o">=</span> <span class="n">LeNet5</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stree</span> <span class="o">=</span> <span class="n">SymbolTree</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">stree</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">get_name</span><span class="p">())</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mindspore.rewrite.SymbolTree.replace">
<span class="sig-name descname"><span class="pre">replace</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">old_node</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#mindspore.rewrite.Node" title="mindspore.rewrite.Node"><span class="pre">Node</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_nodes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#mindspore.rewrite.Node" title="mindspore.rewrite.Node"><span class="pre">Node</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/api/symbol_tree.html#SymbolTree.replace"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.SymbolTree.replace" title="打开链接"></a></dt>
<dd><p>使用新节点列表来替代旧节点。</p>
<div class="admonition note">
<p class="admonition-title">说明</p>
<ul class="simple">
<li><p>仅支持一对一更换或一对多替换。如果需要多对多替换，请参考PatternEngine。</p></li>
<li><p>当一对多替换时，Rewrite会将 <cite>new_nodes</cite> 中所有节点插入到 <cite>symbol_tree</cite> 中。</p></li>
<li><p>调用者应指定子树内节点的参数和输出来确定子树内的拓扑关系。</p></li>
<li><p>调用者应指定子树输入节点的参数来确定子树与原始树中节点的拓扑关系。</p></li>
<li><p>ReWrite将维护子树的前置节点的参数，用于指定子树输出的拓扑关系。</p></li>
<li><p>将 <cite>new_nodes</cite> 替换到SymbolTree后，ReWrite将维护节点的所有输入。</p></li>
</ul>
</div>
<dl class="simple">
<dt>参数：</dt><dd><ul class="simple">
<li><p><strong>old_node</strong> (Node) - 被替换节点。</p></li>
<li><p><strong>new_nodes</strong> (list[Node]) - 要替换进SymbolTree的节点列表。</p></li>
</ul>
</dd>
<dt>返回：</dt><dd><p>替换到SymbolTree的节点列表的根节点。</p>
</dd>
<dt>异常：</dt><dd><ul class="simple">
<li><p><strong>RuntimeError</strong> - 如果 <cite>old_node</cite> 仍然被其他节点依赖。</p></li>
<li><p><strong>TypeError</strong> - 如果参数 <cite>new_nodes</cite> 不是list，或者列表中的成员不是Node类型。</p></li>
<li><p><strong>TypeError</strong> - 如果参数 <cite>old_node</cite> 不是Node类型。</p></li>
</ul>
</dd>
</dl>
<p><strong>样例：</strong></p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore.rewrite</span> <span class="kn">import</span> <span class="n">SymbolTree</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore.ops</span> <span class="kn">import</span> <span class="nb">abs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Define the network structure of LeNet5. Refer to</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># https://gitee.com/mindspore/docs/blob/r2.0/docs/mindspore/code/lenet.py</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net</span> <span class="o">=</span> <span class="n">LeNet5</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stree</span> <span class="o">=</span> <span class="n">SymbolTree</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">input_node</span> <span class="o">=</span> <span class="n">stree</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;input_x&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">node</span> <span class="o">=</span> <span class="n">stree</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;conv1&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_node</span> <span class="o">=</span> <span class="n">stree</span><span class="o">.</span><span class="n">create_call_function</span><span class="p">(</span><span class="nb">abs</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">input_node</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stree</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="p">[</span><span class="n">new_node</span><span class="p">])</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mindspore.rewrite.Node">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mindspore.rewrite.</span></span><span class="sig-name descname"><span class="pre">Node</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">NodeImpl</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/api/node.html#Node"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.Node" title="打开链接"></a></dt>
<dd><p>节点是表达网络中源代码的一种数据结构。</p>
<p>在大多数情况下，Node表示前向计算的的运算，它可以是Cell的实例、Primitive的实例或可调用的方法。</p>
<dl class="simple">
<dt>参数：</dt><dd><ul class="simple">
<li><p><strong>node</strong> (NodeImpl) - <cite>NodeImpl</cite> 的handle。NodeImpl是Node的实现，不是Rewrite的接口。Rewrite建议调用Node的特定 <cite>create</cite> 方法来实例化Node的实例，例如 <cite>create_call_cell</cite>，而不直接调用Node的构造函数，不需关心NodeImpl是什么，只需作为handle看待。</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mindspore.rewrite.Node.create_call_cell">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">create_call_cell</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cell</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="nn/mindspore.nn.Cell.html#mindspore.nn.Cell" title="mindspore.nn.Cell"><span class="pre">Cell</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">targets</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#mindspore.rewrite.ScopedValue" title="mindspore.rewrite.ScopedValue"><span class="pre">ScopedValue</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(在 Python v3.8)"><span class="pre">str</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#mindspore.rewrite.ScopedValue" title="mindspore.rewrite.ScopedValue"><span class="pre">ScopedValue</span></a><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">{str:</span> <span class="pre">ScopedValue}</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(在 Python v3.8)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">is_sub_net</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/library/functions.html#bool" title="(在 Python v3.8)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/api/node.html#Node.create_call_cell"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.Node.create_call_cell" title="打开链接"></a></dt>
<dd><p>通过该接口可以根据 <cite>cell</cite> 对象创建一个Node实例。节点对应的源代码格式：
<code class="docutils literal notranslate"><span class="pre">targets</span> <span class="pre">=</span> <span class="pre">self.name(*args,</span> <span class="pre">**kwargs)</span></code>。</p>
<dl class="simple">
<dt>参数：</dt><dd><ul class="simple">
<li><p><strong>cell</strong> (Cell) - 该节点对应的前向计算的Cell对象。</p></li>
<li><p><strong>targets</strong> (list[ScopedValue]) - 表示输出名称。在源代码中作为节点的输出。Rewrite将在插入节点时检查并确保每个目标的唯一性。</p></li>
<li><p><strong>args</strong> (list[ScopedValue]) - 该节点的参数名称。用作源代码中代码语句的参数。Rewrite将在插入节点时检查并确保每个 <cite>arg</cite> 的唯一性。默认值： <code class="docutils literal notranslate"><span class="pre">None</span></code> ，表示 <cite>cell</cite> 没有参数输入。</p></li>
<li><p><strong>kwargs</strong> (dict) - 键的类型必须是str，值的类型必须是ScopedValue。用来说明带有关键字的形参的输入参数名称。输入名称在源代码中作为语句表达式中的 <cite>kwargs</cite>。Rewrite将在插入节点时检查并确保每个 <cite>kwarg</cite> 的唯一性。默认值： <code class="docutils literal notranslate"><span class="pre">None</span></code> ，表示 <cite>cell</cite> 没有 <cite>kwargs</cite> 输入。</p></li>
<li><p><strong>name</strong> (str) - 表示节点的名称。用作源代码中的字段名称。当未提供名称时，ReWrite将根据 <cite>target</cite> 生成一个默认名称。Rewrite将在插入节点时检查并确保名称的唯一性。默认值： <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> 。</p></li>
<li><p><strong>is_sub_net</strong> (bool) - 表示 <cite>cell</cite> 是否是一个网络。如果 <cite>is_sub_net</cite> 为 <code class="docutils literal notranslate"><span class="pre">True</span></code> ，Rewrite将尝试将 <cite>cell</cite> 解析为TreeNode，否则为CallCell节点。默认值： <code class="docutils literal notranslate"><span class="pre">False</span></code> 。</p></li>
</ul>
</dd>
<dt>返回：</dt><dd><p>Node实例。</p>
</dd>
<dt>异常：</dt><dd><ul class="simple">
<li><p><strong>TypeError</strong> - 如果参数 <cite>cell</cite> 不是Cell类型。</p></li>
<li><p><strong>TypeError</strong> - 如果参数 <cite>targets</cite> 不是list类型。</p></li>
<li><p><strong>TypeError</strong> - 如果参数 <cite>targets</cite> 的成员不是str或者ScopedValue类型。</p></li>
<li><p><strong>TypeError</strong> - 如果参数 <cite>args</cite> 不是ScopedValue类型。</p></li>
<li><p><strong>TypeError</strong> - 如果参数 <cite>kwarg</cite> 的 <cite>key</cite> 不是str类型或者 <cite>value</cite> 不是ScopedValue类型。</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mindspore.rewrite.Node.get_inputs">
<span class="sig-name descname"><span class="pre">get_inputs</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/api/node.html#Node.get_inputs"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.Node.get_inputs" title="打开链接"></a></dt>
<dd><p>获取当前节点的拓扑序的输入节点。</p>
<dl class="simple">
<dt>返回：</dt><dd><p>Node的实例列表。</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mindspore.rewrite.Node.get_instance_type">
<span class="sig-name descname"><span class="pre">get_instance_type</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/api/node.html#Node.get_instance_type"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.Node.get_instance_type" title="打开链接"></a></dt>
<dd><p>获取当前节点对应的 <cite>operation</cite> 实例类型。</p>
<ul class="simple">
<li><p>如果当前节点的 <cite>node_type</cite> 是 <cite>CallCell</cite>，该节点是Cell对象。</p></li>
<li><p>如果当前节点的 <cite>node_type</cite> 是 <cite>CallPrimitive</cite>，该节点的是Primitive对象。</p></li>
<li><p>如果当前节点的 <cite>node_type</cite> 是 <cite>Tree</cite>，该节点的类型是网络。</p></li>
<li><p>如果当前节点的 <cite>node_type</cite> 是 <cite>Python</cite>、 <cite>Input</cite>、 <cite>Output</cite>、 <cite>CallMethod</cite>，该节点的类型为NoneType。</p></li>
</ul>
<dl class="simple">
<dt>返回：</dt><dd><p>当前节点的 <cite>operation</cite> 类型。</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mindspore.rewrite.Node.get_name">
<span class="sig-name descname"><span class="pre">get_name</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/api/node.html#Node.get_name"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.Node.get_name" title="打开链接"></a></dt>
<dd><p>获取当前节点的名称。当节点被插入到SymbolTree时，节点的名称在SymbolTree中应该是唯一的。</p>
<dl class="simple">
<dt>返回：</dt><dd><p>节点的名称，类型为str。</p>
</dd>
</dl>
<p><strong>样例：</strong></p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore.rewrite</span> <span class="kn">import</span> <span class="n">SymbolTree</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Define the network structure of LeNet5. Refer to</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># https://gitee.com/mindspore/docs/blob/r2.0/docs/mindspore/code/lenet.py</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net</span> <span class="o">=</span> <span class="n">LeNet5</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stree</span> <span class="o">=</span> <span class="n">SymbolTree</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">node</span> <span class="o">=</span> <span class="n">stree</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;conv1&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">name</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mindspore.rewrite.Node.get_node_type">
<span class="sig-name descname"><span class="pre">get_node_type</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/api/node.html#Node.get_node_type"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.Node.get_node_type" title="打开链接"></a></dt>
<dd><p>获取当前节点节点的类型。</p>
<dl class="simple">
<dt>返回：</dt><dd><p>NodeType，当前节点的类型。</p>
</dd>
</dl>
<p><strong>样例：</strong></p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore.rewrite</span> <span class="kn">import</span> <span class="n">SymbolTree</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Define the network structure of LeNet5. Refer to</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># https://gitee.com/mindspore/docs/blob/r2.0/docs/mindspore/code/lenet.py</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net</span> <span class="o">=</span> <span class="n">LeNet5</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stree</span> <span class="o">=</span> <span class="n">SymbolTree</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">node</span> <span class="o">=</span> <span class="n">stree</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;conv1&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">node_type</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get_node_type</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mindspore.rewrite.Node.get_users">
<span class="sig-name descname"><span class="pre">get_users</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/api/node.html#Node.get_users"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.Node.get_users" title="打开链接"></a></dt>
<dd><p>按拓扑顺序获取当前节点的输出节点。</p>
<dl class="simple">
<dt>返回：</dt><dd><p>输出节点的列表。</p>
</dd>
</dl>
<p><strong>样例：</strong></p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore.rewrite</span> <span class="kn">import</span> <span class="n">SymbolTree</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Define the network structure of LeNet5. Refer to</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># https://gitee.com/mindspore/docs/blob/r2.0/docs/mindspore/code/lenet.py</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net</span> <span class="o">=</span> <span class="n">LeNet5</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stree</span> <span class="o">=</span> <span class="n">SymbolTree</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">node</span> <span class="o">=</span> <span class="n">stree</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;conv1&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">users</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get_users</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mindspore.rewrite.Node.set_arg">
<span class="sig-name descname"><span class="pre">set_arg</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">index</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(在 Python v3.8)"><span class="pre">int</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">arg</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#mindspore.rewrite.ScopedValue" title="mindspore.rewrite.ScopedValue"><span class="pre">ScopedValue</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(在 Python v3.8)"><span class="pre">str</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/api/node.html#Node.set_arg"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.Node.set_arg" title="打开链接"></a></dt>
<dd><p>设置当前节点的输入参数。</p>
<dl class="simple">
<dt>参数：</dt><dd><ul class="simple">
<li><p><strong>index</strong> (int) - 要设置的参数索引。</p></li>
<li><p><strong>arg</strong> (Union[ScopedValue, str]) - 新参数的值。</p></li>
</ul>
</dd>
<dt>异常：</dt><dd><ul class="simple">
<li><p><strong>TypeError</strong> - 如果参数 <cite>index</cite> 不是int类型。</p></li>
<li><p><strong>TypeError</strong> - 如果参数 <cite>arg</cite> 不是str或者ScopedValue类型。</p></li>
</ul>
</dd>
</dl>
<p><strong>样例：</strong></p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore.rewrite</span> <span class="kn">import</span> <span class="n">SymbolTree</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Define the network structure of LeNet5. Refer to</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># https://gitee.com/mindspore/docs/blob/r2.0/docs/mindspore/code/lenet.py</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net</span> <span class="o">=</span> <span class="n">LeNet5</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stree</span> <span class="o">=</span> <span class="n">SymbolTree</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">node</span> <span class="o">=</span> <span class="n">stree</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;conv1&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">node</span><span class="o">.</span><span class="n">set_arg</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mindspore.rewrite.Node.set_arg_by_node">
<span class="sig-name descname"><span class="pre">set_arg_by_node</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">arg_idx</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(在 Python v3.8)"><span class="pre">int</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">src_node</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="s"><span class="pre">'Node'</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out_idx</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(在 Python v3.8)"><span class="pre">int</span></a><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/api/node.html#Node.set_arg_by_node"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.Node.set_arg_by_node" title="打开链接"></a></dt>
<dd><p>将另一个节点设置为当前节点的输入。</p>
<dl class="simple">
<dt>参数：</dt><dd><ul class="simple">
<li><p><strong>arg_idx</strong> (int) - 要设置的参数索引。</p></li>
<li><p><strong>src_node</strong> (Node) - 输入的节点。</p></li>
<li><p><strong>out_idx</strong> (int，optional) - 指定输入节点的哪个输出作为当前节点输入，则取第一个输出。默认值：None。</p></li>
</ul>
</dd>
<dt>异常：</dt><dd><ul class="simple">
<li><p><strong>RuntimeError</strong> - 如果 <cite>src_node</cite> 不属于当前的SymbolTree。</p></li>
<li><p><strong>TypeError</strong> - 如果参数 <cite>arg_idx</cite> 不是int类型。</p></li>
<li><p><strong>ValueError</strong> - 如果参数 <cite>arg_idx</cite> 超出了当前节点的参数数量。</p></li>
<li><p><strong>TypeError</strong> - 如果参数 <cite>src_node</cite> 不是Node类型。</p></li>
<li><p><strong>TypeError</strong> - 如果参数 <cite>out_idx</cite> 不是int类型。</p></li>
<li><p><strong>ValueError</strong> - 如果参数 <cite>out_idx</cite> 超出了 <cite>src_node</cite> 的输出数量。</p></li>
<li><p><strong>ValueError</strong> - 当 <cite>out_idx</cite> 为None或者没有给 <cite>out_idx</cite> 赋值时，参数 <cite>src_node</cite> 有多个输出。</p></li>
</ul>
</dd>
</dl>
<p><strong>样例：</strong></p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore.rewrite</span> <span class="kn">import</span> <span class="n">SymbolTree</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Define the network structure of LeNet5. Refer to</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># https://gitee.com/mindspore/docs/blob/r2.0/docs/mindspore/code/lenet.py</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net</span> <span class="o">=</span> <span class="n">LeNet5</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stree</span> <span class="o">=</span> <span class="n">SymbolTree</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">src_node</span> <span class="o">=</span> <span class="n">stree</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;conv1&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dst_node</span> <span class="o">=</span> <span class="n">stree</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s2">&quot;conv2&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dst_node</span><span class="o">.</span><span class="n">set_arg_by_node</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">src_node</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mindspore.rewrite.NodeType">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mindspore.rewrite.</span></span><span class="sig-name descname"><span class="pre">NodeType</span></span><a class="reference internal" href="../_modules/mindspore/rewrite/api/node_type.html#NodeType"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.NodeType" title="打开链接"></a></dt>
<dd><p>NodeType表示Node的类型。</p>
<ul class="simple">
<li><p><strong>Unknown</strong>：未初始化的节点类型。</p></li>
<li><p><strong>CallCell</strong>： <cite>CallCell</cite> 节点表示在前向计算中调用Cell对象。</p></li>
<li><p><strong>CallPrimitive</strong>： <cite>CallPrimitive</cite> 节点代表在前向计算中调用Primitive对象。</p></li>
<li><p><strong>CallMethod</strong>： <cite>CallMethod</cite> 不能对应到Cell或者Primitive的节点。</p></li>
<li><p><strong>Python</strong>： <cite>Python</cite> 节点包含不支持的 <cite>ast</cite> 的节点类型或不必要的解析 <cite>ast</cite> 节点。</p></li>
<li><p><strong>Input</strong>：输入节点代表SymbolTree的输入，对应方法的参数。</p></li>
<li><p><strong>Output</strong>: 输出节点代表SymbolTree的输出，对应方法的 <cite>return</cite> 语句。</p></li>
<li><p><strong>Tree</strong>: 树节点代表转发方法中的子网调用。</p></li>
</ul>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mindspore.rewrite.ScopedValue">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mindspore.rewrite.</span></span><span class="sig-name descname"><span class="pre">ScopedValue</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">arg_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#mindspore.rewrite.ValueType" title="mindspore.rewrite.ValueType"><span class="pre">ValueType</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">scope</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(在 Python v3.8)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/api/scoped_value.html#ScopedValue"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.ScopedValue" title="打开链接"></a></dt>
<dd><p>ScopedValue表示具有完整范围的值。</p>
<p>ScopedValue用于表示：左值，如赋值语句的目标，或可调用对象，如调用语句的 <cite>func</cite>，或右值，如赋值语句的 <cite>args</cite> 和 <cite>kwargs</cite>。</p>
<dl class="simple">
<dt>参数：</dt><dd><ul class="simple">
<li><p><strong>arg_type</strong> (ValueType) - 当前值的类型。</p></li>
<li><p><strong>scope</strong> (str) - 字符串表示当前值的范围。以”self.var1”为例，这个var1的作用域是”self”。默认值： <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> 。</p></li>
<li><p><strong>value</strong> - 当前ScopedValue中保存的值。值的类型对应于 <cite>arg_type</cite>。默认值： <code class="docutils literal notranslate"><span class="pre">None</span></code> 。</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mindspore.rewrite.ScopedValue.create_name_values">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">create_name_values</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">names</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/library/stdtypes.html#list" title="(在 Python v3.8)"><span class="pre">list</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/library/stdtypes.html#tuple" title="(在 Python v3.8)"><span class="pre">tuple</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scopes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/library/stdtypes.html#list" title="(在 Python v3.8)"><span class="pre">list</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/library/stdtypes.html#tuple" title="(在 Python v3.8)"><span class="pre">tuple</span></a><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/api/scoped_value.html#ScopedValue.create_name_values"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.ScopedValue.create_name_values" title="打开链接"></a></dt>
<dd><p>创建ScopedValue的列表。</p>
<dl class="simple">
<dt>参数：</dt><dd><ul class="simple">
<li><p><strong>names</strong> (list[str] or tuple[str]) - 引用变量的名称，类型为str的列表或元组。</p></li>
<li><p><strong>scopes</strong> (list[str] or tuple[str]) - 引用变量的范围，类型为str的列表或元组。默认值： <code class="docutils literal notranslate"><span class="pre">None</span></code> ，表示没有指定作用范围。</p></li>
</ul>
</dd>
<dt>返回：</dt><dd><p>ScopedValue的实例列表。</p>
</dd>
<dt>异常：</dt><dd><ul class="simple">
<li><p><strong>TypeError</strong> - 如果 <cite>names</cite> 不是 <cite>list</cite> 或 <cite>tuple</cite> 或者其中的元素不是str类型。</p></li>
<li><p><strong>TypeError</strong> - 如果 <cite>scopes</cite> 不是 <cite>list</cite> 或 <cite>tuple</cite> 或者其中的元素不是str类型。</p></li>
<li><p><strong>RuntimeError</strong> - 如果 <cite>names</cite> 的长度不等于 <cite>scopes</cite> 的长度，而作用域不是None。</p></li>
</ul>
</dd>
</dl>
<p><strong>样例：</strong></p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore.rewrite</span> <span class="kn">import</span> <span class="n">ScopedValue</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">variables</span> <span class="o">=</span> <span class="n">ScopedValue</span><span class="o">.</span><span class="n">create_name_values</span><span class="p">([</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="s2">&quot;z_1&quot;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;subnet&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mindspore.rewrite.ScopedValue.create_naming_value">
<span class="sig-name descname"><span class="pre">create_naming_value</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(在 Python v3.8)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">scope</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(在 Python v3.8)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/api/scoped_value.html#ScopedValue.create_naming_value"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.ScopedValue.create_naming_value" title="打开链接"></a></dt>
<dd><p>创建一个使用变量名称命名的ScopedValue。NamingValue表示对另一个变量的引用。</p>
<dl class="simple">
<dt>参数：</dt><dd><ul class="simple">
<li><p><strong>name</strong> (str) – 表示变量的字符串。</p></li>
<li><p><strong>scope</strong> (str) – 表示变量范围的字符串，默认值： <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> ，表示没有指定作用范围。</p></li>
</ul>
</dd>
<dt>返回：</dt><dd><p>ScopedValue的实例。</p>
</dd>
<dt>异常：</dt><dd><ul class="simple">
<li><p><strong>TypeError</strong> - 如果 <cite>name</cite> 不是str类型。</p></li>
<li><p><strong>TypeError</strong> - 如果 <cite>scope</cite> 不是str类型。</p></li>
</ul>
</dd>
</dl>
<p><strong>样例：</strong></p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore.rewrite</span> <span class="kn">import</span> <span class="n">ScopedValue</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">variable</span> <span class="o">=</span> <span class="n">ScopedValue</span><span class="o">.</span><span class="n">create_naming_value</span><span class="p">(</span><span class="s2">&quot;conv&quot;</span><span class="p">,</span> <span class="s2">&quot;self&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mindspore.rewrite.ScopedValue.create_variable_value">
<span class="sig-name descname"><span class="pre">create_variable_value</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/api/scoped_value.html#ScopedValue.create_variable_value"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.ScopedValue.create_variable_value" title="打开链接"></a></dt>
<dd><p>创建一个保存变量的ScopedValue。ScopedValue的类型由值的类型决定。ScopedValue的范围是空的。</p>
<dl class="simple">
<dt>参数：</dt><dd><ul class="simple">
<li><p><strong>value</strong> - 要转换为ScopedValue的值。</p></li>
</ul>
</dd>
<dt>返回：</dt><dd><p>ScopedValue的实例。</p>
</dd>
</dl>
<p><strong>样例：</strong></p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore.rewrite</span> <span class="kn">import</span> <span class="n">ScopedValue</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">variable</span> <span class="o">=</span> <span class="n">ScopedValue</span><span class="o">.</span><span class="n">create_variable_value</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mindspore.rewrite.ValueType">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mindspore.rewrite.</span></span><span class="sig-name descname"><span class="pre">ValueType</span></span><a class="reference internal" href="../_modules/mindspore/rewrite/api/scoped_value.html#ValueType"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.ValueType" title="打开链接"></a></dt>
<dd><p>ValueType表示ScopedValue的类型。</p>
<ul class="simple">
<li><p>NamingValue表示对另一个变量的引用。</p></li>
<li><p>CustomObjValue表示自定义类的实例，或类型超出ValueType的基本类型和容器类型范围的对象。</p></li>
</ul>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mindspore.rewrite.PatternEngine">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mindspore.rewrite.</span></span><span class="sig-name descname"><span class="pre">PatternEngine</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pattern</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#mindspore.rewrite.PatternNode" title="mindspore.rewrite.PatternNode"><span class="pre">PatternNode</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">replacement</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#mindspore.rewrite.Replacement" title="mindspore.rewrite.Replacement"><span class="pre">Replacement</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/api/pattern_engine.html#PatternEngine"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.PatternEngine" title="打开链接"></a></dt>
<dd><p>PatternEngine通过PattenNode修改SymbolTree。</p>
<dl class="simple">
<dt>参数：</dt><dd><ul class="simple">
<li><p><strong>pattern</strong> (Union[PatternNode, List]) - PatternNode的实例或用于构造 <cite>Pattent</cite> 的Cell类型列表。</p></li>
<li><p><strong>replacement</strong> (callable) - 生成新节点的接口实现。默认值： <code class="docutils literal notranslate"><span class="pre">None</span></code> 。</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mindspore.rewrite.PatternEngine.apply">
<span class="sig-name descname"><span class="pre">apply</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stree</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#mindspore.rewrite.SymbolTree" title="mindspore.rewrite.SymbolTree"><span class="pre">SymbolTree</span></a></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/api/pattern_engine.html#PatternEngine.apply"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.PatternEngine.apply" title="打开链接"></a></dt>
<dd><p>在 <cite>stree</cite> 上面执行当前的匹配模式。</p>
<div class="admonition note">
<p class="admonition-title">说明</p>
<p>当前还不支持子树节点。</p>
</div>
<dl class="simple">
<dt>参数：</dt><dd><ul class="simple">
<li><p><strong>stree</strong> (SymbolTree) - 要修改的SymbolTree。</p></li>
</ul>
</dd>
<dt>返回：</dt><dd><p>bool，表示是否对 <cite>stree</cite> 进行了修改。</p>
</dd>
<dt>异常：</dt><dd><ul class="simple">
<li><p><strong>TypeError</strong> - 如果参数 <cite>stree</cite> 不是SymbolTree类型。</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mindspore.rewrite.PatternEngine.pattern">
<span class="sig-name descname"><span class="pre">pattern</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/api/pattern_engine.html#PatternEngine.pattern"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.PatternEngine.pattern" title="打开链接"></a></dt>
<dd><p>获取当前的匹配模式。</p>
<dl class="simple">
<dt>返回：</dt><dd><p>PattenNode的实例，用来说明当前模式需要匹配的类型。</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mindspore.rewrite.PatternNode">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mindspore.rewrite.</span></span><span class="sig-name descname"><span class="pre">PatternNode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pattern_node_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(在 Python v3.8)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">match_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Type</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">Type[None]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inputs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'PatternNode'</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/api/pattern_engine.html#PatternNode"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.PatternNode" title="打开链接"></a></dt>
<dd><p>PatternNode在定义 <cite>pattern</cite> 时被定义为一个节点。</p>
<dl class="simple">
<dt>参数：</dt><dd><ul class="simple">
<li><p><strong>pattern_node_name</strong> (str) - 节点名称。</p></li>
<li><p><strong>match_type</strong> (Type) - 当前节点的匹配类型。默认值： <code class="docutils literal notranslate"><span class="pre">Type[None]</span></code> 。</p></li>
<li><p><strong>inputs</strong> (list[PatternNode]) - 当前节点的输入节点。默认值： <code class="docutils literal notranslate"><span class="pre">None</span></code> 。</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mindspore.rewrite.PatternNode.add_input">
<span class="sig-name descname"><span class="pre">add_input</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/api/pattern_engine.html#PatternNode.add_input"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.PatternNode.add_input" title="打开链接"></a></dt>
<dd><p>为当前节点添加输入。</p>
<dl class="simple">
<dt>参数：</dt><dd><ul class="simple">
<li><p><strong>node</strong> (PatternNode) - 新增的输入节点。</p></li>
</ul>
</dd>
<dt>异常：</dt><dd><ul class="simple">
<li><p><strong>TypeError</strong> - 如果参数 <cite>node</cite> 不是PattenNode类型。</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mindspore.rewrite.PatternNode.create_pattern_from_list">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">create_pattern_from_list</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">type_list</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/api/pattern_engine.html#PatternNode.create_pattern_from_list"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.PatternNode.create_pattern_from_list" title="打开链接"></a></dt>
<dd><p>使用类型的列表来创建Pattern。</p>
<dl class="simple">
<dt>参数：</dt><dd><ul class="simple">
<li><p><strong>type_list</strong> (list[type]) - 类型列表。</p></li>
</ul>
</dd>
<dt>返回：</dt><dd><p>根据列表生成的模式的根节点。</p>
</dd>
<dt>异常：</dt><dd><ul class="simple">
<li><p><strong>TypeError</strong> - 如果 <cite>type_list</cite> 不是list类型。</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mindspore.rewrite.PatternNode.create_pattern_from_node">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">create_pattern_from_node</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#mindspore.rewrite.Node" title="mindspore.rewrite.Node"><span class="pre">Node</span></a></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/api/pattern_engine.html#PatternNode.create_pattern_from_node"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.PatternNode.create_pattern_from_node" title="打开链接"></a></dt>
<dd><p>根据节点及其输入创建Pattern。</p>
<dl class="simple">
<dt>参数：</dt><dd><ul class="simple">
<li><p><strong>node</strong> (Node) - 要修改的节点。</p></li>
</ul>
</dd>
<dt>返回：</dt><dd><p>根据 <cite>node</cite> 创建的PattentNode。</p>
</dd>
<dt>异常：</dt><dd><ul class="simple">
<li><p><strong>TypeError</strong> - 如果 <cite>node</cite> 不是Node类型。</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mindspore.rewrite.PatternNode.from_node">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_node</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#mindspore.rewrite.Node" title="mindspore.rewrite.Node"><span class="pre">Node</span></a></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/api/pattern_engine.html#PatternNode.from_node"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.PatternNode.from_node" title="打开链接"></a></dt>
<dd><p>根据 <cite>node</cite> 创建PatternNode。</p>
<dl class="simple">
<dt>参数：</dt><dd><ul class="simple">
<li><p><strong>node</strong> (Node) - 要修改的节点。</p></li>
</ul>
</dd>
<dt>返回：</dt><dd><p>根据 <cite>node</cite> 创建的PattentNode。</p>
</dd>
<dt>异常：</dt><dd><ul class="simple">
<li><p><strong>TypeError</strong> - 如果 <cite>node</cite> 不是Node类型。</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mindspore.rewrite.PatternNode.get_inputs">
<span class="sig-name descname"><span class="pre">get_inputs</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/api/pattern_engine.html#PatternNode.get_inputs"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.PatternNode.get_inputs" title="打开链接"></a></dt>
<dd><p>获取当前节点的输入。</p>
<dl class="simple">
<dt>返回：</dt><dd><p>PattenNode的实例列表，当前节点的输入节点。</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mindspore.rewrite.PatternNode.match">
<span class="sig-name descname"><span class="pre">match</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#mindspore.rewrite.Node" title="mindspore.rewrite.Node"><span class="pre">Node</span></a></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/api/pattern_engine.html#PatternNode.match"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.PatternNode.match" title="打开链接"></a></dt>
<dd><p>检查当前PatternNode是否可以与node匹配。</p>
<dl class="simple">
<dt>参数：</dt><dd><ul class="simple">
<li><p><strong>node</strong> (Node) - 要匹配的节点。</p></li>
</ul>
</dd>
<dt>异常：</dt><dd><ul class="simple">
<li><p><strong>TypeError</strong> - 如果参数 <cite>node</cite> 不是PattenNode类型。</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mindspore.rewrite.PatternNode.name">
<span class="sig-name descname"><span class="pre">name</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/api/pattern_engine.html#PatternNode.name"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.PatternNode.name" title="打开链接"></a></dt>
<dd><p>获取PattenNode的名称。</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mindspore.rewrite.PatternNode.set_inputs">
<span class="sig-name descname"><span class="pre">set_inputs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">inputs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/api/pattern_engine.html#PatternNode.set_inputs"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.PatternNode.set_inputs" title="打开链接"></a></dt>
<dd><p>设置当前PatternNode的输入。</p>
<dl class="simple">
<dt>参数：</dt><dd><ul class="simple">
<li><p><strong>inputs</strong> (list[PatternNode]) - 设置为当前PatternNode的输入。</p></li>
</ul>
</dd>
<dt>异常：</dt><dd><ul class="simple">
<li><p><strong>TypeError</strong> - 如果参数 <cite>inputs</cite> 不是list或者 <cite>inputs</cite> 的成员不是PattenNode类型。</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mindspore.rewrite.PatternNode.type">
<span class="sig-name descname"><span class="pre">type</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/api/pattern_engine.html#PatternNode.type"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.PatternNode.type" title="打开链接"></a></dt>
<dd><p>获取PattenNode的类型。</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mindspore.rewrite.VarNode">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mindspore.rewrite.</span></span><span class="sig-name descname"><span class="pre">VarNode</span></span><a class="reference internal" href="../_modules/mindspore/rewrite/api/pattern_engine.html#VarNode"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.VarNode" title="打开链接"></a></dt>
<dd><p>VarNode是PatternNode的子类，其匹配方法始终返回True。</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mindspore.rewrite.Replacement">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mindspore.rewrite.</span></span><span class="sig-name descname"><span class="pre">Replacement</span></span><a class="reference internal" href="../_modules/mindspore/rewrite/api/pattern_engine.html#Replacement"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.Replacement" title="打开链接"></a></dt>
<dd><p>替换的接口定义。</p>
<p><strong>样例：</strong></p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore.rewrite</span> <span class="kn">import</span> <span class="n">Replacement</span><span class="p">,</span> <span class="n">Node</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore.nn</span> <span class="kn">import</span> <span class="n">nn</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">BnReplacement</span><span class="p">(</span><span class="n">Replacement</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">is_chain_pattern</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">matched</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">bn_node</span><span class="p">:</span> <span class="n">Node</span> <span class="o">=</span> <span class="n">matched</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pattern</span><span class="o">.</span><span class="n">name</span><span class="p">())</span>
<span class="gp">... </span>        <span class="n">conv</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="gp">... </span>        <span class="n">conv_node</span> <span class="o">=</span> <span class="n">Node</span><span class="o">.</span><span class="n">create_call_cell</span><span class="p">(</span><span class="n">conv</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;x1&#39;</span><span class="p">],</span> <span class="n">bn_node</span><span class="o">.</span><span class="n">get_args</span><span class="p">(),</span> <span class="n">bn_node</span><span class="o">.</span><span class="n">get_kwargs</span><span class="p">())</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="p">[</span><span class="n">conv_node</span><span class="p">]</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="mindspore.rewrite.Replacement.build">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">build</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pattern</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#mindspore.rewrite.PatternNode" title="mindspore.rewrite.PatternNode"><span class="pre">PatternNode</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">is_chain_pattern</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/library/functions.html#bool" title="(在 Python v3.8)"><span class="pre">bool</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">matched</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">OrderedDict</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/api/pattern_engine.html#Replacement.build"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.Replacement.build" title="打开链接"></a></dt>
<dd><p>用于从匹配结果创建替换节点的接口定义。</p>
<div class="admonition note">
<p class="admonition-title">说明</p>
<p>返回值将作为SymbolTree的替换函数的参数，返回值应遵循替换函数参数的 <cite>new_nodes</cite> 的约束。请参阅SymbolTree的 <cite>replace</cite> 的文档字符串中的详细信息。</p>
</div>
<dl class="simple">
<dt>参数：</dt><dd><ul class="simple">
<li><p><strong>pattern</strong> (PatternNode) - 当前模式的根节点。</p></li>
<li><p><strong>is_chain_pattern</strong> (bool) - 标记，标记模式是链模式或树模式。</p></li>
<li><p><strong>matched</strong> (OrderedDict) - 匹配结果，从名称映射到节点的字典。</p></li>
</ul>
</dd>
<dt>返回：</dt><dd><p>作为替换节点的节点实例列表。</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mindspore.rewrite.TreeNodeHelper">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mindspore.rewrite.</span></span><span class="sig-name descname"><span class="pre">TreeNodeHelper</span></span><a class="reference internal" href="../_modules/mindspore/rewrite/api/tree_node_helper.html#TreeNodeHelper"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.TreeNodeHelper" title="打开链接"></a></dt>
<dd><p>TreeNodeHelper用于在从Tree类型节点获取 <cite>symbol_tree</cite> 时打破循环引用。</p>
<p>TreeNodeHelper提供了静态方法 <cite>get_sub_tree</cite> 用于从Tree类型节点获取 <cite>symbol_tree</cite>。</p>
<dl class="py method">
<dt class="sig sig-object py" id="mindspore.rewrite.TreeNodeHelper.get_sub_tree">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">get_sub_tree</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#mindspore.rewrite.Node" title="mindspore.rewrite.Node"><span class="pre">Node</span></a></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/api/tree_node_helper.html#TreeNodeHelper.get_sub_tree"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.TreeNodeHelper.get_sub_tree" title="打开链接"></a></dt>
<dd><p>获取Tree类型节点的 <cite>symbol_tree</cite>。</p>
<dl class="simple">
<dt>参数：</dt><dd><ul class="simple">
<li><p><strong>node</strong> (Node) - 可以持有子符号树的节点。</p></li>
</ul>
</dd>
<dt>返回：</dt><dd><p>Tree节点中的SymbolTree对象。注意节点的 <cite>symbol_tree</cite> 可能是None，在这种情况下，方法将返回None。</p>
</dd>
<dt>异常：</dt><dd><ul class="simple">
<li><p><strong>RuntimeError</strong> - 如果参数 <cite>node</cite> 不是 NodeType.Tree类型。</p></li>
<li><p><strong>TypeError</strong> - 如果参数 <cite>node</cite> 不是Node类型实例。</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mindspore.rewrite.sparsify">
<span class="sig-prename descclassname"><span class="pre">mindspore.rewrite.</span></span><span class="sig-name descname"><span class="pre">sparsify</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">f</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">arg_types</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sparse_rules</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/sparsify/sparsify.html#sparsify"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.sparsify" title="打开链接"></a></dt>
<dd><p>模型自动稀疏化接口，将稠密模型转换为稀疏模型。通过 <cite>arg_types</cite> 指定的参数类型，将稀疏参数在模型中传导，并调用相应的稀疏函数。</p>
<dl class="simple">
<dt>参数：</dt><dd><ul class="simple">
<li><p><strong>f</strong> (Cell) - 被稀疏化的网络。</p></li>
<li><p><strong>arg_types</strong> (Tuple[ArgType] | Dict[int, ArgType]) - <cite>f</cite> 接受的参数类型（稀疏CSR/COO、非稀疏等）。如果是tuple，长度需要和 <cite>f</cite> 的参数数量相等；如果是dict，每个键值对应一个参数的索引，字典里没有表示的参数默认为非稀疏。</p></li>
<li><p><strong>sparse_rules</strong> (Dict[str, SparseFunc], 可选) - 自定义稀疏规则。默认值： <code class="docutils literal notranslate"><span class="pre">None</span></code> 。</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mindspore.rewrite.ArgType">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mindspore.rewrite.</span></span><span class="sig-name descname"><span class="pre">ArgType</span></span><a class="reference internal" href="../_modules/mindspore/rewrite/sparsify/utils.html#ArgType"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.ArgType" title="打开链接"></a></dt>
<dd><p>稀疏化的参数类型。</p>
<ul class="simple">
<li><p>CSR表示CSRTensor</p></li>
<li><p>COO表示COOTensor</p></li>
<li><p>NONSPARSE表示非稀疏</p></li>
</ul>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mindspore.rewrite.SparseFunc">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mindspore.rewrite.</span></span><span class="sig-name descname"><span class="pre">SparseFunc</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fn</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(在 Python v3.8)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Callable</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inputs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outputs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mindspore/rewrite/sparsify/utils.html#SparseFunc"><span class="viewcode-link"><span class="pre">[源代码]</span></span></a><a class="headerlink" href="#mindspore.rewrite.SparseFunc" title="打开链接"></a></dt>
<dd><p>在稀疏化中表示一个稀疏函数。</p>
<div class="admonition note">
<p class="admonition-title">说明</p>
<p>如果 <cite>fn</cite> 是一个包含类型注解的函数，且同时提供了 <cite>inputs</cite>，则类型注解中的输入类型将被忽略。<cite>outputs</cite> 同理。</p>
</div>
<dl class="simple">
<dt>参数：</dt><dd><ul class="simple">
<li><p><strong>fn</strong> (Union[str, Callable]) - 稀疏函数，如果是字符串，表示一个mindspore.ops.function接口；或者是任意函数对象。</p></li>
<li><p><strong>inputs</strong> (Any, 可选) - 函数的输入类型。如果是 <code class="docutils literal notranslate"><span class="pre">None</span></code> ，则使用函数本身的类型注解。默认值： <code class="docutils literal notranslate"><span class="pre">None</span></code> 。</p></li>
<li><p><strong>outputs</strong> (Any, 可选) - 函数的输出类型。如果是 <code class="docutils literal notranslate"><span class="pre">None</span></code> ，则使用函数本身的类型注解。默认值： <code class="docutils literal notranslate"><span class="pre">None</span></code> 。</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="nn_probability/mindspore.nn.probability.distribution.Uniform.html" class="btn btn-neutral float-left" title="mindspore.nn.probability.distribution.Uniform" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="mindspore.boost.html" class="btn btn-neutral float-right" title="mindspore.boost" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2022, MindSpore.</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用了 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a>开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 
</body>
</html>