<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Horizontal Federated Cloud-based Deployment &mdash; MindSpore master documentation</title><script>;(()=>{const e=localStorage.getItem("ms-theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;(e?"dark"===e:t)&&document.documentElement.setAttribute("data-o-theme","dark")})();</script><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Horizontal Federated Device-side Deployment" href="deploy_federated_client.html" />
    <link rel="prev" title="Obtaining MindSpore Federated" href="federated_install.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> MindSpore
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Deployment</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="federated_install.html">Obtaining MindSpore Federated</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Horizontal Federated Cloud-based Deployment</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#preparations">Preparations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installing-mindspore">Installing MindSpore</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installing-mindspore-federated">Installing MindSpore Federated</a></li>
<li class="toctree-l3"><a class="reference internal" href="#verifying-installation">Verifying Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installing-and-starting-redis-server">Installing and Starting Redis Server</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#starting-a-cluster">Starting a Cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="#auto-scaling">Auto Scaling</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#scale-out">Scale-out</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scale-in">Scale-in</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#security">Security</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="deploy_federated_client.html">Horizontal Federated Device-side Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploy_vfl.html">Vertical Federated Deployment</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Horizontal Application</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="image_classfication_dataset_process.html">Federated Learning Image Classification Dataset Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="image_classification_application.html">Implementing an Image Classification Application of Cross-device Federated Learning (x86)</a></li>
<li class="toctree-l1"><a class="reference internal" href="sentiment_classification_application.html">Implementing a Sentiment Classification Application (Android)</a></li>
<li class="toctree-l1"><a class="reference internal" href="image_classification_application_in_cross_silo.html">Implementing a Cloud-Slio Federated Image Classification Application (x86)</a></li>
<li class="toctree-l1"><a class="reference internal" href="object_detection_application_in_cross_silo.html">Implementing a Cross-Silo Federated Target Detection Application (x86)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Vertical Application</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="data_join.html">Vertical Federated Learning Data Access</a></li>
<li class="toctree-l1"><a class="reference internal" href="split_wnd_application.html">Vertical Federated Learning Model Training - Wide&amp;Deep Recommendation Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="split_pangu_alpha_application.html">Vertical Federated Learning Model Training - Pangu Alpha Large Model Cross-Domain Training</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Security and Privacy</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="local_differential_privacy_training_noise.html">Horizontal FL-Local Differential Privacy Perturbation Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="local_differential_privacy_training_signds.html">Horizontal FL-Local Differential Privacy SignDS training</a></li>
<li class="toctree-l1"><a class="reference internal" href="local_differential_privacy_eval_laplace.html">Horizontal Federated-Local Differential Privacy Inference Result Protection</a></li>
<li class="toctree-l1"><a class="reference internal" href="pairwise_encryption_training.html">Horizontal FL-Pairwise encryption training</a></li>
<li class="toctree-l1"><a class="reference internal" href="private_set_intersection.html">Vertical Federated-Privacy Set Intersection</a></li>
<li class="toctree-l1"><a class="reference internal" href="secure_vertical_federated_learning_with_EmbeddingDP.html">Vertical Federated-Feature Protection Based on Information Obfuscation</a></li>
<li class="toctree-l1"><a class="reference internal" href="secure_vertical_federated_learning_with_TEE.html">Vertical Federated - Feature Protection Based on Trusted Execution Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="secure_vertical_federated_learning_with_DP.html">Vertical Federated - Label Protection Based on Differential Privacy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Communication Compression</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="communication_compression.html">Device-Cloud Federated Learning Communication Compression</a></li>
<li class="toctree-l1"><a class="reference internal" href="vfl_communication_compress.html">Vertical Federated Learning Communication Compression</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Horizontal Federated API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="horizontal_server.html">Federated Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="cross_device.html">Device-side Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="horizontal/cross_silo.html">Cross-Silo</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Vertical Federated API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Data_Join.html">Data Join</a></li>
<li class="toctree-l1"><a class="reference internal" href="vertical/vertical_communicator.html">Vertical Federated Learning Communicator</a></li>
<li class="toctree-l1"><a class="reference internal" href="vertical_federated_trainer.html">Vertical Federated Trainer</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">RELEASE NOTES</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="RELEASE.html">Release Notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MindSpore</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Horizontal Federated Cloud-based Deployment</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/deploy_federated_server.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="horizontal-federated-cloud-based-deployment">
<h1>Horizontal Federated Cloud-based Deployment<a class="headerlink" href="#horizontal-federated-cloud-based-deployment" title="Permalink to this headline"></a></h1>
<p><a class="reference external" href="https://gitee.com/mindspore/docs/blob/master/docs/federated/docs/source_en/deploy_federated_server.md"><img alt="View Source On Gitee" src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/master/resource/_static/logo_source_en.png" /></a></p>
<p>The following uses LeNet as an example to describe how to use MindSpore Federated to deploy a horizontal federated learning cluster.</p>
<p>The following figure shows the physical architecture of the MindSpore Federated Learning (FL) Server cluster:</p>
<p><img alt="mindspore-federated-networking" src="_images/mindspore_federated_networking.png" /></p>
<p>As shown in the preceding figure, in the horizontal federated learning cloud cluster, there are three MindSpore process roles: <code class="docutils literal notranslate"><span class="pre">Federated</span> <span class="pre">Learning</span> <span class="pre">Scheduler</span></code>, <code class="docutils literal notranslate"><span class="pre">Federated</span> <span class="pre">Learning</span> <span class="pre">Server</span></code> and <code class="docutils literal notranslate"><span class="pre">Federated</span> <span class="pre">Learning</span> <span class="pre">Worker</span></code>:</p>
<ul>
<li><p>Federated Learning Scheduler</p>
<p><code class="docutils literal notranslate"><span class="pre">Scheduler</span></code> provides the following functions:</p>
<ol class="arabic simple">
<li><p>Cluster networking assistance: During cluster initialization, the <code class="docutils literal notranslate"><span class="pre">Scheduler</span></code> collects server information and ensures cluster consistency.</p></li>
<li><p>Open management plane: You can manage clusters through the <code class="docutils literal notranslate"><span class="pre">RESTful</span></code> APIs.</p></li>
</ol>
<p>In a federated learning task, there is only one <code class="docutils literal notranslate"><span class="pre">Scheduler</span></code>, which communicates with the <code class="docutils literal notranslate"><span class="pre">Server</span></code> using the TCP proprietary protocol.</p>
</li>
<li><p>Federated Learning Server</p>
<p><code class="docutils literal notranslate"><span class="pre">Server</span></code> executes federated learning tasks, receives and parses data from devices, and provides capabilities such as secure aggregation, time-limited communication, and model storage. In a federated learning task, users can configure multiple <code class="docutils literal notranslate"><span class="pre">Servers</span></code> which communicate with each other through the TCP proprietary protocol and open HTTP ports for device-side connection.</p>
<p>In the MindSpore federated learning framework, <code class="docutils literal notranslate"><span class="pre">Server</span></code> also supports auto scaling and disaster recovery, and can dynamically schedule hardware resources without interrupting training tasks.</p>
</li>
<li><p>Federated Learning Worker</p>
<p><code class="docutils literal notranslate"><span class="pre">Worker</span></code> is an accessory module for executing the federated learning task, which is used for supervised retraining of the model in the Server, and then the trained model is distributed to the Server. In a federated learning task, there can be more than one (user configurable) of <code class="docutils literal notranslate"><span class="pre">Worker</span></code>, and the communication between <code class="docutils literal notranslate"><span class="pre">Worker</span></code> and <code class="docutils literal notranslate"><span class="pre">Server</span></code> is performed via TCP protocol.</p>
</li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">Scheduler</span></code> and <code class="docutils literal notranslate"><span class="pre">Server</span></code> must be deployed on a server or container with a single NIC and in the same network segment. MindSpore automatically obtains the first available IP address as the <code class="docutils literal notranslate"><span class="pre">Server</span></code> IP address.</p>
<blockquote>
<div><p>The servers will verify the timestamp carried by the clients. It is necessary to eunsure the servers are periodically time synchronized to avoid a large time offset.</p>
</div></blockquote>
<section id="preparations">
<h2>Preparations<a class="headerlink" href="#preparations" title="Permalink to this headline"></a></h2>
<blockquote>
<div><p>Recommend to create a virtual environment for the following operations with <a class="reference external" href="https://www.anaconda.com/">Anaconda</a>.</p>
</div></blockquote>
<section id="installing-mindspore">
<h3>Installing MindSpore<a class="headerlink" href="#installing-mindspore" title="Permalink to this headline"></a></h3>
<p>The MindSpore horizontal federated learning cloud cluster supports deployment on x86 CPU and GPU CUDA hardware platforms. Run commands provided by the <a class="reference external" href="https://www.mindspore.cn/install">MindSpore Installation Guide</a> to install the latest MindSpore.</p>
</section>
<section id="installing-mindspore-federated">
<h3>Installing MindSpore Federated<a class="headerlink" href="#installing-mindspore-federated" title="Permalink to this headline"></a></h3>
<p>Compile and install with <a class="reference external" href="https://gitee.com/mindspore/federated">source code</a>.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://gitee.com/mindspore/federated.git<span class="w"> </span>-b<span class="w"> </span>master
<span class="nb">cd</span><span class="w"> </span>federated
bash<span class="w"> </span>build.sh
</pre></div>
</div>
<p>For <code class="docutils literal notranslate"><span class="pre">bash</span> <span class="pre">build.sh</span></code>, compilation can be accelerated by the <code class="docutils literal notranslate"><span class="pre">-jn</span></code> option, e.g. <code class="docutils literal notranslate"><span class="pre">-j16</span></code>. The third-party dependencies can be downloaded from gitee instead of github by the <code class="docutils literal notranslate"><span class="pre">-S</span> <span class="pre">on</span></code> option.</p>
<p>After compilation, find the whl installation package of Federated in the <code class="docutils literal notranslate"><span class="pre">build/package/</span></code> directory to install:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>mindspore_federated-<span class="o">{</span>version<span class="o">}</span>-<span class="o">{</span>python_version<span class="o">}</span>-linux_<span class="o">{</span>arch<span class="o">}</span>.whl
</pre></div>
</div>
</section>
<section id="verifying-installation">
<h3>Verifying Installation<a class="headerlink" href="#verifying-installation" title="Permalink to this headline"></a></h3>
<p>Execute the following command to verify the installation result. The installation is successful if no error is reported when importing Python modules.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindspore_federated</span> <span class="kn">import</span> <span class="n">FLServerJob</span>
</pre></div>
</div>
</section>
<section id="installing-and-starting-redis-server">
<h3>Installing and Starting Redis Server<a class="headerlink" href="#installing-and-starting-redis-server" title="Permalink to this headline"></a></h3>
<p>Federated Learning relies on <a class="reference external" href="https://gitee.com/link?target=https%3A%2F%2Fredis.io%2F">Redis Server</a> as the cached data middleware by default. To run the Federated Learning service, a Redis server needs to be installed and run.</p>
<blockquote>
<div><p>User must check the security of the Redis to be used. Some versions may have security vulnerabilities.</p>
</div></blockquote>
<p>Install Redis server:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>redis
</pre></div>
</div>
<p>Run the Redis server and the number of configuration side is 23456:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>redis-server<span class="w"> </span>--port<span class="w"> </span><span class="m">23456</span><span class="w"> </span>--save<span class="w"> </span><span class="s2">&quot;&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="starting-a-cluster">
<h2>Starting a Cluster<a class="headerlink" href="#starting-a-cluster" title="Permalink to this headline"></a></h2>
<ol class="arabic">
<li><p><a class="reference external" href="https://gitee.com/mindspore/federated/tree/master/example/cross_device_lenet_femnist/">examples</a>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>example/cross_device_lenet_femnist
</pre></div>
</div>
</li>
<li><p>Modify the yaml configuration file according to the actual running: <code class="docutils literal notranslate"><span class="pre">default_yaml_config.yaml</span></code>. <a class="reference external" href="https://gitee.com/mindspore/federated/blob/master/example/cross_device_lenet_femnist/yamls/lenet/default_yaml_config.yaml">sample configuration of Lenet</a> is as follows:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">fl_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Lenet</span>
<span class="nt">fl_iteration_num</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">25</span>
<span class="nt">server_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FEDERATED_LEARNING</span>
<span class="nt">enable_ssl</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>

<span class="nt">distributed_cache</span><span class="p">:</span>
<span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis</span>
<span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">127.0.0.1:23456</span><span class="w"> </span><span class="c1"># ip:port of redis actual machine</span>
<span class="nt">plugin_lib_path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>

<span class="nt">round</span><span class="p">:</span>
<span class="nt">start_fl_job_threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="nt">start_fl_job_time_window</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30000</span>
<span class="nt">update_model_ratio</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>
<span class="nt">update_model_time_window</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30000</span>
<span class="nt">global_iteration_time_window</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">60000</span>

<span class="nt">summary</span><span class="p">:</span>
<span class="nt">metrics_file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;metrics.json&quot;</span>
<span class="nt">failure_event_file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;event.txt&quot;</span>
<span class="nt">continuous_failure_times</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="nt">data_rate_dir</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;..&quot;</span>
<span class="nt">participation_time_level</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;5,15&quot;</span>

<span class="nt">unsupervised</span><span class="p">:</span>
<span class="w">  </span><span class="nt">cluster_client_num</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
<span class="w">  </span><span class="nt">eval_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SILHOUETTE_SCORE</span>

<span class="nt">encrypt</span><span class="p">:</span>
<span class="nt">encrypt_train_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NOT_ENCRYPT</span>
<span class="nt">pw_encrypt</span><span class="p">:</span>
<span class="w">    </span><span class="nt">share_secrets_ratio</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>
<span class="w">    </span><span class="nt">cipher_time_window</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3000</span>
<span class="w">    </span><span class="nt">reconstruct_secrets_threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="nt">dp_encrypt</span><span class="p">:</span>
<span class="w">    </span><span class="nt">dp_eps</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50.0</span>
<span class="w">    </span><span class="nt">dp_delta</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.01</span>
<span class="w">    </span><span class="nt">dp_norm_clip</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>
<span class="nt">signds</span><span class="p">:</span>
<span class="w">    </span><span class="nt">sign_k</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.01</span>
<span class="w">    </span><span class="nt">sign_eps</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
<span class="w">    </span><span class="nt">sign_thr_ratio</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.6</span>
<span class="w">    </span><span class="nt">sign_global_lr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.1</span>
<span class="w">    </span><span class="nt">sign_dim_out</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>

<span class="nt">compression</span><span class="p">:</span>
<span class="nt">upload_compress_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NO_COMPRESS</span>
<span class="nt">upload_sparse_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.4</span>
<span class="nt">download_compress_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NO_COMPRESS</span>

<span class="nt">ssl</span><span class="p">:</span>
<span class="c1"># when ssl_config is set</span>
<span class="c1"># for tcp/http server</span>
<span class="nt">server_cert_path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;server.p12&quot;</span>
<span class="c1"># for tcp client</span>
<span class="nt">client_cert_path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;client.p12&quot;</span>
<span class="c1"># common</span>
<span class="nt">ca_cert_path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ca.crt&quot;</span>
<span class="nt">crl_path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="nt">cipher_list</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-PSK-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-CCM:ECDHE-ECDSA-AES256-CCM:ECDHE-ECDSA-CHACHA20-POLY1305&quot;</span>
<span class="nt">cert_expire_warning_time_in_day</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">90</span>

<span class="nt">client_verify</span><span class="p">:</span>
<span class="nt">pki_verify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="nt">root_first_ca_path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="nt">root_second_ca_path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="nt">equip_crl_path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="nt">replay_attack_time_diff</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">600000</span>

<span class="nt">client</span><span class="p">:</span>
<span class="nt">http_url_prefix</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="nt">client_epoch_num</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span>
<span class="nt">client_batch_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32</span>
<span class="nt">client_learning_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.01</span>
<span class="nt">connection_num</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10000</span>
</pre></div>
</div>
</li>
<li><p>Prepare the model file and start it in the following way: weight-based start. You need to provide the corresponding model weights.</p>
<p>Obtain lenet model weight:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>wget<span class="w"> </span>https://ms-release.obs.cn-north-4.myhuaweicloud.com/ms-dependencies/Lenet.ckpt
</pre></div>
</div>
</li>
<li><p>Run Scheduler, and the management side address is <code class="docutils literal notranslate"><span class="pre">127.0.0.1:11202</span></code> by default.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">run_sched</span><span class="o">.</span><span class="n">py</span> \
<span class="o">--</span><span class="n">yaml_config</span><span class="o">=</span><span class="s2">&quot;yamls/lenet.yaml&quot;</span> \
<span class="o">--</span><span class="n">scheduler_manage_address</span><span class="o">=</span><span class="s2">&quot;10.*.*.*:18019&quot;</span>
</pre></div>
</div>
</li>
<li><p>Run Server, and start one Server and the HTTP server address is <code class="docutils literal notranslate"><span class="pre">127.0.0.1:6666</span></code> by default.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">run_server</span><span class="o">.</span><span class="n">py</span> \
<span class="o">--</span><span class="n">yaml_config</span><span class="o">=</span><span class="s2">&quot;yamls/lenet.yaml&quot;</span> \
<span class="o">--</span><span class="n">tcp_server_ip</span><span class="o">=</span><span class="s2">&quot;10.*.*.*&quot;</span> \
<span class="o">--</span><span class="n">checkpoint_dir</span><span class="o">=</span><span class="s2">&quot;fl_ckpt&quot;</span> \
<span class="o">--</span><span class="n">local_server_num</span><span class="o">=</span><span class="mi">1</span> \
<span class="o">--</span><span class="n">http_server_address</span><span class="o">=</span><span class="s2">&quot;10.*.*.*:8019&quot;</span>
</pre></div>
</div>
</li>
<li><p>Stop federated learning. The current version of the federated learning cluster is a resident process, and the <code class="docutils literal notranslate"><span class="pre">finish_cloud.py</span></code> script can be executed to terminate the federated learning service. The example of executing the command is as follows, where <code class="docutils literal notranslate"><span class="pre">redis_port</span></code> is passed with the same parameters as when starting redis, representing stopping the cluster corresponding to this <code class="docutils literal notranslate"><span class="pre">Scheduler</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">finish_cloud</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">redis_port</span><span class="o">=</span><span class="mi">23456</span>
</pre></div>
</div>
<p>If console prints the following contents:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>killed $PID1
killed $PID2
killed $PID3
killed $PID4
killed $PID5
killed $PID6
killed $PID7
killed $PID8
</pre></div>
</div>
<p>it indicates the termination service is successful.</p>
</li>
</ol>
</section>
<section id="auto-scaling">
<h2>Auto Scaling<a class="headerlink" href="#auto-scaling" title="Permalink to this headline"></a></h2>
<p>MindSpore federal learning framework supports <code class="docutils literal notranslate"><span class="pre">Server</span></code> auto scaling and provides <code class="docutils literal notranslate"><span class="pre">RESTful</span></code> services externally through the <code class="docutils literal notranslate"><span class="pre">Scheduler</span></code> management port, enabling users to dynamically schedule hardware resources without interrupting training tasks.</p>
<p>The following example describes how to control scale-out and scale-in of cluster through APIs.</p>
<section id="scale-out">
<h3>Scale-out<a class="headerlink" href="#scale-out" title="Permalink to this headline"></a></h3>
<p>After the cluster starts, enter the machine where the scheduler node is deployed and make a request to the <code class="docutils literal notranslate"><span class="pre">Scheduler</span></code> to query the status and node information. A <code class="docutils literal notranslate"><span class="pre">RESTful</span></code> request can be constructed with the <code class="docutils literal notranslate"><span class="pre">curl</span></code> command.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-k<span class="w"> </span><span class="s1">&#39;http://10.*.*.*:18015/state&#39;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Scheduler</span></code> will return query results in <code class="docutils literal notranslate"><span class="pre">json</span></code> format.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="s2">&quot;Get cluster state successful.&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;cluster_state&quot;</span><span class="p">:</span><span class="s2">&quot;CLUSTER_READY&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;code&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;nodes&quot;</span><span class="p">:[</span>
<span class="w">    </span><span class="p">{</span><span class="s2">&quot;node_id&quot;</span><span class="p">,</span><span class="s2">&quot;{ip}:{port}::{timestamp}::{random}&quot;</span><span class="p">,</span>
<span class="w">     </span><span class="nt">&quot;tcp_address&quot;</span><span class="p">:</span><span class="s2">&quot;{ip}:{port}&quot;</span><span class="p">,</span>
<span class="w">     </span><span class="nt">&quot;role&quot;</span><span class="p">:</span><span class="s2">&quot;SERVER&quot;</span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You need to pull up 3 new <code class="docutils literal notranslate"><span class="pre">Server</span></code> processes and accumulate the <code class="docutils literal notranslate"><span class="pre">local_server_num</span></code> parameter to the number of scale-out, so as to ensure the correctness of the global networking information, i.e. after scale-out, the number of <code class="docutils literal notranslate"><span class="pre">local_server_num</span></code> should be 4. An example of executing the command is as follows:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>run_server.py<span class="w"> </span>--yaml_config<span class="o">=</span><span class="s2">&quot;yamls/lenet.yaml&quot;</span><span class="w"> </span>--tcp_server_ip<span class="o">=</span><span class="s2">&quot;10.*.*.*&quot;</span><span class="w"> </span>--checkpoint_dir<span class="o">=</span><span class="s2">&quot;fl_ckpt&quot;</span><span class="w"> </span>--local_server_num<span class="o">=</span><span class="m">4</span><span class="w"> </span>--http_server_address<span class="o">=</span><span class="s2">&quot;10.*.*.*:18015&quot;</span>
</pre></div>
</div>
<p>This command indicates starting four <code class="docutils literal notranslate"><span class="pre">Server</span></code> nodes and the total number of <code class="docutils literal notranslate"><span class="pre">Server</span></code> is 4.</p>
</section>
<section id="scale-in">
<h3>Scale-in<a class="headerlink" href="#scale-in" title="Permalink to this headline"></a></h3>
<p>Simulate the scale-in directly via kill -9 pid, construct a <code class="docutils literal notranslate"><span class="pre">RESTful</span></code> request with the <code class="docutils literal notranslate"><span class="pre">curl</span></code> command, and query the status, which finds that there is one node_id missing from the cluster to achieve the purpose of scale-in.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-k<span class="w"> </span><span class="se">\</span>
<span class="s1">&#39;http://10.*.*.*:18015/state&#39;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Scheduler</span></code> returns the query results in <code class="docutils literal notranslate"><span class="pre">json</span></code> format.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>{
  &quot;message&quot;:&quot;Get cluster state successful.&quot;,
  &quot;cluster_state&quot;:&quot;CLUSTER_READY&quot;,
  &quot;code&quot;:0,
  &quot;nodes&quot;:[
    {&quot;node_id&quot;,&quot;{ip}:{port}::{timestamp}::{random}&quot;,
     &quot;tcp_address&quot;:&quot;{ip}:{port}&quot;,
     &quot;role&quot;:&quot;SERVER&quot;},
    {&quot;node_id&quot;,&quot;worker_fl_{timestamp}::{random}&quot;,
     &quot;tcp_address&quot;:&quot;&quot;,
     &quot;role&quot;:&quot;WORKER&quot;}，
    {&quot;node_id&quot;,&quot;worker_fl_{timestamp}::{random}&quot;,
     &quot;tcp_address&quot;:&quot;&quot;,
     &quot;role&quot;:&quot;WORKER&quot;}
  ]
}
</pre></div>
</div>
<blockquote>
<div><ul class="simple">
<li><p>After scale-out/scale-in of the cluster is successful, the training tasks are automatically resumed without additional intervention.</p></li>
</ul>
</div></blockquote>
</section>
</section>
<section id="security">
<h2>Security<a class="headerlink" href="#security" title="Permalink to this headline"></a></h2>
<p>MindSpore Federal Learning Framework supports SSL security authentication of <code class="docutils literal notranslate"><span class="pre">Server</span></code>. To enable security authentication, you need to add <code class="docutils literal notranslate"><span class="pre">enable_ssl=True</span></code> to the startup command, and the config.json configuration file specified by config_file_path needs to add the following fields:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;server_cert_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;server.p12&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;crl_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;client_cert_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;client.p12&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;ca_cert_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ca.crt&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;cert_expire_warning_time_in_day&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">90</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;cipher_list&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!3DES:!MD5:!PSK&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;connection_num&quot;</span><span class="p">:</span><span class="mi">10000</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>server_cert_path: The path to the p12 file containing the ciphertext of the certificate and key on the server-side.</p></li>
<li><p>crl_path: Files of revocation list.</p></li>
<li><p>client_cert_path: The path to the p12 file containing the ciphertext of the certificate and key on the client-side.</p></li>
<li><p>ca_cert_path: Root certificate.</p></li>
<li><p>cipher_list: Cipher suite.</p></li>
<li><p>cert_expire_warning_time_in_day: Alarm time of certificate expiration.</p></li>
</ul>
<p>The key in the p12 file is stored in cipher text. You need to pass in the password when starting. Please refer to the <code class="docutils literal notranslate"><span class="pre">client_password</span></code> and <code class="docutils literal notranslate"><span class="pre">server_password</span></code> fields in the Python API <code class="docutils literal notranslate"><span class="pre">mindspore.set_fl_context</span></code> for the specific parameters.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="federated_install.html" class="btn btn-neutral float-left" title="Obtaining MindSpore Federated" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="deploy_federated_client.html" class="btn btn-neutral float-right" title="Horizontal Federated Device-side Deployment" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, MindSpore.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 
</body>
</html>