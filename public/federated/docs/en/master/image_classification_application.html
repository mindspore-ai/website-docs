

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Implementing an Image Classification Application of Cross-device Federated Learning (x86) &mdash; MindSpore master documentation</title>
  

  
   
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  
  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        
        
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Implementing a Sentiment Classification Application (Android)" href="sentiment_classification_application.html" />
    <link rel="prev" title="Federated Learning Image Classification Dataset Process" href="image_classfication_dataset_process.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> MindSpore
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Deployment</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="federated_install.html">Obtaining MindSpore Federated</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploy_federated_server.html">Horizontal Federated Cloud-based Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploy_federated_client.html">Horizontal Federated Device-side Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploy_vfl.html">Vertical Federated Deployment</a></li>
</ul>
<p class="caption"><span class="caption-text">Horizontal Application</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="image_classfication_dataset_process.html">Federated Learning Image Classification Dataset Process</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Implementing an Image Classification Application of Cross-device Federated Learning (x86)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#preparation">Preparation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#generating-a-device-side-model-file">Generating a Device-side Model File</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#simulating-multi-client-participation-in-federated-learning">Simulating Multi-client Participation in Federated Learning</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#preparing-a-model-file-for-the-client">Preparing a Model File for the Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="#starting-the-cloud-side-service">Starting the Cloud Side Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="#starting-the-client">Starting the Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="#stop-the-client-process">Stop the client process</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="sentiment_classification_application.html">Implementing a Sentiment Classification Application (Android)</a></li>
<li class="toctree-l1"><a class="reference internal" href="image_classification_application_in_cross_silo.html">Implementing a Cloud-Slio Federated Image Classification Application (x86)</a></li>
<li class="toctree-l1"><a class="reference internal" href="object_detection_application_in_cross_silo.html">Implementing a Cross-Silo Federated Target Detection Application (x86)</a></li>
</ul>
<p class="caption"><span class="caption-text">Vertical Application</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="data_join.html">Vertical Federated Learning Data Access</a></li>
<li class="toctree-l1"><a class="reference internal" href="split_wnd_application.html">Vertical Federated Learning Model Training - Wide&amp;Deep Recommendation Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="split_pangu_alpha_application.html">Vertical Federated Learning Model Training - Pangu Alpha Large Model Cross-Domain Training</a></li>
</ul>
<p class="caption"><span class="caption-text">Security and Privacy</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="local_differential_privacy_training_noise.html">Horizontal FL-Local Differential Privacy Perturbation Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="local_differential_privacy_training_signds.html">Horizontal FL-Local Differential Privacy SignDS training</a></li>
<li class="toctree-l1"><a class="reference internal" href="pairwise_encryption_training.html">Horizontal FL-Pairwise encryption training</a></li>
<li class="toctree-l1"><a class="reference internal" href="private_set_intersection.html">Vertical Federated-Privacy Set Intersection</a></li>
<li class="toctree-l1"><a class="reference internal" href="secure_vertical_federated_learning_with_EmbeddingDP.html">Vertical Federated-Feature Protection Based on Information Obfuscation</a></li>
<li class="toctree-l1"><a class="reference internal" href="secure_vertical_federated_learning_with_TEE.html">Vertical Federated - Feature Protection Based on Trusted Execution Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="secure_vertical_federated_learning_with_DP.html">Vertical Federated - Label Protection Based on Differential Privacy</a></li>
</ul>
<p class="caption"><span class="caption-text">Communication Compression</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="communication_compression.html">Device-Cloud Federated Learning Communication Compression</a></li>
<li class="toctree-l1"><a class="reference internal" href="vfl_communication_compress.html">Vertical Federated Learning Communication Compression</a></li>
</ul>
<p class="caption"><span class="caption-text">Horizontal Federated API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="horizontal_server.html">Federated Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="cross_device.html">Device-side Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="horizontal/cross_silo.html">Cross-Silo</a></li>
</ul>
<p class="caption"><span class="caption-text">Vertical Federated API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Data_Join.html">Data Join</a></li>
<li class="toctree-l1"><a class="reference internal" href="vertical/vertical_communicator.html">Vertical Federated Learning Communicator</a></li>
<li class="toctree-l1"><a class="reference internal" href="vertical_federated_trainer.html">Vertical Federated Trainer</a></li>
</ul>
<p class="caption"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
</ul>
<p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="RELEASE.html">Release Notes</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MindSpore</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Implementing an Image Classification Application of Cross-device Federated Learning (x86)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/image_classification_application.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="implementing-an-image-classification-application-of-cross-device-federated-learning-x86">
<h1>Implementing an Image Classification Application of Cross-device Federated Learning (x86)<a class="headerlink" href="#implementing-an-image-classification-application-of-cross-device-federated-learning-x86" title="Permalink to this headline">¶</a></h1>
<p><a href="https://gitee.com/mindspore/docs/blob/master/docs/federated/docs/source_en/image_classification_application.md" target="_blank"><img src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/master/resource/_static/logo_source_en.png"></a></p>
<p>Federated learning can be divided into cross-silo federated learning and cross-device federated learning according to different participating clients. In the cross-silo federated learning scenario, the clients participating in federated learning are different organizations (for example, medical or financial) or data centers geographically distributed, that is, training models on multiple data islands. The clients participating in the cross-device federated learning scenario are a large number of mobiles or IoT devices. This framework will introduce how to use the network LeNet to implement an image classification application on the MindSpore cross-silo federated framework, and provides related tutorials for simulating to start multi-client participation in federated learning in the x86 environment.</p>
<p>Before you start, check whether MindSpore has been correctly installed. If not, install MindSpore on your computer by referring to <a class="reference external" href="https://www.mindspore.cn/install/en">Install</a> on the MindSpore website.</p>
<div class="section" id="preparation">
<h2>Preparation<a class="headerlink" href="#preparation" title="Permalink to this headline">¶</a></h2>
<p>We provide <a class="reference external" href="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/notebook/datasets/federated/3500_clients_bin.zip">Federated Learning Image Classification Dataset FEMNIST</a> and the <a class="reference external" href="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/notebook/models/lenet_train.ms">device-side model file</a> of the <code class="docutils literal notranslate"><span class="pre">.ms</span></code> format for users to use directly. Users can also refer to the following tutorials to generate the datasets and models based on actual needs.</p>
<div class="section" id="generating-a-device-side-model-file">
<h3>Generating a Device-side Model File<a class="headerlink" href="#generating-a-device-side-model-file" title="Permalink to this headline">¶</a></h3>
<ol>
<li><p>Define the network and training process.</p>
<p>For the definition of the specific network and training process, please refer to <a class="reference external" href="https://www.mindspore.cn/tutorials/en/master/beginner/quick_start.html">Beginners Getting Started</a>.</p>
</li>
<li><p>Export a model as a MindIR file.</p>
<p>The code snippet is as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">import</span> <span class="nn">mindspore.nn</span> <span class="k">as</span> <span class="nn">nn</span>

<span class="k">def</span> <span class="nf">conv</span><span class="p">(</span><span class="n">in_channels</span><span class="p">,</span> <span class="n">out_channels</span><span class="p">,</span> <span class="n">kernel_size</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;weight initial for conv layer&quot;&quot;&quot;</span>
    <span class="n">weight</span> <span class="o">=</span> <span class="n">weight_variable</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span>
        <span class="n">in_channels</span><span class="p">,</span>
        <span class="n">out_channels</span><span class="p">,</span>
        <span class="n">kernel_size</span><span class="o">=</span><span class="n">kernel_size</span><span class="p">,</span>
        <span class="n">stride</span><span class="o">=</span><span class="n">stride</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">,</span>
        <span class="n">weight_init</span><span class="o">=</span><span class="n">weight</span><span class="p">,</span>
        <span class="n">has_bias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">pad_mode</span><span class="o">=</span><span class="s2">&quot;valid&quot;</span><span class="p">,</span>
    <span class="p">)</span>

<span class="k">def</span> <span class="nf">fc_with_initialize</span><span class="p">(</span><span class="n">input_channels</span><span class="p">,</span> <span class="n">out_channels</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;weight initial for fc layer&quot;&quot;&quot;</span>
    <span class="n">weight</span> <span class="o">=</span> <span class="n">weight_variable</span><span class="p">()</span>
    <span class="n">bias</span> <span class="o">=</span> <span class="n">weight_variable</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">input_channels</span><span class="p">,</span> <span class="n">out_channels</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">bias</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">weight_variable</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;weight initial&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">ms</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">initializer</span><span class="o">.</span><span class="n">TruncatedNormal</span><span class="p">(</span><span class="mf">0.02</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">LeNet5</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_class</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LeNet5</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_class</span> <span class="o">=</span> <span class="n">num_class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conv1</span> <span class="o">=</span> <span class="n">conv</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conv2</span> <span class="o">=</span> <span class="n">conv</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc1</span> <span class="o">=</span> <span class="n">fc_with_initialize</span><span class="p">(</span><span class="mi">16</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">120</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc2</span> <span class="o">=</span> <span class="n">fc_with_initialize</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="mi">84</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc3</span> <span class="o">=</span> <span class="n">fc_with_initialize</span><span class="p">(</span><span class="mi">84</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_class</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relu</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_pool2d</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">MaxPool2d</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flatten</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Flatten</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_pool2d</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_pool2d</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc3</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;export mindir for lenet&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--device_target&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;CPU&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--mindir_path&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
                    <span class="n">default</span><span class="o">=</span><span class="s2">&quot;lenet_train.mindir&quot;</span><span class="p">)</span>  <span class="c1"># the mindir file path of the model to be export</span>

<span class="n">args</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_known_args</span><span class="p">()</span>
<span class="n">device_target</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">device_target</span>
<span class="n">mindir_path</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">mindir_path</span>

<span class="n">ms</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">GRAPH_MODE</span><span class="p">,</span> <span class="n">device_target</span><span class="o">=</span><span class="n">device_target</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">network</span> <span class="o">=</span> <span class="n">LeNet5</span><span class="p">(</span><span class="mi">62</span><span class="p">)</span>
    <span class="n">criterion</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">SoftmaxCrossEntropyWithLogits</span><span class="p">(</span><span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">reduction</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">)</span>
    <span class="n">net_opt</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Momentum</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">trainable_params</span><span class="p">(),</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">)</span>
    <span class="n">net_with_criterion</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">WithLossCell</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">criterion</span><span class="p">)</span>
    <span class="n">train_network</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">TrainOneStepCell</span><span class="p">(</span><span class="n">net_with_criterion</span><span class="p">,</span> <span class="n">net_opt</span><span class="p">)</span>
    <span class="n">train_network</span><span class="o">.</span><span class="n">set_train</span><span class="p">()</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">62</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
    <span class="n">ms</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">train_network</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="n">mindir_path</span><span class="p">,</span>
                <span class="n">file_format</span><span class="o">=</span><span class="s1">&#39;MINDIR&#39;</span><span class="p">)</span>  <span class="c1"># Add the export statement to obtain the model file in MindIR format.</span>
</pre></div>
</div>
<p>The parameter <code class="docutils literal notranslate"><span class="pre">--mindir_path</span></code> is used to set the path of the generated file in MindIR format.</p>
</li>
<li><p>Convert the MindIR file into an .ms file that can be used by the federated learning device-side framework.</p>
<p>For details about model conversion, see <a class="reference external" href="https://www.mindspore.cn/lite/docs/en/master/use/converter_train.html">Training Model Conversion Tutorial</a>.</p>
<p>The following is an example of model conversion:</p>
<p>Assume that the model file to be converted is <code class="docutils literal notranslate"><span class="pre">lenet_train.mindir</span></code>. Run the following command:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>./converter_lite<span class="w"> </span>--fmk<span class="o">=</span>MINDIR<span class="w"> </span>--trainModel<span class="o">=</span><span class="nb">true</span><span class="w"> </span>--modelFile<span class="o">=</span>lenet_train.mindir<span class="w"> </span>--outputFile<span class="o">=</span>lenet_train
</pre></div>
</div>
<p>If the conversion is successful, the following information is displayed:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>CONVERTER<span class="w"> </span>RESULT<span class="w"> </span>SUCCESS:0
</pre></div>
</div>
<p>This indicates that the MindSpore model is successfully converted to the MindSpore device-side model and the new file <code class="docutils literal notranslate"><span class="pre">lenet_train.ms</span></code> is generated. If the conversion fails, the following information is displayed:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>CONVERT<span class="w"> </span>RESULT<span class="w"> </span>FAILED:
</pre></div>
</div>
<p>The generated model file in <code class="docutils literal notranslate"><span class="pre">.ms</span></code> format is the model file required by subsequent clients.</p>
</li>
</ol>
</div>
</div>
<div class="section" id="simulating-multi-client-participation-in-federated-learning">
<h2>Simulating Multi-client Participation in Federated Learning<a class="headerlink" href="#simulating-multi-client-participation-in-federated-learning" title="Permalink to this headline">¶</a></h2>
<div class="section" id="preparing-a-model-file-for-the-client">
<h3>Preparing a Model File for the Client<a class="headerlink" href="#preparing-a-model-file-for-the-client" title="Permalink to this headline">¶</a></h3>
<p>This example uses lenet on the device-side to simulate the actual network used, where<a class="reference external" href="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/notebook/models/lenet_train.ms">device-side model file</a> in <code class="docutils literal notranslate"><span class="pre">.ms</span></code> format of lenet. As the real scenario where a client contains only one model file in .ms format, in the simulation scenario, multiple copies of the .ms file need to be copied and named according to the <code class="docutils literal notranslate"><span class="pre">lenet_train{i}.ms</span></code> format, where i represents the client number, since the .ms file has been automatically copied for each client in <code class="docutils literal notranslate"><span class="pre">run_client_x86.py</span></code>.</p>
<p>See the copy_ms function in <a class="reference external" href="https://gitee.com/mindspore/federated/blob/master/example/cross_device_lenet_femnist/simulate_x86/run_client_x86.py">startup script</a> for details.</p>
</div>
<div class="section" id="starting-the-cloud-side-service">
<h3>Starting the Cloud Side Service<a class="headerlink" href="#starting-the-cloud-side-service" title="Permalink to this headline">¶</a></h3>
<p>Users can first refer to <a class="reference external" href="https://www.mindspore.cn/federated/docs/en/master/deploy_federated_server.html">cloud-side deployment tutorial</a> to deploy the cloud-side environment and start the cloud-side service.</p>
</div>
<div class="section" id="starting-the-client">
<h3>Starting the Client<a class="headerlink" href="#starting-the-client" title="Permalink to this headline">¶</a></h3>
<p>Before starting the client, please refer to the section <a class="reference external" href="https://www.mindspore.cn/federated/docs/en/master/deploy_federated_client.html">Device-side deployment tutotial</a> for deployment of device environment.</p>
<p>We provide a reference script <a class="reference external" href="https://gitee.com/mindspore/federated/blob/master/example/cross_device_lenet_femnist/simulate_x86/run_client_x86.py">run_client_x86.py</a>, users can set relevant parameters to start different federated learning interfaces.
After the cloud-side service is successfully started, the script providing run_client_x86.py is used to call the federated learning framework jar package <code class="docutils literal notranslate"><span class="pre">mindspore-lite-java-flclient.jar</span></code> and the corresponding jar package <code class="docutils literal notranslate"><span class="pre">quick_start_flclient.jar</span></code> of the model script, obtaining in <a class="reference external" href="https://www.mindspore.cn/federated/docs/en/master/deploy_federated_client.html">Compiling package Flow in device-side deployment</a> to simulate starting multiple clients to participate in the federated learning task.</p>
<p>Taking the LeNet network as an example, some of the input parameters in the <code class="docutils literal notranslate"><span class="pre">run_client_x86.py</span></code> script have the following meanings, and users can set them according to the actual situation:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">--fl_jar_path</span></code></p>
<p>For setting the federated learning jar package path and obtaining x86 environment federated learning jar package, refer to <a class="reference external" href="https://www.mindspore.cn/federated/docs/en/master/deploy_federated_client.html">Compile package process in device-side deployment</a>.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">--case_jar_path</span></code></p>
<p>For setting the path of jar package <code class="docutils literal notranslate"><span class="pre">quick_start_flclient.jar</span></code> generated by model script and obtaining the JAR package in the x86 environment, see <a class="reference external" href="https://www.mindspore.cn/federated/docs/en/master/deploy_federated_client.html">Compile package process in device-side deployment</a>.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">--lite_jar_path</span></code></p>
<p>For setting the path of jar package <code class="docutils literal notranslate"><span class="pre">mindspore-lite-java.jar</span></code> of mindspore lite, which is located in <code class="docutils literal notranslate"><span class="pre">mindspore-lite-{version}-linux-x64.tar.gz</span></code>. For x86 environment federated learning jar package acquisition,, see <a class="reference external" href="https://www.mindspore.cn/federated/docs/en/master/deploy_federated_client.html">Compile package process in device-side deployment</a>.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">--train_dataset</span></code></p>
<p>The root path of the training dataset in which the LeNet image classification task is stored is the training data.bin file and label.bin file for each client, e.g. <code class="docutils literal notranslate"><span class="pre">data/femnist/3500_clients_bin/</span></code>.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">--flName</span></code></p>
<p>Specifies the package path of model script used by federated learning. We provide two types of model scripts for your reference (<a class="reference external" href="https://gitee.com/mindspore/federated/tree/master/example/quick_start_flclient/src/main/java/com/mindspore/flclient/demo/albert">Supervised sentiment classification task</a>, <a class="reference external" href="https://gitee.com/mindspore/federated/tree/master/example/quick_start_flclient/src/main/java/com/mindspore/flclient/demo/lenet">Lenet image classification task</a>). For supervised sentiment classification tasks, this parameter can be set to the package path of the provided script file <a class="reference external" href="https://gitee.com/mindspore/federated/blob/master/example/quick_start_flclient/src/main/java/com/mindspore/flclient/demo/albert/AlbertClient.java">AlBertClient.java</a>, like as <code class="docutils literal notranslate"><span class="pre">com.mindspore.flclient.demo.albert.AlbertClient</span></code>. For Lenet image classification tasks, this parameter can be set to the package path of the provided script file <a class="reference external" href="https://gitee.com/mindspore/federated/blob/master/example/quick_start_flclient/src/main/java/com/mindspore/flclient/demo/lenet/LenetClient.java">LenetClient.java</a>, like as <code class="docutils literal notranslate"><span class="pre">com.mindspore.flclient.demo.lenet.LenetClient</span></code>. At the same time, users can refer to these two types of model scripts, define the model script by themselves, and then set the parameter to the package path of the customized model file ModelClient.java (which needs to inherit from the class <a class="reference external" href="https://gitee.com/mindspore/federated/blob/master/mindspore_federated/device_client/src/main/java/com/mindspore/flclient/model/Client.java">Client.java</a>).</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">--train_model_path</span></code></p>
<p>Specifies the training model path used for federated learning. The path is the directory where multiple .ms files copied in the preceding tutorial are stored, for example, <code class="docutils literal notranslate"><span class="pre">ms/lenet</span></code>. The path must be an absolute path.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">--domain_name</span></code></p>
<p>Used to set the url for device-cloud communication. Currently, https and http communication are supported, and the corresponding formats are like as: https://……, http://……. When <code class="docutils literal notranslate"><span class="pre">if_use_elb</span></code> is set to true, the format must be: https://127.0.0.1:6666 or http://127.0.0.1:6666, where <code class="docutils literal notranslate"><span class="pre">127.0.0.1</span></code> corresponds to the ip of the machine ip providing cloud-side services (corresponding to the cloud-side parameter <code class="docutils literal notranslate"><span class="pre">--scheduler_ip</span></code>), and <code class="docutils literal notranslate"><span class="pre">6666</span></code> corresponds to the cloud-side parameter <code class="docutils literal notranslate"><span class="pre">--fl_server_port</span></code>.</p>
<p>Note 1: When this parameter is set to <code class="docutils literal notranslate"><span class="pre">http://......</span></code>, it means that HTTP communication is used, and there may be communication security risks.</p>
<p>Note 2: When this parameter is set to <code class="docutils literal notranslate"><span class="pre">https://......</span></code>, it means the use of HTTPS communication. At this time, SSL certificate authentication must be performed, and the certificate path needs to be set by the parameter <code class="docutils literal notranslate"><span class="pre">-cert_path</span></code>.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">--task</span></code></p>
<p>Specifies the type of the task to be started. <code class="docutils literal notranslate"><span class="pre">train</span></code> indicates that a training task is started. <code class="docutils literal notranslate"><span class="pre">inference</span></code> indicates that multiple data inference tasks are started. <code class="docutils literal notranslate"><span class="pre">getModel</span></code> indicates that the task for obtaining the cloud model is started. Other character strings indicate that the inference task of a single data record is started. The default value is <code class="docutils literal notranslate"><span class="pre">train</span></code>. The initial model file (.ms file) is not trained. Therefore, you are advised to start the training task first. After the training is complete, start the inference task. (Note that the values of client_num in the two startups must be the same to ensure that the model file used by <code class="docutils literal notranslate"><span class="pre">inference</span></code> is the same as that used by <code class="docutils literal notranslate"><span class="pre">train</span></code>.)</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">--batch_size</span></code></p>
<p>Specifies the number of single-step training samples used in federated learning training and inference, that is, batch size. It needs to be consistent with the batch size of the input data of the model.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">--client_num</span></code></p>
<p>Specifies the number of clients. The value must be the same as that of <code class="docutils literal notranslate"><span class="pre">start_fl_job_cnt</span></code> when the server is started. This parameter is not required in actual scenarios.</p>
</li>
</ul>
<p>If you want to know more about the meaning of other parameters in the <code class="docutils literal notranslate"><span class="pre">run_client_x86.py</span></code> script, you can refer to the comments in the script.</p>
<p>The basic startup instructions of the federated learning interface are as follows:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>client_*<span class="se">\</span>
<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>ms/*<span class="w"> </span><span class="se">\</span>
<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>python3<span class="w"> </span>run_client_x86.py<span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--fl_jar_path<span class="o">=</span><span class="s2">&quot;federated/mindspore_federated/device_client/build/libs/jarX86/mindspore-lite-java-flclient.jar&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--case_jar_path<span class="o">=</span><span class="s2">&quot;federated/example/quick_start_flclient/target/case_jar/quick_start_flclient.jar&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--lite_jar_path<span class="o">=</span><span class="s2">&quot;federated/mindspore_federated/device_client/third/mindspore-lite-2.0.0-linux-x64/runtime/lib/mindspore-lite-java.jar&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--train_data_dir<span class="o">=</span><span class="s2">&quot;federated/tests/st/simulate_x86/data/3500_clients_bin/&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--eval_data_dir<span class="o">=</span><span class="s2">&quot;null&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--infer_data_dir<span class="o">=</span><span class="s2">&quot;null&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--vocab_path<span class="o">=</span><span class="s2">&quot;null&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--ids_path<span class="o">=</span><span class="s2">&quot;null&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--path_regex<span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--fl_name<span class="o">=</span><span class="s2">&quot;com.mindspore.flclient.demo.lenet.LenetClient&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--origin_train_model_path<span class="o">=</span><span class="s2">&quot;federated/tests/st/simulate_x86/ms_files/lenet/lenet_train.ms&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--origin_infer_model_path<span class="o">=</span><span class="s2">&quot;null&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--train_model_dir<span class="o">=</span><span class="s2">&quot;ms&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--infer_model_dir<span class="o">=</span><span class="s2">&quot;ms&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--ssl_protocol<span class="o">=</span><span class="s2">&quot;TLSv1.2&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--deploy_env<span class="o">=</span><span class="s2">&quot;x86&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--domain_name<span class="o">=</span><span class="s2">&quot;http://10.113.216.40:8010&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--cert_path<span class="o">=</span><span class="s2">&quot;CARoot.pem&quot;</span><span class="w"> </span>--use_elb<span class="o">=</span><span class="s2">&quot;false&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--server_num<span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--task<span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--thread_num<span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--cpu_bind_mode<span class="o">=</span><span class="s2">&quot;NOT_BINDING_CORE&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--train_weight_name<span class="o">=</span><span class="s2">&quot;null&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--infer_weight_name<span class="o">=</span><span class="s2">&quot;null&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--name_regex<span class="o">=</span><span class="s2">&quot;::&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--server_mode<span class="o">=</span><span class="s2">&quot;FEDERATED_LEARNING&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--batch_size<span class="o">=</span><span class="m">32</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--input_shape<span class="o">=</span><span class="s2">&quot;null&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--client_num<span class="o">=</span><span class="m">8</span>
</pre></div>
</div>
<p>Note that the related path in the startup command must give an absolute path.</p>
<p>The above commands indicate that eight clients are started to participate in federated learning. If the startup is successful, log files corresponding to the eight clients are generated in the current folder. You can view the log files to learn the running status of each client:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>./
├── client_0
│   └── client.log  # Log file of client 0.
│           ......
└── client_7
    └── client.log  # Log file of client 7.
</pre></div>
</div>
<p>For different interfaces and scenarios, you only need to modify specific parameter values according to the meaning of the parameters, such as:</p>
<ul>
<li><p>Start federated learning and training tasks: SyncFLJob.flJobRun()</p>
<p>When <code class="docutils literal notranslate"><span class="pre">--task</span></code> in <code class="docutils literal notranslate"><span class="pre">Basic</span> <span class="pre">Start</span> <span class="pre">Command</span></code> is set to <code class="docutils literal notranslate"><span class="pre">train</span></code>, it means to start the task.</p>
<p>You can use the command <code class="docutils literal notranslate"><span class="pre">grep</span> <span class="pre">-r</span> <span class="pre">&quot;average</span> <span class="pre">loss:&quot;</span> <span class="pre">client_0/client.log</span></code> to view the average loss of each epoch of <code class="docutils literal notranslate"><span class="pre">client_0</span></code> during the training process. It will be printed as follows:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>INFO:<span class="w"> </span>&lt;FLClient&gt;<span class="w"> </span>----------epoch:0,average<span class="w"> </span>loss:4.1258564<span class="w"> </span>----------
......
</pre></div>
</div>
<p>You can also use the command <code class="docutils literal notranslate"><span class="pre">grep</span> <span class="pre">-r</span> <span class="pre">&quot;evaluate</span> <span class="pre">acc:&quot;</span> <span class="pre">client_0/client.log</span></code> to view the verification accuracy of the model after the aggregation in each federated learning iteration for <code class="docutils literal notranslate"><span class="pre">client_0</span></code> . It will be printed like the following:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>INFO:<span class="w"> </span>&lt;FLClient&gt;<span class="w"> </span><span class="o">[</span>evaluate<span class="o">]</span><span class="w"> </span>evaluate<span class="w"> </span>acc:<span class="w"> </span><span class="m">0</span>.125
......
</pre></div>
</div>
<p>On the cloud side, the number of client group ids and algorithm type for unsupervised cluster index statistics can be specified by setting the ‘cluster_client_num’ parameter and ‘eval_type’ parameter of yaml configuration file. The ‘metrics.json’ statistical file generated on the cloud side can query the unsupervised indicator information:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&quot;unsupervisedEval&quot;:0.640
&quot;unsupervisedEval&quot;:0.675
&quot;unsupervisedEval&quot;:0.677
&quot;unsupervisedEval&quot;:0.706
......
</pre></div>
</div>
</li>
<li><p>Start the inference task: SyncFLJob.modelInference()</p>
<p>When <code class="docutils literal notranslate"><span class="pre">--task</span></code> in <code class="docutils literal notranslate"><span class="pre">Basic</span> <span class="pre">Start</span> <span class="pre">Command</span></code> is set to <code class="docutils literal notranslate"><span class="pre">inference</span></code>, it means to start the task.</p>
<p>You can view the inference result of <code class="docutils literal notranslate"><span class="pre">client_0</span></code> through the command <code class="docutils literal notranslate"><span class="pre">grep</span> <span class="pre">-r</span> <span class="pre">&quot;the</span> <span class="pre">predicted</span> <span class="pre">labels:&quot;</span> <span class="pre">client_0/client.log</span></code>:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>INFO:<span class="w"> </span>&lt;FLClient&gt;<span class="w"> </span><span class="o">[</span>model<span class="w"> </span>inference<span class="o">]</span><span class="w"> </span>the<span class="w"> </span>predicted<span class="w"> </span>labels:<span class="w"> </span><span class="o">[</span><span class="m">0</span>,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">1</span>,<span class="w"> </span><span class="m">1</span>,<span class="w"> </span><span class="m">1</span>,<span class="w"> </span><span class="m">2</span>,<span class="w"> </span><span class="m">2</span>,<span class="w"> </span><span class="m">2</span><span class="o">]</span>
......
</pre></div>
</div>
</li>
<li><p>Start the task of obtaining the latest model on the cloud side: SyncFLJob.getModel()</p>
<p>When <code class="docutils literal notranslate"><span class="pre">--task</span></code> in <code class="docutils literal notranslate"><span class="pre">Basic</span> <span class="pre">Start</span> <span class="pre">Command</span></code> is set to <code class="docutils literal notranslate"><span class="pre">inference</span></code>, it means to start the task.</p>
<p>If there is the following content in the log file, it means that the latest model on the cloud side is successfully obtained:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>INFO:<span class="w"> </span>&lt;FLClient&gt;<span class="w"> </span><span class="o">[</span>getModel<span class="o">]</span><span class="w"> </span>get<span class="w"> </span>response<span class="w"> </span>from<span class="w"> </span>server<span class="w"> </span>ok!
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="stop-the-client-process">
<h3>Stop the client process<a class="headerlink" href="#stop-the-client-process" title="Permalink to this headline">¶</a></h3>
<p>For details, see the <a class="reference external" href="https://gitee.com/mindspore/federated/blob/master/example/cross_device_lenet_femnist/simulate_x86/finish.py">finish.py</a> script. The details are as follows:</p>
<p>The command of stopping the client process:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>finish.py<span class="w"> </span>--kill_tag<span class="o">=</span>mindspore-lite-java-flclient
</pre></div>
</div>
<p>The parameter <code class="docutils literal notranslate"><span class="pre">--kill_tag</span></code> is used to search for the keyword to kill the client process. You only need to set the special keyword in <code class="docutils literal notranslate"><span class="pre">--jarPath</span></code>. The default value is <code class="docutils literal notranslate"><span class="pre">mindspore-lite-java-flclient</span></code>, that is, the name of the federated learning JAR package. The user can check whether the process still exists through the command <code class="docutils literal notranslate"><span class="pre">ps</span> <span class="pre">-ef</span> <span class="pre">|grep</span> <span class="pre">&quot;mindspore-lite-java-flclient&quot;</span></code>.</p>
<p>Experimental results of 50 clients participating in federated learning and training tasks.</p>
<p>Currently, the <code class="docutils literal notranslate"><span class="pre">3500_clients_bin</span></code> folder contains data of 3500 clients. This script can simulate a maximum of 3500 clients to participate in federated learning.</p>
<p>The following figure shows the accuracy of the test dataset for federated learning on 50 clients (set <code class="docutils literal notranslate"><span class="pre">server_num</span></code> to 16).</p>
<p><img alt="lenet_50_clients_acc" src="_images/lenet_50_clients_acc_en.png" /></p>
<p>The total number of federated learning iterations is 100, the number of epochs for local training on the client is 20, and the value of batchSize is 32.</p>
<p>The test accuracy in the figure refers to the accuracy of each client test dataset on the aggregated model on the cloud for each federated learning iteration:</p>
<p>AVG: average accuracy of 50 clients in the test dataset for each federated learning iteration.</p>
<p>TOP5: average accuracy of the 5 clients with the highest accuracy in the test dataset for each federated learning iteration.</p>
<p>LOW5: average accuracy of the 5 clients with the lowest accuracy in the test dataset for each federated learning iteration.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="sentiment_classification_application.html" class="btn btn-neutral float-right" title="Implementing a Sentiment Classification Application (Android)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="image_classfication_dataset_process.html" class="btn btn-neutral float-left" title="Federated Learning Image Classification Dataset Process" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2022, MindSpore.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   
	<script async="async" src="https://cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>