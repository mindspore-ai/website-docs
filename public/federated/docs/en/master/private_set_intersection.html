<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vertical Federated-Privacy Set Intersection &mdash; MindSpore master documentation</title><script>;(()=>{const e=localStorage.getItem("ms-theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;(e?"dark"===e:t)&&document.documentElement.setAttribute("data-o-theme","dark")})();</script><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script><script src="_static/jquery.js"></script>
        <script src="_static/js/theme.js"></script><script src="_static/underscore.js"></script><script src="_static/doctools.js"></script><script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script><script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script><script async="async" src="https://cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Vertical Federated-Feature Protection Based on Information Obfuscation" href="secure_vertical_federated_learning_with_EmbeddingDP.html" />
    <link rel="prev" title="Horizontal FL-Pairwise encryption training" href="pairwise_encryption_training.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> MindSpore
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Deployment</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="federated_install.html">Obtaining MindSpore Federated</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploy_federated_server.html">Horizontal Federated Cloud-based Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploy_federated_client.html">Horizontal Federated Device-side Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploy_vfl.html">Vertical Federated Deployment</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Horizontal Application</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="image_classfication_dataset_process.html">Federated Learning Image Classification Dataset Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="image_classification_application.html">Implementing an Image Classification Application of Cross-device Federated Learning (x86)</a></li>
<li class="toctree-l1"><a class="reference internal" href="sentiment_classification_application.html">Implementing a Sentiment Classification Application (Android)</a></li>
<li class="toctree-l1"><a class="reference internal" href="image_classification_application_in_cross_silo.html">Implementing a Cloud-Slio Federated Image Classification Application (x86)</a></li>
<li class="toctree-l1"><a class="reference internal" href="object_detection_application_in_cross_silo.html">Implementing a Cross-Silo Federated Target Detection Application (x86)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Vertical Application</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="data_join.html">Vertical Federated Learning Data Access</a></li>
<li class="toctree-l1"><a class="reference internal" href="split_wnd_application.html">Vertical Federated Learning Model Training - Wide&amp;Deep Recommendation Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="split_pangu_alpha_application.html">Vertical Federated Learning Model Training - Pangu Alpha Large Model Cross-Domain Training</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Security and Privacy</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="local_differential_privacy_training_noise.html">Horizontal FL-Local Differential Privacy Perturbation Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="local_differential_privacy_training_signds.html">Horizontal FL-Local Differential Privacy SignDS training</a></li>
<li class="toctree-l1"><a class="reference internal" href="local_differential_privacy_eval_laplace.html">Horizontal Federated-Local Differential Privacy Inference Result Protection</a></li>
<li class="toctree-l1"><a class="reference internal" href="pairwise_encryption_training.html">Horizontal FL-Pairwise encryption training</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Vertical Federated-Privacy Set Intersection</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#privacy-protection-background">Privacy Protection Background</a></li>
<li class="toctree-l2"><a class="reference internal" href="#algorithm-process-introduction">Algorithm Process Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#quick-experience">Quick Experience</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#front-end-needs">Front-end Needs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#starting-the-script">Starting the Script</a></li>
<li class="toctree-l3"><a class="reference internal" href="#output-results">Output Results</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#deep-experience">Deep Experience</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#import-module">Import Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-preparation">Data Preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#constructing-communication">Constructing Communication</a></li>
<li class="toctree-l3"><a class="reference internal" href="#starting-intersection">Starting Intersection</a></li>
<li class="toctree-l3"><a class="reference internal" href="#output-results-1">Output Results</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="secure_vertical_federated_learning_with_EmbeddingDP.html">Vertical Federated-Feature Protection Based on Information Obfuscation</a></li>
<li class="toctree-l1"><a class="reference internal" href="secure_vertical_federated_learning_with_TEE.html">Vertical Federated - Feature Protection Based on Trusted Execution Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="secure_vertical_federated_learning_with_DP.html">Vertical Federated - Label Protection Based on Differential Privacy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Communication Compression</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="communication_compression.html">Device-Cloud Federated Learning Communication Compression</a></li>
<li class="toctree-l1"><a class="reference internal" href="vfl_communication_compress.html">Vertical Federated Learning Communication Compression</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Horizontal Federated API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="horizontal_server.html">Federated Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="cross_device.html">Device-side Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="horizontal/cross_silo.html">Cross-Silo</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Vertical Federated API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Data_Join.html">Data Join</a></li>
<li class="toctree-l1"><a class="reference internal" href="vertical/vertical_communicator.html">Vertical Federated Learning Communicator</a></li>
<li class="toctree-l1"><a class="reference internal" href="vertical_federated_trainer.html">Vertical Federated Trainer</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">RELEASE NOTES</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="RELEASE.html">Release Notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MindSpore</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Vertical Federated-Privacy Set Intersection</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/private_set_intersection.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="vertical-federated-privacy-set-intersection">
<h1>Vertical Federated-Privacy Set Intersection<a class="headerlink" href="#vertical-federated-privacy-set-intersection" title="Permalink to this headline"></a></h1>
<p><a class="reference external" href="https://gitee.com/mindspore/docs/blob/master/docs/federated/docs/source_en/private_set_intersection.md"><img alt="View Source On Gitee" src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/master/resource/_static/logo_source_en.png" /></a></p>
<section id="privacy-protection-background">
<h2>Privacy Protection Background<a class="headerlink" href="#privacy-protection-background" title="Permalink to this headline"></a></h2>
<p>With the rise in demand for digital transformation and the circulation of data elements, as well as the implementation of the Data Security Law, the Personal Information Protection Law and the EU General Data Protection Regulation (GDPR), privacy of data is increasingly becoming a necessary requirement in many scenarios. For example, when the dataset is sensitive information of users (medical diagnosis information, transaction records, identification codes, device unique identifier OAID, etc.) or secret information of the company, cryptography or desensitization must be used to ensure the confidentiality of the data before using it in the open state to achieve the goal of “usable but invisible” of the data in order to prevent information leakage. Considering two participants who jointly train a machine learning model (e.g., vertical federated learning) by using their respective data, the first step of this task is to align the sample sets of both parties, a process known as Entity Resolution. Traditional plaintext intersection inevitably reveals the OAID of the entire database and damages the data privacy of both parties, so the Privacy Set Intersection (PSI) technique is needed to accomplish this task.</p>
<p>PSI is a type of secure multi-party computing (MPC) protocol that takes data collection from two parties as input, after a series of hashing, encryption and data exchange steps, eventually outputs the intersection of the collection to an agreed output party, while ensuring that the participating parties cannot obtain any information about the data outside the intersection. The use of the PSI protocol in vertical federated learning tasks, in compliance with the GDPR requirement of Data Minimisation, i.e. there is no non-essential exposure of data, except for the parts necessary for the training process (intersections). From the data controller’s perspective, the service has to share data appropriately, but wants to share only necessary data based on the service and not expose additional data to the public. It should be noted that while PSI can directly apply existing MPC protocols to its calculations, this often results in a large computational and communication overhead, which is not conducive to business. In this paper, we introduce a technique combining Bloom filter and eliminable inverse scalar multiplication on the elliptic curve to implement ECDH-PSI (Elliptic Curve Diffie-Hellman key Exchange-PSI) to better support cloud services and carry out privacy preserving set intersection computing services.</p>
</section>
<section id="algorithm-process-introduction">
<h2>Algorithm Process Introduction<a class="headerlink" href="#algorithm-process-introduction" title="Permalink to this headline"></a></h2>
<p>The core idea of ECDH-PSI is that a piece of data is first encrypted by Alice and then encrypted by Bob, with the same result as exchanging the encryption order. One party sends the data encrypted with its own private key without revealing its privacy, and the other party re-encrypts it with its own private key based on the received encrypted data. If the encryption result is the same, the original data is the same.</p>
<p>The core optimization point of the inverse ECDH-PSI is to minimize the encryption computation based on the set of large amount of data when facing the scenario of intersection between two parties with unbalanced amount of data (Bob is the party with less data, <span class="math notranslate nohighlight">\(a\)</span> and <span class="math notranslate nohighlight">\(b\)</span> are the private keys of Alice and Bob respectively, the original data of both parties are mapped to the elliptic curve as <span class="math notranslate nohighlight">\(P_1\)</span> and <span class="math notranslate nohighlight">\(P_2\)</span> respectively, the point multiplication encryption of the elliptic curve with the private key <span class="math notranslate nohighlight">\(k\)</span> is <span class="math notranslate nohighlight">\(P^k\)</span> or <span class="math notranslate nohighlight">\(kP\)</span>, and the inverse of the private key <span class="math notranslate nohighlight">\(k\)</span> is <span class="math notranslate nohighlight">\(k^{-1}\)</span>). Then after Alice executes <span class="math notranslate nohighlight">\(p_1^a\)</span> and sends it to Bob, Bob no longer performs the encryption calculation based on it, but sends <span class="math notranslate nohighlight">\(p_2^b\)</span> to Alice. After Alice sends <span class="math notranslate nohighlight">\(P_2^{ba}\)</span>, Bob completes the offset operation by point multiplying the inverse of its private key, i.e., calculating <span class="math notranslate nohighlight">\(P_2^{bab^{-1}}\)</span> and comparing it with the <span class="math notranslate nohighlight">\(P_1^a\)</span> sent by Alice. If the encryption result is the same, it means <span class="math notranslate nohighlight">\(P_1=P_2\)</span>. The flowchart of the inverse ECDH-PSI is shown in the figure, and the red letters indicate the received data from the other side.</p>
<p><img alt="inverse_ecdh_psi_flow" src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/master/docs/federated/docs/source_zh_cn/images/inverse_ecdh_psi_flow.png" /></p>
<p>The <span class="math notranslate nohighlight">\(bf\)</span> in the figure stands for Bloom filter (bf). If you want to query whether an element exists in a collection, the basic method is to iterate through the collection to query, or sort the collection and use dichotomous lookup to query, but when the amount of data is too large, sorting does not support parallelism, which is very time-consuming. If a bloom filter is used, the elements of the set are mapped to a number of bits in an initial all-0 bit string by a number of hash functions, and all the elements of the sets share a single bit string. When querying, simply use the same number of hash functions to process the data to be queried, and directly access all the corresponding bits to see if they are activated to 1. If all of them are 1, it means that the data exists. Otherwise, it does not exist. The probability of collision can be achieved by controlling the number of hash functions. The communication overhead of the latter is lower compared to sending the entire set and sending a single bit string from the output of the Bloom filter. The computation can also be accelerated by parallelism during the creation of the bloom filter and the use of the filter for large-scale data queries.</p>
</section>
<section id="quick-experience">
<h2>Quick Experience<a class="headerlink" href="#quick-experience" title="Permalink to this headline"></a></h2>
<section id="front-end-needs">
<h3>Front-end Needs<a class="headerlink" href="#front-end-needs" title="Permalink to this headline"></a></h3>
<p>Finish installing the <code class="docutils literal notranslate"><span class="pre">mindspore-federated</span></code> library in the Python environment.</p>
</section>
<section id="starting-the-script">
<h3>Starting the Script<a class="headerlink" href="#starting-the-script" title="Permalink to this headline"></a></h3>
<p>You can get the PSI start script for both sides from <a class="reference external" href="https://gitee.com/mindspore/federated/blob/master/tests/st/psi/run_psi.py">MindSpore federated ST</a> and open two processes to simulate both sides. The start command of local device and local communication:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">run_psi</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">comm_role</span><span class="o">=</span><span class="s2">&quot;server&quot;</span> <span class="o">--</span><span class="n">http_server_address</span><span class="o">=</span><span class="s2">&quot;127.0.0.1:8004&quot;</span> <span class="o">--</span><span class="n">remote_server_address</span><span class="o">=</span><span class="s2">&quot;127.0.0.1:8005&quot;</span> <span class="o">--</span><span class="n">input_begin</span><span class="o">=</span><span class="mi">1</span> <span class="o">--</span><span class="n">input_end</span><span class="o">=</span><span class="mi">100</span>

<span class="n">python</span> <span class="n">run_psi</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">comm_role</span><span class="o">=</span><span class="s2">&quot;client&quot;</span> <span class="o">--</span><span class="n">http_server_address</span><span class="o">=</span><span class="s2">&quot;127.0.0.1:8005&quot;</span> <span class="o">--</span><span class="n">remote_server_address</span><span class="o">=</span><span class="s2">&quot;127.0.0.1:8004&quot;</span> <span class="o">--</span><span class="n">input_begin</span><span class="o">=</span><span class="mi">50</span> <span class="o">--</span><span class="n">input_end</span><span class="o">=</span><span class="mi">150</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">input_begin</span></code> is used in conjunction with <code class="docutils literal notranslate"><span class="pre">input_end</span></code> to generate the dataset for intersection.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">peer_input_begin</span></code> and <code class="docutils literal notranslate"><span class="pre">peer_input_end</span></code> indicate the start and end ranges of each other’s data, taking <code class="docutils literal notranslate"><span class="pre">--need_check</span></code> as <code class="docutils literal notranslate"><span class="pre">True</span></code>, which can be intersected by the Python set1.intersection(set2) function to get the true result, and is used to check the correctness of the PSI.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">---bucket_size</span></code> (optional) indicates the number of for loops that serially perform multiple bucket intersections.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--thread_num</span></code> (optional) indicates the number of parallel threads used for the calculation.</p></li>
<li><p>To run plaintext intersection, add the parameter <code class="docutils literal notranslate"><span class="pre">--plain_intersection=True</span></code> to the command.</p></li>
</ul>
<p>At present, psi supports the intersection of hundreds of millions of large data. You can specify the size of the input data set by setting ‘input_begin’、’input_end’、’peer_input_begin’、’peer_input_end’ parameters. The theory proves that the memory resources of the machine and the system are sufficient, and there is no upper limit to the number of data computations psi can support. The startup command is as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">run_psi</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">comm_role</span><span class="o">=</span><span class="s2">&quot;server&quot;</span> <span class="o">--</span><span class="n">http_server_address</span><span class="o">=</span><span class="s2">&quot;127.0.0.1:8004&quot;</span> <span class="o">--</span><span class="n">remote_server_address</span><span class="o">=</span><span class="s2">&quot;127.0.0.1:8005&quot;</span> <span class="o">--</span><span class="n">input_begin</span><span class="o">=</span><span class="mi">1</span> <span class="o">--</span><span class="n">input_end</span><span class="o">=</span><span class="mi">100000000</span>

<span class="n">python</span> <span class="n">run_psi</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">comm_role</span><span class="o">=</span><span class="s2">&quot;client&quot;</span> <span class="o">--</span><span class="n">http_server_address</span><span class="o">=</span><span class="s2">&quot;127.0.0.1:8005&quot;</span> <span class="o">--</span><span class="n">remote_server_address</span><span class="o">=</span><span class="s2">&quot;127.0.0.1:8004&quot;</span> <span class="o">--</span><span class="n">input_begin</span><span class="o">=</span><span class="mi">1</span> <span class="o">--</span><span class="n">input_end</span><span class="o">=</span><span class="mi">100000000</span>
</pre></div>
</div>
</section>
<section id="output-results">
<h3>Output Results<a class="headerlink" href="#output-results" title="Permalink to this headline"></a></h3>
<p>Before running the script, you can set the environment variable <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">GLOG_v=1</span></code> to display the <code class="docutils literal notranslate"><span class="pre">INFO</span></code> level log, and also observe the operation of each phase within the protocol. After running the script, the intersection results will be printed out. As the amount of intersection data may be too large, the output here is limited to the first 20 intersection results.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>PSI<span class="w"> </span>result:<span class="w"> </span><span class="o">[</span><span class="s1">&#39;50&#39;</span>,<span class="w"> </span><span class="s1">&#39;51&#39;</span>,<span class="w"> </span><span class="s1">&#39;52&#39;</span>,<span class="w"> </span><span class="s1">&#39;53&#39;</span>,<span class="w"> </span><span class="s1">&#39;54&#39;</span>,<span class="w"> </span><span class="s1">&#39;55&#39;</span>,<span class="w"> </span><span class="s1">&#39;56&#39;</span>,<span class="w"> </span><span class="s1">&#39;57&#39;</span>,<span class="w"> </span><span class="s1">&#39;58&#39;</span>,<span class="w"> </span><span class="s1">&#39;59&#39;</span>,<span class="w"> </span><span class="s1">&#39;60&#39;</span>,<span class="w"> </span><span class="s1">&#39;61&#39;</span>,<span class="w"> </span><span class="s1">&#39;62&#39;</span>,<span class="w"> </span><span class="s1">&#39;63&#39;</span>,<span class="w"> </span><span class="s1">&#39;64&#39;</span>,<span class="w"> </span><span class="s1">&#39;65&#39;</span>,<span class="w"> </span><span class="s1">&#39;66&#39;</span>,<span class="w"> </span><span class="s1">&#39;67&#39;</span>,<span class="w"> </span><span class="s1">&#39;68&#39;</span>,<span class="w"> </span><span class="s1">&#39;69&#39;</span><span class="o">]</span><span class="w"> </span><span class="o">(</span>display<span class="w"> </span>limit:<span class="w"> </span><span class="m">20</span><span class="o">)</span>
</pre></div>
</div>
</section>
</section>
<section id="deep-experience">
<h2>Deep Experience<a class="headerlink" href="#deep-experience" title="Permalink to this headline"></a></h2>
<section id="import-module">
<h3>Import Module<a class="headerlink" href="#import-module" title="Permalink to this headline"></a></h3>
<p>To run the privacy set intersection, you need to rely on the communication module and the intersection module of the Federated Library, which are imported as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindspore_federated.startup.vertical_federated_local</span> <span class="kn">import</span> <span class="n">VerticalFederatedCommunicator</span><span class="p">,</span> <span class="n">ServerConfig</span>
<span class="kn">from</span> <span class="nn">mindspore_federated._mindspore_federated</span> <span class="kn">import</span> <span class="n">RunPSI</span>
<span class="kn">from</span> <span class="nn">mindspore_federated._mindspore_federated</span> <span class="kn">import</span> <span class="n">PlainIntersection</span>
</pre></div>
</div>
</section>
<section id="data-preparation">
<h3>Data Preparation<a class="headerlink" href="#data-preparation" title="Permalink to this headline"></a></h3>
<p>Both <code class="docutils literal notranslate"><span class="pre">RunPSI</span></code> and <code class="docutils literal notranslate"><span class="pre">PlainIntersection</span></code> require input data in <code class="docutils literal notranslate"><span class="pre">List(String)</span></code> format, and methods for generating datasets via file reading and for loops are given here:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">generate_input_data</span><span class="p">(</span><span class="n">input_begin_</span><span class="p">,</span> <span class="n">input_end_</span><span class="p">,</span> <span class="n">read_file_</span><span class="p">,</span> <span class="n">file_name_</span><span class="p">):</span>
    <span class="n">input_data_</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">read_file_</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name_</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
                <span class="n">input_data_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">input_data_</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">input_begin_</span><span class="p">,</span> <span class="n">input_end_</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">input_data_</span>
</pre></div>
</div>
<p>The input parameters <code class="docutils literal notranslate"><span class="pre">input_begin_</span></code> and <code class="docutils literal notranslate"><span class="pre">input_end_</span></code> limit the data range of the for loop. <code class="docutils literal notranslate"><span class="pre">read_file_</span></code> and <code class="docutils literal notranslate"><span class="pre">file_name_</span></code> indicate whether to read the file and the path where the file is located. The file can be constructed by itself, each line representing one piece of data.</p>
</section>
<section id="constructing-communication">
<h3>Constructing Communication<a class="headerlink" href="#constructing-communication" title="Permalink to this headline"></a></h3>
<p>Before calling this interface, a vertical federated communication instance needs to be initialized, as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">http_server_config</span> <span class="o">=</span> <span class="n">ServerConfig</span><span class="p">(</span><span class="n">server_name</span><span class="o">=</span><span class="n">comm_role</span><span class="p">,</span> <span class="n">server_address</span><span class="o">=</span><span class="n">http_server_address</span><span class="p">)</span>
<span class="n">remote_server_config</span> <span class="o">=</span> <span class="n">ServerConfig</span><span class="p">(</span><span class="n">server_name</span><span class="o">=</span><span class="n">peer_comm_role</span><span class="p">,</span> <span class="n">server_address</span><span class="o">=</span><span class="n">remote_server_address</span><span class="p">)</span>
<span class="n">vertical_communicator</span> <span class="o">=</span> <span class="n">VerticalFederatedCommunicator</span><span class="p">(</span><span class="n">http_server_config</span><span class="o">=</span><span class="n">http_server_config</span><span class="p">,</span>
                                                      <span class="n">remote_server_config</span><span class="o">=</span><span class="n">remote_server_config</span><span class="p">)</span>
<span class="n">vertical_communicator</span><span class="o">.</span><span class="n">launch</span><span class="p">()</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">server_name</span></code> is determined by whether the process belongs to <code class="docutils literal notranslate"><span class="pre">server</span></code> or <code class="docutils literal notranslate"><span class="pre">client</span></code>. <code class="docutils literal notranslate"><span class="pre">comm_role</span></code> is assigned to the corresponding <code class="docutils literal notranslate"><span class="pre">server</span></code> or <code class="docutils literal notranslate"><span class="pre">client</span></code>, and <code class="docutils literal notranslate"><span class="pre">peer_comm_role_</span></code> indicates the role of the other party.</p></li>
<li><p>The format of <code class="docutils literal notranslate"><span class="pre">server_address</span></code> is “IP:port”. <code class="docutils literal notranslate"><span class="pre">http_server_address</span></code> is assigned to the <code class="docutils literal notranslate"><span class="pre">IP</span></code> and <code class="docutils literal notranslate"><span class="pre">port</span></code> information of the process, such as “127.0.0.1:8004”. <code class="docutils literal notranslate"><span class="pre">remote_server_address</span></code> is assigned to the <code class="docutils literal notranslate"><span class="pre">IP</span></code> and <code class="docutils literal notranslate"><span class="pre">port</span></code> information of the other party.</p></li>
</ul>
</section>
<section id="starting-intersection">
<h3>Starting Intersection<a class="headerlink" href="#starting-intersection" title="Permalink to this headline"></a></h3>
<p>The external interfaces for secure set intersection are <code class="docutils literal notranslate"><span class="pre">RunPSI</span></code> and <code class="docutils literal notranslate"><span class="pre">PlainIntersection</span></code>, which are ciphertext and plaintext intersections respectively, with the same type and meaning of input and return results. Only ciphertext intersection <code class="docutils literal notranslate"><span class="pre">RunPSI</span></code> is described here:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">RunPSI</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">comm_role</span><span class="p">,</span> <span class="n">peer_comm_role</span><span class="p">,</span> <span class="n">bucket_id</span><span class="p">,</span> <span class="n">thread_num</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">input_data</span></code>: (list[string]), psi, the input data of one party.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">comm_role</span></code>: (string), communication-related parameter, “server” or “client”.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">peer_comm_role</span></code>: (string), communication-related parameter, “server” or “client”, different with comm_role.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bucket_id</span></code>: (int), outer part of the barrel, serial number of the pass-in barrel. <code class="docutils literal notranslate"><span class="pre">TypeError</span></code> error for passing in negative numbers, decimals or other types. If the value is different between two processes, the server will exit with an error and the client will block and wait.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">thread_num</span></code>: (int), number of threads, natural number. 0 is the default value, which means use the maximum number of threads available on the machine minus 5, and other values will be limited to 1 to the maximum available on the machine. <code class="docutils literal notranslate"><span class="pre">TypeError</span></code> error for passing in negative numbers, decimals or other types.</p></li>
</ul>
</section>
<section id="output-results-1">
<h3>Output Results<a class="headerlink" href="#output-results-1" title="Permalink to this headline"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">result</span></code> is in <code class="docutils literal notranslate"><span class="pre">list[string]</span></code> format, which represents the intersection result and can be printed out by itself. Here’s the method of the Python set intersection:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_right_result</span><span class="p">(</span><span class="n">self_input</span><span class="p">,</span> <span class="n">peer_input</span><span class="p">):</span>
    <span class="n">self_input_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">self_input</span><span class="p">)</span>
    <span class="n">peer_input_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">peer_input</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">self_input_set</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">peer_input_set</span><span class="p">)</span>
</pre></div>
</div>
<p>The results of the above methods can be compared with <code class="docutils literal notranslate"><span class="pre">result</span></code> to check if they are consistent, and the correctness of the interface can be verified.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="pairwise_encryption_training.html" class="btn btn-neutral float-left" title="Horizontal FL-Pairwise encryption training" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="secure_vertical_federated_learning_with_EmbeddingDP.html" class="btn btn-neutral float-right" title="Vertical Federated-Feature Protection Based on Information Obfuscation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, MindSpore.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 
</body>
</html>