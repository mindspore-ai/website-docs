

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Implementing a Sentiment Classification Application (Android) &mdash; MindSpore master documentation</title>
  

  
   
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  
  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        
        
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Implementing a Cloud-Slio Federated Image Classification Application (x86)" href="image_classification_application_in_cross_silo.html" />
    <link rel="prev" title="Implementing an Image Classification Application of Cross-device Federated Learning (x86)" href="image_classification_application.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> MindSpore
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Deployment</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="federated_install.html">Obtaining MindSpore Federated</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploy_federated_server.html">Horizontal Federated Cloud-based Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploy_federated_client.html">Horizontal Federated Device-side Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploy_vfl.html">Vertical Federated Deployment</a></li>
</ul>
<p class="caption"><span class="caption-text">Horizontal Application</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="image_classfication_dataset_process.html">Federated Learning Image Classification Dataset Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="image_classification_application.html">Implementing an Image Classification Application of Cross-device Federated Learning (x86)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Implementing a Sentiment Classification Application (Android)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#preparations">Preparations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#environment">Environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data">Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#model-related-files">Model-related Files</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#defining-the-network">Defining the Network</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#generating-a-device-side-model-file">Generating a Device-Side Model File</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#exporting-a-model-as-a-mindir-file">Exporting a Model as a MindIR File</a></li>
<li class="toctree-l4"><a class="reference internal" href="#converting-the-mindir-file-into-an-ms-file-that-can-be-used-by-the-federated-learning-framework-on-the-device">Converting the MindIR File into an MS File that Can be Used by the Federated Learning Framework on the Device</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#starting-the-federated-learning-process">Starting the Federated Learning Process</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#creating-an-android-project">Creating an Android Project</a></li>
<li class="toctree-l3"><a class="reference internal" href="#obtaining-a-related-package">Obtaining a Related Package</a></li>
<li class="toctree-l3"><a class="reference internal" href="#android-instance-program-structure">Android Instance Program Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#writing-code">Writing Code</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuring-android-project-dependencies">Configuring Android Project Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-and-running-on-android">Building and Running on Android</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#results">Results</a></li>
<li class="toctree-l2"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="image_classification_application_in_cross_silo.html">Implementing a Cloud-Slio Federated Image Classification Application (x86)</a></li>
<li class="toctree-l1"><a class="reference internal" href="object_detection_application_in_cross_silo.html">Implementing a Cross-Silo Federated Target Detection Application (x86)</a></li>
</ul>
<p class="caption"><span class="caption-text">Vertical Application</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="data_join.html">Vertical Federated Learning Data Access</a></li>
<li class="toctree-l1"><a class="reference internal" href="split_wnd_application.html">Vertical Federated Learning Model Training - Wide&amp;Deep Recommendation Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="split_pangu_alpha_application.html">Vertical Federated Learning Model Training - Pangu Alpha Large Model Cross-Domain Training</a></li>
</ul>
<p class="caption"><span class="caption-text">Security and Privacy</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="local_differential_privacy_training_noise.html">Horizontal FL-Local Differential Privacy Perturbation Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="local_differential_privacy_training_signds.html">Horizontal FL-Local Differential Privacy SignDS training</a></li>
<li class="toctree-l1"><a class="reference internal" href="pairwise_encryption_training.html">Horizontal FL-Pairwise encryption training</a></li>
<li class="toctree-l1"><a class="reference internal" href="private_set_intersection.html">Vertical Federated-Privacy Set Intersection</a></li>
<li class="toctree-l1"><a class="reference internal" href="secure_vertical_federated_learning_with_EmbeddingDP.html">Vertical Federated-Feature Protection Based on Information Obfuscation</a></li>
<li class="toctree-l1"><a class="reference internal" href="secure_vertical_federated_learning_with_TEE.html">Vertical Federated - Feature Protection Based on Trusted Execution Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="secure_vertical_federated_learning_with_DP.html">Vertical Federated - Label Protection Based on Differential Privacy</a></li>
</ul>
<p class="caption"><span class="caption-text">Communication Compression</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="communication_compression.html">Device-Cloud Federated Learning Communication Compression</a></li>
<li class="toctree-l1"><a class="reference internal" href="vfl_communication_compress.html">Vertical Federated Learning Communication Compression</a></li>
</ul>
<p class="caption"><span class="caption-text">Horizontal Federated API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="horizontal_server.html">Federated Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="cross_device.html">Device-side Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="horizontal/cross_silo.html">Cross-Silo</a></li>
</ul>
<p class="caption"><span class="caption-text">Vertical Federated API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Data_Join.html">Data Join</a></li>
<li class="toctree-l1"><a class="reference internal" href="vertical/vertical_communicator.html">Vertical Federated Learning Communicator</a></li>
<li class="toctree-l1"><a class="reference internal" href="vertical_federated_trainer.html">Vertical Federated Trainer</a></li>
</ul>
<p class="caption"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MindSpore</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Implementing a Sentiment Classification Application (Android)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/sentiment_classification_application.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="implementing-a-sentiment-classification-application-android">
<h1>Implementing a Sentiment Classification Application (Android)<a class="headerlink" href="#implementing-a-sentiment-classification-application-android" title="Permalink to this headline">¶</a></h1>
<p><a href="https://gitee.com/mindspore/docs/blob/master/docs/federated/docs/source_en/sentiment_classification_application.md" target="_blank"><img src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/master/resource/_static/logo_source_en.png"></a></p>
<p>Through the federated learning modeling approach of cross-device collaboration, the advantages of device-side data can be fully utilized to avoid uploading sensitive user data directly to the cloud side. Since users attach great importance to the privacy of the text they input when using input methods, and the intelligent functions of input methods are important to improve user experience. Therefore, federated learning is naturally applicable to the input method application scenarios.</p>
<p>MindSpore Federated has applied the Federated Language Model to the emoji image prediction feature of the input method. The Federated Language Model recommends emoji images that are appropriate for the current context based on chat text data. When modeling with federated learning, each emoji image is defined as a sentiment label category, and each chat phrase corresponds to an emoji image. MindSpore Federated defines the emoji image prediction task as a federated sentiment classification task.</p>
<div class="section" id="preparations">
<h2>Preparations<a class="headerlink" href="#preparations" title="Permalink to this headline">¶</a></h2>
<div class="section" id="environment">
<h3>Environment<a class="headerlink" href="#environment" title="Permalink to this headline">¶</a></h3>
<p>For details, see <a class="reference external" href="https://www.mindspore.cn/federated/docs/en/master/deploy_federated_server.html">Server Environment Configuration</a> and <a class="reference external" href="https://www.mindspore.cn/federated/docs/en/master/deploy_federated_client.html">Client Environment Configuration</a>.</p>
</div>
<div class="section" id="data">
<h3>Data<a class="headerlink" href="#data" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/notebook/datasets/supervise/client.tar.gz">training data</a> contains 20 user chat files. The directory structure is as follows:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>mobile/datasets/train/
├── 0.tsv  # Training data of user 0
├── 1.tsv  # Training data of user 1
│
│          ......
│
└── 19.tsv  # Training data of user 19
</pre></div>
</div>
<p>The <a class="reference external" href="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/notebook/datasets/supervise/eval.tar.gz">validation data</a> contains one chat file. The directory structure is as follows:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>datasets/supervise/eval/
└── eval.txt  # Validation data
</pre></div>
</div>
<p>The labels in the training data and validation data correspond to four types of emojis: <code class="docutils literal notranslate"><span class="pre">good</span></code>, <code class="docutils literal notranslate"><span class="pre">leimu</span></code>, <code class="docutils literal notranslate"><span class="pre">xiaoku</span></code>, <code class="docutils literal notranslate"><span class="pre">xin</span></code>.</p>
</div>
<div class="section" id="model-related-files">
<h3>Model-related Files<a class="headerlink" href="#model-related-files" title="Permalink to this headline">¶</a></h3>
<p>The directory structures of the <a class="reference external" href="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/notebook/datasets/vocab.txt">dictionary</a> and the <a class="reference external" href="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/notebook/datasets/vocab_map_ids.txt">mapping file of dictionary ID</a> related to the model file are as follows:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>mobile/models/
├── vocab.txt  # Dictionary
└── vocab_map_ids.txt  # Mapping file of Dictionary ID
</pre></div>
</div>
</div>
</div>
<div class="section" id="defining-the-network">
<h2>Defining the Network<a class="headerlink" href="#defining-the-network" title="Permalink to this headline">¶</a></h2>
<p>The ALBERT language model[1] is used in federated learning. The ALBERT model on the client includes the embedding layer, encoder layer, and classifier layer.</p>
<p>For details about the network definition, see <a class="reference external" href="https://gitee.com/mindspore/federated/blob/master/tests/st/network/albert.py">source code</a>.</p>
<div class="section" id="generating-a-device-side-model-file">
<h3>Generating a Device-Side Model File<a class="headerlink" href="#generating-a-device-side-model-file" title="Permalink to this headline">¶</a></h3>
<p>User can generate a Device-Side Model File as follow, or download the generated <a class="reference external" href="https://gitee.com/link?target=https%3A%2F%2Fmindspore-website.obs.cn-north-4.myhuaweicloud.com%2Fnotebook%2Fmodels%2Falbert_supervise.mindir.ms">ALBERT Device-Side Model File</a>。</p>
<div class="section" id="exporting-a-model-as-a-mindir-file">
<h4>Exporting a Model as a MindIR File<a class="headerlink" href="#exporting-a-model-as-a-mindir-file" title="Permalink to this headline">¶</a></h4>
<p>The sample code is as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">from</span> <span class="nn">mindspore.nn</span> <span class="kn">import</span> <span class="n">AdamWeightDecay</span>
<span class="kn">from</span> <span class="nn">src.config</span> <span class="kn">import</span> <span class="n">train_cfg</span><span class="p">,</span> <span class="n">client_net_cfg</span>
<span class="kn">from</span> <span class="nn">src.utils</span> <span class="kn">import</span> <span class="n">restore_params</span>
<span class="kn">from</span> <span class="nn">src.model</span> <span class="kn">import</span> <span class="n">AlbertModelCLS</span>
<span class="kn">from</span> <span class="nn">src.cell_wrapper</span> <span class="kn">import</span> <span class="n">NetworkWithCLSLoss</span><span class="p">,</span> <span class="n">NetworkTrainCell</span>


<span class="k">def</span> <span class="nf">parse_args</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    parse args</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;export task&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--device_target&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;GPU&#39;</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ascend&#39;</span><span class="p">,</span> <span class="s1">&#39;GPU&#39;</span><span class="p">])</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--device_id&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--init_model_path&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--output_dir&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;./models/mindir/&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--seed&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">supervise_export</span><span class="p">(</span><span class="n">args_opt</span><span class="p">):</span>
    <span class="n">ms</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="n">args_opt</span><span class="o">.</span><span class="n">seed</span><span class="p">),</span> <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">args_opt</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
    <span class="c1"># Parameter configuration</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CUDA_VISIBLE_DEVICES&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args_opt</span><span class="o">.</span><span class="n">device_id</span>
    <span class="n">init_model_path</span> <span class="o">=</span> <span class="n">args_opt</span><span class="o">.</span><span class="n">init_model_path</span>
    <span class="n">output_dir</span> <span class="o">=</span> <span class="n">args_opt</span><span class="o">.</span><span class="n">output_dir</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Parameters setting is done! Time cost: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>

    <span class="c1"># MindSpore configuration</span>
    <span class="n">ms</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">GRAPH_MODE</span><span class="p">,</span> <span class="n">device_target</span><span class="o">=</span><span class="n">args_opt</span><span class="o">.</span><span class="n">device_target</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Context setting is done! Time cost: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>

    <span class="c1"># Build mode</span>
    <span class="n">albert_model_cls</span> <span class="o">=</span> <span class="n">AlbertModelCLS</span><span class="p">(</span><span class="n">client_net_cfg</span><span class="p">)</span>
    <span class="n">network_with_cls_loss</span> <span class="o">=</span> <span class="n">NetworkWithCLSLoss</span><span class="p">(</span><span class="n">albert_model_cls</span><span class="p">)</span>
    <span class="n">network_with_cls_loss</span><span class="o">.</span><span class="n">set_train</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Model construction is done! Time cost: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>

    <span class="c1"># Build optimizer</span>
    <span class="n">client_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">_</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">network_with_cls_loss</span><span class="o">.</span><span class="n">trainable_params</span><span class="p">()]</span>
    <span class="n">client_decay_params</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
        <span class="nb">filter</span><span class="p">(</span><span class="n">train_cfg</span><span class="o">.</span><span class="n">optimizer_cfg</span><span class="o">.</span><span class="n">AdamWeightDecay</span><span class="o">.</span><span class="n">decay_filter</span><span class="p">,</span> <span class="n">client_params</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">client_other_params</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
        <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="n">train_cfg</span><span class="o">.</span><span class="n">optimizer_cfg</span><span class="o">.</span><span class="n">AdamWeightDecay</span><span class="o">.</span><span class="n">decay_filter</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">client_params</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">client_group_params</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="n">client_decay_params</span><span class="p">,</span> <span class="s1">&#39;weight_decay&#39;</span><span class="p">:</span> <span class="n">train_cfg</span><span class="o">.</span><span class="n">optimizer_cfg</span><span class="o">.</span><span class="n">AdamWeightDecay</span><span class="o">.</span><span class="n">weight_decay</span><span class="p">},</span>
        <span class="p">{</span><span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="n">client_other_params</span><span class="p">,</span> <span class="s1">&#39;weight_decay&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">},</span>
        <span class="p">{</span><span class="s1">&#39;order_params&#39;</span><span class="p">:</span> <span class="n">client_params</span><span class="p">}</span>
    <span class="p">]</span>
    <span class="n">client_optimizer</span> <span class="o">=</span> <span class="n">AdamWeightDecay</span><span class="p">(</span><span class="n">client_group_params</span><span class="p">,</span>
                                       <span class="n">learning_rate</span><span class="o">=</span><span class="n">train_cfg</span><span class="o">.</span><span class="n">client_cfg</span><span class="o">.</span><span class="n">learning_rate</span><span class="p">,</span>
                                       <span class="n">eps</span><span class="o">=</span><span class="n">train_cfg</span><span class="o">.</span><span class="n">optimizer_cfg</span><span class="o">.</span><span class="n">AdamWeightDecay</span><span class="o">.</span><span class="n">eps</span><span class="p">)</span>
    <span class="n">client_network_train_cell</span> <span class="o">=</span> <span class="n">NetworkTrainCell</span><span class="p">(</span><span class="n">network_with_cls_loss</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="n">client_optimizer</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Optimizer construction is done! Time cost: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>

    <span class="c1"># Construct data</span>
    <span class="n">input_ids</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">train_cfg</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">client_net_cfg</span><span class="o">.</span><span class="n">seq_length</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">))</span>
    <span class="n">attention_mask</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">train_cfg</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">client_net_cfg</span><span class="o">.</span><span class="n">seq_length</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">))</span>
    <span class="n">token_type_ids</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">train_cfg</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">client_net_cfg</span><span class="o">.</span><span class="n">seq_length</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">))</span>
    <span class="n">label_ids</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">train_cfg</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,),</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Client data loading is done! Time cost: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>

    <span class="c1"># Read checkpoint</span>
    <span class="k">if</span> <span class="n">init_model_path</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
        <span class="n">init_param_dict</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">load_checkpoint</span><span class="p">(</span><span class="n">init_model_path</span><span class="p">)</span>
        <span class="n">restore_params</span><span class="p">(</span><span class="n">client_network_train_cell</span><span class="p">,</span> <span class="n">init_param_dict</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Checkpoint loading is done! Time cost: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>

    <span class="c1"># Export</span>
    <span class="n">ms</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">client_network_train_cell</span><span class="p">,</span> <span class="n">input_ids</span><span class="p">,</span> <span class="n">attention_mask</span><span class="p">,</span> <span class="n">token_type_ids</span><span class="p">,</span> <span class="n">label_ids</span><span class="p">,</span>
           <span class="n">file_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s1">&#39;albert_supervise&#39;</span><span class="p">),</span> <span class="n">file_format</span><span class="o">=</span><span class="s1">&#39;MINDIR&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Supervise model export process is done! Time cost: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">total_time_start</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parse_args</span><span class="p">()</span>
    <span class="n">supervise_export</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;All is done! Time cost: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">total_time_start</span><span class="p">))</span>

</pre></div>
</div>
</div>
<div class="section" id="converting-the-mindir-file-into-an-ms-file-that-can-be-used-by-the-federated-learning-framework-on-the-device">
<h4>Converting the MindIR File into an MS File that Can be Used by the Federated Learning Framework on the Device<a class="headerlink" href="#converting-the-mindir-file-into-an-ms-file-that-can-be-used-by-the-federated-learning-framework-on-the-device" title="Permalink to this headline">¶</a></h4>
<p>For details about how to generate a model file on the device, see <a class="reference external" href="https://www.mindspore.cn/federated/docs/en/master/image_classification_application.html">Implementing an Image Classification Application</a>.</p>
</div>
</div>
</div>
<div class="section" id="starting-the-federated-learning-process">
<h2>Starting the Federated Learning Process<a class="headerlink" href="#starting-the-federated-learning-process" title="Permalink to this headline">¶</a></h2>
<p>Start the script on the server. For details, see <a class="reference external" href="https://www.mindspore.cn/federated/docs/en/master/deploy_federated_server.html">Cloud-based Deployment</a></p>
<p>Based on the training and inference tasks of the ALBERT model, the overall process is as follows:</p>
<ol class="simple">
<li><p>Create an Android project.</p></li>
<li><p>Build the MindSpore Lite AAR package.</p></li>
<li><p>Describe the Android instance program structure.</p></li>
<li><p>Write code.</p></li>
<li><p>Configure Android project dependencies.</p></li>
<li><p>Build and run on Android.</p></li>
</ol>
<div class="section" id="creating-an-android-project">
<h3>Creating an Android Project<a class="headerlink" href="#creating-an-android-project" title="Permalink to this headline">¶</a></h3>
<p>Create a project in Android Studio and install the corresponding SDK. (After the SDK version is specified, Android Studio automatically installs the SDK.)</p>
<p><img alt="New project" src="_images/create_android_project.png" /></p>
</div>
<div class="section" id="obtaining-a-related-package">
<h3>Obtaining a Related Package<a class="headerlink" href="#obtaining-a-related-package" title="Permalink to this headline">¶</a></h3>
<ol>
<li><p>Obtain MindSpore Lite AAR package</p>
<p>For details, see <a class="reference external" href="https://www.mindspore.cn/lite/docs/en/master/use/downloads.html">Mindspore Lite</a>.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>mindspore-lite-full-{version}.aar
</pre></div>
</div>
</li>
<li><p>Obtain Mindspore Federated device-side jar package</p>
<p>For details, see <a class="reference external" href="https://www.mindspore.cn/federated/docs/zh-CN/master/deploy_federated_client.html">On-Device Deployment</a>.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>mindspore_federated/device_client/build/libs/jarAAR/mindspore-lite-java-flclient.jar
</pre></div>
</div>
</li>
<li><p>Place the AAR package in the app/libs/ directory of the Android project.</p></li>
</ol>
</div>
<div class="section" id="android-instance-program-structure">
<h3>Android Instance Program Structure<a class="headerlink" href="#android-instance-program-structure" title="Permalink to this headline">¶</a></h3>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>app
│   ├── libs # Binary archive file of the Android library project
|   |   └── mindspore-lite-full-{version}.aar #  MindSpore Lite archive file of the Android version
├── src/main
│   ├── assets # Resource directory
|   |   └── model # Model directory
|   |       └── albert_ad_train.mindir.ms # Pre-trained model file
│   |       └── albert_ad_infer.mindir.ms # Inference model file
│   |   └── data # Data directory
|   |       └── 0.txt # training data file
|   |       └── vocab.txt # Dictionary file
|   |       └── vocab_map_ids.txt # Dictionary ID mapping file
|   |       └── eval.txt # Training result evaluation file
|   |       └── eval_no_label.txt # Inference data file
│   |
│   ├── java # Application code at the Java layer
│   │       └── ... Storing Android code files. Related directories can be customized.
│   │
│   ├── res # Resource files related to Android
│   └── AndroidManifest.xml # Android configuration file
│
│
├── build.gradle # Android project build file
├── download.gradle # Downloading the project dependency files
└── ...
</pre></div>
</div>
</div>
<div class="section" id="writing-code">
<h3>Writing Code<a class="headerlink" href="#writing-code" title="Permalink to this headline">¶</a></h3>
<ol>
<li><p>AssetCopyer.java: This code file is used to store the resource files in the app/src/main/assets directory of the Android project to the disk of the Android system. In this way, the federated learning framework API can read the resource files based on the absolute path during model training and inference.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">android.content.Context</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.File</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.FileOutputStream</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.InputStream</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.logging.Logger</span><span class="p">;</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AssetCopyer</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Logger</span><span class="w"> </span><span class="n">LOGGER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Logger</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">AssetCopyer</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">copyAllAssets</span><span class="p">(</span><span class="n">Context</span><span class="w"> </span><span class="n">context</span><span class="p">,</span><span class="n">String</span><span class="w"> </span><span class="n">destination</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">LOGGER</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;destination: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">destination</span><span class="p">);</span>
<span class="w">        </span><span class="n">copyAssetsToDst</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">destination</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Copy the resource files in the assets directory to the disk of the Android system. You can view the specific path by printing destination.</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">copyAssetsToDst</span><span class="p">(</span><span class="n">Context</span><span class="w"> </span><span class="n">context</span><span class="p">,</span><span class="n">String</span><span class="w"> </span><span class="n">srcPath</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">dstPath</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Recursively obtain all file names in the assets directory.</span>
<span class="w">            </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">fileNames</span><span class="w"> </span><span class="o">=</span><span class="n">context</span><span class="p">.</span><span class="na">getAssets</span><span class="p">().</span><span class="na">list</span><span class="p">(</span><span class="n">srcPath</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fileNames</span><span class="p">.</span><span class="na">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// Build the destination file object.</span>
<span class="w">                </span><span class="n">File</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">dstPath</span><span class="p">);</span>
<span class="w">                </span><span class="c1">// Create a destination directory.</span>
<span class="w">                </span><span class="n">file</span><span class="p">.</span><span class="na">mkdirs</span><span class="p">();</span>
<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">fileName</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">fileNames</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="c1">// Copy the file to the specified disk.</span>
<span class="w">                    </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">srcPath</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">copyAssetsToDst</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="n">srcPath</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">fileName</span><span class="p">,</span><span class="n">dstPath</span><span class="o">+</span><span class="s">&quot;/&quot;</span><span class="o">+</span><span class="n">fileName</span><span class="p">);</span>
<span class="w">                    </span><span class="p">}</span><span class="k">else</span><span class="p">{</span>
<span class="w">                        </span><span class="n">copyAssetsToDst</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">fileName</span><span class="p">,</span><span class="n">dstPath</span><span class="o">+</span><span class="s">&quot;/&quot;</span><span class="o">+</span><span class="n">fileName</span><span class="p">);</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// Build the input stream of the source file.</span>
<span class="w">                </span><span class="n">InputStream</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">getAssets</span><span class="p">().</span><span class="na">open</span><span class="p">(</span><span class="n">srcPath</span><span class="p">);</span>
<span class="w">                </span><span class="c1">// Build the output stream of the destination file.</span>
<span class="w">                </span><span class="n">FileOutputStream</span><span class="w"> </span><span class="n">fos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileOutputStream</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">dstPath</span><span class="p">));</span>
<span class="w">                </span><span class="c1">// Define a 1024-byte buffer array.</span>
<span class="w">                </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">byte</span><span class="o">[</span><span class="mi">1024</span><span class="o">]</span><span class="p">;</span>
<span class="w">                </span><span class="kt">int</span><span class="w"> </span><span class="n">byteCount</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="w">                </span><span class="c1">// Write the source file to the destination file.</span>
<span class="w">                </span><span class="k">while</span><span class="p">((</span><span class="n">byteCount</span><span class="o">=</span><span class="n">is</span><span class="p">.</span><span class="na">read</span><span class="p">(</span><span class="n">buffer</span><span class="p">))</span><span class="o">!=-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">fos</span><span class="p">.</span><span class="na">write</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">byteCount</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="c1">// Refresh the output stream.</span>
<span class="w">                </span><span class="n">fos</span><span class="p">.</span><span class="na">flush</span><span class="p">();</span>
<span class="w">                </span><span class="c1">// Close the input stream.</span>
<span class="w">                </span><span class="n">is</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<span class="w">                </span><span class="c1">// Close the output stream.</span>
<span class="w">                </span><span class="n">fos</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>FlJob.java: This code file is used to define training and inference tasks. For details about federated learning APIs, see <a class="reference external" href="https://www.mindspore.cn/federated/docs/en/master/interface_description_federated_client.html">federated Learning APIs</a>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">android.annotation.SuppressLint</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">android.os.Build</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">androidx.annotation.RequiresApi</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.mindspore.flAndroid.utils.AssetCopyer</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.mindspore.flclient.FLParameter</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.mindspore.flclient.SyncFLJob</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Arrays</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.UUID</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.logging.Logger</span><span class="p">;</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">FlJob</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Logger</span><span class="w"> </span><span class="n">LOGGER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Logger</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">AssetCopyer</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">parentPath</span><span class="p">;</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">FlJob</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">parentPath</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">parentPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parentPath</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Android federated learning training task</span>
<span class="w">    </span><span class="nd">@SuppressLint</span><span class="p">(</span><span class="s">&quot;NewApi&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@RequiresApi</span><span class="p">(</span><span class="n">api</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Build</span><span class="p">.</span><span class="na">VERSION_CODES</span><span class="p">.</span><span class="na">M</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">syncJobTrain</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// create dataMap</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">trainTxtPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;data/albert/supervise/client/1.txt&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">evalTxtPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;data/albert/supervise/eval/eval.txt&quot;</span><span class="p">;</span><span class="w">      </span><span class="c1">// Not necessary, if you don&#39;t need verify model accuracy after getModel, you don&#39;t need to set this parameter</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">vocabFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;data/albert/supervise/vocab.txt&quot;</span><span class="p">;</span><span class="w">                </span><span class="c1">// Path of the dictionary file for data preprocessing.</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">idsFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;data/albert/supervise/vocab_map_ids.txt&quot;</span><span class="w">   </span><span class="c1">// Path of the mapping ID file of a dictionary.</span>
<span class="w">        </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">RunType</span><span class="p">,</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">dataMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">trainPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<span class="w">        </span><span class="n">trainPath</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">trainTxtPath</span><span class="p">);</span>
<span class="w">        </span><span class="n">trainPath</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">vocabFile</span><span class="p">);</span>
<span class="w">        </span><span class="n">trainPath</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">idsFile</span><span class="p">);</span>
<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">evalPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">    </span><span class="c1">// Not necessary, if you don&#39;t need verify model accuracy after getModel, you don&#39;t need to set this parameter</span>
<span class="w">        </span><span class="n">evalPath</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">evalTxtPath</span><span class="p">);</span><span class="w">                  </span><span class="c1">// Not necessary, if you don&#39;t need verify model accuracy after getModel, you don&#39;t need to set this parameter</span>
<span class="w">        </span><span class="n">evalPath</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">vocabFile</span><span class="p">);</span><span class="w">                  </span><span class="c1">// Not necessary, if you don&#39;t need verify model accuracy after getModel, you don&#39;t need to set this parameter</span>
<span class="w">        </span><span class="n">evalPath</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">idsFile</span><span class="p">);</span><span class="w">                  </span><span class="c1">// Not necessary, if you don&#39;t need verify model accuracy after getModel, you don&#39;t need to set this parameter</span>
<span class="w">        </span><span class="n">dataMap</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">RunType</span><span class="p">.</span><span class="na">TRAINMODE</span><span class="p">,</span><span class="w"> </span><span class="n">trainPath</span><span class="p">);</span>
<span class="w">        </span><span class="n">dataMap</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">RunType</span><span class="p">.</span><span class="na">EVALMODE</span><span class="p">,</span><span class="w"> </span><span class="n">evalPath</span><span class="p">);</span><span class="w">      </span><span class="c1">// Not necessary, if you don&#39;t need verify model accuracy after getModel, you don&#39;t need to set this parameter</span>

<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">flName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;com.mindspore.flclient.demo.albert.AlbertClient&quot;</span><span class="p">;</span><span class="w">                             </span><span class="c1">// The package path of AlBertClient.java</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">trainModelPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ms/albert/train/albert_ad_train.mindir0.ms&quot;</span><span class="p">;</span><span class="w">                      </span><span class="c1">// Absolute path</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">inferModelPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ms/albert/train/albert_ad_train.mindir0.ms&quot;</span><span class="p">;</span><span class="w">                      </span><span class="c1">// Absolute path, consistent with trainModelPath</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">sslProtocol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;TLSv1.2&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">deployEnv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;android&quot;</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// The url for device-cloud communication. Ensure that the Android device can access the server. Otherwise, the message &quot;connection failed&quot; is displayed.</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">domainName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;http://10.113.216.106:6668&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="kt">boolean</span><span class="w"> </span><span class="n">ifUseElb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">serverNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">threadNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="w">        </span><span class="n">BindMode</span><span class="w"> </span><span class="n">cpuBindMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BindMode</span><span class="p">.</span><span class="na">NOT_BINDING_CORE</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">batchSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">32</span><span class="p">;</span>

<span class="w">        </span><span class="n">FLParameter</span><span class="w"> </span><span class="n">flParameter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FLParameter</span><span class="p">.</span><span class="na">getInstance</span><span class="p">();</span>
<span class="w">        </span><span class="n">flParameter</span><span class="p">.</span><span class="na">setFlName</span><span class="p">(</span><span class="n">flName</span><span class="p">);</span>
<span class="w">        </span><span class="n">flParameter</span><span class="p">.</span><span class="na">setDataMap</span><span class="p">(</span><span class="n">dataMap</span><span class="p">);</span>
<span class="w">        </span><span class="n">flParameter</span><span class="p">.</span><span class="na">setTrainModelPath</span><span class="p">(</span><span class="n">trainModelPath</span><span class="p">);</span>
<span class="w">        </span><span class="n">flParameter</span><span class="p">.</span><span class="na">setInferModelPath</span><span class="p">(</span><span class="n">inferModelPath</span><span class="p">);</span>
<span class="w">        </span><span class="n">flParameter</span><span class="p">.</span><span class="na">setSslProtocol</span><span class="p">(</span><span class="n">sslProtocol</span><span class="p">);</span>
<span class="w">        </span><span class="n">flParameter</span><span class="p">.</span><span class="na">setDeployEnv</span><span class="p">(</span><span class="n">deployEnv</span><span class="p">);</span>
<span class="w">        </span><span class="n">flParameter</span><span class="p">.</span><span class="na">setDomainName</span><span class="p">(</span><span class="n">domainName</span><span class="p">);</span>
<span class="w">        </span><span class="n">flParameter</span><span class="p">.</span><span class="na">setUseElb</span><span class="p">(</span><span class="n">ifUseElb</span><span class="p">);</span>
<span class="w">        </span><span class="n">flParameter</span><span class="p">.</span><span class="na">setServerNum</span><span class="p">(</span><span class="n">serverNum</span><span class="p">);</span>
<span class="w">        </span><span class="n">flParameter</span><span class="p">.</span><span class="na">setThreadNum</span><span class="p">(</span><span class="n">threadNum</span><span class="p">);</span>
<span class="w">        </span><span class="n">flParameter</span><span class="p">.</span><span class="na">setCpuBindMode</span><span class="p">(</span><span class="n">BindMode</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">cpuBindMode</span><span class="p">));</span>

<span class="w">        </span><span class="c1">// start FLJob</span>
<span class="w">        </span><span class="n">SyncFLJob</span><span class="w"> </span><span class="n">syncFLJob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SyncFLJob</span><span class="p">();</span>
<span class="w">        </span><span class="n">syncFLJob</span><span class="p">.</span><span class="na">flJobRun</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Android federated learning inference task</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">syncJobPredict</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// create dataMap</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">inferTxtPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;data/albert/supervise/eval/eval.txt&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">vocabFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;data/albert/supervise/vocab.txt&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">idsFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;data/albert/supervise/vocab_map_ids.txt&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">RunType</span><span class="p">,</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">dataMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">inferPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<span class="w">        </span><span class="n">inferPath</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">inferTxtPath</span><span class="p">);</span>
<span class="w">        </span><span class="n">inferPath</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">vocabFile</span><span class="p">);</span>
<span class="w">        </span><span class="n">inferPath</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">idsFile</span><span class="p">);</span>
<span class="w">        </span><span class="n">dataMap</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">RunType</span><span class="p">.</span><span class="na">INFERMODE</span><span class="p">,</span><span class="w"> </span><span class="n">inferPath</span><span class="p">);</span>

<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">flName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;com.mindspore.flclient.demo.albert.AlbertClient&quot;</span><span class="p">;</span><span class="w">                             </span><span class="c1">// The package path of AlBertClient.java</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">inferModelPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ms/albert/train/albert_ad_train.mindir0.ms&quot;</span><span class="p">;</span><span class="w">                      </span><span class="c1">// Absolute path, consistent with trainModelPath</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">threadNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="w">        </span><span class="n">BindMode</span><span class="w"> </span><span class="n">cpuBindMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BindMode</span><span class="p">.</span><span class="na">NOT_BINDING_CORE</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">batchSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">32</span><span class="p">;</span>

<span class="w">        </span><span class="n">FLParameter</span><span class="w"> </span><span class="n">flParameter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FLParameter</span><span class="p">.</span><span class="na">getInstance</span><span class="p">();</span>
<span class="w">        </span><span class="n">flParameter</span><span class="p">.</span><span class="na">setFlName</span><span class="p">(</span><span class="n">flName</span><span class="p">);</span>
<span class="w">        </span><span class="n">flParameter</span><span class="p">.</span><span class="na">setDataMap</span><span class="p">(</span><span class="n">dataMap</span><span class="p">);</span>
<span class="w">        </span><span class="n">flParameter</span><span class="p">.</span><span class="na">setInferModelPath</span><span class="p">(</span><span class="n">inferModelPath</span><span class="p">);</span>
<span class="w">        </span><span class="n">flParameter</span><span class="p">.</span><span class="na">setThreadNum</span><span class="p">(</span><span class="n">threadNum</span><span class="p">);</span>
<span class="w">        </span><span class="n">flParameter</span><span class="p">.</span><span class="na">setCpuBindMode</span><span class="p">(</span><span class="n">cpuBindMode</span><span class="p">);</span>
<span class="w">        </span><span class="n">flParameter</span><span class="p">.</span><span class="na">setBatchSize</span><span class="p">(</span><span class="n">batchSize</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// inference</span>
<span class="w">        </span><span class="n">SyncFLJob</span><span class="w"> </span><span class="n">syncFLJob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SyncFLJob</span><span class="p">();</span>
<span class="w">        </span><span class="kt">int</span><span class="o">[]</span><span class="w"> </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">syncFLJob</span><span class="p">.</span><span class="na">modelInference</span><span class="p">();</span>
<span class="w">        </span><span class="n">LOGGER</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;labels = &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">toString</span><span class="p">(</span><span class="n">labels</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The above eval_no_label.txt refers to a file where no label exists, with one statement per line. The format reference is as follows, which the user is free to set:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>愿以吾辈之青春 护卫这盛世之中华🇨🇳
girls help girls
太美了，祝祖国繁荣昌盛！
中国人民站起来了
难道就我一个人觉得这个是plus版本？
被安利到啦！明天起来就看！早点睡觉莲莲
</pre></div>
</div>
</li>
<li><p>MainActivity.java: This code file is used to start federated learning training and inference tasks.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">android.os.Build</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">android.os.Bundle</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">androidx.annotation.RequiresApi</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">androidx.appcompat.app.AppCompatActivity</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.huawei.flAndroid.job.FlJob</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.huawei.flAndroid.utils.AssetCopyer</span><span class="p">;</span>
<span class="nd">@RequiresApi</span><span class="p">(</span><span class="n">api</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Build</span><span class="p">.</span><span class="na">VERSION_CODES</span><span class="p">.</span><span class="na">P</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MainActivity</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AppCompatActivity</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">parentPath</span><span class="p">;</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onCreate</span><span class="p">(</span><span class="n">Bundle</span><span class="w"> </span><span class="n">savedInstanceState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">super</span><span class="p">.</span><span class="na">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// Obtain the disk path of the application in the Android system.</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">parentPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">getExternalFilesDir</span><span class="p">(</span><span class="kc">null</span><span class="p">).</span><span class="na">getAbsolutePath</span><span class="p">();</span>
<span class="w">        </span><span class="c1">// Copy the resource files in the assets directory to the disk of the Android system.</span>
<span class="w">        </span><span class="n">AssetCopyer</span><span class="p">.</span><span class="na">copyAllAssets</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">getApplicationContext</span><span class="p">(),</span><span class="w"> </span><span class="n">parentPath</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// Create a thread and start the federated learning training and inference tasks.</span>
<span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">FlJob</span><span class="w"> </span><span class="n">flJob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FlJob</span><span class="p">(</span><span class="n">parentPath</span><span class="p">);</span>
<span class="w">            </span><span class="n">flJob</span><span class="p">.</span><span class="na">syncJobTrain</span><span class="p">();</span>
<span class="w">            </span><span class="n">flJob</span><span class="p">.</span><span class="na">syncJobPredict</span><span class="p">();</span>
<span class="w">        </span><span class="p">}).</span><span class="na">start</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="configuring-android-project-dependencies">
<h3>Configuring Android Project Dependencies<a class="headerlink" href="#configuring-android-project-dependencies" title="Permalink to this headline">¶</a></h3>
<ol>
<li><p>AndroidManifest.xml</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="nt">&lt;manifest</span><span class="w"> </span><span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
<span class="w">    </span><span class="na">package=</span><span class="s">&quot;com.huawei.flAndroid&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- Allow network access.--&gt;</span>
<span class="w">    </span><span class="nt">&lt;uses-permission</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;android.permission.INTERNET&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;application</span>
<span class="w">        </span><span class="na">android:allowBackup=</span><span class="s">&quot;true&quot;</span>
<span class="w">        </span><span class="na">android:supportsRtl=</span><span class="s">&quot;true&quot;</span>
<span class="w">        </span><span class="na">android:usesCleartextTraffic=</span><span class="s">&quot;true&quot;</span>
<span class="w">        </span><span class="na">android:theme=</span><span class="s">&quot;@style/Theme.Flclient&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="cm">&lt;!--Customize the location of the MainActivity file.--&gt;</span>
<span class="w">        </span><span class="nt">&lt;activity</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;com.huawei.flAndroid.activity.MainActivity&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;intent-filter&gt;</span>
<span class="w">                </span><span class="nt">&lt;action</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;android.intent.action.MAIN&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;category</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;android.intent.category.LAUNCHER&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;/intent-filter&gt;</span>
<span class="w">        </span><span class="nt">&lt;/activity&gt;</span>
<span class="w">    </span><span class="nt">&lt;/application&gt;</span>
<span class="nt">&lt;/manifest&gt;</span>
</pre></div>
</div>
</li>
<li><p>app/build.gradle</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>plugins {
    id &#39;com.android.application&#39;
}
android {
    // Android SDK build version. It is recommended that the version be later than 27.
    compileSdkVersion 30
    buildToolsVersion &quot;30.0.3&quot;
    defaultConfig {
        applicationId &quot;com.huawei.flAndroid&quot;
        minSdkVersion 27
        targetSdkVersion 30
        versionCode 1
        versionName &quot;1.0&quot;
        multiDexEnabled true
        testInstrumentationRunner &quot;androidx.test.runner.AndroidJUnitRunner&quot;
        ndk {
            // Different mobile phone models correspond to different NDKs. Mate 20 corresponds to &#39;armeabi-v7a&#39;.
            abiFilters &#39;armeabi-v7a&#39;
        }
    }
    // Specified NDK version
    ndkVersion &#39;21.3.6528147&#39;
    sourceSets{
        main {
            // Specified JNI directory
            jniLibs.srcDirs = [&#39;libs&#39;]
            jni.srcDirs = []
        }
    }
    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }
}
dependencies {
    // AAR package to be scanned in the libs directory
    implementation fileTree(dir:&#39;libs&#39;,include:[&#39;*.aar&#39;])
    implementation &#39;androidx.appcompat:appcompat:1.1.0&#39;
    implementation &#39;com.google.android.material:material:1.1.0&#39;
    implementation &#39;androidx.constraintlayout:constraintlayout:1.1.3&#39;
    androidTestImplementation &#39;androidx.test.ext:junit:1.1.1&#39;
    androidTestImplementation &#39;androidx.test.espresso:espresso-core:3.2.0&#39;
    implementation &#39;com.android.support:multidex:1.0.3&#39;

    // Add third-party open source software that federated learning relies on
    implementation group: &#39;com.squareup.okhttp3&#39;, name: &#39;okhttp&#39;, version: &#39;3.14.9&#39;
    implementation group: &#39;com.google.flatbuffers&#39;, name: &#39;flatbuffers-java&#39;, version: &#39;2.0.0&#39;
    implementation(group: &#39;org.bouncycastle&#39;,name: &#39;bcprov-jdk15on&#39;, version: &#39;1.68&#39;)
}
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="building-and-running-on-android">
<h3>Building and Running on Android<a class="headerlink" href="#building-and-running-on-android" title="Permalink to this headline">¶</a></h3>
<ol>
<li><p>Connect to the Android device and run federated learning training and inference applications. Connect to the Android device through a USB cable for debugging. Click <code class="docutils literal notranslate"><span class="pre">Run</span> <span class="pre">'app'</span></code> to run the federated learning task on your device.</p>
<p><img alt="run_app" src="_images/start_android_project.png" /></p>
</li>
<li><p>For details about how to connect the Android Studio to a device for debugging, see <a class="reference external" href="https://developer.android.com/studio/run/device">https://developer.android.com/studio/run/device</a>. Android Studio can identify the mobile phone only when USB debugging mode is enabled on the mobile phone. For Huawei phones, enable USB debugging mode by choosing Settings &gt; System &amp; updates &gt; Developer options &gt; USB debugging.</p></li>
<li><p>Continue the installation on the Android device. After the installation is complete, you can start the app to train and infer the ALBERT model for federated learning.</p></li>
<li><p>The program running result is as follows:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>I/SyncFLJob: &lt;FLClient&gt; [model inference] inference finish
I/SyncFLJob: labels = [2, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 4, 4, 4, 4]
</pre></div>
</div>
</li>
</ol>
</div>
</div>
<div class="section" id="results">
<h2>Results<a class="headerlink" href="#results" title="Permalink to this headline">¶</a></h2>
<p>The total number of federated learning iterations is 10, the number of client-side local training epochs is 1, and the batchSize is set to 16.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&lt;FLClient&gt; total acc:0.44488978
&lt;FLClient&gt; total acc:0.583166333
&lt;FLClient&gt; total acc:0.609218437
&lt;FLClient&gt; total acc:0.645290581
&lt;FLClient&gt; total acc:0.667334669
&lt;FLClient&gt; total acc:0.685370741
&lt;FLClient&gt; total acc:0.70741483
&lt;FLClient&gt; total acc:0.711422846
&lt;FLClient&gt; total acc:0.719438878
&lt;FLClient&gt; total acc:0.733466934
</pre></div>
</div>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p>[1] Lan Z, Chen M , Goodman S, et al. ALBERT: A Lite BERT for Self-supervised Learning of Language Representations[J].  2019.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="image_classification_application_in_cross_silo.html" class="btn btn-neutral float-right" title="Implementing a Cloud-Slio Federated Image Classification Application (x86)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="image_classification_application.html" class="btn btn-neutral float-left" title="Implementing an Image Classification Application of Cross-device Federated Learning (x86)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2022, MindSpore.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   
	<script async="async" src="https://cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>