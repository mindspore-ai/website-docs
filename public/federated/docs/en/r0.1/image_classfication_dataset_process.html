<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Federated Learning Image Classification Dataset Process &mdash; MindSpore master documentation</title><script>;(()=>{const e=localStorage.getItem("ms-theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;(e?"dark"===e:t)&&document.documentElement.setAttribute("data-o-theme","dark")})();</script><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script><script src="_static/jquery.js"></script>
        <script src="_static/js/theme.js"></script><script src="_static/underscore.js"></script><script src="_static/doctools.js"></script><script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Implementing an Image Classification Application of Cross-device Federated Learning (x86)" href="image_classification_application.html" />
    <link rel="prev" title="Vertical Federated Deployment" href="deploy_vfl.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> MindSpore
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Deployment</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="federated_install.html">Obtaining MindSpore Federated</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploy_federated_server.html">Horizontal Federated Cloud-based Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploy_federated_client.html">Horizontal Federated Device-side Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploy_vfl.html">Vertical Federated Deployment</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Horizontal Application</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Federated Learning Image Classification Dataset Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="image_classification_application.html">Implementing an Image Classification Application of Cross-device Federated Learning (x86)</a></li>
<li class="toctree-l1"><a class="reference internal" href="sentiment_classification_application.html">Implementing a Sentiment Classification Application (Android)</a></li>
<li class="toctree-l1"><a class="reference internal" href="image_classification_application_in_cross_silo.html">Implementing a Cloud-Slio Federated Image Classification Application (x86)</a></li>
<li class="toctree-l1"><a class="reference internal" href="object_detection_application_in_cross_silo.html">Implementing a Cross-Silo Federated Target Detection Application (x86)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Vertical Application</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="data_join.html">Vertical Federated Learning Data Access</a></li>
<li class="toctree-l1"><a class="reference internal" href="split_wnd_application.html">Vertical Federated Learning Model Training - Wide&amp;Deep Recommendation Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="split_pangu_alpha_application.html">Vertical Federated Learning Model Training - Pangu Alpha Large Model Cross-Domain Training</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Security and Privacy</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="local_differential_privacy_training_noise.html">Horizontal FL-Local Differential Privacy Perturbation Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="local_differential_privacy_training_signds.html">Horizontal FL-Local Differential Privacy SignDS training</a></li>
<li class="toctree-l1"><a class="reference internal" href="pairwise_encryption_training.html">Horizontal FL-Pairwise encryption training</a></li>
<li class="toctree-l1"><a class="reference internal" href="private_set_intersection.html">Vertical Federated-Privacy Set Intersection</a></li>
<li class="toctree-l1"><a class="reference internal" href="secure_vertical_federated_learning_with_EmbeddingDP.html">Vertical Federated-Feature Protection Based on Information Obfuscation</a></li>
<li class="toctree-l1"><a class="reference internal" href="secure_vertical_federated_learning_with_TEE.html">Vertical Federated - Feature Protection Based on Trusted Execution Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="secure_vertical_federated_learning_with_DP.html">Vertical Federated - Label Protection Based on Differential Privacy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Communication Compression</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="communication_compression.html">Device-Cloud Federated Learning Communication Compression</a></li>
<li class="toctree-l1"><a class="reference internal" href="vfl_communication_compress.html">Vertical Federated Learning Communication Compression</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Horizontal Federated API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="horizontal_server.html">Federated Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="cross_device.html">Device-side Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="horizontal/cross_silo.html">Cross-Silo</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Vertical Federated API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Data_Join.html">Data Join</a></li>
<li class="toctree-l1"><a class="reference internal" href="vertical/vertical_communicator.html">Vertical Federated Learning Communicator</a></li>
<li class="toctree-l1"><a class="reference internal" href="vertical_federated_trainer.html">Vertical Federated Trainer</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">RELEASE NOTES</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="RELEASE.html">Release Notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MindSpore</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Federated Learning Image Classification Dataset Process</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/image_classfication_dataset_process.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="federated-learning-image-classification-dataset-process">
<h1>Federated Learning Image Classification Dataset Process<a class="headerlink" href="#federated-learning-image-classification-dataset-process" title="Permalink to this headline">ÔÉÅ</a></h1>
<p><a class="reference external" href="https://gitee.com/mindspore/docs/blob/r2.0/docs/federated/docs/source_en/image_classfication_dataset_process.md"><img alt="View Source On Gitee" src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/r2.0/resource/_static/logo_source_en.png" /></a></p>
<p>This tutorial uses the federated learning dataset <code class="docutils literal notranslate"><span class="pre">FEMNIST</span></code> in the <code class="docutils literal notranslate"><span class="pre">leaf</span></code> dataset, which contains 62 different categories of handwritten digits and letters (digits 0 to 9, 26 lowercase letters, and 26 uppercase letters) with an image size of <code class="docutils literal notranslate"><span class="pre">28</span> <span class="pre">x</span> <span class="pre">28</span></code> pixels. The dataset contains handwritten digits and letters from 3500 users (up to 3500 clients can be simulated to participate in federated learning). The total data volume is 805,263, the average data volume per user is 226.83, and the variance of the data volume for all users is 88.94.</p>
<p>Refer to <a class="reference external" href="https://github.com/TalwalkarLab/leaf">leaf dataset instruction</a> to download the dataset.</p>
<ol class="arabic">
<li><p>Environmental requirements before downloading the dataset.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">numpy</span><span class="o">==</span><span class="m">1</span>.16.4
scipy<span class="w">                      </span><span class="c1"># conda install scipy</span>
<span class="nv">tensorflow</span><span class="o">==</span><span class="m">1</span>.13.1<span class="w">         </span><span class="c1"># pip install tensorflow</span>
Pillow<span class="w">                     </span><span class="c1"># pip install Pillow</span>
matplotlib<span class="w">                 </span><span class="c1"># pip install matplotlib</span>
jupyter<span class="w">                    </span><span class="c1"># conda install jupyter notebook==5.7.8 tornado==4.5.3</span>
pandas<span class="w">                     </span><span class="c1"># pip install pandas</span>
</pre></div>
</div>
</li>
<li><p>Use git to download the official dataset generation script.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/TalwalkarLab/leaf.git
</pre></div>
</div>
<p>After downloading the project, the directory structure is as follows:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>leaf/data/femnist
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span>data<span class="w">  </span><span class="c1"># Used to store the dataset generated by the command</span>
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span>preprocess<span class="w">  </span><span class="c1"># Store the code related to data pre-processing</span>
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span>preprocess.sh<span class="w">  </span><span class="c1"># shell script generated by femnist dataset</span>
<span class="w">    </span>‚îî‚îÄ‚îÄ<span class="w"> </span>README.md<span class="w">  </span><span class="c1"># Official dataset download guidance</span>
</pre></div>
</div>
</li>
<li><p>Taking <code class="docutils literal notranslate"><span class="pre">femnist</span></code> dataset as an example, run the following command to enter the specified path.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w">  </span>leaf/data/femnist
</pre></div>
</div>
</li>
<li><p>Using the command <code class="docutils literal notranslate"><span class="pre">.</span> <span class="pre">/preprocess.sh</span> <span class="pre">-s</span> <span class="pre">niid</span> <span class="pre">--sf</span> <span class="pre">1.0</span> <span class="pre">-k</span> <span class="pre">0</span> <span class="pre">-t</span> <span class="pre">sample</span></code> generates a dataset containing 3500 users, and the training sets and the test sets are divided in a ratio of 9:1 for each user‚Äôs data.</p>
<p>The meaning of the parameters in the command can be found in the <code class="docutils literal notranslate"><span class="pre">leaf/data/femnist/README.md</span></code> file.</p>
<p>The directory structure after running is as follows:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>leaf/data/femnist/35_client_sf1_data/
    ‚îú‚îÄ‚îÄ all_data  # All datasets are mixed together, without distinguishing the training sets and test sets, containing a total of 35 json files, and each json file contains the data of 100 users
    ‚îú‚îÄ‚îÄ test  # The test sets are divided into the training sets and the test sets in a ratio of 9:1 for each user&#39;s data, containing a total of 35 json files, and each json file contains the data of 100 users
    ‚îú‚îÄ‚îÄ train  # The training sets are divided into the training sets and the test sets in a ratio of 9:1 for each user&#39;s data, containing a total of 35 json files, and each json file contains the data of 100 users
    ‚îî‚îÄ‚îÄ ...  # Other documents do not need to use, and details are not described herein
</pre></div>
</div>
<p>Each json file contains the following three parts:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">users</span></code>: User list.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">num_samples</span></code>: The sample number list of each user.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">user_data</span></code>: A dictionary object with user names as key and their respective data as value. For each user, the data is represented as a list of images, with each image represented as a list of integers of size 784 (obtained by spreading the <code class="docutils literal notranslate"><span class="pre">28</span> <span class="pre">x</span> <span class="pre">28</span></code> image array).</p></li>
</ul>
<p>Before rerunning <code class="docutils literal notranslate"><span class="pre">preprocess.sh</span></code>, make sure to delete the <code class="docutils literal notranslate"><span class="pre">rem_user_data</span></code>, <code class="docutils literal notranslate"><span class="pre">sampled_data</span></code>, <code class="docutils literal notranslate"><span class="pre">test</span></code> and <code class="docutils literal notranslate"><span class="pre">train</span></code> subfolders from the data directory.</p>
</li>
<li><p>Divide the 35 json files into 3500 json files (each json file represents a user).</p>
<p>The code is as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="k">def</span> <span class="nf">mkdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">partition_json</span><span class="p">(</span><span class="n">root_path</span><span class="p">,</span> <span class="n">new_root_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    partition 35 json files to 3500 json file</span>

<span class="sd">    Each raw .json file is an object with 3 keys:</span>
<span class="sd">    1. &#39;users&#39;, a list of users</span>
<span class="sd">    2. &#39;num_samples&#39;, a list of the number of samples for each user</span>
<span class="sd">    3. &#39;user_data&#39;, an object with user names as keys and their respective data as values; for each user, data is represented as a list of images, with each image represented as a size-784 integer list (flattened from 28 by 28)</span>

<span class="sd">    Each new .json file is an object with 3 keys:</span>
<span class="sd">    1. &#39;user_name&#39;, the name of user</span>
<span class="sd">    2. &#39;num_samples&#39;, the number of samples for the user</span>
<span class="sd">    3. &#39;user_data&#39;, an dict object with &#39;x&#39; as keys and their respective data as values; with &#39;y&#39; as keys and their respective label as values;</span>

<span class="sd">    Args:</span>
<span class="sd">        root_path (str): raw root path of 35 json files</span>
<span class="sd">        new_root_path (str): new root path of 3500 json files</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">root_path</span><span class="p">)</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">file_num</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
        <span class="n">file_num</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_path</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;======== process &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_num</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; file: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;======================&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">load_f</span><span class="p">:</span>
            <span class="n">load_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">load_f</span><span class="p">)</span>
            <span class="n">users</span> <span class="o">=</span> <span class="n">load_dict</span><span class="p">[</span><span class="s1">&#39;users&#39;</span><span class="p">]</span>
            <span class="n">num_users</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">users</span><span class="p">)</span>
            <span class="n">num_samples</span> <span class="o">=</span> <span class="n">load_dict</span><span class="p">[</span><span class="s1">&#39;num_samples&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_users</span><span class="p">):</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---processing user: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;---&#39;</span><span class="p">)</span>
                <span class="n">cur_out</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;user_name&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;num_samples&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;user_data&#39;</span><span class="p">:</span> <span class="p">{}}</span>
                <span class="n">cur_user_id</span> <span class="o">=</span> <span class="n">users</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">cur_data_num</span> <span class="o">=</span> <span class="n">num_samples</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">cur_user_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_root_path</span><span class="p">,</span> <span class="n">cur_user_id</span> <span class="o">+</span> <span class="s1">&#39;.json&#39;</span><span class="p">)</span>
                <span class="n">cur_out</span><span class="p">[</span><span class="s1">&#39;user_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cur_user_id</span>
                <span class="n">cur_out</span><span class="p">[</span><span class="s1">&#39;num_samples&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cur_data_num</span>
                <span class="n">cur_out</span><span class="p">[</span><span class="s1">&#39;user_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">load_dict</span><span class="p">[</span><span class="s1">&#39;user_data&#39;</span><span class="p">][</span><span class="n">cur_user_id</span><span class="p">])</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cur_user_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">cur_out</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">new_root_path</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="s1">&#39; users have been processed!&#39;</span><span class="p">)</span>
<span class="c1"># partition train json files</span>
<span class="n">partition_json</span><span class="p">(</span><span class="s2">&quot;leaf/data/femnist/35_client_sf1_data/train&quot;</span><span class="p">,</span> <span class="s2">&quot;leaf/data/femnist/3500_client_json/train&quot;</span><span class="p">)</span>
<span class="c1"># partition test json files</span>
<span class="n">partition_json</span><span class="p">(</span><span class="s2">&quot;leaf/data/femnist/35_client_sf1_data/test&quot;</span><span class="p">,</span> <span class="s2">&quot;leaf/data/femnist/3500_client_json/test&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">root_path</span></code> is <code class="docutils literal notranslate"><span class="pre">leaf/data/femnist/35_client_sf1_data/{train,test}</span></code>. <code class="docutils literal notranslate"><span class="pre">new_root_path</span></code> is set by itself to store the generated 3500 user json files, which need to be processed separately for the training and test folders.</p>
<p>Each of the 3500 newly generated user json files contains the following three parts:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">user_name</span></code>: User name.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">num_samples</span></code>: The number of user samples</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">user_data</span></code>: A dictionary object with ‚Äòx‚Äô as key and user data as value; with ‚Äòy‚Äô as key and the label corresponding to the user data as value.</p></li>
</ul>
<p>Print the result as following after running the script, which means a successful run:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="o">========</span><span class="w"> </span>process<span class="w"> </span><span class="m">1</span><span class="w"> </span>file:<span class="w"> </span>/leaf/data/femnist/35_client_sf1_data/train/all_data_16_niid_0_keep_0_train_9.json<span class="o">======================</span>
---processing<span class="w"> </span>user:<span class="w"> </span><span class="m">1</span>---
---processing<span class="w"> </span>user:<span class="w"> </span><span class="m">2</span>---
---processing<span class="w"> </span>user:<span class="w"> </span><span class="m">3</span>---
......
</pre></div>
</div>
</li>
<li><p>Convert a json file to an image file.</p>
<p>Refer to the following codeÔºö</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="n">name_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="s1">&#39;6&#39;</span><span class="p">,</span> <span class="s1">&#39;7&#39;</span><span class="p">,</span> <span class="s1">&#39;8&#39;</span><span class="p">,</span> <span class="s1">&#39;9&#39;</span><span class="p">,</span>
             <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;J&#39;</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;U&#39;</span><span class="p">,</span>
             <span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">,</span>
             <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;j&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;l&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;q&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;u&#39;</span><span class="p">,</span>
             <span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span>
             <span class="p">]</span>

<span class="k">def</span> <span class="nf">mkdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">json_2_numpy</span><span class="p">(</span><span class="n">img_size</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    read json file to numpy</span>
<span class="sd">    Args:</span>
<span class="sd">        img_size (list): contain three elements: the height, width, channel of image</span>
<span class="sd">        file_path (str): root path of 3500 json files</span>
<span class="sd">    return:</span>
<span class="sd">        image_numpy (numpy)</span>
<span class="sd">        label_numpy (numpy)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># open json file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">load_f_train</span><span class="p">:</span>
        <span class="n">load_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">load_f_train</span><span class="p">)</span>
        <span class="n">num_samples</span> <span class="o">=</span> <span class="n">load_dict</span><span class="p">[</span><span class="s1">&#39;num_samples&#39;</span><span class="p">]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">load_dict</span><span class="p">[</span><span class="s1">&#39;user_data&#39;</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">load_dict</span><span class="p">[</span><span class="s1">&#39;user_data&#39;</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>
        <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">img_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">img_size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">img_size</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">image_numpy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>  <span class="c1"># mindspore doesn&#39;t support float64 and int64</span>
        <span class="n">label_numpy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">image_numpy</span><span class="p">,</span> <span class="n">label_numpy</span>

<span class="k">def</span> <span class="nf">json_2_img</span><span class="p">(</span><span class="n">json_path</span><span class="p">,</span> <span class="n">save_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    transform single json file to images</span>

<span class="sd">    Args:</span>
<span class="sd">        json_path (str): the path json file</span>
<span class="sd">        save_path (str): the root path to save images</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">json_2_numpy</span><span class="p">([</span><span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">json_path</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="mi">255</span>  <span class="c1"># PIL don&#39;t support the 0/1 image ,need convert to 0~255 image</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">img</span><span class="p">))</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">)</span>
        <span class="n">img_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">label</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">name_list</span><span class="p">[</span><span class="n">label</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span>
        <span class="n">path1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">label</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="n">mkdir</span><span class="p">(</span><span class="n">path1</span><span class="p">)</span>
        <span class="n">img_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path1</span><span class="p">,</span> <span class="n">img_name</span><span class="p">)</span>
        <span class="n">im</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">img_path</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-----&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;-----&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">all_json_2_img</span><span class="p">(</span><span class="n">root_path</span><span class="p">,</span> <span class="n">save_root_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    transform json files to images</span>
<span class="sd">    Args:</span>
<span class="sd">        json_path (str): the root path of 3500 json files</span>
<span class="sd">        save_path (str): the root path to save images</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">usage</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">usage</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">files_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_path</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">files_path</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">user_name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">json_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">files_path</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">save_path1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_root_path</span><span class="p">,</span> <span class="n">user_name</span><span class="p">)</span>
            <span class="n">mkdir</span><span class="p">(</span><span class="n">save_path1</span><span class="p">)</span>
            <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_path1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
            <span class="n">mkdir</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=============================&#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;=======================&#39;</span><span class="p">)</span>
            <span class="n">json_2_img</span><span class="p">(</span><span class="n">json_path</span><span class="p">,</span> <span class="n">save_path</span><span class="p">)</span>

<span class="n">all_json_2_img</span><span class="p">(</span><span class="s2">&quot;leaf/data/femnist/3500_client_json/&quot;</span><span class="p">,</span> <span class="s2">&quot;leaf/data/femnist/3500_client_img/&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Print the result as following after running the script, which means a successful run:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="o">=============================</span>f0644_19.json<span class="o">=======================</span>
-----<span class="w"> </span><span class="m">0</span><span class="w"> </span>-----
-----<span class="w"> </span><span class="m">1</span><span class="w"> </span>-----
-----<span class="w"> </span><span class="m">2</span><span class="w"> </span>-----
......
</pre></div>
</div>
</li>
<li><p>Since the dataset under some user folders is small, if the number is smaller than the batch size, random expansion is required.</p>
<p>The entire dataset <code class="docutils literal notranslate"><span class="pre">&quot;leaf/data/femnist/3500_client_img/&quot;</span></code> can be checked and expanded by referring to the following code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">choice</span>

<span class="k">def</span> <span class="nf">count_dir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">num</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">num</span>

<span class="k">def</span> <span class="nf">get_img_list</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">img_path_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">label_list</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">label_list</span><span class="p">)):</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">label_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">imgs_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
        <span class="n">imgs_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">imgs_path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">imgs_name</span><span class="p">)):</span>
            <span class="n">img_name</span> <span class="o">=</span> <span class="n">imgs_name</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">img_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">imgs_path</span><span class="p">,</span> <span class="n">img_name</span><span class="p">)</span>
            <span class="n">img_path_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">img_path_list</span>

<span class="k">def</span> <span class="nf">data_aug</span><span class="p">(</span><span class="n">data_root_path</span><span class="p">,</span> <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">32</span><span class="p">):</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">data_root_path</span><span class="p">)</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">]</span>
    <span class="n">aug_users</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">users</span><span class="p">)):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">users</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>
            <span class="n">data_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_root_path</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
            <span class="n">num_data</span> <span class="o">=</span> <span class="n">count_dir</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">num_data</span> <span class="o">&lt;</span> <span class="n">batch_size</span><span class="p">:</span>
                <span class="n">aug_users</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">user</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">tag</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;user: &quot;</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="s2">&quot; data number: &quot;</span><span class="p">,</span> <span class="n">num_data</span><span class="p">,</span> <span class="s2">&quot; &lt; &quot;</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="s2">&quot; should be aug&quot;</span><span class="p">)</span>
                <span class="n">aug_num</span> <span class="o">=</span> <span class="n">batch_size</span> <span class="o">-</span> <span class="n">num_data</span>
                <span class="n">img_path_list</span> <span class="o">=</span> <span class="n">get_img_list</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">aug_num</span><span class="p">):</span>
                    <span class="n">img_path</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">img_path_list</span><span class="p">)</span>
                    <span class="n">info</span> <span class="o">=</span> <span class="n">img_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
                    <span class="n">aug_img_path</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_aug_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.png&quot;</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">img_path</span><span class="p">,</span> <span class="n">aug_img_path</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[aug&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="s2">&quot;]&quot;</span><span class="p">,</span> <span class="s2">&quot;============= copy file:&quot;</span><span class="p">,</span> <span class="n">img_path</span><span class="p">,</span> <span class="s2">&quot;to -&gt;&quot;</span><span class="p">,</span> <span class="n">aug_img_path</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;the number of all aug users: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">aug_users</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;aug user name: &quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">aug_users</span><span class="p">)):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">aug_users</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">end</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">data_root_path</span> <span class="o">=</span> <span class="s2">&quot;leaf/data/femnist/3500_client_img/&quot;</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">32</span>
    <span class="n">data_aug</span><span class="p">(</span><span class="n">data_root_path</span><span class="p">,</span>  <span class="n">batch_size</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Convert the expanded image dataset into a bin file format usable in the Federated Learning Framework.</p>
<p>Refer to the following code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">mindspore.dataset</span> <span class="k">as</span> <span class="nn">ds</span>
<span class="kn">import</span> <span class="nn">mindspore.dataset.vision</span> <span class="k">as</span> <span class="nn">vision</span>
<span class="kn">import</span> <span class="nn">mindspore.dataset.transforms</span> <span class="k">as</span> <span class="nn">transforms</span>
<span class="kn">import</span> <span class="nn">mindspore</span>

<span class="k">def</span> <span class="nf">mkdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">count_id</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">ids</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">ids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ids</span>

<span class="k">def</span> <span class="nf">create_dataset_from_folder</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="n">img_size</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">repeat_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_parallel_workers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; create dataset for train or test</span>
<span class="sd">        Args:</span>
<span class="sd">            data_path: Data path</span>
<span class="sd">            batch_size: The number of data records in each group</span>
<span class="sd">            repeat_size: The number of replicated data records</span>
<span class="sd">            num_parallel_workers: The number of parallel workers</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="c1"># define dataset</span>
    <span class="n">ids</span> <span class="o">=</span> <span class="n">count_id</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span>
    <span class="n">mnist_ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">ImageFolderDataset</span><span class="p">(</span><span class="n">dataset_dir</span><span class="o">=</span><span class="n">data_path</span><span class="p">,</span> <span class="n">decode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">class_indexing</span><span class="o">=</span><span class="n">ids</span><span class="p">)</span>
    <span class="c1"># define operation parameters</span>
    <span class="n">resize_height</span><span class="p">,</span> <span class="n">resize_width</span> <span class="o">=</span> <span class="n">img_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">img_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># 32</span>

    <span class="n">transform</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">vision</span><span class="o">.</span><span class="n">Decode</span><span class="p">(</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">vision</span><span class="o">.</span><span class="n">Grayscale</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
        <span class="n">vision</span><span class="o">.</span><span class="n">Resize</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">resize_height</span><span class="p">,</span> <span class="n">resize_width</span><span class="p">)),</span>
        <span class="n">vision</span><span class="o">.</span><span class="n">Grayscale</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
        <span class="n">vision</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">(),</span>
    <span class="p">]</span>
    <span class="n">compose</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Compose</span><span class="p">(</span><span class="n">transform</span><span class="p">)</span>

    <span class="c1"># apply map operations on images</span>
    <span class="n">mnist_ds</span> <span class="o">=</span> <span class="n">mnist_ds</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">input_columns</span><span class="o">=</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">operations</span><span class="o">=</span><span class="n">transforms</span><span class="o">.</span><span class="n">TypeCast</span><span class="p">(</span><span class="n">mindspore</span><span class="o">.</span><span class="n">int32</span><span class="p">))</span>
    <span class="n">mnist_ds</span> <span class="o">=</span> <span class="n">mnist_ds</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">input_columns</span><span class="o">=</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="n">operations</span><span class="o">=</span><span class="n">compose</span><span class="p">)</span>

    <span class="c1"># apply DatasetOps</span>
    <span class="n">buffer_size</span> <span class="o">=</span> <span class="mi">10000</span>
    <span class="k">if</span> <span class="n">shuffle</span><span class="p">:</span>
        <span class="n">mnist_ds</span> <span class="o">=</span> <span class="n">mnist_ds</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">buffer_size</span><span class="o">=</span><span class="n">buffer_size</span><span class="p">)</span>  <span class="c1"># 10000 as in LeNet train script</span>
    <span class="n">mnist_ds</span> <span class="o">=</span> <span class="n">mnist_ds</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">drop_remainder</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">mnist_ds</span> <span class="o">=</span> <span class="n">mnist_ds</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">repeat_size</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mnist_ds</span>

<span class="k">def</span> <span class="nf">img2bin</span><span class="p">(</span><span class="n">root_path</span><span class="p">,</span> <span class="n">root_save</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    transform images to bin files</span>

<span class="sd">    Args:</span>
<span class="sd">    root_path: the root path of 3500 images files</span>
<span class="sd">    root_save: the root path to save bin files</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">use_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">train_batch_num</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">test_batch_num</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mkdir</span><span class="p">(</span><span class="n">root_save</span><span class="p">)</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">root_path</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
        <span class="n">use_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
        <span class="n">user_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_path</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
        <span class="n">train_test</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">user_path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">train_test</span><span class="p">:</span>
            <span class="n">data_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">user_path</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
            <span class="n">dataset</span> <span class="o">=</span> <span class="n">create_dataset_from_folder</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">32</span><span class="p">)</span>
            <span class="n">batch_num</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">img_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">label_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">create_dict_iterator</span><span class="p">():</span>
                <span class="n">batch_x_tensor</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">]</span>
                <span class="n">batch_y_tensor</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
                <span class="n">trans_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">batch_x_tensor</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(),</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                <span class="n">img_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trans_img</span><span class="p">)</span>
                <span class="n">label_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">batch_y_tensor</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">())</span>
                <span class="n">batch_num</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;train&quot;</span><span class="p">:</span>
                <span class="n">train_batch_num</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">batch_num</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;test&quot;</span><span class="p">:</span>
                <span class="n">test_batch_num</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">batch_num</span><span class="p">)</span>

            <span class="n">imgs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">img_list</span><span class="p">)</span>  <span class="c1"># (batch_num, 32,3,32,32)</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">label_list</span><span class="p">)</span>
            <span class="n">path1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_save</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
            <span class="n">mkdir</span><span class="p">(</span><span class="n">path1</span><span class="p">)</span>
            <span class="n">image_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path1</span><span class="p">,</span> <span class="n">user</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="s2">&quot;bn_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">batch_num</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">tag</span> <span class="o">+</span> <span class="s2">&quot;_data.bin&quot;</span><span class="p">)</span>
            <span class="n">label_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path1</span><span class="p">,</span> <span class="n">user</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="s2">&quot;bn_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">batch_num</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">tag</span> <span class="o">+</span> <span class="s2">&quot;_label.bin&quot;</span><span class="p">)</span>

            <span class="n">imgs</span><span class="o">.</span><span class="n">tofile</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">tofile</span><span class="p">(</span><span class="n">label_path</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;user: &quot;</span> <span class="o">+</span> <span class="n">user</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">tag</span> <span class="o">+</span> <span class="s2">&quot;_batch_num: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">batch_num</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;total &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">use_list</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; users finished!&quot;</span><span class="p">)</span>

<span class="n">root_path</span> <span class="o">=</span> <span class="s2">&quot;leaf/data/femnist/3500_client_img/&quot;</span>
<span class="n">root_save</span> <span class="o">=</span> <span class="s2">&quot;leaf/data/femnist/3500_clients_bin&quot;</span>
<span class="n">img2bin</span><span class="p">(</span><span class="n">root_path</span><span class="p">,</span> <span class="n">root_save</span><span class="p">)</span>
</pre></div>
</div>
<p>Print the result as following after running the script, which means a successful run:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>user:<span class="w"> </span>f0141_43<span class="w"> </span>test_batch_num:<span class="w"> </span><span class="m">1</span>
user:<span class="w"> </span>f0141_43<span class="w"> </span>train_batch_num:<span class="w"> </span><span class="m">10</span>
user:<span class="w"> </span>f0137_14<span class="w"> </span>test_batch_num:<span class="w"> </span><span class="m">1</span>
user:<span class="w"> </span>f0137_14<span class="w"> </span>train_batch_num:<span class="w"> </span><span class="m">11</span>
......
total<span class="w"> </span><span class="m">3500</span><span class="w"> </span>users<span class="w"> </span>finished!
</pre></div>
</div>
</li>
<li><p>Generate <code class="docutils literal notranslate"><span class="pre">3500_clients_bin</span></code> folder containing a total of 3500 user folders with the following directory structure:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>leaf/data/femnist/3500_clients_bin
<span class="w">  </span>‚îú‚îÄ‚îÄ<span class="w"> </span>f0000_14<span class="w">  </span><span class="c1"># User number</span>
<span class="w">  </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>f0000_14_bn_10_train_data.bin<span class="w">  </span><span class="c1"># The training data of user f0000_14 (The number 10 after bn_ represents the batch number)</span>
<span class="w">  </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>f0000_14_bn_10_train_label.bin<span class="w">  </span><span class="c1"># Training tag for user f0000_14</span>
<span class="w">  </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>f0000_14_bn_1_test_data.bin<span class="w">  </span><span class="c1"># Test data of user f0000_14 (the number 1 after bn_ represents batch number)</span>
<span class="w">  </span>‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>f0000_14_bn_1_test_label.bin<span class="w">  </span><span class="c1"># Test tag for user f0000_14</span>
<span class="w">  </span>‚îú‚îÄ‚îÄ<span class="w"> </span>f0001_41<span class="w">  </span><span class="c1"># User number</span>
<span class="w">  </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>f0001_41_bn_11_train_data.bin<span class="w">  </span><span class="c1"># The training data of user f0001_41 (The number 11 after bn_ represents the batch number)</span>
<span class="w">  </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>f0001_41_bn_11_train_label.bin<span class="w">  </span><span class="c1"># Training tag for user f0001_41</span>
<span class="w">  </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>f0001_41_bn_1_test_data.bin<span class="w">  </span><span class="c1"># Test data of user f0001_41 (the number 1 after bn_ represents batch number)</span>
<span class="w">  </span>‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>f0001_41_bn_1_test_label.bin<span class="w">  </span><span class="c1"># Test tag for user f0001_41</span>
<span class="w">  </span>‚îÇ<span class="w">                    </span>...
<span class="w">  </span>‚îî‚îÄ‚îÄ<span class="w"> </span>f4099_10<span class="w">  </span><span class="c1"># User number</span>
<span class="w">      </span>‚îú‚îÄ‚îÄ<span class="w"> </span>f4099_10_bn_4_train_data.bin<span class="w">  </span><span class="c1"># The training data of user f4099_10 (the number 4 after bn_ represents the batch number)</span>
<span class="w">      </span>‚îú‚îÄ‚îÄ<span class="w"> </span>f4099_10_bn_4_train_label.bin<span class="w">  </span><span class="c1"># Training tag for user f4099_10</span>
<span class="w">      </span>‚îú‚îÄ‚îÄ<span class="w"> </span>f4099_10_bn_1_test_data.bin<span class="w">  </span><span class="c1"># Test data of user f4099_10 (the number 1 after bn_ represents batch number)</span>
<span class="w">      </span>‚îî‚îÄ‚îÄ<span class="w"> </span>f4099_10_bn_1_test_label.bin<span class="w">  </span><span class="c1"># Test tag for user f4099_10</span>
</pre></div>
</div>
</li>
</ol>
<p>The <code class="docutils literal notranslate"><span class="pre">3500_clients_bin</span></code> folder generated according to steps 1 to 9 above can be directly used as the input data for the device-cloud federated image classification task.</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="deploy_vfl.html" class="btn btn-neutral float-left" title="Vertical Federated Deployment" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="image_classification_application.html" class="btn btn-neutral float-right" title="Implementing an Image Classification Application of Cross-device Federated Learning (x86)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, MindSpore.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 
</body>
</html>