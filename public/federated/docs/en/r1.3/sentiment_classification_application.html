<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Implementing a Sentiment Classification Application (Android) &mdash; MindSpore master documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Model Security and Privacy" href="security_and_privacy_protection.html" />
    <link rel="prev" title="Implementing an Image Classification Application (x86)" href="image_classification_application.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> MindSpore
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Deployment</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="federated_install.html">Obtaining MindSpore Federated</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploy_federated_server.html">Cloud-based Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploy_federated_client.html">On-Device Deployment</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Application</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="image_classification_application.html">Implementing an Image Classification Application (x86)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Implementing a Sentiment Classification Application (Android)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#preparations">Preparations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#environment">Environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data">Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#model-related-files">Model-related Files</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#defining-the-network">Defining the Network</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#generating-a-device-model-file">Generating a Device Model File</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#exporting-a-model-as-a-mindir-file">Exporting a Model as a MindIR File</a></li>
<li class="toctree-l4"><a class="reference internal" href="#converting-the-mindir-file-into-an-ms-file-that-can-be-used-by-the-federated-learning-framework-on-the-device">Converting the MindIR File into an MS File that Can Be Used by the Federated Learning Framework on the Device</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#starting-the-federated-learning-process">Starting the Federated Learning Process</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#creating-an-android-project">Creating an Android Project</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-the-mindspore-lite-aar-package">Building the MindSpore Lite AAR Package</a></li>
<li class="toctree-l3"><a class="reference internal" href="#android-instance-program-structure">Android Instance Program Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#writing-code">Writing Code</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuring-android-project-dependencies">Configuring Android Project Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-and-running-on-android">Building and Running on Android</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#experiment-result">Experiment Result</a></li>
<li class="toctree-l2"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Security and Privacy</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="security_and_privacy_protection.html">Model Security and Privacy</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MindSpore</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Implementing a Sentiment Classification Application (Android)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/sentiment_classification_application.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section class="tex2jax_ignore mathjax_ignore" id="implementing-a-sentiment-classification-application-android">
<h1>Implementing a Sentiment Classification Application (Android)<a class="headerlink" href="#implementing-a-sentiment-classification-application-android" title="Permalink to this headline"></a></h1>
<p><a href="https://gitee.com/mindspore/docs/blob/r1.3/docs/federated/docs/source_en/sentiment_classification_application.md" target="_blank"><img src="https://gitee.com/mindspore/docs/raw/r1.3/resource/_static/logo_source.png"></a></p>
<p>In privacy compliance scenarios, the federated learning modeling mode based on device-cloud synergy can make full use of the advantages of device data and prevent sensitive user data from being directly reported to the cloud. When exploring the application scenarios of federated learning, we notice the input method scenario. Users attach great importance to their text privacy and intelligent functions on the input method. Therefore, federated learning is naturally applicable to the input method scenario. MindSpore Federated applies the federated language model to the emoji prediction function of the input method. The federated language model recommends emojis suitable for the current context based on the chat text data. During federated learning modeling, each emoji is defined as a sentiment label category, and each chat phrase corresponds to an emoji. MindSpore Federated defines the emoji prediction task as a federated sentiment classification task.</p>
<section id="preparations">
<h2>Preparations<a class="headerlink" href="#preparations" title="Permalink to this headline"></a></h2>
<section id="environment">
<h3>Environment<a class="headerlink" href="#environment" title="Permalink to this headline"></a></h3>
<p>For details, see <a class="reference external" href="https://www.mindspore.cn/federated/docs/en/r1.3/deploy_federated_server.html">Server Environment Configuration</a> and <a class="reference external" href="https://www.mindspore.cn/federated/docs/en/r1.3/deploy_federated_client.html">Client Environment Configuration</a>.</p>
</section>
<section id="data">
<h3>Data<a class="headerlink" href="#data" title="Permalink to this headline"></a></h3>
<p>The <a class="reference external" href="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/notebook/datasets/supervise/client.tar.gz">training data</a> contains 100 user chat files. The directory structure is as follows:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>mobile/datasets/train/
├── 0.tsv  # Training data of user 0
├── 1.tsv  # Training data of user 1
│
│          ......
│
└── 99.tsv  # Training data of user 99
</pre></div>
</div>
<p>The <a class="reference external" href="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/notebook/datasets/supervise/eval.tar.gz">validation data</a> contains one chat file. The directory structure is as follows:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>mobile/datasets/eval/
├── 0.tsv  # Validation data
</pre></div>
</div>
<p>The <a class="reference external" href="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/notebook/datasets/memo.tar.gz">emoji data corresponding to labels</a> contains 107 images. The directory structure is as follows:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>mobile/datasets/memo/
├── 0.gif  # Emoji corresponding to the 0th label
├── 1.gif  # Emoji corresponding to the first label
│
│          ......
│
└── 106.gif  # Emoji corresponding to the 106th label
</pre></div>
</div>
</section>
<section id="model-related-files">
<h3>Model-related Files<a class="headerlink" href="#model-related-files" title="Permalink to this headline"></a></h3>
<p>The directory structures of the initial <a class="reference external" href="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/notebook/models/albert_init.ckpt">checkpoint</a> and <a class="reference external" href="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/notebook/datasets/vocab.txt">dictionary</a> required for generating a model are as follows:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>mobile/models/
├── albert_init.ckpt  # Initial checkpoint
└── vocab.txt  # Dictionary
</pre></div>
</div>
</section>
</section>
<section id="defining-the-network">
<h2>Defining the Network<a class="headerlink" href="#defining-the-network" title="Permalink to this headline"></a></h2>
<p>The ALBERT language model[1] is used in federated learning. The ALBERT model on the client includes the embedding layer, encoder layer, and classifier layer.</p>
<p>For details about the network definition, see <a class="reference external" href="https://gitee.com/mindspore/mindspore/tree/r1.3/tests/st/fl/mobile/src/model.py">source code</a>.</p>
<section id="generating-a-device-model-file">
<h3>Generating a Device Model File<a class="headerlink" href="#generating-a-device-model-file" title="Permalink to this headline"></a></h3>
<section id="exporting-a-model-as-a-mindir-file">
<h4>Exporting a Model as a MindIR File<a class="headerlink" href="#exporting-a-model-as-a-mindir-file" title="Permalink to this headline"></a></h4>
<p>The sample code is as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">export</span><span class="p">,</span> <span class="n">Tensor</span>
<span class="kn">from</span> <span class="nn">src.config</span> <span class="kn">import</span> <span class="n">train_cfg</span><span class="p">,</span> <span class="n">client_net_cfg</span>
<span class="kn">from</span> <span class="nn">src.cell_wrapper</span> <span class="kn">import</span> <span class="n">NetworkTrainCell</span>

<span class="c1"># Build a model.</span>
<span class="n">client_network_train_cell</span> <span class="o">=</span> <span class="n">NetworkTrainCell</span><span class="p">(</span><span class="n">client_net_cfg</span><span class="p">)</span>

<span class="c1"># Build input data.</span>
<span class="n">input_ids</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">train_cfg</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">client_net_cfg</span><span class="o">.</span><span class="n">seq_length</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">))</span>
<span class="n">attention_mask</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">train_cfg</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">client_net_cfg</span><span class="o">.</span><span class="n">seq_length</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">))</span>
<span class="n">token_type_ids</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">train_cfg</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">client_net_cfg</span><span class="o">.</span><span class="n">seq_length</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">))</span>
<span class="n">label_ids</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">train_cfg</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">client_net_cfg</span><span class="o">.</span><span class="n">num_labels</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">))</span>

<span class="c1"># Export the model.</span>
<span class="n">export</span><span class="p">(</span><span class="n">client_network_train_cell</span><span class="p">,</span> <span class="n">input_ids</span><span class="p">,</span> <span class="n">attention_mask</span><span class="p">,</span> <span class="n">token_type_ids</span><span class="p">,</span> <span class="n">label_ids</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;albert_train.mindir&#39;</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="s1">&#39;MINDIR&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="converting-the-mindir-file-into-an-ms-file-that-can-be-used-by-the-federated-learning-framework-on-the-device">
<h4>Converting the MindIR File into an MS File that Can Be Used by the Federated Learning Framework on the Device<a class="headerlink" href="#converting-the-mindir-file-into-an-ms-file-that-can-be-used-by-the-federated-learning-framework-on-the-device" title="Permalink to this headline"></a></h4>
<p>For details about how to generate a model file on the device, see <a class="reference internal" href="image_classification_application.html"><span class="doc std std-doc">Implementing an Image Classification Application</span></a>.</p>
</section>
</section>
</section>
<section id="starting-the-federated-learning-process">
<h2>Starting the Federated Learning Process<a class="headerlink" href="#starting-the-federated-learning-process" title="Permalink to this headline"></a></h2>
<p>Start the script on the server. For details, see <a class="reference external" href="https://www.mindspore.cn/federated/docs/en/r1.3/deploy_federated_server.html">Cloud-based Deployment</a></p>
<p>Based on the training and inference tasks of the ALBERT model, the overall process is as follows:</p>
<ol class="arabic simple">
<li><p>Create an Android project.</p></li>
<li><p>Build the MindSpore Lite AAR package.</p></li>
<li><p>Describe the Android instance program structure.</p></li>
<li><p>Write code.</p></li>
<li><p>Configure Android project dependencies.</p></li>
<li><p>Build and run on Android.</p></li>
</ol>
<section id="creating-an-android-project">
<h3>Creating an Android Project<a class="headerlink" href="#creating-an-android-project" title="Permalink to this headline"></a></h3>
<p>Create a project in Android Studio and install the corresponding SDK. (After the SDK version is specified, Android Studio automatically installs the SDK.)</p>
<p><img alt="New project" src="_images/create_android_project.png" /></p>
</section>
<section id="building-the-mindspore-lite-aar-package">
<h3>Building the MindSpore Lite AAR Package<a class="headerlink" href="#building-the-mindspore-lite-aar-package" title="Permalink to this headline"></a></h3>
<ul>
<li><p>For details, see <a class="reference internal" href="deploy_federated_client.html"><span class="doc std std-doc">Federated Learning Deployment</span></a>.</p></li>
<li><p>Name of the generated Android AAR package:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>mindspore-lite-&lt;version&gt;.aar
</pre></div>
</div>
</li>
<li><p>Place the AAR package in the app/libs/ directory of the Android project.</p></li>
</ul>
</section>
<section id="android-instance-program-structure">
<h3>Android Instance Program Structure<a class="headerlink" href="#android-instance-program-structure" title="Permalink to this headline"></a></h3>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>app
│   ├── libs # Binary archive file of the Android library project
|   |   └── mindspore-lite-version.aar #  MindSpore Lite archive file of the Android version
├── src/main
│   ├── assets # Resource directory
|   |   └── model # Model directory
|   |       └── albert_ad_train.mindir.ms # Pre-trained model file
│   |       └── albert_ad_infer.mindir.ms # Inference model file
│   |   └── data # Data directory
|   |       └── 140.txt # Model data file
|   |       └── vocab.txt # Dictionary file
|   |       └── vocab_map_ids.txt # Dictionary ID mapping file
|   |       └── eval.txt # Training result evaluation file
|   |       └── eval_no_label.txt # Inference data file
│   |
│   ├── java # Application code at the Java layer
│   │       └── ... Storing Android code files. Related directories can be customized.
│   │
│   ├── res # Resource files related to Android
│   └── AndroidManifest.xml # Android configuration file
│
│
├── build.gradle # Android project build file
├── download.gradle # Downloading the project dependency files
└── ...
</pre></div>
</div>
</section>
<section id="writing-code">
<h3>Writing Code<a class="headerlink" href="#writing-code" title="Permalink to this headline"></a></h3>
<ol class="arabic">
<li><p>AssetCopyer.java: This code file is used to store the resource files in the app/src/main/assets directory of the Android project to the disk of the Android system. In this way, the federated learning framework API can read the resource files based on the absolute path during model training and inference.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">android.content.Context</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.File</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.FileOutputStream</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.InputStream</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.logging.Logger</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AssetCopyer</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Logger</span><span class="w"> </span><span class="n">LOGGER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Logger</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">AssetCopyer</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">copyAllAssets</span><span class="p">(</span><span class="n">Context</span><span class="w"> </span><span class="n">context</span><span class="p">,</span><span class="n">String</span><span class="w"> </span><span class="n">destination</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">LOGGER</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;destination: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">destination</span><span class="p">);</span>
<span class="w">        </span><span class="n">copyAssetsToDst</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">destination</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Copy the resource files in the assets directory to the disk of the Android system. You can view the specific path by printing destination.</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">copyAssetsToDst</span><span class="p">(</span><span class="n">Context</span><span class="w"> </span><span class="n">context</span><span class="p">,</span><span class="n">String</span><span class="w"> </span><span class="n">srcPath</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">dstPath</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Recursively obtain all file names in the assets directory.</span>
<span class="w">            </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">fileNames</span><span class="w"> </span><span class="o">=</span><span class="n">context</span><span class="p">.</span><span class="na">getAssets</span><span class="p">().</span><span class="na">list</span><span class="p">(</span><span class="n">srcPath</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fileNames</span><span class="p">.</span><span class="na">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// Build the destination file object.</span>
<span class="w">                </span><span class="n">File</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">dstPath</span><span class="p">);</span>
<span class="w">                </span><span class="c1">// Create a destination directory.</span>
<span class="w">                </span><span class="n">file</span><span class="p">.</span><span class="na">mkdirs</span><span class="p">();</span>
<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">fileName</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">fileNames</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="c1">// Copy the file to the specified disk.</span>
<span class="w">                    </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">srcPath</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">copyAssetsToDst</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="n">srcPath</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">fileName</span><span class="p">,</span><span class="n">dstPath</span><span class="o">+</span><span class="s">&quot;/&quot;</span><span class="o">+</span><span class="n">fileName</span><span class="p">);</span>
<span class="w">                    </span><span class="p">}</span><span class="k">else</span><span class="p">{</span>
<span class="w">                        </span><span class="n">copyAssetsToDst</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">fileName</span><span class="p">,</span><span class="n">dstPath</span><span class="o">+</span><span class="s">&quot;/&quot;</span><span class="o">+</span><span class="n">fileName</span><span class="p">);</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// Build the input stream of the source file.</span>
<span class="w">                </span><span class="n">InputStream</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">getAssets</span><span class="p">().</span><span class="na">open</span><span class="p">(</span><span class="n">srcPath</span><span class="p">);</span>
<span class="w">                </span><span class="c1">// Build the output stream of the destination file.</span>
<span class="w">                </span><span class="n">FileOutputStream</span><span class="w"> </span><span class="n">fos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileOutputStream</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">dstPath</span><span class="p">));</span>
<span class="w">                </span><span class="c1">// Define a 1024-byte buffer array.</span>
<span class="w">                </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">byte</span><span class="o">[</span><span class="mi">1024</span><span class="o">]</span><span class="p">;</span>
<span class="w">                </span><span class="kt">int</span><span class="w"> </span><span class="n">byteCount</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="w">                </span><span class="c1">// Write the source file to the destination file.</span>
<span class="w">                </span><span class="k">while</span><span class="p">((</span><span class="n">byteCount</span><span class="o">=</span><span class="n">is</span><span class="p">.</span><span class="na">read</span><span class="p">(</span><span class="n">buffer</span><span class="p">))</span><span class="o">!=-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">fos</span><span class="p">.</span><span class="na">write</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">byteCount</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="c1">// Refresh the output stream.</span>
<span class="w">                </span><span class="n">fos</span><span class="p">.</span><span class="na">flush</span><span class="p">();</span>
<span class="w">                </span><span class="c1">// Close the input stream.</span>
<span class="w">                </span><span class="n">is</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<span class="w">                </span><span class="c1">// Close the output stream.</span>
<span class="w">                </span><span class="n">fos</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>FlJob.java: This code file is used to define training and inference tasks. For details about federated learning APIs, see <a class="reference external" href="https://www.mindspore.cn/federated/api/en/r1.3/interface_description_federated_client.html">Federal Learning APIs</a>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">android.annotation.SuppressLint</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">android.os.Build</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">androidx.annotation.RequiresApi</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.huawei.flAndroid.utils.AssetCopyer</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.huawei.flclient.FLParameter</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.huawei.flclient.SyncFLJob</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Arrays</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.UUID</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.logging.Logger</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">FlJob</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Logger</span><span class="w"> </span><span class="n">LOGGER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Logger</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">AssetCopyer</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">parentPath</span><span class="p">;</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">FlJob</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">parentPath</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">parentPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parentPath</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Android federated learning training task</span>
<span class="w">    </span><span class="nd">@SuppressLint</span><span class="p">(</span><span class="s">&quot;NewApi&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@RequiresApi</span><span class="p">(</span><span class="n">api</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Build</span><span class="p">.</span><span class="na">VERSION_CODES</span><span class="p">.</span><span class="na">M</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">syncJobTrain</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">trainDataset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parentPath</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/data/140.txt&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">vocal_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parentPath</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/data/vocab.txt&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">idsFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parentPath</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/data/vocab_map_ids.txt&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">testDataset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parentPath</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/data/eval.txt&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">trainModelPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parentPath</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/model/albert_ad_train.mindir.ms&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">inferModelPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parentPath</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/model/albert_ad_infer.mindir.ms&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">flName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;adbert&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// Server IP address. Ensure that the Android device can access the server. Otherwise, the message &quot;connection failed&quot; is displayed.</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">ip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;http://127.0.0.1:&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6668</span><span class="p">;</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">clientID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">().</span><span class="na">toString</span><span class="p">();</span>
<span class="w">        </span><span class="kt">boolean</span><span class="w"> </span><span class="n">useSSL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>

<span class="w">        </span><span class="n">FLParameter</span><span class="w"> </span><span class="n">flParameter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FLParameter</span><span class="p">.</span><span class="na">getInstance</span><span class="p">();</span>
<span class="w">        </span><span class="n">flParameter</span><span class="p">.</span><span class="na">setTrainDataset</span><span class="p">(</span><span class="n">trainDataset</span><span class="p">);</span>
<span class="w">        </span><span class="n">flParameter</span><span class="p">.</span><span class="na">setVocabFile</span><span class="p">(</span><span class="n">vocal_file</span><span class="p">);</span>
<span class="w">        </span><span class="n">flParameter</span><span class="p">.</span><span class="na">setIdsFile</span><span class="p">(</span><span class="n">idsFile</span><span class="p">);</span>
<span class="w">        </span><span class="n">flParameter</span><span class="p">.</span><span class="na">setTestDataset</span><span class="p">(</span><span class="n">testDataset</span><span class="p">);</span>
<span class="w">        </span><span class="n">flParameter</span><span class="p">.</span><span class="na">setFlName</span><span class="p">(</span><span class="n">flName</span><span class="p">);</span>
<span class="w">        </span><span class="n">flParameter</span><span class="p">.</span><span class="na">setTrainModelPath</span><span class="p">(</span><span class="n">trainModelPath</span><span class="p">);</span>
<span class="w">        </span><span class="n">flParameter</span><span class="p">.</span><span class="na">setInferModelPath</span><span class="p">(</span><span class="n">inferModelPath</span><span class="p">);</span>
<span class="w">        </span><span class="n">flParameter</span><span class="p">.</span><span class="na">setClientID</span><span class="p">(</span><span class="n">clientID</span><span class="p">);</span>
<span class="w">        </span><span class="n">flParameter</span><span class="p">.</span><span class="na">setIp</span><span class="p">(</span><span class="n">ip</span><span class="p">);</span>
<span class="w">        </span><span class="n">flParameter</span><span class="p">.</span><span class="na">setPort</span><span class="p">(</span><span class="n">port</span><span class="p">);</span>
<span class="w">        </span><span class="n">flParameter</span><span class="p">.</span><span class="na">setUseSSL</span><span class="p">(</span><span class="n">useSSL</span><span class="p">);</span>

<span class="w">        </span><span class="n">SyncFLJob</span><span class="w"> </span><span class="n">syncFLJob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SyncFLJob</span><span class="p">();</span>
<span class="w">        </span><span class="n">syncFLJob</span><span class="p">.</span><span class="na">flJobRun</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Android federated learning inference task</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">syncJobPredict</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">flName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;adbert&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">dataPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parentPath</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/data/eval_no_label.txt&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">vocal_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parentPath</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/data/vocab.txt&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">idsFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parentPath</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/data/vocab_map_ids.txt&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">modelPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parentPath</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/model/albert_ad_infer.mindir.ms&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">SyncFLJob</span><span class="w"> </span><span class="n">syncFLJob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SyncFLJob</span><span class="p">();</span>
<span class="w">        </span><span class="kt">int</span><span class="o">[]</span><span class="w"> </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">syncFLJob</span><span class="p">.</span><span class="na">modelInference</span><span class="p">(</span><span class="n">flName</span><span class="p">,</span><span class="w"> </span><span class="n">dataPath</span><span class="p">,</span><span class="w"> </span><span class="n">vocal_file</span><span class="p">,</span><span class="w"> </span><span class="n">idsFile</span><span class="p">,</span><span class="w"> </span><span class="n">modelPath</span><span class="p">);</span>
<span class="w">        </span><span class="n">LOGGER</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;labels = &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">toString</span><span class="p">(</span><span class="n">labels</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>MainActivity.java: This code file is used to start federated learning training and inference tasks.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">android.os.Build</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">android.os.Bundle</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">androidx.annotation.RequiresApi</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">androidx.appcompat.app.AppCompatActivity</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.huawei.flAndroid.job.FlJob</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.huawei.flAndroid.utils.AssetCopyer</span><span class="p">;</span>

<span class="nd">@RequiresApi</span><span class="p">(</span><span class="n">api</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Build</span><span class="p">.</span><span class="na">VERSION_CODES</span><span class="p">.</span><span class="na">P</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MainActivity</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AppCompatActivity</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">parentPath</span><span class="p">;</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onCreate</span><span class="p">(</span><span class="n">Bundle</span><span class="w"> </span><span class="n">savedInstanceState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">super</span><span class="p">.</span><span class="na">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// Obtain the disk path of the application in the Android system.</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">parentPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">getExternalFilesDir</span><span class="p">(</span><span class="kc">null</span><span class="p">).</span><span class="na">getAbsolutePath</span><span class="p">();</span>
<span class="w">        </span><span class="c1">// Copy the resource files in the assets directory to the disk of the Android system.</span>
<span class="w">        </span><span class="n">AssetCopyer</span><span class="p">.</span><span class="na">copyAllAssets</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">getApplicationContext</span><span class="p">(),</span><span class="w"> </span><span class="n">parentPath</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// Create a thread and start the federated learning training and inference tasks.</span>
<span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">FlJob</span><span class="w"> </span><span class="n">flJob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FlJob</span><span class="p">(</span><span class="n">parentPath</span><span class="p">);</span>

<span class="w">            </span><span class="n">flJob</span><span class="p">.</span><span class="na">syncJobTrain</span><span class="p">();</span>
<span class="w">            </span><span class="n">flJob</span><span class="p">.</span><span class="na">syncJobPredict</span><span class="p">();</span>
<span class="w">        </span><span class="p">}).</span><span class="na">start</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="configuring-android-project-dependencies">
<h3>Configuring Android Project Dependencies<a class="headerlink" href="#configuring-android-project-dependencies" title="Permalink to this headline"></a></h3>
<ol class="arabic">
<li><p>AndroidManifest.xml</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="nt">&lt;manifest</span><span class="w"> </span><span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
<span class="w">    </span><span class="na">package=</span><span class="s">&quot;com.huawei.flAndroid&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- Allow network access.--&gt;</span>
<span class="w">    </span><span class="nt">&lt;uses-permission</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;android.permission.INTERNET&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;application</span>
<span class="w">        </span><span class="na">android:allowBackup=</span><span class="s">&quot;true&quot;</span>
<span class="w">        </span><span class="na">android:supportsRtl=</span><span class="s">&quot;true&quot;</span>
<span class="w">        </span><span class="na">android:usesCleartextTraffic=</span><span class="s">&quot;true&quot;</span>
<span class="w">        </span><span class="na">android:theme=</span><span class="s">&quot;@style/Theme.Flclient&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="cm">&lt;!--Customize the location of the MainActivity file.--&gt;</span>
<span class="w">        </span><span class="nt">&lt;activity</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;com.huawei.flAndroid.activity.MainActivity&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;intent-filter&gt;</span>
<span class="w">                </span><span class="nt">&lt;action</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;android.intent.action.MAIN&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;category</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;android.intent.category.LAUNCHER&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;/intent-filter&gt;</span>
<span class="w">        </span><span class="nt">&lt;/activity&gt;</span>
<span class="w">    </span><span class="nt">&lt;/application&gt;</span>
<span class="nt">&lt;/manifest&gt;</span>
</pre></div>
</div>
</li>
<li><p>app/build.gradle</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>plugins {
    id &#39;com.android.application&#39;
}
android {
    // Android SDK build version. It is recommended that the version be later than 27.
    compileSdkVersion 30
    buildToolsVersion &quot;30.0.3&quot;
    defaultConfig {
        applicationId &quot;com.huawei.flAndroid&quot;
        minSdkVersion 27
        targetSdkVersion 30
        versionCode 1
        versionName &quot;1.0&quot;
        multiDexEnabled true
        testInstrumentationRunner &quot;androidx.test.runner.AndroidJUnitRunner&quot;
        ndk {
            // Different mobile phone models correspond to different NDKs. Mate 20 corresponds to &#39;armeabi-v7a&#39;.
            abiFilters &#39;armeabi-v7a&#39;
        }
    }
    // Specified NDK version
    ndkVersion &#39;21.3.6528147&#39;
    sourceSets{
        main {
            // Specified JNI directory
            jniLibs.srcDirs = [&#39;libs&#39;]
            jni.srcDirs = []
        }
    }
    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }
}
dependencies {
    // AAR package to be scanned in the libs directory
    implementation fileTree(dir:&#39;libs&#39;,include:[&#39;*.aar&#39;])
    implementation &#39;androidx.appcompat:appcompat:1.1.0&#39;
    implementation &#39;com.google.android.material:material:1.1.0&#39;
    implementation &#39;androidx.constraintlayout:constraintlayout:1.1.3&#39;
    androidTestImplementation &#39;androidx.test.ext:junit:1.1.1&#39;
    androidTestImplementation &#39;androidx.test.espresso:espresso-core:3.2.0&#39;
    implementation &#39;com.android.support:multidex:1.0.3&#39;
}
</pre></div>
</div>
</li>
</ol>
</section>
<section id="building-and-running-on-android">
<h3>Building and Running on Android<a class="headerlink" href="#building-and-running-on-android" title="Permalink to this headline"></a></h3>
<ol class="arabic">
<li><p>Connect to the Android device and run federated learning training and inference applications. Connect to the Android device through a USB cable for debugging. Click <code class="docutils literal notranslate"><span class="pre">Run</span> <span class="pre">'app'</span></code> to run the federated learning task on your device.</p>
<p><img alt="run_app" src="_images/start_android_project.png" /></p>
</li>
<li><p>For details about how to connect the Android Studio to a device for debugging, see <a class="reference external" href="https://developer.android.com/studio/run/device">https://developer.android.com/studio/run/device</a>. Android Studio can identify the mobile phone only when USB debugging mode is enabled on the mobile phone. For Huawei phones, enable USB debugging mode by choosing Settings &gt; System &amp; updates &gt; Developer options &gt; USB debugging.</p></li>
<li><p>Continue the installation on the Android device. After the installation is complete, you can start the app to train and infer the ALBERT model for federated learning.</p></li>
<li><p>The program running result is as follows:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>I/SyncFLJob: &lt;FLClient&gt; [model inference] inference finish
I/SyncFLJob: labels = [2, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 4, 4, 4, 4]
</pre></div>
</div>
</li>
</ol>
</section>
</section>
<section id="experiment-result">
<h2>Experiment Result<a class="headerlink" href="#experiment-result" title="Permalink to this headline"></a></h2>
<p>The total number of federated learning iterations is 5, the number of epochs for local training on the client is 10, and the value of batchSize is 16.</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p>Top 1 Accuracy</p></th>
<th class="head"><p>Top 5 Accuracy</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ALBERT</p></td>
<td><p>24%</p></td>
<td><p>70%</p></td>
</tr>
</tbody>
</table>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline"></a></h2>
<p>[1] Lan Z ,  Chen M ,  Goodman S , et al. ALBERT: A Lite BERT for Self-supervised Learning of Language Representations[J].  2019.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="image_classification_application.html" class="btn btn-neutral float-left" title="Implementing an Image Classification Application (x86)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="security_and_privacy_protection.html" class="btn btn-neutral float-right" title="Model Security and Privacy" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, MindSpore.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>