<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>在MCU或小型系统上执行推理或训练 &mdash; MindSpore Lite master 文档</title><script>;(()=>{const e=localStorage.getItem("ms-theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;(e?"dark"===e:t)&&document.documentElement.setAttribute("data-o-theme","dark")})();</script><link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script><script src="../_static/jquery.js"></script>
        <script src="../_static/js/theme.js"></script><script src="../_static/underscore.js"></script><script src="../_static/doctools.js"></script><script src="../_static/js/lite.js"></script><script src="../_static/translations.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="专用芯片集成说明" href="asic.html" />
    <link rel="prev" title="使用Java接口执行推理" href="runtime_java.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> MindSpore Lite
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="在文档中搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">获取MindSpore Lite</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="downloads.html">下载MindSpore Lite</a></li>
<li class="toctree-l1"><a class="reference internal" href="build.html">编译端侧MindSpore Lite</a></li>
<li class="toctree-l1"><a class="reference internal" href="cloud_infer/build.html">编译云侧MindSpore Lite</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">快速入门</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quick_start/one_hour_introduction.html">端侧推理快速入门</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quick_start/one_hour_introduction_cloud.html">云侧推理快速入门</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">端侧推理</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../device_infer_example.html">端侧推理样例</a></li>
<li class="toctree-l1"><a class="reference internal" href="post_training_quantization.html">训练后量化</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_preprocessing.html">预处理数据</a></li>
<li class="toctree-l1"><a class="reference internal" href="runtime.html">执行推理</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">在MCU或小型系统上执行推理或训练</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#概述">概述</a></li>
<li class="toctree-l2"><a class="reference internal" href="#模型推理代码生成">模型推理代码生成</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#概述-1">概述</a></li>
<li class="toctree-l3"><a class="reference internal" href="#环境准备">环境准备</a></li>
<li class="toctree-l3"><a class="reference internal" href="#单模型生成推理代码">单模型生成推理代码</a></li>
<li class="toctree-l3"><a class="reference internal" href="#多模型生成推理代码">多模型生成推理代码</a></li>
<li class="toctree-l3"><a class="reference internal" href="#模型输入shape配置可选">模型输入shape配置(可选)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#生成多线程并行推理代码可选">生成多线程并行推理代码(可选)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#配置文件">配置文件</a></li>
<li class="toctree-l4"><a class="reference internal" href="#涉及的调用接口">涉及的调用接口</a></li>
<li class="toctree-l4"><a class="reference internal" href="#集成说明">集成说明</a></li>
<li class="toctree-l4"><a class="reference internal" href="#限制说明">限制说明</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#生成int8量化推理代码可选">生成Int8量化推理代码(可选)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#配置文件-1">配置文件</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#模型训练代码生成">模型训练代码生成</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#概述-2">概述</a></li>
<li class="toctree-l3"><a class="reference internal" href="#环境准备-1">环境准备</a></li>
<li class="toctree-l3"><a class="reference internal" href="#执行converter-lite生成推理代码">执行converter_lite生成推理代码</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#micro库获取"><code class="docutils literal notranslate"><span class="pre">Micro</span></code>库获取</a></li>
<li class="toctree-l2"><a class="reference internal" href="#代码集成及编译部署">代码集成及编译部署</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#推理代码的调用接口">推理代码的调用接口</a></li>
<li class="toctree-l3"><a class="reference internal" href="#训练代码的调用接口">训练代码的调用接口</a></li>
<li class="toctree-l3"><a class="reference internal" href="#不同的平台的集成差异">不同的平台的集成差异</a></li>
<li class="toctree-l3"><a class="reference internal" href="#多模型推理集成">多模型推理集成</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#在mcu上执行推理">在MCU上执行推理</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#概述-3">概述</a></li>
<li class="toctree-l3"><a class="reference internal" href="#生成mcu推理代码">生成MCU推理代码</a></li>
<li class="toctree-l3"><a class="reference internal" href="#下载cortex-m架构micro库">下载Cortex-M架构<code class="docutils literal notranslate"><span class="pre">Micro</span></code>库</a></li>
<li class="toctree-l3"><a class="reference internal" href="#在windows上的代码集成及编译部署-通过iar进行集成开发">在Windows上的代码集成及编译部署：通过IAR进行集成开发</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#环境准备-2">环境准备</a></li>
<li class="toctree-l4"><a class="reference internal" href="#获取mcu启动代码及工程">获取MCU启动代码及工程</a></li>
<li class="toctree-l4"><a class="reference internal" href="#集成模型推理代码及micro库">集成模型推理代码及<code class="docutils literal notranslate"><span class="pre">Micro</span></code>库</a></li>
<li class="toctree-l4"><a class="reference internal" href="#编译并仿真运行">编译并仿真运行</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#在linux上的代码集成及编译部署-通过makefile进行代码集成">在Linux上的代码集成及编译部署：通过MakeFile进行代码集成</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#环境准备-3">环境准备</a></li>
<li class="toctree-l4"><a class="reference internal" href="#获取mcu启动代码及工程-1">获取MCU启动代码及工程</a></li>
<li class="toctree-l4"><a class="reference internal" href="#集成模型推理代码">集成模型推理代码</a></li>
<li class="toctree-l4"><a class="reference internal" href="#编译工程及烧录">编译工程及烧录</a></li>
<li class="toctree-l4"><a class="reference internal" href="#推理结果验证">推理结果验证</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#在轻鸿蒙设备上执行推理">在轻鸿蒙设备上执行推理</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#轻鸿蒙编译环境准备">轻鸿蒙编译环境准备</a></li>
<li class="toctree-l3"><a class="reference internal" href="#编译模型">编译模型</a></li>
<li class="toctree-l3"><a class="reference internal" href="#编写构建脚本">编写构建脚本</a></li>
<li class="toctree-l3"><a class="reference internal" href="#编译benchmark">编译benchmark</a></li>
<li class="toctree-l3"><a class="reference internal" href="#执行benchmark">执行benchmark</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#自定义算子">自定义算子</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#用户实现自定义算子">用户实现自定义算子</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#micro推理与端侧训练结合">Micro推理与端侧训练结合</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#概述-4">概述</a></li>
<li class="toctree-l3"><a class="reference internal" href="#训练导出推理模型">训练导出推理模型</a></li>
<li class="toctree-l3"><a class="reference internal" href="#生成推理代码">生成推理代码</a></li>
<li class="toctree-l3"><a class="reference internal" href="#编译部署">编译部署</a></li>
<li class="toctree-l3"><a class="reference internal" href="#训练导出推理模型的权重">训练导出推理模型的权重</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="asic.html">专用芯片集成说明</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">端侧训练</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../device_train_example.html">端侧训练样例</a></li>
<li class="toctree-l1"><a class="reference internal" href="runtime_train.html">执行训练</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">端侧第三方接入</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="register.html">自定义算子</a></li>
<li class="toctree-l1"><a class="reference internal" href="delegate.html">使用Delegate支持第三方AI框架接入</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">端侧工具</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="converter.html">模型转换工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="benchmark.html">基准测试工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="cropper_tool.html">静态库裁剪工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="visual_tool.html">可视化工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="obfuscator_tool.html">模型混淆工具</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">云侧推理</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="cloud_infer/runtime.html">基础推理</a></li>
<li class="toctree-l1"><a class="reference internal" href="cloud_infer/runtime_parallel.html">并发推理</a></li>
<li class="toctree-l1"><a class="reference internal" href="cloud_infer/runtime_distributed.html">分布式推理</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">云侧工具</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="cloud_infer/converter.html">模型转换工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="cloud_infer/benchmark.html">基准测试工具</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">参考文档</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../architecture_lite.html">总体架构</a></li>
<li class="toctree-l1"><a class="reference internal" href="../operator_list_lite.html">Lite算子支持</a></li>
<li class="toctree-l1"><a class="reference internal" href="../operator_list_codegen.html">Codegen算子支持</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model_lite.html">模型支持</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting_guide.html">问题定位指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../log.html">日志</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">RELEASE NOTES</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../RELEASE.html">Release Notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MindSpore Lite</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>在MCU或小型系统上执行推理或训练</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/use/micro.md.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="在mcu或小型系统上执行推理或训练">
<h1>在MCU或小型系统上执行推理或训练<a class="headerlink" href="#在mcu或小型系统上执行推理或训练" title="永久链接至标题"></a></h1>
<p><a class="reference external" href="https://gitee.com/mindspore/docs/blob/master/docs/lite/docs/source_zh_cn/use/micro.md"><img alt="查看源文件" src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/master/resource/_static/logo_source.svg" /></a></p>
<section id="概述">
<h2>概述<a class="headerlink" href="#概述" title="永久链接至标题"></a></h2>
<p>本教程介绍面向IoT边缘侧设备的超轻量AI部署方案。</p>
<p>相较于移动设备，IoT设备上通常使用MicroControllerUnits(MCUs)，不仅设备系统ROM资源非常有限，而且硬件资源内存和算力都非常弱小。
因此IOT设备上的AI应用对AI模型推理的运行时内存和功耗都有严格限制。
MindSpore Lite针对MCUs部署硬件后端，提供了一种超轻量Micro AI部署解决方案：离线阶段直接将模型生成轻量化代码，不再需要在线解析模型和图编译，生成的Micro代码非常直观易懂，运行时内存小，代码体积也更小。
用户使用MindSpore Lite转换工具<code class="docutils literal notranslate"><span class="pre">converter_lite</span></code>非常容易生成可在x86/ARM64/ARM32/Cortex-M平台部署的推理或训练代码。</p>
<p>通过Micro部署一个模型进行推理或训练，通常包含以下四步：模型代码生成、<code class="docutils literal notranslate"><span class="pre">Micro</span></code>库获取、代码集成、编译部署。</p>
</section>
<section id="模型推理代码生成">
<h2>模型推理代码生成<a class="headerlink" href="#模型推理代码生成" title="永久链接至标题"></a></h2>
<section id="概述-1">
<h3>概述<a class="headerlink" href="#概述-1" title="永久链接至标题"></a></h3>
<p>通过MindSpore Lite转换工具<code class="docutils literal notranslate"><span class="pre">converter_lite</span></code>，并在转换工具的参数配置文件中，配置Micro配置项，就能为输入模型生成推理代码。
此章只介绍转换工具中生成代码的相关功能，关于转换工具的基本使用方法，请参考<a class="reference external" href="https://www.mindspore.cn/lite/docs/zh-CN/master/use/converter_tool.html">推理模型转换</a>。</p>
</section>
<section id="环境准备">
<h3>环境准备<a class="headerlink" href="#环境准备" title="永久链接至标题"></a></h3>
<p>以Linux环境下使用转换工具为例，需要进行如下环境准备。</p>
<ol class="arabic">
<li><p>转换工具运行所需的系统环境</p>
<p>本例采用Linux下的系统环境，推荐使用Ubuntu 18.04.02LTS。</p>
</li>
<li><p>获取转换工具</p>
<p>可以通过两种方式获取转换工具：</p>
<ul>
<li><p>MindSpore官网下载<a class="reference external" href="https://www.mindspore.cn/lite/docs/zh-CN/master/use/downloads.html">Release版本</a>。</p>
<p>用户需下载操作系统为Linux-x86_64，硬件平台为CPU的发布包。</p>
</li>
<li><p>从源码开始<a class="reference external" href="https://www.mindspore.cn/lite/docs/zh-CN/master/use/build.html">编译构建</a>。</p></li>
</ul>
</li>
<li><p>解压下载的包</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tar<span class="w"> </span>-zxf<span class="w"> </span>mindspore-lite-<span class="si">${</span><span class="nv">version</span><span class="si">}</span>-linux-x64.tar.gz
</pre></div>
</div>
<p>${version}是发布包的版本号。</p>
</li>
<li><p>将转换工具运行时需要的动态链接库加入环境变量LD_LIBRARY_PATH</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="si">${</span><span class="nv">PACKAGE_ROOT_PATH</span><span class="si">}</span>/tools/converter/lib:<span class="si">${</span><span class="nv">LD_LIBRARY_PATH</span><span class="si">}</span>
</pre></div>
</div>
<p>${PACKAGE_ROOT_PATH}是解压得到的文件夹路径。</p>
</li>
</ol>
</section>
<section id="单模型生成推理代码">
<h3>单模型生成推理代码<a class="headerlink" href="#单模型生成推理代码" title="永久链接至标题"></a></h3>
<ol class="arabic">
<li><p>进入转换目录</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">PACKAGE_ROOT_PATH</span><span class="si">}</span>/tools/converter/converter
</pre></div>
</div>
</li>
<li><p>设置Micro配置项</p>
<p>在当前目录下新建<code class="docutils literal notranslate"><span class="pre">micro.cfg</span></code>文件，文件内容如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[micro_param]

# enable code-generation for MCU HW

enable_micro=true

# specify HW target, support x86,Cortex-M, AMR32A, ARM64 only.

target=x86

# enable parallel inference or not.

support_parallel=false
</pre></div>
</div>
<p>配置文件中，第一行的<code class="docutils literal notranslate"><span class="pre">[micro_param]</span></code>表明后续的变量参数属于Micro配置项<code class="docutils literal notranslate"><span class="pre">micro_param</span></code>，这些参数用于控制代码生成，各参数含义如下表1所示。
本例中，我们将生成适用底层架构为x86_64的Linux系统上的单模型推理代码，故设置<code class="docutils literal notranslate"><span class="pre">target=x86</span></code>以声明生成的推理代码将用于底层架构为x86_64的Linux系统。</p>
</li>
<li><p>准备要生成推理代码的模型</p>
<p>用户可点击此处下载本例中用到的<a class="reference external" href="https://download.mindspore.cn/model_zoo/official/lite/quick_start/micro/mnist.tar.gz">MNIST手写数字识别模型</a>。
下载后，解压包，得到<code class="docutils literal notranslate"><span class="pre">mnist.tflite</span></code>，该模型为已经训练完的MNIST分类模型，为TFLITE模型。将<code class="docutils literal notranslate"><span class="pre">mnist.tflite</span></code>模型拷贝到当前所在的转换工具目录。</p>
</li>
<li><p>执行converter_lite，生成代码</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./converter_lite<span class="w"> </span>--fmk<span class="o">=</span>TFLITE<span class="w"> </span>--modelFile<span class="o">=</span>mnist.tflite<span class="w"> </span>--outputFile<span class="o">=</span>mnist<span class="w"> </span>--configFile<span class="o">=</span>micro.cfg
</pre></div>
</div>
<p>运行成功后的结果显示为：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>CONVERT RESULT SUCCESS:0
</pre></div>
</div>
<p>用户若想了解converter_lite转换工具的相关参数，可参考<a class="reference external" href="https://www.mindspore.cn/lite/docs/zh-CN/master/use/converter_tool.html#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E">converter参数说明</a>。</p>
<p>在转换工具执行成功后，生成的代码被保存在用户指定的<code class="docutils literal notranslate"><span class="pre">outputFile</span></code>路径下，在本例中，为当前转换目录下的mnist文件夹，内容如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>mnist                          # 指定的生成代码根目录名称
├── benchmark                  # 对模型推理代码进行集成调用的benchmark例程
│   ├── benchmark.c
│   ├── calib_output.c
│   ├── calib_output.h
│   ├── load_input.c
│   └── load_input.h
├── CMakeLists.txt             # benchmark例程的cmake工程文件
└── src                        # 模型推理代码目录
    ├── model0                 # 与模型相关的文件目录
       ├── model0.c
       ├── net0.bin            # 二进制形式的模型权重
       ├── net0.c
       ├── net0.h
       ├── weight0.c
       ├── weight0.h
    ├── CMakeLists.txt
    ├── allocator.c
    ├── allocator.h
    ├── net.cmake
    ├── model.c
    ├── model.h
    ├── context.c
    ├── context.h
    ├── tensor.c
    ├── tensor.h
</pre></div>
</div>
<p>生成代码中的<code class="docutils literal notranslate"><span class="pre">src</span></code>目录即为模型推理代码所在目录，<code class="docutils literal notranslate"><span class="pre">benchmark</span></code>只是对<code class="docutils literal notranslate"><span class="pre">src</span></code>目录代码进行集成调用的一个例程。
关于集成调用的更多详细说明，请参照<a class="reference internal" href="#代码集成及编译部署"><span class="std std-doc">代码集成及编译部署</span></a>章节。</p>
</li>
</ol>
<p>表1：micro_param参数定义</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>参数</p></th>
<th class="head"><p>是否必选</p></th>
<th class="head"><p>参数说明</p></th>
<th class="head"><p>取值范围</p></th>
<th class="head"><p>默认值</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>enable_micro</p></td>
<td><p>是</p></td>
<td><p>模型会生成代码，否则生成.ms</p></td>
<td><p>true, false</p></td>
<td><p>false</p></td>
</tr>
<tr class="row-odd"><td><p>target</p></td>
<td><p>是</p></td>
<td><p>生成代码针对的平台</p></td>
<td><p>x86, Cortex-M, ARM32, ARM64</p></td>
<td><p>x86</p></td>
</tr>
<tr class="row-even"><td><p>support_parallel</p></td>
<td><p>否</p></td>
<td><p>是否生成多线程推理代码，仅在x86、ARM32、ARM64平台可设置为true</p></td>
<td><p>true, false</p></td>
<td><p>false</p></td>
</tr>
<tr class="row-odd"><td><p>save_path</p></td>
<td><p>否（多模型参数）</p></td>
<td><p>多模型生成代码文件路径</p></td>
<td><p>无</p></td>
<td><p>无</p></td>
</tr>
<tr class="row-even"><td><p>project_name</p></td>
<td><p>否（多模型参数）</p></td>
<td><p>多模型生成代码工程名</p></td>
<td><p>无</p></td>
<td><p>无</p></td>
</tr>
</tbody>
</table>
</section>
<section id="多模型生成推理代码">
<h3>多模型生成推理代码<a class="headerlink" href="#多模型生成推理代码" title="永久链接至标题"></a></h3>
<ol class="arabic">
<li><p>进入转换目录</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">PACKAGE_ROOT_PATH</span><span class="si">}</span>/tools/converter/converter
</pre></div>
</div>
</li>
<li><p>设置Micro配置项</p>
<p>在当前目录下新建<code class="docutils literal notranslate"><span class="pre">micro.cfg</span></code>文件，文件内容如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[micro_param]

# enable code-generation for MCU HW

enable_micro=true

# specify HW target, support x86,Cortex-M, AMR32A, ARM64 only.

target=x86

# enable parallel inference or not.

support_parallel=false

# save generated code path.

save_path=workpath/

# set project name.

project_name=minst

[model_param]

# input model type.

fmk=TFLITE

# path of input model file.

modelFile=mnist.tflite

[model_param]

# input model type.

fmk=TFLITE

# path of input model file.

modelFile=mnist.tflite
</pre></div>
</div>
<p>配置文件中，<code class="docutils literal notranslate"><span class="pre">[micro_param]</span></code>表明后续的变量参数属于Micro配置项<code class="docutils literal notranslate"><span class="pre">micro_param</span></code>，这些参数用于控制代码生成，各参数含义如表1所示。<code class="docutils literal notranslate"><span class="pre">[model_param]</span></code>表明后续的变量参数属于对应Model配置项<code class="docutils literal notranslate"><span class="pre">model_param</span></code>，这些参数用于控制不同模型的转换，参数的范围包括<code class="docutils literal notranslate"><span class="pre">converter_lite</span></code>支持的必要参数。
本例中，我们将生成适用底层架构为x86_64的Linux系统上的多模型推理代码，故设置<code class="docutils literal notranslate"><span class="pre">target=x86</span></code>以声明生成的推理代码将用于底层架构为x86_64的Linux系统。</p>
</li>
<li><p>准备要生成推理代码的模型</p>
<p>用户可点击此处下载本例中用到的<a class="reference external" href="https://download.mindspore.cn/model_zoo/official/lite/quick_start/micro/mnist.tar.gz">MNIST手写数字识别模型</a>。
下载后，解压包，得到<code class="docutils literal notranslate"><span class="pre">mnist.tflite</span></code>，该模型为已经训练完的MNIST分类模型，为TFLITE模型。将<code class="docutils literal notranslate"><span class="pre">mnist.tflite</span></code>模型拷贝到当前所在的转换工具目录。</p>
</li>
<li><p>执行converter_lite，只需要配置config文件，生成代码</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./converter_lite<span class="w"> </span>--configFile<span class="o">=</span>micro.cfg
</pre></div>
</div>
<p>运行成功后的结果显示为：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>CONVERT RESULT SUCCESS:0
</pre></div>
</div>
<p>用户若想了解converter_lite转换工具的相关参数，可参考<a class="reference external" href="https://www.mindspore.cn/lite/docs/zh-CN/master/use/converter_tool.html#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E">converter参数说明</a>。</p>
<p>在转换工具执行成功后，生成的代码被保存在用户指定的<code class="docutils literal notranslate"><span class="pre">save_path</span></code>+<code class="docutils literal notranslate"><span class="pre">project_name</span></code>路径下，在本例中，为当前转换目录下的mnist文件夹，内容如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>mnist                          # 指定的生成代码根目录（工程）名称
├── benchmark                  # 对模型推理代码进行集成调用的benchmark例程
│   ├── benchmark.c
│   ├── calib_output.c
│   ├── calib_output.h
│   ├── load_input.c
│   └── load_input.h
├── CMakeLists.txt             # benchmark例程的cmake工程文件
├── include
    ├── model_handle.h         # 模型对外接口文件
└── src                        # 模型推理代码目录
    ├── model0                 # 第一个模型相关的文件目录
       ├── model0.c
       ├── net0.bin            # 二进制形式的模型权重
       ├── net0.c
       ├── net0.h
       ├── weight0.c
       ├── weight0.h
    ├── model1                 # 第二个模型相关的文件目录
       ├── model1.c
       ├── net1.bin
       ├── net1.c
       ├── net1.h
       ├── weight1.c
       ├── weight1.h
    ├── CMakeLists.txt
    ├── allocator.c
    ├── allocator.h
    ├── net.cmake
    ├── model.c
    ├── model.h
    ├── context.c
    ├── context.h
    ├── tensor.c
    ├── tensor.h
</pre></div>
</div>
<p>生成代码中的<code class="docutils literal notranslate"><span class="pre">src</span></code>目录即为模型推理代码所在目录，<code class="docutils literal notranslate"><span class="pre">benchmark</span></code>只是对<code class="docutils literal notranslate"><span class="pre">src</span></code>目录代码进行集成调用的一个例程，在多模型场景下，用户需根据自己的需求对<code class="docutils literal notranslate"><span class="pre">benchmark</span></code>进行微调。
关于集成调用的更多详细说明，请参照<a class="reference internal" href="#代码集成及编译部署"><span class="std std-doc">代码集成及编译部署</span></a>章节。</p>
</li>
</ol>
</section>
<section id="模型输入shape配置可选">
<h3>模型输入shape配置(可选)<a class="headerlink" href="#模型输入shape配置可选" title="永久链接至标题"></a></h3>
<p>通常在生成代码时，通过配置模型输入shape为实际推理时的输入shape，可以减少部署过程中出错的概率。
当模型含有<code class="docutils literal notranslate"><span class="pre">Shape</span></code>算子或者原模型输入shape非固定值时，必须配置模型的输入shape值，以支持相关shape优化和代码生成。
通过转换工具的<code class="docutils literal notranslate"><span class="pre">--inputShape=</span></code>命令可以配置生成代码的输入shape，具体参数含义，请参考<a class="reference external" href="https://www.mindspore.cn/lite/docs/zh-CN/master/use/converter_tool.html">转换工具使用说明</a>。</p>
</section>
<section id="生成多线程并行推理代码可选">
<h3>生成多线程并行推理代码(可选)<a class="headerlink" href="#生成多线程并行推理代码可选" title="永久链接至标题"></a></h3>
<p>在通常的Linux-x86/Android环境下，拥有多核CPU，使能Micro多线程推理能够发挥设备性能，加快模型推理速度。</p>
<section id="配置文件">
<h4>配置文件<a class="headerlink" href="#配置文件" title="永久链接至标题"></a></h4>
<p>通过在配置文件中设置support_parallel为true，将生成支持多线程推理的代码，关于配置文件各选项含义请参考表1。
一个 <code class="docutils literal notranslate"><span class="pre">x86</span></code> 的多线程代码生成配置文件的示例如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[micro_param]

# enable code-generation for MCU HW

enable_micro=true

# specify HW target, support x86,Cortex-M, AMR32A, ARM64 only.

target=x86

# enable parallel inference or not.

support_parallel=true
</pre></div>
</div>
</section>
<section id="涉及的调用接口">
<h4>涉及的调用接口<a class="headerlink" href="#涉及的调用接口" title="永久链接至标题"></a></h4>
<p>通过集成代码，并调用下述接口，用户可以配置模型的多线程推理，具体接口参数请参考<a class="reference external" href="https://www.mindspore.cn/lite/api/zh-CN/master/index.html">API文档</a>。</p>
<p>表2：多线程配置API接口</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>功能</p></th>
<th class="head"><p>函数原型</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>设置推理时线程数</p></td>
<td><p>void MSContextSetThreadNum(MSContextHandle context, int32_t thread_num)</p></td>
</tr>
<tr class="row-odd"><td><p>设置线程绑核模式</p></td>
<td><p>void MSContextSetThreadAffinityMode(MSContextHandle context, int mode)</p></td>
</tr>
<tr class="row-even"><td><p>获取推理时线程数</p></td>
<td><p>int32_t MSContextGetThreadNum(const MSContextHandle context);</p></td>
</tr>
<tr class="row-odd"><td><p>获取线程绑核模式</p></td>
<td><p>int MSContextGetThreadAffinityMode(const MSContextHandle context)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="集成说明">
<h4>集成说明<a class="headerlink" href="#集成说明" title="永久链接至标题"></a></h4>
<p>生成多线程代码后，用户需链接<code class="docutils literal notranslate"><span class="pre">pthread</span></code>标准库，以及Micro库内的<code class="docutils literal notranslate"><span class="pre">libwrapper.a</span></code>静态库。具体可参考生成代码中的<code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>文件。</p>
</section>
<section id="限制说明">
<h4>限制说明<a class="headerlink" href="#限制说明" title="永久链接至标题"></a></h4>
<p>目前该功能仅在 <code class="docutils literal notranslate"><span class="pre">target</span></code> 配置为x86/ARM32/ARM64时使能，最大可设置推理线程数为4线程。</p>
</section>
</section>
<section id="生成int8量化推理代码可选">
<h3>生成Int8量化推理代码(可选)<a class="headerlink" href="#生成int8量化推理代码可选" title="永久链接至标题"></a></h3>
<p>在Cortex-M等MCU场景下，受限于设备的内存大小及算力，通常需要使用Int8量化算子来进行部署推理以减少运行时内存大小并加速运算。</p>
<p>如果用户已经有一个Int8全量化模型，可参考<a class="reference external" href="https://www.mindspore.cn/lite/docs/zh-CN/master/use/micro.html#%E6%89%A7%E8%A1%8Cconverter-lite%E7%94%9F%E6%88%90%E6%8E%A8%E7%90%86%E4%BB%A3%E7%A0%81">执行converter_lite生成推理代码</a>章节尝试直接生成Int8量化推理代码而不需要阅读本章内容。
在通常的情况下，用户只有一个训练好的Float32模型，此时若要生成Int8量化推理代码，则需配合转换工具的后量化功能进行代码生成，具体步骤可参考下文。</p>
<section id="配置文件-1">
<h4>配置文件<a class="headerlink" href="#配置文件-1" title="永久链接至标题"></a></h4>
<p>通过在配置文件中配置量化控制参数可以实现Int8量化推理代码生成，关于量化控制参数（通用量化参数<code class="docutils literal notranslate"><span class="pre">common_quant_param</span></code>和全量化参数<code class="docutils literal notranslate"><span class="pre">full_quant_param</span></code>）的说明，请参考转换工具的<a class="reference external" href="https://www.mindspore.cn/lite/docs/zh-CN/master/use/post_training_quantization.html">训练后量化文档</a>。</p>
<p>一个 <code class="docutils literal notranslate"><span class="pre">Cortex-M</span></code> 平台的Int8量化推理代码生成配置文件的示例如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[micro_param]
# enable code-generation for MCU HW
enable_micro=true

# specify HW target, support x86,Cortex-M, ARM32, ARM64 only.
target=Cortex-M

# code generation for Inference or Train
codegen_mode=Inference

# enable parallel inference or not
support_parallel=false

[common_quant_param]
# Supports WEIGHT_QUANT or FULL_QUANT
quant_type=FULL_QUANT

# Weight quantization support the number of bits [0,16], Set to 0 is mixed bit quantization, otherwise it is fixed bit quantization
# Full quantization support the number of bits [1,8]
bit_num=8

[data_preprocess_param]

calibrate_path=inputs:/home/input_dir

calibrate_size=100

input_type=BIN

[full_quant_param]

activation_quant_method=MAX_MIN

bias_correction=true

target_device=DSP
</pre></div>
</div>
<section id="限制说明-1">
<h5>限制说明<a class="headerlink" href="#限制说明-1" title="永久链接至标题"></a></h5>
<ul class="simple">
<li><p>目前仅支持全量化的推理代码生成。</p></li>
<li><p>配置文件中全量化参数<code class="docutils literal notranslate"><span class="pre">full_quant_param</span></code>的target_device通常需设置为DSP，以支持更多的算子进行后量化。</p></li>
<li><p>目前Micro已支持34个Int8量化算子，如果在生成代码时，有相关量化算子不支持，可通过通用量化参数<code class="docutils literal notranslate"><span class="pre">common_quant_param</span></code>的<code class="docutils literal notranslate"><span class="pre">skip_quant_node</span></code>来规避该算子，被规避的算子节点仍然采用Float32推理。</p></li>
</ul>
</section>
</section>
</section>
</section>
<section id="模型训练代码生成">
<h2>模型训练代码生成<a class="headerlink" href="#模型训练代码生成" title="永久链接至标题"></a></h2>
<section id="概述-2">
<h3>概述<a class="headerlink" href="#概述-2" title="永久链接至标题"></a></h3>
<p>通过MindSpore Lite转换工具<code class="docutils literal notranslate"><span class="pre">converter_lite</span></code>，并在转换工具的参数配置文件中，配置Micro配置项，就能为输入模型生成训练代码。
此章只介绍转换工具中生成代码的相关功能，关于转换工具的基本使用方法，请参考<a class="reference external" href="https://www.mindspore.cn/lite/docs/zh-CN/master/use/converter_train.html">训练模型转换</a>。</p>
</section>
<section id="环境准备-1">
<h3>环境准备<a class="headerlink" href="#环境准备-1" title="永久链接至标题"></a></h3>
<p>环境准备小节参考<a class="reference internal" href="#环境准备"><span class="std std-doc">上文</span></a>，此处不再赘述。</p>
</section>
<section id="执行converter-lite生成推理代码">
<h3>执行converter_lite生成推理代码<a class="headerlink" href="#执行converter-lite生成推理代码" title="永久链接至标题"></a></h3>
<ol class="arabic">
<li><p>进入转换目录</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">PACKAGE_ROOT_PATH</span><span class="si">}</span>/tools/converter/converter
</pre></div>
</div>
</li>
<li><p>设置Micro配置项</p>
<p>在当前目录下新建<code class="docutils literal notranslate"><span class="pre">micro.cfg</span></code>文件，文件内容如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[micro_param]

# enable code-generation for MCU HW

enable_micro=true

# specify HW target, support x86,Cortex-M, AMR32A, ARM64 only.

target=x86

# code generation for Inference or Train. Cortex-M is unsupported when codegen_mode is Train.

codegen_mode=Train
</pre></div>
</div>
</li>
<li><p>执行converter_lite，生成代码</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./converter_lite<span class="w"> </span>--fmk<span class="o">=</span>MINDIR<span class="w"> </span>--trainModel<span class="o">=</span>True<span class="w"> </span>--modelFile<span class="o">=</span>my_model.mindir<span class="w"> </span>--outputFile<span class="o">=</span>my_model<span class="w"> </span>--configFile<span class="o">=</span>micro.cfg
</pre></div>
</div>
<p>运行成功后的结果显示为：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>CONVERT RESULT SUCCESS:0
</pre></div>
</div>
<p>在转换工具执行成功后，生成的代码被保存在用户指定的<code class="docutils literal notranslate"><span class="pre">outputFile</span></code>路径下，在本例中，为当前转换目录下的my_model文件夹，内容如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>my_model                       # 指定的生成代码根目录名称
├── benchmark                  # 对模型训练代码进行集成调用的benchmark例程
│   ├── benchmark.c
│   ├── calib_output.c
│   ├── calib_output.h
│   ├── load_input.c
│   └── load_input.h
├── CMakeLists.txt             # benchmark例程的cmake工程文件
└── src                        # 模型推理代码目录
    ├── CMakeLists.txt
    ├── net.bin                # 二进制形式的模型权重
    ├── net.c
    ├── net.cmake
    ├── net.h
    ├── model.c
    ├── context.c
    ├── context.h
    ├── tensor.c
    ├── tensor.h
    ├── weight.c
    └── weight.h
</pre></div>
</div>
<p>训练执行流程涉及的API请参考<a class="reference internal" href="#训练代码的调用接口"><span class="std std-doc">训练接口介绍</span></a></p>
</li>
</ol>
</section>
</section>
<section id="micro库获取">
<h2><code class="docutils literal notranslate"><span class="pre">Micro</span></code>库获取<a class="headerlink" href="#micro库获取" title="永久链接至标题"></a></h2>
<p>在生成模型推理代码之后，用户在对代码进行集成开发之前，需要获得生成的推理代码所依赖的<code class="docutils literal notranslate"><span class="pre">Micro</span></code>库。</p>
<p>不同平台的推理代码依赖对应平台的<code class="docutils literal notranslate"><span class="pre">Micro</span></code>库，用户需根据使用的平台，在生成代码时，通过Micro配置项<code class="docutils literal notranslate"><span class="pre">target</span></code>指定该平台，并在获取<code class="docutils literal notranslate"><span class="pre">Micro</span></code>库时，获得该平台的<code class="docutils literal notranslate"><span class="pre">Micro</span></code>库。
用户可通过MindSpore官网下载对应平台的<a class="reference external" href="https://www.mindspore.cn/lite/docs/zh-CN/master/use/downloads.html">Release版本</a>。</p>
<p>在<a class="reference internal" href="#模型推理代码生成"><span class="std std-doc">模型推理代码生成</span></a>章节，我们得到了x86_64架构Linux平台的模型推理代码，而该代码所依赖的<code class="docutils literal notranslate"><span class="pre">Micro</span></code>库，就在转换工具所使用的发布包内。
发布包内，推理代码所依赖的库和头文件如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>mindspore-lite-{version}-linux-x64
├── runtime
│   └── include
│       └── c_api            # MindSpore Lite集成开发的C API头文件
└── tools
    └── codegen # 代码生成的source code 依赖include和lib
        ├── include          # 推理框架头文件
        │   ├── nnacl        # nnacl 算子头文件
        │   └── wrapper      # wrapper 算子头文件
        ├── lib
        │   ├── libwrapper.a # MindSpore Lite codegen生成代码依赖的部分算子静态库
        │   └── libnnacl.a   # MindSpore Lite codegen生成代码依赖的nnacl算子静态库
        └── third_party
            ├── include
            │   └── CMSIS    # ARM CMSIS NN 算子头文件
            └── lib
                └── libcmsis_nn.a # ARM CMSIS NN 算子静态库
</pre></div>
</div>
</section>
<section id="代码集成及编译部署">
<h2>代码集成及编译部署<a class="headerlink" href="#代码集成及编译部署" title="永久链接至标题"></a></h2>
<p>在生成代码的<code class="docutils literal notranslate"><span class="pre">benchmark</span></code>目录中，包含了对推理代码的接口调用示例，用户可参考benchmark例程，来对<code class="docutils literal notranslate"><span class="pre">src</span></code>推理代码进行集成开发以实现自身的应用。</p>
<section id="推理代码的调用接口">
<h3>推理代码的调用接口<a class="headerlink" href="#推理代码的调用接口" title="永久链接至标题"></a></h3>
<p>以下是推理代码的一般调用接口，关于接口的详细说明，请参考<a class="reference external" href="https://www.mindspore.cn/lite/api/zh-CN/master/index.html">API文档</a>。</p>
<p>表3：推理通用API接口</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>功能</p></th>
<th class="head"><p>函数原型</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>创建 Model</p></td>
<td><p>MSModelHandle MSModelCreate()</p></td>
</tr>
<tr class="row-odd"><td><p>销毁 Model</p></td>
<td><p>void MSModelDestroy(MSModelHandle *model)</p></td>
</tr>
<tr class="row-even"><td><p>计算 Model 运行时所需的缓存大小（仅支持Cortex-M平台)</p></td>
<td><p>size_t MSModelCalcWorkspaceSize(MSModelHandle model)</p></td>
</tr>
<tr class="row-odd"><td><p>设置 Model 运行时的缓存（仅支持Cortex-M平台)</p></td>
<td><p>void MSModelSetWorkspace(MSModelHandle model, void *workspace, size_t workspace_size)</p></td>
</tr>
<tr class="row-even"><td><p>编译 Model</p></td>
<td><p>MSStatus MSModelBuild(MSModelHandle model, const void *model_data, size_t data_size, MSModelType model_type, const MSContextHandle model_context)</p></td>
</tr>
<tr class="row-odd"><td><p>推理 Model</p></td>
<td><p>MSStatus MSModelPredict(MSModelHandle model, const MSTensorHandleArray inputs, MSTensorHandleArray *outputs, const MSKernelCallBackC before, const MSKernelCallBackC after)</p></td>
</tr>
<tr class="row-even"><td><p>获取所有输入 Tensor</p></td>
<td><p>MSTensorHandleArray MSModelGetInputs(const MSModelHandle model)</p></td>
</tr>
<tr class="row-odd"><td><p>获取所有输出 Tensor</p></td>
<td><p>MSTensorHandleArray MSModelGetOutputs(const MSModelHandle model)</p></td>
</tr>
<tr class="row-even"><td><p>通过名字取输入 Tensor</p></td>
<td><p>MSTensorHandle MSModelGetInputByTensorName(const MSModelHandle model, const char *tensor_name)</p></td>
</tr>
<tr class="row-odd"><td><p>通过名字取输出 Tensor</p></td>
<td><p>MSTensorHandle MSModelGetOutputByTensorName(const MSModelHandle model, const char *tensor_name)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="训练代码的调用接口">
<h3>训练代码的调用接口<a class="headerlink" href="#训练代码的调用接口" title="永久链接至标题"></a></h3>
<p>以下是训练代码的一般调用接口。</p>
<p>表4：训练通用API接口(此处只列举训练相关接口)</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>功能</p></th>
<th class="head"><p>函数原型</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>单步执行 Model</p></td>
<td><p>MSStatus MSModelRunStep(MSModelHandle model, const MSKernelCallBackC before, const MSKernelCallBackC after)</p></td>
</tr>
<tr class="row-odd"><td><p>设置执行模式 Model</p></td>
<td><p>MSStatus MSModelSetTrainMode(MSModelHandle model, bool train)</p></td>
</tr>
<tr class="row-even"><td><p>权重导出 Model</p></td>
<td><p>MSStatus MSModelExportWeight(MSModelHandle model,const char *export_path)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="不同的平台的集成差异">
<h3>不同的平台的集成差异<a class="headerlink" href="#不同的平台的集成差异" title="永久链接至标题"></a></h3>
<p>不同的平台在代码集成和编译部署上会有不同的差异。</p>
<ul class="simple">
<li><p>对于cortex-M架构的MCU请参考<a class="reference internal" href="#在mcu上执行推理"><span class="std std-doc">在MCU上执行推理</span></a></p></li>
<li><p>对于x86_64架构Linux平台，请参考<a class="reference external" href="https://gitee.com/mindspore/mindspore/tree/master/mindspore/lite/examples/quick_start_micro/mnist_x86">Linux_x86_64平台编译部署</a></p></li>
<li><p>对于arm32或arm64的Android平台编译部署，请参考<a class="reference external" href="https://gitee.com/mindspore/mindspore/tree/master/mindspore/lite/examples/quick_start_micro/mobilenetv2_arm64">Android平台编译部署</a></p></li>
<li><p>对于在OpenHarmony平台上编译部署，请参考<a class="reference internal" href="#在轻鸿蒙设备上执行推理"><span class="std std-doc">在轻鸿蒙设备上执行推理</span></a></p></li>
</ul>
</section>
<section id="多模型推理集成">
<h3>多模型推理集成<a class="headerlink" href="#多模型推理集成" title="永久链接至标题"></a></h3>
<p>多模型集成与单模型的类似。唯有一点不同：单模型场景下，用户可通过<code class="docutils literal notranslate"><span class="pre">MSModelCreate</span></code>接口创建模型。而在多模型场景下，为用户提供了<code class="docutils literal notranslate"><span class="pre">MSModelHandle</span></code>句柄，用户可通过操纵不同模型的<code class="docutils literal notranslate"><span class="pre">MSModelHandle</span></code>句柄，调用单模型通用的推理API接口，实现对不同模型的集成，<code class="docutils literal notranslate"><span class="pre">MSModelHandle</span></code>句柄可参考多模型文件目录下的<code class="docutils literal notranslate"><span class="pre">model_handle.h</span></code>文件。</p>
</section>
</section>
<section id="在mcu上执行推理">
<h2>在MCU上执行推理<a class="headerlink" href="#在mcu上执行推理" title="永久链接至标题"></a></h2>
<section id="概述-3">
<h3>概述<a class="headerlink" href="#概述-3" title="永久链接至标题"></a></h3>
<p>本教程以<a class="reference external" href="https://download.mindspore.cn/model_zoo/official/lite/quick_start/micro/mnist.tar.gz">MNIST模型</a>在STM32F767芯片的部署为例，演示如何在Cortex-M架构的MCU上部署推理模型，主要包括以下几步：</p>
<ul>
<li><p>通过converter_lite转换工具，生成适配Cortex-M架构的模型推理代码</p></li>
<li><p>下载得到该Cortex-M架构对应的<code class="docutils literal notranslate"><span class="pre">Micro</span></code>库</p></li>
<li><p>对得到的推理代码和<code class="docutils literal notranslate"><span class="pre">Micro</span></code>库进行集成，编译并部署验证</p>
<p>在Windows平台，我们演示了如何通过IAR进行推理代码的集成开发，在Linux平台上，我们演示了如何通过MakeFile交叉编译的方式进行代码集成开发。</p>
</li>
</ul>
</section>
<section id="生成mcu推理代码">
<h3>生成MCU推理代码<a class="headerlink" href="#生成mcu推理代码" title="永久链接至标题"></a></h3>
<p>为MCU生成推理代码，请参考<a class="reference internal" href="#模型推理代码生成"><span class="std std-doc">模型推理代码生成</span></a>章节，只需将Micro配置项中的<code class="docutils literal notranslate"><span class="pre">target=x86</span></code>改为<code class="docutils literal notranslate"><span class="pre">target=Cortex-M</span></code>，就可以为MCU生成推理代码。
生成成功之后，文件夹内容如下所示：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>mnist                          # 指定的生成代码根目录名称
├── benchmark                  # 对模型推理代码进行集成调用的benchmark例程
│   ├── benchmark.c
│   ├── calib_output.c
│   ├── calib_output.h
│   ├── data.c
│   ├── data.h
│   ├── load_input.c
│   └── load_input.h
├── build.sh                   # 一键编译脚本
├── CMakeLists.txt             # benchmark例程的cmake工程文件
├── cortex-m7.toolchain.cmake  # cortex-m7的交叉编译cmake文件
└── src                        # 模型推理代码目录
    ├── CMakeLists.txt
    ├── context.c
    ├── context.h
    ├── model.c
    ├── net.c
    ├── net.cmake
    ├── net.h
    ├── tensor.c
    ├── tensor.h
    ├── weight.c
    └── weight.h
</pre></div>
</div>
</section>
<section id="下载cortex-m架构micro库">
<h3>下载Cortex-M架构<code class="docutils literal notranslate"><span class="pre">Micro</span></code>库<a class="headerlink" href="#下载cortex-m架构micro库" title="永久链接至标题"></a></h3>
<p>STM32F767芯片为Cortex-M7架构，可以通过以下两种方式获取该架构的<code class="docutils literal notranslate"><span class="pre">Micro</span></code>库：</p>
<ul>
<li><p>MindSpore官网下载<a class="reference external" href="https://www.mindspore.cn/lite/docs/zh-CN/master/use/downloads.html">Release版本</a>。</p>
<p>用户需下载操作系统为None，硬件平台为Cortex-M7的发布包。</p>
</li>
<li><p>从源码开始<a class="reference external" href="https://www.mindspore.cn/lite/docs/zh-CN/master/use/build.html">编译构建</a>。</p>
<p>用户可通过<code class="docutils literal notranslate"><span class="pre">MSLITE_MICRO_PLATFORM=cortex-m7</span> <span class="pre">bash</span> <span class="pre">build.sh</span> <span class="pre">-I</span> <span class="pre">x86_64</span></code>命令，来编译得到<code class="docutils literal notranslate"><span class="pre">Cortex-M7</span></code>的发布包。</p>
</li>
</ul>
<p>对于暂未提供发布包进行下载的其他Cortex-M架构平台，用户可参考从源码编译构建的方式，修改MindSpore源码，进行手动编译，得到发布包。</p>
</section>
<section id="在windows上的代码集成及编译部署-通过iar进行集成开发">
<h3>在Windows上的代码集成及编译部署：通过IAR进行集成开发<a class="headerlink" href="#在windows上的代码集成及编译部署-通过iar进行集成开发" title="永久链接至标题"></a></h3>
<p>本例通过IAR进行代码集成及烧录，演示如何在Windows上对生成的推理代码进行集成开发。主要分为以下几步：</p>
<ul class="simple">
<li><p>下载所需要的相关软件，做好集成的环境准备</p></li>
<li><p>通过<code class="docutils literal notranslate"><span class="pre">STM32CubeMX</span></code>软件生成所需要的MCU启动代码及演示工程</p></li>
<li><p>在<code class="docutils literal notranslate"><span class="pre">IAR</span></code>内集成模型推理代码及<code class="docutils literal notranslate"><span class="pre">Micro</span></code>库</p></li>
<li><p>编译并仿真运行</p></li>
</ul>
<section id="环境准备-2">
<h4>环境准备<a class="headerlink" href="#环境准备-2" title="永久链接至标题"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://www.st.com/en/development-tools/stm32cubemx.html">STM32CubeMX Windows版本</a> &gt;= 6.0.1</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">STM32CubeMX</span></code>是<code class="docutils literal notranslate"><span class="pre">意法半导体</span></code>提供的STM32芯片图形化配置工具，该工具用于生成STM芯片的启动代码及工程。</p></li>
</ul>
</li>
<li><p><a class="reference external" href="https://www.iar.com/ewarm">IAR EWARM</a> &gt;= 9.1</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">IAR</span> <span class="pre">EWARM</span></code>是一款IARSystems公司为ARM微处理器开发的一个集成开发环境。</p></li>
</ul>
</li>
</ul>
</section>
<section id="获取mcu启动代码及工程">
<h4>获取MCU启动代码及工程<a class="headerlink" href="#获取mcu启动代码及工程" title="永久链接至标题"></a></h4>
<p>如果用户已经有自己的MCU工程，请忽略该章节。
本章，以生成STM32F767芯片的启动工程为例，演示如何通过<code class="docutils literal notranslate"><span class="pre">STM32CubeMX</span></code>生成STM32芯片的MCU工程。</p>
<ul class="simple">
<li><p>启动<code class="docutils literal notranslate"><span class="pre">STM32CubeMX</span></code>，在<code class="docutils literal notranslate"><span class="pre">File</span></code>选项中选择<code class="docutils literal notranslate"><span class="pre">New</span> <span class="pre">Project</span></code>来新建工程。</p></li>
<li><p>在<code class="docutils literal notranslate"><span class="pre">MCU/MPU</span> <span class="pre">Selector</span></code>窗口，搜索并选择<code class="docutils literal notranslate"><span class="pre">STM32F767IGT6</span></code>，点击<code class="docutils literal notranslate"><span class="pre">Start</span> <span class="pre">Project</span></code>创建该芯片的工程。</p></li>
<li><p>在<code class="docutils literal notranslate"><span class="pre">Project</span> <span class="pre">Manager</span></code>界面，配置工程名及生成的工程路径，在<code class="docutils literal notranslate"><span class="pre">Toolchain</span> <span class="pre">/</span> <span class="pre">IDE</span></code>选项选择<code class="docutils literal notranslate"><span class="pre">EWARM</span></code>，以指定生成IAR工程。</p></li>
<li><p>点击上方的<code class="docutils literal notranslate"><span class="pre">GENERATE</span> <span class="pre">CODE</span></code>生成代码。</p></li>
<li><p>在已安装<code class="docutils literal notranslate"><span class="pre">IAR</span></code>的PC机上，双击生成工程内<code class="docutils literal notranslate"><span class="pre">EWARM</span></code>目录下的<code class="docutils literal notranslate"><span class="pre">Project.eww</span></code>即可打开该IAR工程。</p></li>
</ul>
</section>
<section id="集成模型推理代码及micro库">
<h4>集成模型推理代码及<code class="docutils literal notranslate"><span class="pre">Micro</span></code>库<a class="headerlink" href="#集成模型推理代码及micro库" title="永久链接至标题"></a></h4>
<ul>
<li><p>将生成的推理代码拷贝到工程内，并将<a class="reference internal" href="#下载cortex-m架构micro库"><span class="std std-doc">下载Cortex-M架构<code class="docutils literal notranslate"><span class="pre">Micro</span></code>库</span></a>章节获得的压缩包解压后放到生成的推理代码目录内，目录如下图所示：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>test_stm32f767                                   # MCU工程目录
├── Core
│   ├── Inc
│   └── Src
│       ├── main.c
│       └── ...
├── Drivers
├── EWARM                                        # IAR工程文件目录
└── mnist                                        # 生成代码根目录
    ├── benchmark                                # 对模型推理代码进行集成调用的benchmark例程
    │   ├── benchmark.c
    │   ├── data.c
    │   ├── data.h
    │   └── ...
    │── mindspore-lite-1.8.0-none-cortex-m7      # 下载的Cortex-M7架构`Micro`库
    ├── src                                      # 模型推理代码目录
    └── ...
</pre></div>
</div>
</li>
<li><p>向IAR工程导入源文件</p>
<p>打开IAR工程，在<code class="docutils literal notranslate"><span class="pre">Workspace</span></code>界面，右键该项目，选择<code class="docutils literal notranslate"><span class="pre">Add</span> <span class="pre">-&gt;</span> <span class="pre">Add</span> <span class="pre">Group</span></code>，添加一个<code class="docutils literal notranslate"><span class="pre">mnist</span></code>分组，右键点击该分组，重复新建分组操作，新建<code class="docutils literal notranslate"><span class="pre">src</span></code>和<code class="docutils literal notranslate"><span class="pre">benchmark</span></code>分组。
在各自分组下，选择<code class="docutils literal notranslate"><span class="pre">Add</span> <span class="pre">-&gt;</span> <span class="pre">Add</span> <span class="pre">Files</span></code>，将<code class="docutils literal notranslate"><span class="pre">mnist</span></code>文件夹内<code class="docutils literal notranslate"><span class="pre">src</span></code>和<code class="docutils literal notranslate"><span class="pre">benchmark</span></code>目录下的源文件引入各自分组。</p>
</li>
<li><p>加入依赖的头文件路径和静态库</p>
<p>在<code class="docutils literal notranslate"><span class="pre">Workspace</span></code>界面，右键该项目，选择<code class="docutils literal notranslate"><span class="pre">Options</span></code>，打开项目选项窗口。在项目选项窗口左侧选择<code class="docutils literal notranslate"><span class="pre">C/C++</span> <span class="pre">Compiler</span></code>选项，在右侧的子窗口中，选择<code class="docutils literal notranslate"><span class="pre">Preprocessor</span></code>子界面，将推理代码依赖的头文件路径加入到列表中。本例中添加的头文件路径如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$PROJ_DIR$/../mnist/mindspore-lite-1.8.0-none-cortex-m7/runtime
$PROJ_DIR$/../mnist/mindspore-lite-1.8.0-none-cortex-m7/runtime/include
$PROJ_DIR$/../mnist/mindspore-lite-1.8.0-none-cortex-m7/tools/codegen/include
$PROJ_DIR$/../mnist/mindspore-lite-1.8.0-none-cortex-m7/tools/codegen/third_party/include/CMSIS/Core
$PROJ_DIR$/../mnist/mindspore-lite-1.8.0-none-cortex-m7/tools/codegen/third_party/include/CMSIS/DSP
$PROJ_DIR$/../mnist/mindspore-lite-1.8.0-none-cortex-m7/tools/codegen/third_party/include/CMSIS/NN
$PROJ_DIR$/../mnist
</pre></div>
</div>
<p>在项目选项窗口左侧选择<code class="docutils literal notranslate"><span class="pre">Linker</span></code>选项，在右侧的子窗口中，选择<code class="docutils literal notranslate"><span class="pre">Library</span></code>子界面，将推理代码依赖的算子静态库文件加入到列表中。本例中添加的静态库文件如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$PROJ_DIR$/../mnist/mindspore-lite-1.8.0-none-cortex-m7/tools/codegen/lib/libwrapper.a
$PROJ_DIR$/../mnist/mindspore-lite-1.8.0-none-cortex-m7/tools/codegen/lib/libnnacl.a
$PROJ_DIR$/../mnist/mindspore-lite-1.8.0-none-cortex-m7/tools/codegen/third_party/lib/libcmsis_nn.a  
</pre></div>
</div>
</li>
<li><p>修改main.c文件，调用benchmark函数</p>
<p>在<code class="docutils literal notranslate"><span class="pre">main.c</span></code>开头增加头文件引用，并在main函数中调用<code class="docutils literal notranslate"><span class="pre">benchmark.c</span></code>中的<code class="docutils literal notranslate"><span class="pre">benchmark</span></code>函数，benchmark文件夹内的程序为对生成的<code class="docutils literal notranslate"><span class="pre">src</span></code>内的推理代码进行推理调用并比较输出的示范样例程序，用户可以自由对它进行修改。</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;benchmark/benchmark.h&quot;</span>
<span class="p">...</span>
<span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="p">...</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">benchmark</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">run success.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">run failed.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>修改<code class="docutils literal notranslate"><span class="pre">mnist/benchmark/data.c</span></code>文件，将标杆输入输出数据存放在程序内以进行对比</p>
<p>在benchmark例程内，会设置模型的输入数据，并将推理结果和设定的期望结果进行对比，得到误差偏移值。
在本例中，通过修改<code class="docutils literal notranslate"><span class="pre">data.c</span></code>的<code class="docutils literal notranslate"><span class="pre">calib_input0_data</span></code>数组，设置模型的输入数据，通过修改<code class="docutils literal notranslate"><span class="pre">calib_output0_data</span></code>，设定期望结果。</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">float</span><span class="w"> </span><span class="n">calib_input0_data</span><span class="p">[</span><span class="n">NET_INPUT0_SIZE</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mf">0.54881352186203</span><span class="p">,</span><span class="mf">0.7151893377304077</span><span class="p">,</span><span class="mf">0.6027633547782898</span><span class="p">,</span><span class="mf">0.5448831915855408</span><span class="p">,</span><span class="mf">0.42365479469299316</span><span class="p">,</span><span class="mf">0.6458941102027893</span><span class="p">,</span><span class="mf">0.4375872015953064</span><span class="p">,</span><span class="mf">0.891772985458374</span><span class="p">,</span><span class="mf">0.9636627435684204</span><span class="p">,</span><span class="mf">0.3834415078163147</span><span class="p">,</span><span class="mf">0.7917250394821167</span><span class="p">,</span><span class="mf">0.5288949012756348</span><span class="p">,</span><span class="mf">0.5680445432662964</span><span class="p">,</span><span class="mf">0.9255966544151306</span><span class="p">,</span><span class="mf">0.07103605568408966</span><span class="p">,</span><span class="mf">0.08712930232286453</span><span class="p">,</span><span class="mf">0.020218396559357643</span><span class="p">,</span><span class="mf">0.832619845867157</span><span class="p">,</span><span class="mf">0.7781567573547363</span><span class="p">,</span><span class="mf">0.8700121641159058</span><span class="p">,</span><span class="mf">0.978618323802948</span><span class="p">,</span><span class="mf">0.7991585731506348</span><span class="p">,</span><span class="mf">0.4614793658256531</span><span class="p">,</span><span class="mf">0.7805292010307312</span><span class="p">,</span><span class="mf">0.11827442795038223</span><span class="p">,</span><span class="mf">0.6399210095405579</span><span class="p">,</span><span class="mf">0.14335328340530396</span><span class="p">,</span><span class="mf">0.9446688890457153</span><span class="p">,</span><span class="mf">0.5218483209609985</span><span class="p">,</span><span class="mf">0.4146619439125061</span><span class="p">,</span><span class="mf">0.26455560326576233</span><span class="p">,</span><span class="mf">0.7742336988449097</span><span class="p">,</span><span class="mf">0.4561503231525421</span><span class="p">,</span><span class="mf">0.568433940410614</span><span class="p">,</span><span class="mf">0.018789799883961678</span><span class="p">,</span><span class="mf">0.6176354885101318</span><span class="p">,</span><span class="mf">0.6120957136154175</span><span class="p">,</span><span class="mf">0.6169340014457703</span><span class="p">,</span><span class="mf">0.9437480568885803</span><span class="p">,</span><span class="mf">0.681820273399353</span><span class="p">,</span><span class="mf">0.35950788855552673</span><span class="p">,</span><span class="mf">0.43703195452690125</span><span class="p">,</span><span class="mf">0.6976311802864075</span><span class="p">,</span><span class="mf">0.0602254718542099</span><span class="p">,</span><span class="mf">0.6667667031288147</span><span class="p">,</span><span class="mf">0.670637845993042</span><span class="p">,</span><span class="mf">0.21038256585597992</span><span class="p">,</span><span class="mf">0.12892629206180573</span><span class="p">,</span><span class="mf">0.31542834639549255</span><span class="p">,</span><span class="mf">0.36371076107025146</span><span class="p">,</span><span class="mf">0.5701967477798462</span><span class="p">,</span><span class="mf">0.4386015236377716</span><span class="p">,</span><span class="mf">0.9883738160133362</span><span class="p">,</span><span class="mf">0.10204481333494186</span><span class="p">,</span><span class="mf">0.20887675881385803</span><span class="p">,</span><span class="mf">0.16130951046943665</span><span class="p">,</span><span class="mf">0.6531082987785339</span><span class="p">,</span><span class="mf">0.25329160690307617</span><span class="p">,</span><span class="mf">0.4663107693195343</span><span class="p">,</span><span class="mf">0.24442559480667114</span><span class="p">,</span><span class="mf">0.15896958112716675</span><span class="p">,</span><span class="mf">0.11037514358758926</span><span class="p">,</span><span class="mf">0.6563295722007751</span><span class="p">,</span><span class="mf">0.13818295300006866</span><span class="p">,</span><span class="mf">0.1965823620557785</span><span class="p">,</span><span class="mf">0.3687251806259155</span><span class="p">,</span><span class="mf">0.8209932446479797</span><span class="p">,</span><span class="mf">0.09710127860307693</span><span class="p">,</span><span class="mf">0.8379449248313904</span><span class="p">,</span><span class="mf">0.0960984081029892</span><span class="p">,</span><span class="mf">0.9764594435691833</span><span class="p">,</span><span class="mf">0.4686512053012848</span><span class="p">,</span><span class="mf">0.9767611026763916</span><span class="p">,</span><span class="mf">0.6048455238342285</span><span class="p">,</span><span class="mf">0.7392635941505432</span><span class="p">,</span><span class="mf">0.03918779268860817</span><span class="p">,</span><span class="mf">0.28280696272850037</span><span class="p">,</span><span class="mf">0.12019655853509903</span><span class="p">,</span><span class="mf">0.296140193939209</span><span class="p">,</span><span class="mf">0.11872772127389908</span><span class="p">,</span><span class="mf">0.3179831802845001</span><span class="p">,</span><span class="mf">0.414262980222702</span><span class="p">,</span><span class="mf">0.06414749473333359</span><span class="p">,</span><span class="mf">0.6924721002578735</span><span class="p">,</span><span class="mf">0.5666014552116394</span><span class="p">,</span><span class="mf">0.26538950204849243</span><span class="p">,</span><span class="mf">0.5232480764389038</span><span class="p">,</span><span class="mf">0.09394051134586334</span><span class="p">,</span><span class="mf">0.5759465098381042</span><span class="p">,</span><span class="mf">0.9292961955070496</span><span class="p">,</span><span class="mf">0.3185689449310303</span><span class="p">,</span><span class="mf">0.6674103736877441</span><span class="p">,</span><span class="mf">0.13179786503314972</span><span class="p">,</span><span class="mf">0.7163271903991699</span><span class="p">,</span><span class="mf">0.28940609097480774</span><span class="p">,</span><span class="mf">0.18319135904312134</span><span class="p">,</span><span class="mf">0.5865129232406616</span><span class="p">,</span><span class="mf">0.02010754682123661</span><span class="p">,</span><span class="mf">0.8289400339126587</span><span class="p">,</span><span class="mf">0.004695476032793522</span><span class="p">,</span><span class="mf">0.6778165102005005</span><span class="p">,</span><span class="mf">0.2700079679489136</span><span class="p">,</span><span class="mf">0.7351940274238586</span><span class="p">,</span><span class="mf">0.9621885418891907</span><span class="p">,</span><span class="mf">0.2487531453371048</span><span class="p">,</span><span class="mf">0.5761573314666748</span><span class="p">,</span><span class="mf">0.5920419096946716</span><span class="p">,</span><span class="mf">0.5722519159317017</span><span class="p">,</span><span class="mf">0.22308163344860077</span><span class="p">,</span><span class="mf">0.9527490139007568</span><span class="p">,</span><span class="mf">0.4471253752708435</span><span class="p">,</span><span class="mf">0.8464086651802063</span><span class="p">,</span><span class="mf">0.6994792819023132</span><span class="p">,</span><span class="mf">0.2974369525909424</span><span class="p">,</span><span class="mf">0.8137978315353394</span><span class="p">,</span><span class="mf">0.396505743265152</span><span class="p">,</span><span class="mf">0.8811032176017761</span><span class="p">,</span><span class="mf">0.5812729001045227</span><span class="p">,</span><span class="mf">0.8817353844642639</span><span class="p">,</span><span class="mf">0.6925315856933594</span><span class="p">,</span><span class="mf">0.7252542972564697</span><span class="p">,</span><span class="mf">0.5013243556022644</span><span class="p">,</span><span class="mf">0.9560836553573608</span><span class="p">,</span><span class="mf">0.6439902186393738</span><span class="p">,</span><span class="mf">0.4238550364971161</span><span class="p">,</span><span class="mf">0.6063932180404663</span><span class="p">,</span><span class="mf">0.019193198531866074</span><span class="p">,</span><span class="mf">0.30157482624053955</span><span class="p">,</span><span class="mf">0.6601735353469849</span><span class="p">,</span><span class="mf">0.2900775969028473</span><span class="p">,</span><span class="mf">0.6180154085159302</span><span class="p">,</span><span class="mf">0.42876869440078735</span><span class="p">,</span><span class="mf">0.1354740709066391</span><span class="p">,</span><span class="mf">0.29828232526779175</span><span class="p">,</span><span class="mf">0.5699648857116699</span><span class="p">,</span><span class="mf">0.5908727645874023</span><span class="p">,</span><span class="mf">0.5743252635002136</span><span class="p">,</span><span class="mf">0.6532008051872253</span><span class="p">,</span><span class="mf">0.6521032452583313</span><span class="p">,</span><span class="mf">0.43141844868659973</span><span class="p">,</span><span class="mf">0.8965466022491455</span><span class="p">,</span><span class="mf">0.36756187677383423</span><span class="p">,</span><span class="mf">0.4358649253845215</span><span class="p">,</span><span class="mf">0.8919233679771423</span><span class="p">,</span><span class="mf">0.806194007396698</span><span class="p">,</span><span class="mf">0.7038885951042175</span><span class="p">,</span><span class="mf">0.10022688657045364</span><span class="p">,</span><span class="mf">0.9194825887680054</span><span class="p">,</span><span class="mf">0.7142413258552551</span><span class="p">,</span><span class="mf">0.9988470077514648</span><span class="p">,</span><span class="mf">0.14944830536842346</span><span class="p">,</span><span class="mf">0.8681260347366333</span><span class="p">,</span><span class="mf">0.16249293088912964</span><span class="p">,</span><span class="mf">0.6155595779418945</span><span class="p">,</span><span class="mf">0.1238199844956398</span><span class="p">,</span><span class="mf">0.8480082154273987</span><span class="p">,</span><span class="mf">0.8073189854621887</span><span class="p">,</span><span class="mf">0.5691007375717163</span><span class="p">,</span><span class="mf">0.40718328952789307</span><span class="p">,</span><span class="mf">0.06916699558496475</span><span class="p">,</span><span class="mf">0.6974287629127502</span><span class="p">,</span><span class="mf">0.45354267954826355</span><span class="p">,</span><span class="mf">0.7220556139945984</span><span class="p">,</span><span class="mf">0.8663823008537292</span><span class="p">,</span><span class="mf">0.9755215048789978</span><span class="p">,</span><span class="mf">0.855803370475769</span><span class="p">,</span><span class="mf">0.011714084073901176</span><span class="p">,</span><span class="mf">0.359978049993515</span><span class="p">,</span><span class="mf">0.729990541934967</span><span class="p">,</span><span class="mf">0.17162968218326569</span><span class="p">,</span><span class="mf">0.5210366249084473</span><span class="p">,</span><span class="mf">0.054337989538908005</span><span class="p">,</span><span class="mf">0.19999653100967407</span><span class="p">,</span><span class="mf">0.01852179504930973</span><span class="p">,</span><span class="mf">0.793697714805603</span><span class="p">,</span><span class="mf">0.2239246815443039</span><span class="p">,</span><span class="mf">0.3453516662120819</span><span class="p">,</span><span class="mf">0.9280812740325928</span><span class="p">,</span><span class="mf">0.704414427280426</span><span class="p">,</span><span class="mf">0.031838931143283844</span><span class="p">,</span><span class="mf">0.1646941602230072</span><span class="p">,</span><span class="mf">0.6214783787727356</span><span class="p">,</span><span class="mf">0.5772286057472229</span><span class="p">,</span><span class="mf">0.23789282143115997</span><span class="p">,</span><span class="mf">0.9342139959335327</span><span class="p">,</span><span class="mf">0.6139659285545349</span><span class="p">,</span><span class="mf">0.5356327891349792</span><span class="p">,</span><span class="mf">0.5899099707603455</span><span class="p">,</span><span class="mf">0.7301220297813416</span><span class="p">,</span><span class="mf">0.31194499135017395</span><span class="p">,</span><span class="mf">0.39822107553482056</span><span class="p">,</span><span class="mf">0.20984375476837158</span><span class="p">,</span><span class="mf">0.18619300425052643</span><span class="p">,</span><span class="mf">0.9443724155426025</span><span class="p">,</span><span class="mf">0.739550769329071</span><span class="p">,</span><span class="mf">0.49045881628990173</span><span class="p">,</span><span class="mf">0.22741462290287018</span><span class="p">,</span><span class="mf">0.2543564736843109</span><span class="p">,</span><span class="mf">0.058029159903526306</span><span class="p">,</span><span class="mf">0.43441662192344666</span><span class="p">,</span><span class="mf">0.3117958903312683</span><span class="p">,</span><span class="mf">0.6963434815406799</span><span class="p">,</span><span class="mf">0.37775182723999023</span><span class="p">,</span><span class="mf">0.1796036809682846</span><span class="p">,</span><span class="mf">0.024678727611899376</span><span class="p">,</span><span class="mf">0.06724963337182999</span><span class="p">,</span><span class="mf">0.6793927550315857</span><span class="p">,</span><span class="mf">0.4536968469619751</span><span class="p">,</span><span class="mf">0.5365791916847229</span><span class="p">,</span><span class="mf">0.8966712951660156</span><span class="p">,</span><span class="mf">0.990338921546936</span><span class="p">,</span><span class="mf">0.21689698100090027</span><span class="p">,</span><span class="mf">0.6630781888961792</span><span class="p">,</span><span class="mf">0.2633223831653595</span><span class="p">,</span><span class="mf">0.02065099962055683</span><span class="p">,</span><span class="mf">0.7583786249160767</span><span class="p">,</span><span class="mf">0.32001715898513794</span><span class="p">,</span><span class="mf">0.38346388936042786</span><span class="p">,</span><span class="mf">0.5883170962333679</span><span class="p">,</span><span class="mf">0.8310484290122986</span><span class="p">,</span><span class="mf">0.6289818286895752</span><span class="p">,</span><span class="mf">0.872650682926178</span><span class="p">,</span><span class="mf">0.27354204654693604</span><span class="p">,</span><span class="mf">0.7980468273162842</span><span class="p">,</span><span class="mf">0.18563593924045563</span><span class="p">,</span><span class="mf">0.9527916312217712</span><span class="p">,</span><span class="mf">0.6874882578849792</span><span class="p">,</span><span class="mf">0.21550767123699188</span><span class="p">,</span><span class="mf">0.9473705887794495</span><span class="p">,</span><span class="mf">0.7308558225631714</span><span class="p">,</span><span class="mf">0.2539416551589966</span><span class="p">,</span><span class="mf">0.21331197023391724</span><span class="p">,</span><span class="mf">0.518200695514679</span><span class="p">,</span><span class="mf">0.02566271834075451</span><span class="p">,</span><span class="mf">0.20747007429599762</span><span class="p">,</span><span class="mf">0.4246854782104492</span><span class="p">,</span><span class="mf">0.3741699755191803</span><span class="p">,</span><span class="mf">0.46357542276382446</span><span class="p">,</span><span class="mf">0.27762871980667114</span><span class="p">,</span><span class="mf">0.5867843627929688</span><span class="p">,</span><span class="mf">0.8638556003570557</span><span class="p">,</span><span class="mf">0.11753185838460922</span><span class="p">,</span><span class="mf">0.517379105091095</span><span class="p">,</span><span class="mf">0.13206811249256134</span><span class="p">,</span><span class="mf">0.7168596982955933</span><span class="p">,</span><span class="mf">0.39605969190597534</span><span class="p">,</span><span class="mf">0.5654212832450867</span><span class="p">,</span><span class="mf">0.1832798421382904</span><span class="p">,</span><span class="mf">0.14484776556491852</span><span class="p">,</span><span class="mf">0.4880562722682953</span><span class="p">,</span><span class="mf">0.35561272501945496</span><span class="p">,</span><span class="mf">0.9404319524765015</span><span class="p">,</span><span class="mf">0.7653252482414246</span><span class="p">,</span><span class="mf">0.748663604259491</span><span class="p">,</span><span class="mf">0.9037197232246399</span><span class="p">,</span><span class="mf">0.08342243731021881</span><span class="p">,</span><span class="mf">0.5521924495697021</span><span class="p">,</span><span class="mf">0.5844760537147522</span><span class="p">,</span><span class="mf">0.961936354637146</span><span class="p">,</span><span class="mf">0.29214751720428467</span><span class="p">,</span><span class="mf">0.24082878232002258</span><span class="p">,</span><span class="mf">0.10029394179582596</span><span class="p">,</span><span class="mf">0.016429629176855087</span><span class="p">,</span><span class="mf">0.9295293092727661</span><span class="p">,</span><span class="mf">0.669916570186615</span><span class="p">,</span><span class="mf">0.7851529121398926</span><span class="p">,</span><span class="mf">0.28173011541366577</span><span class="p">,</span><span class="mf">0.5864101648330688</span><span class="p">,</span><span class="mf">0.06395526975393295</span><span class="p">,</span><span class="mf">0.48562759160995483</span><span class="p">,</span><span class="mf">0.9774951338768005</span><span class="p">,</span><span class="mf">0.8765052556991577</span><span class="p">,</span><span class="mf">0.3381589651107788</span><span class="p">,</span><span class="mf">0.961570143699646</span><span class="p">,</span><span class="mf">0.23170162737369537</span><span class="p">,</span><span class="mf">0.9493188261985779</span><span class="p">,</span><span class="mf">0.9413776993751526</span><span class="p">,</span><span class="mf">0.799202561378479</span><span class="p">,</span><span class="mf">0.6304479241371155</span><span class="p">,</span><span class="mf">0.8742879629135132</span><span class="p">,</span><span class="mf">0.2930202782154083</span><span class="p">,</span><span class="mf">0.8489435315132141</span><span class="p">,</span><span class="mf">0.6178767085075378</span><span class="p">,</span><span class="mf">0.013236857950687408</span><span class="p">,</span><span class="mf">0.34723350405693054</span><span class="p">,</span><span class="mf">0.14814086258411407</span><span class="p">,</span><span class="mf">0.9818294048309326</span><span class="p">,</span><span class="mf">0.4783703088760376</span><span class="p">,</span><span class="mf">0.49739137291908264</span><span class="p">,</span><span class="mf">0.6394725441932678</span><span class="p">,</span><span class="mf">0.36858460307121277</span><span class="p">,</span><span class="mf">0.13690027594566345</span><span class="p">,</span><span class="mf">0.8221177458763123</span><span class="p">,</span><span class="mf">0.1898479163646698</span><span class="p">,</span><span class="mf">0.5113189816474915</span><span class="p">,</span><span class="mf">0.2243170291185379</span><span class="p">,</span><span class="mf">0.09784448146820068</span><span class="p">,</span><span class="mf">0.8621914982795715</span><span class="p">,</span><span class="mf">0.9729194641113281</span><span class="p">,</span><span class="mf">0.9608346819877625</span><span class="p">,</span><span class="mf">0.9065554738044739</span><span class="p">,</span><span class="mf">0.774047315120697</span><span class="p">,</span><span class="mf">0.3331451416015625</span><span class="p">,</span><span class="mf">0.08110138773918152</span><span class="p">,</span><span class="mf">0.40724116563796997</span><span class="p">,</span><span class="mf">0.2322341352701187</span><span class="p">,</span><span class="mf">0.13248763978481293</span><span class="p">,</span><span class="mf">0.053427182137966156</span><span class="p">,</span><span class="mf">0.7255943417549133</span><span class="p">,</span><span class="mf">0.011427458375692368</span><span class="p">,</span><span class="mf">0.7705807685852051</span><span class="p">,</span><span class="mf">0.14694663882255554</span><span class="p">,</span><span class="mf">0.07952208071947098</span><span class="p">,</span><span class="mf">0.08960303664207458</span><span class="p">,</span><span class="mf">0.6720477938652039</span><span class="p">,</span><span class="mf">0.24536721408367157</span><span class="p">,</span><span class="mf">0.4205394685268402</span><span class="p">,</span><span class="mf">0.557368814945221</span><span class="p">,</span><span class="mf">0.8605511784553528</span><span class="p">,</span><span class="mf">0.7270442843437195</span><span class="p">,</span><span class="mf">0.2703278958797455</span><span class="p">,</span><span class="mf">0.131482794880867</span><span class="p">,</span><span class="mf">0.05537432059645653</span><span class="p">,</span><span class="mf">0.3015986382961273</span><span class="p">,</span><span class="mf">0.2621181607246399</span><span class="p">,</span><span class="mf">0.45614057779312134</span><span class="p">,</span><span class="mf">0.6832813620567322</span><span class="p">,</span><span class="mf">0.6956254243850708</span><span class="p">,</span><span class="mf">0.28351885080337524</span><span class="p">,</span><span class="mf">0.3799269497394562</span><span class="p">,</span><span class="mf">0.18115095794200897</span><span class="p">,</span><span class="mf">0.7885454893112183</span><span class="p">,</span><span class="mf">0.05684807524085045</span><span class="p">,</span><span class="mf">0.6969972252845764</span><span class="p">,</span><span class="mf">0.7786954045295715</span><span class="p">,</span><span class="mf">0.7774075865745544</span><span class="p">,</span><span class="mf">0.25942257046699524</span><span class="p">,</span><span class="mf">0.3738131523132324</span><span class="p">,</span><span class="mf">0.5875996351242065</span><span class="p">,</span><span class="mf">0.27282190322875977</span><span class="p">,</span><span class="mf">0.3708527982234955</span><span class="p">,</span><span class="mf">0.19705428183078766</span><span class="p">,</span><span class="mf">0.4598558843135834</span><span class="p">,</span><span class="mf">0.044612299650907516</span><span class="p">,</span><span class="mf">0.7997958660125732</span><span class="p">,</span><span class="mf">0.07695644348859787</span><span class="p">,</span><span class="mf">0.5188351273536682</span><span class="p">,</span><span class="mf">0.3068101108074188</span><span class="p">,</span><span class="mf">0.5775429606437683</span><span class="p">,</span><span class="mf">0.9594333171844482</span><span class="p">,</span><span class="mf">0.6455702185630798</span><span class="p">,</span><span class="mf">0.03536243736743927</span><span class="p">,</span><span class="mf">0.4304024279117584</span><span class="p">,</span><span class="mf">0.5100168585777283</span><span class="p">,</span><span class="mf">0.5361775159835815</span><span class="p">,</span><span class="mf">0.6813924908638</span><span class="p">,</span><span class="mf">0.2775960862636566</span><span class="p">,</span><span class="mf">0.12886056303977966</span><span class="p">,</span><span class="mf">0.3926756680011749</span><span class="p">,</span><span class="mf">0.9564056992530823</span><span class="p">,</span><span class="mf">0.1871308982372284</span><span class="p">,</span><span class="mf">0.9039839506149292</span><span class="p">,</span><span class="mf">0.5438059568405151</span><span class="p">,</span><span class="mf">0.4569114148616791</span><span class="p">,</span><span class="mf">0.8820413947105408</span><span class="p">,</span><span class="mf">0.45860394835472107</span><span class="p">,</span><span class="mf">0.7241676449775696</span><span class="p">,</span><span class="mf">0.3990253210067749</span><span class="p">,</span><span class="mf">0.9040443897247314</span><span class="p">,</span><span class="mf">0.6900250315666199</span><span class="p">,</span><span class="mf">0.6996220350265503</span><span class="p">,</span><span class="mf">0.32772040367126465</span><span class="p">,</span><span class="mf">0.7567786574363708</span><span class="p">,</span><span class="mf">0.6360610723495483</span><span class="p">,</span><span class="mf">0.2400202751159668</span><span class="p">,</span><span class="mf">0.16053882241249084</span><span class="p">,</span><span class="mf">0.796391487121582</span><span class="p">,</span><span class="mf">0.9591665863990784</span><span class="p">,</span><span class="mf">0.4581388235092163</span><span class="p">,</span><span class="mf">0.5909841656684875</span><span class="p">,</span><span class="mf">0.8577226400375366</span><span class="p">,</span><span class="mf">0.45722344517707825</span><span class="p">,</span><span class="mf">0.9518744945526123</span><span class="p">,</span><span class="mf">0.5757511854171753</span><span class="p">,</span><span class="mf">0.8207671046257019</span><span class="p">,</span><span class="mf">0.9088436961174011</span><span class="p">,</span><span class="mf">0.8155238032341003</span><span class="p">,</span><span class="mf">0.15941447019577026</span><span class="p">,</span><span class="mf">0.6288984417915344</span><span class="p">,</span><span class="mf">0.39843425154685974</span><span class="p">,</span><span class="mf">0.06271295249462128</span><span class="p">,</span><span class="mf">0.4240322411060333</span><span class="p">,</span><span class="mf">0.25868406891822815</span><span class="p">,</span><span class="mf">0.849038302898407</span><span class="p">,</span><span class="mf">0.03330462798476219</span><span class="p">,</span><span class="mf">0.9589827060699463</span><span class="p">,</span><span class="mf">0.35536885261535645</span><span class="p">,</span><span class="mf">0.3567068874835968</span><span class="p">,</span><span class="mf">0.01632850244641304</span><span class="p">,</span><span class="mf">0.18523232638835907</span><span class="p">,</span><span class="mf">0.40125951170921326</span><span class="p">,</span><span class="mf">0.9292914271354675</span><span class="p">,</span><span class="mf">0.0996149331331253</span><span class="p">,</span><span class="mf">0.9453015327453613</span><span class="p">,</span><span class="mf">0.869488537311554</span><span class="p">,</span><span class="mf">0.4541623890399933</span><span class="p">,</span><span class="mf">0.326700896024704</span><span class="p">,</span><span class="mf">0.23274412751197815</span><span class="p">,</span><span class="mf">0.6144647002220154</span><span class="p">,</span><span class="mf">0.03307459130883217</span><span class="p">,</span><span class="mf">0.015606064349412918</span><span class="p">,</span><span class="mf">0.428795725107193</span><span class="p">,</span><span class="mf">0.06807407736778259</span><span class="p">,</span><span class="mf">0.2519409954547882</span><span class="p">,</span><span class="mf">0.2211609184741974</span><span class="p">,</span><span class="mf">0.253191202878952</span><span class="p">,</span><span class="mf">0.13105523586273193</span><span class="p">,</span><span class="mf">0.012036222964525223</span><span class="p">,</span><span class="mf">0.11548429727554321</span><span class="p">,</span><span class="mf">0.6184802651405334</span><span class="p">,</span><span class="mf">0.9742562174797058</span><span class="p">,</span><span class="mf">0.9903450012207031</span><span class="p">,</span><span class="mf">0.40905410051345825</span><span class="p">,</span><span class="mf">0.1629544198513031</span><span class="p">,</span><span class="mf">0.6387617588043213</span><span class="p">,</span><span class="mf">0.4903053343296051</span><span class="p">,</span><span class="mf">0.9894098043441772</span><span class="p">,</span><span class="mf">0.06530420482158661</span><span class="p">,</span><span class="mf">0.7832344174385071</span><span class="p">,</span><span class="mf">0.28839850425720215</span><span class="p">,</span><span class="mf">0.24141861498355865</span><span class="p">,</span><span class="mf">0.6625045537948608</span><span class="p">,</span><span class="mf">0.24606318771839142</span><span class="p">,</span><span class="mf">0.6658591032028198</span><span class="p">,</span><span class="mf">0.5173085331916809</span><span class="p">,</span><span class="mf">0.4240889847278595</span><span class="p">,</span><span class="mf">0.5546877980232239</span><span class="p">,</span><span class="mf">0.2870515286922455</span><span class="p">,</span><span class="mf">0.7065746784210205</span><span class="p">,</span><span class="mf">0.414856880903244</span><span class="p">,</span><span class="mf">0.3605455458164215</span><span class="p">,</span><span class="mf">0.8286569118499756</span><span class="p">,</span><span class="mf">0.9249669313430786</span><span class="p">,</span><span class="mf">0.04600730910897255</span><span class="p">,</span><span class="mf">0.2326269894838333</span><span class="p">,</span><span class="mf">0.34851935505867004</span><span class="p">,</span><span class="mf">0.8149664998054504</span><span class="p">,</span><span class="mf">0.9854914546012878</span><span class="p">,</span><span class="mf">0.9689717292785645</span><span class="p">,</span><span class="mf">0.904948353767395</span><span class="p">,</span><span class="mf">0.2965562641620636</span><span class="p">,</span><span class="mf">0.9920112490653992</span><span class="p">,</span><span class="mf">0.24942004680633545</span><span class="p">,</span><span class="mf">0.10590615123510361</span><span class="p">,</span><span class="mf">0.9509525895118713</span><span class="p">,</span><span class="mf">0.2334202527999878</span><span class="p">,</span><span class="mf">0.6897682547569275</span><span class="p">,</span><span class="mf">0.05835635960102081</span><span class="p">,</span><span class="mf">0.7307090759277344</span><span class="p">,</span><span class="mf">0.8817201852798462</span><span class="p">,</span><span class="mf">0.27243688702583313</span><span class="p">,</span><span class="mf">0.3790569007396698</span><span class="p">,</span><span class="mf">0.3742961883544922</span><span class="p">,</span><span class="mf">0.7487882375717163</span><span class="p">,</span><span class="mf">0.2378072440624237</span><span class="p">,</span><span class="mf">0.17185309529304504</span><span class="p">,</span><span class="mf">0.4492916464805603</span><span class="p">,</span><span class="mf">0.30446839332580566</span><span class="p">,</span><span class="mf">0.8391891121864319</span><span class="p">,</span><span class="mf">0.23774182796478271</span><span class="p">,</span><span class="mf">0.5023894309997559</span><span class="p">,</span><span class="mf">0.9425836205482483</span><span class="p">,</span><span class="mf">0.6339976787567139</span><span class="p">,</span><span class="mf">0.8672894239425659</span><span class="p">,</span><span class="mf">0.940209686756134</span><span class="p">,</span><span class="mf">0.7507648468017578</span><span class="p">,</span><span class="mf">0.6995750665664673</span><span class="p">,</span><span class="mf">0.9679655432701111</span><span class="p">,</span><span class="mf">0.9944007992744446</span><span class="p">,</span><span class="mf">0.4518216848373413</span><span class="p">,</span><span class="mf">0.07086978107690811</span><span class="p">,</span><span class="mf">0.29279401898384094</span><span class="p">,</span><span class="mf">0.15235470235347748</span><span class="p">,</span><span class="mf">0.41748636960983276</span><span class="p">,</span><span class="mf">0.13128933310508728</span><span class="p">,</span><span class="mf">0.6041178107261658</span><span class="p">,</span><span class="mf">0.38280805945396423</span><span class="p">,</span><span class="mf">0.8953858613967896</span><span class="p">,</span><span class="mf">0.96779465675354</span><span class="p">,</span><span class="mf">0.5468848943710327</span><span class="p">,</span><span class="mf">0.2748235762119293</span><span class="p">,</span><span class="mf">0.5922304391860962</span><span class="p">,</span><span class="mf">0.8967611789703369</span><span class="p">,</span><span class="mf">0.40673333406448364</span><span class="p">,</span><span class="mf">0.5520782470703125</span><span class="p">,</span><span class="mf">0.2716527581214905</span><span class="p">,</span><span class="mf">0.4554441571235657</span><span class="p">,</span><span class="mf">0.4017135500907898</span><span class="p">,</span><span class="mf">0.24841345846652985</span><span class="p">,</span><span class="mf">0.5058664083480835</span><span class="p">,</span><span class="mf">0.31038081645965576</span><span class="p">,</span><span class="mf">0.37303486466407776</span><span class="p">,</span><span class="mf">0.5249704718589783</span><span class="p">,</span><span class="mf">0.7505950331687927</span><span class="p">,</span><span class="mf">0.3335074782371521</span><span class="p">,</span><span class="mf">0.9241587519645691</span><span class="p">,</span><span class="mf">0.8623185753822327</span><span class="p">,</span><span class="mf">0.048690296709537506</span><span class="p">,</span><span class="mf">0.2536425292491913</span><span class="p">,</span><span class="mf">0.4461355209350586</span><span class="p">,</span><span class="mf">0.10462789237499237</span><span class="p">,</span><span class="mf">0.34847599267959595</span><span class="p">,</span><span class="mf">0.7400975227355957</span><span class="p">,</span><span class="mf">0.6805144548416138</span><span class="p">,</span><span class="mf">0.6223844289779663</span><span class="p">,</span><span class="mf">0.7105283737182617</span><span class="p">,</span><span class="mf">0.20492368936538696</span><span class="p">,</span><span class="mf">0.3416981101036072</span><span class="p">,</span><span class="mf">0.676242470741272</span><span class="p">,</span><span class="mf">0.879234790802002</span><span class="p">,</span><span class="mf">0.5436780452728271</span><span class="p">,</span><span class="mf">0.2826996445655823</span><span class="p">,</span><span class="mf">0.030235258862376213</span><span class="p">,</span><span class="mf">0.7103368043899536</span><span class="p">,</span><span class="mf">0.007884103804826736</span><span class="p">,</span><span class="mf">0.37267908453941345</span><span class="p">,</span><span class="mf">0.5305371880531311</span><span class="p">,</span><span class="mf">0.922111451625824</span><span class="p">,</span><span class="mf">0.08949454873800278</span><span class="p">,</span><span class="mf">0.40594232082366943</span><span class="p">,</span><span class="mf">0.024313200265169144</span><span class="p">,</span><span class="mf">0.3426109850406647</span><span class="p">,</span><span class="mf">0.6222310662269592</span><span class="p">,</span><span class="mf">0.2790679335594177</span><span class="p">,</span><span class="mf">0.2097499519586563</span><span class="p">,</span><span class="mf">0.11570323258638382</span><span class="p">,</span><span class="mf">0.5771402716636658</span><span class="p">,</span><span class="mf">0.6952700018882751</span><span class="p">,</span><span class="mf">0.6719571352005005</span><span class="p">,</span><span class="mf">0.9488610029220581</span><span class="p">,</span><span class="mf">0.002703213831409812</span><span class="p">,</span><span class="mf">0.6471966505050659</span><span class="p">,</span><span class="mf">0.60039222240448</span><span class="p">,</span><span class="mf">0.5887396335601807</span><span class="p">,</span><span class="mf">0.9627703428268433</span><span class="p">,</span><span class="mf">0.016871673986315727</span><span class="p">,</span><span class="mf">0.6964824199676514</span><span class="p">,</span><span class="mf">0.8136786222457886</span><span class="p">,</span><span class="mf">0.5098071694374084</span><span class="p">,</span><span class="mf">0.33396488428115845</span><span class="p">,</span><span class="mf">0.7908401489257812</span><span class="p">,</span><span class="mf">0.09724292904138565</span><span class="p">,</span><span class="mf">0.44203564524650574</span><span class="p">,</span><span class="mf">0.5199523568153381</span><span class="p">,</span><span class="mf">0.6939564347267151</span><span class="p">,</span><span class="mf">0.09088572859764099</span><span class="p">,</span><span class="mf">0.2277594953775406</span><span class="p">,</span><span class="mf">0.4103015661239624</span><span class="p">,</span><span class="mf">0.6232946515083313</span><span class="p">,</span><span class="mf">0.8869608044624329</span><span class="p">,</span><span class="mf">0.618826150894165</span><span class="p">,</span><span class="mf">0.13346147537231445</span><span class="p">,</span><span class="mf">0.9805801510810852</span><span class="p">,</span><span class="mf">0.8717857599258423</span><span class="p">,</span><span class="mf">0.5027207732200623</span><span class="p">,</span><span class="mf">0.9223479628562927</span><span class="p">,</span><span class="mf">0.5413808226585388</span><span class="p">,</span><span class="mf">0.9233060479164124</span><span class="p">,</span><span class="mf">0.8298973441123962</span><span class="p">,</span><span class="mf">0.968286395072937</span><span class="p">,</span><span class="mf">0.919782817363739</span><span class="p">,</span><span class="mf">0.03603381663560867</span><span class="p">,</span><span class="mf">0.1747720092535019</span><span class="p">,</span><span class="mf">0.3891346752643585</span><span class="p">,</span><span class="mf">0.9521427154541016</span><span class="p">,</span><span class="mf">0.300028920173645</span><span class="p">,</span><span class="mf">0.16046763956546783</span><span class="p">,</span><span class="mf">0.8863046765327454</span><span class="p">,</span><span class="mf">0.4463944137096405</span><span class="p">,</span><span class="mf">0.9078755974769592</span><span class="p">,</span><span class="mf">0.16023047268390656</span><span class="p">,</span><span class="mf">0.6611174941062927</span><span class="p">,</span><span class="mf">0.4402637481689453</span><span class="p">,</span><span class="mf">0.07648676633834839</span><span class="p">,</span><span class="mf">0.6964631676673889</span><span class="p">,</span><span class="mf">0.2473987489938736</span><span class="p">,</span><span class="mf">0.03961552307009697</span><span class="p">,</span><span class="mf">0.05994429811835289</span><span class="p">,</span><span class="mf">0.06107853725552559</span><span class="p">,</span><span class="mf">0.9077329635620117</span><span class="p">,</span><span class="mf">0.7398838996887207</span><span class="p">,</span><span class="mf">0.8980623483657837</span><span class="p">,</span><span class="mf">0.6725823283195496</span><span class="p">,</span><span class="mf">0.5289399027824402</span><span class="p">,</span><span class="mf">0.30444636940956116</span><span class="p">,</span><span class="mf">0.997962236404419</span><span class="p">,</span><span class="mf">0.36218905448913574</span><span class="p">,</span><span class="mf">0.47064894437789917</span><span class="p">,</span><span class="mf">0.37824517488479614</span><span class="p">,</span><span class="mf">0.979526937007904</span><span class="p">,</span><span class="mf">0.1746583878993988</span><span class="p">,</span><span class="mf">0.32798799872398376</span><span class="p">,</span><span class="mf">0.6803486943244934</span><span class="p">,</span><span class="mf">0.06320761889219284</span><span class="p">,</span><span class="mf">0.60724937915802</span><span class="p">,</span><span class="mf">0.47764649987220764</span><span class="p">,</span><span class="mf">0.2839999794960022</span><span class="p">,</span><span class="mf">0.2384132742881775</span><span class="p">,</span><span class="mf">0.5145127177238464</span><span class="p">,</span><span class="mf">0.36792758107185364</span><span class="p">,</span><span class="mf">0.4565199017524719</span><span class="p">,</span><span class="mf">0.3374773859977722</span><span class="p">,</span><span class="mf">0.9704936742782593</span><span class="p">,</span><span class="mf">0.13343943655490875</span><span class="p">,</span><span class="mf">0.09680395573377609</span><span class="p">,</span><span class="mf">0.3433917164802551</span><span class="p">,</span><span class="mf">0.5910269021987915</span><span class="p">,</span><span class="mf">0.6591764688491821</span><span class="p">,</span><span class="mf">0.3972567617893219</span><span class="p">,</span><span class="mf">0.9992780089378357</span><span class="p">,</span><span class="mf">0.35189300775527954</span><span class="p">,</span><span class="mf">0.7214066386222839</span><span class="p">,</span><span class="mf">0.6375827193260193</span><span class="p">,</span><span class="mf">0.8130538463592529</span><span class="p">,</span><span class="mf">0.9762256741523743</span><span class="p">,</span><span class="mf">0.8897936344146729</span><span class="p">,</span><span class="mf">0.7645619511604309</span><span class="p">,</span><span class="mf">0.6982485055923462</span><span class="p">,</span><span class="mf">0.335498183965683</span><span class="p">,</span><span class="mf">0.14768557250499725</span><span class="p">,</span><span class="mf">0.06263600289821625</span><span class="p">,</span><span class="mf">0.2419017106294632</span><span class="p">,</span><span class="mf">0.432281494140625</span><span class="p">,</span><span class="mf">0.521996259689331</span><span class="p">,</span><span class="mf">0.7730835676193237</span><span class="p">,</span><span class="mf">0.9587409496307373</span><span class="p">,</span><span class="mf">0.1173204779624939</span><span class="p">,</span><span class="mf">0.10700414329767227</span><span class="p">,</span><span class="mf">0.5896947383880615</span><span class="p">,</span><span class="mf">0.7453980445861816</span><span class="p">,</span><span class="mf">0.848150372505188</span><span class="p">,</span><span class="mf">0.9358320832252502</span><span class="p">,</span><span class="mf">0.9834262132644653</span><span class="p">,</span><span class="mf">0.39980170130729675</span><span class="p">,</span><span class="mf">0.3803351819515228</span><span class="p">,</span><span class="mf">0.14780867099761963</span><span class="p">,</span><span class="mf">0.6849344372749329</span><span class="p">,</span><span class="mf">0.6567619442939758</span><span class="p">,</span><span class="mf">0.8620625734329224</span><span class="p">,</span><span class="mf">0.09725799411535263</span><span class="p">,</span><span class="mf">0.49777689576148987</span><span class="p">,</span><span class="mf">0.5810819268226624</span><span class="p">,</span><span class="mf">0.2415570467710495</span><span class="p">,</span><span class="mf">0.16902540624141693</span><span class="p">,</span><span class="mf">0.8595808148384094</span><span class="p">,</span><span class="mf">0.05853492394089699</span><span class="p">,</span><span class="mf">0.47062090039253235</span><span class="p">,</span><span class="mf">0.11583399772644043</span><span class="p">,</span><span class="mf">0.45705875754356384</span><span class="p">,</span><span class="mf">0.9799623489379883</span><span class="p">,</span><span class="mf">0.4237063527107239</span><span class="p">,</span><span class="mf">0.857124924659729</span><span class="p">,</span><span class="mf">0.11731556057929993</span><span class="p">,</span><span class="mf">0.2712520658969879</span><span class="p">,</span><span class="mf">0.40379273891448975</span><span class="p">,</span><span class="mf">0.39981213212013245</span><span class="p">,</span><span class="mf">0.6713835000991821</span><span class="p">,</span><span class="mf">0.3447181284427643</span><span class="p">,</span><span class="mf">0.713766872882843</span><span class="p">,</span><span class="mf">0.6391869187355042</span><span class="p">,</span><span class="mf">0.399161159992218</span><span class="p">,</span><span class="mf">0.43176013231277466</span><span class="p">,</span><span class="mf">0.614527702331543</span><span class="p">,</span><span class="mf">0.0700421929359436</span><span class="p">,</span><span class="mf">0.8224067091941833</span><span class="p">,</span><span class="mf">0.65342116355896</span><span class="p">,</span><span class="mf">0.7263424396514893</span><span class="p">,</span><span class="mf">0.5369229912757874</span><span class="p">,</span><span class="mf">0.11047711223363876</span><span class="p">,</span><span class="mf">0.4050356149673462</span><span class="p">,</span><span class="mf">0.40537357330322266</span><span class="p">,</span><span class="mf">0.3210429847240448</span><span class="p">,</span><span class="mf">0.029950324445962906</span><span class="p">,</span><span class="mf">0.73725426197052</span><span class="p">,</span><span class="mf">0.10978446155786514</span><span class="p">,</span><span class="mf">0.6063081622123718</span><span class="p">,</span><span class="mf">0.7032175064086914</span><span class="p">,</span><span class="mf">0.6347863078117371</span><span class="p">,</span><span class="mf">0.95914226770401</span><span class="p">,</span><span class="mf">0.10329815745353699</span><span class="p">,</span><span class="mf">0.8671671748161316</span><span class="p">,</span><span class="mf">0.02919023483991623</span><span class="p">,</span><span class="mf">0.534916877746582</span><span class="p">,</span><span class="mf">0.4042436182498932</span><span class="p">,</span><span class="mf">0.5241838693618774</span><span class="p">,</span><span class="mf">0.36509987711906433</span><span class="p">,</span><span class="mf">0.19056691229343414</span><span class="p">,</span><span class="mf">0.01912289671599865</span><span class="p">,</span><span class="mf">0.5181497931480408</span><span class="p">,</span><span class="mf">0.8427768349647522</span><span class="p">,</span><span class="mf">0.3732159435749054</span><span class="p">,</span><span class="mf">0.2228638231754303</span><span class="p">,</span><span class="mf">0.080532006919384</span><span class="p">,</span><span class="mf">0.0853109210729599</span><span class="p">,</span><span class="mf">0.22139644622802734</span><span class="p">,</span><span class="mf">0.10001406073570251</span><span class="p">,</span><span class="mf">0.26503971219062805</span><span class="p">,</span><span class="mf">0.06614946573972702</span><span class="p">,</span><span class="mf">0.06560486555099487</span><span class="p">,</span><span class="mf">0.8562761545181274</span><span class="p">,</span><span class="mf">0.1621202677488327</span><span class="p">,</span><span class="mf">0.5596824288368225</span><span class="p">,</span><span class="mf">0.7734555602073669</span><span class="p">,</span><span class="mf">0.4564095735549927</span><span class="p">,</span><span class="mf">0.15336887538433075</span><span class="p">,</span><span class="mf">0.19959613680839539</span><span class="p">,</span><span class="mf">0.43298420310020447</span><span class="p">,</span><span class="mf">0.52823406457901</span><span class="p">,</span><span class="mf">0.3494403064250946</span><span class="p">,</span><span class="mf">0.7814795970916748</span><span class="p">,</span><span class="mf">0.7510216236114502</span><span class="p">,</span><span class="mf">0.9272118210792542</span><span class="p">,</span><span class="mf">0.028952548280358315</span><span class="p">,</span><span class="mf">0.8956912755966187</span><span class="p">,</span><span class="mf">0.39256879687309265</span><span class="p">,</span><span class="mf">0.8783724904060364</span><span class="p">,</span><span class="mf">0.690784752368927</span><span class="p">,</span><span class="mf">0.987348735332489</span><span class="p">,</span><span class="mf">0.7592824697494507</span><span class="p">,</span><span class="mf">0.3645446300506592</span><span class="p">,</span><span class="mf">0.5010631680488586</span><span class="p">,</span><span class="mf">0.37638914585113525</span><span class="p">,</span><span class="mf">0.364911824464798</span><span class="p">,</span><span class="mf">0.2609044909477234</span><span class="p">,</span><span class="mf">0.49597030878067017</span><span class="p">,</span><span class="mf">0.6817399263381958</span><span class="p">,</span><span class="mf">0.27734026312828064</span><span class="p">,</span><span class="mf">0.5243797898292542</span><span class="p">,</span><span class="mf">0.117380291223526</span><span class="p">,</span><span class="mf">0.1598452925682068</span><span class="p">,</span><span class="mf">0.04680635407567024</span><span class="p">,</span><span class="mf">0.9707314372062683</span><span class="p">,</span><span class="mf">0.0038603513967245817</span><span class="p">,</span><span class="mf">0.17857997119426727</span><span class="p">,</span><span class="mf">0.6128667593002319</span><span class="p">,</span><span class="mf">0.08136960119009018</span><span class="p">,</span><span class="mf">0.8818964958190918</span><span class="p">,</span><span class="mf">0.7196201682090759</span><span class="p">,</span><span class="mf">0.9663899540901184</span><span class="p">,</span><span class="mf">0.5076355338096619</span><span class="p">,</span><span class="mf">0.3004036843776703</span><span class="p">,</span><span class="mf">0.549500584602356</span><span class="p">,</span><span class="mf">0.9308187365531921</span><span class="p">,</span><span class="mf">0.5207614302635193</span><span class="p">,</span><span class="mf">0.2672070264816284</span><span class="p">,</span><span class="mf">0.8773987889289856</span><span class="p">,</span><span class="mf">0.3719187378883362</span><span class="p">,</span><span class="mf">0.0013833499979227781</span><span class="p">,</span><span class="mf">0.2476850152015686</span><span class="p">,</span><span class="mf">0.31823351979255676</span><span class="p">,</span><span class="mf">0.8587774634361267</span><span class="p">,</span><span class="mf">0.4585031569004059</span><span class="p">,</span><span class="mf">0.4445872902870178</span><span class="p">,</span><span class="mf">0.33610227704048157</span><span class="p">,</span><span class="mf">0.880678117275238</span><span class="p">,</span><span class="mf">0.9450267553329468</span><span class="p">,</span><span class="mf">0.9918903112411499</span><span class="p">,</span><span class="mf">0.3767412602901459</span><span class="p">,</span><span class="mf">0.9661474227905273</span><span class="p">,</span><span class="mf">0.7918795943260193</span><span class="p">,</span><span class="mf">0.675689160823822</span><span class="p">,</span><span class="mf">0.24488948285579681</span><span class="p">,</span><span class="mf">0.21645726263523102</span><span class="p">,</span><span class="mf">0.1660478264093399</span><span class="p">,</span><span class="mf">0.9227566123008728</span><span class="p">,</span><span class="mf">0.2940766513347626</span><span class="p">,</span><span class="mf">0.4530942440032959</span><span class="p">,</span><span class="mf">0.49395784735679626</span><span class="p">,</span><span class="mf">0.7781715989112854</span><span class="p">,</span><span class="mf">0.8442349433898926</span><span class="p">,</span><span class="mf">0.1390727013349533</span><span class="p">,</span><span class="mf">0.4269043505191803</span><span class="p">,</span><span class="mf">0.842854917049408</span><span class="p">,</span><span class="mf">0.8180332779884338</span><span class="p">};</span>
<span class="kt">float</span><span class="w"> </span><span class="n">calib_output0_data</span><span class="p">[</span><span class="n">NET_OUTPUT0_SIZE</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mf">3.5647096e-05</span><span class="p">,</span><span class="mf">6.824297e-08</span><span class="p">,</span><span class="mf">0.009327697</span><span class="p">,</span><span class="mf">3.2340475e-05</span><span class="p">,</span><span class="mf">1.1117579e-05</span><span class="p">,</span><span class="mf">1.5117058e-06</span><span class="p">,</span><span class="mf">4.6314454e-07</span><span class="p">,</span><span class="mf">5.161628e-11</span><span class="p">,</span><span class="mf">0.9905911</span><span class="p">,</span><span class="mf">3.8835238e-10</span><span class="p">};</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="编译并仿真运行">
<h4>编译并仿真运行<a class="headerlink" href="#编译并仿真运行" title="永久链接至标题"></a></h4>
<p>在本例中，采用软件仿真的方式对推理结果进行查看分析。
在<code class="docutils literal notranslate"><span class="pre">Workspace</span></code>界面，右键该项目，选择<code class="docutils literal notranslate"><span class="pre">Options</span></code>，打开项目选项窗口。在项目选项窗口左侧选择<code class="docutils literal notranslate"><span class="pre">Debugger</span></code>选项，在右侧的<code class="docutils literal notranslate"><span class="pre">Setup</span></code>子窗口中，<code class="docutils literal notranslate"><span class="pre">Driver</span></code>选择为<code class="docutils literal notranslate"><span class="pre">Simulator</span></code>，使能软件仿真。</p>
<p>关闭项目选项窗口，点击菜单栏<code class="docutils literal notranslate"><span class="pre">Project</span> <span class="pre">-&gt;</span> <span class="pre">Download</span> <span class="pre">and</span> <span class="pre">Debug</span></code>，进行项目编译并仿真。通过在<code class="docutils literal notranslate"><span class="pre">benchmark</span></code>调用处加入断点，可以观察到仿真运行的推理结果，以及benchmark()函数的返回值。</p>
</section>
</section>
<section id="在linux上的代码集成及编译部署-通过makefile进行代码集成">
<h3>在Linux上的代码集成及编译部署：通过MakeFile进行代码集成<a class="headerlink" href="#在linux上的代码集成及编译部署-通过makefile进行代码集成" title="永久链接至标题"></a></h3>
<p>本章教程以在Linux平台上，通过MakeFile对生成的模型代码进行集成开发为例，演示了在Linux上进行MCU推理代码集成开发的一般步骤。
主要分为以下几步：</p>
<ul class="simple">
<li><p>下载所需要的相关软件，准备好交叉编译及烧录环境</p></li>
<li><p>通过<code class="docutils literal notranslate"><span class="pre">STM32CubeMX</span></code>软件生成所需要的MCU启动代码及演示工程</p></li>
<li><p>修改<code class="docutils literal notranslate"><span class="pre">MakeFile</span></code>集成模型推理代码及<code class="docutils literal notranslate"><span class="pre">Micro</span></code>库</p></li>
<li><p>编译工程及烧录</p></li>
<li><p>读取板端运行结果并验证</p></li>
</ul>
<p>本例构建完成的完整demo代码，可点击<a class="reference external" href="https://download.mindspore.cn/model_zoo/official/lite/quick_start/micro/test_stmf767.tar.gz">此处下载</a>。</p>
<section id="环境准备-3">
<h4>环境准备<a class="headerlink" href="#环境准备-3" title="永久链接至标题"></a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://cmake.org/download/">CMake</a> &gt;= 3.18.3</p></li>
<li><p><a class="reference external" href="https://developer.arm.com/downloads/-/gnu-rm">GNU Arm Embedded Toolchain</a>  &gt;= 10-2020-q4-major-x86_64-linux</p>
<ul>
<li><p>该工具为适用Cortex-M的Linux下交叉编译工具。</p></li>
<li><p>下载x86_64-linux版本的<code class="docutils literal notranslate"><span class="pre">gcc-arm-none-eabi</span></code>，解压缩后，将目录下的bin路径加入到PATH环境变量中：<code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">PATH=gcc-arm-none-eabi路径/bin:$PATH</span></code>。</p></li>
</ul>
</li>
<li><p><a class="reference external" href="https://www.st.com/en/development-tools/stm32cubemx.html">STM32CubeMX-Lin</a> &gt;= 6.5.0</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">STM32CubeMX</span></code>是<code class="docutils literal notranslate"><span class="pre">意法半导体</span></code>提供的STM32芯片图形化配置工具，该工具用于生成STM芯片的启动代码及工程。</p></li>
</ul>
</li>
<li><p><a class="reference external" href="https://www.st.com/en/development-tools/stm32cubeprog.html">STM32CubePrg-Lin</a> &gt;= 6.5.0</p>
<ul>
<li><p>该工具是<code class="docutils literal notranslate"><span class="pre">意法半导体</span></code>提供的烧录工具，可用于程序烧录和数据读取。</p></li>
</ul>
</li>
</ul>
</section>
<section id="获取mcu启动代码及工程-1">
<h4>获取MCU启动代码及工程<a class="headerlink" href="#获取mcu启动代码及工程-1" title="永久链接至标题"></a></h4>
<p>如果用户已经有自己的MCU工程，请忽略该章节。
本章，以生成STM32F767芯片的启动工程为例，演示如何通过<code class="docutils literal notranslate"><span class="pre">STM32CubeMX</span></code>生成STM32芯片的MCU工程。</p>
<ul class="simple">
<li><p>启动<code class="docutils literal notranslate"><span class="pre">STM32CubeMX</span></code>，在<code class="docutils literal notranslate"><span class="pre">File</span></code>选项中选择<code class="docutils literal notranslate"><span class="pre">New</span> <span class="pre">Project</span></code>来新建工程。</p></li>
<li><p>在<code class="docutils literal notranslate"><span class="pre">MCU/MPU</span> <span class="pre">Selector</span></code>窗口，搜索并选择<code class="docutils literal notranslate"><span class="pre">STM32F767IGT6</span></code>，点击<code class="docutils literal notranslate"><span class="pre">Start</span> <span class="pre">Project</span></code>创建该芯片的工程。</p></li>
<li><p>在<code class="docutils literal notranslate"><span class="pre">Project</span> <span class="pre">Manager</span></code>界面，配置工程名及生成的工程路径，在<code class="docutils literal notranslate"><span class="pre">Toolchain</span> <span class="pre">/</span> <span class="pre">IDE</span></code>选项选择<code class="docutils literal notranslate"><span class="pre">Makefile</span></code>，以👈指定生成<code class="docutils literal notranslate"><span class="pre">MakeFile</span></code>工程。</p></li>
<li><p>点击上方的<code class="docutils literal notranslate"><span class="pre">GENERATE</span> <span class="pre">CODE</span></code>生成代码</p></li>
<li><p>在生成的工程目录下执行<code class="docutils literal notranslate"><span class="pre">make</span></code>，测试代码是否成功编译。</p></li>
</ul>
</section>
<section id="集成模型推理代码">
<h4>集成模型推理代码<a class="headerlink" href="#集成模型推理代码" title="永久链接至标题"></a></h4>
<ul>
<li><p>将生成的推理代码拷贝到MCU工程内，并将<a class="reference internal" href="#下载cortex-m架构micro库"><span class="std std-doc">下载Cortex-M架构<code class="docutils literal notranslate"><span class="pre">Micro</span></code>库</span></a>章节获得的压缩包解压后放到生成的推理代码目录内，目录如下图所示：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>stm32f767                                       # MCU工程目录
├── Core
│   ├── Inc
│   └── Src
│       ├── main.c
│       └── ...
├── Drivers
├── mnist                                        # 生成代码根目录
│   ├── benchmark                                # 对模型推理代码进行集成调用的benchmark例程
│   │   ├── benchmark.c
│   │   ├── data.c
│   │   ├── data.h
│   │   └── ...
│   │── mindspore-lite-1.8.0-none-cortex-m7      # 下载的Cortex-M7架构`Micro`库
│   ├── src                                      # 模型推理代码目录
│   └── ...
├── Makefile
├── startup_stm32f767xx.s
└── STM32F767IGTx_FLASH.ld
</pre></div>
</div>
</li>
<li><p>修改<code class="docutils literal notranslate"><span class="pre">MakeFile</span></code>，将模型推理代码及依赖库加入工程</p>
<p>本例中要加入工程的源代码包括<code class="docutils literal notranslate"><span class="pre">src</span></code>下的模型推理代码和<code class="docutils literal notranslate"><span class="pre">benchmark</span></code>目录下的模型推理调用示例代码，
修改<code class="docutils literal notranslate"><span class="pre">MakeFile</span></code>中的<code class="docutils literal notranslate"><span class="pre">C_SOURCES</span></code>变量定义，加入源文件路径：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">C_SOURCES</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="se">\</span>
mnist/src/context.c<span class="w"> </span><span class="se">\</span>
mnist/src/model.c<span class="w"> </span><span class="se">\</span>
mnist/src/net.c<span class="w"> </span><span class="se">\</span>
mnist/src/tensor.c<span class="w"> </span><span class="se">\</span>
mnist/src/weight.c<span class="w"> </span><span class="se">\</span>
mnist/benchmark/benchmark.c<span class="w"> </span><span class="se">\</span>
mnist/benchmark/calib_output.c<span class="w"> </span><span class="se">\</span>
mnist/benchmark/load_input.c<span class="w"> </span><span class="se">\</span>
mnist/benchmark/data.c<span class="w"> </span><span class="se">\</span>
...
</pre></div>
</div>
<p>加入依赖的头文件路径：修改<code class="docutils literal notranslate"><span class="pre">MakeFile</span></code>中的<code class="docutils literal notranslate"><span class="pre">C_INCLUDES</span></code>变量定义，加入以下路径：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>LITE_PACK = mindspore-lite-1.8.0-none-cortex-m7

C_INCLUDES =  \
-Imnist/$(LITE_PACK)/runtime \
-Imnist/$(LITE_PACK)/runtime/include \
-Imnist/$(LITE_PACK)/tools/codegen/include \
-Imnist/$(LITE_PACK)/tools/codegen/third_party/include/CMSIS/Core \
-Imnist/$(LITE_PACK)/tools/codegen/third_party/include/CMSIS/DSP \
-Imnist/$(LITE_PACK)/tools/codegen/third_party/include/CMSIS/NN \
-Imnist \
...
</pre></div>
</div>
<p>加入依赖的算子库（<code class="docutils literal notranslate"><span class="pre">-lnnacl</span> <span class="pre">-lwrapper</span> <span class="pre">-lcmsis_nn</span></code>），声明算子库文件所在路径，增加链接时编译选项（<code class="docutils literal notranslate"><span class="pre">-specs=nosys.specs</span></code>）。
本例中修改后的相关变量定义如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>LIBS = -lc -lm -lnosys -lnnacl -lwrapper -lcmsis_nn
LIBDIR = -Lmnist/$(LITE_PACK)/tools/codegen/lib -Lmnist/$(LITE_PACK)/tools/codegen/third_party/lib
LDFLAGS = $(MCU) -specs=nosys.specs -specs=nano.specs -T$(LDSCRIPT) $(LIBDIR) $(LIBS) -Wl,-Map=$(BUILD_DIR)/$(TARGET).map,--cref -Wl,--gc-sections
</pre></div>
</div>
</li>
<li><p>修改main.c文件，调用benchmark函数</p>
<p>在main函数中调用<code class="docutils literal notranslate"><span class="pre">benchmark.c</span></code>中的<code class="docutils literal notranslate"><span class="pre">benchmark</span></code>函数，benchmark文件夹内的程序为对生成的<code class="docutils literal notranslate"><span class="pre">src</span></code>内的推理代码进行推理调用并比较输出的示范样例程序，用户可以自由对它进行修改，在本例中，我们直接调用<code class="docutils literal notranslate"><span class="pre">benchmark</span></code>函数，并根据返回结果，赋值<code class="docutils literal notranslate"><span class="pre">run_dnn_flag</span></code>变量。</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">run_dnn_flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">;</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">benchmark</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">run success.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">run_dnn_flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;1&#39;</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">run failed.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">run_dnn_flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;2&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>在<code class="docutils literal notranslate"><span class="pre">main.c</span></code>开头增加头文件引用和<code class="docutils literal notranslate"><span class="pre">run_dnn_flag</span></code>变量的定义。</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;benchmark/benchmark.h&quot;</span>

<span class="kt">char</span><span class="w"> </span><span class="n">run_dnn_flag</span><span class="w"> </span><span class="n">__attribute__</span><span class="p">((</span><span class="n">section</span><span class="p">(</span><span class="s">&quot;.myram&quot;</span><span class="p">)))</span><span class="w"> </span><span class="p">;</span><span class="c1">//测试用数组</span>
</pre></div>
</div>
<p>在本例中，为方便直接使用烧录器对推理结果进行读取，把变量定义在了自定义的section段（<code class="docutils literal notranslate"><span class="pre">myram</span></code>）中，用户可以使用下面方式设置自定义的section段，或者忽略该声明，采用串口或其他交互方式得到推理结果。</p>
<p>自定义section段的设置方法如下：
修改<code class="docutils literal notranslate"><span class="pre">STM32F767IGTx_FLASH.ld</span></code>中的<code class="docutils literal notranslate"><span class="pre">MEMORY</span></code>段，增加一个自定义内存段<code class="docutils literal notranslate"><span class="pre">MYRAM</span></code>(在本例中，将<code class="docutils literal notranslate"><span class="pre">RAM</span></code>内存起始地址加4，以腾出内存给<code class="docutils literal notranslate"><span class="pre">MYRAM</span></code>)；接着在<code class="docutils literal notranslate"><span class="pre">SECTIONS</span></code>段内增加自定义的<code class="docutils literal notranslate"><span class="pre">myram</span></code>段声明。</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>MEMORY
{
MYRAM (xrw)     : ORIGIN = 0x20000000, LENGTH = 1
RAM (xrw)      : ORIGIN = 0x20000004, LENGTH = 524284
...
}
...
SECTIONS
{
  ...
  .myram (NOLOAD):
  {
    . = ALIGN(4);
    _smyram = .;        /* create a global symbol at data start */
    *(.sram)           /* .data sections */
    *(.sram*)          /* .data* sections */

    . = ALIGN(4);
    _emyram = .;        /* define a global symbol at data end */
  } &gt;MYRAM AT&gt; FLASH
}
</pre></div>
</div>
</li>
<li><p>修改<code class="docutils literal notranslate"><span class="pre">mnist/benchmark/data.c</span></code>文件，将标杆输入输出数据存放在程序内以进行对比</p>
<p>在benchmark例程内，会设置模型的输入数据，并将推理结果和设定的期望结果进行对比，得到误差偏移值。
在本例中，通过修改<code class="docutils literal notranslate"><span class="pre">data.c</span></code>的<code class="docutils literal notranslate"><span class="pre">calib_input0_data</span></code>数组，设置模型的输入数据，通过修改<code class="docutils literal notranslate"><span class="pre">calib_output0_data</span></code>，设定期望结果。</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">float</span><span class="w"> </span><span class="n">calib_input0_data</span><span class="p">[</span><span class="n">NET_INPUT0_SIZE</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mf">0.54881352186203</span><span class="p">,</span><span class="mf">0.7151893377304077</span><span class="p">,</span><span class="mf">0.6027633547782898</span><span class="p">,</span><span class="mf">0.5448831915855408</span><span class="p">,</span><span class="mf">0.42365479469299316</span><span class="p">,</span><span class="mf">0.6458941102027893</span><span class="p">,</span><span class="mf">0.4375872015953064</span><span class="p">,</span><span class="mf">0.891772985458374</span><span class="p">,</span><span class="mf">0.9636627435684204</span><span class="p">,</span><span class="mf">0.3834415078163147</span><span class="p">,</span><span class="mf">0.7917250394821167</span><span class="p">,</span><span class="mf">0.5288949012756348</span><span class="p">,</span><span class="mf">0.5680445432662964</span><span class="p">,</span><span class="mf">0.9255966544151306</span><span class="p">,</span><span class="mf">0.07103605568408966</span><span class="p">,</span><span class="mf">0.08712930232286453</span><span class="p">,</span><span class="mf">0.020218396559357643</span><span class="p">,</span><span class="mf">0.832619845867157</span><span class="p">,</span><span class="mf">0.7781567573547363</span><span class="p">,</span><span class="mf">0.8700121641159058</span><span class="p">,</span><span class="mf">0.978618323802948</span><span class="p">,</span><span class="mf">0.7991585731506348</span><span class="p">,</span><span class="mf">0.4614793658256531</span><span class="p">,</span><span class="mf">0.7805292010307312</span><span class="p">,</span><span class="mf">0.11827442795038223</span><span class="p">,</span><span class="mf">0.6399210095405579</span><span class="p">,</span><span class="mf">0.14335328340530396</span><span class="p">,</span><span class="mf">0.9446688890457153</span><span class="p">,</span><span class="mf">0.5218483209609985</span><span class="p">,</span><span class="mf">0.4146619439125061</span><span class="p">,</span><span class="mf">0.26455560326576233</span><span class="p">,</span><span class="mf">0.7742336988449097</span><span class="p">,</span><span class="mf">0.4561503231525421</span><span class="p">,</span><span class="mf">0.568433940410614</span><span class="p">,</span><span class="mf">0.018789799883961678</span><span class="p">,</span><span class="mf">0.6176354885101318</span><span class="p">,</span><span class="mf">0.6120957136154175</span><span class="p">,</span><span class="mf">0.6169340014457703</span><span class="p">,</span><span class="mf">0.9437480568885803</span><span class="p">,</span><span class="mf">0.681820273399353</span><span class="p">,</span><span class="mf">0.35950788855552673</span><span class="p">,</span><span class="mf">0.43703195452690125</span><span class="p">,</span><span class="mf">0.6976311802864075</span><span class="p">,</span><span class="mf">0.0602254718542099</span><span class="p">,</span><span class="mf">0.6667667031288147</span><span class="p">,</span><span class="mf">0.670637845993042</span><span class="p">,</span><span class="mf">0.21038256585597992</span><span class="p">,</span><span class="mf">0.12892629206180573</span><span class="p">,</span><span class="mf">0.31542834639549255</span><span class="p">,</span><span class="mf">0.36371076107025146</span><span class="p">,</span><span class="mf">0.5701967477798462</span><span class="p">,</span><span class="mf">0.4386015236377716</span><span class="p">,</span><span class="mf">0.9883738160133362</span><span class="p">,</span><span class="mf">0.10204481333494186</span><span class="p">,</span><span class="mf">0.20887675881385803</span><span class="p">,</span><span class="mf">0.16130951046943665</span><span class="p">,</span><span class="mf">0.6531082987785339</span><span class="p">,</span><span class="mf">0.25329160690307617</span><span class="p">,</span><span class="mf">0.4663107693195343</span><span class="p">,</span><span class="mf">0.24442559480667114</span><span class="p">,</span><span class="mf">0.15896958112716675</span><span class="p">,</span><span class="mf">0.11037514358758926</span><span class="p">,</span><span class="mf">0.6563295722007751</span><span class="p">,</span><span class="mf">0.13818295300006866</span><span class="p">,</span><span class="mf">0.1965823620557785</span><span class="p">,</span><span class="mf">0.3687251806259155</span><span class="p">,</span><span class="mf">0.8209932446479797</span><span class="p">,</span><span class="mf">0.09710127860307693</span><span class="p">,</span><span class="mf">0.8379449248313904</span><span class="p">,</span><span class="mf">0.0960984081029892</span><span class="p">,</span><span class="mf">0.9764594435691833</span><span class="p">,</span><span class="mf">0.4686512053012848</span><span class="p">,</span><span class="mf">0.9767611026763916</span><span class="p">,</span><span class="mf">0.6048455238342285</span><span class="p">,</span><span class="mf">0.7392635941505432</span><span class="p">,</span><span class="mf">0.03918779268860817</span><span class="p">,</span><span class="mf">0.28280696272850037</span><span class="p">,</span><span class="mf">0.12019655853509903</span><span class="p">,</span><span class="mf">0.296140193939209</span><span class="p">,</span><span class="mf">0.11872772127389908</span><span class="p">,</span><span class="mf">0.3179831802845001</span><span class="p">,</span><span class="mf">0.414262980222702</span><span class="p">,</span><span class="mf">0.06414749473333359</span><span class="p">,</span><span class="mf">0.6924721002578735</span><span class="p">,</span><span class="mf">0.5666014552116394</span><span class="p">,</span><span class="mf">0.26538950204849243</span><span class="p">,</span><span class="mf">0.5232480764389038</span><span class="p">,</span><span class="mf">0.09394051134586334</span><span class="p">,</span><span class="mf">0.5759465098381042</span><span class="p">,</span><span class="mf">0.9292961955070496</span><span class="p">,</span><span class="mf">0.3185689449310303</span><span class="p">,</span><span class="mf">0.6674103736877441</span><span class="p">,</span><span class="mf">0.13179786503314972</span><span class="p">,</span><span class="mf">0.7163271903991699</span><span class="p">,</span><span class="mf">0.28940609097480774</span><span class="p">,</span><span class="mf">0.18319135904312134</span><span class="p">,</span><span class="mf">0.5865129232406616</span><span class="p">,</span><span class="mf">0.02010754682123661</span><span class="p">,</span><span class="mf">0.8289400339126587</span><span class="p">,</span><span class="mf">0.004695476032793522</span><span class="p">,</span><span class="mf">0.6778165102005005</span><span class="p">,</span><span class="mf">0.2700079679489136</span><span class="p">,</span><span class="mf">0.7351940274238586</span><span class="p">,</span><span class="mf">0.9621885418891907</span><span class="p">,</span><span class="mf">0.2487531453371048</span><span class="p">,</span><span class="mf">0.5761573314666748</span><span class="p">,</span><span class="mf">0.5920419096946716</span><span class="p">,</span><span class="mf">0.5722519159317017</span><span class="p">,</span><span class="mf">0.22308163344860077</span><span class="p">,</span><span class="mf">0.9527490139007568</span><span class="p">,</span><span class="mf">0.4471253752708435</span><span class="p">,</span><span class="mf">0.8464086651802063</span><span class="p">,</span><span class="mf">0.6994792819023132</span><span class="p">,</span><span class="mf">0.2974369525909424</span><span class="p">,</span><span class="mf">0.8137978315353394</span><span class="p">,</span><span class="mf">0.396505743265152</span><span class="p">,</span><span class="mf">0.8811032176017761</span><span class="p">,</span><span class="mf">0.5812729001045227</span><span class="p">,</span><span class="mf">0.8817353844642639</span><span class="p">,</span><span class="mf">0.6925315856933594</span><span class="p">,</span><span class="mf">0.7252542972564697</span><span class="p">,</span><span class="mf">0.5013243556022644</span><span class="p">,</span><span class="mf">0.9560836553573608</span><span class="p">,</span><span class="mf">0.6439902186393738</span><span class="p">,</span><span class="mf">0.4238550364971161</span><span class="p">,</span><span class="mf">0.6063932180404663</span><span class="p">,</span><span class="mf">0.019193198531866074</span><span class="p">,</span><span class="mf">0.30157482624053955</span><span class="p">,</span><span class="mf">0.6601735353469849</span><span class="p">,</span><span class="mf">0.2900775969028473</span><span class="p">,</span><span class="mf">0.6180154085159302</span><span class="p">,</span><span class="mf">0.42876869440078735</span><span class="p">,</span><span class="mf">0.1354740709066391</span><span class="p">,</span><span class="mf">0.29828232526779175</span><span class="p">,</span><span class="mf">0.5699648857116699</span><span class="p">,</span><span class="mf">0.5908727645874023</span><span class="p">,</span><span class="mf">0.5743252635002136</span><span class="p">,</span><span class="mf">0.6532008051872253</span><span class="p">,</span><span class="mf">0.6521032452583313</span><span class="p">,</span><span class="mf">0.43141844868659973</span><span class="p">,</span><span class="mf">0.8965466022491455</span><span class="p">,</span><span class="mf">0.36756187677383423</span><span class="p">,</span><span class="mf">0.4358649253845215</span><span class="p">,</span><span class="mf">0.8919233679771423</span><span class="p">,</span><span class="mf">0.806194007396698</span><span class="p">,</span><span class="mf">0.7038885951042175</span><span class="p">,</span><span class="mf">0.10022688657045364</span><span class="p">,</span><span class="mf">0.9194825887680054</span><span class="p">,</span><span class="mf">0.7142413258552551</span><span class="p">,</span><span class="mf">0.9988470077514648</span><span class="p">,</span><span class="mf">0.14944830536842346</span><span class="p">,</span><span class="mf">0.8681260347366333</span><span class="p">,</span><span class="mf">0.16249293088912964</span><span class="p">,</span><span class="mf">0.6155595779418945</span><span class="p">,</span><span class="mf">0.1238199844956398</span><span class="p">,</span><span class="mf">0.8480082154273987</span><span class="p">,</span><span class="mf">0.8073189854621887</span><span class="p">,</span><span class="mf">0.5691007375717163</span><span class="p">,</span><span class="mf">0.40718328952789307</span><span class="p">,</span><span class="mf">0.06916699558496475</span><span class="p">,</span><span class="mf">0.6974287629127502</span><span class="p">,</span><span class="mf">0.45354267954826355</span><span class="p">,</span><span class="mf">0.7220556139945984</span><span class="p">,</span><span class="mf">0.8663823008537292</span><span class="p">,</span><span class="mf">0.9755215048789978</span><span class="p">,</span><span class="mf">0.855803370475769</span><span class="p">,</span><span class="mf">0.011714084073901176</span><span class="p">,</span><span class="mf">0.359978049993515</span><span class="p">,</span><span class="mf">0.729990541934967</span><span class="p">,</span><span class="mf">0.17162968218326569</span><span class="p">,</span><span class="mf">0.5210366249084473</span><span class="p">,</span><span class="mf">0.054337989538908005</span><span class="p">,</span><span class="mf">0.19999653100967407</span><span class="p">,</span><span class="mf">0.01852179504930973</span><span class="p">,</span><span class="mf">0.793697714805603</span><span class="p">,</span><span class="mf">0.2239246815443039</span><span class="p">,</span><span class="mf">0.3453516662120819</span><span class="p">,</span><span class="mf">0.9280812740325928</span><span class="p">,</span><span class="mf">0.704414427280426</span><span class="p">,</span><span class="mf">0.031838931143283844</span><span class="p">,</span><span class="mf">0.1646941602230072</span><span class="p">,</span><span class="mf">0.6214783787727356</span><span class="p">,</span><span class="mf">0.5772286057472229</span><span class="p">,</span><span class="mf">0.23789282143115997</span><span class="p">,</span><span class="mf">0.9342139959335327</span><span class="p">,</span><span class="mf">0.6139659285545349</span><span class="p">,</span><span class="mf">0.5356327891349792</span><span class="p">,</span><span class="mf">0.5899099707603455</span><span class="p">,</span><span class="mf">0.7301220297813416</span><span class="p">,</span><span class="mf">0.31194499135017395</span><span class="p">,</span><span class="mf">0.39822107553482056</span><span class="p">,</span><span class="mf">0.20984375476837158</span><span class="p">,</span><span class="mf">0.18619300425052643</span><span class="p">,</span><span class="mf">0.9443724155426025</span><span class="p">,</span><span class="mf">0.739550769329071</span><span class="p">,</span><span class="mf">0.49045881628990173</span><span class="p">,</span><span class="mf">0.22741462290287018</span><span class="p">,</span><span class="mf">0.2543564736843109</span><span class="p">,</span><span class="mf">0.058029159903526306</span><span class="p">,</span><span class="mf">0.43441662192344666</span><span class="p">,</span><span class="mf">0.3117958903312683</span><span class="p">,</span><span class="mf">0.6963434815406799</span><span class="p">,</span><span class="mf">0.37775182723999023</span><span class="p">,</span><span class="mf">0.1796036809682846</span><span class="p">,</span><span class="mf">0.024678727611899376</span><span class="p">,</span><span class="mf">0.06724963337182999</span><span class="p">,</span><span class="mf">0.6793927550315857</span><span class="p">,</span><span class="mf">0.4536968469619751</span><span class="p">,</span><span class="mf">0.5365791916847229</span><span class="p">,</span><span class="mf">0.8966712951660156</span><span class="p">,</span><span class="mf">0.990338921546936</span><span class="p">,</span><span class="mf">0.21689698100090027</span><span class="p">,</span><span class="mf">0.6630781888961792</span><span class="p">,</span><span class="mf">0.2633223831653595</span><span class="p">,</span><span class="mf">0.02065099962055683</span><span class="p">,</span><span class="mf">0.7583786249160767</span><span class="p">,</span><span class="mf">0.32001715898513794</span><span class="p">,</span><span class="mf">0.38346388936042786</span><span class="p">,</span><span class="mf">0.5883170962333679</span><span class="p">,</span><span class="mf">0.8310484290122986</span><span class="p">,</span><span class="mf">0.6289818286895752</span><span class="p">,</span><span class="mf">0.872650682926178</span><span class="p">,</span><span class="mf">0.27354204654693604</span><span class="p">,</span><span class="mf">0.7980468273162842</span><span class="p">,</span><span class="mf">0.18563593924045563</span><span class="p">,</span><span class="mf">0.9527916312217712</span><span class="p">,</span><span class="mf">0.6874882578849792</span><span class="p">,</span><span class="mf">0.21550767123699188</span><span class="p">,</span><span class="mf">0.9473705887794495</span><span class="p">,</span><span class="mf">0.7308558225631714</span><span class="p">,</span><span class="mf">0.2539416551589966</span><span class="p">,</span><span class="mf">0.21331197023391724</span><span class="p">,</span><span class="mf">0.518200695514679</span><span class="p">,</span><span class="mf">0.02566271834075451</span><span class="p">,</span><span class="mf">0.20747007429599762</span><span class="p">,</span><span class="mf">0.4246854782104492</span><span class="p">,</span><span class="mf">0.3741699755191803</span><span class="p">,</span><span class="mf">0.46357542276382446</span><span class="p">,</span><span class="mf">0.27762871980667114</span><span class="p">,</span><span class="mf">0.5867843627929688</span><span class="p">,</span><span class="mf">0.8638556003570557</span><span class="p">,</span><span class="mf">0.11753185838460922</span><span class="p">,</span><span class="mf">0.517379105091095</span><span class="p">,</span><span class="mf">0.13206811249256134</span><span class="p">,</span><span class="mf">0.7168596982955933</span><span class="p">,</span><span class="mf">0.39605969190597534</span><span class="p">,</span><span class="mf">0.5654212832450867</span><span class="p">,</span><span class="mf">0.1832798421382904</span><span class="p">,</span><span class="mf">0.14484776556491852</span><span class="p">,</span><span class="mf">0.4880562722682953</span><span class="p">,</span><span class="mf">0.35561272501945496</span><span class="p">,</span><span class="mf">0.9404319524765015</span><span class="p">,</span><span class="mf">0.7653252482414246</span><span class="p">,</span><span class="mf">0.748663604259491</span><span class="p">,</span><span class="mf">0.9037197232246399</span><span class="p">,</span><span class="mf">0.08342243731021881</span><span class="p">,</span><span class="mf">0.5521924495697021</span><span class="p">,</span><span class="mf">0.5844760537147522</span><span class="p">,</span><span class="mf">0.961936354637146</span><span class="p">,</span><span class="mf">0.29214751720428467</span><span class="p">,</span><span class="mf">0.24082878232002258</span><span class="p">,</span><span class="mf">0.10029394179582596</span><span class="p">,</span><span class="mf">0.016429629176855087</span><span class="p">,</span><span class="mf">0.9295293092727661</span><span class="p">,</span><span class="mf">0.669916570186615</span><span class="p">,</span><span class="mf">0.7851529121398926</span><span class="p">,</span><span class="mf">0.28173011541366577</span><span class="p">,</span><span class="mf">0.5864101648330688</span><span class="p">,</span><span class="mf">0.06395526975393295</span><span class="p">,</span><span class="mf">0.48562759160995483</span><span class="p">,</span><span class="mf">0.9774951338768005</span><span class="p">,</span><span class="mf">0.8765052556991577</span><span class="p">,</span><span class="mf">0.3381589651107788</span><span class="p">,</span><span class="mf">0.961570143699646</span><span class="p">,</span><span class="mf">0.23170162737369537</span><span class="p">,</span><span class="mf">0.9493188261985779</span><span class="p">,</span><span class="mf">0.9413776993751526</span><span class="p">,</span><span class="mf">0.799202561378479</span><span class="p">,</span><span class="mf">0.6304479241371155</span><span class="p">,</span><span class="mf">0.8742879629135132</span><span class="p">,</span><span class="mf">0.2930202782154083</span><span class="p">,</span><span class="mf">0.8489435315132141</span><span class="p">,</span><span class="mf">0.6178767085075378</span><span class="p">,</span><span class="mf">0.013236857950687408</span><span class="p">,</span><span class="mf">0.34723350405693054</span><span class="p">,</span><span class="mf">0.14814086258411407</span><span class="p">,</span><span class="mf">0.9818294048309326</span><span class="p">,</span><span class="mf">0.4783703088760376</span><span class="p">,</span><span class="mf">0.49739137291908264</span><span class="p">,</span><span class="mf">0.6394725441932678</span><span class="p">,</span><span class="mf">0.36858460307121277</span><span class="p">,</span><span class="mf">0.13690027594566345</span><span class="p">,</span><span class="mf">0.8221177458763123</span><span class="p">,</span><span class="mf">0.1898479163646698</span><span class="p">,</span><span class="mf">0.5113189816474915</span><span class="p">,</span><span class="mf">0.2243170291185379</span><span class="p">,</span><span class="mf">0.09784448146820068</span><span class="p">,</span><span class="mf">0.8621914982795715</span><span class="p">,</span><span class="mf">0.9729194641113281</span><span class="p">,</span><span class="mf">0.9608346819877625</span><span class="p">,</span><span class="mf">0.9065554738044739</span><span class="p">,</span><span class="mf">0.774047315120697</span><span class="p">,</span><span class="mf">0.3331451416015625</span><span class="p">,</span><span class="mf">0.08110138773918152</span><span class="p">,</span><span class="mf">0.40724116563796997</span><span class="p">,</span><span class="mf">0.2322341352701187</span><span class="p">,</span><span class="mf">0.13248763978481293</span><span class="p">,</span><span class="mf">0.053427182137966156</span><span class="p">,</span><span class="mf">0.7255943417549133</span><span class="p">,</span><span class="mf">0.011427458375692368</span><span class="p">,</span><span class="mf">0.7705807685852051</span><span class="p">,</span><span class="mf">0.14694663882255554</span><span class="p">,</span><span class="mf">0.07952208071947098</span><span class="p">,</span><span class="mf">0.08960303664207458</span><span class="p">,</span><span class="mf">0.6720477938652039</span><span class="p">,</span><span class="mf">0.24536721408367157</span><span class="p">,</span><span class="mf">0.4205394685268402</span><span class="p">,</span><span class="mf">0.557368814945221</span><span class="p">,</span><span class="mf">0.8605511784553528</span><span class="p">,</span><span class="mf">0.7270442843437195</span><span class="p">,</span><span class="mf">0.2703278958797455</span><span class="p">,</span><span class="mf">0.131482794880867</span><span class="p">,</span><span class="mf">0.05537432059645653</span><span class="p">,</span><span class="mf">0.3015986382961273</span><span class="p">,</span><span class="mf">0.2621181607246399</span><span class="p">,</span><span class="mf">0.45614057779312134</span><span class="p">,</span><span class="mf">0.6832813620567322</span><span class="p">,</span><span class="mf">0.6956254243850708</span><span class="p">,</span><span class="mf">0.28351885080337524</span><span class="p">,</span><span class="mf">0.3799269497394562</span><span class="p">,</span><span class="mf">0.18115095794200897</span><span class="p">,</span><span class="mf">0.7885454893112183</span><span class="p">,</span><span class="mf">0.05684807524085045</span><span class="p">,</span><span class="mf">0.6969972252845764</span><span class="p">,</span><span class="mf">0.7786954045295715</span><span class="p">,</span><span class="mf">0.7774075865745544</span><span class="p">,</span><span class="mf">0.25942257046699524</span><span class="p">,</span><span class="mf">0.3738131523132324</span><span class="p">,</span><span class="mf">0.5875996351242065</span><span class="p">,</span><span class="mf">0.27282190322875977</span><span class="p">,</span><span class="mf">0.3708527982234955</span><span class="p">,</span><span class="mf">0.19705428183078766</span><span class="p">,</span><span class="mf">0.4598558843135834</span><span class="p">,</span><span class="mf">0.044612299650907516</span><span class="p">,</span><span class="mf">0.7997958660125732</span><span class="p">,</span><span class="mf">0.07695644348859787</span><span class="p">,</span><span class="mf">0.5188351273536682</span><span class="p">,</span><span class="mf">0.3068101108074188</span><span class="p">,</span><span class="mf">0.5775429606437683</span><span class="p">,</span><span class="mf">0.9594333171844482</span><span class="p">,</span><span class="mf">0.6455702185630798</span><span class="p">,</span><span class="mf">0.03536243736743927</span><span class="p">,</span><span class="mf">0.4304024279117584</span><span class="p">,</span><span class="mf">0.5100168585777283</span><span class="p">,</span><span class="mf">0.5361775159835815</span><span class="p">,</span><span class="mf">0.6813924908638</span><span class="p">,</span><span class="mf">0.2775960862636566</span><span class="p">,</span><span class="mf">0.12886056303977966</span><span class="p">,</span><span class="mf">0.3926756680011749</span><span class="p">,</span><span class="mf">0.9564056992530823</span><span class="p">,</span><span class="mf">0.1871308982372284</span><span class="p">,</span><span class="mf">0.9039839506149292</span><span class="p">,</span><span class="mf">0.5438059568405151</span><span class="p">,</span><span class="mf">0.4569114148616791</span><span class="p">,</span><span class="mf">0.8820413947105408</span><span class="p">,</span><span class="mf">0.45860394835472107</span><span class="p">,</span><span class="mf">0.7241676449775696</span><span class="p">,</span><span class="mf">0.3990253210067749</span><span class="p">,</span><span class="mf">0.9040443897247314</span><span class="p">,</span><span class="mf">0.6900250315666199</span><span class="p">,</span><span class="mf">0.6996220350265503</span><span class="p">,</span><span class="mf">0.32772040367126465</span><span class="p">,</span><span class="mf">0.7567786574363708</span><span class="p">,</span><span class="mf">0.6360610723495483</span><span class="p">,</span><span class="mf">0.2400202751159668</span><span class="p">,</span><span class="mf">0.16053882241249084</span><span class="p">,</span><span class="mf">0.796391487121582</span><span class="p">,</span><span class="mf">0.9591665863990784</span><span class="p">,</span><span class="mf">0.4581388235092163</span><span class="p">,</span><span class="mf">0.5909841656684875</span><span class="p">,</span><span class="mf">0.8577226400375366</span><span class="p">,</span><span class="mf">0.45722344517707825</span><span class="p">,</span><span class="mf">0.9518744945526123</span><span class="p">,</span><span class="mf">0.5757511854171753</span><span class="p">,</span><span class="mf">0.8207671046257019</span><span class="p">,</span><span class="mf">0.9088436961174011</span><span class="p">,</span><span class="mf">0.8155238032341003</span><span class="p">,</span><span class="mf">0.15941447019577026</span><span class="p">,</span><span class="mf">0.6288984417915344</span><span class="p">,</span><span class="mf">0.39843425154685974</span><span class="p">,</span><span class="mf">0.06271295249462128</span><span class="p">,</span><span class="mf">0.4240322411060333</span><span class="p">,</span><span class="mf">0.25868406891822815</span><span class="p">,</span><span class="mf">0.849038302898407</span><span class="p">,</span><span class="mf">0.03330462798476219</span><span class="p">,</span><span class="mf">0.9589827060699463</span><span class="p">,</span><span class="mf">0.35536885261535645</span><span class="p">,</span><span class="mf">0.3567068874835968</span><span class="p">,</span><span class="mf">0.01632850244641304</span><span class="p">,</span><span class="mf">0.18523232638835907</span><span class="p">,</span><span class="mf">0.40125951170921326</span><span class="p">,</span><span class="mf">0.9292914271354675</span><span class="p">,</span><span class="mf">0.0996149331331253</span><span class="p">,</span><span class="mf">0.9453015327453613</span><span class="p">,</span><span class="mf">0.869488537311554</span><span class="p">,</span><span class="mf">0.4541623890399933</span><span class="p">,</span><span class="mf">0.326700896024704</span><span class="p">,</span><span class="mf">0.23274412751197815</span><span class="p">,</span><span class="mf">0.6144647002220154</span><span class="p">,</span><span class="mf">0.03307459130883217</span><span class="p">,</span><span class="mf">0.015606064349412918</span><span class="p">,</span><span class="mf">0.428795725107193</span><span class="p">,</span><span class="mf">0.06807407736778259</span><span class="p">,</span><span class="mf">0.2519409954547882</span><span class="p">,</span><span class="mf">0.2211609184741974</span><span class="p">,</span><span class="mf">0.253191202878952</span><span class="p">,</span><span class="mf">0.13105523586273193</span><span class="p">,</span><span class="mf">0.012036222964525223</span><span class="p">,</span><span class="mf">0.11548429727554321</span><span class="p">,</span><span class="mf">0.6184802651405334</span><span class="p">,</span><span class="mf">0.9742562174797058</span><span class="p">,</span><span class="mf">0.9903450012207031</span><span class="p">,</span><span class="mf">0.40905410051345825</span><span class="p">,</span><span class="mf">0.1629544198513031</span><span class="p">,</span><span class="mf">0.6387617588043213</span><span class="p">,</span><span class="mf">0.4903053343296051</span><span class="p">,</span><span class="mf">0.9894098043441772</span><span class="p">,</span><span class="mf">0.06530420482158661</span><span class="p">,</span><span class="mf">0.7832344174385071</span><span class="p">,</span><span class="mf">0.28839850425720215</span><span class="p">,</span><span class="mf">0.24141861498355865</span><span class="p">,</span><span class="mf">0.6625045537948608</span><span class="p">,</span><span class="mf">0.24606318771839142</span><span class="p">,</span><span class="mf">0.6658591032028198</span><span class="p">,</span><span class="mf">0.5173085331916809</span><span class="p">,</span><span class="mf">0.4240889847278595</span><span class="p">,</span><span class="mf">0.5546877980232239</span><span class="p">,</span><span class="mf">0.2870515286922455</span><span class="p">,</span><span class="mf">0.7065746784210205</span><span class="p">,</span><span class="mf">0.414856880903244</span><span class="p">,</span><span class="mf">0.3605455458164215</span><span class="p">,</span><span class="mf">0.8286569118499756</span><span class="p">,</span><span class="mf">0.9249669313430786</span><span class="p">,</span><span class="mf">0.04600730910897255</span><span class="p">,</span><span class="mf">0.2326269894838333</span><span class="p">,</span><span class="mf">0.34851935505867004</span><span class="p">,</span><span class="mf">0.8149664998054504</span><span class="p">,</span><span class="mf">0.9854914546012878</span><span class="p">,</span><span class="mf">0.9689717292785645</span><span class="p">,</span><span class="mf">0.904948353767395</span><span class="p">,</span><span class="mf">0.2965562641620636</span><span class="p">,</span><span class="mf">0.9920112490653992</span><span class="p">,</span><span class="mf">0.24942004680633545</span><span class="p">,</span><span class="mf">0.10590615123510361</span><span class="p">,</span><span class="mf">0.9509525895118713</span><span class="p">,</span><span class="mf">0.2334202527999878</span><span class="p">,</span><span class="mf">0.6897682547569275</span><span class="p">,</span><span class="mf">0.05835635960102081</span><span class="p">,</span><span class="mf">0.7307090759277344</span><span class="p">,</span><span class="mf">0.8817201852798462</span><span class="p">,</span><span class="mf">0.27243688702583313</span><span class="p">,</span><span class="mf">0.3790569007396698</span><span class="p">,</span><span class="mf">0.3742961883544922</span><span class="p">,</span><span class="mf">0.7487882375717163</span><span class="p">,</span><span class="mf">0.2378072440624237</span><span class="p">,</span><span class="mf">0.17185309529304504</span><span class="p">,</span><span class="mf">0.4492916464805603</span><span class="p">,</span><span class="mf">0.30446839332580566</span><span class="p">,</span><span class="mf">0.8391891121864319</span><span class="p">,</span><span class="mf">0.23774182796478271</span><span class="p">,</span><span class="mf">0.5023894309997559</span><span class="p">,</span><span class="mf">0.9425836205482483</span><span class="p">,</span><span class="mf">0.6339976787567139</span><span class="p">,</span><span class="mf">0.8672894239425659</span><span class="p">,</span><span class="mf">0.940209686756134</span><span class="p">,</span><span class="mf">0.7507648468017578</span><span class="p">,</span><span class="mf">0.6995750665664673</span><span class="p">,</span><span class="mf">0.9679655432701111</span><span class="p">,</span><span class="mf">0.9944007992744446</span><span class="p">,</span><span class="mf">0.4518216848373413</span><span class="p">,</span><span class="mf">0.07086978107690811</span><span class="p">,</span><span class="mf">0.29279401898384094</span><span class="p">,</span><span class="mf">0.15235470235347748</span><span class="p">,</span><span class="mf">0.41748636960983276</span><span class="p">,</span><span class="mf">0.13128933310508728</span><span class="p">,</span><span class="mf">0.6041178107261658</span><span class="p">,</span><span class="mf">0.38280805945396423</span><span class="p">,</span><span class="mf">0.8953858613967896</span><span class="p">,</span><span class="mf">0.96779465675354</span><span class="p">,</span><span class="mf">0.5468848943710327</span><span class="p">,</span><span class="mf">0.2748235762119293</span><span class="p">,</span><span class="mf">0.5922304391860962</span><span class="p">,</span><span class="mf">0.8967611789703369</span><span class="p">,</span><span class="mf">0.40673333406448364</span><span class="p">,</span><span class="mf">0.5520782470703125</span><span class="p">,</span><span class="mf">0.2716527581214905</span><span class="p">,</span><span class="mf">0.4554441571235657</span><span class="p">,</span><span class="mf">0.4017135500907898</span><span class="p">,</span><span class="mf">0.24841345846652985</span><span class="p">,</span><span class="mf">0.5058664083480835</span><span class="p">,</span><span class="mf">0.31038081645965576</span><span class="p">,</span><span class="mf">0.37303486466407776</span><span class="p">,</span><span class="mf">0.5249704718589783</span><span class="p">,</span><span class="mf">0.7505950331687927</span><span class="p">,</span><span class="mf">0.3335074782371521</span><span class="p">,</span><span class="mf">0.9241587519645691</span><span class="p">,</span><span class="mf">0.8623185753822327</span><span class="p">,</span><span class="mf">0.048690296709537506</span><span class="p">,</span><span class="mf">0.2536425292491913</span><span class="p">,</span><span class="mf">0.4461355209350586</span><span class="p">,</span><span class="mf">0.10462789237499237</span><span class="p">,</span><span class="mf">0.34847599267959595</span><span class="p">,</span><span class="mf">0.7400975227355957</span><span class="p">,</span><span class="mf">0.6805144548416138</span><span class="p">,</span><span class="mf">0.6223844289779663</span><span class="p">,</span><span class="mf">0.7105283737182617</span><span class="p">,</span><span class="mf">0.20492368936538696</span><span class="p">,</span><span class="mf">0.3416981101036072</span><span class="p">,</span><span class="mf">0.676242470741272</span><span class="p">,</span><span class="mf">0.879234790802002</span><span class="p">,</span><span class="mf">0.5436780452728271</span><span class="p">,</span><span class="mf">0.2826996445655823</span><span class="p">,</span><span class="mf">0.030235258862376213</span><span class="p">,</span><span class="mf">0.7103368043899536</span><span class="p">,</span><span class="mf">0.007884103804826736</span><span class="p">,</span><span class="mf">0.37267908453941345</span><span class="p">,</span><span class="mf">0.5305371880531311</span><span class="p">,</span><span class="mf">0.922111451625824</span><span class="p">,</span><span class="mf">0.08949454873800278</span><span class="p">,</span><span class="mf">0.40594232082366943</span><span class="p">,</span><span class="mf">0.024313200265169144</span><span class="p">,</span><span class="mf">0.3426109850406647</span><span class="p">,</span><span class="mf">0.6222310662269592</span><span class="p">,</span><span class="mf">0.2790679335594177</span><span class="p">,</span><span class="mf">0.2097499519586563</span><span class="p">,</span><span class="mf">0.11570323258638382</span><span class="p">,</span><span class="mf">0.5771402716636658</span><span class="p">,</span><span class="mf">0.6952700018882751</span><span class="p">,</span><span class="mf">0.6719571352005005</span><span class="p">,</span><span class="mf">0.9488610029220581</span><span class="p">,</span><span class="mf">0.002703213831409812</span><span class="p">,</span><span class="mf">0.6471966505050659</span><span class="p">,</span><span class="mf">0.60039222240448</span><span class="p">,</span><span class="mf">0.5887396335601807</span><span class="p">,</span><span class="mf">0.9627703428268433</span><span class="p">,</span><span class="mf">0.016871673986315727</span><span class="p">,</span><span class="mf">0.6964824199676514</span><span class="p">,</span><span class="mf">0.8136786222457886</span><span class="p">,</span><span class="mf">0.5098071694374084</span><span class="p">,</span><span class="mf">0.33396488428115845</span><span class="p">,</span><span class="mf">0.7908401489257812</span><span class="p">,</span><span class="mf">0.09724292904138565</span><span class="p">,</span><span class="mf">0.44203564524650574</span><span class="p">,</span><span class="mf">0.5199523568153381</span><span class="p">,</span><span class="mf">0.6939564347267151</span><span class="p">,</span><span class="mf">0.09088572859764099</span><span class="p">,</span><span class="mf">0.2277594953775406</span><span class="p">,</span><span class="mf">0.4103015661239624</span><span class="p">,</span><span class="mf">0.6232946515083313</span><span class="p">,</span><span class="mf">0.8869608044624329</span><span class="p">,</span><span class="mf">0.618826150894165</span><span class="p">,</span><span class="mf">0.13346147537231445</span><span class="p">,</span><span class="mf">0.9805801510810852</span><span class="p">,</span><span class="mf">0.8717857599258423</span><span class="p">,</span><span class="mf">0.5027207732200623</span><span class="p">,</span><span class="mf">0.9223479628562927</span><span class="p">,</span><span class="mf">0.5413808226585388</span><span class="p">,</span><span class="mf">0.9233060479164124</span><span class="p">,</span><span class="mf">0.8298973441123962</span><span class="p">,</span><span class="mf">0.968286395072937</span><span class="p">,</span><span class="mf">0.919782817363739</span><span class="p">,</span><span class="mf">0.03603381663560867</span><span class="p">,</span><span class="mf">0.1747720092535019</span><span class="p">,</span><span class="mf">0.3891346752643585</span><span class="p">,</span><span class="mf">0.9521427154541016</span><span class="p">,</span><span class="mf">0.300028920173645</span><span class="p">,</span><span class="mf">0.16046763956546783</span><span class="p">,</span><span class="mf">0.8863046765327454</span><span class="p">,</span><span class="mf">0.4463944137096405</span><span class="p">,</span><span class="mf">0.9078755974769592</span><span class="p">,</span><span class="mf">0.16023047268390656</span><span class="p">,</span><span class="mf">0.6611174941062927</span><span class="p">,</span><span class="mf">0.4402637481689453</span><span class="p">,</span><span class="mf">0.07648676633834839</span><span class="p">,</span><span class="mf">0.6964631676673889</span><span class="p">,</span><span class="mf">0.2473987489938736</span><span class="p">,</span><span class="mf">0.03961552307009697</span><span class="p">,</span><span class="mf">0.05994429811835289</span><span class="p">,</span><span class="mf">0.06107853725552559</span><span class="p">,</span><span class="mf">0.9077329635620117</span><span class="p">,</span><span class="mf">0.7398838996887207</span><span class="p">,</span><span class="mf">0.8980623483657837</span><span class="p">,</span><span class="mf">0.6725823283195496</span><span class="p">,</span><span class="mf">0.5289399027824402</span><span class="p">,</span><span class="mf">0.30444636940956116</span><span class="p">,</span><span class="mf">0.997962236404419</span><span class="p">,</span><span class="mf">0.36218905448913574</span><span class="p">,</span><span class="mf">0.47064894437789917</span><span class="p">,</span><span class="mf">0.37824517488479614</span><span class="p">,</span><span class="mf">0.979526937007904</span><span class="p">,</span><span class="mf">0.1746583878993988</span><span class="p">,</span><span class="mf">0.32798799872398376</span><span class="p">,</span><span class="mf">0.6803486943244934</span><span class="p">,</span><span class="mf">0.06320761889219284</span><span class="p">,</span><span class="mf">0.60724937915802</span><span class="p">,</span><span class="mf">0.47764649987220764</span><span class="p">,</span><span class="mf">0.2839999794960022</span><span class="p">,</span><span class="mf">0.2384132742881775</span><span class="p">,</span><span class="mf">0.5145127177238464</span><span class="p">,</span><span class="mf">0.36792758107185364</span><span class="p">,</span><span class="mf">0.4565199017524719</span><span class="p">,</span><span class="mf">0.3374773859977722</span><span class="p">,</span><span class="mf">0.9704936742782593</span><span class="p">,</span><span class="mf">0.13343943655490875</span><span class="p">,</span><span class="mf">0.09680395573377609</span><span class="p">,</span><span class="mf">0.3433917164802551</span><span class="p">,</span><span class="mf">0.5910269021987915</span><span class="p">,</span><span class="mf">0.6591764688491821</span><span class="p">,</span><span class="mf">0.3972567617893219</span><span class="p">,</span><span class="mf">0.9992780089378357</span><span class="p">,</span><span class="mf">0.35189300775527954</span><span class="p">,</span><span class="mf">0.7214066386222839</span><span class="p">,</span><span class="mf">0.6375827193260193</span><span class="p">,</span><span class="mf">0.8130538463592529</span><span class="p">,</span><span class="mf">0.9762256741523743</span><span class="p">,</span><span class="mf">0.8897936344146729</span><span class="p">,</span><span class="mf">0.7645619511604309</span><span class="p">,</span><span class="mf">0.6982485055923462</span><span class="p">,</span><span class="mf">0.335498183965683</span><span class="p">,</span><span class="mf">0.14768557250499725</span><span class="p">,</span><span class="mf">0.06263600289821625</span><span class="p">,</span><span class="mf">0.2419017106294632</span><span class="p">,</span><span class="mf">0.432281494140625</span><span class="p">,</span><span class="mf">0.521996259689331</span><span class="p">,</span><span class="mf">0.7730835676193237</span><span class="p">,</span><span class="mf">0.9587409496307373</span><span class="p">,</span><span class="mf">0.1173204779624939</span><span class="p">,</span><span class="mf">0.10700414329767227</span><span class="p">,</span><span class="mf">0.5896947383880615</span><span class="p">,</span><span class="mf">0.7453980445861816</span><span class="p">,</span><span class="mf">0.848150372505188</span><span class="p">,</span><span class="mf">0.9358320832252502</span><span class="p">,</span><span class="mf">0.9834262132644653</span><span class="p">,</span><span class="mf">0.39980170130729675</span><span class="p">,</span><span class="mf">0.3803351819515228</span><span class="p">,</span><span class="mf">0.14780867099761963</span><span class="p">,</span><span class="mf">0.6849344372749329</span><span class="p">,</span><span class="mf">0.6567619442939758</span><span class="p">,</span><span class="mf">0.8620625734329224</span><span class="p">,</span><span class="mf">0.09725799411535263</span><span class="p">,</span><span class="mf">0.49777689576148987</span><span class="p">,</span><span class="mf">0.5810819268226624</span><span class="p">,</span><span class="mf">0.2415570467710495</span><span class="p">,</span><span class="mf">0.16902540624141693</span><span class="p">,</span><span class="mf">0.8595808148384094</span><span class="p">,</span><span class="mf">0.05853492394089699</span><span class="p">,</span><span class="mf">0.47062090039253235</span><span class="p">,</span><span class="mf">0.11583399772644043</span><span class="p">,</span><span class="mf">0.45705875754356384</span><span class="p">,</span><span class="mf">0.9799623489379883</span><span class="p">,</span><span class="mf">0.4237063527107239</span><span class="p">,</span><span class="mf">0.857124924659729</span><span class="p">,</span><span class="mf">0.11731556057929993</span><span class="p">,</span><span class="mf">0.2712520658969879</span><span class="p">,</span><span class="mf">0.40379273891448975</span><span class="p">,</span><span class="mf">0.39981213212013245</span><span class="p">,</span><span class="mf">0.6713835000991821</span><span class="p">,</span><span class="mf">0.3447181284427643</span><span class="p">,</span><span class="mf">0.713766872882843</span><span class="p">,</span><span class="mf">0.6391869187355042</span><span class="p">,</span><span class="mf">0.399161159992218</span><span class="p">,</span><span class="mf">0.43176013231277466</span><span class="p">,</span><span class="mf">0.614527702331543</span><span class="p">,</span><span class="mf">0.0700421929359436</span><span class="p">,</span><span class="mf">0.8224067091941833</span><span class="p">,</span><span class="mf">0.65342116355896</span><span class="p">,</span><span class="mf">0.7263424396514893</span><span class="p">,</span><span class="mf">0.5369229912757874</span><span class="p">,</span><span class="mf">0.11047711223363876</span><span class="p">,</span><span class="mf">0.4050356149673462</span><span class="p">,</span><span class="mf">0.40537357330322266</span><span class="p">,</span><span class="mf">0.3210429847240448</span><span class="p">,</span><span class="mf">0.029950324445962906</span><span class="p">,</span><span class="mf">0.73725426197052</span><span class="p">,</span><span class="mf">0.10978446155786514</span><span class="p">,</span><span class="mf">0.6063081622123718</span><span class="p">,</span><span class="mf">0.7032175064086914</span><span class="p">,</span><span class="mf">0.6347863078117371</span><span class="p">,</span><span class="mf">0.95914226770401</span><span class="p">,</span><span class="mf">0.10329815745353699</span><span class="p">,</span><span class="mf">0.8671671748161316</span><span class="p">,</span><span class="mf">0.02919023483991623</span><span class="p">,</span><span class="mf">0.534916877746582</span><span class="p">,</span><span class="mf">0.4042436182498932</span><span class="p">,</span><span class="mf">0.5241838693618774</span><span class="p">,</span><span class="mf">0.36509987711906433</span><span class="p">,</span><span class="mf">0.19056691229343414</span><span class="p">,</span><span class="mf">0.01912289671599865</span><span class="p">,</span><span class="mf">0.5181497931480408</span><span class="p">,</span><span class="mf">0.8427768349647522</span><span class="p">,</span><span class="mf">0.3732159435749054</span><span class="p">,</span><span class="mf">0.2228638231754303</span><span class="p">,</span><span class="mf">0.080532006919384</span><span class="p">,</span><span class="mf">0.0853109210729599</span><span class="p">,</span><span class="mf">0.22139644622802734</span><span class="p">,</span><span class="mf">0.10001406073570251</span><span class="p">,</span><span class="mf">0.26503971219062805</span><span class="p">,</span><span class="mf">0.06614946573972702</span><span class="p">,</span><span class="mf">0.06560486555099487</span><span class="p">,</span><span class="mf">0.8562761545181274</span><span class="p">,</span><span class="mf">0.1621202677488327</span><span class="p">,</span><span class="mf">0.5596824288368225</span><span class="p">,</span><span class="mf">0.7734555602073669</span><span class="p">,</span><span class="mf">0.4564095735549927</span><span class="p">,</span><span class="mf">0.15336887538433075</span><span class="p">,</span><span class="mf">0.19959613680839539</span><span class="p">,</span><span class="mf">0.43298420310020447</span><span class="p">,</span><span class="mf">0.52823406457901</span><span class="p">,</span><span class="mf">0.3494403064250946</span><span class="p">,</span><span class="mf">0.7814795970916748</span><span class="p">,</span><span class="mf">0.7510216236114502</span><span class="p">,</span><span class="mf">0.9272118210792542</span><span class="p">,</span><span class="mf">0.028952548280358315</span><span class="p">,</span><span class="mf">0.8956912755966187</span><span class="p">,</span><span class="mf">0.39256879687309265</span><span class="p">,</span><span class="mf">0.8783724904060364</span><span class="p">,</span><span class="mf">0.690784752368927</span><span class="p">,</span><span class="mf">0.987348735332489</span><span class="p">,</span><span class="mf">0.7592824697494507</span><span class="p">,</span><span class="mf">0.3645446300506592</span><span class="p">,</span><span class="mf">0.5010631680488586</span><span class="p">,</span><span class="mf">0.37638914585113525</span><span class="p">,</span><span class="mf">0.364911824464798</span><span class="p">,</span><span class="mf">0.2609044909477234</span><span class="p">,</span><span class="mf">0.49597030878067017</span><span class="p">,</span><span class="mf">0.6817399263381958</span><span class="p">,</span><span class="mf">0.27734026312828064</span><span class="p">,</span><span class="mf">0.5243797898292542</span><span class="p">,</span><span class="mf">0.117380291223526</span><span class="p">,</span><span class="mf">0.1598452925682068</span><span class="p">,</span><span class="mf">0.04680635407567024</span><span class="p">,</span><span class="mf">0.9707314372062683</span><span class="p">,</span><span class="mf">0.0038603513967245817</span><span class="p">,</span><span class="mf">0.17857997119426727</span><span class="p">,</span><span class="mf">0.6128667593002319</span><span class="p">,</span><span class="mf">0.08136960119009018</span><span class="p">,</span><span class="mf">0.8818964958190918</span><span class="p">,</span><span class="mf">0.7196201682090759</span><span class="p">,</span><span class="mf">0.9663899540901184</span><span class="p">,</span><span class="mf">0.5076355338096619</span><span class="p">,</span><span class="mf">0.3004036843776703</span><span class="p">,</span><span class="mf">0.549500584602356</span><span class="p">,</span><span class="mf">0.9308187365531921</span><span class="p">,</span><span class="mf">0.5207614302635193</span><span class="p">,</span><span class="mf">0.2672070264816284</span><span class="p">,</span><span class="mf">0.8773987889289856</span><span class="p">,</span><span class="mf">0.3719187378883362</span><span class="p">,</span><span class="mf">0.0013833499979227781</span><span class="p">,</span><span class="mf">0.2476850152015686</span><span class="p">,</span><span class="mf">0.31823351979255676</span><span class="p">,</span><span class="mf">0.8587774634361267</span><span class="p">,</span><span class="mf">0.4585031569004059</span><span class="p">,</span><span class="mf">0.4445872902870178</span><span class="p">,</span><span class="mf">0.33610227704048157</span><span class="p">,</span><span class="mf">0.880678117275238</span><span class="p">,</span><span class="mf">0.9450267553329468</span><span class="p">,</span><span class="mf">0.9918903112411499</span><span class="p">,</span><span class="mf">0.3767412602901459</span><span class="p">,</span><span class="mf">0.9661474227905273</span><span class="p">,</span><span class="mf">0.7918795943260193</span><span class="p">,</span><span class="mf">0.675689160823822</span><span class="p">,</span><span class="mf">0.24488948285579681</span><span class="p">,</span><span class="mf">0.21645726263523102</span><span class="p">,</span><span class="mf">0.1660478264093399</span><span class="p">,</span><span class="mf">0.9227566123008728</span><span class="p">,</span><span class="mf">0.2940766513347626</span><span class="p">,</span><span class="mf">0.4530942440032959</span><span class="p">,</span><span class="mf">0.49395784735679626</span><span class="p">,</span><span class="mf">0.7781715989112854</span><span class="p">,</span><span class="mf">0.8442349433898926</span><span class="p">,</span><span class="mf">0.1390727013349533</span><span class="p">,</span><span class="mf">0.4269043505191803</span><span class="p">,</span><span class="mf">0.842854917049408</span><span class="p">,</span><span class="mf">0.8180332779884338</span><span class="p">};</span>
<span class="kt">float</span><span class="w"> </span><span class="n">calib_output0_data</span><span class="p">[</span><span class="n">NET_OUTPUT0_SIZE</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mf">3.5647096e-05</span><span class="p">,</span><span class="mf">6.824297e-08</span><span class="p">,</span><span class="mf">0.009327697</span><span class="p">,</span><span class="mf">3.2340475e-05</span><span class="p">,</span><span class="mf">1.1117579e-05</span><span class="p">,</span><span class="mf">1.5117058e-06</span><span class="p">,</span><span class="mf">4.6314454e-07</span><span class="p">,</span><span class="mf">5.161628e-11</span><span class="p">,</span><span class="mf">0.9905911</span><span class="p">,</span><span class="mf">3.8835238e-10</span><span class="p">};</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="编译工程及烧录">
<h4>编译工程及烧录<a class="headerlink" href="#编译工程及烧录" title="永久链接至标题"></a></h4>
<ul>
<li><p>编译</p>
<p>在MCU工程目录下，执行<code class="docutils literal notranslate"><span class="pre">make</span></code>命令进行编译，编译成功后显示如下，test_stm767为本例的MCU工程名：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>arm-none-eabi-size build/test_stm767.elf
text      data    bss    dec       hex      filename
120316    3620    87885  211821    33b6d    build/test_stm767.elf
arm-none-eabi-objcopy -O ihex build/test_stm767.elf build/test_stm767.hex
arm-none-eabi-objcopy -O binary -S build/test_stm767.elf build/test_stm767.bin
</pre></div>
</div>
</li>
<li><p>烧录运行</p>
<p>我们可以通过<code class="docutils literal notranslate"><span class="pre">STMSTM32CubePrg</span></code>烧录工具进行代码烧录并运行。在PC机上，通过<code class="docutils literal notranslate"><span class="pre">STLink</span></code>连接一块可烧录的开发板，然后在当前MCU工程目录下运行以下命令，执行烧录并运行程序：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bash<span class="w"> </span><span class="si">${</span><span class="nv">STMSTM32CubePrg_PATH</span><span class="si">}</span>/bin/STM32_Programmer.sh<span class="w"> </span>-c<span class="w"> </span><span class="nv">port</span><span class="o">=</span>SWD<span class="w"> </span>-w<span class="w"> </span>build/test_stm767.bin<span class="w"> </span>0x08000000<span class="w"> </span>-s<span class="w"> </span>0x08000000
</pre></div>
</div>
<p>${STMSTM32CubePrg_PATH为}为<code class="docutils literal notranslate"><span class="pre">STMSTM32CubePrg</span></code>安装路径。关于命令中的各参数含义，请参考<code class="docutils literal notranslate"><span class="pre">STMSTM32CubePrg</span></code>的使用手册。</p>
</li>
</ul>
</section>
<section id="推理结果验证">
<h4>推理结果验证<a class="headerlink" href="#推理结果验证" title="永久链接至标题"></a></h4>
<p>本例中，我们把benchmark运行结果标志保存在了起始地址为<code class="docutils literal notranslate"><span class="pre">0x20000000</span></code>且大小为1字节的内存段内，故可以直接通过烧录器获取该处地址的数据，以得到程序返回结果。
在PC机上，通过<code class="docutils literal notranslate"><span class="pre">STLink</span></code>连接一块已烧录好程序的开发板，通过执行以下命令读取内存数据：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bash<span class="w"> </span><span class="si">${</span><span class="nv">STMSTM32CubePrg_PATH为</span><span class="si">}</span>/bin/STM32_Programmer.sh<span class="w"> </span>-c<span class="w"> </span><span class="nv">port</span><span class="o">=</span>SWD<span class="w"> </span><span class="nv">model</span><span class="o">=</span>HOTPLUG<span class="w"> </span>--upload<span class="w"> </span>0x20000000<span class="w"> </span>0x1<span class="w"> </span>ret.bin
</pre></div>
</div>
<p>${STMSTM32CubePrg_PATH为}为<code class="docutils literal notranslate"><span class="pre">STMSTM32CubePrg</span></code>安装路径。关于命令中的各参数含义，请参考<code class="docutils literal notranslate"><span class="pre">STMSTM32CubePrg</span></code>的使用手册。</p>
<p>读取的数据被保存在<code class="docutils literal notranslate"><span class="pre">ret.bin</span></code>文件内，运行<code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">ret.bin</span></code>，如果板端推理成功，<code class="docutils literal notranslate"><span class="pre">ret.bin</span></code>内保存着字符<code class="docutils literal notranslate"><span class="pre">1</span></code>，会显示如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>1
</pre></div>
</div>
</section>
</section>
</section>
<section id="在轻鸿蒙设备上执行推理">
<h2>在轻鸿蒙设备上执行推理<a class="headerlink" href="#在轻鸿蒙设备上执行推理" title="永久链接至标题"></a></h2>
<section id="轻鸿蒙编译环境准备">
<h3>轻鸿蒙编译环境准备<a class="headerlink" href="#轻鸿蒙编译环境准备" title="永久链接至标题"></a></h3>
<p>用户可以通过<a class="reference external" href="https://www.openharmony.cn">OpenHarmony官网</a>来学习轻鸿蒙环境下的编译及烧录。
本教程以Hi3516开发板为例，演示如何在轻鸿蒙环境上使用Micro部署推理模型。</p>
</section>
<section id="编译模型">
<h3>编译模型<a class="headerlink" href="#编译模型" title="永久链接至标题"></a></h3>
<p>使用converter_lite编译<a class="reference external" href="https://download.mindspore.cn/model_zoo/official/lite/quick_start/micro/mnist.tar.gz">lenet模型</a>，生成对应轻鸿蒙平台的推理代码，命令如下：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>./converter_lite<span class="w"> </span>--fmk<span class="o">=</span>TFLITE<span class="w"> </span>--modelFile<span class="o">=</span>mnist.tflite<span class="w"> </span>--outputFile<span class="o">=</span><span class="si">${</span><span class="nv">SOURCE_CODE_DIR</span><span class="si">}</span><span class="w"> </span>--configFile<span class="o">=</span><span class="si">${</span><span class="nv">COFIG_FILE</span><span class="si">}</span>
</pre></div>
</div>
<p>其中config配置文件设置target = ARM32。</p>
</section>
<section id="编写构建脚本">
<h3>编写构建脚本<a class="headerlink" href="#编写构建脚本" title="永久链接至标题"></a></h3>
<p>轻鸿蒙应用程序开发请先参考<a class="reference external" href="https://device.harmonyos.com/cn/docs/start/introduce/quickstart-lite-steps-board3516-running-0000001151888681">运行Hello OHOS</a>。将上一步生成的mnist目录拷贝到任意鸿蒙源码路径下，假设为applications/sample/，然后新建BUILD.gn文件：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&lt;harmony-source-path&gt;/applications/sample/mnist
├── benchmark
├── CMakeLists.txt
├── BUILD.gn
└── src  
</pre></div>
</div>
<p>下载适用于OpenHarmony的<a class="reference external" href="https://www.mindspore.cn/lite/docs/zh-CN/master/use/downloads.html">预编译推理runtime包</a>，然后将其解压至任意鸿蒙源码路径下。编写BUILD.gn文件：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>import(&quot;//build/lite/config/component/lite_component.gni&quot;)
import(&quot;//build/lite/ndk/ndk.gni&quot;)

lite_component(&quot;mnist_benchmark&quot;) {
    target_type = &quot;executable&quot;
    sources = [
        &quot;benchmark/benchmark.cc&quot;,
        &quot;benchmark/calib_output.cc&quot;,
        &quot;benchmark/load_input.c&quot;,
        &quot;src/net.c&quot;,
        &quot;src/weight.c&quot;,
        &quot;src/session.cc&quot;,
        &quot;src/tensor.cc&quot;,
    ]
    features = []
    include_dirs = [
        &quot;&lt;YOUR MINDSPORE LITE RUNTIME PATH&gt;/runtime&quot;,
        &quot;&lt;YOUR MINDSPORE LITE RUNTIME PATH&gt;/tools/codegen/include&quot;,
        &quot;//applications/sample/mnist/benchmark&quot;,
        &quot;//applications/sample/mnist/src&quot;,
    ]
    ldflags = [
        &quot;-fno-strict-aliasing&quot;,
        &quot;-Wall&quot;,
        &quot;-pedantic&quot;,
        &quot;-std=gnu99&quot;,
    ]
    libs = [
        &quot;&lt;YOUR MINDSPORE LITE RUNTIME PATH&gt;/runtime/lib/libmindspore-lite.a&quot;,
        &quot;&lt;YOUR MINDSPORE LITE RUNTIME PATH&gt;/tools/codegen/lib/libwrapper.a&quot;,
    ]
    defines = [
        &quot;NOT_USE_STL&quot;,
        &quot;ENABLE_NEON&quot;,
        &quot;ENABLE_ARM&quot;,
        &quot;ENABLE_ARM32&quot;
    ]
    cflags = [
        &quot;-fno-strict-aliasing&quot;,
        &quot;-Wall&quot;,
        &quot;-pedantic&quot;,
        &quot;-std=gnu99&quot;,
    ]
    cflags_cc = [
        &quot;-fno-strict-aliasing&quot;,
        &quot;-Wall&quot;,
        &quot;-pedantic&quot;,
        &quot;-std=c++17&quot;,
    ]
}
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">&lt;YOUR</span> <span class="pre">MINDSPORE</span> <span class="pre">LITE</span> <span class="pre">RUNTIME</span> <span class="pre">PATH&gt;</span></code>是解压出来的推理runtime包路径，比如//applications/sample/mnist/mindspore-lite-1.3.0-ohos-aarch32。
修改文件build/lite/components/applications.json，添加组件mnist_benchmark的配置：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>{
    &quot;component&quot;: &quot;mnist_benchmark&quot;,
    &quot;description&quot;: &quot;Communication related samples.&quot;,
    &quot;optional&quot;: &quot;true&quot;,
    &quot;dirs&quot;: [
    &quot;applications/sample/mnist&quot;
    ],
    &quot;targets&quot;: [
    &quot;//applications/sample/mnist:mnist_benchmark&quot;
    ],
    &quot;rom&quot;: &quot;&quot;,
    &quot;ram&quot;: &quot;&quot;,
    &quot;output&quot;: [],
    &quot;adapted_kernel&quot;: [ &quot;liteos_a&quot; ],
    &quot;features&quot;: [],
    &quot;deps&quot;: {
    &quot;components&quot;: [],
    &quot;third_party&quot;: []
    }
},
</pre></div>
</div>
<p>修改文件vendor/hisilicon/hispark_taurus/config.json，新增mnist_benchmark组件的条目:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>{ &quot;component&quot;: &quot;mnist_benchmark&quot;, &quot;features&quot;:[] }
</pre></div>
</div>
</section>
<section id="编译benchmark">
<h3>编译benchmark<a class="headerlink" href="#编译benchmark" title="永久链接至标题"></a></h3>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>cd &lt;openharmony-source-path&gt;
hb set(设置编译路径)
.（选择当前路径）
选择ipcamera_hispark_taurus@hisilicon并回车
hb build mnist_benchmark（执行编译）
</pre></div>
</div>
<p>生成结果文件out/hispark_taurus/ipcamera_hispark_taurus/bin/mnist_benchmark。</p>
</section>
<section id="执行benchmark">
<h3>执行benchmark<a class="headerlink" href="#执行benchmark" title="永久链接至标题"></a></h3>
<p>将mnist_benchmark、权重文件（mnist/src/net.bin）以及<a class="reference external" href="https://download.mindspore.cn/model_zoo/official/lite/quick_start/micro/mnist.tar.gz">输入文件</a>解压后拷贝到开发板上，然后执行：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>OHOS # ./mnist_benchmark mnist_input.bin net.bin 1
OHOS # =======run benchmark======
input 0: mnist_input.bin

loop count: 1
total time: 10.11800ms, per time: 10.11800ms

outputs:
name: int8toft32_Softmax-7_post0/output-0, DataType: 43, Elements: 10, Shape: [1 10 ], Data:
0.000000, 0.000000, 0.003906, 0.000000, 0.000000, 0.992188, 0.000000, 0.000000, 0.000000, 0.000000,
========run success=======
</pre></div>
</div>
</section>
</section>
<section id="自定义算子">
<h2>自定义算子<a class="headerlink" href="#自定义算子" title="永久链接至标题"></a></h2>
<p>使用前请先参考<a class="reference external" href="https://www.mindspore.cn/lite/docs/zh-CN/master/use/register.html">自定义算子</a>了解基本概念。Micro目前仅支持custom类型的自定义算子注册和实现，暂不支持内建算子（比如conv2d、fc等）的注册和自定义实现。下面以海思Hi3516D开发板为例，说明如何在Micro中使用自定义算子。</p>
<p>使用转换工具生成NNIE的自定义算子具体步骤请参考<a class="reference external" href="https://www.mindspore.cn/lite/docs/zh-CN/master/use/nnie.html">集成NNIE使用说明</a>。</p>
<p>模型生成代码方式与非自定义算子模型保持一致：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>./converter_lite<span class="w"> </span>--fmk<span class="o">=</span>TFLITE<span class="w"> </span>--modelFile<span class="o">=</span>mnist.tflite<span class="w"> </span>--outputFile<span class="o">=</span><span class="si">${</span><span class="nv">SOURCE_CODE_DIR</span><span class="si">}</span><span class="w"> </span>--configFile<span class="o">=</span><span class="si">${</span><span class="nv">COFIG_FILE</span><span class="si">}</span>
</pre></div>
</div>
<p>其中config配置文件设置target = ARM32。</p>
<section id="用户实现自定义算子">
<h3>用户实现自定义算子<a class="headerlink" href="#用户实现自定义算子" title="永久链接至标题"></a></h3>
<p>上一步会在用户指定路径下生成源码目录，其有一个名为<code class="docutils literal notranslate"><span class="pre">src/registered_kernel.h</span></code>的头文件指定了custom算子的函数声明：</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">CustomKernel</span><span class="p">(</span><span class="n">TensorC</span><span class="w"> </span><span class="o">*</span><span class="n">inputs</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">input_num</span><span class="p">,</span><span class="w"> </span><span class="n">TensorC</span><span class="w"> </span><span class="o">*</span><span class="n">outputs</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">output_num</span><span class="p">,</span><span class="w"> </span><span class="n">CustomParameter</span><span class="w"> </span><span class="o">*</span><span class="n">param</span><span class="p">);</span>
</pre></div>
</div>
<p>用户需要提供该函数的实现，并将相关源码或者库集成到生成代码的cmake工程中。例如，我们提供了支持海思NNIE的custom kernel示例动态库libmicro_nnie.so，该文件包含在<a class="reference external" href="https://www.mindspore.cn/lite/docs/zh-CN/master/use/downloads.html">官网下载页</a>“NNIE 推理runtime库、benchmark工具”组件中。用户需要修改生成代码的CMakeLists.txt，添加链接的库名称和路径。例如：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>link_directories<span class="o">(</span>&lt;YOUR_PATH&gt;/mindspore-lite-1.8.1-linux-aarch32/providers/Hi3516D<span class="o">)</span>

link_directories<span class="o">(</span>&lt;HI3516D_SDK_PATH&gt;<span class="o">)</span>

target_link_libraries<span class="o">(</span>benchmark<span class="w"> </span>net<span class="w"> </span>micro_nnie<span class="w"> </span>nnie<span class="w"> </span>mpi<span class="w"> </span>VoiceEngine<span class="w"> </span>upvqe<span class="w"> </span>dnvqe<span class="w"> </span>securec<span class="w"> </span>-lm<span class="w"> </span>-pthread<span class="o">)</span>
</pre></div>
</div>
<p>在生成的<code class="docutils literal notranslate"><span class="pre">benchmark/benchmark.c</span></code>文件中，在main函数的调用前后添加<a class="reference external" href="https://gitee.com/mindspore/mindspore/blob/master/mindspore/lite/test/config_level0/micro/svp_sys_init.c">NNIE设备相关初始化代码</a>，最后进行源码编译：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>buid<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build

cmake<span class="w"> </span>-DCMAKE_TOOLCHAIN_FILE<span class="o">=</span>&lt;MS_SRC_PATH&gt;/mindspore/lite/cmake/himix200.toolchain.cmake<span class="w"> </span>-DPLATFORM_ARM32<span class="o">=</span>ON<span class="w"> </span>-DPKG_PATH<span class="o">=</span>&lt;RUNTIME_PKG_PATH&gt;<span class="w"> </span>..

make
</pre></div>
</div>
</section>
</section>
<section id="micro推理与端侧训练结合">
<h2>Micro推理与端侧训练结合<a class="headerlink" href="#micro推理与端侧训练结合" title="永久链接至标题"></a></h2>
<section id="概述-4">
<h3>概述<a class="headerlink" href="#概述-4" title="永久链接至标题"></a></h3>
<p>除MCU外，Micro推理是一种模型结构与权重分离的推理模式。训练一般是改变了权重，但不会改变模型结构。那么，在训练与推理配合的场景下，可以采用端侧训练+Micro推理的模式，以利用Micro推理运行内存小、功耗小的优势。具体过程包括以下几步：</p>
<ul>
<li><p>基于端侧训练导出推理模型</p></li>
<li><p>通过converter_lite转换工具，生成与端侧训练相同架构下的模型推理代码</p></li>
<li><p>下载得到与端侧训练相同架构对应的<code class="docutils literal notranslate"><span class="pre">Micro</span></code>库</p></li>
<li><p>对得到的推理代码和<code class="docutils literal notranslate"><span class="pre">Micro</span></code>库进行集成，编译并部署</p></li>
<li><p>基于端侧训练导出推理模型的权重，覆盖原有权重文件，进行验证</p>
<p>接下来我们将详细介绍各个步骤及其注意事项。</p>
</li>
</ul>
</section>
<section id="训练导出推理模型">
<h3>训练导出推理模型<a class="headerlink" href="#训练导出推理模型" title="永久链接至标题"></a></h3>
<p>用户可以直接参考<a class="reference external" href="https://www.mindspore.cn/lite/docs/zh-CN/master/use/runtime_train_cpp.html">端侧训练</a>一节。</p>
</section>
<section id="生成推理代码">
<h3>生成推理代码<a class="headerlink" href="#生成推理代码" title="永久链接至标题"></a></h3>
<p>用户可以直接参考上述内容，但需要注意两个点。第一，训练导出的模型是ms模型，因此在转换时，需设置<code class="docutils literal notranslate"><span class="pre">fmk</span></code>为<code class="docutils literal notranslate"><span class="pre">MSLITE</span></code>；第二，为了能够将训练与Micro推理结合，就需要保证训练导出的权重和Micro导出的权重完全匹配，因此，我们在Micro配置参数中新增了两个属性，以保证权重的一致性。</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[micro_param]
# false indicates that only the required weights will be saved. Default is false.
# If collaborate with lite-train, the parameter must be true.
keep_original_weight=false

# the names of those weight-tensors whose shape is changeable, only embedding-table supports change now.
# the parameter is used to collaborate with lite-train. If set, `keep_original_weight` must be true.
changeable_weights_name=name0,name1
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">keep_original_weight</span></code>是保证权重一致性的关键属性，与训练配合时，此属性必须为true。<code class="docutils literal notranslate"><span class="pre">changeable_weights_name</span></code>是针对特殊场景下的属性，例如某些权重的shape发生了变化，当然，当前仅支持embedding表的个数发生变化，一般而言，用户无需设置该属性。</p>
</section>
<section id="编译部署">
<h3>编译部署<a class="headerlink" href="#编译部署" title="永久链接至标题"></a></h3>
<p>用户可以直接参考上述内容。</p>
</section>
<section id="训练导出推理模型的权重">
<h3>训练导出推理模型的权重<a class="headerlink" href="#训练导出推理模型的权重" title="永久链接至标题"></a></h3>
<p>MindSpore的Serialization类提供了ExportWeightsCollaborateWithMicro函数，ExportWeightsCollaborateWithMicro原型如下：</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">Status</span><span class="w"> </span><span class="nf">ExportWeightsCollaborateWithMicro</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Model</span><span class="w"> </span><span class="o">&amp;</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">ModelType</span><span class="w"> </span><span class="n">model_type</span><span class="p">,</span>
<span class="w">                                                  </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">weight_file</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">is_inference</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span>
<span class="w">                                                  </span><span class="kt">bool</span><span class="w"> </span><span class="n">enable_fp16</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span>
<span class="w">                                                  </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">changeable_weights_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{});</span>
</pre></div>
</div>
<p>其中，<code class="docutils literal notranslate"><span class="pre">is_inference</span></code>当前仅支持为true。</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="runtime_java.html" class="btn btn-neutral float-left" title="使用Java接口执行推理" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="asic.html" class="btn btn-neutral float-right" title="专用芯片集成说明" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 MindSpore.</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用了 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a>开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 
</body>
</html>