<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Benchmark Tool &mdash; MindSpore Lite master documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="TimeProfiler Tool" href="timeprofiler_tool.html" />
    <link rel="prev" title="Runtime User Guide" href="runtime.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> MindSpore Lite
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Quick Start</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../build.html">Build</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quick_start/quick_start.html">Implementing an Image Classification Application</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Use</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="converter_tool.html">Converter Tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="runtime.html">Runtime User Guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Benchmark Tool</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#environment-preparation">Environment Preparation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#parameter-description">Parameter Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example">Example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#performance-test">Performance Test</a></li>
<li class="toctree-l3"><a class="reference internal" href="#accuracy-test">Accuracy Test</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="timeprofiler_tool.html">TimeProfiler Tool</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MindSpore Lite</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Benchmark Tool</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/use/benchmark_tool.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="benchmark-tool">
<h1>Benchmark Tool<a class="headerlink" href="#benchmark-tool" title="Permalink to this headline"></a></h1>
<p><a href="https://gitee.com/mindspore/docs/blob/r0.7/lite/tutorials/source_en/use/benchmark_tool.md" target="_blank"><img src="../_static/logo_source.png"></a></p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline"></a></h2>
<p>The Benchmark tool is used to perform benchmark testing on a MindSpore Lite model. It can not only perform quantitative analysis (performance) on the forward inference execution duration of a MindSpore Lite model, but also perform comparative error analysis (accuracy) based on the output of the specified model.</p>
</section>
<section id="environment-preparation">
<h2>Environment Preparation<a class="headerlink" href="#environment-preparation" title="Permalink to this headline"></a></h2>
<p>To use the Benchmark tool, you need to prepare the environment as follows:</p>
<ul class="simple">
<li><p>Compilation: Install build dependencies and perform build. The code of the Benchmark tool is stored in the <code class="docutils literal notranslate"><span class="pre">mindspore/lite/tools/benchmark</span></code> directory of the MindSpore source code. For details about the build operations, see the <a class="reference external" href="https://www.mindspore.cn/lite/tutorial/en/r0.7/build.html#environment-requirements">Environment Requirements</a> and <a class="reference external" href="https://www.mindspore.cn/lite/tutorial/en/r0.7/build.html#compilation-example">Compilation Example</a> in the build document.</p></li>
<li><p>Run: Obtain the <code class="docutils literal notranslate"><span class="pre">Benchmark</span></code> tool and configure environment variables. For details, see <a class="reference external" href="https://www.mindspore.cn/lite/tutorial/en/r0.7/build.html#output-description">Output Description</a> in the build document.</p></li>
</ul>
</section>
<section id="parameter-description">
<h2>Parameter Description<a class="headerlink" href="#parameter-description" title="Permalink to this headline"></a></h2>
<p>The command used for benchmark testing based on the compiled Benchmark tool is as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./benchmark<span class="w"> </span><span class="o">[</span>--modelPath<span class="o">=</span>&lt;MODELPATH&gt;<span class="o">]</span><span class="w"> </span><span class="o">[</span>--accuracyThreshold<span class="o">=</span>&lt;ACCURACYTHRESHOLD&gt;<span class="o">]</span>
<span class="w">			</span><span class="o">[</span>--calibDataPath<span class="o">=</span>&lt;CALIBDATAPATH&gt;<span class="o">]</span><span class="w"> </span><span class="o">[</span>--cpuBindMode<span class="o">=</span>&lt;CPUBINDMODE&gt;<span class="o">]</span>
<span class="w">			</span><span class="o">[</span>--device<span class="o">=</span>&lt;DEVICE&gt;<span class="o">]</span><span class="w"> </span><span class="o">[</span>--help<span class="o">]</span><span class="w"> </span><span class="o">[</span>--inDataPath<span class="o">=</span>&lt;INDATAPATH&gt;<span class="o">]</span>
<span class="w">			</span><span class="o">[</span>--inDataType<span class="o">=</span>&lt;INDATATYPE&gt;<span class="o">]</span><span class="w"> </span><span class="o">[</span>--loopCount<span class="o">=</span>&lt;LOOPCOUNT&gt;<span class="o">]</span>
<span class="w">			</span><span class="o">[</span>--numThreads<span class="o">=</span>&lt;NUMTHREADS&gt;<span class="o">]</span><span class="w"> </span><span class="o">[</span>--omModelPath<span class="o">=</span>&lt;OMMODELPATH&gt;<span class="o">]</span>
<span class="w">			</span><span class="o">[</span>--resizeDims<span class="o">=</span>&lt;RESIZEDIMS&gt;<span class="o">]</span><span class="w"> </span><span class="o">[</span>--warmUpLoopCount<span class="o">=</span>&lt;WARMUPLOOPCOUNT&gt;<span class="o">]</span>
<span class="w">			</span><span class="o">[</span>--fp16Priority<span class="o">=</span>&lt;FP16PRIORITY&gt;<span class="o">]</span>
</pre></div>
</div>
<p>The following describes the parameters in detail.</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Attribute</p></th>
<th class="head"><p>Function</p></th>
<th class="head"><p>Parameter Type</p></th>
<th class="head"><p>Default Value</p></th>
<th class="head"><p>Value Range</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--modelPath=&lt;MODELPATH&gt;</span></code></p></td>
<td><p>Mandatory</p></td>
<td><p>Specifies the file path of the MindSpore Lite model for benchmark testing.</p></td>
<td><p>String</p></td>
<td><p>Null</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--accuracyThreshold=&lt;ACCURACYTHRESHOLD&gt;</span></code></p></td>
<td><p>Optional</p></td>
<td><p>Specifies the accuracy threshold.</p></td>
<td><p>Float</p></td>
<td><p>0.5</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--calibDataPath=&lt;CALIBDATAPATH&gt;</span></code></p></td>
<td><p>Optional</p></td>
<td><p>Specifies the file path of the benchmark data. The benchmark data, as the comparison output of the tested model, is output from the forward inference of the tested model under other deep learning frameworks using the same input.</p></td>
<td><p>String</p></td>
<td><p>Null</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--cpuBindMode=&lt;CPUBINDMODE&gt;</span></code></p></td>
<td><p>Optional</p></td>
<td><p>Specifies the type of the CPU core bound to the model inference program.</p></td>
<td><p>Integer</p></td>
<td><p>1</p></td>
<td><p>−1: medium core<br/>1: large core<br/>0: not bound</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--device=&lt;DEVICE&gt;</span></code></p></td>
<td><p>Optional</p></td>
<td><p>Specifies the type of the device on which the model inference program runs.</p></td>
<td><p>String</p></td>
<td><p>CPU</p></td>
<td><p>CPU or GPU</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--help</span></code></p></td>
<td><p>Optional</p></td>
<td><p>Displays the help information about the <code class="docutils literal notranslate"><span class="pre">benchmark</span></code> command.</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--inDataPath=&lt;INDATAPATH&gt;</span></code></p></td>
<td><p>Optional</p></td>
<td><p>Specifies the file path of the input data of the tested model. If this parameter is not set, a random value will be used.</p></td>
<td><p>String</p></td>
<td><p>Null</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--loopCount=&lt;LOOPCOUNT&gt;</span></code></p></td>
<td><p>Optional</p></td>
<td><p>Specifies the number of forward inference times of the tested model when the Benchmark tool is used for the benchmark testing. The value is a positive integer.</p></td>
<td><p>Integer</p></td>
<td><p>10</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--numThreads=&lt;NUMTHREADS&gt;</span></code></p></td>
<td><p>Optional</p></td>
<td><p>Specifies the number of threads for running the model inference program.</p></td>
<td><p>Integer</p></td>
<td><p>2</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--warmUpLoopCount=&lt;WARMUPLOOPCOUNT&gt;</span></code></p></td>
<td><p>Optional</p></td>
<td><p>Specifies the number of preheating inference times of the tested model before multiple rounds of the benchmark test are executed.</p></td>
<td><p>Integer</p></td>
<td><p>3</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--fp16Priority=&lt;FP16PIORITY&gt;</span></code></p></td>
<td><p>Optional</p></td>
<td><p>Specifies whether the float16 operator is preferred.</p></td>
<td><p>Bool</p></td>
<td><p>false</p></td>
<td><p>true, false</p></td>
</tr>
</tbody>
</table>
</section>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline"></a></h2>
<p>When using the Benchmark tool to perform benchmark testing on different MindSpore Lite models, you can set different parameters to implement different test functions. The testing is classified into performance test and accuracy test.</p>
<section id="performance-test">
<h3>Performance Test<a class="headerlink" href="#performance-test" title="Permalink to this headline"></a></h3>
<p>The main test indicator of the performance test performed by the Benchmark tool is the duration of a single forward inference. In a performance test, you do not need to set benchmark data parameters such as <code class="docutils literal notranslate"><span class="pre">calibDataPath</span></code>. For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./benchmark<span class="w"> </span>--modelPath<span class="o">=</span>./models/test_benchmark.ms
</pre></div>
</div>
<p>This command uses a random input, and other parameters use default values. After this command is executed, the following statistics are displayed. The statistics include the minimum duration, maximum duration, and average duration of a single inference after the tested model runs for the specified number of inference rounds.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Model</span> <span class="o">=</span> <span class="n">test_benchmark</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span> <span class="n">numThreads</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">MinRunTime</span> <span class="o">=</span> <span class="mf">72.228996</span> <span class="n">ms</span><span class="p">,</span> <span class="n">MaxRuntime</span> <span class="o">=</span> <span class="mf">73.094002</span> <span class="n">ms</span><span class="p">,</span> <span class="n">AvgRunTime</span> <span class="o">=</span> <span class="mf">72.556000</span> <span class="n">ms</span>
</pre></div>
</div>
</section>
<section id="accuracy-test">
<h3>Accuracy Test<a class="headerlink" href="#accuracy-test" title="Permalink to this headline"></a></h3>
<p>The accuracy test performed by the Benchmark tool is to verify the accuracy of the MinSpore model output by setting benchmark data. In an accuracy test, in addition to the <code class="docutils literal notranslate"><span class="pre">modelPath</span></code> parameter, the <code class="docutils literal notranslate"><span class="pre">calibDataPath</span></code> parameter must be set. For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./benchmark<span class="w"> </span>--modelPath<span class="o">=</span>./models/test_benchmark.ms<span class="w"> </span>--inDataPath<span class="o">=</span>./input/test_benchmark.bin<span class="w"> </span>--device<span class="o">=</span>CPU<span class="w"> </span>--accuracyThreshold<span class="o">=</span><span class="m">3</span><span class="w"> </span>--calibDataPath<span class="o">=</span>./output/test_benchmark.out
</pre></div>
</div>
<p>This command specifies the input data and benchmark data of the tested model, specifies that the model inference program runs on the CPU, and sets the accuracy threshold to 3%. After this command is executed, the following statistics are displayed, including the single input data of the tested model, output result and average deviation rate of the output node, and average deviation rate of all nodes.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">InData0</span><span class="p">:</span> <span class="mf">139.947</span> <span class="mf">182.373</span> <span class="mf">153.705</span> <span class="mf">138.945</span> <span class="mf">108.032</span> <span class="mf">164.703</span> <span class="mf">111.585</span> <span class="mf">227.402</span> <span class="mf">245.734</span> <span class="mf">97.7776</span> <span class="mf">201.89</span> <span class="mf">134.868</span> <span class="mf">144.851</span> <span class="mf">236.027</span> <span class="mf">18.1142</span> <span class="mf">22.218</span> <span class="mf">5.15569</span> <span class="mf">212.318</span> <span class="mf">198.43</span> <span class="mf">221.853</span>
<span class="o">================</span> <span class="n">Comparing</span> <span class="n">Output</span> <span class="n">data</span> <span class="o">================</span>
<span class="n">Data</span> <span class="n">of</span> <span class="n">node</span> <span class="n">age_out</span> <span class="p">:</span> <span class="mf">5.94584e-08</span> <span class="mf">6.3317e-08</span> <span class="mf">1.94726e-07</span> <span class="mf">1.91809e-07</span> <span class="mf">8.39805e-08</span> <span class="mf">7.66035e-08</span> <span class="mf">1.69285e-07</span> <span class="mf">1.46246e-07</span> <span class="mf">6.03796e-07</span> <span class="mf">1.77631e-07</span> <span class="mf">1.54343e-07</span> <span class="mf">2.04623e-07</span> <span class="mf">8.89609e-07</span> <span class="mf">3.63487e-06</span> <span class="mf">4.86876e-06</span> <span class="mf">1.23939e-05</span> <span class="mf">3.09981e-05</span> <span class="mf">3.37098e-05</span> <span class="mf">0.000107102</span> <span class="mf">0.000213932</span> <span class="mf">0.000533579</span> <span class="mf">0.00062465</span> <span class="mf">0.00296401</span> <span class="mf">0.00993984</span> <span class="mf">0.038227</span> <span class="mf">0.0695085</span> <span class="mf">0.162854</span> <span class="mf">0.123199</span> <span class="mf">0.24272</span> <span class="mf">0.135048</span> <span class="mf">0.169159</span> <span class="mf">0.0221256</span> <span class="mf">0.013892</span> <span class="mf">0.00502971</span> <span class="mf">0.00134921</span> <span class="mf">0.00135701</span> <span class="mf">0.000383242</span> <span class="mf">0.000163475</span> <span class="mf">0.000136294</span> <span class="mf">9.77864e-05</span> <span class="mf">8.00793e-05</span> <span class="mf">5.73874e-05</span> <span class="mf">3.53858e-05</span> <span class="mf">2.18535e-05</span> <span class="mf">2.04467e-05</span> <span class="mf">1.85286e-05</span> <span class="mf">1.05075e-05</span> <span class="mf">9.34751e-06</span> <span class="mf">6.12732e-06</span> <span class="mf">4.55476e-06</span>
<span class="n">Mean</span> <span class="n">bias</span> <span class="n">of</span> <span class="n">node</span> <span class="n">age_out</span> <span class="p">:</span> <span class="mi">0</span><span class="o">%</span>
<span class="n">Mean</span> <span class="n">bias</span> <span class="n">of</span> <span class="nb">all</span> <span class="n">nodes</span><span class="p">:</span> <span class="mi">0</span><span class="o">%</span>
<span class="o">=======================================================</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="runtime.html" class="btn btn-neutral float-left" title="Runtime User Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="timeprofiler_tool.html" class="btn btn-neutral float-right" title="TimeProfiler Tool" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, MindSpore Lite.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>