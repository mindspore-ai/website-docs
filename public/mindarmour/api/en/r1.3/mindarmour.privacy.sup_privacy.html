<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>mindarmour.privacy.sup_privacy &mdash; MindSpore master documentation</title><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="mindarmour.utils" href="mindarmour.utils.html" />
    <link rel="prev" title="mindarmour.privacy.evaluation" href="mindarmour.privacy.evaluation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> MindSpore
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="mindarmour.html">mindarmour</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindarmour.adv_robustness.attacks.html">mindarmour.adv_robustness.attacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindarmour.adv_robustness.defenses.html">mindarmour.adv_robustness.defenses</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindarmour.adv_robustness.detectors.html">mindarmour.adv_robustness.detectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindarmour.adv_robustness.evaluations.html">mindarmour.adv_robustness.evaluations</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindarmour.fuzz_testing.html">mindarmour.fuzz_testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindarmour.privacy.diff_privacy.html">mindarmour.privacy.diff_privacy</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindarmour.privacy.evaluation.html">mindarmour.privacy.evaluation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">mindarmour.privacy.sup_privacy</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindarmour.utils.html">mindarmour.utils</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MindSpore</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>mindarmour.privacy.sup_privacy</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/mindarmour.privacy.sup_privacy.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-mindarmour.privacy.sup_privacy">
<span id="mindarmour-privacy-sup-privacy"></span><h1>mindarmour.privacy.sup_privacy<a class="headerlink" href="#module-mindarmour.privacy.sup_privacy" title="Permalink to this headline"></a></h1>
<p>This module provides Suppress Privacy feature to protect user privacy.</p>
<dl class="py class">
<dt class="sig sig-object py" id="mindarmour.privacy.sup_privacy.MaskLayerDes">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mindarmour.privacy.sup_privacy.</span></span><span class="sig-name descname"><span class="pre">MaskLayerDes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">layer_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grad_idx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">is_add_noise</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">is_lower_clip</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_num</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">upper_bound</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.2</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindarmour/privacy/sup_privacy/sup_ctrl/conctrl.html#MaskLayerDes"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindarmour.privacy.sup_privacy.MaskLayerDes" title="Permalink to this definition"></a></dt>
<dd><p>Describe the layer that need to be suppressed.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>layer_name</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – <p>Layer name, get the name of one layer as following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">networks</span><span class="o">.</span><span class="n">get_parameters</span><span class="p">(</span><span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;conv&quot;</span><span class="p">:</span> <span class="o">...</span>
</pre></div>
</div>
</p></li>
<li><p><strong>grad_idx</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – Grad layer index, get mask layer’s index in grad tuple.You can refer to the construct function
of TrainOneStepCell in mindarmour/privacy/sup_privacy/train/model.py to get the index of some specified
grad layers (print in PYNATIVE_MODE).</p></li>
<li><p><strong>is_add_noise</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a>) – If True, the weight of this layer can add noise.
If False, the weight of this layer can not add noise.
If parameter num is greater than 100000, is_add_noise has no effect.</p></li>
<li><p><strong>is_lower_clip</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a>) – If True, the weights of this layer would be clipped to greater than an lower bound value.
If False, the weights of this layer won’t be clipped.
If parameter num is greater than 100000, is_lower_clip has no effect.</p></li>
<li><p><strong>min_num</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – The number of weights left that not be suppressed.
If min_num is smaller than (parameter num*SupperssCtrl.sparse_end), min_num has no effect.</p></li>
<li><p><strong>upper_bound</strong> (<em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/library/functions.html#float" title="(in Python v3.8)"><em>float</em></a><em>, </em><a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>]</em>) – Max abs value of weight in this layer, default: 1.20.
If parameter num is greater than 100000, upper_bound has no effect.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mindarmour.privacy.sup_privacy.SuppressCtrl">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mindarmour.privacy.sup_privacy.</span></span><span class="sig-name descname"><span class="pre">SuppressCtrl</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">networks</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask_layers</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_epoch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_num</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_epoch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask_times</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sparse_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sparse_start</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindarmour/privacy/sup_privacy/sup_ctrl/conctrl.html#SuppressCtrl"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindarmour.privacy.sup_privacy.SuppressCtrl" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>networks</strong> (<em>Cell</em>) – The training network.</p></li>
<li><p><strong>mask_layers</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#list" title="(in Python v3.8)"><em>list</em></a>) – Description of those layers that need to be suppressed.</p></li>
<li><p><strong>end_epoch</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – The last epoch in suppress operations.</p></li>
<li><p><strong>batch_num</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – The num of grad operation in an epoch.</p></li>
<li><p><strong>start_epoch</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – The first epoch in suppress operations.</p></li>
<li><p><strong>mask_times</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – The num of suppress operations.</p></li>
<li><p><strong>lr</strong> (<em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/library/functions.html#float" title="(in Python v3.8)"><em>float</em></a><em>, </em><a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>]</em>) – Learning rate.</p></li>
<li><p><strong>sparse_end</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#float" title="(in Python v3.8)"><em>float</em></a>) – The sparsity to reach.</p></li>
<li><p><strong>sparse_start</strong> (<em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/library/functions.html#float" title="(in Python v3.8)"><em>float</em></a><em>, </em><a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>]</em>) – The sparsity to start.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mindarmour.privacy.sup_privacy.SuppressCtrl.calc_actual_sparse_for_conv">
<span class="sig-name descname"><span class="pre">calc_actual_sparse_for_conv</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">networks</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindarmour/privacy/sup_privacy/sup_ctrl/conctrl.html#SuppressCtrl.calc_actual_sparse_for_conv"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindarmour.privacy.sup_privacy.SuppressCtrl.calc_actual_sparse_for_conv" title="Permalink to this definition"></a></dt>
<dd><p>Compute actually sparsity of network for conv1 layer and conv2 layer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>networks</strong> (<em>Cell</em>) – The training network.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mindarmour.privacy.sup_privacy.SuppressCtrl.calc_actual_sparse_for_layer">
<span class="sig-name descname"><span class="pre">calc_actual_sparse_for_layer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">networks</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">layer_name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindarmour/privacy/sup_privacy/sup_ctrl/conctrl.html#SuppressCtrl.calc_actual_sparse_for_layer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindarmour.privacy.sup_privacy.SuppressCtrl.calc_actual_sparse_for_layer" title="Permalink to this definition"></a></dt>
<dd><p>Compute actually sparsity of one network layer</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>networks</strong> (<em>Cell</em>) – The training network.</p></li>
<li><p><strong>layer_name</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – The name of target layer.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mindarmour.privacy.sup_privacy.SuppressCtrl.calc_theoretical_sparse_for_conv">
<span class="sig-name descname"><span class="pre">calc_theoretical_sparse_for_conv</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindarmour/privacy/sup_privacy/sup_ctrl/conctrl.html#SuppressCtrl.calc_theoretical_sparse_for_conv"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindarmour.privacy.sup_privacy.SuppressCtrl.calc_theoretical_sparse_for_conv" title="Permalink to this definition"></a></dt>
<dd><p>Compute actually sparsity of mask matrix for conv1 layer and conv2 layer.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mindarmour.privacy.sup_privacy.SuppressCtrl.print_paras">
<span class="sig-name descname"><span class="pre">print_paras</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindarmour/privacy/sup_privacy/sup_ctrl/conctrl.html#SuppressCtrl.print_paras"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindarmour.privacy.sup_privacy.SuppressCtrl.print_paras" title="Permalink to this definition"></a></dt>
<dd><p>Show parameters info</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mindarmour.privacy.sup_privacy.SuppressCtrl.reset_zeros">
<span class="sig-name descname"><span class="pre">reset_zeros</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindarmour/privacy/sup_privacy/sup_ctrl/conctrl.html#SuppressCtrl.reset_zeros"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindarmour.privacy.sup_privacy.SuppressCtrl.reset_zeros" title="Permalink to this definition"></a></dt>
<dd><p>Set add mask arrays to be zero.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mindarmour.privacy.sup_privacy.SuppressCtrl.update_mask">
<span class="sig-name descname"><span class="pre">update_mask</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">networks</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cur_step</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_sparse</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindarmour/privacy/sup_privacy/sup_ctrl/conctrl.html#SuppressCtrl.update_mask"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindarmour.privacy.sup_privacy.SuppressCtrl.update_mask" title="Permalink to this definition"></a></dt>
<dd><p>Update add mask arrays and multiply mask arrays of network layers.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>networks</strong> (<em>Cell</em>) – The training network.</p></li>
<li><p><strong>cur_step</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – Current epoch of the whole training process.</p></li>
<li><p><strong>target_sparse</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#float" title="(in Python v3.8)"><em>float</em></a>) – The sparsity to reach. Default: 0.0.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mindarmour.privacy.sup_privacy.SuppressCtrl.update_mask_layer">
<span class="sig-name descname"><span class="pre">update_mask_layer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">weight_array_flat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sparse_weight_thd</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sparse_stop_pos</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight_abs_max</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">layer_index</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindarmour/privacy/sup_privacy/sup_ctrl/conctrl.html#SuppressCtrl.update_mask_layer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindarmour.privacy.sup_privacy.SuppressCtrl.update_mask_layer" title="Permalink to this definition"></a></dt>
<dd><p>Update add mask arrays and multiply mask arrays of one single layer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>weight_array_flat</strong> (<a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.17)"><em>numpy.ndarray</em></a>) – The weight array of layer’s parameters.</p></li>
<li><p><strong>sparse_weight_thd</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#float" title="(in Python v3.8)"><em>float</em></a>) – The weight threshold of sparse operation.</p></li>
<li><p><strong>sparse_stop_pos</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – The maximum number of elements to be suppressed.</p></li>
<li><p><strong>weight_abs_max</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#float" title="(in Python v3.8)"><em>float</em></a>) – The maximum absolute value of weights.</p></li>
<li><p><strong>layer_index</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – The index of target layer.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mindarmour.privacy.sup_privacy.SuppressCtrl.update_mask_layer_approximity">
<span class="sig-name descname"><span class="pre">update_mask_layer_approximity</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">weight_array_flat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight_array_flat_abs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">actual_stop_pos</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">layer_index</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindarmour/privacy/sup_privacy/sup_ctrl/conctrl.html#SuppressCtrl.update_mask_layer_approximity"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindarmour.privacy.sup_privacy.SuppressCtrl.update_mask_layer_approximity" title="Permalink to this definition"></a></dt>
<dd><p>Update add mask arrays and multiply mask arrays of one single layer with many parameter.
Disable clipping lower, clipping, adding noise operation</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>weight_array_flat</strong> (<a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.17)"><em>numpy.ndarray</em></a>) – The weight array of layer’s parameters.</p></li>
<li><p><strong>weight_array_flat_abs</strong> (<a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.17)"><em>numpy.ndarray</em></a>) – The abs weight array of layer’s parameters.</p></li>
<li><p><strong>actual_stop_pos</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – The actually para num should be suppressed.</p></li>
<li><p><strong>layer_index</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – The index of target layer.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mindarmour.privacy.sup_privacy.SuppressCtrl.update_status">
<span class="sig-name descname"><span class="pre">update_status</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cur_epoch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cur_step</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cur_step_in_epoch</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindarmour/privacy/sup_privacy/sup_ctrl/conctrl.html#SuppressCtrl.update_status"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindarmour.privacy.sup_privacy.SuppressCtrl.update_status" title="Permalink to this definition"></a></dt>
<dd><p>Update the suppress operation status.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cur_epoch</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – Current epoch of the whole training process.</p></li>
<li><p><strong>cur_step</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – Current step of the whole training process.</p></li>
<li><p><strong>cur_step_in_epoch</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – Current step of the current epoch.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mindarmour.privacy.sup_privacy.SuppressMasker">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mindarmour.privacy.sup_privacy.</span></span><span class="sig-name descname"><span class="pre">SuppressMasker</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">suppress_ctrl</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindarmour/privacy/sup_privacy/mask_monitor/masker.html#SuppressMasker"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindarmour.privacy.sup_privacy.SuppressMasker" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>args</strong> (<em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>, </em><a class="reference external" href="https://docs.python.org/library/functions.html#float" title="(in Python v3.8)"><em>float</em></a><em>, </em><a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.17)"><em>numpy.ndarray</em></a><em>, </em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#list" title="(in Python v3.8)"><em>list</em></a><em>, </em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>]</em>) – Parameters
used for creating a suppress privacy monitor.</p></li>
<li><p><strong>kwargs</strong> (<em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>, </em><a class="reference external" href="https://docs.python.org/library/functions.html#float" title="(in Python v3.8)"><em>float</em></a><em>, </em><a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.17)"><em>numpy.ndarray</em></a><em>, </em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#list" title="(in Python v3.8)"><em>list</em></a><em>, </em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>]</em>) – Keyword
parameters used for creating a suppress privacy monitor.</p></li>
<li><p><strong>model</strong> (<a class="reference internal" href="#mindarmour.privacy.sup_privacy.SuppressModel" title="mindarmour.privacy.sup_privacy.SuppressModel"><em>SuppressModel</em></a>) – SuppressModel instance.</p></li>
<li><p><strong>suppress_ctrl</strong> (<a class="reference internal" href="#mindarmour.privacy.sup_privacy.SuppressCtrl" title="mindarmour.privacy.sup_privacy.SuppressCtrl"><em>SuppressCtrl</em></a>) – SuppressCtrl instance.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">networks_l5</span> <span class="o">=</span> <span class="n">LeNet5</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">masklayers</span> <span class="o">=</span> <span class="p">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">masklayers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MaskLayerDes</span><span class="p">(</span><span class="s2">&quot;conv1.weight&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">suppress_ctrl_instance</span> <span class="o">=</span> <span class="n">SuppressPrivacyFactory</span><span class="p">()</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">networks</span><span class="o">=</span><span class="n">networks_l5</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                                    <span class="n">mask_layers</span><span class="o">=</span><span class="n">masklayers</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                                    <span class="n">policy</span><span class="o">=</span><span class="s2">&quot;local_train&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                                    <span class="n">end_epoch</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                                    <span class="n">batch_num</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">)(</span><span class="mi">10000</span><span class="o">/</span><span class="n">cfg</span><span class="o">.</span><span class="n">batch_size</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>                                                    <span class="n">start_epoch</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                                    <span class="n">mask_times</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                                    <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                                    <span class="n">sparse_end</span><span class="o">=</span><span class="mf">0.90</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                                    <span class="n">sparse_start</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net_loss</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">SoftmaxCrossEntropyWithLogits</span><span class="p">(</span><span class="n">sparse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">reduction</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net_opt</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Momentum</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">networks_l5</span><span class="o">.</span><span class="n">trainable_params</span><span class="p">(),</span> <span class="n">learning_rate</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">config_ck</span> <span class="o">=</span> <span class="n">CheckpointConfig</span><span class="p">(</span><span class="n">save_checkpoint_steps</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">)(</span><span class="n">samples</span><span class="o">/</span><span class="n">cfg</span><span class="o">.</span><span class="n">batch_size</span><span class="p">),</span>  <span class="n">keep_checkpoint_max</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model_instance</span> <span class="o">=</span> <span class="n">SuppressModel</span><span class="p">(</span><span class="n">network</span><span class="o">=</span><span class="n">networks_l5</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                           <span class="n">loss_fn</span><span class="o">=</span><span class="n">net_loss</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                           <span class="n">optimizer</span><span class="o">=</span><span class="n">net_opt</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                           <span class="n">metrics</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Accuracy&quot;</span><span class="p">:</span> <span class="n">Accuracy</span><span class="p">()})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model_instance</span><span class="o">.</span><span class="n">link_suppress_ctrl</span><span class="p">(</span><span class="n">suppress_ctrl_instance</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ds_train</span> <span class="o">=</span> <span class="n">generate_mnist_dataset</span><span class="p">(</span><span class="s2">&quot;./MNIST_unzip/train&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                <span class="n">batch_size</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">repeat_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="n">samples</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ckpoint_cb</span> <span class="o">=</span> <span class="n">ModelCheckpoint</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;checkpoint_lenet&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                         <span class="n">directory</span><span class="o">=</span><span class="s2">&quot;./trained_ckpt_file/&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                         <span class="n">config</span><span class="o">=</span><span class="n">config_ck</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model_instance</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">epoch_size</span><span class="p">,</span> <span class="n">ds_train</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">ckpoint_cb</span><span class="p">,</span> <span class="n">LossMonitor</span><span class="p">(),</span> <span class="n">suppress_masker</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>                 <span class="n">dataset_sink_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="mindarmour.privacy.sup_privacy.SuppressMasker.step_end">
<span class="sig-name descname"><span class="pre">step_end</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">run_context</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindarmour/privacy/sup_privacy/mask_monitor/masker.html#SuppressMasker.step_end"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindarmour.privacy.sup_privacy.SuppressMasker.step_end" title="Permalink to this definition"></a></dt>
<dd><p>Update mask matrix tensor used for SuppressModel instance.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>run_context</strong> (<em>RunContext</em>) – Include some information of the model.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mindarmour.privacy.sup_privacy.SuppressModel">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mindarmour.privacy.sup_privacy.</span></span><span class="sig-name descname"><span class="pre">SuppressModel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">network</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loss_fn</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optimizer</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindarmour/privacy/sup_privacy/train/model.html#SuppressModel"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindarmour.privacy.sup_privacy.SuppressModel" title="Permalink to this definition"></a></dt>
<dd><p>This class is overload mindspore.train.model.Model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>network</strong> (<em>Cell</em>) – The training network.</p></li>
<li><p><strong>loss_fn</strong> (<em>Cell</em>) – Computes softmax cross entropy between logits and labels.</p></li>
<li><p><strong>optimizer</strong> (<em>Optimizer</em>) – optimizer instance.</p></li>
<li><p><strong>metrics</strong> (<em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#dict" title="(in Python v3.8)"><em>dict</em></a><em>, </em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#set" title="(in Python v3.8)"><em>set</em></a><em>]</em>) – Calculates the accuracy for classification and multilabel data.</p></li>
<li><p><strong>kwargs</strong> – Keyword parameters used for creating a suppress model.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">networks_l5</span> <span class="o">=</span> <span class="n">LeNet5</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mask_layers</span> <span class="o">=</span> <span class="p">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mask_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MaskLayerDes</span><span class="p">(</span><span class="s2">&quot;conv1.weight&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">suppress_ctrl_instance</span> <span class="o">=</span> <span class="n">SuppressPrivacyFactory</span><span class="p">()</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">networks</span><span class="o">=</span><span class="n">networks_l5</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                                    <span class="n">mask_layers</span><span class="o">=</span><span class="n">mask_layers</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                                    <span class="n">policy</span><span class="o">=</span><span class="s2">&quot;local_train&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                                    <span class="n">end_epoch</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                                    <span class="n">batch_num</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">)(</span><span class="mi">10000</span><span class="o">/</span><span class="n">cfg</span><span class="o">.</span><span class="n">batch_size</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>                                                    <span class="n">start_epoch</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                                    <span class="n">mask_times</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                                    <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                                    <span class="n">sparse_end</span><span class="o">=</span><span class="mf">0.90</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                                    <span class="n">sparse_start</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net_loss</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">SoftmaxCrossEntropyWithLogits</span><span class="p">(</span><span class="n">sparse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">reduction</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net_opt</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Momentum</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">networks_l5</span><span class="o">.</span><span class="n">trainable_params</span><span class="p">(),</span> <span class="n">learning_rate</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">config_ck</span> <span class="o">=</span> <span class="n">CheckpointConfig</span><span class="p">(</span><span class="n">save_checkpoint_steps</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">)(</span><span class="n">samples</span><span class="o">/</span><span class="n">cfg</span><span class="o">.</span><span class="n">batch_size</span><span class="p">),</span>  <span class="n">keep_checkpoint_max</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model_instance</span> <span class="o">=</span> <span class="n">SuppressModel</span><span class="p">(</span><span class="n">network</span><span class="o">=</span><span class="n">networks_l5</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                           <span class="n">loss_fn</span><span class="o">=</span><span class="n">net_loss</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                           <span class="n">optimizer</span><span class="o">=</span><span class="n">net_opt</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                           <span class="n">metrics</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Accuracy&quot;</span><span class="p">:</span> <span class="n">Accuracy</span><span class="p">()})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model_instance</span><span class="o">.</span><span class="n">link_suppress_ctrl</span><span class="p">(</span><span class="n">suppress_ctrl_instance</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ds_train</span> <span class="o">=</span> <span class="n">generate_mnist_dataset</span><span class="p">(</span><span class="s2">&quot;./MNIST_unzip/train&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                <span class="n">batch_size</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">repeat_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="n">samples</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ckpoint_cb</span> <span class="o">=</span> <span class="n">ModelCheckpoint</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;checkpoint_lenet&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                         <span class="n">directory</span><span class="o">=</span><span class="s2">&quot;./trained_ckpt_file/&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                         <span class="n">config</span><span class="o">=</span><span class="n">config_ck</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model_instance</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">epoch_size</span><span class="p">,</span> <span class="n">ds_train</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">ckpoint_cb</span><span class="p">,</span> <span class="n">LossMonitor</span><span class="p">(),</span> <span class="n">suppress_masker</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>                 <span class="n">dataset_sink_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="mindarmour.privacy.sup_privacy.SuppressModel.link_suppress_ctrl">
<span class="sig-name descname"><span class="pre">link_suppress_ctrl</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">suppress_pri_ctrl</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindarmour/privacy/sup_privacy/train/model.html#SuppressModel.link_suppress_ctrl"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindarmour.privacy.sup_privacy.SuppressModel.link_suppress_ctrl" title="Permalink to this definition"></a></dt>
<dd><p>Link self and SuppressCtrl instance.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>suppress_pri_ctrl</strong> (<a class="reference internal" href="#mindarmour.privacy.sup_privacy.SuppressCtrl" title="mindarmour.privacy.sup_privacy.SuppressCtrl"><em>SuppressCtrl</em></a>) – SuppressCtrl instance.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mindarmour.privacy.sup_privacy.SuppressPrivacyFactory">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mindarmour.privacy.sup_privacy.</span></span><span class="sig-name descname"><span class="pre">SuppressPrivacyFactory</span></span><a class="reference internal" href="_modules/mindarmour/privacy/sup_privacy/sup_ctrl/conctrl.html#SuppressPrivacyFactory"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindarmour.privacy.sup_privacy.SuppressPrivacyFactory" title="Permalink to this definition"></a></dt>
<dd><p>Factory class of SuppressCtrl mechanisms</p>
<dl class="py method">
<dt class="sig sig-object py" id="mindarmour.privacy.sup_privacy.SuppressPrivacyFactory.create">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">create</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">networks</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask_layers</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">policy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'local_train'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_epoch</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_num</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_epoch</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask_times</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.05</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sparse_end</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.9</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sparse_start</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindarmour/privacy/sup_privacy/sup_ctrl/conctrl.html#SuppressPrivacyFactory.create"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindarmour.privacy.sup_privacy.SuppressPrivacyFactory.create" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>networks</strong> (<em>Cell</em>) – The training network.
This networks parameter should be same as ‘network’ parameter of SuppressModel().</p></li>
<li><p><strong>mask_layers</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#list" title="(in Python v3.8)"><em>list</em></a>) – Description of the training network layers that need to be suppressed.</p></li>
<li><p><strong>policy</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – Training policy for suppress privacy training. Default: “local_train”, means local training.</p></li>
<li><p><strong>end_epoch</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – The last epoch in suppress operations, 0&lt;start_epoch&lt;=end_epoch&lt;=100. Default: 10.
This end_epoch parameter should be same as ‘epoch’ parameter of mindspore.train.model.train().</p></li>
<li><p><strong>batch_num</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – The num of batch in an epoch, should be equal to num_samples/batch_size. Default: 20.</p></li>
<li><p><strong>start_epoch</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – The first epoch in suppress operations, 0&lt;start_epoch&lt;=end_epoch&lt;=100. Default: 3.</p></li>
<li><p><strong>mask_times</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – The num of suppress operations. Default: 1000.</p></li>
<li><p><strong>lr</strong> (<em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/library/functions.html#float" title="(in Python v3.8)"><em>float</em></a><em>, </em><a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>]</em>) – Learning rate, should be unchanged during training. 0&lt;lr&lt;=0.50. Default: 0.05.
This lr parameter should be same as ‘learning_rate’ parameter of mindspore.nn.SGD().</p></li>
<li><p><strong>sparse_end</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#float" title="(in Python v3.8)"><em>float</em></a>) – The sparsity to reach, 0.0&lt;=sparse_start&lt;sparse_end&lt;1.0. Default: 0.90.</p></li>
<li><p><strong>sparse_start</strong> (<em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/library/functions.html#float" title="(in Python v3.8)"><em>float</em></a><em>, </em><a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>]</em>) – The sparsity to start, 0.0&lt;=sparse_start&lt;sparse_end&lt;1.0. Default: 0.0.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>SuppressCtrl, class of Suppress Privavy Mechanism.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">networks_l5</span> <span class="o">=</span> <span class="n">LeNet5</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mask_layers</span> <span class="o">=</span> <span class="p">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mask_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MaskLayerDes</span><span class="p">(</span><span class="s2">&quot;conv1.weight&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">suppress_ctrl_instance</span> <span class="o">=</span> <span class="n">SuppressPrivacyFactory</span><span class="p">()</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">networks</span><span class="o">=</span><span class="n">networks_l5</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                                <span class="n">mask_layers</span><span class="o">=</span><span class="n">mask_layers</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                                <span class="n">policy</span><span class="o">=</span><span class="s2">&quot;local_train&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                                <span class="n">end_epoch</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                                <span class="n">batch_num</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">)(</span><span class="mi">10000</span><span class="o">/</span><span class="n">cfg</span><span class="o">.</span><span class="n">batch_size</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>                                                <span class="n">start_epoch</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                                <span class="n">mask_times</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                                <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                                <span class="n">sparse_end</span><span class="o">=</span><span class="mf">0.90</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                                <span class="n">sparse_start</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net_loss</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">SoftmaxCrossEntropyWithLogits</span><span class="p">(</span><span class="n">sparse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">reduction</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net_opt</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Momentum</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">networks_l5</span><span class="o">.</span><span class="n">trainable_params</span><span class="p">(),</span> <span class="n">learning_rate</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">config_ck</span> <span class="o">=</span> <span class="n">CheckpointConfig</span><span class="p">(</span><span class="n">save_checkpoint_steps</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">)(</span><span class="n">samples</span><span class="o">/</span><span class="n">cfg</span><span class="o">.</span><span class="n">batch_size</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>                             <span class="n">keep_checkpoint_max</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model_instance</span> <span class="o">=</span> <span class="n">SuppressModel</span><span class="p">(</span><span class="n">network</span><span class="o">=</span><span class="n">networks_l5</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                            <span class="n">loss_fn</span><span class="o">=</span><span class="n">net_loss</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                            <span class="n">optimizer</span><span class="o">=</span><span class="n">net_opt</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                            <span class="n">metrics</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Accuracy&quot;</span><span class="p">:</span> <span class="n">Accuracy</span><span class="p">()})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model_instance</span><span class="o">.</span><span class="n">link_suppress_ctrl</span><span class="p">(</span><span class="n">suppress_ctrl_instance</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ds_train</span> <span class="o">=</span> <span class="n">generate_mnist_dataset</span><span class="p">(</span><span class="s2">&quot;./MNIST_unzip/train&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                                <span class="n">batch_size</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">repeat_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="n">samples</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ckpoint_cb</span> <span class="o">=</span> <span class="n">ModelCheckpoint</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;checkpoint_lenet&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                            <span class="n">directory</span><span class="o">=</span><span class="s2">&quot;./trained_ckpt_file/&quot;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                            <span class="n">config</span><span class="o">=</span><span class="n">config_ck</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model_instance</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">epoch_size</span><span class="p">,</span> <span class="n">ds_train</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">ckpoint_cb</span><span class="p">,</span> <span class="n">LossMonitor</span><span class="p">(),</span> <span class="n">suppress_masker</span><span class="p">],</span>
<span class="gp">&gt;&gt;&gt; </span>                <span class="n">dataset_sink_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="mindarmour.privacy.evaluation.html" class="btn btn-neutral float-left" title="mindarmour.privacy.evaluation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="mindarmour.utils.html" class="btn btn-neutral float-right" title="mindarmour.utils" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, MindSpore.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>