<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Evaluating the Robustness of the OCR Model CNN-CTC &mdash; MindSpore master documentation</title><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Dynamic Model Obfuscation" href="dynamic_obfuscation_protection.html" />
    <link rel="prev" title="Testing Model Security Using Fuzz Testing" href="test_model_security_fuzzing.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> MindSpore
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="mindarmour_install.html">MindSpore Armour Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AI Security</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="improve_model_security_nad.html">Improving Model Security with NAD Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="test_model_security_fuzzing.html">Testing Model Security Using Fuzz Testing</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Evaluating the Robustness of the OCR Model CNN-CTC</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#environment-requirements">Environment Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#script-description">Script Description</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#code-structure">Code Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#script-parameters">Script Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#model-and-data">Model and Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#generating-an-evaluation-dataset-based-on-natural-perturbation-serving">Generating an Evaluation Dataset based on Natural Perturbation Serving</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cnn-ctc-model-inference-on-the-generated-perturbation-dataset">CNN-CTC Model Inference on the Generated Perturbation Dataset</a></li>
<li class="toctree-l3"><a class="reference internal" href="#robustness-analysis">Robustness Analysis</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dynamic_obfuscation_protection.html">Dynamic Model Obfuscation</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_encrypt_protection.html">Model Encryption Protection</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AI Privacy</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="protect_user_privacy_with_differential_privacy.html">Protecting User Privacy with Differential Privacy Mechanism</a></li>
<li class="toctree-l1"><a class="reference internal" href="protect_user_privacy_with_suppress_privacy.html">Protecting User Privacy with Suppress Privacy</a></li>
<li class="toctree-l1"><a class="reference internal" href="test_model_security_membership_inference.html">Using Membership Inference to Test Model Security</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AI Reliability</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="concept_drift_time_series.html">Implementing the Concept Drift Detection Application of Time Series Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="concept_drift_images.html">Implementing the Concept Drift Detection Application of Image Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="fault_injection.html">Implementing the Model Fault Injection and Evaluation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="mindarmour.html">mindarmour</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindarmour.adv_robustness.attacks.html">mindarmour.adv_robustness.attacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindarmour.adv_robustness.defenses.html">mindarmour.adv_robustness.defenses</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindarmour.adv_robustness.detectors.html">mindarmour.adv_robustness.detectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindarmour.adv_robustness.evaluations.html">mindarmour.adv_robustness.evaluations</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindarmour.fuzz_testing.html">mindarmour.fuzz_testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindarmour.natural_robustness.transform.image.html">mindarmour.natural_robustness.transform.image</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindarmour.privacy.diff_privacy.html">mindarmour.privacy.diff_privacy</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindarmour.privacy.evaluation.html">mindarmour.privacy.evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindarmour.privacy.sup_privacy.html">mindarmour.privacy.sup_privacy</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindarmour.reliability.html">mindarmour.reliability</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindarmour.utils.html">mindarmour.utils</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="design.html">Overall Security and Trustworthiness Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="differential_privacy_design.html">Differential Privacy Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="fuzzer_design.html">AI Model Security Testing Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="security_and_privacy.html">MindSpore Armour Module Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">RELEASE NOTES</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="RELEASE.html">Release Notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MindSpore</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Evaluating the Robustness of the OCR Model CNN-CTC</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/evaluation_of_CNNCTC.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="evaluating-the-robustness-of-the-ocr-model-cnn-ctc">
<h1>Evaluating the Robustness of the OCR Model CNN-CTC<a class="headerlink" href="#evaluating-the-robustness-of-the-ocr-model-cnn-ctc" title="Permalink to this headline"></a></h1>
<p><a href="https://gitee.com/mindspore/docs/blob/r2.0/docs/mindarmour/docs/source_en/evaluation_of_CNNCTC.md" target="_blank"><img src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/r2.0/resource/_static/logo_source.png"></a></p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline"></a></h2>
<p>This tutorial uses natural perturbation serving to evaluate the robustness of the OCR model, CNN-CTC. Multiple natural perturbation sample datasets are generated based on serving, and then the robustness of the CNN-CTC model is evaluated based on the model performance on the natural perturbation sample datasets.</p>
<blockquote>
<div><p>You can obtain the complete executable sample code at <a class="reference external" href="https://gitee.com/mindspore/mindarmour/tree/r2.0/examples/natural_robustness/ocr_evaluate">https://gitee.com/mindspore/mindarmour/tree/r2.0/examples/natural_robustness/ocr_evaluate</a>.</p>
</div></blockquote>
</section>
<section id="environment-requirements">
<h2>Environment Requirements<a class="headerlink" href="#environment-requirements" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Hardware</p>
<ul>
<li><p>Prepare the Ascend/GPU processor to set up the hardware environment.</p></li>
</ul>
</li>
<li><p>Dependencies</p>
<ul>
<li><p><a class="reference external" href="https://www.mindspore.cn/install/en">MindSpore</a></p></li>
<li><p>MindSpore Serving 1.6.0 or later</p></li>
<li><p>MindArmour</p></li>
</ul>
</li>
</ul>
</section>
<section id="script-description">
<h2>Script Description<a class="headerlink" href="#script-description" title="Permalink to this headline"></a></h2>
<section id="code-structure">
<h3>Code Structure<a class="headerlink" href="#code-structure" title="Permalink to this headline"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="p">|</span>--<span class="w"> </span>natural_robustness
<span class="w">    </span><span class="p">|</span>--<span class="w"> </span>serving<span class="w">                         </span><span class="c1"># Serving for generating natural perturbation samples.</span>
<span class="w">    </span><span class="p">|</span>--<span class="w"> </span>ocr_evaluate
<span class="w">        </span><span class="p">|</span>--<span class="w"> </span>cnn_ctc<span class="w">                     </span><span class="c1"># Directory for model training, inference, pre-processing, and post-processing.</span>
<span class="w">        </span><span class="p">|</span>--<span class="w"> </span>data<span class="w">                        </span><span class="c1"># Experiment analysis data.</span>
<span class="w">        </span><span class="p">|</span>--<span class="w"> </span>default_config.yaml<span class="w">         </span><span class="c1"># Parameter configuration.</span>
<span class="w">        </span><span class="p">|</span>--<span class="w"> </span>generate_adv_samples.py<span class="w">     </span><span class="c1"># Script for generating natural perturbation samples.</span>
<span class="w">        </span><span class="p">|</span>--<span class="w"> </span>eval_and_save.py<span class="w">            </span><span class="c1"># Script for CNN-CTC to perform inference on the perturbation sample and save the inference result.</span>
<span class="w">        </span><span class="p">|</span>--<span class="w"> </span>analyse.py<span class="w">                  </span><span class="c1"># Script for analyzing the robustness of the CNN-CTC model.</span>
</pre></div>
</div>
</section>
<section id="script-parameters">
<h3>Script Parameters<a class="headerlink" href="#script-parameters" title="Permalink to this headline"></a></h3>
<p>You can configure training parameters, inference parameters, and robustness evaluation parameters in <code class="docutils literal notranslate"><span class="pre">default_config.yaml</span></code>. We focus on the parameters used in the evaluation and the parameters that need to be configured by users. For details about other parameters, see the <a class="reference external" href="https://gitee.com/mindspore/models/tree/master/research/cv/cnnctc">CNN-CTC Tutorial</a>.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--TEST_DATASET_PATH</span></code>: indicates the path of the test dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--CHECKPOINT_PATH</span></code>: indicates the checkpoint path.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--ADV_TEST_DATASET_PATH</span></code>: indicates the path of the perturbation sample dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--IS_ADV</span></code>: specifies whether to use the perturbation sample for the test.</p></li>
</ul>
</section>
<section id="model-and-data">
<h3>Model and Data<a class="headerlink" href="#model-and-data" title="Permalink to this headline"></a></h3>
<p>The model to be evaluated is the CNN-CTC model implemented based on MindSpore. This model is mainly used for scene text recognition tasks. It uses a CNN model to extract features and uses the connectionist temporal classification (CTC) to predict the output sequence.</p>
<p><a class="reference external" href="https://arxiv.org/abs/1904.01906">Paper</a>: J. Baek, G. Kim, J. Lee, S. Park, D. Han, S. Yun, S. J. Oh, and H. Lee, “What is wrong with scene text recognition model comparisons? dataset and model analysis,” ArXiv, vol. abs/1904.01906, 2019.</p>
<p>For details about data processing and model training, see the <a class="reference external" href="https://gitee.com/mindspore/models/tree/master/research/cv/cnnctc">CNN-CTC Tutorial</a>. You need to obtain the preprocessed dataset and checkpoint model file based on this tutorial for the following evaluation task.</p>
<p>The preprocessed dataset is in .lmdb format and stored in key-value pairs.</p>
<ul class="simple">
<li><p>label- %09d: actual image label</p></li>
<li><p>image- %09d: original image data</p></li>
<li><p>num-samples: number of samples in the LMDB dataset</p></li>
</ul>
<p>In the preceding information, <code class="docutils literal notranslate"><span class="pre">%09d</span></code> indicates a string of 9 digits. Example: label-000000001.</p>
</section>
<section id="generating-an-evaluation-dataset-based-on-natural-perturbation-serving">
<h3>Generating an Evaluation Dataset based on Natural Perturbation Serving<a class="headerlink" href="#generating-an-evaluation-dataset-based-on-natural-perturbation-serving" title="Permalink to this headline"></a></h3>
<ol class="arabic">
<li><p>Start the serving server for generating natural perturbation samples. For details, see <a class="reference external" href="https://gitee.com/mindspore/mindarmour/blob/r2.0/examples/natural_robustness/serving/README.md#">Generating Natural Perturbation Samples Based on the Serving Server</a>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>serving/server/
python<span class="w"> </span>serving_server.py
</pre></div>
</div>
</li>
<li><p>Generate an evaluation dataset based on the serving server.</p>
<ol class="arabic">
<li><p>In <code class="docutils literal notranslate"><span class="pre">default_config.yaml</span></code>, configure the original test sample data path <code class="docutils literal notranslate"><span class="pre">TEST_DATASET_PATH</span></code> and the path to store the generated perturbation sample dataset <code class="docutils literal notranslate"><span class="pre">ADV_TEST_DATASET_PATH</span></code>. Example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">TEST_DATASET_PATH</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/opt/dataset/CNNCTC_data/MJ-ST-IIIT/IIIT5k_3000&quot;</span>
<span class="nt">ADV_TEST_DATASET_PATH</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/home/mindarmour/examples/natural_robustness/ocr_evaluate/data&quot;</span>
</pre></div>
</div>
</li>
<li><p>The core code is described as follows:</p>
<ol class="arabic">
<li><p>Configure the perturbation method. For details about the available perturbation methods and parameter configurations, see <a class="reference external" href="https://gitee.com/mindspore/mindarmour/tree/r2.0/mindarmour/natural_robustness/transform/image">transform/image</a>. The following is a configuration example.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">PerturbConfig</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;Contrast&quot;</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span> <span class="s2">&quot;beta&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}},</span>
    <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;GaussianBlur&quot;</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;ksize&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}},</span>
    <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;SaltAndPepperNoise&quot;</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;factor&quot;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">}},</span>
    <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;Translate&quot;</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;x_bias&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s2">&quot;y_bias&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">}},</span>
    <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;Scale&quot;</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;factor_x&quot;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span> <span class="s2">&quot;factor_y&quot;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">}},</span>
    <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;Shear&quot;</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;factor&quot;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span> <span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="s2">&quot;horizontal&quot;</span><span class="p">}},</span>
    <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;Rotate&quot;</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;angle&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">}},</span>
    <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;MotionBlur&quot;</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;degree&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;angle&quot;</span><span class="p">:</span> <span class="mi">45</span><span class="p">}},</span>
    <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;GradientBlur&quot;</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;point&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="s2">&quot;kernel_num&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;center&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}},</span>
    <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;GradientLuminance&quot;</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;color_start&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span> <span class="s2">&quot;color_end&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;start_point&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">],</span> <span class="s2">&quot;scope&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span> <span class="s2">&quot;bright_rate&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span> <span class="s2">&quot;pattern&quot;</span><span class="p">:</span> <span class="s2">&quot;light&quot;</span><span class="p">,</span> <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;circle&quot;</span><span class="p">}},</span>
    <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;GradientLuminance&quot;</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;color_start&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span> <span class="s2">&quot;color_end&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;start_point&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">150</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span> <span class="s2">&quot;scope&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span> <span class="s2">&quot;pattern&quot;</span><span class="p">:</span> <span class="s2">&quot;light&quot;</span><span class="p">,</span> <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;horizontal&quot;</span><span class="p">}},</span>
    <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;GradientLuminance&quot;</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;color_start&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span> <span class="s2">&quot;color_end&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;start_point&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">150</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span> <span class="s2">&quot;scope&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span> <span class="s2">&quot;pattern&quot;</span><span class="p">:</span> <span class="s2">&quot;light&quot;</span><span class="p">,</span> <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;vertical&quot;</span><span class="p">}},</span>
    <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;Curve&quot;</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;curves&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;depth&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;vertical&quot;</span><span class="p">}},</span>
    <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;Perspective&quot;</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;ori_pos&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">800</span><span class="p">],</span> <span class="p">[</span><span class="mi">800</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">800</span><span class="p">,</span> <span class="mi">800</span><span class="p">]],</span> <span class="s2">&quot;dst_pos&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">800</span><span class="p">],</span> <span class="p">[</span><span class="mi">790</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">800</span><span class="p">,</span> <span class="mi">800</span><span class="p">]]}},</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>Prepare the data to be perturbed.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">instances</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">methods_number</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">outputs_number</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">perturb_config</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">perturb_config</span><span class="p">)</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">lmdb</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">lmdb_paths</span><span class="p">,</span> <span class="n">max_readers</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lock</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">readahead</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">meminit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">env</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cannot create lmdb from </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lmdb_paths</span><span class="p">))</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">begin</span><span class="p">(</span><span class="n">write</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">txn</span><span class="p">:</span>
    <span class="n">n_samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">txn</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;num-samples&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">()))</span>
    <span class="c1"># Filtering</span>
    <span class="n">filtered_labels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">filtered_index_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_samples</span><span class="p">):</span>
        <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># lmdb starts with 1</span>
        <span class="n">label_key</span> <span class="o">=</span> <span class="s1">&#39;label-</span><span class="si">%09d</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="o">%</span> <span class="n">index</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">txn</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">label_key</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_len</span><span class="p">:</span> <span class="k">continue</span>
        <span class="n">illegal_sample</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">char_item</span> <span class="ow">in</span> <span class="n">label</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">char_item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">CHARACTER</span><span class="p">:</span>
                <span class="n">illegal_sample</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">illegal_sample</span><span class="p">:</span> <span class="k">continue</span>
        <span class="n">filtered_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="n">filtered_index_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="n">img_key</span> <span class="o">=</span> <span class="s1">&#39;image-</span><span class="si">%09d</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="o">%</span> <span class="n">index</span>
        <span class="n">imgbuf</span> <span class="o">=</span> <span class="n">txn</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">img_key</span><span class="p">)</span>
        <span class="n">instances</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;img&quot;</span><span class="p">:</span> <span class="n">imgbuf</span><span class="p">,</span> <span class="s1">&#39;perturb_config&#39;</span><span class="p">:</span> <span class="n">perturb_config</span><span class="p">,</span> <span class="s2">&quot;methods_number&quot;</span><span class="p">:</span> <span class="n">methods_number</span><span class="p">,</span>
                          <span class="s2">&quot;outputs_number&quot;</span><span class="p">:</span> <span class="n">outputs_number</span><span class="p">})</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;num of samples in IIIT daaset: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">filtered_index_list</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Request the natural perturbation serving server and save the data returned by the serving server.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ip</span> <span class="o">=</span> <span class="s1">&#39;0.0.0.0:8888&#39;</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="s2">&quot;perturbation&quot;</span><span class="p">,</span> <span class="s2">&quot;natural_perturbation&quot;</span><span class="p">)</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">infer</span><span class="p">(</span><span class="n">instances</span><span class="p">)</span>
<span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;generated natural perturbs images cost: &#39;</span><span class="p">,</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
<span class="n">env_save</span> <span class="o">=</span> <span class="n">lmdb</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">lmdb_save_path</span><span class="p">,</span> <span class="n">map_size</span><span class="o">=</span><span class="mi">1099511627776</span><span class="p">)</span>

<span class="n">txn</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">begin</span><span class="p">(</span><span class="n">write</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">with</span> <span class="n">env_save</span><span class="o">.</span><span class="n">begin</span><span class="p">(</span><span class="n">write</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">txn_save</span><span class="p">:</span>
    <span class="n">new_index</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">filtered_index_list</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">file_names</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;file_names&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;index: &#39;</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">length</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;file_length&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">before</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">filtered_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
        <span class="n">img_key</span> <span class="o">=</span> <span class="s1">&#39;image-</span><span class="si">%09d</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="o">%</span> <span class="n">index</span>
        <span class="n">ori_img</span> <span class="o">=</span> <span class="n">txn</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">img_key</span><span class="p">)</span>
        <span class="n">names_dict</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;names_dict&#39;</span><span class="p">]</span>
        <span class="n">names_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">names_dict</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">leng</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">file_names</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
            <span class="n">label_key</span> <span class="o">=</span> <span class="s1">&#39;label-</span><span class="si">%09d</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="o">%</span> <span class="n">new_index</span>
            <span class="n">txn_save</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">label_key</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
            <span class="n">img_key</span> <span class="o">=</span> <span class="s1">&#39;image-</span><span class="si">%09d</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="o">%</span> <span class="n">new_index</span>
            <span class="n">adv_img</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;results&#39;</span><span class="p">]</span>
            <span class="n">adv_img</span> <span class="o">=</span> <span class="n">adv_img</span><span class="p">[</span><span class="n">before</span><span class="p">:</span><span class="n">before</span> <span class="o">+</span> <span class="n">leng</span><span class="p">]</span>
            <span class="n">adv_img_key</span> <span class="o">=</span> <span class="s1">&#39;adv_image-</span><span class="si">%09d</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="o">%</span> <span class="n">new_index</span>
            <span class="n">txn_save</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">img_key</span><span class="p">,</span> <span class="n">ori_img</span><span class="p">)</span>
            <span class="n">txn_save</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">adv_img_key</span><span class="p">,</span> <span class="n">adv_img</span><span class="p">)</span>

            <span class="n">adv_info_key</span> <span class="o">=</span> <span class="s1">&#39;adv_info-</span><span class="si">%09d</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="o">%</span> <span class="n">new_index</span>
            <span class="n">adv_info</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">names_dict</span><span class="p">[</span><span class="n">name</span><span class="p">])</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
            <span class="n">txn_save</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">adv_info_key</span><span class="p">,</span> <span class="n">adv_info</span><span class="p">)</span>
            <span class="n">before</span> <span class="o">=</span> <span class="n">before</span> <span class="o">+</span> <span class="n">leng</span>
            <span class="n">new_index</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">xn_save</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;num-samples&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span><span class="nb">str</span><span class="p">(</span><span class="n">new_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
<span class="n">env</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</li>
</ol>
</li>
<li><p>Run the script for generating natural perturbation samples.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>generate_adv_samples.py
</pre></div>
</div>
</li>
<li><p>The generated natural perturbation data is in .lmdb format and contains the following data items in key-value pair:</p></li>
</ol>
<ul class="simple">
<li><p>label- %09d: actual image label</p></li>
<li><p>image- %09d: original image data</p></li>
<li><p>adv_image- %09d: perturbed image data</p></li>
<li><p>adv_info- %09d: perturbation information, including perturbation methods and parameters</p></li>
<li><p>num-samples: number of samples in the LMDB dataset</p></li>
</ul>
</li>
</ol>
</section>
<section id="cnn-ctc-model-inference-on-the-generated-perturbation-dataset">
<h3>CNN-CTC Model Inference on the Generated Perturbation Dataset<a class="headerlink" href="#cnn-ctc-model-inference-on-the-generated-perturbation-dataset" title="Permalink to this headline"></a></h3>
<ol class="arabic">
<li><p>In <code class="docutils literal notranslate"><span class="pre">default_config.yaml</span></code>, set the test dataset path <code class="docutils literal notranslate"><span class="pre">TEST_DATASET_PATH</span></code> to be the same as the path of the perturbation sample dataset <code class="docutils literal notranslate"><span class="pre">ADV_TEST_DATASET_PATH</span></code>. Example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">TEST_DATASET_PATH</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;/home/mindarmour/examples/natural_robustness/ocr_evaluate/data&quot;</span>
<span class="nt">ADV_TEST_DATASET_PATH</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/home/mindarmour/examples/natural_robustness/ocr_evaluate/data&quot;</span>
</pre></div>
</div>
</li>
<li><p>The core scripts are described as follows:</p>
<ol class="arabic">
<li><p>Load the model and the dataset.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ds</span> <span class="o">=</span> <span class="n">test_dataset_creator</span><span class="p">(</span><span class="n">is_adv</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">IS_ADV</span><span class="p">)</span>
<span class="n">net</span> <span class="o">=</span> <span class="n">CNNCTC</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">NUM_CLASS</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">HIDDEN_SIZE</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">FINAL_FEATURE_WIDTH</span><span class="p">)</span>

<span class="n">ckpt_path</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">CHECKPOINT_PATH</span>
<span class="n">param_dict</span> <span class="o">=</span> <span class="n">load_checkpoint</span><span class="p">(</span><span class="n">ckpt_path</span><span class="p">)</span>
<span class="n">load_param_into_net</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">param_dict</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;parameters loaded! from: &#39;</span><span class="p">,</span> <span class="n">ckpt_path</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Perform inference and save the inference results of the model on the original sample and perturbation sample.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">env_save</span> <span class="o">=</span> <span class="n">lmdb</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">lmdb_save_path</span><span class="p">,</span> <span class="n">map_size</span><span class="o">=</span><span class="mi">1099511627776</span><span class="p">)</span>
<span class="k">with</span> <span class="n">env_save</span><span class="o">.</span><span class="n">begin</span><span class="p">(</span><span class="n">write</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">txn_save</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">create_tuple_iterator</span><span class="p">():</span>
        <span class="n">img</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="n">data</span>

        <span class="n">img_tensor</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">model_predict</span> <span class="o">=</span> <span class="n">net</span><span class="p">(</span><span class="n">img_tensor</span><span class="p">)</span>
        <span class="n">model_predict</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">model_predict</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">())</span>

        <span class="n">preds_size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">model_predict</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="n">config</span><span class="o">.</span><span class="n">TEST_BATCH_SIZE</span><span class="p">)</span>
        <span class="n">preds_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">model_predict</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">preds_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">preds_index</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">preds_str</span> <span class="o">=</span> <span class="n">converter</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">preds_index</span><span class="p">,</span> <span class="n">preds_size</span><span class="p">)</span>
        <span class="n">label_str</span> <span class="o">=</span> <span class="n">converter</span><span class="o">.</span><span class="n">reverse_encode</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(),</span> <span class="n">length</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">())</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Prediction samples: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">preds_str</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ground truth: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">label_str</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">pred</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">preds_str</span><span class="p">,</span> <span class="n">label_str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">pred</span> <span class="o">==</span> <span class="n">label</span><span class="p">:</span>
                <span class="n">correct_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">IS_ADV</span><span class="p">:</span>
                <span class="n">pred_key</span> <span class="o">=</span> <span class="s1">&#39;adv_pred-</span><span class="si">%09d</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="o">%</span> <span class="n">count</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pred_key</span> <span class="o">=</span> <span class="s1">&#39;pred-</span><span class="si">%09d</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="o">%</span> <span class="n">count</span>

            <span class="n">txn_save</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">pred_key</span><span class="p">,</span> <span class="n">pred</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
<span class="n">accuracy</span> <span class="o">=</span> <span class="n">correct_count</span> <span class="o">/</span> <span class="n">count</span>
</pre></div>
</div>
</li>
</ol>
</li>
<li><p>Run the eval_and_save.py script.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>eval_and_save.py
</pre></div>
</div>
<p>The CNN-CTC model performs inference on the generated natural perturbation dataset and saves the inference result of the model on each sample to the path <code class="docutils literal notranslate"><span class="pre">ADV_TEST_DATASET_PATH</span></code>.</p>
<p>The following data items in key-value pair are added to the dataset:</p>
<ul class="simple">
<li><p>pred- %09d: prediction result of the model on the original image data</p></li>
<li><p>adv_pred- %09d: prediction result of the model on the perturbed image data</p></li>
</ul>
<p>Prediction result of the model on real samples:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Prediction<span class="w"> </span>samples:
<span class="w">    </span><span class="o">[</span><span class="s1">&#39;private&#39;</span>,<span class="w"> </span><span class="s1">&#39;private&#39;</span>,<span class="w"> </span><span class="s1">&#39;parking&#39;</span>,<span class="w"> </span><span class="s1">&#39;parking&#39;</span>,<span class="w"> </span><span class="s1">&#39;salutes&#39;</span><span class="o">]</span>
Ground<span class="w"> </span>truth:
<span class="w">    </span><span class="o">[</span><span class="s1">&#39;private&#39;</span>,<span class="w"> </span><span class="s1">&#39;private&#39;</span>,<span class="w"> </span><span class="s1">&#39;parking&#39;</span>,<span class="w"> </span><span class="s1">&#39;parking&#39;</span>,<span class="w"> </span><span class="s1">&#39;salutes&#39;</span><span class="o">]</span>
Prediction<span class="w"> </span>samples:
<span class="w">    </span><span class="o">[</span><span class="s1">&#39;venus&#39;</span>,<span class="w"> </span><span class="s1">&#39;venus&#39;</span>,<span class="w"> </span><span class="s1">&#39;its&#39;</span>,<span class="w"> </span><span class="s1">&#39;its&#39;</span>,<span class="w"> </span><span class="s1">&#39;the&#39;</span><span class="o">]</span>
Ground<span class="w"> </span>truth:
<span class="w">    </span><span class="o">[</span><span class="s1">&#39;venus&#39;</span>,<span class="w"> </span><span class="s1">&#39;venus&#39;</span>,<span class="w"> </span><span class="s1">&#39;its&#39;</span>,<span class="w"> </span><span class="s1">&#39;its&#39;</span>,<span class="w"> </span><span class="s1">&#39;the&#39;</span><span class="o">]</span>
Prediction<span class="w"> </span>samples:
<span class="w">    </span><span class="o">[</span><span class="s1">&#39;summer&#39;</span>,<span class="w"> </span><span class="s1">&#39;summer&#39;</span>,<span class="w"> </span><span class="s1">&#39;joeys&#39;</span>,<span class="w"> </span><span class="s1">&#39;joeys&#39;</span>,<span class="w"> </span><span class="s1">&#39;think&#39;</span><span class="o">]</span>
Ground<span class="w"> </span>truth:
<span class="w">    </span><span class="o">[</span><span class="s1">&#39;summer&#39;</span>,<span class="w"> </span><span class="s1">&#39;summer&#39;</span>,<span class="w"> </span><span class="s1">&#39;joes&#39;</span>,<span class="w"> </span><span class="s1">&#39;joes&#39;</span>,<span class="w"> </span><span class="s1">&#39;think&#39;</span><span class="o">]</span>
...
</pre></div>
</div>
<p>Prediction result of the model on natural perturbation samples:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Prediction<span class="w"> </span>samples:
<span class="w">    </span><span class="o">[</span><span class="s1">&#39;private&#39;</span>,<span class="w"> </span><span class="s1">&#39;private&#39;</span>,<span class="w"> </span><span class="s1">&#39;parking&#39;</span>,<span class="w"> </span><span class="s1">&#39;parking&#39;</span>,<span class="w"> </span><span class="s1">&#39;salutes&#39;</span><span class="o">]</span>
Ground<span class="w"> </span>truth:
<span class="w">    </span><span class="o">[</span><span class="s1">&#39;private&#39;</span>,<span class="w"> </span><span class="s1">&#39;private&#39;</span>,<span class="w"> </span><span class="s1">&#39;parking&#39;</span>,<span class="w"> </span><span class="s1">&#39;parking&#39;</span>,<span class="w"> </span><span class="s1">&#39;salutes&#39;</span><span class="o">]</span>
Prediction<span class="w"> </span>samples:
<span class="w">    </span><span class="o">[</span><span class="s1">&#39;dams&#39;</span>,<span class="w"> </span><span class="s1">&#39;vares&#39;</span>,<span class="w"> </span><span class="s1">&#39;its&#39;</span>,<span class="w"> </span><span class="s1">&#39;its&#39;</span>,<span class="w"> </span><span class="s1">&#39;the&#39;</span><span class="o">]</span>
Ground<span class="w"> </span>truth:
<span class="w">    </span><span class="o">[</span><span class="s1">&#39;venus&#39;</span>,<span class="w"> </span><span class="s1">&#39;venus&#39;</span>,<span class="w"> </span><span class="s1">&#39;its&#39;</span>,<span class="w"> </span><span class="s1">&#39;its&#39;</span>,<span class="w"> </span><span class="s1">&#39;the&#39;</span><span class="o">]</span>
Prediction<span class="w"> </span>samples:
<span class="w">    </span><span class="o">[</span><span class="s1">&#39;sune&#39;</span>,<span class="w"> </span><span class="s1">&#39;summer&#39;</span>,<span class="w"> </span><span class="s1">&#39;&#39;</span>,<span class="w"> </span><span class="s1">&#39;joeys&#39;</span>,<span class="w"> </span><span class="s1">&#39;think&#39;</span><span class="o">]</span>
Ground<span class="w"> </span>truth:
<span class="w">    </span><span class="o">[</span><span class="s1">&#39;summer&#39;</span>,<span class="w"> </span><span class="s1">&#39;summer&#39;</span>,<span class="w"> </span><span class="s1">&#39;joes&#39;</span>,<span class="w"> </span><span class="s1">&#39;joes&#39;</span>,<span class="w"> </span><span class="s1">&#39;think&#39;</span><span class="o">]</span>
...
</pre></div>
</div>
<p>Accuracies of the model on the original test dataset and natural perturbation dataset:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>num<span class="w"> </span>of<span class="w"> </span>samples<span class="w"> </span><span class="k">in</span><span class="w"> </span>IIIT<span class="w"> </span>dataset:<span class="w"> </span><span class="m">5952</span>
Accuracy<span class="w"> </span>of<span class="w"> </span>benign<span class="w"> </span>sample:<span class="w">  </span><span class="m">0</span>.8546195652173914
Accuracy<span class="w"> </span>of<span class="w"> </span>perturbed<span class="w"> </span>sample:<span class="w">  </span><span class="m">0</span>.6126019021739131
</pre></div>
</div>
</li>
</ol>
</section>
<section id="robustness-analysis">
<h3>Robustness Analysis<a class="headerlink" href="#robustness-analysis" title="Permalink to this headline"></a></h3>
<p>Run the analyse.py script to perform statistical analysis on the performance of CNN-CTC model on the perturbation dataset.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>analyse.py
</pre></div>
</div>
<p>Analysis result:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Number<span class="w"> </span>of<span class="w"> </span>samples<span class="w"> </span><span class="k">in</span><span class="w"> </span>analyse<span class="w"> </span>dataset:<span class="w">  </span><span class="m">5952</span>
Accuracy<span class="w"> </span>of<span class="w"> </span>original<span class="w"> </span>dataset:<span class="w">  </span><span class="m">0</span>.46127717391304346
Accuracy<span class="w"> </span>of<span class="w"> </span>adversarial<span class="w"> </span>dataset:<span class="w">  </span><span class="m">0</span>.6126019021739131
Number<span class="w"> </span>of<span class="w"> </span>samples<span class="w"> </span>correctly<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>original<span class="w"> </span>dataset<span class="w"> </span>but<span class="w"> </span>wrong<span class="w"> </span><span class="k">in</span><span class="w"> </span>adversarial<span class="w"> </span>dataset:<span class="w">  </span><span class="m">832</span>
Number<span class="w"> </span>of<span class="w"> </span>samples<span class="w"> </span>both<span class="w"> </span>wrong<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>original<span class="w"> </span>and<span class="w"> </span>adversarial<span class="w"> </span>dataset:<span class="w">  </span><span class="m">1449</span>
------------------------------------------------------------------------------
Method<span class="w">  </span>Shear
Number<span class="w"> </span>of<span class="w"> </span>perturb<span class="w"> </span>samples:<span class="w"> </span><span class="m">442</span>
Number<span class="w"> </span>of<span class="w"> </span>wrong<span class="w"> </span>predicted:<span class="w"> </span><span class="m">351</span>
Number<span class="w"> </span>of<span class="w"> </span>correctly<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>dataset<span class="w"> </span>but<span class="w"> </span>wrong<span class="w"> </span><span class="k">in</span><span class="w"> </span>adversarial:<span class="w"> </span><span class="m">153</span>
Number<span class="w"> </span>of<span class="w"> </span>both<span class="w"> </span>wrong<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>and<span class="w"> </span>adversarial<span class="w"> </span>dataset:<span class="w"> </span><span class="m">198</span>
------------------------------------------------------------------------------
Method<span class="w">  </span>Contrast
Number<span class="w"> </span>of<span class="w"> </span>perturb<span class="w"> </span>samples:<span class="w"> </span><span class="m">387</span>
Number<span class="w"> </span>of<span class="w"> </span>wrong<span class="w"> </span>predicted:<span class="w"> </span><span class="m">57</span>
Number<span class="w"> </span>of<span class="w"> </span>correctly<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>dataset<span class="w"> </span>but<span class="w"> </span>wrong<span class="w"> </span><span class="k">in</span><span class="w"> </span>adversarial:<span class="w"> </span><span class="m">8</span>
Number<span class="w"> </span>of<span class="w"> </span>both<span class="w"> </span>wrong<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>and<span class="w"> </span>adversarial<span class="w"> </span>dataset:<span class="w"> </span><span class="m">49</span>
------------------------------------------------------------------------------
Method<span class="w">  </span>GaussianBlur
Number<span class="w"> </span>of<span class="w"> </span>perturb<span class="w"> </span>samples:<span class="w"> </span><span class="m">436</span>
Number<span class="w"> </span>of<span class="w"> </span>wrong<span class="w"> </span>predicted:<span class="w"> </span><span class="m">181</span>
Number<span class="w"> </span>of<span class="w"> </span>correctly<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>dataset<span class="w"> </span>but<span class="w"> </span>wrong<span class="w"> </span><span class="k">in</span><span class="w"> </span>adversarial:<span class="w"> </span><span class="m">71</span>
Number<span class="w"> </span>of<span class="w"> </span>both<span class="w"> </span>wrong<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>and<span class="w"> </span>adversarial<span class="w"> </span>dataset:<span class="w"> </span><span class="m">110</span>
------------------------------------------------------------------------------
Method<span class="w">  </span>MotionBlur
Number<span class="w"> </span>of<span class="w"> </span>perturb<span class="w"> </span>samples:<span class="w"> </span><span class="m">458</span>
Number<span class="w"> </span>of<span class="w"> </span>wrong<span class="w"> </span>predicted:<span class="w"> </span><span class="m">215</span>
Number<span class="w"> </span>of<span class="w"> </span>correctly<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>dataset<span class="w"> </span>but<span class="w"> </span>wrong<span class="w"> </span><span class="k">in</span><span class="w"> </span>adversarial:<span class="w"> </span><span class="m">92</span>
Number<span class="w"> </span>of<span class="w"> </span>both<span class="w"> </span>wrong<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>and<span class="w"> </span>adversarial<span class="w"> </span>dataset:<span class="w"> </span><span class="m">123</span>
------------------------------------------------------------------------------
Method<span class="w">  </span>GradientLuminance
Number<span class="w"> </span>of<span class="w"> </span>perturb<span class="w"> </span>samples:<span class="w"> </span><span class="m">1243</span>
Number<span class="w"> </span>of<span class="w"> </span>wrong<span class="w"> </span>predicted:<span class="w"> </span><span class="m">154</span>
Number<span class="w"> </span>of<span class="w"> </span>correctly<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>dataset<span class="w"> </span>but<span class="w"> </span>wrong<span class="w"> </span><span class="k">in</span><span class="w"> </span>adversarial:<span class="w"> </span><span class="m">4</span>
Number<span class="w"> </span>of<span class="w"> </span>both<span class="w"> </span>wrong<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>and<span class="w"> </span>adversarial<span class="w"> </span>dataset:<span class="w"> </span><span class="m">150</span>
------------------------------------------------------------------------------
Method<span class="w">  </span>Rotate
Number<span class="w"> </span>of<span class="w"> </span>perturb<span class="w"> </span>samples:<span class="w"> </span><span class="m">405</span>
Number<span class="w"> </span>of<span class="w"> </span>wrong<span class="w"> </span>predicted:<span class="w"> </span><span class="m">298</span>
Number<span class="w"> </span>of<span class="w"> </span>correctly<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>dataset<span class="w"> </span>but<span class="w"> </span>wrong<span class="w"> </span><span class="k">in</span><span class="w"> </span>adversarial:<span class="w"> </span><span class="m">136</span>
Number<span class="w"> </span>of<span class="w"> </span>both<span class="w"> </span>wrong<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>and<span class="w"> </span>adversarial<span class="w"> </span>dataset:<span class="w"> </span><span class="m">162</span>
------------------------------------------------------------------------------
Method<span class="w">  </span>SaltAndPepperNoise
Number<span class="w"> </span>of<span class="w"> </span>perturb<span class="w"> </span>samples:<span class="w"> </span><span class="m">413</span>
Number<span class="w"> </span>of<span class="w"> </span>wrong<span class="w"> </span>predicted:<span class="w"> </span><span class="m">116</span>
Number<span class="w"> </span>of<span class="w"> </span>correctly<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>dataset<span class="w"> </span>but<span class="w"> </span>wrong<span class="w"> </span><span class="k">in</span><span class="w"> </span>adversarial:<span class="w"> </span><span class="m">29</span>
Number<span class="w"> </span>of<span class="w"> </span>both<span class="w"> </span>wrong<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>and<span class="w"> </span>adversarial<span class="w"> </span>dataset:<span class="w"> </span><span class="m">87</span>
------------------------------------------------------------------------------
Method<span class="w">  </span>Translate
Number<span class="w"> </span>of<span class="w"> </span>perturb<span class="w"> </span>samples:<span class="w"> </span><span class="m">419</span>
Number<span class="w"> </span>of<span class="w"> </span>wrong<span class="w"> </span>predicted:<span class="w"> </span><span class="m">159</span>
Number<span class="w"> </span>of<span class="w"> </span>correctly<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>dataset<span class="w"> </span>but<span class="w"> </span>wrong<span class="w"> </span><span class="k">in</span><span class="w"> </span>adversarial:<span class="w"> </span><span class="m">57</span>
Number<span class="w"> </span>of<span class="w"> </span>both<span class="w"> </span>wrong<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>and<span class="w"> </span>adversarial<span class="w"> </span>dataset:<span class="w"> </span><span class="m">102</span>
------------------------------------------------------------------------------
Method<span class="w">  </span>GradientBlur
Number<span class="w"> </span>of<span class="w"> </span>perturb<span class="w"> </span>samples:<span class="w"> </span><span class="m">440</span>
Number<span class="w"> </span>of<span class="w"> </span>wrong<span class="w"> </span>predicted:<span class="w"> </span><span class="m">92</span>
Number<span class="w"> </span>of<span class="w"> </span>correctly<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>dataset<span class="w"> </span>but<span class="w"> </span>wrong<span class="w"> </span><span class="k">in</span><span class="w"> </span>adversarial:<span class="w"> </span><span class="m">26</span>
Number<span class="w"> </span>of<span class="w"> </span>both<span class="w"> </span>wrong<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>and<span class="w"> </span>adversarial<span class="w"> </span>dataset:<span class="w"> </span><span class="m">66</span>
------------------------------------------------------------------------------
Method<span class="w">  </span>Perspective
Number<span class="w"> </span>of<span class="w"> </span>perturb<span class="w"> </span>samples:<span class="w"> </span><span class="m">401</span>
Number<span class="w"> </span>of<span class="w"> </span>wrong<span class="w"> </span>predicted:<span class="w"> </span><span class="m">181</span>
Number<span class="w"> </span>of<span class="w"> </span>correctly<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>dataset<span class="w"> </span>but<span class="w"> </span>wrong<span class="w"> </span><span class="k">in</span><span class="w"> </span>adversarial:<span class="w"> </span><span class="m">75</span>
Number<span class="w"> </span>of<span class="w"> </span>both<span class="w"> </span>wrong<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>and<span class="w"> </span>adversarial<span class="w"> </span>dataset:<span class="w"> </span><span class="m">106</span>
------------------------------------------------------------------------------
Method<span class="w">  </span>Curve
Number<span class="w"> </span>of<span class="w"> </span>perturb<span class="w"> </span>samples:<span class="w"> </span><span class="m">410</span>
Number<span class="w"> </span>of<span class="w"> </span>wrong<span class="w"> </span>predicted:<span class="w"> </span><span class="m">361</span>
Number<span class="w"> </span>of<span class="w"> </span>correctly<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>dataset<span class="w"> </span>but<span class="w"> </span>wrong<span class="w"> </span><span class="k">in</span><span class="w"> </span>adversarial:<span class="w"> </span><span class="m">162</span>
Number<span class="w"> </span>of<span class="w"> </span>both<span class="w"> </span>wrong<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>and<span class="w"> </span>adversarial<span class="w"> </span>dataset:<span class="w"> </span><span class="m">199</span>
------------------------------------------------------------------------------
Method<span class="w">  </span>Scale
Number<span class="w"> </span>of<span class="w"> </span>perturb<span class="w"> </span>samples:<span class="w"> </span><span class="m">434</span>
Number<span class="w"> </span>of<span class="w"> </span>wrong<span class="w"> </span>predicted:<span class="w"> </span><span class="m">116</span>
Number<span class="w"> </span>of<span class="w"> </span>correctly<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>dataset<span class="w"> </span>but<span class="w"> </span>wrong<span class="w"> </span><span class="k">in</span><span class="w"> </span>adversarial:<span class="w"> </span><span class="m">19</span>
Number<span class="w"> </span>of<span class="w"> </span>both<span class="w"> </span>wrong<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>and<span class="w"> </span>adversarial<span class="w"> </span>dataset:<span class="w"> </span><span class="m">97</span>
------------------------------------------------------------------------------
</pre></div>
</div>
<p>The analysis result includes:</p>
<ol class="arabic simple">
<li><p>Number of evaluated samples: 5888</p></li>
<li><p>Accuracy of the CNN-CTC model on the original dataset: 85.4%</p></li>
<li><p>Accuracy of the CNN-CTC model on the perturbation dataset: 57.2%</p></li>
<li><p>Number of samples with correct prediction on the original image but incorrect prediction on the perturbed image: 1736</p></li>
<li><p>Number of samples with incorrect prediction on both the original image and the perturbed image: 782</p></li>
<li><p>For each perturbation method, the following are included: the number of samples, the number of perturbation samples with incorrect prediction, the number of samples with correct prediction on the original image but incorrect prediction on the perturbed image, and the number of samples with incorrect prediction on both the original image and the perturbed image.</p></li>
</ol>
<p>If the prediction error rate of the CNN-CTC model is high after a perturbation method is used, the CNN-CTC model is not robust to this method. You are advised to improve the robustness of the CNN-CTC model. For example, if most images after perturbation (such as Rotate, Curve, MotionBlur, and Shear) are incorrectly predicted, further analysis is recommended.</p>
<p>The following folders are generated in <code class="docutils literal notranslate"><span class="pre">ADV_TEST_DATASET_PATH</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>adv_wrong_pred<span class="w">                  </span><span class="c1"># Dataset whose image classification is incorrect after perturbation.</span>
ori_corret_adv_wrong_pred<span class="w">       </span><span class="c1"># Dataset with correct classification on the original image but incorrect classification on the perturbed image in the model</span>
ori_wrong_adv_wrong_pred<span class="w">        </span><span class="c1"># Dataset with incorrect classification on both the original image and the perturbed image in the model</span>
</pre></div>
</div>
<p>Each folder is classified according to the perturbation method.</p>
<p><img alt="1646730529400" src="_images/catalog.png" /></p>
<p>Each image is named in the format of true value-predicted value.png, as shown in the following figure.</p>
<p><img alt="1646812837049" src="_images/name_format.png" /></p>
<p>The stored images can be further analyzed to determine whether the model quality problem, image quality problem, or perturbation method affects the image semantics and causes prediction errors.</p>
<p><img alt="1646812837049" src="_images/result_demo.png" /></p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="test_model_security_fuzzing.html" class="btn btn-neutral float-left" title="Testing Model Security Using Fuzz Testing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="dynamic_obfuscation_protection.html" class="btn btn-neutral float-right" title="Dynamic Model Obfuscation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, MindSpore.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 
</body>
</html>