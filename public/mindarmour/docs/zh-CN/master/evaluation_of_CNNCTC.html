<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>对OCR模型CNN-CTC的鲁棒性评测 &mdash; MindSpore master 文档</title><script>;(()=>{const e=localStorage.getItem("ms-theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;(e?"dark"===e:t)&&document.documentElement.setAttribute("data-o-theme","dark")})();</script><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script><script src="_static/jquery.js"></script>
        <script src="_static/js/theme.js"></script><script src="_static/underscore.js"></script><script src="_static/doctools.js"></script><script src="_static/translations.js"></script>
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" />
    <link rel="next" title="模型加密保护" href="model_encrypt_protection.html" />
    <link rel="prev" title="使用fuzz testing模块测试模型安全性" href="test_model_security_fuzzing.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> MindSpore
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="在文档中搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">安装部署</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="mindarmour_install.html">安装MindSpore Armour</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AI安全</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="improve_model_security_nad.html">使用NAD算法提升模型安全性</a></li>
<li class="toctree-l1"><a class="reference internal" href="test_model_security_fuzzing.html">使用fuzz testing模块测试模型安全性</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">对OCR模型CNN-CTC的鲁棒性评测</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#概述">概述</a></li>
<li class="toctree-l2"><a class="reference internal" href="#环境要求">环境要求</a></li>
<li class="toctree-l2"><a class="reference internal" href="#脚本说明">脚本说明</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#代码结构">代码结构</a></li>
<li class="toctree-l3"><a class="reference internal" href="#脚本参数">脚本参数</a></li>
<li class="toctree-l3"><a class="reference internal" href="#模型与数据">模型与数据</a></li>
<li class="toctree-l3"><a class="reference internal" href="#基于自然扰动serving生成评测数据集">基于自然扰动serving生成评测数据集</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cnn-ctc模型在生成扰动数据集上推理">CNN-CTC模型在生成扰动数据集上推理</a></li>
<li class="toctree-l3"><a class="reference internal" href="#鲁棒性分析">鲁棒性分析</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="model_encrypt_protection.html">模型加密保护</a></li>
<li class="toctree-l1"><a class="reference internal" href="dynamic_obfuscation_protection.html">模型动态混淆</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AI隐私</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="protect_user_privacy_with_differential_privacy.html">应用差分隐私机制保护用户隐私</a></li>
<li class="toctree-l1"><a class="reference internal" href="protect_user_privacy_with_suppress_privacy.html">应用抑制隐私机制保护用户隐私</a></li>
<li class="toctree-l1"><a class="reference internal" href="test_model_security_membership_inference.html">使用成员推理测试模型安全性</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AI可靠性</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="concept_drift_time_series.html">实现时序数据概念漂移检测应用</a></li>
<li class="toctree-l1"><a class="reference internal" href="concept_drift_images.html">实现图像数据概念漂移检测应用</a></li>
<li class="toctree-l1"><a class="reference internal" href="fault_injection.html">实现模型故障注入评估模型容错性</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API参考</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="mindarmour.html">mindarmour</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindarmour.adv_robustness.attacks.html">mindarmour.adv_robustness.attacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindarmour.adv_robustness.defenses.html">mindarmour.adv_robustness.defenses</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindarmour.adv_robustness.detectors.html">mindarmour.adv_robustness.detectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindarmour.adv_robustness.evaluations.html">mindarmour.adv_robustness.evaluations</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindarmour.fuzz_testing.html">mindarmour.fuzz_testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindarmour.natural_robustness.transform.image.html">mindarmour.natural_robustness.transform.image</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindarmour.privacy.diff_privacy.html">mindarmour.privacy.diff_privacy</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindarmour.privacy.evaluation.html">mindarmour.privacy.evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindarmour.privacy.sup_privacy.html">mindarmour.privacy.sup_privacy</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindarmour.reliability.html">mindarmour.reliability</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindarmour.utils.html">mindarmour.utils</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">参考文档</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="design.html">安全可信总体设计</a></li>
<li class="toctree-l1"><a class="reference internal" href="differential_privacy_design.html">差分隐私设计</a></li>
<li class="toctree-l1"><a class="reference internal" href="fuzzer_design.html">AI模型安全测试设计</a></li>
<li class="toctree-l1"><a class="reference internal" href="security_and_privacy.html">MindSpore Armour模块介绍</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">RELEASE NOTES</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="RELEASE.html">Release Notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MindSpore</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>对OCR模型CNN-CTC的鲁棒性评测</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/evaluation_of_CNNCTC.md.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="对ocr模型cnn-ctc的鲁棒性评测">
<h1>对OCR模型CNN-CTC的鲁棒性评测<a class="headerlink" href="#对ocr模型cnn-ctc的鲁棒性评测" title="永久链接至标题"></a></h1>
<p><a class="reference external" href="https://gitee.com/mindspore/docs/blob/master/docs/mindarmour/docs/source_zh_cn/evaluation_of_CNNCTC.md"><img alt="查看源文件" src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/master/resource/_static/logo_source.svg" /></a></p>
<section id="概述">
<h2>概述<a class="headerlink" href="#概述" title="永久链接至标题"></a></h2>
<p>本教程主要演示利用自然扰动serving服务，对OCR模型CNN-CTC做一个简单的鲁棒性评测。先基于serving生成多种自然扰动样本数据集，然后根据CNN-CTC模型在自然扰动样本数据集上的表现来评估模型的鲁棒性。</p>
<blockquote>
<div><p>你可以在这里找到完整可运行的样例代码：<a class="reference external" href="https://gitee.com/mindspore/mindarmour/tree/master/examples/natural_robustness/ocr_evaluate">https://gitee.com/mindspore/mindarmour/tree/master/examples/natural_robustness/ocr_evaluate</a> 。</p>
</div></blockquote>
</section>
<section id="环境要求">
<h2>环境要求<a class="headerlink" href="#环境要求" title="永久链接至标题"></a></h2>
<ul class="simple">
<li><p>硬件</p>
<ul>
<li><p>Ascend或GPU处理器搭建硬件环境。</p></li>
</ul>
</li>
<li><p>依赖</p>
<ul>
<li><p><a class="reference external" href="https://www.mindspore.cn/install">MindSpore</a></p></li>
<li><p>MindSpore-Serving &gt;= 1.6.0</p></li>
<li><p>MindArmour</p></li>
</ul>
</li>
</ul>
</section>
<section id="脚本说明">
<h2>脚本说明<a class="headerlink" href="#脚本说明" title="永久链接至标题"></a></h2>
<section id="代码结构">
<h3>代码结构<a class="headerlink" href="#代码结构" title="永久链接至标题"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="p">|</span>--<span class="w"> </span>natural_robustness
<span class="w">    </span><span class="p">|</span>--<span class="w"> </span>serving<span class="w">                         </span><span class="c1"># 提供自然扰动样本生成的serving服务</span>
<span class="w">    </span><span class="p">|</span>--<span class="w"> </span>ocr_evaluate
<span class="w">        </span><span class="p">|</span>--<span class="w"> </span>cnn_ctc<span class="w">                     </span><span class="c1"># cnn_ctc模型目录：模型的训练、推理、前后处理</span>
<span class="w">        </span><span class="p">|</span>--<span class="w"> </span>data<span class="w">                        </span><span class="c1"># 存储实验分析数据</span>
<span class="w">        </span><span class="p">|</span>--<span class="w"> </span>default_config.yaml<span class="w">         </span><span class="c1"># 参数配置</span>
<span class="w">        </span><span class="p">|</span>--<span class="w"> </span>generate_adv_samples.py<span class="w">     </span><span class="c1"># 用于生成自然扰动样本</span>
<span class="w">        </span><span class="p">|</span>--<span class="w"> </span>eval_and_save.py<span class="w">            </span><span class="c1"># cnn_ctc在扰动样本上推理，并保存推理结果</span>
<span class="w">        </span><span class="p">|</span>--<span class="w"> </span>analyse.py<span class="w">                  </span><span class="c1"># 分析cnn_ctc模型的鲁棒性</span>
</pre></div>
</div>
</section>
<section id="脚本参数">
<h3>脚本参数<a class="headerlink" href="#脚本参数" title="永久链接至标题"></a></h3>
<p>在<code class="docutils literal notranslate"><span class="pre">default_config.yaml</span></code>中可以同时配置训练参数、推理参数、鲁棒性评测参数。这里我们重点关注在评测过程中使用到的参数，以及需要用户配置的参数，其余参数说明参考<a class="reference external" href="https://gitee.com/mindspore/models/tree/master/official/cv/CTPN">CNN-CTC教程</a>。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--TEST_DATASET_PATH</span></code>：测试数据集路径。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--CHECKPOINT_PATH</span></code>：checkpoint路径。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--ADV_TEST_DATASET_PATH</span></code>：扰动样本数据集路径。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--IS_ADV</span></code>：是否使用扰动样本进行测试。</p></li>
</ul>
</section>
<section id="模型与数据">
<h3>模型与数据<a class="headerlink" href="#模型与数据" title="永久链接至标题"></a></h3>
<p>被评测的模型为基于MindSpore实现的OCR模型CNN-CTC，该模型主要针对场景文字识别（Scene Text Recognition）任务，用CNN模型提取特征，用CTC（Connectionist temporal classification）预测输出序列。</p>
<p><a class="reference external" href="https://arxiv.org/abs/1904.01906">论文</a>： J. Baek, G. Kim, J. Lee, S. Park, D. Han, S. Yun, S. J. Oh, and H. Lee, “What is wrong with scene text recognition model comparisons? dataset and model analysis,” ArXiv, vol. abs/1904.01906, 2019.</p>
<p>数据处理与模型训练参考<a class="reference external" href="https://gitee.com/mindspore/models/tree/master/official/cv/CTPN">CNN-CTC教程</a>。评测任务需基于该教程获得预处理后的数据集和checkpoint模型文件。</p>
<p>预处理后的数据集为.lmdb格式，以键值对方式存储：</p>
<ul class="simple">
<li><p>label-%09d：图片的真实标签</p></li>
<li><p>image-%09d：原始图片数据</p></li>
<li><p>num-samples：lmdb数据集中的样本数量</p></li>
</ul>
<p>其中，<code class="docutils literal notranslate"><span class="pre">%09d</span></code>为：长度为9的数字串。形如：label-000000001。</p>
</section>
<section id="基于自然扰动serving生成评测数据集">
<h3>基于自然扰动serving生成评测数据集<a class="headerlink" href="#基于自然扰动serving生成评测数据集" title="永久链接至标题"></a></h3>
<ol class="arabic">
<li><p>启动自然扰动serving服务。具体说明参考：<a class="reference external" href="https://gitee.com/mindspore/mindarmour/blob/master/examples/natural_robustness/serving/README.md#">自然扰动样本生成serving服务</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>serving/server/
python<span class="w"> </span>serving_server.py
</pre></div>
</div>
</li>
<li><p>基于serving服务，生成测评数据集。</p>
<ol class="arabic">
<li><p>在default_config.yaml中配置原来测试样本数据路径<code class="docutils literal notranslate"><span class="pre">TEST_DATASET_PATH</span></code>和生成扰动样本数据集路径<code class="docutils literal notranslate"><span class="pre">ADV_TEST_DATASET_PATH</span></code>。例如：</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">TEST_DATASET_PATH</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/opt/dataset/CNNCTC_data/MJ-ST-IIIT/IIIT5k_3000&quot;</span>
<span class="nt">ADV_TEST_DATASET_PATH</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/home/mindarmour/examples/natural_robustness/ocr_evaluate/data&quot;</span>
</pre></div>
</div>
</li>
<li><p>核心代码说明：</p>
<ol class="arabic">
<li><p>配置扰动方法，目前可选的扰动方法及参数配置参考<a class="reference external" href="https://gitee.com/mindspore/mindarmour/tree/master/mindarmour/natural_robustness/transform/image">image transform methods</a>。下面是一个配置例子。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">PerturbConfig</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;Contrast&quot;</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span> <span class="s2">&quot;beta&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}},</span>
    <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;GaussianBlur&quot;</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;ksize&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}},</span>
    <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;SaltAndPepperNoise&quot;</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;factor&quot;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">}},</span>
    <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;Translate&quot;</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;x_bias&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s2">&quot;y_bias&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">}},</span>
    <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;Scale&quot;</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;factor_x&quot;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span> <span class="s2">&quot;factor_y&quot;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">}},</span>
    <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;Shear&quot;</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;factor&quot;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span> <span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="s2">&quot;horizontal&quot;</span><span class="p">}},</span>
    <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;Rotate&quot;</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;angle&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">}},</span>
    <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;MotionBlur&quot;</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;degree&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;angle&quot;</span><span class="p">:</span> <span class="mi">45</span><span class="p">}},</span>
    <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;GradientBlur&quot;</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;point&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="s2">&quot;kernel_num&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;center&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}},</span>
    <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;GradientLuminance&quot;</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;color_start&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span> <span class="s2">&quot;color_end&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;start_point&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">],</span> <span class="s2">&quot;scope&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span> <span class="s2">&quot;bright_rate&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span> <span class="s2">&quot;pattern&quot;</span><span class="p">:</span> <span class="s2">&quot;light&quot;</span><span class="p">,</span> <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;circle&quot;</span><span class="p">}},</span>
    <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;GradientLuminance&quot;</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;color_start&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span> <span class="s2">&quot;color_end&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;start_point&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">150</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span> <span class="s2">&quot;scope&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span> <span class="s2">&quot;pattern&quot;</span><span class="p">:</span> <span class="s2">&quot;light&quot;</span><span class="p">,</span> <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;horizontal&quot;</span><span class="p">}},</span>
    <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;GradientLuminance&quot;</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;color_start&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span> <span class="s2">&quot;color_end&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;start_point&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">150</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span> <span class="s2">&quot;scope&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span> <span class="s2">&quot;pattern&quot;</span><span class="p">:</span> <span class="s2">&quot;light&quot;</span><span class="p">,</span> <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;vertical&quot;</span><span class="p">}},</span>
    <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;Curve&quot;</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;curves&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;depth&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;vertical&quot;</span><span class="p">}},</span>
    <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;Perspective&quot;</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;ori_pos&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">800</span><span class="p">],</span> <span class="p">[</span><span class="mi">800</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">800</span><span class="p">,</span> <span class="mi">800</span><span class="p">]],</span> <span class="s2">&quot;dst_pos&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">800</span><span class="p">],</span> <span class="p">[</span><span class="mi">790</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">800</span><span class="p">,</span> <span class="mi">800</span><span class="p">]]}},</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>准备需要扰动的数据。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">instances</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">methods_number</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">outputs_number</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">perturb_config</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">perturb_config</span><span class="p">)</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">lmdb</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">lmdb_paths</span><span class="p">,</span> <span class="n">max_readers</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lock</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">readahead</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">meminit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">env</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cannot create lmdb from </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lmdb_paths</span><span class="p">))</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="k">with</span> <span class="n">env</span><span class="o">.</span><span class="n">begin</span><span class="p">(</span><span class="n">write</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">txn</span><span class="p">:</span>
    <span class="n">n_samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">txn</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;num-samples&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">()))</span>
    <span class="c1"># Filtering</span>
    <span class="n">filtered_labels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">filtered_index_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_samples</span><span class="p">):</span>
        <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># lmdb starts with 1</span>
        <span class="n">label_key</span> <span class="o">=</span> <span class="s1">&#39;label-</span><span class="si">%09d</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="o">%</span> <span class="n">index</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">txn</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">label_key</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_len</span><span class="p">:</span> <span class="k">continue</span>
        <span class="n">illegal_sample</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">char_item</span> <span class="ow">in</span> <span class="n">label</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">char_item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">CHARACTER</span><span class="p">:</span>
                <span class="n">illegal_sample</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">illegal_sample</span><span class="p">:</span> <span class="k">continue</span>
        <span class="n">filtered_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="n">filtered_index_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="n">img_key</span> <span class="o">=</span> <span class="s1">&#39;image-</span><span class="si">%09d</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="o">%</span> <span class="n">index</span>
        <span class="n">imgbuf</span> <span class="o">=</span> <span class="n">txn</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">img_key</span><span class="p">)</span>
        <span class="n">instances</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;img&quot;</span><span class="p">:</span> <span class="n">imgbuf</span><span class="p">,</span> <span class="s1">&#39;perturb_config&#39;</span><span class="p">:</span> <span class="n">perturb_config</span><span class="p">,</span> <span class="s2">&quot;methods_number&quot;</span><span class="p">:</span> <span class="n">methods_number</span><span class="p">,</span>
                          <span class="s2">&quot;outputs_number&quot;</span><span class="p">:</span> <span class="n">outputs_number</span><span class="p">})</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;num of samples in IIIT daaset: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">filtered_index_list</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>请求自然扰动serving服务，并保存serving返回的数据。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ip</span> <span class="o">=</span> <span class="s1">&#39;0.0.0.0:8888&#39;</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="s2">&quot;perturbation&quot;</span><span class="p">,</span> <span class="s2">&quot;natural_perturbation&quot;</span><span class="p">)</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">infer</span><span class="p">(</span><span class="n">instances</span><span class="p">)</span>
<span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;generated natural perturbs images cost: &#39;</span><span class="p">,</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
<span class="n">env_save</span> <span class="o">=</span> <span class="n">lmdb</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">lmdb_save_path</span><span class="p">,</span> <span class="n">map_size</span><span class="o">=</span><span class="mi">1099511627776</span><span class="p">)</span>

<span class="n">txn</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">begin</span><span class="p">(</span><span class="n">write</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">with</span> <span class="n">env_save</span><span class="o">.</span><span class="n">begin</span><span class="p">(</span><span class="n">write</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">txn_save</span><span class="p">:</span>
    <span class="n">new_index</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">filtered_index_list</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">file_names</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;file_names&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;index: &#39;</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">length</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;file_length&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">before</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">filtered_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
        <span class="n">img_key</span> <span class="o">=</span> <span class="s1">&#39;image-</span><span class="si">%09d</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="o">%</span> <span class="n">index</span>
        <span class="n">ori_img</span> <span class="o">=</span> <span class="n">txn</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">img_key</span><span class="p">)</span>
        <span class="n">names_dict</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;names_dict&#39;</span><span class="p">]</span>
        <span class="n">names_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">names_dict</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">leng</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">file_names</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
            <span class="n">label_key</span> <span class="o">=</span> <span class="s1">&#39;label-</span><span class="si">%09d</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="o">%</span> <span class="n">new_index</span>
            <span class="n">txn_save</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">label_key</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
            <span class="n">img_key</span> <span class="o">=</span> <span class="s1">&#39;image-</span><span class="si">%09d</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="o">%</span> <span class="n">new_index</span>
            <span class="n">adv_img</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;results&#39;</span><span class="p">]</span>
            <span class="n">adv_img</span> <span class="o">=</span> <span class="n">adv_img</span><span class="p">[</span><span class="n">before</span><span class="p">:</span><span class="n">before</span> <span class="o">+</span> <span class="n">leng</span><span class="p">]</span>
            <span class="n">adv_img_key</span> <span class="o">=</span> <span class="s1">&#39;adv_image-</span><span class="si">%09d</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="o">%</span> <span class="n">new_index</span>
            <span class="n">txn_save</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">img_key</span><span class="p">,</span> <span class="n">ori_img</span><span class="p">)</span>
            <span class="n">txn_save</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">adv_img_key</span><span class="p">,</span> <span class="n">adv_img</span><span class="p">)</span>

            <span class="n">adv_info_key</span> <span class="o">=</span> <span class="s1">&#39;adv_info-</span><span class="si">%09d</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="o">%</span> <span class="n">new_index</span>
            <span class="n">adv_info</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">names_dict</span><span class="p">[</span><span class="n">name</span><span class="p">])</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
            <span class="n">txn_save</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">adv_info_key</span><span class="p">,</span> <span class="n">adv_info</span><span class="p">)</span>
            <span class="n">before</span> <span class="o">=</span> <span class="n">before</span> <span class="o">+</span> <span class="n">leng</span>
            <span class="n">new_index</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">xn_save</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;num-samples&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span><span class="nb">str</span><span class="p">(</span><span class="n">new_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
<span class="n">env</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</li>
</ol>
</li>
<li><p>执行自然扰动样本生成脚本：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>generate_adv_samples.py
</pre></div>
</div>
</li>
<li><p>生成的自然扰动数据为.lmdb格式，包含下列键值对数据项：</p></li>
</ol>
<ul class="simple">
<li><p>label-%09d：图片的真实标签</p></li>
<li><p>image-%09d：原始图片数据</p></li>
<li><p>adv_image-%09d：生成的扰动图片数据</p></li>
<li><p>adv_info-%09d：扰动信息，包含扰动方法和参数</p></li>
<li><p>num-samples：lmdb数据集中的样本数量</p></li>
</ul>
</li>
</ol>
</section>
<section id="cnn-ctc模型在生成扰动数据集上推理">
<h3>CNN-CTC模型在生成扰动数据集上推理<a class="headerlink" href="#cnn-ctc模型在生成扰动数据集上推理" title="永久链接至标题"></a></h3>
<ol class="arabic">
<li><p>在default_config.yaml中将测试数据集路径<code class="docutils literal notranslate"><span class="pre">TEST_DATASET_PATH</span></code>设置成和生成扰动样本数据集路径<code class="docutils literal notranslate"><span class="pre">ADV_TEST_DATASET_PATH</span></code>一样的。例如：</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">TEST_DATASET_PATH</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;/home/mindarmour/examples/natural_robustness/ocr_evaluate/data&quot;</span>
<span class="nt">ADV_TEST_DATASET_PATH</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/home/mindarmour/examples/natural_robustness/ocr_evaluate/data&quot;</span>
</pre></div>
</div>
</li>
<li><p>核心脚本说明</p>
<ol class="arabic">
<li><p>加载模型和数据集</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ds</span> <span class="o">=</span> <span class="n">test_dataset_creator</span><span class="p">(</span><span class="n">is_adv</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">IS_ADV</span><span class="p">)</span>
<span class="n">net</span> <span class="o">=</span> <span class="n">CNNCTC</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">NUM_CLASS</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">HIDDEN_SIZE</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">FINAL_FEATURE_WIDTH</span><span class="p">)</span>

<span class="n">ckpt_path</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">CHECKPOINT_PATH</span>
<span class="n">param_dict</span> <span class="o">=</span> <span class="n">load_checkpoint</span><span class="p">(</span><span class="n">ckpt_path</span><span class="p">)</span>
<span class="n">load_param_into_net</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">param_dict</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;parameters loaded! from: &#39;</span><span class="p">,</span> <span class="n">ckpt_path</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>推理并保存模型对于原始样本和扰动样本的推理结果。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">env_save</span> <span class="o">=</span> <span class="n">lmdb</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">lmdb_save_path</span><span class="p">,</span> <span class="n">map_size</span><span class="o">=</span><span class="mi">1099511627776</span><span class="p">)</span>
<span class="k">with</span> <span class="n">env_save</span><span class="o">.</span><span class="n">begin</span><span class="p">(</span><span class="n">write</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">txn_save</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">create_tuple_iterator</span><span class="p">():</span>
        <span class="n">img</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="n">data</span>

        <span class="n">img_tensor</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">model_predict</span> <span class="o">=</span> <span class="n">net</span><span class="p">(</span><span class="n">img_tensor</span><span class="p">)</span>
        <span class="n">model_predict</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">model_predict</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">())</span>

        <span class="n">preds_size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">model_predict</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="n">config</span><span class="o">.</span><span class="n">TEST_BATCH_SIZE</span><span class="p">)</span>
        <span class="n">preds_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">model_predict</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">preds_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">preds_index</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">preds_str</span> <span class="o">=</span> <span class="n">converter</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">preds_index</span><span class="p">,</span> <span class="n">preds_size</span><span class="p">)</span>
        <span class="n">label_str</span> <span class="o">=</span> <span class="n">converter</span><span class="o">.</span><span class="n">reverse_encode</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(),</span> <span class="n">length</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">())</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Prediction samples: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">preds_str</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ground truth: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">label_str</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">pred</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">preds_str</span><span class="p">,</span> <span class="n">label_str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">pred</span> <span class="o">==</span> <span class="n">label</span><span class="p">:</span>
                <span class="n">correct_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">IS_ADV</span><span class="p">:</span>
                <span class="n">pred_key</span> <span class="o">=</span> <span class="s1">&#39;adv_pred-</span><span class="si">%09d</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="o">%</span> <span class="n">count</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pred_key</span> <span class="o">=</span> <span class="s1">&#39;pred-</span><span class="si">%09d</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="o">%</span> <span class="n">count</span>

            <span class="n">txn_save</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">pred_key</span><span class="p">,</span> <span class="n">pred</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
<span class="n">accuracy</span> <span class="o">=</span> <span class="n">correct_count</span> <span class="o">/</span> <span class="n">count</span>
</pre></div>
</div>
</li>
</ol>
</li>
<li><p>执行eval_and_save.py脚本:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>eval_and_save.py
</pre></div>
</div>
<p>CNN-CTC模型在生成的自然扰动数据集上进行推理，并在<code class="docutils literal notranslate"><span class="pre">ADV_TEST_DATASET_PATH</span></code>中保存模型对于每个样本的推理结果。</p>
<p>数据集中新增键值对数据项：</p>
<ul class="simple">
<li><p>pred-%09d：模型对原始图片数据的预测结果</p></li>
<li><p>adv_pred-%09d：模型对扰动图片数据的预测结果</p></li>
</ul>
<p>模型对于真实样本的预测结果：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Prediction<span class="w"> </span>samples:
<span class="w">    </span><span class="o">[</span><span class="s1">&#39;private&#39;</span>,<span class="w"> </span><span class="s1">&#39;private&#39;</span>,<span class="w"> </span><span class="s1">&#39;parking&#39;</span>,<span class="w"> </span><span class="s1">&#39;parking&#39;</span>,<span class="w"> </span><span class="s1">&#39;salutes&#39;</span><span class="o">]</span>
Ground<span class="w"> </span>truth:
<span class="w">    </span><span class="o">[</span><span class="s1">&#39;private&#39;</span>,<span class="w"> </span><span class="s1">&#39;private&#39;</span>,<span class="w"> </span><span class="s1">&#39;parking&#39;</span>,<span class="w"> </span><span class="s1">&#39;parking&#39;</span>,<span class="w"> </span><span class="s1">&#39;salutes&#39;</span><span class="o">]</span>
Prediction<span class="w"> </span>samples:
<span class="w">    </span><span class="o">[</span><span class="s1">&#39;venus&#39;</span>,<span class="w"> </span><span class="s1">&#39;venus&#39;</span>,<span class="w"> </span><span class="s1">&#39;its&#39;</span>,<span class="w"> </span><span class="s1">&#39;its&#39;</span>,<span class="w"> </span><span class="s1">&#39;the&#39;</span><span class="o">]</span>
Ground<span class="w"> </span>truth:
<span class="w">    </span><span class="o">[</span><span class="s1">&#39;venus&#39;</span>,<span class="w"> </span><span class="s1">&#39;venus&#39;</span>,<span class="w"> </span><span class="s1">&#39;its&#39;</span>,<span class="w"> </span><span class="s1">&#39;its&#39;</span>,<span class="w"> </span><span class="s1">&#39;the&#39;</span><span class="o">]</span>
Prediction<span class="w"> </span>samples:
<span class="w">    </span><span class="o">[</span><span class="s1">&#39;summer&#39;</span>,<span class="w"> </span><span class="s1">&#39;summer&#39;</span>,<span class="w"> </span><span class="s1">&#39;joeys&#39;</span>,<span class="w"> </span><span class="s1">&#39;joeys&#39;</span>,<span class="w"> </span><span class="s1">&#39;think&#39;</span><span class="o">]</span>
Ground<span class="w"> </span>truth:
<span class="w">    </span><span class="o">[</span><span class="s1">&#39;summer&#39;</span>,<span class="w"> </span><span class="s1">&#39;summer&#39;</span>,<span class="w"> </span><span class="s1">&#39;joes&#39;</span>,<span class="w"> </span><span class="s1">&#39;joes&#39;</span>,<span class="w"> </span><span class="s1">&#39;think&#39;</span><span class="o">]</span>
...
</pre></div>
</div>
<p>模型对于自然扰动样本的预测结果：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Prediction<span class="w"> </span>samples:
<span class="w">    </span><span class="o">[</span><span class="s1">&#39;private&#39;</span>,<span class="w"> </span><span class="s1">&#39;private&#39;</span>,<span class="w"> </span><span class="s1">&#39;parking&#39;</span>,<span class="w"> </span><span class="s1">&#39;parking&#39;</span>,<span class="w"> </span><span class="s1">&#39;salutes&#39;</span><span class="o">]</span>
Ground<span class="w"> </span>truth:
<span class="w">    </span><span class="o">[</span><span class="s1">&#39;private&#39;</span>,<span class="w"> </span><span class="s1">&#39;private&#39;</span>,<span class="w"> </span><span class="s1">&#39;parking&#39;</span>,<span class="w"> </span><span class="s1">&#39;parking&#39;</span>,<span class="w"> </span><span class="s1">&#39;salutes&#39;</span><span class="o">]</span>
Prediction<span class="w"> </span>samples:
<span class="w">    </span><span class="o">[</span><span class="s1">&#39;dams&#39;</span>,<span class="w"> </span><span class="s1">&#39;vares&#39;</span>,<span class="w"> </span><span class="s1">&#39;its&#39;</span>,<span class="w"> </span><span class="s1">&#39;its&#39;</span>,<span class="w"> </span><span class="s1">&#39;the&#39;</span><span class="o">]</span>
Ground<span class="w"> </span>truth:
<span class="w">    </span><span class="o">[</span><span class="s1">&#39;venus&#39;</span>,<span class="w"> </span><span class="s1">&#39;venus&#39;</span>,<span class="w"> </span><span class="s1">&#39;its&#39;</span>,<span class="w"> </span><span class="s1">&#39;its&#39;</span>,<span class="w"> </span><span class="s1">&#39;the&#39;</span><span class="o">]</span>
Prediction<span class="w"> </span>samples:
<span class="w">    </span><span class="o">[</span><span class="s1">&#39;sune&#39;</span>,<span class="w"> </span><span class="s1">&#39;summer&#39;</span>,<span class="w"> </span><span class="s1">&#39;&#39;</span>,<span class="w"> </span><span class="s1">&#39;joeys&#39;</span>,<span class="w"> </span><span class="s1">&#39;think&#39;</span><span class="o">]</span>
Ground<span class="w"> </span>truth:
<span class="w">    </span><span class="o">[</span><span class="s1">&#39;summer&#39;</span>,<span class="w"> </span><span class="s1">&#39;summer&#39;</span>,<span class="w"> </span><span class="s1">&#39;joes&#39;</span>,<span class="w"> </span><span class="s1">&#39;joes&#39;</span>,<span class="w"> </span><span class="s1">&#39;think&#39;</span><span class="o">]</span>
...
</pre></div>
</div>
<p>模型在原始测试数据集和自然扰动数据集上的准确率：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>num<span class="w"> </span>of<span class="w"> </span>samples<span class="w"> </span><span class="k">in</span><span class="w"> </span>IIIT<span class="w"> </span>dataset:<span class="w"> </span><span class="m">5952</span>
Accuracy<span class="w"> </span>of<span class="w"> </span>benign<span class="w"> </span>sample:<span class="w">  </span><span class="m">0</span>.8546195652173914
Accuracy<span class="w"> </span>of<span class="w"> </span>perturbed<span class="w"> </span>sample:<span class="w">  </span><span class="m">0</span>.6126019021739131
</pre></div>
</div>
</li>
</ol>
</section>
<section id="鲁棒性分析">
<h3>鲁棒性分析<a class="headerlink" href="#鲁棒性分析" title="永久链接至标题"></a></h3>
<p>根据CNN-CTC模型在扰动数据集上的表现进行统计分析。运行脚本analyse.py。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>analyse.py
</pre></div>
</div>
<p>分析结果：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Number<span class="w"> </span>of<span class="w"> </span>samples<span class="w"> </span><span class="k">in</span><span class="w"> </span>analyse<span class="w"> </span>dataset:<span class="w">  </span><span class="m">5952</span>
Accuracy<span class="w"> </span>of<span class="w"> </span>original<span class="w"> </span>dataset:<span class="w">  </span><span class="m">0</span>.46127717391304346
Accuracy<span class="w"> </span>of<span class="w"> </span>adversarial<span class="w"> </span>dataset:<span class="w">  </span><span class="m">0</span>.6126019021739131
Number<span class="w"> </span>of<span class="w"> </span>samples<span class="w"> </span>correctly<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>original<span class="w"> </span>dataset<span class="w"> </span>but<span class="w"> </span>wrong<span class="w"> </span><span class="k">in</span><span class="w"> </span>adversarial<span class="w"> </span>dataset:<span class="w">  </span><span class="m">832</span>
Number<span class="w"> </span>of<span class="w"> </span>samples<span class="w"> </span>both<span class="w"> </span>wrong<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>original<span class="w"> </span>and<span class="w"> </span>adversarial<span class="w"> </span>dataset:<span class="w">  </span><span class="m">1449</span>
------------------------------------------------------------------------------
Method<span class="w">  </span>Shear
Number<span class="w"> </span>of<span class="w"> </span>perturb<span class="w"> </span>samples:<span class="w"> </span><span class="m">442</span>
Number<span class="w"> </span>of<span class="w"> </span>wrong<span class="w"> </span>predicted:<span class="w"> </span><span class="m">351</span>
Number<span class="w"> </span>of<span class="w"> </span>correctly<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>dataset<span class="w"> </span>but<span class="w"> </span>wrong<span class="w"> </span><span class="k">in</span><span class="w"> </span>adversarial:<span class="w"> </span><span class="m">153</span>
Number<span class="w"> </span>of<span class="w"> </span>both<span class="w"> </span>wrong<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>and<span class="w"> </span>adversarial<span class="w"> </span>dataset:<span class="w"> </span><span class="m">198</span>
------------------------------------------------------------------------------
Method<span class="w">  </span>Contrast
Number<span class="w"> </span>of<span class="w"> </span>perturb<span class="w"> </span>samples:<span class="w"> </span><span class="m">387</span>
Number<span class="w"> </span>of<span class="w"> </span>wrong<span class="w"> </span>predicted:<span class="w"> </span><span class="m">57</span>
Number<span class="w"> </span>of<span class="w"> </span>correctly<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>dataset<span class="w"> </span>but<span class="w"> </span>wrong<span class="w"> </span><span class="k">in</span><span class="w"> </span>adversarial:<span class="w"> </span><span class="m">8</span>
Number<span class="w"> </span>of<span class="w"> </span>both<span class="w"> </span>wrong<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>and<span class="w"> </span>adversarial<span class="w"> </span>dataset:<span class="w"> </span><span class="m">49</span>
------------------------------------------------------------------------------
Method<span class="w">  </span>GaussianBlur
Number<span class="w"> </span>of<span class="w"> </span>perturb<span class="w"> </span>samples:<span class="w"> </span><span class="m">436</span>
Number<span class="w"> </span>of<span class="w"> </span>wrong<span class="w"> </span>predicted:<span class="w"> </span><span class="m">181</span>
Number<span class="w"> </span>of<span class="w"> </span>correctly<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>dataset<span class="w"> </span>but<span class="w"> </span>wrong<span class="w"> </span><span class="k">in</span><span class="w"> </span>adversarial:<span class="w"> </span><span class="m">71</span>
Number<span class="w"> </span>of<span class="w"> </span>both<span class="w"> </span>wrong<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>and<span class="w"> </span>adversarial<span class="w"> </span>dataset:<span class="w"> </span><span class="m">110</span>
------------------------------------------------------------------------------
Method<span class="w">  </span>MotionBlur
Number<span class="w"> </span>of<span class="w"> </span>perturb<span class="w"> </span>samples:<span class="w"> </span><span class="m">458</span>
Number<span class="w"> </span>of<span class="w"> </span>wrong<span class="w"> </span>predicted:<span class="w"> </span><span class="m">215</span>
Number<span class="w"> </span>of<span class="w"> </span>correctly<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>dataset<span class="w"> </span>but<span class="w"> </span>wrong<span class="w"> </span><span class="k">in</span><span class="w"> </span>adversarial:<span class="w"> </span><span class="m">92</span>
Number<span class="w"> </span>of<span class="w"> </span>both<span class="w"> </span>wrong<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>and<span class="w"> </span>adversarial<span class="w"> </span>dataset:<span class="w"> </span><span class="m">123</span>
------------------------------------------------------------------------------
Method<span class="w">  </span>GradientLuminance
Number<span class="w"> </span>of<span class="w"> </span>perturb<span class="w"> </span>samples:<span class="w"> </span><span class="m">1243</span>
Number<span class="w"> </span>of<span class="w"> </span>wrong<span class="w"> </span>predicted:<span class="w"> </span><span class="m">154</span>
Number<span class="w"> </span>of<span class="w"> </span>correctly<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>dataset<span class="w"> </span>but<span class="w"> </span>wrong<span class="w"> </span><span class="k">in</span><span class="w"> </span>adversarial:<span class="w"> </span><span class="m">4</span>
Number<span class="w"> </span>of<span class="w"> </span>both<span class="w"> </span>wrong<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>and<span class="w"> </span>adversarial<span class="w"> </span>dataset:<span class="w"> </span><span class="m">150</span>
------------------------------------------------------------------------------
Method<span class="w">  </span>Rotate
Number<span class="w"> </span>of<span class="w"> </span>perturb<span class="w"> </span>samples:<span class="w"> </span><span class="m">405</span>
Number<span class="w"> </span>of<span class="w"> </span>wrong<span class="w"> </span>predicted:<span class="w"> </span><span class="m">298</span>
Number<span class="w"> </span>of<span class="w"> </span>correctly<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>dataset<span class="w"> </span>but<span class="w"> </span>wrong<span class="w"> </span><span class="k">in</span><span class="w"> </span>adversarial:<span class="w"> </span><span class="m">136</span>
Number<span class="w"> </span>of<span class="w"> </span>both<span class="w"> </span>wrong<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>and<span class="w"> </span>adversarial<span class="w"> </span>dataset:<span class="w"> </span><span class="m">162</span>
------------------------------------------------------------------------------
Method<span class="w">  </span>SaltAndPepperNoise
Number<span class="w"> </span>of<span class="w"> </span>perturb<span class="w"> </span>samples:<span class="w"> </span><span class="m">413</span>
Number<span class="w"> </span>of<span class="w"> </span>wrong<span class="w"> </span>predicted:<span class="w"> </span><span class="m">116</span>
Number<span class="w"> </span>of<span class="w"> </span>correctly<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>dataset<span class="w"> </span>but<span class="w"> </span>wrong<span class="w"> </span><span class="k">in</span><span class="w"> </span>adversarial:<span class="w"> </span><span class="m">29</span>
Number<span class="w"> </span>of<span class="w"> </span>both<span class="w"> </span>wrong<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>and<span class="w"> </span>adversarial<span class="w"> </span>dataset:<span class="w"> </span><span class="m">87</span>
------------------------------------------------------------------------------
Method<span class="w">  </span>Translate
Number<span class="w"> </span>of<span class="w"> </span>perturb<span class="w"> </span>samples:<span class="w"> </span><span class="m">419</span>
Number<span class="w"> </span>of<span class="w"> </span>wrong<span class="w"> </span>predicted:<span class="w"> </span><span class="m">159</span>
Number<span class="w"> </span>of<span class="w"> </span>correctly<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>dataset<span class="w"> </span>but<span class="w"> </span>wrong<span class="w"> </span><span class="k">in</span><span class="w"> </span>adversarial:<span class="w"> </span><span class="m">57</span>
Number<span class="w"> </span>of<span class="w"> </span>both<span class="w"> </span>wrong<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>and<span class="w"> </span>adversarial<span class="w"> </span>dataset:<span class="w"> </span><span class="m">102</span>
------------------------------------------------------------------------------
Method<span class="w">  </span>GradientBlur
Number<span class="w"> </span>of<span class="w"> </span>perturb<span class="w"> </span>samples:<span class="w"> </span><span class="m">440</span>
Number<span class="w"> </span>of<span class="w"> </span>wrong<span class="w"> </span>predicted:<span class="w"> </span><span class="m">92</span>
Number<span class="w"> </span>of<span class="w"> </span>correctly<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>dataset<span class="w"> </span>but<span class="w"> </span>wrong<span class="w"> </span><span class="k">in</span><span class="w"> </span>adversarial:<span class="w"> </span><span class="m">26</span>
Number<span class="w"> </span>of<span class="w"> </span>both<span class="w"> </span>wrong<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>and<span class="w"> </span>adversarial<span class="w"> </span>dataset:<span class="w"> </span><span class="m">66</span>
------------------------------------------------------------------------------
Method<span class="w">  </span>Perspective
Number<span class="w"> </span>of<span class="w"> </span>perturb<span class="w"> </span>samples:<span class="w"> </span><span class="m">401</span>
Number<span class="w"> </span>of<span class="w"> </span>wrong<span class="w"> </span>predicted:<span class="w"> </span><span class="m">181</span>
Number<span class="w"> </span>of<span class="w"> </span>correctly<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>dataset<span class="w"> </span>but<span class="w"> </span>wrong<span class="w"> </span><span class="k">in</span><span class="w"> </span>adversarial:<span class="w"> </span><span class="m">75</span>
Number<span class="w"> </span>of<span class="w"> </span>both<span class="w"> </span>wrong<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>and<span class="w"> </span>adversarial<span class="w"> </span>dataset:<span class="w"> </span><span class="m">106</span>
------------------------------------------------------------------------------
Method<span class="w">  </span>Curve
Number<span class="w"> </span>of<span class="w"> </span>perturb<span class="w"> </span>samples:<span class="w"> </span><span class="m">410</span>
Number<span class="w"> </span>of<span class="w"> </span>wrong<span class="w"> </span>predicted:<span class="w"> </span><span class="m">361</span>
Number<span class="w"> </span>of<span class="w"> </span>correctly<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>dataset<span class="w"> </span>but<span class="w"> </span>wrong<span class="w"> </span><span class="k">in</span><span class="w"> </span>adversarial:<span class="w"> </span><span class="m">162</span>
Number<span class="w"> </span>of<span class="w"> </span>both<span class="w"> </span>wrong<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>and<span class="w"> </span>adversarial<span class="w"> </span>dataset:<span class="w"> </span><span class="m">199</span>
------------------------------------------------------------------------------
Method<span class="w">  </span>Scale
Number<span class="w"> </span>of<span class="w"> </span>perturb<span class="w"> </span>samples:<span class="w"> </span><span class="m">434</span>
Number<span class="w"> </span>of<span class="w"> </span>wrong<span class="w"> </span>predicted:<span class="w"> </span><span class="m">116</span>
Number<span class="w"> </span>of<span class="w"> </span>correctly<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>dataset<span class="w"> </span>but<span class="w"> </span>wrong<span class="w"> </span><span class="k">in</span><span class="w"> </span>adversarial:<span class="w"> </span><span class="m">19</span>
Number<span class="w"> </span>of<span class="w"> </span>both<span class="w"> </span>wrong<span class="w"> </span>predicted<span class="w"> </span><span class="k">in</span><span class="w"> </span>origin<span class="w"> </span>and<span class="w"> </span>adversarial<span class="w"> </span>dataset:<span class="w"> </span><span class="m">97</span>
------------------------------------------------------------------------------
</pre></div>
</div>
<p>分析结果包含：</p>
<ol class="arabic simple">
<li><p>评测的样本数量：5888</p></li>
<li><p>CNN-CTC模型在原数据集上的准确率：85.4%</p></li>
<li><p>CNN-CTC模型在扰动数据集上的准确率：57.2%</p></li>
<li><p>在原图上预测正确，扰动后图片预测错误的 样本数量：1736</p></li>
<li><p>在原图和扰动后图片上均预测错误的样本数量：782</p></li>
<li><p>对于每一个扰动方法，包含样本数量、扰动样本预测错误的数量、原样本预测正确扰动后预测错误的数量、原样本和扰动样本均预测错误的数量。</p></li>
</ol>
<p>如果模型对某扰动方法扰动后的图片预测错误率较高，则说明CNN-CTC模型对于该方法鲁棒性较差，建议针对性提升，如Rotate、Curve、MotionBlur和Shear这几种扰动方法，大部分扰动后的图片都预测错误，建议进一步分析。</p>
<p>同时在<code class="docutils literal notranslate"><span class="pre">ADV_TEST_DATASET_PATH</span></code>路径下生成3个文件夹：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>adv_wrong_pred<span class="w">                  </span><span class="c1"># 模型对于扰动后图片分类错误的数据集</span>
ori_corret_adv_wrong_pred<span class="w">       </span><span class="c1"># 模型对于原图分类正确但扰动后图片分类错误的数据集</span>
ori_wrong_adv_wrong_pred<span class="w">        </span><span class="c1"># 模型对于原图分类和扰动后图片均分类错误的数据集</span>
</pre></div>
</div>
<p>每个文件夹均按照扰动方法分类:</p>
<p><img alt="1646730529400" src="_images/catalog.png" /></p>
<p>每张图片的命名格式：真值-预测值.png，如下图：</p>
<p><img alt="1646812837049" src="_images/name_format.png" /></p>
<p>存储的图片可供进一步分析，是模型质量问题、图片质量问题、还是扰动方法影响图片语义从而导致预测错误。</p>
<p><img alt="1646812837049" src="_images/result_demo.png" /></p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="test_model_security_fuzzing.html" class="btn btn-neutral float-left" title="使用fuzz testing模块测试模型安全性" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="model_encrypt_protection.html" class="btn btn-neutral float-right" title="模型加密保护" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 MindSpore.</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用了 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a>开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 
</body>
</html>