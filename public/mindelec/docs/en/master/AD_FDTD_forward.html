<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>S-parameter Simulation of Patch Antenna Based on Differentiable FDTD &mdash; MindSpore master documentation</title><script>;(()=>{const e=localStorage.getItem("ms-theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;(e?"dark"===e:t)&&document.documentElement.setAttribute("data-o-theme","dark")})();</script><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <script src="_static/js/theme.js"></script>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script async="async" src="https://cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Device-to-device Differentiable FDTD for Solving Electromagnetic Inverse Scattering" href="AD_FDTD_inverse.html" />
    <link rel="prev" title="Device-to-device differentiable FDTD method" href="AD_FDTD.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> MindSpore
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="intro_and_install.html">MindSpore Elec Introduction and Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Application</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="physics_driven.html">Physics Informed Deep Learning Method for Electromagnetic Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_driven.html">Data Driven Deep Learning Method for Electromagnetic Simulation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="AD_FDTD.html">Device-to-device differentiable FDTD method</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">S-parameter Simulation of Patch Antenna Based on Differentiable FDTD</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#maxwell's-equations">Maxwell’s Equations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation-process">Simulation Process</a></li>
<li class="toctree-l3"><a class="reference internal" href="#s-parameter-simulation-of-patch-invert-f-antenna">S-parameter Simulation of Patch Invert_f Antenna</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#import-dependencies">Import Dependencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="#defining-the-excitation-source-time-domain-waveform">Defining the Excitation Source Time Domain Waveform</a></li>
<li class="toctree-l4"><a class="reference internal" href="#defining-the-antenna-structure,-excitation-port-and-sampling-port">Defining the Antenna Structure, Excitation Port and Sampling Port</a></li>
<li class="toctree-l4"><a class="reference internal" href="#building-neural-network-and-solving">Building Neural Network and Solving</a></li>
<li class="toctree-l4"><a class="reference internal" href="#solution">Solution</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#s-parameter-simulation-of-patch-microstrip-filter">S-parameter Simulation of Patch Microstrip Filter</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#import-dependencies-1">Import Dependencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="#defining-the-excitation-source-time-domain-waveform-1">Defining the Excitation Source Time Domain Waveform</a></li>
<li class="toctree-l4"><a class="reference internal" href="#defining-filter-structure,-excitation-port-and-sampling-port">Defining Filter Structure, Excitation Port and Sampling Port</a></li>
<li class="toctree-l4"><a class="reference internal" href="#building-neural-network-and-solve">Building Neural Network and Solve</a></li>
<li class="toctree-l4"><a class="reference internal" href="#solution-1">Solution</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="AD_FDTD_inverse.html">Device-to-device Differentiable FDTD for Solving Electromagnetic Inverse Scattering</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="visualization.html">Visualizing Electromagnetic Simulation Results</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="mindelec.architecture.html">mindelec.architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindelec.common.html">mindelec.common</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindelec.data.html">mindelec.data</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindelec.geometry.html">mindelec.geometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindelec.loss.html">mindelec.loss</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindelec.operators.html">mindelec.operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindelec.solver.html">mindelec.solver</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindelec.vision.html">mindelec.vision</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">RELEASE NOTES</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="RELEASE.html">Release Notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MindSpore</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="AD_FDTD.html">Device-to-device differentiable FDTD method</a> &raquo;</li>
      <li>S-parameter Simulation of Patch Antenna Based on Differentiable FDTD</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/AD_FDTD_forward.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="s-parameter-simulation-of-patch-antenna-based-on-differentiable-fdtd">
<h1>S-parameter Simulation of Patch Antenna Based on Differentiable FDTD<a class="headerlink" href="#s-parameter-simulation-of-patch-antenna-based-on-differentiable-fdtd" title="Permalink to this headline"></a></h1>
<p><a class="reference external" href="https://gitee.com/mindspore/docs/blob/master/docs/mindelec/docs/source_en/AD_FDTD_forward.md"><img alt="View Source On Gitee" src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/master/resource/_static/logo_source_en.png" /></a>  </p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline"></a></h2>
<p>This tutorial introduces the method for solving electromagnetic positive problems provided by MindSpore Elec   based on device-to-device differentiable FDTD. The process of solving Maxwell’s equations by the finite-difference time-domain (FDTD) method is equivalent to a recurrent convolutional network (RCNN). The device-to-device differentiable FDTD can be obtained by rewriting the update process with the differentiable operator of MindSpore. Compared with the data-driven black-box model, the solution process of the differentiable FDTD method strictly satisfies the constraints of Maxwell’s equations, and the accuracy is comparable to that of traditional numerical algorithms.</p>
<blockquote>
<div><p>This example is for GPU processors and you can download the full sample code here:
<a class="reference external" href="https://gitee.com/mindspore/mindscience/tree/master/MindElec/examples/AD_FDTD/fdtd_forward">https://gitee.com/mindspore/mindscience/tree/master/MindElec/examples/AD_FDTD/fdtd_forward</a></p>
</div></blockquote>
</section>
<section id="maxwell's-equations">
<h2>Maxwell’s Equations<a class="headerlink" href="#maxwell's-equations" title="Permalink to this headline"></a></h2>
<p>Active Maxwell’s equations are the classical control equations for electromagnetic simulation, which are a set of partial differential equations describing the relationship between electric and magnetic fields and charge density and current density, in the following form:</p>
<div class="math notranslate nohighlight">
\[
\nabla\times E=-\mu \dfrac{\partial H}{\partial t},
\]</div>
<div class="math notranslate nohighlight">
\[
\nabla\times H=\epsilon \dfrac{\partial E}{\partial t}+\sigma E+ J(x, t)
\]</div>
<p>where <span class="math notranslate nohighlight">\(\epsilon,\mu,\sigma\)</span> are the absolute permittivity, absolute magnetic permeability, and electrical conductivity of the medium, respectively. <span class="math notranslate nohighlight">\(J(x, t)\)</span> is the excitation source in the electromagnetic simulation process, which is usually expressed in the form of a port pulse. The port in this case is a line port, which can be expressed as:</p>
<div class="math notranslate nohighlight">
\[
J(x, t)=H(x - x_0)H(x_1 - x)g(t)
\]</div>
<p>where <span class="math notranslate nohighlight">\(x_0\)</span> and <span class="math notranslate nohighlight">\(x_1\)</span> are the starting and ending positions of the pilot port, respectively, <span class="math notranslate nohighlight">\(H(x)\)</span> is the step function, and <span class="math notranslate nohighlight">\(g(t)\)</span> is the functional expression of the pulse signal.</p>
</section>
<section id="simulation-process">
<h2>Simulation Process<a class="headerlink" href="#simulation-process" title="Permalink to this headline"></a></h2>
<p>The specific flow of MindSpore Elec for antenna S parameter simulation is as follows:</p>
<ol class="arabic simple">
<li><p>Define antenna structure, excitation port location and type, sampling port.</p></li>
<li><p>Define the excitation source time domain waveform.</p></li>
<li><p>Building neural networks.</p></li>
<li><p>Solve and evaluate the results.</p></li>
</ol>
</section>
<section id="s-parameter-simulation-of-patch-invert-f-antenna">
<h2>S-parameter Simulation of Patch Invert_f Antenna<a class="headerlink" href="#s-parameter-simulation-of-patch-invert-f-antenna" title="Permalink to this headline"></a></h2>
<p>The case simulates the S-parameter of the patch invert_f antenna. The antenna structure is shown in the figure below.</p>
<p><img alt="invert_f_structure" src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/master/docs/mindelec/docs/source_zh_cn/images/AD_FDTD/fdtd_forward/invert_f_structure.png" /></p>
<section id="import-dependencies">
<h3>Import Dependencies<a class="headerlink" href="#import-dependencies" title="Permalink to this headline"></a></h3>
<p>Import the modules and interfaces that this tutorial depends on:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">src</span> <span class="kn">import</span> <span class="n">estimate_time_interval</span><span class="p">,</span> <span class="n">compare_s</span>
<span class="kn">from</span> <span class="nn">src</span> <span class="kn">import</span> <span class="n">CFSParameters</span><span class="p">,</span> <span class="n">Gaussian</span>
<span class="kn">from</span> <span class="nn">src</span> <span class="kn">import</span> <span class="n">Antenna</span><span class="p">,</span> <span class="n">SParameterSolver</span>
<span class="kn">from</span> <span class="nn">src</span> <span class="kn">import</span> <span class="n">GridHelper</span><span class="p">,</span> <span class="n">UniformBrick</span><span class="p">,</span> <span class="n">PECPlate</span><span class="p">,</span> <span class="n">VoltageSource</span>
<span class="kn">from</span> <span class="nn">src</span> <span class="kn">import</span> <span class="n">VoltageMonitor</span><span class="p">,</span> <span class="n">CurrentMonitor</span>
<span class="kn">from</span> <span class="nn">src</span> <span class="kn">import</span> <span class="n">full3d</span>
</pre></div>
</div>
</section>
<section id="defining-the-excitation-source-time-domain-waveform">
<h3>Defining the Excitation Source Time Domain Waveform<a class="headerlink" href="#defining-the-excitation-source-time-domain-waveform" title="Permalink to this headline"></a></h3>
<p>The time domain waveform of the excitation source in this case is a Gaussian pulse. FDTD uses the leap-frog scheme to update the electric and magnetic fields separately, and the excitation source in this case is a voltage source, so the time domain waveform value of the excitation source on the half time step should be calculated.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_waveform_t</span><span class="p">(</span><span class="n">nt</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">fmax</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute waveforms at time t.</span>

<span class="sd">    Args:</span>
<span class="sd">        nt (int): Number of time steps.</span>
<span class="sd">        dt (float): Time interval.</span>
<span class="sd">        fmax (float): Maximum freuqency of Gaussian wave</span>

<span class="sd">    Returns:</span>
<span class="sd">        waveform_t (Tensor, shape=(nt,)): Waveforms.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nt</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span>
    <span class="n">waveform</span> <span class="o">=</span> <span class="n">Gaussian</span><span class="p">(</span><span class="n">fmax</span><span class="p">)</span>
    <span class="n">waveform_t</span> <span class="o">=</span> <span class="n">waveform</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">waveform_t</span><span class="p">,</span> <span class="n">t</span>
</pre></div>
</div>
</section>
<section id="defining-the-antenna-structure,-excitation-port-and-sampling-port">
<h3>Defining the Antenna Structure, Excitation Port and Sampling Port<a class="headerlink" href="#defining-the-antenna-structure,-excitation-port-and-sampling-port" title="Permalink to this headline"></a></h3>
<p>Users can customize the antenna structure, excitation port and sampling port on the grid according to the antenna design drawing. First, according to the split size, total antenna size, PML layer thickness, air layer thickness, the program automatically generates the FDTD <code class="docutils literal notranslate"><span class="pre">grid</span></code>. Then, user can define antenna structure, excitation port and sampling port on <code class="docutils literal notranslate"><span class="pre">grid</span></code> with the help of various components provided by the program according to the antenna design drawing, such as dielectric substrate (uniform dielectric block <code class="docutils literal notranslate"><span class="pre">UniformBrick</span></code>), metal patch (<code class="docutils literal notranslate"><span class="pre">PECPlate</span></code>), voltage source (<code class="docutils literal notranslate"><span class="pre">VoltageSource</span></code>), voltage sampling port (<code class="docutils literal notranslate"><span class="pre">VoltageMonitor</span></code>) and current sampling port (<code class="docutils literal notranslate"><span class="pre">CurrentMonitor</span></code>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_invert_f_antenna</span><span class="p">(</span><span class="n">air_buffers</span><span class="p">,</span> <span class="n">npml</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Get grid for IFA. &quot;&quot;&quot;</span>
    <span class="n">cell_lengths</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.262e-3</span><span class="p">,</span> <span class="mf">0.4e-3</span><span class="p">,</span> <span class="mf">0.4e-3</span><span class="p">)</span>
    <span class="n">obj_lengths</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.787e-3</span><span class="p">,</span> <span class="mf">40e-3</span><span class="p">,</span> <span class="mf">40e-3</span><span class="p">)</span>
    <span class="n">cell_numbers</span> <span class="o">=</span> <span class="p">(</span>
        <span class="mi">2</span> <span class="o">*</span> <span class="n">npml</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">air_buffers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">obj_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">cell_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="mi">2</span> <span class="o">*</span> <span class="n">npml</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">air_buffers</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">obj_lengths</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">cell_lengths</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="mi">2</span> <span class="o">*</span> <span class="n">npml</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">air_buffers</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">obj_lengths</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">cell_lengths</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
    <span class="p">)</span>

    <span class="n">grid</span> <span class="o">=</span> <span class="n">GridHelper</span><span class="p">(</span><span class="n">cell_numbers</span><span class="p">,</span> <span class="n">cell_lengths</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="p">(</span>
        <span class="n">npml</span> <span class="o">+</span> <span class="n">air_buffers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">obj_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">cell_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="n">npml</span> <span class="o">+</span> <span class="n">air_buffers</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">npml</span> <span class="o">+</span> <span class="n">air_buffers</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
    <span class="p">))</span>

    <span class="c1"># Define antenna</span>
    <span class="n">grid</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="n">UniformBrick</span><span class="p">(</span><span class="n">epsr</span><span class="o">=</span><span class="mf">2.2</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">71</span><span class="p">,</span> <span class="mi">60</span><span class="p">:</span><span class="mi">66</span><span class="p">]</span> <span class="o">=</span> <span class="n">PECPlate</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">:</span><span class="mi">71</span><span class="p">,</span> <span class="mi">75</span><span class="p">:</span><span class="mi">81</span><span class="p">]</span> <span class="o">=</span> <span class="n">PECPlate</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">65</span><span class="p">:</span><span class="mi">71</span><span class="p">,</span> <span class="mi">21</span><span class="p">:</span><span class="mi">81</span><span class="p">]</span> <span class="o">=</span> <span class="n">PECPlate</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">52</span><span class="p">:</span><span class="mi">58</span><span class="p">,</span> <span class="mi">40</span><span class="p">:</span><span class="mi">81</span><span class="p">]</span> <span class="o">=</span> <span class="n">PECPlate</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">75</span><span class="p">:</span><span class="mi">81</span><span class="p">]</span> <span class="o">=</span> <span class="n">PECPlate</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">40</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="n">PECPlate</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>

    <span class="c1"># Define sources</span>
    <span class="n">grid</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">:</span><span class="mi">66</span><span class="p">]</span> <span class="o">=</span>\
        <span class="n">VoltageSource</span><span class="p">(</span><span class="n">amplitude</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mf">50.</span><span class="p">,</span> <span class="n">polarization</span><span class="o">=</span><span class="s1">&#39;xp&#39;</span><span class="p">)</span>

    <span class="c1"># Define monitors</span>
    <span class="n">grid</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">61</span><span class="p">:</span><span class="mi">66</span><span class="p">]</span> <span class="o">=</span> <span class="n">VoltageMonitor</span><span class="p">(</span><span class="s1">&#39;xp&#39;</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">:</span><span class="mi">66</span><span class="p">]</span> <span class="o">=</span> <span class="n">CurrentMonitor</span><span class="p">(</span><span class="s1">&#39;xp&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">grid</span>
</pre></div>
</div>
<p>It should be noted that when defining the antenna structure, excitation port location and sampling port location on the <code class="docutils literal notranslate"><span class="pre">grid</span></code>, users can specify the object location either directly by the grid number or by the spatial coordinates. However, users need to be aware that specifying object positions by spatial coordinates may introduce modeling errors. For example, users can mix grid numbers and spatial coordinates to define the antenna structure:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="o">...</span>
    <span class="c1"># Define antenna</span>
    <span class="n">grid</span><span class="p">[</span><span class="o">-</span><span class="mf">0.787e-3</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mf">40e-3</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mf">40e-3</span><span class="p">]</span> <span class="o">=</span> <span class="n">UniformBrick</span><span class="p">(</span><span class="n">epsr</span><span class="o">=</span><span class="mf">2.2</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mf">28.4e-3</span><span class="p">,</span> <span class="mf">24e-3</span><span class="p">:</span><span class="mf">26.4e-3</span><span class="p">]</span> <span class="o">=</span> <span class="n">PECPlate</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">16e-3</span><span class="p">:</span><span class="mf">28.4e-3</span><span class="p">,</span> <span class="mf">30e-3</span><span class="p">:</span><span class="mf">32.4e-3</span><span class="p">]</span> <span class="o">=</span> <span class="n">PECPlate</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">26e-3</span><span class="p">:</span><span class="mf">28.4e-3</span><span class="p">,</span> <span class="mf">8.4e-3</span><span class="p">:</span><span class="mf">32.4e-3</span><span class="p">]</span> <span class="o">=</span> <span class="n">PECPlate</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">20.8e-3</span><span class="p">:</span><span class="mf">23.2e-3</span><span class="p">,</span> <span class="mf">16e-3</span><span class="p">:</span><span class="mf">32.4e-3</span><span class="p">]</span> <span class="o">=</span> <span class="n">PECPlate</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="o">-</span><span class="mf">0.787e-3</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mf">16e-3</span><span class="p">,</span> <span class="mf">30e-3</span><span class="p">:</span><span class="mf">32.4e-3</span><span class="p">]</span> <span class="o">=</span> <span class="n">PECPlate</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="o">-</span><span class="mf">0.787e-3</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mf">16e-3</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mf">40e-3</span><span class="p">]</span> <span class="o">=</span> <span class="n">PECPlate</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="building-neural-network-and-solving">
<h3>Building Neural Network and Solving<a class="headerlink" href="#building-neural-network-and-solving" title="Permalink to this headline"></a></h3>
<p>Define the differentiable FDTD network, then define the S-parameter solver object <code class="docutils literal notranslate"><span class="pre">solver</span></code> and call the <code class="docutils literal notranslate"><span class="pre">solve</span></code> interface for solving.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="c1"># define fdtd network</span>
    <span class="n">fdtd_net</span> <span class="o">=</span> <span class="n">full3d</span><span class="o">.</span><span class="n">ADFDTD</span><span class="p">(</span><span class="n">grid_helper</span><span class="o">.</span><span class="n">cell_numbers</span><span class="p">,</span> <span class="n">grid_helper</span><span class="o">.</span><span class="n">cell_lengths</span><span class="p">,</span>
                             <span class="n">nt</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">antenna</span><span class="p">,</span> <span class="n">cpml</span><span class="p">)</span>
    <span class="c1"># define solver</span>
    <span class="n">solver</span> <span class="o">=</span> <span class="n">SParameterSolver</span><span class="p">(</span><span class="n">fdtd_net</span><span class="p">)</span>

    <span class="c1"># solve</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">waveform_t</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="solution">
<h3>Solution<a class="headerlink" href="#solution" title="Permalink to this headline"></a></h3>
<p>Define the sampling frequency and call the <code class="docutils literal notranslate"><span class="pre">eval</span></code> port to get the S parameter on the sampling frequency.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="c1"># sampling frequencies</span>
    <span class="n">fs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="mi">501</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># eval</span>
    <span class="n">s_parameters</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
<p>The comparison of the S-parameters calculated by the program with the results of reference is as follows:</p>
<p><img alt="PIFA_S11" src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/master/docs/mindelec/docs/source_zh_cn/images/AD_FDTD/fdtd_forward/invert_f_s_parameters.png" /></p>
</section>
</section>
<section id="s-parameter-simulation-of-patch-microstrip-filter">
<h2>S-parameter Simulation of Patch Microstrip Filter<a class="headerlink" href="#s-parameter-simulation-of-patch-microstrip-filter" title="Permalink to this headline"></a></h2>
<p>This case simulates the S-parameters of the patch microstrip filter. The device structure is shown in the figure below.</p>
<p><img alt="microstrip_filter_structure" src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/master/docs/mindelec/docs/source_zh_cn/images/AD_FDTD/fdtd_forward/microstrip_filter_structure.png" /></p>
<section id="import-dependencies-1">
<h3>Import Dependencies<a class="headerlink" href="#import-dependencies-1" title="Permalink to this headline"></a></h3>
<p>Import the modules and interfaces that this tutorial depends on:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">src</span> <span class="kn">import</span> <span class="n">estimate_time_interval</span><span class="p">,</span> <span class="n">compare_s</span>
<span class="kn">from</span> <span class="nn">src</span> <span class="kn">import</span> <span class="n">CFSParameters</span><span class="p">,</span> <span class="n">Gaussian</span>
<span class="kn">from</span> <span class="nn">src</span> <span class="kn">import</span> <span class="n">Antenna</span><span class="p">,</span> <span class="n">SParameterSolver</span>
<span class="kn">from</span> <span class="nn">src</span> <span class="kn">import</span> <span class="n">GridHelper</span><span class="p">,</span> <span class="n">UniformBrick</span><span class="p">,</span> <span class="n">PECPlate</span><span class="p">,</span> <span class="n">VoltageSource</span><span class="p">,</span> <span class="n">Resistor</span>
<span class="kn">from</span> <span class="nn">src</span> <span class="kn">import</span> <span class="n">VoltageMonitor</span><span class="p">,</span> <span class="n">CurrentMonitor</span>
<span class="kn">from</span> <span class="nn">src</span> <span class="kn">import</span> <span class="n">full3d</span>
</pre></div>
</div>
</section>
<section id="defining-the-excitation-source-time-domain-waveform-1">
<h3>Defining the Excitation Source Time Domain Waveform<a class="headerlink" href="#defining-the-excitation-source-time-domain-waveform-1" title="Permalink to this headline"></a></h3>
<p>The excitation source time domain waveform in this case is a Gaussian pulse. FDTD uses the leap-frog scheme to update the electric and magnetic fields separately, and the excitation source in this case is a voltage source, so the time domain waveform value of the excitation source on the half time step should be calculated.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_waveform_t</span><span class="p">(</span><span class="n">nt</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">fmax</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute waveforms at time t.</span>

<span class="sd">    Args:</span>
<span class="sd">        nt (int): Number of time steps.</span>
<span class="sd">        dt (float): Time interval.</span>
<span class="sd">        fmax (float): Maximum freuqency of Gaussian wave</span>

<span class="sd">    Returns:</span>
<span class="sd">        waveform_t (Tensor, shape=(nt,)): Waveforms.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nt</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span>
    <span class="n">waveform</span> <span class="o">=</span> <span class="n">Gaussian</span><span class="p">(</span><span class="n">fmax</span><span class="p">)</span>
    <span class="n">waveform_t</span> <span class="o">=</span> <span class="n">waveform</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">waveform_t</span><span class="p">,</span> <span class="n">t</span>
</pre></div>
</div>
</section>
<section id="defining-filter-structure,-excitation-port-and-sampling-port">
<h3>Defining Filter Structure, Excitation Port and Sampling Port<a class="headerlink" href="#defining-filter-structure,-excitation-port-and-sampling-port" title="Permalink to this headline"></a></h3>
<p>Users can customize the filter structure, excitation port and sampling port on the grid according to the patch filter design drawing. First, according to the split size, total filter size, PML layer thickness, air layer thickness, the program automatically generates the FDTD <code class="docutils literal notranslate"><span class="pre">grid</span></code>. Then, user can define filter structure, excitation port and sampling port on <code class="docutils literal notranslate"><span class="pre">grid</span></code> with the help of various components provided by the program according to the filter design drawing, such as dielectric substrate (uniform dielectric block <code class="docutils literal notranslate"><span class="pre">UniformBrick</span></code>), metal patch (<code class="docutils literal notranslate"><span class="pre">PECPlate</span></code>), voltage source (<code class="docutils literal notranslate"><span class="pre">VoltageSource</span></code>), resistor (<code class="docutils literal notranslate"><span class="pre">Resistor</span></code>), voltage sampling port (<code class="docutils literal notranslate"><span class="pre">VoltageMonitor</span></code>) and current sampling port (<code class="docutils literal notranslate"><span class="pre">CurrentMonitor</span></code>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_microstrip_filter</span><span class="p">(</span><span class="n">air_buffers</span><span class="p">,</span> <span class="n">npml</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; microstrip filter &quot;&quot;&quot;</span>
    <span class="n">cell_lengths</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.4064e-3</span><span class="p">,</span> <span class="mf">0.4233e-3</span><span class="p">,</span> <span class="mf">0.265e-3</span><span class="p">)</span>
    <span class="n">obj_lengths</span> <span class="o">=</span> <span class="p">(</span><span class="mi">50</span> <span class="o">*</span> <span class="n">cell_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                   <span class="mi">46</span> <span class="o">*</span> <span class="n">cell_lengths</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                   <span class="mi">3</span> <span class="o">*</span> <span class="n">cell_lengths</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">cell_numbers</span> <span class="o">=</span> <span class="p">(</span>
        <span class="mi">2</span> <span class="o">*</span> <span class="n">npml</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">air_buffers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">obj_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">cell_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="mi">2</span> <span class="o">*</span> <span class="n">npml</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">air_buffers</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">obj_lengths</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">cell_lengths</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="mi">2</span> <span class="o">*</span> <span class="n">npml</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">air_buffers</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">obj_lengths</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">cell_lengths</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
    <span class="p">)</span>

    <span class="n">grid</span> <span class="o">=</span> <span class="n">GridHelper</span><span class="p">(</span><span class="n">cell_numbers</span><span class="p">,</span> <span class="n">cell_lengths</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="p">(</span>
        <span class="n">npml</span> <span class="o">+</span> <span class="n">air_buffers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">npml</span> <span class="o">+</span> <span class="n">air_buffers</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">npml</span> <span class="o">+</span> <span class="n">air_buffers</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
    <span class="p">))</span>

    <span class="c1"># Define antenna</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">46</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">UniformBrick</span><span class="p">(</span><span class="n">epsr</span><span class="o">=</span><span class="mf">2.2</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">14</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">PECPlate</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">30</span><span class="p">:</span><span class="mi">36</span><span class="p">,</span> <span class="mi">26</span><span class="p">:</span><span class="mi">46</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">PECPlate</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span> <span class="mi">20</span><span class="p">:</span><span class="mi">26</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">PECPlate</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">46</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">PECPlate</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>

    <span class="c1"># Define sources</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">14</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">VoltageSource</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">50.</span><span class="p">,</span> <span class="s1">&#39;zp&#39;</span><span class="p">)</span>

    <span class="c1"># Define load</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">30</span><span class="p">:</span><span class="mi">36</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">Resistor</span><span class="p">(</span><span class="mf">50.</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span>

    <span class="c1"># Define monitors</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">14</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">VoltageMonitor</span><span class="p">(</span><span class="s1">&#39;zp&#39;</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">14</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">CurrentMonitor</span><span class="p">(</span><span class="s1">&#39;yp&#39;</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">30</span><span class="p">:</span><span class="mi">36</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">VoltageMonitor</span><span class="p">(</span><span class="s1">&#39;zp&#39;</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">30</span><span class="p">:</span><span class="mi">36</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">CurrentMonitor</span><span class="p">(</span><span class="s1">&#39;yn&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">grid</span>
</pre></div>
</div>
<p>It should be noted that the patch filter in this case is a two-port device, and only S11 and S21 parameters are simulated in this case. In order to calculate the multi-port S-parameters, the voltage sampling port and current sampling port need to be defined separately at each port.</p>
</section>
<section id="building-neural-network-and-solve">
<h3>Building Neural Network and Solve<a class="headerlink" href="#building-neural-network-and-solve" title="Permalink to this headline"></a></h3>
<p>Define the differentiable FDTD network, then define the S-parameter solver object <code class="docutils literal notranslate"><span class="pre">solver</span></code> and call the <code class="docutils literal notranslate"><span class="pre">solve</span></code> interface for solving.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="c1"># define fdtd network</span>
    <span class="n">fdtd_net</span> <span class="o">=</span> <span class="n">full3d</span><span class="o">.</span><span class="n">ADFDTD</span><span class="p">(</span><span class="n">grid_helper</span><span class="o">.</span><span class="n">cell_numbers</span><span class="p">,</span> <span class="n">grid_helper</span><span class="o">.</span><span class="n">cell_lengths</span><span class="p">,</span>
                             <span class="n">nt</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">antenna</span><span class="p">,</span> <span class="n">cpml</span><span class="p">)</span>
    <span class="c1"># define solver</span>
    <span class="n">solver</span> <span class="o">=</span> <span class="n">SParameterSolver</span><span class="p">(</span><span class="n">fdtd_net</span><span class="p">)</span>

    <span class="c1"># solve</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">waveform_t</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="solution-1">
<h3>Solution<a class="headerlink" href="#solution-1" title="Permalink to this headline"></a></h3>
<p>Define the sampling frequency and call the <code class="docutils literal notranslate"><span class="pre">eval</span></code> port to get the S parameter on the sampling frequency:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="c1"># sampling frequencies</span>
    <span class="n">fs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="mi">1001</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># eval</span>
    <span class="n">s_parameters</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
<p>The comparison of the S-parameters calculated by the program with the results of reference is as follows:</p>
<p><img alt="Patch_Microstrip_Filter_S" src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/master/docs/mindelec/docs/source_zh_cn/images/AD_FDTD/fdtd_forward/microstrip_filter_s_parameters.png" /></p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="AD_FDTD.html" class="btn btn-neutral float-left" title="Device-to-device differentiable FDTD method" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="AD_FDTD_inverse.html" class="btn btn-neutral float-right" title="Device-to-device Differentiable FDTD for Solving Electromagnetic Inverse Scattering" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, MindSpore.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 
</body>
</html>