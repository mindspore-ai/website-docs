<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Visualizing Electromagnetic Simulation Results &mdash; MindSpore master documentation</title><script>;(()=>{const e=localStorage.getItem("ms-theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;(e?"dark"===e:t)&&document.documentElement.setAttribute("data-o-theme","dark")})();</script><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script><script src="_static/jquery.js"></script>
        <script src="_static/js/theme.js"></script><script src="_static/underscore.js"></script><script src="_static/doctools.js"></script><script crossorigin="anonymous" integrity="sha256-1fEPhSsRKlFKGfK3eO710tEweHh1fwokU5wFGDHO+vg=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="mindelec.architecture" href="mindelec.architecture.html" />
    <link rel="prev" title="Device-to-device Differentiable FDTD for Solving Electromagnetic Inverse Scattering" href="AD_FDTD_inverse.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> MindSpore
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="intro_and_install.html">MindSpore Elec Introduction and Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Application</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="physics_driven.html">Physics Informed Deep Learning Method for Electromagnetic Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_driven.html">Data Driven Deep Learning Method for Electromagnetic Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="AD_FDTD.html">Device-to-device differentiable FDTD method</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Visualizing Electromagnetic Simulation Results</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#visualized-training-and-testing-process">Visualized Training and Testing Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="#s11-visualization">S11 Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="#2d-electromagnetic-field-visualization">2D Electromagnetic Field Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="#3d-result-visualization">3D Result Visualization</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="mindelec.architecture.html">mindelec.architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindelec.common.html">mindelec.common</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindelec.data.html">mindelec.data</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindelec.geometry.html">mindelec.geometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindelec.loss.html">mindelec.loss</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindelec.operators.html">mindelec.operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindelec.solver.html">mindelec.solver</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindelec.vision.html">mindelec.vision</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">RELEASE NOTES</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="RELEASE.html">Release Notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MindSpore</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Visualizing Electromagnetic Simulation Results</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/visualization.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="visualizing-electromagnetic-simulation-results">
<h1>Visualizing Electromagnetic Simulation Results<a class="headerlink" href="#visualizing-electromagnetic-simulation-results" title="Permalink to this headline"></a></h1>
<p><a class="reference external" href="https://gitee.com/mindspore/docs/blob/r2.0/docs/mindelec/docs/source_en/visualization.md"><img alt="View Source On Gitee" src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/r2.0/resource/_static/logo_source_en.png" /></a>  </p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline"></a></h2>
<p>Electromagnetic simulation results usually include physical parameters such as the electromagnetic field, and S-parameters in the simulation area. The visualized simulation result can directly reflect the strength and distribution of the concerned physical parameters and assist the designers in debugging and optimization. MindSpore Elec provides the visualization module <code class="docutils literal notranslate"><span class="pre">mindelec.vision</span></code> for the training process, testing process and simulation results (electromagnetic field and S-parameters). The following cases show how to use <code class="docutils literal notranslate"><span class="pre">mindelec.vision</span></code> for visualization.</p>
</section>
<section id="visualized-training-and-testing-process">
<h2>Visualized Training and Testing Process<a class="headerlink" href="#visualized-training-and-testing-process" title="Permalink to this headline"></a></h2>
<p>MindSpore Elec calls MindSpore Insight APIs to visualize the metrics and results during the training and testing process. The visualization file is generated by the Callback function Callback function that is defined as follows. The dataset and network definition can refer to the parameterization tutorial for details.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">solver</span> <span class="o">=</span> <span class="n">Solver</span><span class="p">(</span><span class="n">network</span><span class="o">=</span><span class="n">model_net</span><span class="p">,</span>
                <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;Data&quot;</span><span class="p">,</span>
                <span class="n">optimizer</span><span class="o">=</span><span class="n">optim</span><span class="p">,</span>
                <span class="n">loss_fn</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">())</span>

<span class="n">monitor_train</span> <span class="o">=</span> <span class="n">MonitorTrain</span><span class="p">(</span><span class="n">per_print_times</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                             <span class="n">summary_dir</span><span class="o">=</span><span class="s1">&#39;./summary_dir_train&#39;</span><span class="p">)</span>

<span class="n">monitor_eval</span> <span class="o">=</span> <span class="n">MonitorEval</span><span class="p">(</span><span class="n">summary_dir</span><span class="o">=</span><span class="s1">&#39;./summary_dir_eval&#39;</span><span class="p">,</span>
                           <span class="n">model</span><span class="o">=</span><span class="n">solver</span><span class="p">,</span>
                           <span class="n">eval_ds</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;eval_loader&quot;</span><span class="p">],</span>
                           <span class="n">eval_interval</span><span class="o">=</span><span class="n">opt</span><span class="o">.</span><span class="n">print_interval</span><span class="p">,</span>
                           <span class="n">draw_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">callbacks_train</span> <span class="o">=</span> <span class="p">[</span><span class="n">monitor_train</span><span class="p">,</span> <span class="n">monitor_eval</span><span class="p">]</span>
</pre></div>
</div>
<p>Use the callbacks parameter to transfer the solver to draw the loss curve and relative error cure during training.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">solver</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">epoch</span><span class="o">=</span><span class="n">opt</span><span class="o">.</span><span class="n">epochs</span><span class="p">,</span>
                   <span class="n">train_dataset</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;train_loader&quot;</span><span class="p">],</span>
                   <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks_train</span><span class="p">,</span>
                   <span class="n">dataset_sink_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>The following figure shows an example of the loss curve of the training set drawn on the MindSpore Insight interface:</p>
<p><img alt="train_loss" src="_images/train_loss.jpg" /></p>
<p>The following is an example of the loss curve and relative error curve of the testing set drawn on the MindSpore Insight interface:</p>
<p><img alt="test_loss" src="_images/test_loss.jpg" /></p>
<p>The S11 prediction results of the testing set are drawn as the training progresses.</p>
<p><img alt="test_picture" src="_images/test_picture1.JPG" /></p>
</section>
<section id="s11-visualization">
<h2>S11 Visualization<a class="headerlink" href="#s11-visualization" title="Permalink to this headline"></a></h2>
<p>MindSpore Elec provides the <code class="docutils literal notranslate"><span class="pre">plot_s11</span></code> function to visualize the results for the S11 curve. The following code shows the call of the visualization tool:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">s11_tensor</span> <span class="o">=</span> <span class="n">s11</span>
<span class="n">path_image_save</span> <span class="o">=</span> <span class="s1">&#39;./result&#39;</span>
<span class="n">legend</span> <span class="o">=</span> <span class="s1">&#39;s11&#39;</span>
<span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">plot_s11</span><span class="p">(</span><span class="n">s11_tensor</span><span class="p">,</span> <span class="n">path_image_save</span><span class="p">,</span> <span class="n">legend</span><span class="p">,</span> <span class="n">dpi</span><span class="p">)</span>
</pre></div>
</div>
<p>Visualization Result (Comparison Between MindSpore Elec and Commercial Software CST Results)</p>
<p><img alt="S11_test_bow" src="_images/S11_test_bow1.jpg" /></p>
</section>
<section id="2d-electromagnetic-field-visualization">
<h2>2D Electromagnetic Field Visualization<a class="headerlink" href="#2d-electromagnetic-field-visualization" title="Permalink to this headline"></a></h2>
<p>MindSpore Elec provides the <code class="docutils literal notranslate"><span class="pre">plot_eh</span></code> function to visualize the 2D profile result of electromagnetic waves. The following code shows the call of the visualization tool:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">simu_res_tensor</span> <span class="o">=</span> <span class="n">result_eh</span>
<span class="n">path_image_save</span> <span class="o">=</span> <span class="s1">&#39;./result&#39;</span>
<span class="n">z_index</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">plot_eh</span><span class="p">(</span><span class="n">simu_res_tensor</span><span class="p">,</span> <span class="n">path_image_save</span><span class="p">,</span> <span class="n">z_index</span><span class="p">,</span> <span class="n">dpi</span><span class="p">)</span>
</pre></div>
</div>
<p>The following shows the Ex 2D visualization results at different time:</p>
<p><img alt="Ex_100" src="_images/Ex_100.jpg" /></p>
<p><img alt="Ex_200" src="_images/Ex_200.jpg" /></p>
<p><img alt="Ex_300" src="_images/Ex_300.jpg" /></p>
<p>The continuous dynamic graph of Ex is as follows:</p>
<p><img alt="result_ex" src="_images/result_ex.gif" /></p>
</section>
<section id="3d-result-visualization">
<h2>3D Result Visualization<a class="headerlink" href="#3d-result-visualization" title="Permalink to this headline"></a></h2>
<p>MindSpore Elec provides the <code class="docutils literal notranslate"><span class="pre">vtk_structure</span></code> function to generate 3D electromagnetic field visualization files. The software can read and display 3D effects through ParaView.</p>
<p>Run the following code to generate a 3D visualization <code class="docutils literal notranslate"><span class="pre">.vts</span></code> file at different time for the simulation results:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">grid_tensor</span> <span class="o">=</span> <span class="n">result_grid</span>
<span class="n">eh_tensor</span> <span class="o">=</span> <span class="n">result_eh</span>
<span class="n">path_res</span> <span class="o">=</span> <span class="s1">&#39;./result_vtk&#39;</span>
<span class="n">vtk_structure</span><span class="p">(</span><span class="n">grid_path</span><span class="p">,</span> <span class="n">eh_path</span><span class="p">,</span> <span class="n">path_res</span><span class="p">)</span>
</pre></div>
</div>
<p>The grid_tensor indicates the 3D mesh grid coordinates. The dimensions are (t_dim, x_dim, y_dim, z_dim, 4). The last axis stores the mesh point space and time information(x, y, z, t). The eh_tensor is 3D grid electromagnetic field. The dimensions are (t_dim, x_dim, y_dim, z_dim, 6). The last axis stores the mesh point electromagnetic field value (Ex, Ey, Ez, Hx, Hy, Hz).</p>
<p>The following shows the Ez 3D visualization results at different time:</p>
<p><img alt="11.0000" src="_images/11.0000.png" /></p>
<p><img alt="11.0025" src="_images/11.0025.png" /></p>
<p><img alt="11.0055" src="_images/11.0055.png" /></p>
<p>The continuous dynamic graph of Ez is as follows:</p>
<p><img alt="result_3d" src="_images/result.gif" /></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="AD_FDTD_inverse.html" class="btn btn-neutral float-left" title="Device-to-device Differentiable FDTD for Solving Electromagnetic Inverse Scattering" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="mindelec.architecture.html" class="btn btn-neutral float-right" title="mindelec.architecture" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright MindSpore.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 
</body>
</html>