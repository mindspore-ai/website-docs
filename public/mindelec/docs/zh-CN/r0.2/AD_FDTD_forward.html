<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>基于可微分FDTD的贴片天线S参数仿真 &mdash; MindSpore master 文档</title><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/translations.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" />
    <link rel="next" title="端到端可微分FDTD求解电磁逆散射问题" href="AD_FDTD_inverse.html" />
    <link rel="prev" title="端到端可微分的FDTD方法" href="AD_FDTD.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> MindSpore
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="在文档中搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">安装部署</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="intro_and_install.html">MindSpore Elec介绍和安装</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">应用实践</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="physics_driven.html">物理驱动的AI电磁仿真方法</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_driven.html">数据驱动的AI电磁仿真方法</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="AD_FDTD.html">端到端可微分的FDTD方法</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">基于可微分FDTD的贴片天线S参数仿真</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#概述">概述</a></li>
<li class="toctree-l3"><a class="reference internal" href="#麦克斯韦方程组">麦克斯韦方程组</a></li>
<li class="toctree-l3"><a class="reference internal" href="#仿真流程">仿真流程</a></li>
<li class="toctree-l3"><a class="reference internal" href="#贴片倒f天线的s参数仿真">贴片倒F天线的S参数仿真</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#导入依赖">导入依赖</a></li>
<li class="toctree-l4"><a class="reference internal" href="#定义激励源时域波形">定义激励源时域波形</a></li>
<li class="toctree-l4"><a class="reference internal" href="#定义天线结构激励端口采样端口">定义天线结构、激励端口、采样端口</a></li>
<li class="toctree-l4"><a class="reference internal" href="#构建神经网络并求解">构建神经网络并求解</a></li>
<li class="toctree-l4"><a class="reference internal" href="#求解结果">求解结果</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#贴片微带滤波器的s参数仿真">贴片微带滤波器的S参数仿真</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#导入依赖-1">导入依赖</a></li>
<li class="toctree-l4"><a class="reference internal" href="#定义激励源时域波形-1">定义激励源时域波形</a></li>
<li class="toctree-l4"><a class="reference internal" href="#定义滤波器结构激励端口采样端口">定义滤波器结构、激励端口、采样端口</a></li>
<li class="toctree-l4"><a class="reference internal" href="#构建神经网络并求解-1">构建神经网络并求解</a></li>
<li class="toctree-l4"><a class="reference internal" href="#求解结果-1">求解结果</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="AD_FDTD_inverse.html">端到端可微分FDTD求解电磁逆散射问题</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="visualization.html">电磁仿真结果可视化</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API参考</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="mindelec.architecture.html">mindelec.architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindelec.common.html">mindelec.common</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindelec.data.html">mindelec.data</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindelec.geometry.html">mindelec.geometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindelec.loss.html">mindelec.loss</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindelec.operators.html">mindelec.operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindelec.solver.html">mindelec.solver</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindelec.vision.html">mindelec.vision</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">RELEASE NOTES</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="RELEASE.html">Release Notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MindSpore</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="AD_FDTD.html">端到端可微分的FDTD方法</a> &raquo;</li>
      <li>基于可微分FDTD的贴片天线S参数仿真</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/AD_FDTD_forward.md.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="基于可微分fdtd的贴片天线s参数仿真">
<h1>基于可微分FDTD的贴片天线S参数仿真<a class="headerlink" href="#基于可微分fdtd的贴片天线s参数仿真" title="永久链接至标题"></a></h1>
<p><a href="https://gitee.com/mindspore/docs/blob/r2.0/docs/mindelec/docs/source_zh_cn/AD_FDTD_forward.md" target="_blank"><img src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/r2.0/resource/_static/logo_source.png"></a>  </p>
<section id="概述">
<h2>概述<a class="headerlink" href="#概述" title="永久链接至标题"></a></h2>
<p>本教程介绍MindSpore Elec提供的基于端到端可微分FDTD求解电磁正问题的方法。时域有限差分（FDTD）方法求解麦克斯韦方程组的过程等价于一个循环卷积网络（RCNN）。利用MindSpore的可微分算子重写更新流程，便可得到端到端可微分FDTD。相比于数据驱动的黑盒模型，可微分FDTD方法的求解流程严格满足麦克斯韦方程组的约束，精度与传统数值算法精度相当。</p>
<blockquote>
<div><p>本例面向GPU处理器，你可以在这里下载完整的样例代码：
<a class="reference external" href="https://gitee.com/mindspore/mindscience/tree/r0.2.0/MindElec/examples/AD_FDTD/fdtd_forward">https://gitee.com/mindspore/mindscience/tree/r0.2.0/MindElec/examples/AD_FDTD/fdtd_forward</a></p>
</div></blockquote>
</section>
<section id="麦克斯韦方程组">
<h2>麦克斯韦方程组<a class="headerlink" href="#麦克斯韦方程组" title="永久链接至标题"></a></h2>
<p>有源麦克斯韦方程是电磁仿真的经典控制方程，它是一组描述电场、磁场与电荷密度、电流密度之间关系的偏微分方程组，具体形式如下：</p>
<div class="math notranslate nohighlight">
\[
\nabla\times E=-\mu \dfrac{\partial H}{\partial t},
\]</div>
<div class="math notranslate nohighlight">
\[
\nabla\times H=\epsilon \dfrac{\partial E}{\partial t}+\sigma E+ J(x, t)
\]</div>
<p>其中<span class="math notranslate nohighlight">\(\epsilon,\mu,\sigma\)</span>分别是介质的绝对介电常数、绝对磁导率、电导率。<span class="math notranslate nohighlight">\(J(x, t)\)</span>是电磁仿真过程中的激励源，通常表现为端口脉冲的形式。本案例的端口为线端口，可以表示为：</p>
<div class="math notranslate nohighlight">
\[
J(x, t)=H(x - x_0)H(x_1 - x)g(t)
\]</div>
<p>其中<span class="math notranslate nohighlight">\(x_0\)</span>和<span class="math notranslate nohighlight">\(x_1\)</span>分别为先端口的起始位置和终止位置，<span class="math notranslate nohighlight">\(H(x)\)</span>为阶跃函数，<span class="math notranslate nohighlight">\(g(t)\)</span>为脉冲信号的函数表达形式。</p>
</section>
<section id="仿真流程">
<h2>仿真流程<a class="headerlink" href="#仿真流程" title="永久链接至标题"></a></h2>
<p>MindSpore Elec进行天线S参数仿真的具体流程如下：</p>
<ol class="arabic simple">
<li><p>定义天线结构、激励端口位置与类型、采样端口。</p></li>
<li><p>定义激励源时域波形。</p></li>
<li><p>构建神经网络。</p></li>
<li><p>求解并评估结果。</p></li>
</ol>
</section>
<section id="贴片倒f天线的s参数仿真">
<h2>贴片倒F天线的S参数仿真<a class="headerlink" href="#贴片倒f天线的s参数仿真" title="永久链接至标题"></a></h2>
<p>本案例对贴片倒F天线的S参数进行仿真。天线结构如下图所示。</p>
<p><img alt="invert_f_structure" src="_images/invert_f_structure.png" /></p>
<section id="导入依赖">
<h3>导入依赖<a class="headerlink" href="#导入依赖" title="永久链接至标题"></a></h3>
<p>导入本教程所依赖模块与接口：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">src</span> <span class="kn">import</span> <span class="n">estimate_time_interval</span><span class="p">,</span> <span class="n">compare_s</span>
<span class="kn">from</span> <span class="nn">src</span> <span class="kn">import</span> <span class="n">CFSParameters</span><span class="p">,</span> <span class="n">Gaussian</span>
<span class="kn">from</span> <span class="nn">src</span> <span class="kn">import</span> <span class="n">Antenna</span><span class="p">,</span> <span class="n">SParameterSolver</span>
<span class="kn">from</span> <span class="nn">src</span> <span class="kn">import</span> <span class="n">GridHelper</span><span class="p">,</span> <span class="n">UniformBrick</span><span class="p">,</span> <span class="n">PECPlate</span><span class="p">,</span> <span class="n">VoltageSource</span>
<span class="kn">from</span> <span class="nn">src</span> <span class="kn">import</span> <span class="n">VoltageMonitor</span><span class="p">,</span> <span class="n">CurrentMonitor</span>
<span class="kn">from</span> <span class="nn">src</span> <span class="kn">import</span> <span class="n">full3d</span>
</pre></div>
</div>
</section>
<section id="定义激励源时域波形">
<h3>定义激励源时域波形<a class="headerlink" href="#定义激励源时域波形" title="永久链接至标题"></a></h3>
<p>本案例的激励源时域波形为高斯脉冲。FDTD采用蛙跳格式分别更新电场和磁场，而本案例的激励源为电压源，因此应计算半时间步上的激励源时域波形值。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_waveform_t</span><span class="p">(</span><span class="n">nt</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">fmax</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute waveforms at time t.</span>

<span class="sd">    Args:</span>
<span class="sd">        nt (int): Number of time steps.</span>
<span class="sd">        dt (float): Time interval.</span>
<span class="sd">        fmax (float): Maximum freuqency of Gaussian wave</span>

<span class="sd">    Returns:</span>
<span class="sd">        waveform_t (Tensor, shape=(nt,)): Waveforms.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nt</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span>
    <span class="n">waveform</span> <span class="o">=</span> <span class="n">Gaussian</span><span class="p">(</span><span class="n">fmax</span><span class="p">)</span>
    <span class="n">waveform_t</span> <span class="o">=</span> <span class="n">waveform</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">waveform_t</span><span class="p">,</span> <span class="n">t</span>
</pre></div>
</div>
</section>
<section id="定义天线结构激励端口采样端口">
<h3>定义天线结构、激励端口、采样端口<a class="headerlink" href="#定义天线结构激励端口采样端口" title="永久链接至标题"></a></h3>
<p>用户可根据天线设计图，在网格上自定义天线结构、激励端口和采样端口。首先，根据剖分尺寸、天线总尺寸、PML层厚度、空气层厚度，程序自动生成FDTD网格<code class="docutils literal notranslate"><span class="pre">grid</span></code>；然后，用户可根据天线设计图，借助程序提供的各种组件在<code class="docutils literal notranslate"><span class="pre">grid</span></code>上定义天线结构、激励端口和采样端口，例如介质基板（均匀介质块<code class="docutils literal notranslate"><span class="pre">UniformBrick</span></code>）、金属贴片（<code class="docutils literal notranslate"><span class="pre">PECPlate</span></code>）、电压源（<code class="docutils literal notranslate"><span class="pre">VoltageSource</span></code>）、电压采样端口（<code class="docutils literal notranslate"><span class="pre">VoltageMonitor</span></code>）和电流采样端口（<code class="docutils literal notranslate"><span class="pre">CurrentMonitor</span></code>）。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_invert_f_antenna</span><span class="p">(</span><span class="n">air_buffers</span><span class="p">,</span> <span class="n">npml</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Get grid for IFA. &quot;&quot;&quot;</span>
    <span class="n">cell_lengths</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.262e-3</span><span class="p">,</span> <span class="mf">0.4e-3</span><span class="p">,</span> <span class="mf">0.4e-3</span><span class="p">)</span>
    <span class="n">obj_lengths</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.787e-3</span><span class="p">,</span> <span class="mf">40e-3</span><span class="p">,</span> <span class="mf">40e-3</span><span class="p">)</span>
    <span class="n">cell_numbers</span> <span class="o">=</span> <span class="p">(</span>
        <span class="mi">2</span> <span class="o">*</span> <span class="n">npml</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">air_buffers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">obj_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">cell_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="mi">2</span> <span class="o">*</span> <span class="n">npml</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">air_buffers</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">obj_lengths</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">cell_lengths</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="mi">2</span> <span class="o">*</span> <span class="n">npml</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">air_buffers</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">obj_lengths</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">cell_lengths</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
    <span class="p">)</span>

    <span class="n">grid</span> <span class="o">=</span> <span class="n">GridHelper</span><span class="p">(</span><span class="n">cell_numbers</span><span class="p">,</span> <span class="n">cell_lengths</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="p">(</span>
        <span class="n">npml</span> <span class="o">+</span> <span class="n">air_buffers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">obj_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">cell_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="n">npml</span> <span class="o">+</span> <span class="n">air_buffers</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">npml</span> <span class="o">+</span> <span class="n">air_buffers</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
    <span class="p">))</span>

    <span class="c1"># Define antenna</span>
    <span class="n">grid</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="n">UniformBrick</span><span class="p">(</span><span class="n">epsr</span><span class="o">=</span><span class="mf">2.2</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">71</span><span class="p">,</span> <span class="mi">60</span><span class="p">:</span><span class="mi">66</span><span class="p">]</span> <span class="o">=</span> <span class="n">PECPlate</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">:</span><span class="mi">71</span><span class="p">,</span> <span class="mi">75</span><span class="p">:</span><span class="mi">81</span><span class="p">]</span> <span class="o">=</span> <span class="n">PECPlate</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">65</span><span class="p">:</span><span class="mi">71</span><span class="p">,</span> <span class="mi">21</span><span class="p">:</span><span class="mi">81</span><span class="p">]</span> <span class="o">=</span> <span class="n">PECPlate</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">52</span><span class="p">:</span><span class="mi">58</span><span class="p">,</span> <span class="mi">40</span><span class="p">:</span><span class="mi">81</span><span class="p">]</span> <span class="o">=</span> <span class="n">PECPlate</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">75</span><span class="p">:</span><span class="mi">81</span><span class="p">]</span> <span class="o">=</span> <span class="n">PECPlate</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">40</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="n">PECPlate</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>

    <span class="c1"># Define sources</span>
    <span class="n">grid</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">:</span><span class="mi">66</span><span class="p">]</span> <span class="o">=</span>\
        <span class="n">VoltageSource</span><span class="p">(</span><span class="n">amplitude</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mf">50.</span><span class="p">,</span> <span class="n">polarization</span><span class="o">=</span><span class="s1">&#39;xp&#39;</span><span class="p">)</span>

    <span class="c1"># Define monitors</span>
    <span class="n">grid</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">61</span><span class="p">:</span><span class="mi">66</span><span class="p">]</span> <span class="o">=</span> <span class="n">VoltageMonitor</span><span class="p">(</span><span class="s1">&#39;xp&#39;</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">:</span><span class="mi">66</span><span class="p">]</span> <span class="o">=</span> <span class="n">CurrentMonitor</span><span class="p">(</span><span class="s1">&#39;xp&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">grid</span>
</pre></div>
</div>
<p>值得注意的是，在网格<code class="docutils literal notranslate"><span class="pre">grid</span></code>上定义天线结构、激励端口位置和采样端口位置时，用户既可以通过网格编号直接指定物体位置，也可以通过空间坐标指定物体位置。不过，用户需要注意通过空间坐标指定物体位置可能引入建模误差。例如，用户可以混用网格编号和空间坐标定义天线结构：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="o">...</span>
    <span class="c1"># Define antenna</span>
    <span class="n">grid</span><span class="p">[</span><span class="o">-</span><span class="mf">0.787e-3</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mf">40e-3</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mf">40e-3</span><span class="p">]</span> <span class="o">=</span> <span class="n">UniformBrick</span><span class="p">(</span><span class="n">epsr</span><span class="o">=</span><span class="mf">2.2</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mf">28.4e-3</span><span class="p">,</span> <span class="mf">24e-3</span><span class="p">:</span><span class="mf">26.4e-3</span><span class="p">]</span> <span class="o">=</span> <span class="n">PECPlate</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">16e-3</span><span class="p">:</span><span class="mf">28.4e-3</span><span class="p">,</span> <span class="mf">30e-3</span><span class="p">:</span><span class="mf">32.4e-3</span><span class="p">]</span> <span class="o">=</span> <span class="n">PECPlate</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">26e-3</span><span class="p">:</span><span class="mf">28.4e-3</span><span class="p">,</span> <span class="mf">8.4e-3</span><span class="p">:</span><span class="mf">32.4e-3</span><span class="p">]</span> <span class="o">=</span> <span class="n">PECPlate</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">20.8e-3</span><span class="p">:</span><span class="mf">23.2e-3</span><span class="p">,</span> <span class="mf">16e-3</span><span class="p">:</span><span class="mf">32.4e-3</span><span class="p">]</span> <span class="o">=</span> <span class="n">PECPlate</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="o">-</span><span class="mf">0.787e-3</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mf">16e-3</span><span class="p">,</span> <span class="mf">30e-3</span><span class="p">:</span><span class="mf">32.4e-3</span><span class="p">]</span> <span class="o">=</span> <span class="n">PECPlate</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="o">-</span><span class="mf">0.787e-3</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mf">16e-3</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mf">40e-3</span><span class="p">]</span> <span class="o">=</span> <span class="n">PECPlate</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="构建神经网络并求解">
<h3>构建神经网络并求解<a class="headerlink" href="#构建神经网络并求解" title="永久链接至标题"></a></h3>
<p>定义可微分FDTD网络，然后定义S参数求解器对象<code class="docutils literal notranslate"><span class="pre">solver</span></code>，调用<code class="docutils literal notranslate"><span class="pre">solve</span></code>接口进行求解。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="c1"># define fdtd network</span>
    <span class="n">fdtd_net</span> <span class="o">=</span> <span class="n">full3d</span><span class="o">.</span><span class="n">ADFDTD</span><span class="p">(</span><span class="n">grid_helper</span><span class="o">.</span><span class="n">cell_numbers</span><span class="p">,</span> <span class="n">grid_helper</span><span class="o">.</span><span class="n">cell_lengths</span><span class="p">,</span>
                             <span class="n">nt</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">antenna</span><span class="p">,</span> <span class="n">cpml</span><span class="p">)</span>
    <span class="c1"># define solver</span>
    <span class="n">solver</span> <span class="o">=</span> <span class="n">SParameterSolver</span><span class="p">(</span><span class="n">fdtd_net</span><span class="p">)</span>

    <span class="c1"># solve</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">waveform_t</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="求解结果">
<h3>求解结果<a class="headerlink" href="#求解结果" title="永久链接至标题"></a></h3>
<p>定义采样频率，调用<code class="docutils literal notranslate"><span class="pre">eval</span></code>端口得到采样频率上的S参数：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="c1"># sampling frequencies</span>
    <span class="n">fs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="mi">501</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># eval</span>
    <span class="n">s_parameters</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
<p>程序计算得到的S参数与参考文献结果的对比如下。</p>
<p><img alt="PIFA_S11" src="_images/invert_f_s_parameters.png" /></p>
</section>
</section>
<section id="贴片微带滤波器的s参数仿真">
<h2>贴片微带滤波器的S参数仿真<a class="headerlink" href="#贴片微带滤波器的s参数仿真" title="永久链接至标题"></a></h2>
<p>本案例对贴片微带滤波器的S参数进行仿真。器件结构如下图所示。</p>
<p><img alt="microstrip_filter_structure" src="_images/microstrip_filter_structure.png" /></p>
<section id="导入依赖-1">
<h3>导入依赖<a class="headerlink" href="#导入依赖-1" title="永久链接至标题"></a></h3>
<p>导入本教程所依赖模块与接口：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">src</span> <span class="kn">import</span> <span class="n">estimate_time_interval</span><span class="p">,</span> <span class="n">compare_s</span>
<span class="kn">from</span> <span class="nn">src</span> <span class="kn">import</span> <span class="n">CFSParameters</span><span class="p">,</span> <span class="n">Gaussian</span>
<span class="kn">from</span> <span class="nn">src</span> <span class="kn">import</span> <span class="n">Antenna</span><span class="p">,</span> <span class="n">SParameterSolver</span>
<span class="kn">from</span> <span class="nn">src</span> <span class="kn">import</span> <span class="n">GridHelper</span><span class="p">,</span> <span class="n">UniformBrick</span><span class="p">,</span> <span class="n">PECPlate</span><span class="p">,</span> <span class="n">VoltageSource</span><span class="p">,</span> <span class="n">Resistor</span>
<span class="kn">from</span> <span class="nn">src</span> <span class="kn">import</span> <span class="n">VoltageMonitor</span><span class="p">,</span> <span class="n">CurrentMonitor</span>
<span class="kn">from</span> <span class="nn">src</span> <span class="kn">import</span> <span class="n">full3d</span>
</pre></div>
</div>
</section>
<section id="定义激励源时域波形-1">
<h3>定义激励源时域波形<a class="headerlink" href="#定义激励源时域波形-1" title="永久链接至标题"></a></h3>
<p>本案例的激励源时域波形为高斯脉冲。FDTD采用蛙跳格式分别更新电场和磁场，而且本案例的激励源为电压源，因此应计算半时间步上的激励源时域波形值。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_waveform_t</span><span class="p">(</span><span class="n">nt</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">fmax</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute waveforms at time t.</span>

<span class="sd">    Args:</span>
<span class="sd">        nt (int): Number of time steps.</span>
<span class="sd">        dt (float): Time interval.</span>
<span class="sd">        fmax (float): Maximum freuqency of Gaussian wave</span>

<span class="sd">    Returns:</span>
<span class="sd">        waveform_t (Tensor, shape=(nt,)): Waveforms.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nt</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span>
    <span class="n">waveform</span> <span class="o">=</span> <span class="n">Gaussian</span><span class="p">(</span><span class="n">fmax</span><span class="p">)</span>
    <span class="n">waveform_t</span> <span class="o">=</span> <span class="n">waveform</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">waveform_t</span><span class="p">,</span> <span class="n">t</span>
</pre></div>
</div>
</section>
<section id="定义滤波器结构激励端口采样端口">
<h3>定义滤波器结构、激励端口、采样端口<a class="headerlink" href="#定义滤波器结构激励端口采样端口" title="永久链接至标题"></a></h3>
<p>用户可根据贴片滤波器设计图，在网格上自定义滤波器结构、激励端口和采样端口。首先，根据剖分尺寸、器件总尺寸、PML层厚度、空气层厚度，程序自动生成FDTD网格<code class="docutils literal notranslate"><span class="pre">grid</span></code>；然后，用户可根据器件设计图，借助程序提供的各种组件在<code class="docutils literal notranslate"><span class="pre">grid</span></code>上定义滤波器结构、激励端口和采样端口，例如介质基板（均匀介质块<code class="docutils literal notranslate"><span class="pre">UniformBrick</span></code>）、金属贴片（<code class="docutils literal notranslate"><span class="pre">PECPlate</span></code>）、电压源（<code class="docutils literal notranslate"><span class="pre">VoltageSource</span></code>）、电阻（<code class="docutils literal notranslate"><span class="pre">Resistor</span></code>）、电压采样端口（<code class="docutils literal notranslate"><span class="pre">VoltageMonitor</span></code>）和电流采样端口（<code class="docutils literal notranslate"><span class="pre">CurrentMonitor</span></code>）。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_microstrip_filter</span><span class="p">(</span><span class="n">air_buffers</span><span class="p">,</span> <span class="n">npml</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; microstrip filter &quot;&quot;&quot;</span>
    <span class="n">cell_lengths</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.4064e-3</span><span class="p">,</span> <span class="mf">0.4233e-3</span><span class="p">,</span> <span class="mf">0.265e-3</span><span class="p">)</span>
    <span class="n">obj_lengths</span> <span class="o">=</span> <span class="p">(</span><span class="mi">50</span> <span class="o">*</span> <span class="n">cell_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                   <span class="mi">46</span> <span class="o">*</span> <span class="n">cell_lengths</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                   <span class="mi">3</span> <span class="o">*</span> <span class="n">cell_lengths</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">cell_numbers</span> <span class="o">=</span> <span class="p">(</span>
        <span class="mi">2</span> <span class="o">*</span> <span class="n">npml</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">air_buffers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">obj_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">cell_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="mi">2</span> <span class="o">*</span> <span class="n">npml</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">air_buffers</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">obj_lengths</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">cell_lengths</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="mi">2</span> <span class="o">*</span> <span class="n">npml</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">air_buffers</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">obj_lengths</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">cell_lengths</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
    <span class="p">)</span>

    <span class="n">grid</span> <span class="o">=</span> <span class="n">GridHelper</span><span class="p">(</span><span class="n">cell_numbers</span><span class="p">,</span> <span class="n">cell_lengths</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="p">(</span>
        <span class="n">npml</span> <span class="o">+</span> <span class="n">air_buffers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">npml</span> <span class="o">+</span> <span class="n">air_buffers</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">npml</span> <span class="o">+</span> <span class="n">air_buffers</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
    <span class="p">))</span>

    <span class="c1"># Define antenna</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">46</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">UniformBrick</span><span class="p">(</span><span class="n">epsr</span><span class="o">=</span><span class="mf">2.2</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">14</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">PECPlate</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">30</span><span class="p">:</span><span class="mi">36</span><span class="p">,</span> <span class="mi">26</span><span class="p">:</span><span class="mi">46</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">PECPlate</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span> <span class="mi">20</span><span class="p">:</span><span class="mi">26</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">PECPlate</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">46</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">PECPlate</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>

    <span class="c1"># Define sources</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">14</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">VoltageSource</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">50.</span><span class="p">,</span> <span class="s1">&#39;zp&#39;</span><span class="p">)</span>

    <span class="c1"># Define load</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">30</span><span class="p">:</span><span class="mi">36</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">Resistor</span><span class="p">(</span><span class="mf">50.</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span>

    <span class="c1"># Define monitors</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">14</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">VoltageMonitor</span><span class="p">(</span><span class="s1">&#39;zp&#39;</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">14</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">CurrentMonitor</span><span class="p">(</span><span class="s1">&#39;yp&#39;</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">30</span><span class="p">:</span><span class="mi">36</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">VoltageMonitor</span><span class="p">(</span><span class="s1">&#39;zp&#39;</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="mi">30</span><span class="p">:</span><span class="mi">36</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">CurrentMonitor</span><span class="p">(</span><span class="s1">&#39;yn&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">grid</span>
</pre></div>
</div>
<p>值得注意的是，本案例的贴片滤波器为两端口器件，本案例仅仿真其中的S11和S21参数。为了计算多端口S参数，需要在每个端口分别定义电压采样端口和电流采样端口。</p>
</section>
<section id="构建神经网络并求解-1">
<h3>构建神经网络并求解<a class="headerlink" href="#构建神经网络并求解-1" title="永久链接至标题"></a></h3>
<p>定义可微分FDTD网络，然后定义S参数求解器对象<code class="docutils literal notranslate"><span class="pre">solver</span></code>，调用<code class="docutils literal notranslate"><span class="pre">solve</span></code>接口进行求解。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="c1"># define fdtd network</span>
    <span class="n">fdtd_net</span> <span class="o">=</span> <span class="n">full3d</span><span class="o">.</span><span class="n">ADFDTD</span><span class="p">(</span><span class="n">grid_helper</span><span class="o">.</span><span class="n">cell_numbers</span><span class="p">,</span> <span class="n">grid_helper</span><span class="o">.</span><span class="n">cell_lengths</span><span class="p">,</span>
                             <span class="n">nt</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">antenna</span><span class="p">,</span> <span class="n">cpml</span><span class="p">)</span>
    <span class="c1"># define solver</span>
    <span class="n">solver</span> <span class="o">=</span> <span class="n">SParameterSolver</span><span class="p">(</span><span class="n">fdtd_net</span><span class="p">)</span>

    <span class="c1"># solve</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">waveform_t</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="求解结果-1">
<h3>求解结果<a class="headerlink" href="#求解结果-1" title="永久链接至标题"></a></h3>
<p>定义采样频率，调用<code class="docutils literal notranslate"><span class="pre">eval</span></code>端口得到采样频率上的S参数：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="c1"># sampling frequencies</span>
    <span class="n">fs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="mi">1001</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># eval</span>
    <span class="n">s_parameters</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
<p>程序计算得到的S参数与参考文献结果的对比如下。</p>
<p><img alt="Patch_Microstrip_Filter_S" src="_images/microstrip_filter_s_parameters.png" /></p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="AD_FDTD.html" class="btn btn-neutral float-left" title="端到端可微分的FDTD方法" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="AD_FDTD_inverse.html" class="btn btn-neutral float-right" title="端到端可微分FDTD求解电磁逆散射问题" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2022, MindSpore.</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用了 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a>开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 
        <script async="async" src="https://cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>