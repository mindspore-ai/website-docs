<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Industrial Flow Simulation Model——DongFang·YuFeng &mdash; MindSpore master documentation</title><script>;(()=>{const e=localStorage.getItem("ms-theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;(e?"dark"===e:t)&&document.documentElement.setAttribute("data-o-theme","dark")})();</script><link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script><script src="../_static/jquery.js"></script>
        <script src="../_static/js/theme.js"></script><script src="../_static/underscore.js"></script><script src="../_static/doctools.js"></script><script crossorigin="anonymous" integrity="sha256-1fEPhSsRKlFKGfK3eO710tEweHh1fwokU5wFGDHO+vg=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="FNO for 1D Burgers" href="FNO1D.html" />
    <link rel="prev" title="Definition of Symbolic PDE Based on MindFlow" href="../physics_driven/sympy_pde_definition.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> MindSpore
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Installation Deployment</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../mindflow_install.html">MindFlow Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Physics-driven</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../physics_driven/burgers1D.html">1D Burgers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../physics_driven/navier_stokes2D.html">2D Cylinder Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../physics_driven/poisson_ring.html">2D Poisson on a Ring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../physics_driven/sympy_pde_definition.html">Definition of Symbolic PDE Based on MindFlow</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data-driven</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">AI Industrial Flow Simulation Model——DongFang·YuFeng</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#background">Background</a></li>
<li class="toctree-l2"><a class="reference internal" href="#technical-difficulties">Technical difficulties</a></li>
<li class="toctree-l2"><a class="reference internal" href="#technical-path">Technical Path</a></li>
<li class="toctree-l2"><a class="reference internal" href="#preparation">Preparation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dongfang·yufeng-mindflow-implementation">“DongFang·YuFeng” MindFlow Implementation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#creating-and-loading-datasets">Creating and Loading Datasets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configure-network-and-training-parameters">Configure network and training parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#model-building">Model Building</a></li>
<li class="toctree-l3"><a class="reference internal" href="#model-training">Model Training</a></li>
<li class="toctree-l3"><a class="reference internal" href="#model-inference">Model Inference</a></li>
<li class="toctree-l3"><a class="reference internal" href="#result-visualization">Result Visualization</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="FNO1D.html">FNO for 1D Burgers</a></li>
<li class="toctree-l1"><a class="reference internal" href="FNO2D.html">FNO for 2D Navier-Stokes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">CFD-solver</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../cfd/lax_tube.html">1D Lax Tube</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cfd/sod_tube.html">1D Sod Tube</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cfd/couette.html">2D Couette Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cfd/riemann2d.html">2D Riemann</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Mechanism Fusion</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../physics_plus_data_driven/pdenet.html">Solve Inverse Problems of Differential Equations with PDE-Net and Realize Long-Term Prediction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../mindflow.cell.html">mindflow.cell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindflow.common.html">mindflow.common</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindflow.data.html">mindflow.data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindflow.geometry.html">mindflow.geometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindflow.loss.html">mindflow.loss</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindflow.operators.html">mindflow.operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindflow.pde.html">mindflow.pde</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindflow.solver.html">mindflow.solver</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">RELEASE NOTES</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../RELEASE.html">Release Notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MindSpore</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>AI Industrial Flow Simulation Model——DongFang·YuFeng</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/data_driven/dfyf.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="ai-industrial-flow-simulation-model——dongfang·yufeng">
<h1>AI Industrial Flow Simulation Model——DongFang·YuFeng<a class="headerlink" href="#ai-industrial-flow-simulation-model——dongfang·yufeng" title="Permalink to this headline"></a></h1>
<p><a href="https://gitee.com/mindspore/docs/blob/r2.0.0-alpha/docs/mindflow/docs/source_en/data_driven/dfyf.md" target="_blank"><img src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/r2.0.0-alpha/resource/_static/logo_source_en.png"></a></p>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline"></a></h2>
<p><strong>DongFang·YuFeng</strong> built based on Ascend AI, is an efficient and high-accuracy AI simulation model for forecasting flow fields over airfoils of the airliner. With the support of MindSpore, the ability to simulate complex flows has been effectively improved. The simulation time is shortened to 1/24 of that in traditional Computational Fluid Dynamics (CFD) and the number of wind tunnel tests is reduced.Additionally, “DongFang·YuFeng”  is capable of predicting the areas with sharp changes in the flow field accurately, and the averaged error of the whole flow field can be reduced to 1e-4 magnitude, reaching the industrial standard.</p>
<p><img alt="img_8.png" src="../_images/img_8.png" /></p>
<p>This tutorial will introduce the research background and technical path of “DongFang·YuFeng” and show how to use MindFlow to realize the training and fast inference of the model, as well as visualized analysis of the flow field, so as to quickly obtain the physical information of the flow field.</p>
</section>
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this headline"></a></h2>
<p>Civil aircraft aerodynamic design level directly determines the “four characteristics” of aircraft, namely safety, comfort, economy and environmental protection. Aerodynamic design of aircraft, as one of the most basic and core technologies in aircraft design, has different research needs and priorities in different stages of aircraft flight envelope (take-off, climb, cruise, descent, landing, etc.). For example, in the take-off phase, engineers will focus more on external noise and high lift-drag ratio, while in the cruise phase they will focus on fuel and energy efficiency. The flow simulation technology is widely used in aircraft aerodynamic design. Its main purpose is to obtain the flow field characteristics (velocity, pressure, etc.) of the simulation target through numerical methods, and then analyze the aerodynamic performance parameters of the aircraft, so as to achieve the optimization design of the aerodynamic performance of the aircraft.</p>
<p><img alt="img_7.png" src="../_images/img_7.png" /></p>
<p>Currently, the aerodynamic simulation of aircraft usually uses commercial simulation software to solve the governing equations and obtain the corresponding aerodynamic performance parameters (lift and drag, pressure, velocity, etc.). However, regardless of the CFD-based simulation software, the following steps are involved:</p>
<ol class="arabic simple">
<li><p>Physical modeling. The physical problems are abstracted and simplified to model the 2D/3D fluid and solid computational domain of the related geometry.</p></li>
<li><p>Mesh partition. The computing domain is divided into face/volume units of corresponding size to resolve turbulence in different areas and different scales.</p></li>
<li><p>Numerical discretization. The integral, differential and partial derivative terms in the governing equation are discretized into algebraic form through different order numerical formats to form corresponding algebraic equations.</p></li>
<li><p>Solution of governing equation. Use the numerical methods (such as <code class="docutils literal notranslate"><span class="pre">SIMPLE</span></code>, <code class="docutils literal notranslate"><span class="pre">PISO</span></code> etc.) to solve the discrete governing equations iteratively, and calculate the numerical solutions at discrete time/space points.</p></li>
<li><p>Post-processing. After the solution, use the flow field post-processing software to conduct qualitative and quantitative analysis and visualization of the simulation results and verify the accuracy of the results.</p></li>
</ol>
<p><img alt="img.png" src="../_images/img.png" /></p>
<p>However, with the shortening of aircraft design and development cycle, the existing aerodynamic design methods have many limitations. Thus, in order to make the aerodynamic design level of airliner catch up with the two major aviation giants, Boeing and Airbus, it is necessary to develop advanced aerodynamic design means and combine advanced technologies such as artificial intelligence to establish fast aerodynamic design tools suitable for model design, thereby improving its simulation capability for complex flows and reducing the number of wind tunnel tests, as well as reducing design and research and development costs.</p>
<p><img alt="img_11.png" src="../_images/img_11.png" /></p>
<p>In the design of aircraft, the drag distribution of the wing is about 52% of the overall flight drag. Therefore, the wing shape design is very important for the whole flight performance of the aircraft. However, the high-fidelity CFD simulation of 3D wing requires millions of computational grids, which consumes a lot of computational resources and takes a long computational cycle. To improve the efficiency of simulation design, the design optimization of the two-dimensional section of the 3D wing is usually carried out first, and this process often requires repeated iterative CFD calculation for thousands of pairs of airfoils and their corresponding working conditions. Among these airfoils, the supercritical airfoil has an important application in high-speed cruise. Compared with the common airfoil, the supercritical airfoil has a fuller head, which reduces the peak negative pressure at the leading edge, and makes the airflow reach the sound velocity later, i.e. the critical Mach number is increased. At the same time, the middle of the upper surface of supercritical airfoil is relatively flat, which effectively controls the further acceleration of the upper airfoil airflow, reduces the intensity and influence range of the shock wave, and delays the shock-induced boundary layer separation on the upper surface. Therefore, supercritical airfoils with higher critical Mach numbers must be considered in wing shapes, since they  can significantly improve aerodynamic performance in the transonic range, reduce drag and improve attitude controllability.</p>
<p><img alt="img_10.png" src="../_images/img_10.png" /></p>
<p>However, the aerodynamic design of two-dimensional supercritical airfoils needs to be simulated for different shapes and inflow parameters, and there are still a lot of iterative computations, which result in a long design cycle. Therefore, it is particularly important to use  AI’s natural parallel inference capabilities to shorten the research and development cycle. Based on this, COMAC and Huawei jointly released the industry’s first AI industrial flow simulation model – <strong>“DongFang·YuFeng”</strong>, which can detect changes in the geometry and flow parameters (angle of attack/Mach number) of the supercritical airfoil. The high-efficiency and high-precision inference of airfoil flow field of airliner is realized, and the flow field around airfoil and lift drag are predicted quickly and accurately.</p>
</section>
<section id="technical-difficulties">
<h2>Technical difficulties<a class="headerlink" href="#technical-difficulties" title="Permalink to this headline"></a></h2>
<p>In order to realize high-efficiency and high-precision flow field prediction of supercritical airfoil by AI, the following technical difficulties need to be overcome:</p>
<ul class="simple">
<li><p><strong>Airfoil meshes are uneven and flow feature extraction is difficult.</strong> O-type or C-type meshes are often used for fluid simulation of 2D airfoil computing domain. As shown in the figure, a typical O-shaped mesh is divided. In order to accurately calculate the flow boundary layer, the near-wall surface of the airfoil is meshed, while the far-field mesh is relatively sparse. This non-standard grid data structure increases the difficulty of extracting flow features.</p></li>
</ul>
<p><img alt="img_12.png" src="../_images/img_12.png" /></p>
<p><img alt="img_13.png" src="../_images/img_13.png" /></p>
<ul class="simple">
<li><p><strong>Flow characteristics change significantly when different aerodynamic parameters or airfoil shapes change.</strong> As shown in the figure, when the angle of attack of the airfoil changes, the flow field will change dramatically, especially when the angle of attack increases to a certain degree, shock wave phenomenon will occur: that is, there is obvious discontinuity in the flow field. The pressure, velocity and density of the fluid on the wavefront are obviously changed abruptly.</p></li>
</ul>
<p><img alt="img_13.png" src="../_images/diff_aoa.png" /></p>
<ul class="simple">
<li><p><strong>The flow field in the shock region changes dramatically, and it is difficult to predict.</strong> Because the existence of shock wave has a significant impact on the flow field nearby, the flow field before and after shock wave changes dramatically, and the flow field changes are complex, making it difficult for AI to predict. The location of shock wave directly affects the aerodynamic performance design and load distribution of airfoil. Therefore, accurate capture of shock signals is very important but challenging.</p></li>
</ul>
</section>
<section id="technical-path">
<h2>Technical Path<a class="headerlink" href="#technical-path" title="Permalink to this headline"></a></h2>
<p>Aiming at the technical difficulties mentioned above, we designed an AI model-based technology roadmap to construct the end-to-end mapping of airfoil geometry and its corresponding flow fields under different flow states, which mainly includes the following core steps:</p>
<ul class="simple">
<li><p>First, we design an efficient AI data conversion tool to realize feature extraction of complex boundary and non-standard data of airfoil flow field.</p></li>
<li><p>Secondly, the neural network model is used to map the airfoil configuration and the physical parameters of the flow field under different flow states. The input of the model is airfoil geometry information and aerodynamic parameters generated after coordinate transformation. The output of the model is the physical information of the flow field, such as velocity and pressure.</p></li>
<li><p>Finally, the weights of the network are trained using the adaptive loss function. Perform further decomposition and learning on abrupt high-frequency signals in the flow field, so as to improve prediction accuracy of areas (such as shock waves) that change sharply in the flow field, as shown in a module corresponding to the loss function.</p></li>
</ul>
</section>
<section id="preparation">
<h2>Preparation<a class="headerlink" href="#preparation" title="Permalink to this headline"></a></h2>
<p>Before practice, ensure that MindSpore and MindFlow of the latest versions have been correctly installed. If not, you can run the following command:</p>
<ul class="simple">
<li><p>The MindSpore installation page is used to install the <a class="reference external" href="https://www.mindspore.cn/install">MindSpore</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MindFlow</span></code>Install MindFlow on the installation page.</p></li>
</ul>
</section>
<section id="dongfang·yufeng-mindflow-implementation">
<h2>“DongFang·YuFeng” MindFlow Implementation<a class="headerlink" href="#dongfang·yufeng-mindflow-implementation" title="Permalink to this headline"></a></h2>
<p>The implementation of “DongFang·YuFeng”  <code class="docutils literal notranslate"><span class="pre">MindFlow</span></code> consists of the following six steps:</p>
<ol class="arabic simple">
<li><p>Dataset preparation and loading.</p></li>
<li><p>Configure network and training parameters.</p></li>
<li><p>Model building.</p></li>
<li><p>Model training.</p></li>
<li><p>Model inference.</p></li>
<li><p>Result visualization.</p></li>
</ol>
<section id="creating-and-loading-datasets">
<h3>Creating and Loading Datasets<a class="headerlink" href="#creating-and-loading-datasets" title="Permalink to this headline"></a></h3>
<p>The dataset of the CFD is first converted to tensor data, and then the tensor data is converted to MindRecord. Design an efficient AI data conversion tool to realize feature extraction of complex boundary and non-standard data of airfoil flow field.</p>
<p>Currently, AI fluid simulation supports training using local datasets. You can use the <code class="docutils literal notranslate"><span class="pre">MindDataset</span></code> interface to configure dataset options. You need to specify the location of the MindRecord dataset file.</p>
</section>
<section id="configure-network-and-training-parameters">
<h3>Configure network and training parameters<a class="headerlink" href="#configure-network-and-training-parameters" title="Permalink to this headline"></a></h3>
<p>The configuration file contains four types of parameters: model parameters(model), data parameters(data), optimizer parameters(optimizer), and callback parameters(callback). The most important parameters of the ViT model are depth, embed_dim, and num_heads of the encoder and decoder, which control the number of layers in the model, the length of the latent vector, and the number of heads of the multi-head attention mechanism, respectively. The default values of the parameters are as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;ViT&quot;</span>                   <span class="c1"># Model name</span>
  <span class="n">exp</span><span class="p">:</span>
    <span class="n">input_dims</span><span class="p">:</span> <span class="mi">3</span>               <span class="c1"># Input data channel</span>
  <span class="n">output_dims</span><span class="p">:</span> <span class="mi">3</span>                <span class="c1"># Output data channel</span>
  <span class="n">height</span><span class="p">:</span> <span class="mi">192</span>                   <span class="c1"># Height of the grid</span>
  <span class="n">width</span><span class="p">:</span> <span class="mi">384</span>                    <span class="c1"># Width of the grid</span>
  <span class="n">encoder_depth</span><span class="p">:</span> <span class="mi">6</span>              <span class="c1"># Depth of the encoder</span>
  <span class="n">encoder_embed_dim</span><span class="p">:</span> <span class="mi">768</span>        <span class="c1"># Embedding dimensions of the encoder</span>
  <span class="n">encoder_num_heads</span><span class="p">:</span> <span class="mi">12</span>         <span class="c1"># Numbers of attention-heads of the encoder</span>
  <span class="n">decoder_depth</span><span class="p">:</span> <span class="mi">6</span>              <span class="c1"># Depth of the decoder</span>
  <span class="n">decoder_embed_dim</span><span class="p">:</span> <span class="mi">512</span>        <span class="c1"># Numbers of attention-heads of the decoder</span>
  <span class="n">decoder_num_heads</span><span class="p">:</span> <span class="mi">16</span>         <span class="c1"># Numbers of attention-heads of the decoder</span>

<span class="n">data</span><span class="p">:</span>
  <span class="n">data_path</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>                 <span class="c1"># Path to data</span>
  <span class="n">grid_path</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>                 <span class="c1"># Path to grid</span>
  <span class="n">train_size</span><span class="p">:</span> <span class="mf">0.2</span>               <span class="c1"># Ratio of train and test dataset</span>
  <span class="n">train_num_list</span><span class="p">:</span> <span class="p">[</span><span class="mi">301</span><span class="p">]</span>         <span class="c1"># Airfoils index of train dataset [301~350]</span>
  <span class="n">test_num_list</span><span class="p">:</span> <span class="p">[</span><span class="mi">451</span><span class="p">]</span>          <span class="c1"># Airfoils index of test dataset [451~500]</span>
  <span class="n">batch_size</span><span class="p">:</span> <span class="mi">32</span>                <span class="c1"># Batch size of train</span>
  <span class="n">test_batch_size</span><span class="p">:</span> <span class="mi">32</span>           <span class="c1"># Batch size of test</span>
  <span class="n">post_dir</span><span class="p">:</span> <span class="s2">&quot;./postprocessing/plot_results/&quot;</span>                            <span class="c1"># Path to postprocessing</span>
  <span class="n">max_value_list</span><span class="p">:</span> <span class="p">[</span> <span class="mf">4.6</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.18418664581293126</span><span class="p">]</span>                      <span class="c1"># Max values of input data</span>
  <span class="n">min_value_list</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.18382872836312403</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1839052340212462</span><span class="p">]</span>     <span class="c1"># Min values of input data</span>

<span class="n">optimizer</span><span class="p">:</span>
  <span class="n">epochs</span><span class="p">:</span> <span class="mi">1000</span>                  <span class="c1"># The number of train epoch</span>
  <span class="n">lr</span><span class="p">:</span> <span class="mf">0.0005</span>                    <span class="c1"># Initial learning rate</span>
  <span class="n">gamma</span><span class="p">:</span> <span class="mf">0.2</span>                    <span class="c1"># The gamma value of the optimizer</span>

<span class="n">callback</span><span class="p">:</span>
  <span class="n">summary_dir</span><span class="p">:</span> <span class="s2">&quot;./summary_dir/summary_&quot;</span>    <span class="c1"># Path to Summary</span>
  <span class="n">save_checkpoint_epochs</span><span class="p">:</span> <span class="mi">1000</span>             <span class="c1"># Frequency of checkpoint results</span>
  <span class="n">keep_checkpoint_max</span><span class="p">:</span> <span class="mi">1</span>                   <span class="c1"># Maximum number of checkpoint files can be save</span>
  <span class="n">eval_interval</span><span class="p">:</span> <span class="mi">10</span>                        <span class="c1"># TestSet Accuracy Test Frequency</span>
</pre></div>
</div>
</section>
<section id="model-building">
<h3>Model Building<a class="headerlink" href="#model-building" title="Permalink to this headline"></a></h3>
<p>The following uses the ViT model as an example. The model is built through the ViT interface defined by the MindFlow package. You need to specify the parameters of the ViT model. You can also build your own model.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">ViT</span><span class="p">(</span><span class="n">input_dims</span><span class="o">=</span><span class="n">model_params</span><span class="p">[</span><span class="n">method</span><span class="p">][</span><span class="s1">&#39;input_dims&#39;</span><span class="p">],</span>
            <span class="n">output_dims</span><span class="o">=</span><span class="n">model_params</span><span class="p">[</span><span class="s1">&#39;output_dims&#39;</span><span class="p">],</span>
            <span class="n">encoder_depth</span><span class="o">=</span><span class="n">model_params</span><span class="p">[</span><span class="s1">&#39;encoder_depth&#39;</span><span class="p">],</span>
            <span class="n">encoder_embed_dim</span><span class="o">=</span><span class="n">model_params</span><span class="p">[</span><span class="s1">&#39;encoder_embed_dim&#39;</span><span class="p">],</span>
            <span class="n">encoder_num_heads</span><span class="o">=</span><span class="n">model_params</span><span class="p">[</span><span class="s1">&#39;encoder_num_heads&#39;</span><span class="p">],</span>
            <span class="n">decoder_depth</span><span class="o">=</span><span class="n">model_params</span><span class="p">[</span><span class="s1">&#39;decoder_depth&#39;</span><span class="p">],</span>
            <span class="n">decoder_embed_dim</span><span class="o">=</span><span class="n">model_params</span><span class="p">[</span><span class="s1">&#39;decoder_embed_dim&#39;</span><span class="p">],</span>
            <span class="n">decoder_num_heads</span><span class="o">=</span><span class="n">model_params</span><span class="p">[</span><span class="s1">&#39;decoder_num_heads&#39;</span><span class="p">],</span>
            <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="model-training">
<h3>Model Training<a class="headerlink" href="#model-training" title="Permalink to this headline"></a></h3>
<p>First, use the load_config_params function to load the configuration file to obtain model parameters, and then call the initial_data_and_model function to obtain train_dataset, eval_dataset, model, model_name . The learning rate can be obtained by using the warmup_cosine_annealing_lr function provided by MindFlow.</p>
<p>MindSpore provides the Model class for model training and inference. The input of the Model class is the network model, optimizer, loss scaling policy, and loss function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TrainModel</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">loss_fn</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">=</span> <span class="n">model_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loss_fn</span> <span class="o">=</span> <span class="n">loss_fn</span>

    <span class="k">def</span> <span class="nf">train_with_eval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;train&quot;&quot;&quot;</span>
        <span class="n">data_params</span><span class="p">,</span> <span class="n">model_params</span><span class="p">,</span> <span class="n">optimizer_params</span><span class="p">,</span> <span class="n">callback_params</span> <span class="o">=</span> <span class="n">load_config_params</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
        <span class="n">train_dataset</span><span class="p">,</span> <span class="n">eval_dataset</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">model_name</span> <span class="o">=</span> <span class="n">initial_data_and_model</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">alpha</span><span class="p">),</span> <span class="n">data_params</span><span class="p">,</span> <span class="n">model_params</span><span class="p">,</span> <span class="n">opt</span><span class="o">.</span><span class="n">method</span><span class="p">)</span>

        <span class="n">ckpt_dir</span><span class="p">,</span> <span class="n">summary_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_dirs</span><span class="p">(</span><span class="n">callback_params</span><span class="p">,</span> <span class="n">model_name</span><span class="p">)</span>
        <span class="n">steps_per_epoch</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">get_dataset_size</span><span class="p">()</span>

        <span class="n">lr</span> <span class="o">=</span> <span class="n">warmup_cosine_annealing_lr</span><span class="p">(</span><span class="n">optimizer_params</span><span class="p">[</span><span class="s2">&quot;lr&quot;</span><span class="p">],</span> <span class="n">steps_per_epoch</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">optimizer_params</span><span class="p">[</span><span class="s2">&quot;epochs&quot;</span><span class="p">])</span>
        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">trainable_params</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">loss_fn</span><span class="o">.</span><span class="n">trainable_params</span><span class="p">(),</span> <span class="n">learning_rate</span><span class="o">=</span><span class="n">Tensor</span><span class="p">(</span><span class="n">lr</span><span class="p">))</span>
        <span class="n">loss_scale</span> <span class="o">=</span> <span class="n">DynamicLossScaleManager</span><span class="p">()</span>

        <span class="n">solver</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span>
                       <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
                       <span class="n">loss_scale_manager</span><span class="o">=</span><span class="n">loss_scale</span><span class="p">,</span>
                       <span class="n">loss_fn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loss_fn</span><span class="p">,</span>
                       <span class="p">)</span>

        <span class="n">pred_cb</span><span class="p">,</span> <span class="n">summary_cb</span><span class="p">,</span> <span class="n">time_cb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callback</span><span class="p">(</span><span class="n">eval_dataset</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">summary_dir</span><span class="p">,</span> <span class="n">callback_params</span><span class="p">,</span> <span class="n">data_params</span><span class="p">)</span>
        <span class="n">ckpt_cb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkpoint</span><span class="p">(</span><span class="n">callback_params</span><span class="p">,</span> <span class="n">ckpt_dir</span><span class="p">,</span> <span class="n">steps_per_epoch</span><span class="p">)</span>
        <span class="n">solver</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">epoch</span><span class="o">=</span><span class="n">optimizer_params</span><span class="p">[</span><span class="s2">&quot;epochs&quot;</span><span class="p">],</span>
                     <span class="n">train_dataset</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span>
                     <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">LossMonitor</span><span class="p">(),</span> <span class="n">pred_cb</span><span class="p">,</span> <span class="n">time_cb</span><span class="p">,</span> <span class="n">ckpt_cb</span><span class="p">],</span>
                     <span class="n">dataset_sink_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_set_dirs</span><span class="p">(</span><span class="n">callback_params</span><span class="p">,</span> <span class="n">model_name</span><span class="p">):</span>
        <span class="n">summary_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">callback_params</span><span class="p">[</span><span class="s2">&quot;summary_dir&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">opt</span><span class="o">.</span><span class="n">method</span><span class="p">,</span> <span class="n">model_name</span><span class="p">)</span>
        <span class="n">ckpt_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">summary_dir</span><span class="p">,</span> <span class="s2">&quot;ckpt_dir&quot;</span><span class="p">)</span>
        <span class="n">check_file_path</span><span class="p">(</span><span class="n">ckpt_dir</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;model_name: </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;config_path: </span><span class="si">{</span><span class="n">opt</span><span class="o">.</span><span class="n">config_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;summary_dir: </span><span class="si">{</span><span class="n">summary_dir</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ckpt_dir: </span><span class="si">{</span><span class="n">ckpt_dir</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ckpt_dir</span><span class="p">,</span> <span class="n">summary_dir</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_callback</span><span class="p">(</span><span class="n">eval_dataset</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">summary_dir</span><span class="p">,</span> <span class="n">callback_params</span><span class="p">,</span> <span class="n">data_params</span><span class="p">):</span>
        <span class="c1"># callback</span>
        <span class="n">pred_cb</span> <span class="o">=</span> <span class="n">PredictCallback</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">eval_dataset</span><span class="o">=</span><span class="n">eval_dataset</span><span class="p">,</span>
                                  <span class="n">summary_dir</span><span class="o">=</span><span class="n">summary_dir</span><span class="p">,</span> <span class="n">callback_params</span><span class="o">=</span><span class="n">callback_params</span><span class="p">,</span> <span class="n">data_params</span><span class="o">=</span><span class="n">data_params</span><span class="p">)</span>
        <span class="n">time_cb</span> <span class="o">=</span> <span class="n">TimeMonitor</span><span class="p">()</span>
        <span class="n">summary_cb</span> <span class="o">=</span> <span class="n">SummaryCollector</span><span class="p">(</span><span class="n">summary_dir</span><span class="o">=</span><span class="n">summary_dir</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pred_cb</span><span class="p">,</span> <span class="n">summary_cb</span><span class="p">,</span> <span class="n">time_cb</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_checkpoint</span><span class="p">(</span><span class="n">callback_params</span><span class="p">,</span> <span class="n">ckpt_dir</span><span class="p">,</span> <span class="n">steps_per_epoch</span><span class="p">):</span>
        <span class="c1"># checkpoint</span>
        <span class="n">ckpt_config</span> <span class="o">=</span> <span class="n">CheckpointConfig</span><span class="p">(</span>
            <span class="n">save_checkpoint_steps</span><span class="o">=</span><span class="n">callback_params</span><span class="p">[</span><span class="s2">&quot;save_checkpoint_epochs&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">steps_per_epoch</span><span class="p">,</span>
            <span class="n">keep_checkpoint_max</span><span class="o">=</span><span class="n">callback_params</span><span class="p">[</span><span class="s2">&quot;keep_checkpoint_max&quot;</span><span class="p">])</span>
        <span class="n">ckpt_cb</span> <span class="o">=</span> <span class="n">ModelCheckpoint</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;airfoil2d&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">ckpt_dir</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">ckpt_config</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ckpt_cb</span>
</pre></div>
</div>
<p>During model training, the PredictCallback function is used to implement inference while training. Users can directly load the test data set and output the inference precision of the test set every time n epochs are trained. The value of n is specified by eval_interval in the configuration file. The command output is as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="n">Train</span> <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">245704.565</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">357.649</span> <span class="n">ms</span>
<span class="n">epoch</span><span class="p">:</span> <span class="mi">991</span> <span class="n">step</span><span class="p">:</span> <span class="mi">687</span><span class="p">,</span> <span class="n">loss</span> <span class="ow">is</span> <span class="mf">0.018909770995378494</span>
<span class="n">Train</span> <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">134875.490</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">196.325</span> <span class="n">ms</span>
<span class="n">epoch</span><span class="p">:</span> <span class="mi">992</span> <span class="n">step</span><span class="p">:</span> <span class="mi">687</span><span class="p">,</span> <span class="n">loss</span> <span class="ow">is</span> <span class="mf">0.018905797973275185</span>
<span class="n">Train</span> <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">134833.401</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">196.264</span> <span class="n">ms</span>
<span class="n">epoch</span><span class="p">:</span> <span class="mi">993</span> <span class="n">step</span><span class="p">:</span> <span class="mi">687</span><span class="p">,</span> <span class="n">loss</span> <span class="ow">is</span> <span class="mf">0.018955739215016365</span>
<span class="n">Train</span> <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">134996.335</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">196.501</span> <span class="n">ms</span>
<span class="n">epoch</span><span class="p">:</span> <span class="mi">994</span> <span class="n">step</span><span class="p">:</span> <span class="mi">687</span><span class="p">,</span> <span class="n">loss</span> <span class="ow">is</span> <span class="mf">0.01890547014772892</span>
<span class="n">Train</span> <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">134857.379</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">196.299</span> <span class="n">ms</span>
<span class="n">epoch</span><span class="p">:</span> <span class="mi">995</span> <span class="n">step</span><span class="p">:</span> <span class="mi">687</span><span class="p">,</span> <span class="n">loss</span> <span class="ow">is</span> <span class="mf">0.019043993204832077</span>
<span class="n">Train</span> <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">134828.162</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">196.256</span> <span class="n">ms</span>
<span class="n">epoch</span><span class="p">:</span> <span class="mi">996</span> <span class="n">step</span><span class="p">:</span> <span class="mi">687</span><span class="p">,</span> <span class="n">loss</span> <span class="ow">is</span> <span class="mf">0.018846523016691208</span>
<span class="n">Train</span> <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">134789.263</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">196.200</span> <span class="n">ms</span>
<span class="n">epoch</span><span class="p">:</span> <span class="mi">997</span> <span class="n">step</span><span class="p">:</span> <span class="mi">687</span><span class="p">,</span> <span class="n">loss</span> <span class="ow">is</span> <span class="mf">0.018784258514642715</span>
<span class="n">Train</span> <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">135045.117</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">196.572</span> <span class="n">ms</span>
<span class="n">epoch</span><span class="p">:</span> <span class="mi">998</span> <span class="n">step</span><span class="p">:</span> <span class="mi">687</span><span class="p">,</span> <span class="n">loss</span> <span class="ow">is</span> <span class="mf">0.019161228090524673</span>
<span class="n">Train</span> <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">134754.484</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">196.149</span> <span class="n">ms</span>
<span class="n">epoch</span><span class="p">:</span> <span class="mi">999</span> <span class="n">step</span><span class="p">:</span> <span class="mi">687</span><span class="p">,</span> <span class="n">loss</span> <span class="ow">is</span> <span class="mf">0.01893322728574276</span>
<span class="n">Train</span> <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">134868.424</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">196.315</span> <span class="n">ms</span>
<span class="n">epoch</span><span class="p">:</span> <span class="mi">1000</span> <span class="n">step</span><span class="p">:</span> <span class="mi">687</span><span class="p">,</span> <span class="n">loss</span> <span class="ow">is</span> <span class="mf">0.01907874085009098</span>
<span class="o">================================</span><span class="n">Start</span> <span class="n">Evaluation</span><span class="o">================================</span>
<span class="n">mean</span> <span class="n">l1_error</span> <span class="p">:</span> <span class="mf">0.00017127192940710016</span><span class="p">,</span> <span class="nb">max</span> <span class="n">l1_error</span> <span class="p">:</span> <span class="mf">0.06129508092999458</span><span class="p">,</span> <span class="n">average</span> <span class="n">l1_error</span> <span class="p">:</span> <span class="mf">0.0043031450033425124</span><span class="p">,</span> <span class="nb">min</span> <span class="n">l1_error</span> <span class="p">:</span> <span class="mf">0.0008682708139531314</span><span class="p">,</span> <span class="n">median</span> <span class="n">l1_error</span> <span class="p">:</span> <span class="mf">0.0034930877154693007</span>
<span class="n">mean</span> <span class="n">u_error</span> <span class="p">:</span> <span class="mf">0.00020820375084972326</span><span class="p">,</span> <span class="nb">max</span> <span class="n">u_error</span> <span class="p">:</span> <span class="mf">0.10199415683746338</span><span class="p">,</span> <span class="n">average</span> <span class="n">u_error</span> <span class="p">:</span> <span class="mf">0.005660663934135864</span><span class="p">,</span> <span class="nb">min</span> <span class="n">u_error</span> <span class="p">:</span> <span class="mf">0.0010001659393310547</span><span class="p">,</span> <span class="n">median</span> <span class="n">u_error</span> <span class="p">:</span> <span class="mf">0.004315197467803955</span>
<span class="n">mean</span> <span class="n">v_error</span> <span class="p">:</span> <span class="mf">7.668626435136433e-05</span><span class="p">,</span> <span class="nb">max</span> <span class="n">v_error</span> <span class="p">:</span> <span class="mf">0.029990235343575478</span><span class="p">,</span> <span class="n">average</span> <span class="n">v_error</span> <span class="p">:</span> <span class="mf">0.003053658062797918</span><span class="p">,</span> <span class="nb">min</span> <span class="n">v_error</span> <span class="p">:</span> <span class="mf">0.0005460083484649658</span><span class="p">,</span> <span class="n">median</span> <span class="n">v_error</span> <span class="p">:</span> <span class="mf">0.002688060514628887</span>
<span class="n">mean</span> <span class="n">p_error</span> <span class="p">:</span> <span class="mf">0.0002289257737010042</span><span class="p">,</span> <span class="nb">max</span> <span class="n">p_error</span> <span class="p">:</span> <span class="mf">0.07013040781021118</span><span class="p">,</span> <span class="n">average</span> <span class="n">p_error</span> <span class="p">:</span> <span class="mf">0.004195113001903247</span><span class="p">,</span> <span class="nb">min</span> <span class="n">p_error</span> <span class="p">:</span> <span class="mf">0.0009379386901855469</span><span class="p">,</span> <span class="n">median</span> <span class="n">p_error</span> <span class="p">:</span> <span class="mf">0.0032533109188079834</span>
<span class="n">mean</span> <span class="n">Cp_error</span> <span class="p">:</span> <span class="mf">0.00023822338209345892</span><span class="p">,</span> <span class="nb">max</span> <span class="n">Cp_error</span> <span class="p">:</span> <span class="mf">0.03613078594207764</span><span class="p">,</span> <span class="n">average</span> <span class="n">Cp_error</span> <span class="p">:</span> <span class="mf">0.0012825747940972535</span><span class="p">,</span> <span class="nb">min</span> <span class="n">Cp_error</span> <span class="p">:</span> <span class="mf">0.0005737543106079102</span><span class="p">,</span> <span class="n">median</span> <span class="n">Cp_error</span> <span class="p">:</span> <span class="mf">0.0008337497711181641</span>
<span class="o">=================================</span><span class="n">End</span> <span class="n">Evaluation</span><span class="o">=================================</span>
</pre></div>
</div>
</section>
<section id="model-inference">
<h3>Model Inference<a class="headerlink" href="#model-inference" title="Permalink to this headline"></a></h3>
<p>After model training is complete, the checkpoint can be read through the load_checkpoint interface. The load_param_into_net function can load parameters to the model and use the <code class="docutils literal notranslate"><span class="pre">inference.py</span></code> function to perform inference.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">model_name</span> <span class="o">=</span> <span class="n">initial_data_and_model</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<span class="n">param_dict</span> <span class="o">=</span> <span class="n">load_checkpoint</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;load_path&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">opt</span><span class="o">.</span><span class="n">ckpt_dir</span><span class="p">)</span>
<span class="n">load_param_into_net</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">param_dict</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Load pre-trained model successfully&quot;</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">set_train</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">get_uvp_plots</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="result-visualization">
<h3>Result Visualization<a class="headerlink" href="#result-visualization" title="Permalink to this headline"></a></h3>
<p>Surface pressure distribution, flow field distribution and error statistics predicted by AI and CFD when airfoil geometry changes.</p>
<p><img alt="airfoil.gif" src="../_images/airfoil.gif" /></p>
<p>Surface pressure distribution, flow field distribution and error statistics predicted by AI and CFD when the angle of attack changes.</p>
<p><img alt="aoa_var.gif" src="../_images/aoa_var.gif" /></p>
<p>Surface pressure distribution, flow field distribution and error statistics predicted by AI and CFD when incoming flow Mach number changes.</p>
<p><img alt="Ma_var.gif" src="../_images/Ma_var.gif" /></p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../physics_driven/sympy_pde_definition.html" class="btn btn-neutral float-left" title="Definition of Symbolic PDE Based on MindFlow" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="FNO1D.html" class="btn btn-neutral float-right" title="FNO for 1D Burgers" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright MindSpore.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 
</body>
</html>