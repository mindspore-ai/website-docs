<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Solve Inverse Problems of Differential Equations with PDE-Net and Realize Long-Term Prediction &mdash; MindSpore master documentation</title><script>;(()=>{const e=localStorage.getItem("ms-theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;(e?"dark"===e:t)&&document.documentElement.setAttribute("data-o-theme","dark")})();</script><link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script><script src="../_static/jquery.js"></script>
        <script src="../_static/js/theme.js"></script><script src="../_static/underscore.js"></script><script src="../_static/doctools.js"></script><script crossorigin="anonymous" integrity="sha256-1fEPhSsRKlFKGfK3eO710tEweHh1fwokU5wFGDHO+vg=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script><script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script><script async="async" src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/mathjax/MathJax-3.2.2/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="mindflow.cell" href="../mindflow.cell.html" />
    <link rel="prev" title="2D Riemann" href="../cfd/riemann2d.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> MindSpore
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Installation Deployment</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../mindflow_install.html">MindFlow Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Physics-driven</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../physics_driven/burgers1D.html">1D Burgers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../physics_driven/navier_stokes2D.html">2D Cylinder Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../physics_driven/poisson_ring.html">2D Poisson on a Ring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../physics_driven/sympy_pde_definition.html">Definition of Symbolic PDE Based on MindFlow</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data-driven</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../data_driven/dfyf.html">AI Industrial Flow Simulation Model——DongFang·YuFeng</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data_driven/FNO1D.html">FNO for 1D Burgers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data_driven/FNO2D.html">FNO for 2D Navier-Stokes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">CFD-solver</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../cfd/lax_tube.html">1D Lax Tube</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cfd/sod_tube.html">1D Sod Tube</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cfd/couette.html">2D Couette Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cfd/riemann2d.html">2D Riemann</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Mechanism Fusion</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Solve Inverse Problems of Differential Equations with PDE-Net and Realize Long-Term Prediction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#governing-equation">Governing Equation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#model-structure-of-the-pde-net">Model Structure of the PDE-Net</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#script-description">Script Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#solution-process">Solution Process</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#data-generation-and-loading">Data Generation and Loading</a></li>
<li class="toctree-l3"><a class="reference internal" href="#model-construction">Model Construction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#model-training">Model Training</a></li>
<li class="toctree-l3"><a class="reference internal" href="#model-evaluation-and-visualization">Model Evaluation and Visualization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#long-term-prediction">Long-Term Prediction</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../mindflow.cell.html">mindflow.cell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindflow.common.html">mindflow.common</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindflow.data.html">mindflow.data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindflow.geometry.html">mindflow.geometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindflow.loss.html">mindflow.loss</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindflow.operators.html">mindflow.operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindflow.pde.html">mindflow.pde</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindflow.solver.html">mindflow.solver</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">RELEASE NOTES</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../RELEASE.html">Release Notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MindSpore</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Solve Inverse Problems of Differential Equations with PDE-Net and Realize Long-Term Prediction</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/physics_plus_data_driven/pdenet.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="solve-inverse-problems-of-differential-equations-with-pde-net-and-realize-long-term-prediction">
<h1>Solve Inverse Problems of Differential Equations with PDE-Net and Realize Long-Term Prediction<a class="headerlink" href="#solve-inverse-problems-of-differential-equations-with-pde-net-and-realize-long-term-prediction" title="Permalink to this headline"></a></h1>
<p><a href="https://gitee.com/mindspore/docs/blob/r2.0.0-alpha/docs/mindflow/docs/source_en/physics_plus_data_driven/pdenet.md" target="_blank"><img src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/r2.0.0-alpha/resource/_static/logo_source_en.png"></a></p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline"></a></h2>
<p>PDE-Net is a feedforward deep network proposed by Zichao Long et al. to learn partial differential equations from data, predict the dynamic characteristics of complex systems accurately and uncover potential PDE models. The basic idea of PDE-Net is to approximate differential operators by learning convolution kernels (filters). Neural networks or other machine learning methods are applied to fit unknown nonlinear responses. Numerical experiments show that the model can identify the observed dynamical equations and predict the dynamical behavior over a relatively long period of time, even in noisy environments. More information can be found in <a class="reference external" href="https://arxiv.org/abs/1710.09668">the original paper</a>.</p>
</section>
<section id="problem-description">
<h2>Problem Description<a class="headerlink" href="#problem-description" title="Permalink to this headline"></a></h2>
<p>This case solves the inverse problem of convection-diffusion partial differential equations with variable parameters and realizes long-term prediction.</p>
</section>
<section id="governing-equation">
<h2>Governing Equation<a class="headerlink" href="#governing-equation" title="Permalink to this headline"></a></h2>
<p>In this study, the convection-diffusion equation is of the form:</p>
<div class="math notranslate nohighlight">
\[
u_t = a(x,y) u_x + b(x,y) u_y + c u_{xx} + d u_{yy}, \quad (x,y) \in[0,2 \pi] \times[0,2 \pi]
\]</div>
<div class="math notranslate nohighlight">
\[
u|_{t=0} = u_0(x,y)
\]</div>
<p>The coefficients of each derivative are:</p>
<div class="math notranslate nohighlight">
\[
a(x,y)=0.5(cos(y)+x(2\pi-x)sin(x))+0.6 \quad
b(x,y)=2(cos(y)+sin(x))+0.8
\]</div>
<div class="math notranslate nohighlight">
\[
c=0.2 \quad
d=0.3
\]</div>
<section id="model-structure-of-the-pde-net">
<h3>Model Structure of the PDE-Net<a class="headerlink" href="#model-structure-of-the-pde-net" title="Permalink to this headline"></a></h3>
<p>The PDE-Net consists of multiple <span class="math notranslate nohighlight">\(\delta T\)</span> Blocks in series to implement prediction of long sequence information. Each <span class="math notranslate nohighlight">\(\delta T\)</span> Block includes several moment matrixes of trainable parameters. The matrixes can be converted to convolution kernels according to a mapping relationship. Thereby the derivatives of the physical field can be obtained. After linearly combining the derivative and its corresponding physical quantity, the information of the next time step can be deduced by using the forward Euler method.</p>
<p><img alt="" src="../_images/pdenet-1.jpg" /></p>
<p><img alt="" src="../_images/pdenet-2.jpg" /></p>
</section>
</section>
<section id="script-description">
<h2>Script Description<a class="headerlink" href="#script-description" title="Permalink to this headline"></a></h2>
<p>You can set training parameters and sampling parameters in <code class="docutils literal notranslate"><span class="pre">config.py</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">train_config</span> <span class="o">=</span> <span class="n">ed</span><span class="p">({</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;pde_net&quot;</span><span class="p">,</span>                          <span class="c1"># Case Description</span>
    <span class="s2">&quot;log_path&quot;</span><span class="p">:</span> <span class="s2">&quot;./logs/result/&quot;</span><span class="p">,</span>               <span class="c1"># log file location</span>
    <span class="s2">&quot;summary_dir&quot;</span><span class="p">:</span> <span class="s2">&quot;./summary_dir/summary&quot;</span><span class="p">,</span>     <span class="c1"># summary file location</span>
    <span class="s2">&quot;eval_interval&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>                        <span class="c1"># Evaluation period</span>
    <span class="s2">&quot;lr_scheduler_gamma&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>                  <span class="c1"># learning rate scheduler coefficient</span>
    <span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="mf">0.001</span><span class="p">,</span>                                <span class="c1"># Initial learning rate</span>
    <span class="s2">&quot;save_epoch_interval&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>                  <span class="c1"># ckpt save period</span>
    <span class="s2">&quot;mesh_size&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>                            <span class="c1"># Mesh size</span>
    <span class="s2">&quot;solver_mesh_scale&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>                     <span class="c1"># Sampling ratio of the solver data</span>
    <span class="s2">&quot;enable_noise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>                       <span class="c1"># Whether to add noise to the sample</span>
    <span class="s2">&quot;start_noise_level&quot;</span><span class="p">:</span> <span class="mf">0.015</span><span class="p">,</span>                 <span class="c1"># Input noise/signal ratio</span>
    <span class="s2">&quot;end_noise_level&quot;</span><span class="p">:</span> <span class="mf">0.015</span><span class="p">,</span>                   <span class="c1"># Output noise/signal ratio</span>
    <span class="s2">&quot;variant_coe_magnitude&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>               <span class="c1"># Differential Equation Coefficient Scaling Ratio</span>
    <span class="s2">&quot;init_freq&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>                             <span class="c1"># Frequency in the initial condition</span>
    <span class="s2">&quot;batch_size&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>                           <span class="c1"># batch size</span>
    <span class="s2">&quot;mindrecord&quot;</span><span class="p">:</span> <span class="s2">&quot;src/data.mindrecord&quot;</span><span class="p">,</span>        <span class="c1"># Mindrecord save location</span>
    <span class="s2">&quot;epochs&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>                              <span class="c1"># number of epochs</span>
    <span class="s2">&quot;multi_step&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>                           <span class="c1"># number of steps</span>
    <span class="s2">&quot;learning_rate_reduce_times&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>            <span class="c1"># learning rate adjustment times</span>
    <span class="s2">&quot;dt&quot;</span><span class="p">:</span> <span class="mf">0.015</span><span class="p">,</span>                                <span class="c1"># time step predicted by a single step</span>
    <span class="s2">&quot;kernel_size&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>                           <span class="c1"># size of the convolution kernel</span>
    <span class="s2">&quot;max_order&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>                             <span class="c1"># maximum differential order corresponding to the convolution kernel</span>
    <span class="s2">&quot;channels&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>                              <span class="c1"># number of data channels</span>
    <span class="s2">&quot;perodic_padding&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>                    <span class="c1"># whether to use periodic boundary conditions</span>
    <span class="s2">&quot;if_frozen&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>                         <span class="c1"># whether to freeze parameters in the moment</span>
    <span class="s2">&quot;enable_moment&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>                      <span class="c1"># whether to use the moment to control convolution</span>
<span class="p">})</span>
</pre></div>
</div>
</section>
<section id="solution-process">
<h2>Solution Process<a class="headerlink" href="#solution-process" title="Permalink to this headline"></a></h2>
<p>The PDE-Net solution to the inverse problem of partial differential equations consists of the following five steps:</p>
<ol class="arabic simple">
<li><p>Data Generation and Loading.</p></li>
<li><p>Model Construction.</p></li>
<li><p>Model Training.</p></li>
<li><p>Model Evaluation and Visualization.</p></li>
<li><p>Long-Term Prediction.</p></li>
</ol>
<section id="data-generation-and-loading">
<h3>Data Generation and Loading<a class="headerlink" href="#data-generation-and-loading" title="Permalink to this headline"></a></h3>
<p>The distribution of the initial physical field of the PDE-Net is obtained according to the Fourier series of the random coefficients. The convection-diffusion equation is solved according to the spectral method, where step represents the number of series of <span class="math notranslate nohighlight">\(\delta T\)</span> Blocks. In the main program, you can invoke the DataGenerator to generate the data of the corresponding step and save the data in the mindrecord format in the data directory.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">src.data_generator</span> <span class="kn">import</span> <span class="n">DataGenerator</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">DataGenerator</span><span class="p">(</span><span class="n">step</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="n">data_size</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;batch_size&quot;</span><span class="p">],</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">&quot;data/train_step&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.mindrecord&quot;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">process</span><span class="p">()</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">DataPrepare</span></code> is used to generate data sets required for model training. During training, <code class="docutils literal notranslate"><span class="pre">train_data_prepare</span></code> can be invoked to generate training sets and test sets. You can call <code class="docutils literal notranslate"><span class="pre">test_data_prepare</span></code> to generate test data sets in long-term prediction and result visualization.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore.dataset</span> <span class="k">as</span> <span class="nn">ds</span>


<span class="k">class</span> <span class="nc">DataPrepare</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Obtain dataset for train or test from mindrecord.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">data_file</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_size</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;mesh_size&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;batch_size&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_file</span> <span class="o">=</span> <span class="n">data_file</span>

    <span class="k">def</span> <span class="nf">test_data_prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">MindDataset</span><span class="p">(</span><span class="n">dataset_files</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_file</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">columns_list</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;u0&quot;</span><span class="p">,</span> <span class="s2">&quot;u_step</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">step</span><span class="p">)])</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">batch_size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dataset</span>

    <span class="k">def</span> <span class="nf">train_data_prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">MindDataset</span><span class="p">(</span><span class="n">dataset_files</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_file</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">columns_list</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;u0&quot;</span><span class="p">,</span> <span class="s2">&quot;uT&quot;</span><span class="p">])</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">batch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">drop_remainder</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">operations</span> <span class="o">=</span> <span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="p">(</span>
            <span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_size</span><span class="p">),</span> <span class="n">y</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_size</span><span class="p">))]</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">operations</span><span class="p">,</span> <span class="n">input_columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;u0&quot;</span><span class="p">,</span> <span class="s2">&quot;uT&quot;</span><span class="p">])</span>
        <span class="n">dataset_train</span><span class="p">,</span> <span class="n">dataset_eval</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">split</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">dataset_train</span><span class="p">,</span> <span class="n">dataset_eval</span>
</pre></div>
</div>
</section>
<section id="model-construction">
<h3>Model Construction<a class="headerlink" href="#model-construction" title="Permalink to this headline"></a></h3>
<p>MindFlow provides the <code class="docutils literal notranslate"><span class="pre">PDENet</span></code> interface to directly create a PDE-Net model. You need to specify the width, height, data depth, boundary condition, and highest order of fitting.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindflow.cell.neural_operators</span> <span class="kn">import</span> <span class="n">PDENet</span>

<span class="k">def</span> <span class="nf">init_model</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">PDENet</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;mesh_size&quot;</span><span class="p">],</span>
                  <span class="n">width</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;mesh_size&quot;</span><span class="p">],</span>
                  <span class="n">channels</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;channels&quot;</span><span class="p">],</span>
                  <span class="n">kernel_size</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;kernel_size&quot;</span><span class="p">],</span>
                  <span class="n">max_order</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;max_order&quot;</span><span class="p">],</span>
                  <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span>
                  <span class="n">dx</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;mesh_size&quot;</span><span class="p">],</span>
                  <span class="n">dy</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;mesh_size&quot;</span><span class="p">],</span>
                  <span class="n">dt</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;dt&quot;</span><span class="p">],</span>
                  <span class="n">periodic</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;perodic_padding&quot;</span><span class="p">],</span>
                  <span class="n">enable_moment</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;enable_moment&quot;</span><span class="p">],</span>
                  <span class="n">if_fronzen</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;if_frozen&quot;</span><span class="p">],</span>
                  <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="model-training">
<h3>Model Training<a class="headerlink" href="#model-training" title="Permalink to this headline"></a></h3>
<p>The parameters of each <span class="math notranslate nohighlight">\(\delta T\)</span> block are shared. Therefore, the model is trained one by one based on the number of connected <span class="math notranslate nohighlight">\(\delta T\)</span> blocks. When step is 1, the model is in the warm-up phase. The moments of the PDE-Net are frozen. The parameters in the moments are not involved in training. Each time a <span class="math notranslate nohighlight">\(\delta T\)</span> block is added, the program generates data and reads data sets. After the model is initialized, the program loads the checkpoint trained in the previous step, defines the optimizer, mode, and loss function. The the model is trained. During training process, the model reflects the model performance in real time based on the callback function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">train_single_step</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">lr</span><span class="p">):</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">DataPrepare</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="n">data_file</span><span class="o">=</span><span class="s2">&quot;data/train_step</span><span class="si">{}</span><span class="s2">.mindrecord&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">step</span><span class="p">))</span>
    <span class="n">train_dataset</span><span class="p">,</span> <span class="n">eval_dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">train_data_prepare</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;dataset size: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">train_dataset</span><span class="o">.</span><span class="n">get_dataset_size</span><span class="p">()))</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">init_model</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>

    <span class="n">epoch</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;epochs&quot;</span><span class="p">]</span>
    <span class="n">warm_up_epoch_scale</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">model</span><span class="o">.</span><span class="n">if_fronzen</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">epoch</span> <span class="o">=</span> <span class="n">warm_up_epoch_scale</span> <span class="o">*</span> <span class="n">epoch</span>
    <span class="k">elif</span> <span class="n">step</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">param_dict</span> <span class="o">=</span> <span class="n">load_checkpoint</span><span class="p">(</span>
            <span class="s2">&quot;./summary_dir/summary/ckpt/step_</span><span class="si">{}</span><span class="s2">/pdenet-</span><span class="si">{}</span><span class="s2">_1.ckpt&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">step</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">epoch</span> <span class="o">*</span> <span class="mi">10</span><span class="p">))</span>
        <span class="n">load_param_into_net</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">param_dict</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Load pre-trained model successfully&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">param_dict</span> <span class="o">=</span> <span class="n">load_checkpoint</span><span class="p">(</span>
            <span class="s2">&quot;./summary_dir/summary/ckpt/step_</span><span class="si">{}</span><span class="s2">/pdenet-</span><span class="si">{}</span><span class="s2">_1.ckpt&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">step</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">epoch</span><span class="p">))</span>
        <span class="n">load_param_into_net</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">param_dict</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Load pre-trained model successfully&quot;</span><span class="p">)</span>

    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">trainable_params</span><span class="p">(),</span> <span class="n">learning_rate</span><span class="o">=</span><span class="n">Tensor</span><span class="p">(</span><span class="n">lr</span><span class="p">))</span>
    <span class="n">loss_func</span> <span class="o">=</span> <span class="n">LpLoss</span><span class="p">(</span><span class="n">size_average</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">loss_scale</span> <span class="o">=</span> <span class="n">DynamicLossScaleManager</span><span class="p">()</span>
    <span class="n">solver</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span>
                   <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
                   <span class="n">loss_scale_manager</span><span class="o">=</span><span class="n">loss_scale</span><span class="p">,</span>
                   <span class="n">loss_fn</span><span class="o">=</span><span class="n">loss_func</span>
                   <span class="p">)</span>

    <span class="n">pred_cb</span><span class="p">,</span> <span class="n">time_cb</span> <span class="o">=</span> <span class="n">_callback</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">eval_dataset</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
    <span class="n">ckpt_cb</span> <span class="o">=</span> <span class="n">_checkpoint</span><span class="p">(</span><span class="s2">&quot;./summary_dir/summary/ckpt/step_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">step</span><span class="p">),</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;save_epoch_interval&quot;</span><span class="p">])</span>

    <span class="n">solver</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">epoch</span><span class="o">=</span><span class="n">epoch</span><span class="p">,</span>
                 <span class="n">train_dataset</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span>
                 <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">LossMonitor</span><span class="p">(),</span> <span class="n">pred_cb</span><span class="p">,</span> <span class="n">time_cb</span><span class="p">,</span> <span class="n">ckpt_cb</span><span class="p">],</span>
                 <span class="n">dataset_sink_mode</span><span class="o">=</span><span class="kc">True</span>
                 <span class="p">)</span>

<span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">logger</span><span class="p">):</span>
    <span class="n">lr</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;lr&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;multi_step&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">DataGenerator</span><span class="p">(</span><span class="n">step</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="n">data_size</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;batch_size&quot;</span><span class="p">],</span>
                             <span class="n">file_name</span><span class="o">=</span><span class="s2">&quot;data/train_step</span><span class="si">{}</span><span class="s2">.mindrecord&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="n">data</span><span class="o">.</span><span class="n">process</span><span class="p">()</span>
        <span class="n">lr</span> <span class="o">=</span> <span class="n">_scheduler</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;multi_step&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;learning_rate_reduce_times&quot;</span><span class="p">]),</span> <span class="n">step</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">)</span>
        <span class="n">train_single_step</span><span class="p">(</span><span class="n">step</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">)</span>
</pre></div>
</div>
<p>The model training process is as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="n">Train</span> <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">202.947</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">202.947</span> <span class="n">ms</span>
<span class="n">epoch</span><span class="p">:</span> <span class="mi">487</span> <span class="n">step</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">loss</span> <span class="ow">is</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">Float32</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span> <span class="mf">0.663754</span><span class="p">)</span>
<span class="n">Train</span> <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">159.724</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">159.724</span> <span class="n">ms</span>
<span class="n">epoch</span><span class="p">:</span> <span class="mi">488</span> <span class="n">step</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">loss</span> <span class="ow">is</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">Float32</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span> <span class="mf">0.651065</span><span class="p">)</span>
<span class="n">Train</span> <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">168.118</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">168.118</span> <span class="n">ms</span>
<span class="n">epoch</span><span class="p">:</span> <span class="mi">489</span> <span class="n">step</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">loss</span> <span class="ow">is</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">Float32</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span> <span class="mf">0.648911</span><span class="p">)</span>
<span class="n">Train</span> <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">151.441</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">151.441</span> <span class="n">ms</span>
<span class="n">epoch</span><span class="p">:</span> <span class="mi">490</span> <span class="n">step</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">loss</span> <span class="ow">is</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">Float32</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span> <span class="mf">0.648038</span><span class="p">)</span>
<span class="o">================================</span><span class="n">Start</span> <span class="n">Evaluation</span><span class="o">================================</span>
<span class="n">LpLoss_error</span><span class="p">:</span> <span class="mf">0.04020831733942032</span>
<span class="o">=================================</span><span class="n">End</span> <span class="n">Evaluation</span><span class="o">=================================</span>
<span class="n">predict</span> <span class="n">total</span> <span class="n">time</span><span class="p">:</span> <span class="mf">0.4999086856842041</span> <span class="n">s</span>
<span class="n">Train</span> <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">658.657</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">658.657</span> <span class="n">ms</span>
<span class="n">epoch</span><span class="p">:</span> <span class="mi">491</span> <span class="n">step</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">loss</span> <span class="ow">is</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">Float32</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span> <span class="mf">0.640651</span><span class="p">)</span>
<span class="n">Train</span> <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">113.954</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">113.954</span> <span class="n">ms</span>
<span class="n">epoch</span><span class="p">:</span> <span class="mi">492</span> <span class="n">step</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">loss</span> <span class="ow">is</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">Float32</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span> <span class="mf">0.630344</span><span class="p">)</span>
<span class="n">Train</span> <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">166.617</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">166.617</span> <span class="n">ms</span>
<span class="n">epoch</span><span class="p">:</span> <span class="mi">493</span> <span class="n">step</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">loss</span> <span class="ow">is</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">Float32</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span> <span class="mf">0.606285</span><span class="p">)</span>
<span class="n">Train</span> <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">182.399</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">182.399</span> <span class="n">ms</span>
<span class="n">epoch</span><span class="p">:</span> <span class="mi">494</span> <span class="n">step</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">loss</span> <span class="ow">is</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">Float32</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span> <span class="mf">0.639116</span><span class="p">)</span>
<span class="n">Train</span> <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">133.293</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">133.293</span> <span class="n">ms</span>
<span class="n">epoch</span><span class="p">:</span> <span class="mi">495</span> <span class="n">step</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">loss</span> <span class="ow">is</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">Float32</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span> <span class="mf">0.631353</span><span class="p">)</span>
<span class="n">Train</span> <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">136.290</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">136.290</span> <span class="n">ms</span>
<span class="n">epoch</span><span class="p">:</span> <span class="mi">496</span> <span class="n">step</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">loss</span> <span class="ow">is</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">Float32</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span> <span class="mf">0.638366</span><span class="p">)</span>
<span class="n">Train</span> <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">219.318</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">219.318</span> <span class="n">ms</span>
<span class="n">epoch</span><span class="p">:</span> <span class="mi">497</span> <span class="n">step</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">loss</span> <span class="ow">is</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">Float32</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span> <span class="mf">0.639544</span><span class="p">)</span>
<span class="n">Train</span> <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">202.168</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">202.168</span> <span class="n">ms</span>
<span class="n">epoch</span><span class="p">:</span> <span class="mi">498</span> <span class="n">step</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">loss</span> <span class="ow">is</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">Float32</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span> <span class="mf">0.631913</span><span class="p">)</span>
<span class="n">Train</span> <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">151.460</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">151.460</span> <span class="n">ms</span>
<span class="n">epoch</span><span class="p">:</span> <span class="mi">499</span> <span class="n">step</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">loss</span> <span class="ow">is</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">Float32</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span> <span class="mf">0.640468</span><span class="p">)</span>
<span class="n">Train</span> <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">138.932</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">138.932</span> <span class="n">ms</span>
<span class="n">epoch</span><span class="p">:</span> <span class="mi">500</span> <span class="n">step</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">loss</span> <span class="ow">is</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">Float32</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span> <span class="mf">0.640138</span><span class="p">)</span>
<span class="o">================================</span><span class="n">Start</span> <span class="n">Evaluation</span><span class="o">================================</span>
<span class="n">LpLoss_error</span><span class="p">:</span> <span class="mf">0.03963303565979004</span>
<span class="o">=================================</span><span class="n">End</span> <span class="n">Evaluation</span><span class="o">=================================</span>
<span class="n">predict</span> <span class="n">total</span> <span class="n">time</span><span class="p">:</span> <span class="mf">0.5544295310974121</span> <span class="n">s</span>
</pre></div>
</div>
</section>
<section id="model-evaluation-and-visualization">
<h3>Model Evaluation and Visualization<a class="headerlink" href="#model-evaluation-and-visualization" title="Permalink to this headline"></a></h3>
<p>After the model training is complete, run the visualization.py file to test and visualize the model training result. The following figure shows the comparison between the prediction result and label.</p>
<p><img alt="" src="../_images/result.jpg" /></p>
<p>The coefficient regression results of the partial differential equation are as follows:</p>
<p><img alt="" src="../_images/coe_trained_step-1.png" /></p>
<p>The data labels for the coefficients of the partial differential equation are as follows:</p>
<p><img alt="" src="../_images/coe_label_benchmark.png" /></p>
</section>
<section id="long-term-prediction">
<h3>Long-Term Prediction<a class="headerlink" href="#long-term-prediction" title="Permalink to this headline"></a></h3>
<p>Further, the trained PDE-Net can be used for longer predictions. Perform multiple sets of tests and plot 25% and 75% of the error as banded curves, as shown in the figure:</p>
<p><img alt="" src="../_images/extrapolation.jpg" /></p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../cfd/riemann2d.html" class="btn btn-neutral float-left" title="2D Riemann" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../mindflow.cell.html" class="btn btn-neutral float-right" title="mindflow.cell" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright MindSpore.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 
</body>
</html>