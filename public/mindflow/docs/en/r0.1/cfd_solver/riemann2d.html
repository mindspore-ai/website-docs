

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>2D Riemann &mdash; MindSpore master documentation</title>
  

  
  <link rel="stylesheet" href="../_static/nbsphinx-code-cells.css" type="text/css" />
  <link rel="stylesheet" href="../_static/nbsphinx-code-cells.css" type="text/css" />
  <link rel="stylesheet" href="../_static/nbsphinx-code-cells.css" type="text/css" />
   
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  
  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        
        
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="mindflow.cell" href="../mindflow.cell.html" />
    <link rel="prev" title="2D Couette Flow" href="couette.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> MindSpore
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation Deployment</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../mindflow_install.html">MindSpore Flow Installation</a></li>
</ul>
<p class="caption"><span class="caption-text">Features</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../features/solve_pinns_by_mindflow.html">Solving PINNs Based on MindSpore Flow</a></li>
</ul>
<p class="caption"><span class="caption-text">Physics-driven</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../physics_driven/burgers1D.html">1D Burgers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../physics_driven/darcy2D.html">2D stabilized Darcy Problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../physics_driven/navier_stokes2D.html">2D Cylinder Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../physics_driven/poisson_geometry.html">2D &amp; 3D Poisson</a></li>
<li class="toctree-l1"><a class="reference internal" href="../physics_driven/taylor_green2D.html">Two-dimensional Taylor Green Vortex</a></li>
</ul>
<p class="caption"><span class="caption-text">Data-driven</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../data_driven/burgers_FNO1D.html">FNO for 1D Burgers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data_driven/navier_stokes_FNO2D.html">FNO for 2D Navier-Stokes</a></li>
</ul>
<p class="caption"><span class="caption-text">Data Mechanism Fusion</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../data_mechanism_fusion/pde_net.html">PDE-Net for Convection-Diffusion Equation</a></li>
</ul>
<p class="caption"><span class="caption-text">CFD-solver</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="lax_tube.html">1D Lax Tube</a></li>
<li class="toctree-l1"><a class="reference internal" href="sod_tube.html">1D Sod Tube</a></li>
<li class="toctree-l1"><a class="reference internal" href="couette.html">2D Couette Flow</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">2D Riemann</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#problem-description">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#define-simulator-and-runtime">Define Simulator and RunTime</a></li>
<li class="toctree-l2"><a class="reference internal" href="#initial-condition">Initial Condition</a></li>
<li class="toctree-l2"><a class="reference internal" href="#run-simulation">Run Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#post-processing">Post Processing</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../mindflow.cell.html">mindflow.cell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindflow.cfd.html">mindflow.cfd</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindflow.common.html">mindflow.common</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindflow.data.html">mindflow.data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindflow.geometry.html">mindflow.geometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindflow.loss.html">mindflow.loss</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindflow.operators.html">mindflow.operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindflow.pde.html">mindflow.pde</a></li>
</ul>
<p class="caption"><span class="caption-text">RELEASE NOTES</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../RELEASE.html">Release Notes</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MindSpore</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>2D Riemann</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/cfd_solver/riemann2d.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="2d-riemann">
<h1>2D Riemann<a class="headerlink" href="#2d-riemann" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://obs.dualstack.cn-north-4.myhuaweicloud.com/mindspore-website/notebook/r2.0/mindflow/en/cfd_solver/mindspore_riemann2d.ipynb"><img alt="DownloadNotebook" src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/r2.0/resource/_static/logo_notebook_en.png" /></a> <a class="reference external" href="https://obs.dualstack.cn-north-4.myhuaweicloud.com/mindspore-website/notebook/r2.0/mindflow/en/cfd_solver/mindspore_riemann2d.py"><img alt="DownloadCode" src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/r2.0/resource/_static/logo_download_code_en.png" /></a> <a class="reference external" href="https://gitee.com/mindspore/docs/blob/r2.0/docs/mindflow/docs/source_en/cfd_solver/riemann2d.ipynb"><img alt="ViewSource" src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/r2.0/resource/_static/logo_source_en.png" /></a></p>
<p>This notebook requires <strong>MindSpore version &gt;= 2.0.0</strong> to support new APIs including: <em>mindspore.jit, mindspore.jit_class</em>.</p>
<p>A Riemann problem, named after Bernhard Riemann, is a specific initial value problem composed of a conservation equation together with piecewise constant initial data which has a single discontinuity in the domain of interest. The Riemann problem is very useful for the understanding of equations like Euler conservation equations because all properties, such as shocks and rarefaction waves, appear as characteristics in the solution. It also gives an exact solution to some complex nonlinear
equations, such as the Euler equations.</p>
<p>In numerical analysis, Riemann problems appear in a natural way in finite volume methods for the solution of conservation law equations due to the discreteness of the grid. For that it is widely used in computational fluid dynamics and in computational magnetohydrodynamics simulations.</p>
<div class="section" id="problem-description">
<h2>Problem Description<a class="headerlink" href="#problem-description" title="Permalink to this headline">¶</a></h2>
<p>The definition of the 2 dimensional Riemann problem is:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\frac{\partial}{\partial t} \left(\begin{matrix} \rho \\ \rho u \\ \rho v \\ E \\\end{matrix} \right) + \frac{\partial}{\partial x} \left(\begin{matrix} \rho u \\ \rho u^2 + p \\ \rho u v \\ u(E + p) \\\end{matrix} \right) + \frac{\partial}{\partial y} \left(\begin{matrix} \rho v \\ \rho uv \\ \rho v^2 + p \\ v(E + p) \\\end{matrix} \right) = 0\end{split}\]</div>
<div class="math notranslate nohighlight">
\[E = \frac{\rho}{\gamma - 1} + \frac{1}{2}\rho u^2\]</div>
<p>where <span class="math notranslate nohighlight">\(\gamma = 1.4\)</span> for ideal gas. The initial condition is</p>
<div class="math notranslate nohighlight">
\[\begin{split}\left(\begin{matrix} \rho \\ u \\ v \\ p \\\end{matrix}\right)_{x&lt;0.5, y&gt;0.5} = \left(\begin{matrix} 0.5323 \\ 1.206 \\ 0.0 \\ 0.3 \\\end{matrix}\right), \quad
\left(\begin{matrix} \rho \\ u \\ v \\ p \\\end{matrix}\right)_{x&gt;0.5, y&gt;0.5} = \left(\begin{matrix} 1.5 \\ 0.0 \\ 0.0 \\ 1.5 \\\end{matrix}\right)\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}\left(\begin{matrix} \rho \\ u \\ v \\ p \\\end{matrix}\right)_{x&lt;0.5, y&lt;0.5} = \left(\begin{matrix} 0.138 \\ 1.206 \\ 1.206 \\ 0.029 \\\end{matrix}\right), \quad
\left(\begin{matrix} \rho \\ u \\ v \\ p \\\end{matrix}\right)_{x&gt;0.5, y&lt;0.5} = \left(\begin{matrix} 0.5323 \\ 0.0 \\ 1.206 \\ 0.3 \\\end{matrix}\right)\end{split}\]</div>
<p>The following <code class="docutils literal notranslate"><span class="pre">src</span></code> pacakage can be downloaded in <a class="reference external" href="https://gitee.com/mindspore/mindscience/tree/r0.2.0/MindFlow/applications/cfd/riemann2d/src">src</a>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">from</span> <span class="nn">mindflow</span> <span class="kn">import</span> <span class="n">load_yaml_config</span><span class="p">,</span> <span class="n">vis_2d</span>
<span class="kn">from</span> <span class="nn">mindflow</span> <span class="kn">import</span> <span class="n">cfd</span>
<span class="kn">from</span> <span class="nn">mindflow.cfd.runtime</span> <span class="kn">import</span> <span class="n">RunTime</span>
<span class="kn">from</span> <span class="nn">mindflow.cfd.simulator</span> <span class="kn">import</span> <span class="n">Simulator</span>

<span class="kn">from</span> <span class="nn">src.ic</span> <span class="kn">import</span> <span class="n">riemann2d_ic</span>

<span class="n">ms</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">device_target</span><span class="o">=</span><span class="s2">&quot;GPU&quot;</span><span class="p">,</span> <span class="n">device_id</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="define-simulator-and-runtime">
<h2>Define Simulator and RunTime<a class="headerlink" href="#define-simulator-and-runtime" title="Permalink to this headline">¶</a></h2>
<p>The mesh, material, runtime, boundary conditions and numerical methods are defined in <a class="reference external" href="https://gitee.com/mindspore/mindscience/blob/r0.2.0/MindFlow/applications/cfd/riemann2d/numeric.yaml">numeric.yaml</a>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">config</span> <span class="o">=</span> <span class="n">load_yaml_config</span><span class="p">(</span><span class="s1">&#39;numeric.yaml&#39;</span><span class="p">)</span>
<span class="n">simulator</span> <span class="o">=</span> <span class="n">Simulator</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<span class="n">runtime</span> <span class="o">=</span> <span class="n">RunTime</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;runtime&#39;</span><span class="p">],</span> <span class="n">simulator</span><span class="o">.</span><span class="n">mesh_info</span><span class="p">,</span> <span class="n">simulator</span><span class="o">.</span><span class="n">material</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="initial-condition">
<h2>Initial Condition<a class="headerlink" href="#initial-condition" title="Permalink to this headline">¶</a></h2>
<p>Initial condition is determined according to mesh coordinates.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mesh_x</span><span class="p">,</span> <span class="n">mesh_y</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">mesh_info</span><span class="o">.</span><span class="n">mesh_xyz</span><span class="p">()</span>
<span class="n">pri_var</span> <span class="o">=</span> <span class="n">riemann2d_ic</span><span class="p">(</span><span class="n">mesh_x</span><span class="p">,</span> <span class="n">mesh_y</span><span class="p">)</span>
<span class="n">con_var</span> <span class="o">=</span> <span class="n">cfd</span><span class="o">.</span><span class="n">cal_con_var</span><span class="p">(</span><span class="n">pri_var</span><span class="p">,</span> <span class="n">simulator</span><span class="o">.</span><span class="n">material</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="run-simulation">
<h2>Run Simulation<a class="headerlink" href="#run-simulation" title="Permalink to this headline">¶</a></h2>
<p>Run CFD simulation with time marching.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="n">runtime</span><span class="o">.</span><span class="n">time_loop</span><span class="p">(</span><span class="n">pri_var</span><span class="p">):</span>
    <span class="n">pri_var</span> <span class="o">=</span> <span class="n">cfd</span><span class="o">.</span><span class="n">cal_pri_var</span><span class="p">(</span><span class="n">con_var</span><span class="p">,</span> <span class="n">simulator</span><span class="o">.</span><span class="n">material</span><span class="p">)</span>
    <span class="n">runtime</span><span class="o">.</span><span class="n">compute_timestep</span><span class="p">(</span><span class="n">pri_var</span><span class="p">)</span>
    <span class="n">con_var</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">integration_step</span><span class="p">(</span><span class="n">con_var</span><span class="p">,</span> <span class="n">runtime</span><span class="o">.</span><span class="n">timestep</span><span class="p">)</span>
    <span class="n">runtime</span><span class="o">.</span><span class="n">advance</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
current time = 0.000000, time step = 0.001005
current time = 0.001005, time step = 0.001005
current time = 0.002010, time step = 0.001005
current time = 0.003016, time step = 0.001005
current time = 0.004021, time step = 0.001005
current time = 0.005026, time step = 0.001005
current time = 0.006031, time step = 0.001005
current time = 0.007036, time step = 0.001005
current time = 0.008041, time step = 0.001005
current time = 0.009046, time step = 0.001005
current time = 0.010051, time step = 0.001005
current time = 0.011057, time step = 0.001005
current time = 0.012062, time step = 0.001005
current time = 0.013067, time step = 0.001005
current time = 0.014072, time step = 0.001005
current time = 0.015076, time step = 0.001005
current time = 0.016081, time step = 0.001005
current time = 0.017086, time step = 0.001005
current time = 0.018091, time step = 0.001005
current time = 0.019097, time step = 0.001005
current time = 0.020102, time step = 0.001005
current time = 0.021107, time step = 0.001005
current time = 0.022112, time step = 0.001005
current time = 0.023117, time step = 0.001005
current time = 0.024121, time step = 0.001005
current time = 0.025126, time step = 0.001005
current time = 0.026131, time step = 0.001005
current time = 0.027137, time step = 0.001005
current time = 0.028142, time step = 0.001005
...
current time = 0.297090, time step = 0.000760
current time = 0.297849, time step = 0.000759
current time = 0.298609, time step = 0.000759
current time = 0.299368, time step = 0.000759
</pre></div></div>
</div>
</div>
<div class="section" id="post-processing">
<h2>Post Processing<a class="headerlink" href="#post-processing" title="Permalink to this headline">¶</a></h2>
<p>You can view the density, pressure and velocity.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pri_var</span> <span class="o">=</span> <span class="n">cfd</span><span class="o">.</span><span class="n">cal_pri_var</span><span class="p">(</span><span class="n">con_var</span><span class="p">,</span> <span class="n">simulator</span><span class="o">.</span><span class="n">material</span><span class="p">)</span>
<span class="n">vis_2d</span><span class="p">(</span><span class="n">pri_var</span><span class="p">,</span> <span class="s1">&#39;riemann2d.jpg&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/cfd_solver_riemann2d_10_0.png" src="../_images/cfd_solver_riemann2d_10_0.png" />
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../mindflow.cell.html" class="btn btn-neutral float-right" title="mindflow.cell" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="couette.html" class="btn btn-neutral float-left" title="2D Couette Flow" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2022, MindSpore.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   
	<script async="async" src="https://cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>