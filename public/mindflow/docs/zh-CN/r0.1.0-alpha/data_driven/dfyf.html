<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI工业流体仿真模型——东方·御风 &mdash; MindSpore master 文档</title><script>;(()=>{const e=localStorage.getItem("ms-theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;(e?"dark"===e:t)&&document.documentElement.setAttribute("data-o-theme","dark")})();</script><link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script><script src="../_static/jquery.js"></script>
        <script src="../_static/js/theme.js"></script><script src="../_static/underscore.js"></script><script src="../_static/doctools.js"></script><script src="../_static/translations.js"></script><script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="基于FNO求解一维Burgers" href="FNO1D.html" />
    <link rel="prev" title="基于MindFlow定义符号化偏微分方程" href="../physics_driven/sympy_pde_definition.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> MindSpore
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="在文档中搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">安装部署</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../mindflow_install.html">安装MindFlow</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">物理驱动</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../physics_driven/burgers1D.html">一维Burgers问题</a></li>
<li class="toctree-l1"><a class="reference internal" href="../physics_driven/navier_stokes2D.html">二维圆柱绕流</a></li>
<li class="toctree-l1"><a class="reference internal" href="../physics_driven/poisson_ring.html">作用于圆环的二维Poisson问题</a></li>
<li class="toctree-l1"><a class="reference internal" href="../physics_driven/sympy_pde_definition.html">基于MindFlow定义符号化偏微分方程</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">数据驱动</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">AI工业流体仿真模型——东方·御风</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#概述">概述</a></li>
<li class="toctree-l2"><a class="reference internal" href="#背景介绍">背景介绍</a></li>
<li class="toctree-l2"><a class="reference internal" href="#技术难点">技术难点</a></li>
<li class="toctree-l2"><a class="reference internal" href="#技术路径">技术路径</a></li>
<li class="toctree-l2"><a class="reference internal" href="#准备环节">准备环节</a></li>
<li class="toctree-l2"><a class="reference internal" href="#东方·御风mindflow实现">“东方·御风”MindFlow实现</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#数据集制作与加载">数据集制作与加载</a></li>
<li class="toctree-l3"><a class="reference internal" href="#配置网络与训练参数">配置网络与训练参数</a></li>
<li class="toctree-l3"><a class="reference internal" href="#模型构建">模型构建</a></li>
<li class="toctree-l3"><a class="reference internal" href="#模型训练">模型训练</a></li>
<li class="toctree-l3"><a class="reference internal" href="#模型推理">模型推理</a></li>
<li class="toctree-l3"><a class="reference internal" href="#结果可视化">结果可视化</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="FNO1D.html">基于FNO求解一维Burgers</a></li>
<li class="toctree-l1"><a class="reference internal" href="FNO2D.html">基于FNO求解二维Navier-Stokes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">可微分CFD求解器</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../cfd/lax_tube.html">一维Lax激波管</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cfd/sod_tube.html">一维Sod激波管</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cfd/couette.html">二维库埃特流</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cfd/riemann2d.html">二维黎曼问题</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">数据机理融合</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../physics_plus_data_driven/pdenet.html">PDE-Net求解微分方程反问题并实现长期预测</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API参考</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../mindflow.cell.html">mindflow.cell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindflow.cfd.html">mindflow.cfd</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindflow.common.html">mindflow.common</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindflow.data.html">mindflow.data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindflow.geometry.html">mindflow.geometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindflow.loss.html">mindflow.loss</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindflow.operators.html">mindflow.operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindflow.pde.html">mindflow.pde</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindflow.solver.html">mindflow.solver</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">RELEASE NOTES</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../RELEASE.html">Release Notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MindSpore</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>AI工业流体仿真模型——东方·御风</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/data_driven/dfyf.md.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="ai工业流体仿真模型——东方·御风">
<h1>AI工业流体仿真模型——东方·御风<a class="headerlink" href="#ai工业流体仿真模型——东方·御风" title="永久链接至标题"></a></h1>
<p><a href="https://gitee.com/mindspore/docs/blob/r2.0.0-alpha/docs/mindflow/docs/source_zh_cn/data_driven/dfyf.md" target="_blank"><img src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/r2.0.0-alpha/resource/_static/logo_source.png"></a></p>
<section id="概述">
<h2>概述<a class="headerlink" href="#概述" title="永久链接至标题"></a></h2>
<p><strong>“东方·御风”</strong> 是基于昇腾AI打造的面向大型客机翼型流场高效高精度AI预测仿真模型， 并在昇思MindSpore流体仿真套件的支持下，有效提高了对复杂流动的仿真能力，仿真时间缩短至原来的二十四分之一，减小风洞实验的次数。同时，“东方·御风”对流场中变化剧烈的区域可进行精准预测，流场平均误差降低至万分之一量级，达到工业级标准。</p>
<p><img alt="img_8.png" src="../_images/img_8.png" /></p>
<p>本教程将对“东方·御风”的研究背景和技术路径进行介绍，并展示如何通过MindFlow实现该模型的训练和快速推理，以及流场可视化分析，从而快速获取流场物理信息。</p>
</section>
<section id="背景介绍">
<h2>背景介绍<a class="headerlink" href="#背景介绍" title="永久链接至标题"></a></h2>
<p>民用飞机气动设计水平直接决定飞机的“四性”，即安全性，舒适性，经济性，环保性。飞机的气动设计作为飞机设计中最基础，最核心的技术之一，在飞机飞行包线（起飞-爬升-巡航-下降-降落等）的不同阶段有着不同的研究需求和重点。如起飞阶段工程师将更关注外部噪声和高升阻比，而巡航阶段则关注油耗效率和能耗效率。流体仿真技术在飞机的气动设计的应用广泛，其主要目的在于通过数值计算的方法 获取仿真目标的流场特性（速度、压力等），进而分析飞机的气动性能参数，实现飞行器的气动性能的优化设计。</p>
<p><img alt="img_7.png" src="../_images/img_7.png" /></p>
<p>目前，飞行器的气动仿真通常采用商业仿真软件对流体的控制方程进行求解，得到相应的气动性能参数（升阻力，压力，速度等）。无论基于何种CFD的仿真软件，都包含以下几个步骤：</p>
<ol class="arabic simple">
<li><p>物理建模：将物理问题抽象简化，对相关几何体的2D/3D的流体和固体计算域进行建模。</p></li>
<li><p>网格划分：将计算域划分为相应大小的面/体积单元，以便解析不同区域不同尺度的湍流。</p></li>
<li><p>数值离散：将流体控制方程中的积分、微分项、偏导项通过不同阶的数值格式离散为代数形式，组成相应的代数方程组。</p></li>
<li><p>流体控制方程求解：利用数值方法（常见的如<code class="docutils literal notranslate"><span class="pre">SIMPLE</span></code>算法、<code class="docutils literal notranslate"><span class="pre">PISO</span></code> 算法等）对离散后的控制方程组进行迭代求解，计算离散的时间/空间点上的数值解。</p></li>
<li><p>流场后处理：求解完成后，使用流场后处理软件对仿真结果进行定性和定量的分析和可视化绘图，验证结果的准确性。</p></li>
</ol>
<p><img alt="img.png" src="../_images/img.png" /></p>
<p>然而，随着飞机设计研制周期的不断缩短，现有的气动设计方法存在诸多局限。为使大型客机的气动设计水平赶超波音和空客两大航空巨头，必须发展先进的气动设计手段，结合人工智能等先进技术，建立适合型号设计的快速气动设计工具，进而提高其对复杂流动的仿真能力，减少风洞试验的次数，降低设计研发成本。</p>
<p><img alt="img_11.png" src="../_images/img_11.png" /></p>
<p>在飞行器的设计中，机翼的阻力分布约占整体飞行阻力的52%，因此，机翼形状设计对飞机整体的飞行性能而言至关重要。然而，三维翼型高精度CFD仿真需划分成百上千万量级的计算网格，计算资源消耗大，计算周期长。为了提高仿真设计效率，通常会先针对三维翼型的二维剖面进行设计优化，而这个过程往往需要对成千上万副的翼型及其对应工况进行CFD的重复迭代计算。其中，超临界翼型在高速巡航阶段的有着重要的应用。因为相较于普通翼型，超临界翼型的头部比较丰满，降低了前缘的负压峰值，使气流较晚到达声速，即提高了临界马赫数；同时，超临界翼型上表面中部比较平坦，有效控制了上翼面气流的进一步加速，降低了激波的强度和影响范围，并且推迟了上表面的激波诱导边界层分离。因此，超临界翼型有着更高的临界马赫数，可大幅改善在跨音速范围内的气动性能，降低阻力并提高姿态可控性，是机翼形状中必须考虑的设计。</p>
<p><img alt="img_10.png" src="../_images/img_10.png" /></p>
<p>然而，二维超临界翼型的气动设计需要针对不同的形状参数和来流参数进行仿真，依然存在大量的重复迭代计算工作，设计周期长。因此，利用AI天然并行推理能力，缩短设计研发周期显得尤为重要。基于此，商飞和华为联合发布了业界首个AI工业流体仿真模型– <strong>“东方·御风”</strong> ，该模型能在超临界翼型的几何形状、来流参数（攻角/马赫数）发生变化时，实现大型客机翼型流场的高效高精度推理，快速精准预测翼型周围的流场及升阻力。</p>
</section>
<section id="技术难点">
<h2>技术难点<a class="headerlink" href="#技术难点" title="永久链接至标题"></a></h2>
<p>为了实现超临界翼型的的AI高效高精度流场预测，需要克服如下的技术难点：</p>
<ul class="simple">
<li><p><strong>翼型网格疏密不均，流动特征提取困难。</strong> 二维翼型计算域的流体仿真网格常采用O型或C型网格。如图所示，为典型的O型网格剖分。为了精准地计算流动边界层，对翼型近壁面进行了网格加密，而来流远场的网格则相对稀疏。这种非标的网格数据结构增加了提取流动特征的困难程度。</p></li>
</ul>
<p><img alt="img_12.png" src="../_images/img_12.png" /> <img alt="img_13.png" src="../_images/img_13.png" /></p>
<ul class="simple">
<li><p><strong>不同气动参数或翼型形状发生改变时，流动特征变化明显。</strong> 如图所示，当翼型的攻角发生变化时，流场会发生剧烈的变化，尤其当攻角增大到一定程度时，会产生激波现象：即流场中存在明显的间断现象，流体在波阵面上的压力、速度和密度形成明显的突跃变化。</p></li>
</ul>
<p><img alt="img_13.png" src="../_images/diff_aoa.png" /></p>
<ul class="simple">
<li><p><strong>激波区域流场变化剧烈，预测困难。</strong> 由于激波的存在对其附近的流场影响显著，激波前后的流场变化剧烈，流场变化复杂，导致AI预测困难。激波的位置直接影响着翼型的气动性能设计和载荷分布。因此，对激波信号的精准捕捉是十分重要但充满挑战的。</p></li>
</ul>
</section>
<section id="技术路径">
<h2>技术路径<a class="headerlink" href="#技术路径" title="永久链接至标题"></a></h2>
<p>针对如上所述的技术难点，我们设计了基于AI模型的技术路径图，构建不同流动状态下翼型几何及其对应流场的端到端映射， 主要包含以下几个核心步骤：</p>
<ul class="simple">
<li><p>首先，设计AI数据高效转换工具，实现翼型流场复杂边界和非标数据的特征提取，实现规则化AI张量数据生成，再利用几何编码方式加强复杂几何边界特征的提取。</p></li>
<li><p>其次，利用神经网络模型，实现不同流动状态下翼型构型和流场物理量的映射，模型的输入为转换后所生成的翼型几何信息和气动参数；模型的输出为转换后生成的流场物理量信息，如速度和压力。</p></li>
<li><p>最后，利用自适应的损失函数训练网络的权重，提升流场剧烈变化区域（如激波）的预测精度。</p></li>
</ul>
</section>
<section id="准备环节">
<h2>准备环节<a class="headerlink" href="#准备环节" title="永久链接至标题"></a></h2>
<p>实践前，确保已经正确安装最新版本的MindSpore与MindFlow。如果没有，可以通过：</p>
<ul class="simple">
<li><p>MindSpore安装页面安装<a class="reference external" href="https://www.mindspore.cn/install">MindSpore</a>。</p></li>
<li><p>MindFlow安装页面安装MindFlow。</p></li>
</ul>
</section>
<section id="东方·御风mindflow实现">
<h2>“东方·御风”MindFlow实现<a class="headerlink" href="#东方·御风mindflow实现" title="永久链接至标题"></a></h2>
<p>“东方·御风”MindFlow实现分为以下6个步骤：</p>
<ol class="arabic simple">
<li><p>数据集制作与加载。</p></li>
<li><p>配置网络与训练参数。</p></li>
<li><p>模型构建。</p></li>
<li><p>模型训练。</p></li>
<li><p>模型推理。</p></li>
<li><p>结果可视化。</p></li>
</ol>
<section id="数据集制作与加载">
<h3>数据集制作与加载<a class="headerlink" href="#数据集制作与加载" title="永久链接至标题"></a></h3>
<p>首先将CFD的数据集转换成张量数据，然后将张量数据转换成MindRecord。设计AI数据高效转换工具，实现翼型流场复杂边界和非标数据的特征提取。</p>
<p>AI流体仿真目前支持使用本地数据集训练，通过<code class="docutils literal notranslate"><span class="pre">MindDataset</span></code>接口可以配置相应数据集选项，需要指定MindRecord数据集文件位置。</p>
</section>
<section id="配置网络与训练参数">
<h3>配置网络与训练参数<a class="headerlink" href="#配置网络与训练参数" title="永久链接至标题"></a></h3>
<p>配置文件包括四类参数，分别为模型相关参数（model）、数据相关参数（data）、优化器相关参数（optimizer）、输出相关参数（callback）。其中ViT模型最重要的参数为encoder和decoder的depth、 embed_dim和num_heads，分别控制模型中layer数、隐向量的长度以及多头注意力机制的头数。具体参数配置含义默认值如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;ViT&quot;</span>                   <span class="c1"># Model name</span>
  <span class="n">exp</span><span class="p">:</span>
    <span class="n">input_dims</span><span class="p">:</span> <span class="mi">3</span>               <span class="c1"># Input data channel</span>
  <span class="n">output_dims</span><span class="p">:</span> <span class="mi">3</span>                <span class="c1"># Output data channel</span>
  <span class="n">height</span><span class="p">:</span> <span class="mi">192</span>                   <span class="c1"># Height of the grid</span>
  <span class="n">width</span><span class="p">:</span> <span class="mi">384</span>                    <span class="c1"># Width of the grid</span>
  <span class="n">encoder_depth</span><span class="p">:</span> <span class="mi">6</span>              <span class="c1"># Depth of the encoder</span>
  <span class="n">encoder_embed_dim</span><span class="p">:</span> <span class="mi">768</span>        <span class="c1"># Embedding dimensions of the encoder</span>
  <span class="n">encoder_num_heads</span><span class="p">:</span> <span class="mi">12</span>         <span class="c1"># Numbers of attention-heads of the encoder</span>
  <span class="n">decoder_depth</span><span class="p">:</span> <span class="mi">6</span>              <span class="c1"># Depth of the decoder</span>
  <span class="n">decoder_embed_dim</span><span class="p">:</span> <span class="mi">512</span>        <span class="c1"># Numbers of attention-heads of the decoder</span>
  <span class="n">decoder_num_heads</span><span class="p">:</span> <span class="mi">16</span>         <span class="c1"># Numbers of attention-heads of the decoder</span>

<span class="n">data</span><span class="p">:</span>
  <span class="n">data_path</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>                 <span class="c1"># Path to data</span>
  <span class="n">grid_path</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>                 <span class="c1"># Path to grid</span>
  <span class="n">train_size</span><span class="p">:</span> <span class="mf">0.2</span>               <span class="c1"># Ratio of train and test dataset</span>
  <span class="n">train_num_list</span><span class="p">:</span> <span class="p">[</span><span class="mi">301</span><span class="p">]</span>         <span class="c1"># Airfoils index of train dataset [301~350]</span>
  <span class="n">test_num_list</span><span class="p">:</span> <span class="p">[</span><span class="mi">451</span><span class="p">]</span>          <span class="c1"># Airfoils index of test dataset [451~500]</span>
  <span class="n">batch_size</span><span class="p">:</span> <span class="mi">32</span>                <span class="c1"># Batch size of train</span>
  <span class="n">test_batch_size</span><span class="p">:</span> <span class="mi">32</span>           <span class="c1"># Batch size of test</span>
  <span class="n">post_dir</span><span class="p">:</span> <span class="s2">&quot;./postprocessing/plot_results/&quot;</span>                            <span class="c1"># Path to postprocessing</span>
  <span class="n">max_value_list</span><span class="p">:</span> <span class="p">[</span> <span class="mf">4.6</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.18418664581293126</span><span class="p">]</span>                      <span class="c1"># Max values of input data</span>
  <span class="n">min_value_list</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.18382872836312403</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1839052340212462</span><span class="p">]</span>     <span class="c1"># Min values of input data</span>

<span class="n">optimizer</span><span class="p">:</span>
  <span class="n">epochs</span><span class="p">:</span> <span class="mi">1000</span>                  <span class="c1"># The number of train epoch</span>
  <span class="n">lr</span><span class="p">:</span> <span class="mf">0.0005</span>                    <span class="c1"># Initial learning rate</span>
  <span class="n">gamma</span><span class="p">:</span> <span class="mf">0.2</span>                    <span class="c1"># The gamma value of the optimizer</span>

<span class="n">callback</span><span class="p">:</span>
  <span class="n">summary_dir</span><span class="p">:</span> <span class="s2">&quot;./summary_dir/summary_&quot;</span>    <span class="c1"># Path to Summary</span>
  <span class="n">save_checkpoint_epochs</span><span class="p">:</span> <span class="mi">1000</span>             <span class="c1"># Frequency of checkpoint results</span>
  <span class="n">keep_checkpoint_max</span><span class="p">:</span> <span class="mi">1</span>                   <span class="c1"># Maximum number of checkpoint files can be save</span>
  <span class="n">eval_interval</span><span class="p">:</span> <span class="mi">10</span>                        <span class="c1"># TestSet Accuracy Test Frequency</span>
</pre></div>
</div>
</section>
<section id="模型构建">
<h3>模型构建<a class="headerlink" href="#模型构建" title="永久链接至标题"></a></h3>
<p>这里以ViT模型作为示例，该模型通过MindFlow的模型定义的ViT接口构建，需要指定ViT模型的参数。您也可以构建自己的模型。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">ViT</span><span class="p">(</span><span class="n">input_dims</span><span class="o">=</span><span class="n">model_params</span><span class="p">[</span><span class="n">method</span><span class="p">][</span><span class="s1">&#39;input_dims&#39;</span><span class="p">],</span>
            <span class="n">output_dims</span><span class="o">=</span><span class="n">model_params</span><span class="p">[</span><span class="s1">&#39;output_dims&#39;</span><span class="p">],</span>
            <span class="n">encoder_depth</span><span class="o">=</span><span class="n">model_params</span><span class="p">[</span><span class="s1">&#39;encoder_depth&#39;</span><span class="p">],</span>
            <span class="n">encoder_embed_dim</span><span class="o">=</span><span class="n">model_params</span><span class="p">[</span><span class="s1">&#39;encoder_embed_dim&#39;</span><span class="p">],</span>
            <span class="n">encoder_num_heads</span><span class="o">=</span><span class="n">model_params</span><span class="p">[</span><span class="s1">&#39;encoder_num_heads&#39;</span><span class="p">],</span>
            <span class="n">decoder_depth</span><span class="o">=</span><span class="n">model_params</span><span class="p">[</span><span class="s1">&#39;decoder_depth&#39;</span><span class="p">],</span>
            <span class="n">decoder_embed_dim</span><span class="o">=</span><span class="n">model_params</span><span class="p">[</span><span class="s1">&#39;decoder_embed_dim&#39;</span><span class="p">],</span>
            <span class="n">decoder_num_heads</span><span class="o">=</span><span class="n">model_params</span><span class="p">[</span><span class="s1">&#39;decoder_num_heads&#39;</span><span class="p">],</span>
            <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="模型训练">
<h3>模型训练<a class="headerlink" href="#模型训练" title="永久链接至标题"></a></h3>
<p>首先，通过load_config_params函数加载配置文件获得模型参数，然后调用initial_data_and_model函数获得train_dataset, eval_dataset, model, model_name。学习率可通过MindFlow提供的warmup_cosine_annealing_lr函数获得。</p>
<p>MindSpore提供Model类用于模型训练和推理，Model类输入为网络模型、优化器、损失缩放策略和loss函数。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TrainModel</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">loss_fn</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">=</span> <span class="n">model_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loss_fn</span> <span class="o">=</span> <span class="n">loss_fn</span>

    <span class="k">def</span> <span class="nf">train_with_eval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;train&quot;&quot;&quot;</span>
        <span class="n">data_params</span><span class="p">,</span> <span class="n">model_params</span><span class="p">,</span> <span class="n">optimizer_params</span><span class="p">,</span> <span class="n">callback_params</span> <span class="o">=</span> <span class="n">load_config_params</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
        <span class="n">train_dataset</span><span class="p">,</span> <span class="n">eval_dataset</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">model_name</span> <span class="o">=</span> <span class="n">initial_data_and_model</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">alpha</span><span class="p">),</span> <span class="n">data_params</span><span class="p">,</span> <span class="n">model_params</span><span class="p">,</span> <span class="n">opt</span><span class="o">.</span><span class="n">method</span><span class="p">)</span>

        <span class="n">ckpt_dir</span><span class="p">,</span> <span class="n">summary_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_dirs</span><span class="p">(</span><span class="n">callback_params</span><span class="p">,</span> <span class="n">model_name</span><span class="p">)</span>
        <span class="n">steps_per_epoch</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">get_dataset_size</span><span class="p">()</span>

        <span class="n">lr</span> <span class="o">=</span> <span class="n">warmup_cosine_annealing_lr</span><span class="p">(</span><span class="n">optimizer_params</span><span class="p">[</span><span class="s2">&quot;lr&quot;</span><span class="p">],</span> <span class="n">steps_per_epoch</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">optimizer_params</span><span class="p">[</span><span class="s2">&quot;epochs&quot;</span><span class="p">])</span>
        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">trainable_params</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">loss_fn</span><span class="o">.</span><span class="n">trainable_params</span><span class="p">(),</span> <span class="n">learning_rate</span><span class="o">=</span><span class="n">Tensor</span><span class="p">(</span><span class="n">lr</span><span class="p">))</span>
        <span class="n">loss_scale</span> <span class="o">=</span> <span class="n">DynamicLossScaleManager</span><span class="p">()</span>

        <span class="n">solver</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span>
                       <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
                       <span class="n">loss_scale_manager</span><span class="o">=</span><span class="n">loss_scale</span><span class="p">,</span>
                       <span class="n">loss_fn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loss_fn</span><span class="p">,</span>
                       <span class="p">)</span>

        <span class="n">pred_cb</span><span class="p">,</span> <span class="n">summary_cb</span><span class="p">,</span> <span class="n">time_cb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callback</span><span class="p">(</span><span class="n">eval_dataset</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">summary_dir</span><span class="p">,</span> <span class="n">callback_params</span><span class="p">,</span> <span class="n">data_params</span><span class="p">)</span>
        <span class="n">ckpt_cb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkpoint</span><span class="p">(</span><span class="n">callback_params</span><span class="p">,</span> <span class="n">ckpt_dir</span><span class="p">,</span> <span class="n">steps_per_epoch</span><span class="p">)</span>
        <span class="n">solver</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">epoch</span><span class="o">=</span><span class="n">optimizer_params</span><span class="p">[</span><span class="s2">&quot;epochs&quot;</span><span class="p">],</span>
                     <span class="n">train_dataset</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span>
                     <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">LossMonitor</span><span class="p">(),</span> <span class="n">pred_cb</span><span class="p">,</span> <span class="n">time_cb</span><span class="p">,</span> <span class="n">ckpt_cb</span><span class="p">],</span>
                     <span class="n">dataset_sink_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_set_dirs</span><span class="p">(</span><span class="n">callback_params</span><span class="p">,</span> <span class="n">model_name</span><span class="p">):</span>
        <span class="n">summary_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">callback_params</span><span class="p">[</span><span class="s2">&quot;summary_dir&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">opt</span><span class="o">.</span><span class="n">method</span><span class="p">,</span> <span class="n">model_name</span><span class="p">)</span>
        <span class="n">ckpt_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">summary_dir</span><span class="p">,</span> <span class="s2">&quot;ckpt_dir&quot;</span><span class="p">)</span>
        <span class="n">check_file_path</span><span class="p">(</span><span class="n">ckpt_dir</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;model_name: </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;config_path: </span><span class="si">{</span><span class="n">opt</span><span class="o">.</span><span class="n">config_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;summary_dir: </span><span class="si">{</span><span class="n">summary_dir</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ckpt_dir: </span><span class="si">{</span><span class="n">ckpt_dir</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ckpt_dir</span><span class="p">,</span> <span class="n">summary_dir</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_callback</span><span class="p">(</span><span class="n">eval_dataset</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">summary_dir</span><span class="p">,</span> <span class="n">callback_params</span><span class="p">,</span> <span class="n">data_params</span><span class="p">):</span>
        <span class="c1"># callback</span>
        <span class="n">pred_cb</span> <span class="o">=</span> <span class="n">PredictCallback</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">eval_dataset</span><span class="o">=</span><span class="n">eval_dataset</span><span class="p">,</span>
                                  <span class="n">summary_dir</span><span class="o">=</span><span class="n">summary_dir</span><span class="p">,</span> <span class="n">callback_params</span><span class="o">=</span><span class="n">callback_params</span><span class="p">,</span> <span class="n">data_params</span><span class="o">=</span><span class="n">data_params</span><span class="p">)</span>
        <span class="n">time_cb</span> <span class="o">=</span> <span class="n">TimeMonitor</span><span class="p">()</span>
        <span class="n">summary_cb</span> <span class="o">=</span> <span class="n">SummaryCollector</span><span class="p">(</span><span class="n">summary_dir</span><span class="o">=</span><span class="n">summary_dir</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pred_cb</span><span class="p">,</span> <span class="n">summary_cb</span><span class="p">,</span> <span class="n">time_cb</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_checkpoint</span><span class="p">(</span><span class="n">callback_params</span><span class="p">,</span> <span class="n">ckpt_dir</span><span class="p">,</span> <span class="n">steps_per_epoch</span><span class="p">):</span>
        <span class="c1"># checkpoint</span>
        <span class="n">ckpt_config</span> <span class="o">=</span> <span class="n">CheckpointConfig</span><span class="p">(</span>
            <span class="n">save_checkpoint_steps</span><span class="o">=</span><span class="n">callback_params</span><span class="p">[</span><span class="s2">&quot;save_checkpoint_epochs&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">steps_per_epoch</span><span class="p">,</span>
            <span class="n">keep_checkpoint_max</span><span class="o">=</span><span class="n">callback_params</span><span class="p">[</span><span class="s2">&quot;keep_checkpoint_max&quot;</span><span class="p">])</span>
        <span class="n">ckpt_cb</span> <span class="o">=</span> <span class="n">ModelCheckpoint</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;airfoil2d&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">ckpt_dir</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">ckpt_config</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ckpt_cb</span>
</pre></div>
</div>
<p>模型训练过程中通过自定义的PredictCallback函数，实现边训练边推理的功能。用户可以直接加载测试数据集，每训练n个epoch后输出一次测试集上的推理精度，n的大小通过配置文件中的eval_interval进行设置。运行结果如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="n">Train</span> <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">245704.565</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">357.649</span> <span class="n">ms</span>
<span class="n">epoch</span><span class="p">:</span> <span class="mi">991</span> <span class="n">step</span><span class="p">:</span> <span class="mi">687</span><span class="p">,</span> <span class="n">loss</span> <span class="ow">is</span> <span class="mf">0.018909770995378494</span>
<span class="n">Train</span> <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">134875.490</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">196.325</span> <span class="n">ms</span>
<span class="n">epoch</span><span class="p">:</span> <span class="mi">992</span> <span class="n">step</span><span class="p">:</span> <span class="mi">687</span><span class="p">,</span> <span class="n">loss</span> <span class="ow">is</span> <span class="mf">0.018905797973275185</span>
<span class="n">Train</span> <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">134833.401</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">196.264</span> <span class="n">ms</span>
<span class="n">epoch</span><span class="p">:</span> <span class="mi">993</span> <span class="n">step</span><span class="p">:</span> <span class="mi">687</span><span class="p">,</span> <span class="n">loss</span> <span class="ow">is</span> <span class="mf">0.018955739215016365</span>
<span class="n">Train</span> <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">134996.335</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">196.501</span> <span class="n">ms</span>
<span class="n">epoch</span><span class="p">:</span> <span class="mi">994</span> <span class="n">step</span><span class="p">:</span> <span class="mi">687</span><span class="p">,</span> <span class="n">loss</span> <span class="ow">is</span> <span class="mf">0.01890547014772892</span>
<span class="n">Train</span> <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">134857.379</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">196.299</span> <span class="n">ms</span>
<span class="n">epoch</span><span class="p">:</span> <span class="mi">995</span> <span class="n">step</span><span class="p">:</span> <span class="mi">687</span><span class="p">,</span> <span class="n">loss</span> <span class="ow">is</span> <span class="mf">0.019043993204832077</span>
<span class="n">Train</span> <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">134828.162</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">196.256</span> <span class="n">ms</span>
<span class="n">epoch</span><span class="p">:</span> <span class="mi">996</span> <span class="n">step</span><span class="p">:</span> <span class="mi">687</span><span class="p">,</span> <span class="n">loss</span> <span class="ow">is</span> <span class="mf">0.018846523016691208</span>
<span class="n">Train</span> <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">134789.263</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">196.200</span> <span class="n">ms</span>
<span class="n">epoch</span><span class="p">:</span> <span class="mi">997</span> <span class="n">step</span><span class="p">:</span> <span class="mi">687</span><span class="p">,</span> <span class="n">loss</span> <span class="ow">is</span> <span class="mf">0.018784258514642715</span>
<span class="n">Train</span> <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">135045.117</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">196.572</span> <span class="n">ms</span>
<span class="n">epoch</span><span class="p">:</span> <span class="mi">998</span> <span class="n">step</span><span class="p">:</span> <span class="mi">687</span><span class="p">,</span> <span class="n">loss</span> <span class="ow">is</span> <span class="mf">0.019161228090524673</span>
<span class="n">Train</span> <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">134754.484</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">196.149</span> <span class="n">ms</span>
<span class="n">epoch</span><span class="p">:</span> <span class="mi">999</span> <span class="n">step</span><span class="p">:</span> <span class="mi">687</span><span class="p">,</span> <span class="n">loss</span> <span class="ow">is</span> <span class="mf">0.01893322728574276</span>
<span class="n">Train</span> <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">134868.424</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">196.315</span> <span class="n">ms</span>
<span class="n">epoch</span><span class="p">:</span> <span class="mi">1000</span> <span class="n">step</span><span class="p">:</span> <span class="mi">687</span><span class="p">,</span> <span class="n">loss</span> <span class="ow">is</span> <span class="mf">0.01907874085009098</span>
<span class="o">================================</span><span class="n">Start</span> <span class="n">Evaluation</span><span class="o">================================</span>
<span class="n">mean</span> <span class="n">l1_error</span> <span class="p">:</span> <span class="mf">0.00017127192940710016</span><span class="p">,</span> <span class="nb">max</span> <span class="n">l1_error</span> <span class="p">:</span> <span class="mf">0.06129508092999458</span><span class="p">,</span> <span class="n">average</span> <span class="n">l1_error</span> <span class="p">:</span> <span class="mf">0.0043031450033425124</span><span class="p">,</span> <span class="nb">min</span> <span class="n">l1_error</span> <span class="p">:</span> <span class="mf">0.0008682708139531314</span><span class="p">,</span> <span class="n">median</span> <span class="n">l1_error</span> <span class="p">:</span> <span class="mf">0.0034930877154693007</span>
<span class="n">mean</span> <span class="n">u_error</span> <span class="p">:</span> <span class="mf">0.00020820375084972326</span><span class="p">,</span> <span class="nb">max</span> <span class="n">u_error</span> <span class="p">:</span> <span class="mf">0.10199415683746338</span><span class="p">,</span> <span class="n">average</span> <span class="n">u_error</span> <span class="p">:</span> <span class="mf">0.005660663934135864</span><span class="p">,</span> <span class="nb">min</span> <span class="n">u_error</span> <span class="p">:</span> <span class="mf">0.0010001659393310547</span><span class="p">,</span> <span class="n">median</span> <span class="n">u_error</span> <span class="p">:</span> <span class="mf">0.004315197467803955</span>
<span class="n">mean</span> <span class="n">v_error</span> <span class="p">:</span> <span class="mf">7.668626435136433e-05</span><span class="p">,</span> <span class="nb">max</span> <span class="n">v_error</span> <span class="p">:</span> <span class="mf">0.029990235343575478</span><span class="p">,</span> <span class="n">average</span> <span class="n">v_error</span> <span class="p">:</span> <span class="mf">0.003053658062797918</span><span class="p">,</span> <span class="nb">min</span> <span class="n">v_error</span> <span class="p">:</span> <span class="mf">0.0005460083484649658</span><span class="p">,</span> <span class="n">median</span> <span class="n">v_error</span> <span class="p">:</span> <span class="mf">0.002688060514628887</span>
<span class="n">mean</span> <span class="n">p_error</span> <span class="p">:</span> <span class="mf">0.0002289257737010042</span><span class="p">,</span> <span class="nb">max</span> <span class="n">p_error</span> <span class="p">:</span> <span class="mf">0.07013040781021118</span><span class="p">,</span> <span class="n">average</span> <span class="n">p_error</span> <span class="p">:</span> <span class="mf">0.004195113001903247</span><span class="p">,</span> <span class="nb">min</span> <span class="n">p_error</span> <span class="p">:</span> <span class="mf">0.0009379386901855469</span><span class="p">,</span> <span class="n">median</span> <span class="n">p_error</span> <span class="p">:</span> <span class="mf">0.0032533109188079834</span>
<span class="n">mean</span> <span class="n">Cp_error</span> <span class="p">:</span> <span class="mf">0.00023822338209345892</span><span class="p">,</span> <span class="nb">max</span> <span class="n">Cp_error</span> <span class="p">:</span> <span class="mf">0.03613078594207764</span><span class="p">,</span> <span class="n">average</span> <span class="n">Cp_error</span> <span class="p">:</span> <span class="mf">0.0012825747940972535</span><span class="p">,</span> <span class="nb">min</span> <span class="n">Cp_error</span> <span class="p">:</span> <span class="mf">0.0005737543106079102</span><span class="p">,</span> <span class="n">median</span> <span class="n">Cp_error</span> <span class="p">:</span> <span class="mf">0.0008337497711181641</span>
<span class="o">=================================</span><span class="n">End</span> <span class="n">Evaluation</span><span class="o">=================================</span>
</pre></div>
</div>
</section>
<section id="模型推理">
<h3>模型推理<a class="headerlink" href="#模型推理" title="永久链接至标题"></a></h3>
<p>模型训练结束后即可通过load_checkpoint接口读取checkpoint，load_param_into_net函数可以将参数加载到模型中，然后使用<code class="docutils literal notranslate"><span class="pre">inference.py</span></code>进行推理。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">model_name</span> <span class="o">=</span> <span class="n">initial_data_and_model</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<span class="n">param_dict</span> <span class="o">=</span> <span class="n">load_checkpoint</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;load_path&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">opt</span><span class="o">.</span><span class="n">ckpt_dir</span><span class="p">)</span>
<span class="n">load_param_into_net</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">param_dict</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Load pre-trained model successfully&quot;</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">set_train</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">get_uvp_plots</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="结果可视化">
<h3>结果可视化<a class="headerlink" href="#结果可视化" title="永久链接至标题"></a></h3>
<p>翼型几何形状发生改变时，AI和CFD预测的表面压力分布，流场分布及其误差统计如下图所示：</p>
<p><img alt="airfoil.gif" src="../_images/airfoil.gif" /></p>
<p>来流攻角发生改变时，AI和CFD预测的表面压力分布，流场分布及其误差统计如下图所示：</p>
<p><img alt="aoa_var.gif" src="../_images/aoa_var.gif" /></p>
<p>来流马赫数发生改变时，AI和CFD预测的表面压力分布，流场分布及其误差统计如下图所示：</p>
<p><img alt="Ma_var.gif" src="../_images/Ma_var.gif" /></p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../physics_driven/sympy_pde_definition.html" class="btn btn-neutral float-left" title="基于MindFlow定义符号化偏微分方程" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="FNO1D.html" class="btn btn-neutral float-right" title="基于FNO求解一维Burgers" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 MindSpore.</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用了 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a>开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 
</body>
</html>