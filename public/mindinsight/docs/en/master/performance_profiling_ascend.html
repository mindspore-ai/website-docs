<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Performance Profiling (Ascend) &mdash; MindSpore master documentation</title><script>;(()=>{const e=localStorage.getItem("ms-theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;(e?"dark"===e:t)&&document.documentElement.setAttribute("data-o-theme","dark")})();</script><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script><script src="_static/jquery.js"></script>
        <script src="_static/js/theme.js"></script><script src="_static/underscore.js"></script><script src="_static/doctools.js"></script><script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Performance Profiling (GPU)" href="performance_profiling_gpu.html" />
    <link rel="prev" title="Performance Profiling" href="performance_profiling.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> MindSpore
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="mindinsight_install.html">MindSpore Insight Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="summary_record.html">Collecting Summary Record</a></li>
<li class="toctree-l1"><a class="reference internal" href="dashboard.html">Viewing Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="lineage_and_scalars_comparison.html">Viewing Lineage and Scalars Comparison</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="performance_profiling.html">Performance Profiling</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Performance Profiling (Ascend)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#operation-process">Operation Process</a></li>
<li class="toctree-l3"><a class="reference internal" href="#preparing-the-training-script">Preparing the Training Script</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#method-1-modify-the-training-script">Method 1: Modify the training script</a></li>
<li class="toctree-l4"><a class="reference internal" href="#method-2-enable-environment-variables">Method 2: Enable environment variables</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#launch-mindspore-insight">Launch MindSpore Insight</a></li>
<li class="toctree-l3"><a class="reference internal" href="#training-performance">Training Performance</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#step-trace-analysis">Step Trace Analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#operator-performance-analysis">Operator Performance Analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#calculation-quantity-analysis">Calculation quantity analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#data-preparation-performance-analysis">Data Preparation Performance Analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#timeline-analysis">Timeline Analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#timeline-large-model-scenario,-multi-ranks,-multi-graphs,-multi-iterations-analysis">Timeline (Large model scenario, multi-ranks, multi-graphs, multi-iterations) Analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dynamic-shape-iteration-analysis">Dynamic shape iteration analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#msprof-tool-to-assist-analysis">Msprof tool to assist analysis</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#host-side-time-consumption-analysis">Host side time consumption analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#resource-utilization">Resource Utilization</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#cpu-utilization-analysis">CPU Utilization Analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#memory-analysis">Memory Analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#host-side-memory-usage">Host side memory usage</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#offline-analyse">Offline Analyse</a></li>
<li class="toctree-l3"><a class="reference internal" href="#specifications">Specifications</a></li>
<li class="toctree-l3"><a class="reference internal" href="#notices">Notices</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="performance_profiling_gpu.html">Performance Profiling (GPU)</a></li>
<li class="toctree-l2"><a class="reference internal" href="performance_profiling_of_cluster.html">Cluster Performance Profiling</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="debugger.html">Debugger</a></li>
<li class="toctree-l1"><a class="reference internal" href="landscape.html">Training Optimization Process Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindinsight_commands.html">MindSpore Insight Commands</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tuning Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="accuracy_problem_preliminary_location.html">Guide to Locating Accuracy Problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="accuracy_optimization.html">Accuracy Problem Locating and Optimization Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="performance_tuning_guide.html">Performance Tuning Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="performance_optimization.html">Performance Debugging Cases</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="mindinsight.debugger.html">mindinsight.debugger</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="training_visual_design.html">Overall Design of Training Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="graph_visual_design.html">Computational Graph Visualization Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensor_visual_design.html">Tensor Visualization Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="profiler_design.html">Performance Profiling Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">RELEASE NOTES</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="RELEASE.html">Release Notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MindSpore</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="performance_profiling.html">Performance Profiling</a> &raquo;</li>
      <li>Performance Profiling (Ascend)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/performance_profiling_ascend.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="performance-profiling-ascend">
<h1>Performance Profiling (Ascend)<a class="headerlink" href="#performance-profiling-ascend" title="Permalink to this headline"></a></h1>
<a class="reference external image-reference" href="https://gitee.com/mindspore/docs/blob/master/docs/mindinsight/docs/source_en/performance_profiling_ascend.rst"><img alt="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/master/resource/_static/logo_source_en.svg" src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/master/resource/_static/logo_source_en.svg" /></a>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline"></a></h2>
<p>This article describes how to use MindSpore Profiler for performance
debugging on Ascend AI processors.</p>
</section>
<section id="operation-process">
<h2>Operation Process<a class="headerlink" href="#operation-process" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Prepare a training script, add profiler APIs in the training script
and run the training script.</p></li>
<li><p>Start MindSpore Insight and specify the summary-base-dir using startup
parameters, note that summary-base-dir is the parent directory of the
directory created by Profiler. For example, the directory created by
Profiler is <code class="docutils literal notranslate"><span class="pre">/home/user/code/data/</span></code>, the summary-base-dir should be
<code class="docutils literal notranslate"><span class="pre">/home/user/code</span></code>. After MindSpore Insight is started, access the
visualization page based on the IP address and port number. The
default access IP address is <code class="docutils literal notranslate"><span class="pre">http://127.0.0.1:8080</span></code>.</p></li>
<li><p>Find the training in the list, click the performance profiling link
and view the data on the web page.</p></li>
</ul>
</section>
<section id="preparing-the-training-script">
<h2>Preparing the Training Script<a class="headerlink" href="#preparing-the-training-script" title="Permalink to this headline"></a></h2>
<p>There are two ways to collect neural network performance data. You can enable Profiler in either of the following ways.</p>
<section id="method-1-modify-the-training-script">
<h3>Method 1: Modify the training script<a class="headerlink" href="#method-1-modify-the-training-script" title="Permalink to this headline"></a></h3>
<p>Add the MindSpore Profiler interface to the training script.</p>
<ul>
<li><p>Before training, initialize the MindSpore Profiler object, and profiler enables collection of performance data.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The parameters of Profiler are as follows:
<a class="reference external" href="https://www.mindspore.cn/docs/en/master/api_python/mindspore/mindspore.Profiler.html#mindspore.Profiler">Profiler API</a> .
Before initializing the Profiler, you need to determine the device_id.</p>
</div>
</li>
<li><p>At the end of the training, <code class="docutils literal notranslate"><span class="pre">Profiler.analyse()</span></code> should be called to finish profiling and generate the performance analyse results.</p></li>
</ul>
<p>** Conditional open example: **</p>
<p>The user decides not to start the Profiler by setting the initialization parameter start_profile to False, then starts the Profiler at the right time by calling Start, stops collecting data, and finally calls analyse to phase the data.
You can open and close the Profiler based on the epoch or step, and the data within the specified step or epoch interval is collected. There are two ways to collect performance data based on step or epoch, one is through user-defined training,
the other is through Callback based on step or epoch to open and close Profiler.</p>
<ul>
<li><p>Custom training:</p>
<p>The MindSpore functional programming use case uses profilers for custom training by turning Profiler performance data on or off during a specified step interval or epoch interval. <a class="reference external" href="https://gitee.com/mindspore/docs/blob/master/docs/sample_code/mindinsight/profiler/profiling_step.py">Enable Profiler’s complete code sample based on step</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">profiler</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Profiler</span><span class="p">(</span><span class="n">start_profile</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">data_loader</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">create_dict_iterator</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_loader</span><span class="p">):</span>
    <span class="n">train</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">100</span><span class="p">:</span>
        <span class="n">profiler</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">200</span><span class="p">:</span>
        <span class="n">profiler</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

<span class="n">profiler</span><span class="o">.</span><span class="n">analyse</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p>User-defined Callback</p>
<ul>
<li><p>For data non-sink mode, there is only an opportunity to turn on and off CANN at the end of each step, so whether the CANN is turned on or off is based on the step. A custom Callback opens the Profiler’s <a class="reference external" href="https://gitee.com/mindspore/docs/blob/master/docs/sample_code/mindinsight/profiler/profiling_feed_step.py">complete code sample based on step</a> .</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>

<span class="k">class</span> <span class="nc">StopAtStep</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">Callback</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_step</span><span class="p">,</span> <span class="n">stop_step</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">StopAtStep</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_step</span> <span class="o">=</span> <span class="n">start_step</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_step</span> <span class="o">=</span> <span class="n">stop_step</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Profiler</span><span class="p">(</span><span class="n">start_profile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="s1">&#39;./data_step&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">on_train_step_begin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_context</span><span class="p">):</span>
        <span class="n">cb_params</span> <span class="o">=</span> <span class="n">run_context</span><span class="o">.</span><span class="n">original_args</span><span class="p">()</span>
        <span class="n">step_num</span> <span class="o">=</span> <span class="n">cb_params</span><span class="o">.</span><span class="n">cur_step_num</span>
        <span class="k">if</span> <span class="n">step_num</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_step</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">on_train_step_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_context</span><span class="p">):</span>
        <span class="n">cb_params</span> <span class="o">=</span> <span class="n">run_context</span><span class="o">.</span><span class="n">original_args</span><span class="p">()</span>
        <span class="n">step_num</span> <span class="o">=</span> <span class="n">cb_params</span><span class="o">.</span><span class="n">cur_step_num</span>
        <span class="k">if</span> <span class="n">step_num</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_step</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">analyse</span><span class="p">()</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>For data sink mode, CANN is told to start and stop only after the end of each epoch, so it needs to start and stop based on the epoch. The Profiler sample code modification training script can be opened based on step according to a custom Callback.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">StopAtEpoch</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">Callback</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_epoch</span><span class="p">,</span> <span class="n">stop_epoch</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">StopAtEpoch</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_epoch</span> <span class="o">=</span> <span class="n">start_epoch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_epoch</span> <span class="o">=</span> <span class="n">stop_epoch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Profiler</span><span class="p">(</span><span class="n">start_profile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="s1">&#39;./data_epoch&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">on_train_epoch_begin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_context</span><span class="p">):</span>
        <span class="n">cb_params</span> <span class="o">=</span> <span class="n">run_context</span><span class="o">.</span><span class="n">original_args</span><span class="p">()</span>
        <span class="n">epoch_num</span> <span class="o">=</span> <span class="n">cb_params</span><span class="o">.</span><span class="n">cur_epoch_num</span>
        <span class="k">if</span> <span class="n">epoch_num</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_epoch</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">on_train_epoch_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_context</span><span class="p">):</span>
        <span class="n">cb_params</span> <span class="o">=</span> <span class="n">run_context</span><span class="o">.</span><span class="n">original_args</span><span class="p">()</span>
        <span class="n">epoch_num</span> <span class="o">=</span> <span class="n">cb_params</span><span class="o">.</span><span class="n">cur_epoch_num</span>
        <span class="k">if</span> <span class="n">epoch_num</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_epoch</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">analyse</span><span class="p">()</span>
</pre></div>
</div>
</li>
</ul>
<p>** Unconditional Open example: **</p>
<ul>
<li><p>Example 1: In the MindSpore functional Programming use case, Profiler is used to collect performance data. Part of the sample code is shown below.
<a class="reference external" href="https://gitee.com/mindspore/docs/blob/master/docs/sample_code/mindinsight/profiler/profiling_sample.py">Complete code sample</a> .</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Init Profiler.</span>
<span class="c1"># Note that the Profiler should be initialized before model training.</span>
<span class="n">profiler</span> <span class="o">=</span> <span class="n">Profiler</span><span class="p">(</span><span class="n">output_path</span><span class="o">=</span><span class="s2">&quot;profiler_data&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">forward_fn</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
    <span class="n">logits</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="n">loss_fn</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">loss</span><span class="p">,</span> <span class="n">logits</span>


<span class="c1"># Get gradient function</span>
<span class="n">grad_fn</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">value_and_grad</span><span class="p">(</span><span class="n">forward_fn</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span> <span class="n">has_aux</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="nd">@ms</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">train_step</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define function of one-step training&quot;&quot;&quot;</span>
    <span class="p">(</span><span class="n">loss</span><span class="p">,</span> <span class="n">_</span><span class="p">),</span> <span class="n">grads</span> <span class="o">=</span> <span class="n">grad_fn</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
    <span class="n">optimizer</span><span class="p">(</span><span class="n">grads</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">loss</span>


<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epochs</span><span class="p">):</span>
    <span class="n">train_loop</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_dataset</span><span class="p">,</span> <span class="n">loss_fn</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">)</span>

<span class="n">profiler</span><span class="o">.</span><span class="n">analyse</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p>Example 2: model.train is used for network training. The complete code is as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">nn</span>
<span class="kn">from</span> <span class="nn">mindspore.train</span> <span class="kn">import</span> <span class="n">Model</span>
<span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">import</span> <span class="nn">mindspore.dataset</span> <span class="k">as</span> <span class="nn">ds</span>

<span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Net</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">generator</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
        <span class="k">yield</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="n">net</span><span class="p">):</span>
    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Momentum</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">trainable_params</span><span class="p">(),</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">)</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">SoftmaxCrossEntropyWithLogits</span><span class="p">(</span><span class="n">sparse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">GeneratorDataset</span><span class="p">(</span><span class="n">generator</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">])</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">loss</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">ms</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">GRAPH_MODE</span><span class="p">,</span> <span class="n">device_target</span><span class="o">=</span><span class="s2">&quot;Ascend&quot;</span><span class="p">)</span>

    <span class="c1"># Init Profiler</span>
    <span class="c1"># Note that the Profiler should be initialized before model.train</span>
    <span class="n">profiler</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Profiler</span><span class="p">(</span><span class="n">output_path</span><span class="o">=</span><span class="s1">&#39;./profiler_data&#39;</span><span class="p">)</span>

    <span class="c1"># Train Model</span>
    <span class="n">net</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
    <span class="n">train</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>

    <span class="c1"># Profiler end</span>
    <span class="n">profiler</span><span class="o">.</span><span class="n">analyse</span><span class="p">()</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="method-2-enable-environment-variables">
<h3>Method 2: Enable environment variables<a class="headerlink" href="#method-2-enable-environment-variables" title="Permalink to this headline"></a></h3>
<p>Before running the network script, configure Profiler configuration items.</p>
<p>Note：</p>
<ul class="simple">
<li><p>This feature does not yet support the Ascend 910B chip scenario. Stay tuned.</p></li>
<li><p>To enable using environment variables, please set the device ID through the environment variables before the script starts executing. Prohibit using the set_context function to set the device ID in the script.</p></li>
</ul>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">MS_PROFILER_OPTIONS</span><span class="o">=</span><span class="s1">&#39;{&quot;start&quot;: true, &quot;output_path&quot;: &quot;/XXX&quot;, &quot;profile_memory&quot;: false, &quot;profile_communication&quot;: false, &quot;aicore_metrics&quot;: 0, &quot;l2_cache&quot;: false}&#39;</span>
</pre></div>
</div>
<ul class="simple">
<li><p><cite>start</cite> (bool, mandatory) - Set to true to enable Profiler. Set false to disable performance data collection. Default value: false.</p></li>
<li><p><cite>output_path</cite> (str, optional) - Represents the path (absolute path) of the output data. Default value： “./data”.</p></li>
<li><p><cite>op_time</cite> (bool, optional) - Indicates whether to collect operators performance data. Default values: true.</p></li>
<li><p><cite>profile_memory</cite> (bool, optional) - Tensor data will be collected. This data is collected when the value is true. When using this parameter, <cite>op_time</cite> must be set to true. Default value: false.</p></li>
<li><p><cite>profile_communication</cite> (bool, optional) - Indicates whether to collect communication performance data in multi-device training. This data is collected when the value is true. In single-device training, this parameter is not set correctly. When using this parameter, <cite>op_time</cite> must be set to true. Default value: false.</p></li>
<li><p><cite>aicore_metrics</cite> (int, optional) - Set the indicator type of AI Core. When using this parameter, <cite>op_time</cite> must be set to true. Default value: 0.</p></li>
<li><p><cite>l2_cache</cite> (bool, optional) - Set whether to collect l2 cache data. Default value: false.</p></li>
<li><p><cite>timeline_limit</cite> (int, optional) - Set the maximum storage size of the timeline file (unit M). When using this parameter, <cite>op_time</cite> must be set to true. Default value: 500.</p></li>
<li><p><cite>data_process</cite> (bool, optional) - Indicates whether to collect data to prepare performance data. Default value: true.</p></li>
<li><p><cite>parallel_strategy</cite> (bool, optional) - Indicates whether to collect parallel policy performance data. Default value: true.</p></li>
<li><p><cite>profile_framework</cite> (str, optional) - Whether to collect host memory and time, it must be one of [“all”, “time”, “memory”, null]. Default: “all”.</p></li>
</ul>
</section>
</section>
<section id="launch-mindspore-insight">
<h2>Launch MindSpore Insight<a class="headerlink" href="#launch-mindspore-insight" title="Permalink to this headline"></a></h2>
<p>The MindSpore Insight launch command can refer to <a class="reference external" href="https://www.mindspore.cn/mindinsight/docs/en/master/mindinsight_commands.html">MindSpore Insight
Commands</a>.</p>
</section>
<section id="training-performance">
<h2>Training Performance<a class="headerlink" href="#training-performance" title="Permalink to this headline"></a></h2>
<p>Users can access the Training Performance by selecting a specific
training from the training list, and click the performance profiling
link.</p>
<figure class="align-default">
<img alt="performance_overall.png" src="_images/performance_overall.png" />
</figure>
<p><em>Figure:Overall Performance</em></p>
<p>Figure above displays the overall performance of the training, including the
overall data of Step Trace, Operator Performance, Data Preparation
Performance and Timeline. The data shown in these components include:</p>
<ul class="simple">
<li><p>Step Trace: It will divide the training steps into several stages and
collect execution time for each stage. The overall performance page
will show the step trace graph.</p></li>
<li><p>Operator Performance: It will collect the execution time of operators
and operator types. The overall performance page will show the pie
graph for different operator types.</p></li>
<li><p>Data Preparation Performance: It will analyse the performance of the
data input stages. The overall performance page will show the number
of steps that may be the bottleneck for these stages.</p></li>
<li><p>Timeline: It will collect execution time for stream tasks on the
devices. The tasks will be shown on the time axis. The overall
performance page will show the statistics for streams and tasks.</p></li>
</ul>
<p>Users can click the detail link to see the details of each components.
Besides, MindSpore Insight Profiler will try to analyse the performance data,
the assistant on the left will show performance tuning suggestions for
this training.</p>
<section id="step-trace-analysis">
<h3>Step Trace Analysis<a class="headerlink" href="#step-trace-analysis" title="Permalink to this headline"></a></h3>
<div class="line-block">
<div class="line">The Step Trace Component is used to show the general performance of
the stages in the training. Step Trace will divide the training into
several stages:</div>
<div class="line">Step Gap (The time between the end of one step and the computation of
next step), Forward/Backward Propagation, All Reduce and Parameter
Update. It will show the execution time for each stage, and help to
find the bottleneck stage quickly.</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Step trace analysis only supports single-graph scenarios in Graph mode, and does not support scenarios such as pynative, heterogeneous, and multi-subgraphs.</p>
</div>
<figure class="align-default">
<img alt="step_trace.png" src="_images/step_trace.png" />
</figure>
<p><em>Figure:Step Trace Analysis</em></p>
<p>Figure above displays the Step Trace page. The Step Trace detail will show
the start/finish time for each stage. By default, it shows the average
time for all the steps. Users can also choose a specific step to see its
step trace statistics.</p>
<p>The graphs at the bottom of the page show the execution time of Step
Interval, Forward/Backward Propagation and Step Tail (The time between
the end of Backward Propagation and the end of Parameter Update) changes
according to different steps, it will help to decide whether we can
optimize the performance of some stages. Here are more details:</p>
<ul class="simple">
<li><p><strong>Step Interval</strong> is the duration for reading data from data queues.
If this part takes long time, it is advised to check the data
preparation for further analysis.</p></li>
<li><p><strong>Forward and Backward Propagation</strong> is the duration for executing
the forward and backward operations on the network, which handle the
main calculation work of a step. If this part takes long time, it is
advised to check the statistics of operators or timeline for further
analysis.</p></li>
<li><p><strong>Step Tail</strong> is the duration for performing parameter aggregation
and update operations in parallel training. If the operation takes
long time, it is advised to check the statistics of communication
operators and the status of parallelism.</p></li>
</ul>
<p>In order to divide the stages, the Step Trace Component need to figure
out the forward propagation start operator and the backward propagation
end operator. MindSpore will automatically figure out the two operators
to reduce the profiler configuration work. The first operator after
<code class="docutils literal notranslate"><span class="pre">get_next</span></code> will be selected as the forward start operator and the
operator before the last all reduce will be selected as the backward end
operator. <strong>However, Profiler do not guarantee that the automatically
selected operators will meet the user’s expectation in all cases.</strong>
Users can set the two operators manually as follows:</p>
<ul class="simple">
<li><p>Set environment variable <code class="docutils literal notranslate"><span class="pre">PROFILING_FP_START</span></code> to configure the
forward start operator, for example,
<code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">PROFILING_FP_START=fp32_vars/conv2d/BatchNorm</span></code>.</p></li>
<li><p>Set environment variable <code class="docutils literal notranslate"><span class="pre">PROFILING_BP_END</span></code> to configure the
backward end operator, for example,
<code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">PROFILING_BP_END=loss_scale/gradients/AddN_70</span></code>.</p></li>
</ul>
</section>
<section id="operator-performance-analysis">
<h3>Operator Performance Analysis<a class="headerlink" href="#operator-performance-analysis" title="Permalink to this headline"></a></h3>
<p>The operator performance analysis component is used to display the
execution time of the operators(AICORE/AICPU/HOSTCPU) during MindSpore
run.</p>
<ul class="simple">
<li><p>AICORE：AI Core operator is the main component of the computing core
of Ascend AI processor, which is responsible for executing vector and
tensor related computation intensive operators. TBE (Tensor Boost
Engine) is an extended operator development tool based on TVM (Tensor
Virtual Machine) framework. Users can use TBE to register AI Core
operator information.</p></li>
<li><p>AICPU：AI CPU operator is a kind of CPU operator (including control
operator, scalar, vector and other general-purpose calculations) that
AI CPU is responsible for executing Hisilicon SOC in Ascend
processor. The same operator in MindSpore may have AI Core operator
and AI CPU operator at the same time. The framework will give
priority to AI Core operator. If there is no AI Core operator or the
selection is not satisfied, AI CPU operator will be called.</p></li>
<li><p>HOSTCPU：The host side CPU is mainly responsible for distributing the
graph or operator to Ascend chip, and the operator can also be
developed on the host side CPU according to the actual needs. The
host CPU operator refers to the operator running on the host side
CPU.</p></li>
</ul>
<figure class="align-default">
<img alt="op_type_statistics.png" src="_images/op_type_statistics.png" />
</figure>
<p><em>Figure:Statistics for Operator Types</em></p>
<p>Figure above displays the statistics for the operator types, including:</p>
<ul class="simple">
<li><p>Choose pie or bar graph to show the proportion time occupied by each
operator type. The time of one operator type is calculated by
accumulating the execution time of operators belonging to this type.</p></li>
<li><p>Display top 20 operator types with the longest execution time, show
the proportion and execution time (us) of each operator type.</p></li>
</ul>
<figure class="align-default">
<img alt="op_statistics.png" src="_images/op_statistics.png" />
</figure>
<p><em>Figure:Statistics for Operators</em></p>
<p>Figure above displays the statistics table for the operators, including:</p>
<ul class="simple">
<li><p>Choose All: Display statistics for the operators, including operator
name, type, average execution time, execution frequency, full scope time, information, etc.
The table will be sorted by execution time by default.</p></li>
<li><p>Choose Type: Display statistics for the operator types, including
operator type name, execution time, execution frequency and
proportion of total time. Users can click on each line, querying for
all the operators belonging to this type.</p></li>
<li><p>Search: There is a search box on the right, which can support fuzzy
search for operators/operator types.</p></li>
</ul>
<p>Statistics for the information related to calculation quantity of AICORE
operator, including operator level and model level information.</p>
</section>
<section id="calculation-quantity-analysis">
<h3>Calculation quantity analysis<a class="headerlink" href="#calculation-quantity-analysis" title="Permalink to this headline"></a></h3>
<p>The Calculation Quantity Analysis module shows the actual calculation
quantity data, including calculation quantity data for operator
granularity and model granularity. The actual
calculation quantity refers to the amount of calculation that is running
on the device, which is different from the theoretical calculation
quantity. For example, the matrix computing unit on the Ascend910 device
is dealing with a matrix of 16x16 size, so in the runtime, the original
matrix will be padded to 16x16. Only calculation quantity on AICORE
devices is supported currently. The information about calculation
quantity has four indicators:</p>
<ul class="simple">
<li><p>FLOPs(cube): the number of cube floating point operations (the unit is
million).</p></li>
<li><p>FLOPS(cube): the number of cube floating point operations per second (the unit
is billion).</p></li>
<li><p>FLOPs(vec): the number of vector floating point operations (the unit is
million).</p></li>
<li><p>FLOPS(vec): the number of vector floating point operations per second (the unit
is billion).</p></li>
</ul>
<figure class="align-default">
<img alt="flops_statistics.png" src="_images/flops-single-card.png" />
</figure>
<p><em>Figure:Calculation Quantity Analysis</em></p>
<p>The red box in figure above includes calculation quantity data on operator
granularity and model granularity.</p>
</section>
<section id="data-preparation-performance-analysis">
<h3>Data Preparation Performance Analysis<a class="headerlink" href="#data-preparation-performance-analysis" title="Permalink to this headline"></a></h3>
<div class="line-block">
<div class="line">The Data preparation performance analysis component is used to analyse
the execution of data input pipeline for the training. The data input
pipeline can be divided into three stages:</div>
<div class="line">the data process pipeline, data transfer from host to device and data
fetch on device. The component will analyse the performance of each
stage in detail and display the results.</div>
</div>
<figure class="align-default">
<img alt="minddata_profile.png" src="_images/minddata_profile.png" />
</figure>
<p><em>Figure:Data Preparation Performance Analysis</em></p>
<p>Figure above displays the page of data preparation performance analysis
component. It consists of two tabs: the step gap and the data process.</p>
<p>The step gap page is used to analyse whether there is performance
bottleneck in the three stages. We can get our conclusion from the data
queue graphs:</p>
<ul class="simple">
<li><p>The data queue size stands for the queue length when the training
fetches data from the queue on the device. If the data queue size is
0, the training will wait until there is data in the queue; If the
data queue size is greater than 0, the training can get data very
quickly, and it means data preparation stage is not the bottleneck
for this training step.</p></li>
<li><p>The host queue size can be used to infer the speed of data process
and data transfer. If the host queue size is 0, it means we need to
speed up the data process stage.</p></li>
<li><p>If the size of the host queue is always large and the size of the
data queue is continuously small, there may be a performance
bottleneck in data transfer.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The queue size is the value recorded when fetching data, and obtaining the data
of host queue and data queue is executed asynchronously, so the number of host
queue steps, data queue steps, and user training steps may be different.</p>
</div>
<figure class="align-default">
<img alt="data_op_profile.png" src="_images/data_op_profile.png" />
</figure>
<p><em>Figure:Data Process Pipeline Analysis</em></p>
<p>Figure above displays the page of data process pipeline analysis. The data
queues are used to exchange data between the data processing operations.
The data size of the queues reflect the data consume speed of the
operations, and can be used to infer the bottleneck operation. The queue
usage percentage stands for the average value of data size in queue
divide data queue maximum size, the higher the usage percentage, the
more data that is accumulated in the queue. The graph at the bottom of
the page shows the data processing pipeline operations with the data
queues, the user can click one queue to see how the data size changes
according to the time, and the operations connected to the queue. The
data process pipeline can be analysed as follows:</p>
<ul class="simple">
<li><p>When the input queue usage percentage of one operation is high, and
the output queue usage percentage is low, the operation may be the
bottleneck.</p></li>
<li><p>For the leftmost operation, if the usage percentage of all the queues
on the right are low, the operation may be the bottleneck.</p></li>
<li><p>For the rightmost operation, if the usage percentage of all the queues
on the left are high, the operation may be the bottleneck.</p></li>
</ul>
<p>To optimize the performance of data processing operations, there are some
suggestions:</p>
<ul class="simple">
<li><p>If the Dataset Loading Operation is the bottleneck, try to increase the
<code class="docutils literal notranslate"><span class="pre">num_parallel_workers</span></code>.</p></li>
<li><p>If the GeneratorOp Operation is the bottleneck, try to increase the
<code class="docutils literal notranslate"><span class="pre">num_parallel_workers</span></code> or try to replace it with
<code class="docutils literal notranslate"><span class="pre">MindRecordDataset</span></code>.</p></li>
<li><p>If the MapOp Operation is the bottleneck, try to increase the
<code class="docutils literal notranslate"><span class="pre">num_parallel_workers</span></code>. If it maps a Python operation, try to optimize
the training script.</p></li>
<li><p>If the BatchOp Operation is the bottleneck, try to adjust the size
of <code class="docutils literal notranslate"><span class="pre">prefetch_size</span></code>.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To obtain data to prepare performance data, using the module of MindSpore Dataset to define data process pipeline.</p>
</div>
</section>
<section id="timeline-analysis">
<h3>Timeline Analysis<a class="headerlink" href="#timeline-analysis" title="Permalink to this headline"></a></h3>
<p>The Timeline component can display:</p>
<ul class="simple">
<li><p>The operators (AICORE/AICPU/HOSTCPU operators) are executed on which
device.</p></li>
<li><p>The MindSpore stream split strategy for this neural network.</p></li>
<li><p>The execution sequence and execution time of the operator on the
device.</p></li>
<li><p>The step number of training (Currently dynamic shape scene,
multi-graph scene and heterogeneous training scene are not supported,
steps data may be inaccurate in these scene.).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Scope</span> <span class="pre">Name</span></code> of the operator, the number of each operator’s
<code class="docutils literal notranslate"><span class="pre">Scope</span> <span class="pre">Name</span></code> could be selected and download corresponding timeline
file. For example, the full name of one operator is
<code class="docutils literal notranslate"><span class="pre">Default/network/lenet5/Conv2D-op11</span></code>, thus the first <code class="docutils literal notranslate"><span class="pre">Scope</span> <span class="pre">Name</span></code>
of this operator is <code class="docutils literal notranslate"><span class="pre">Default</span></code>, the second <code class="docutils literal notranslate"><span class="pre">Scope</span> <span class="pre">Name</span></code> is
<code class="docutils literal notranslate"><span class="pre">network</span></code>. If two <code class="docutils literal notranslate"><span class="pre">Scope</span> <span class="pre">Name</span></code> for each operator is selected,
then the <code class="docutils literal notranslate"><span class="pre">Default</span></code> and <code class="docutils literal notranslate"><span class="pre">network</span></code> will be displayed.</p></li>
</ul>
<p>Users can get the most detailed information from the Timeline:</p>
<ul class="simple">
<li><p>From the High level, users can analyse whether the stream split
strategy can be optimized and whether the step tail is too long.</p></li>
<li><p>From the Low level, users can analyse the execution time for all the
operators, etc.</p></li>
</ul>
<p>Users can click the download button on the overall performance page to
view Timeline details. The Timeline data file (json format) will be
stored on local machine, and can be displayed by tools. We suggest to
use <code class="docutils literal notranslate"><span class="pre">chrome://tracing</span></code> or
<a class="reference external" href="https://ui.perfetto.dev/#!viewer">Perfetto</a> to visualize the
Timeline.</p>
<ul class="simple">
<li><p>Chrome tracing: Click “load” on the upper left to load the file.</p></li>
<li><p>Perfetto: Click “Open trace file” on the left to load the file.</p></li>
</ul>
<figure class="align-default">
<img alt="timeline.png" src="_images/timeline.png" />
</figure>
<p><em>Figure:Timeline Analysis</em></p>
<p>The Timeline consists of the following parts:</p>
<ul>
<li><p>Device and Stream List: It will show the stream list on each device.
Each stream consists of a series of tasks. One rectangle stands for
one task, and the area stands for the execution time of the task.</p>
<p>Each color block represents the starting time and length of operator
execution. The detailed explanation of timeline is as follows:</p>
<ul class="simple">
<li><p>Process Device ID: contains the timeline of operators executed on
AI Core.</p>
<ul>
<li><p>Step: the number of training steps.</p></li>
<li><p>Scope Name: the Scope Name of operators.</p></li>
<li><p>Stream #ID: operators executed on the stream.</p></li>
</ul>
</li>
<li><p>Process AI CPU Op: the timeline of operators executed on the AI
CPU.</p></li>
<li><p>Process Communication Op: the timeline for the execution of
communication operators.</p></li>
<li><p>Process Host CPU Op: contains the timeline of operators executed
on the Host CPU.</p></li>
<li><p>Process Op Overlap Analyse: the timeline of all computation
operators and communication operators merged, it can be used to
analyse the proportion of communication time.</p>
<ul>
<li><p>Merged Computation Op: it is the timeline after all computation
operators are merged.</p></li>
<li><p>Merged Communication Op: it is the timeline after all
communication operators are merged.</p></li>
<li><p>Pure Communication Op: pure communication time (the timeline of
the communication operator after removing the overlap with the
computation operator time).</p></li>
<li><p>Free Time: there is no communication operator and calculation
operator in the execution timeline.</p></li>
</ul>
</li>
</ul>
</li>
<li><p>The Operator Information: When we click one task, the corresponding
operator of this task will be shown at the bottom.</p></li>
</ul>
<p>W/A/S/D can be applied to zoom in and out of the Timeline graph.</p>
</section>
<section id="timeline-large-model-scenario,-multi-ranks,-multi-graphs,-multi-iterations-analysis">
<h3>Timeline (Large model scenario, multi-ranks, multi-graphs, multi-iterations) Analysis<a class="headerlink" href="#timeline-large-model-scenario,-multi-ranks,-multi-graphs,-multi-iterations-analysis" title="Permalink to this headline"></a></h3>
<p>Timeline Features:</p>
<ul class="simple">
<li><p>This feature is designed for the comparison and analysis of large model scenarios with multiple cards, iterations,
and graphs.</p></li>
<li><p>Inspired by Nsight, it was first proposed to split data into two parts: summary and detail.
The summary is positioned to showcase the overall execution of the model, while the detail is positioned
to showcase the API level execution of the network.</p></li>
<li><p>The summary data include: step trace, overlap analysis of communication and computation;
The detail data include: except for summary data, the execution order of calculation operators
and communication operators.</p></li>
<li><p>Support filtering and merging data based on card number (rank id).</p></li>
<li><p>Support filtering and merging data based on multiple graphs (graph id).</p></li>
</ul>
<p>How to view the timeline:</p>
<ol class="arabic">
<li><p>Click on the download button in the Timeline section of the overview page,
download the timeline data(json format) locally.</p>
<figure class="align-default">
<img alt="timeline_option.png" src="_images/timeline_option.png" />
</figure>
<p><em>Figure：Timeline download page</em></p>
<p>As shown in the figure above:</p>
<ul class="simple">
<li><p>ranks: used for filtering and merging, default to all.</p></li>
<li><p>subgraphs: used for filtering subgraphs, default to all.</p></li>
<li><p>data kind: choice summary or detail, default to summary.</p></li>
<li><p>merge multiple subgraphs: whether to merge the iteration trajectory data of multiple subgraphs.</p></li>
</ul>
</li>
<li><p>Open <a class="reference external" href="https://ui.perfetto.dev/">perfetto</a> website, drag the downloaded timeline data onto the
page to complete the display.</p>
<figure class="align-default">
<img alt="timeline_detail.png" src="_images/timeline_detail.png" />
</figure>
<p><em>Figure：Timeline（2 ranks）Analysis</em></p>
<p>As shown in the figure above:</p>
<ul class="simple">
<li><p>Step Trace: Display the forward and backward time and iteration trailing time
of each iteration according to the dimension of graph and iteration.</p></li>
<li><p>Overlap Analysis: Including total network computing time, communication time,
communication time not covered by computation, and card idle time.</p></li>
<li><p>Ascend Hardware: Display the execution order of device side calculation operators and communication
operators according to the stream.</p></li>
<li><p>HCCL: Display the execution order of communication operators according to the plane.</p></li>
</ul>
</li>
</ol>
<p>Recommended usage of perfetto:</p>
<ul class="simple">
<li><p>W/A/S/D can be applied to zoom in and out of the Timeline graph.</p></li>
<li><p>Select any event block, can view the detailed information of this block in the pop-up details bar below.</p></li>
<li><p>Mouse over multiple event blocks, can compare and analyze the execution time of multiple event blocks
in the pop-up details bar below.</p></li>
</ul>
<p>How to use timeline to solve practical problems：</p>
<ol class="arabic simple">
<li><p>Firstly, we recommend filtering and download summary data containing all ranks and graphs,
Identify performance bottlenecks based on overall network execution to avoid premature optimization.</p></li>
<li><p>Then, by filtering and downloading detailed data for certain ranks and graphs,
further identify performance bottlenecks at the API level and identify optimization points.</p></li>
<li><p>After optimizing the code, repeat the step 1 and 2 above until the performance meets the requirements.</p></li>
</ol>
</section>
<section id="dynamic-shape-iteration-analysis">
<h3>Dynamic shape iteration analysis<a class="headerlink" href="#dynamic-shape-iteration-analysis" title="Permalink to this headline"></a></h3>
<p>When the training network is a dynamic shape network, the execution time of each operator (including AICPU operator and AICORE operator) during the operation of MindSpore can be statistically displayed by using the operator time-consuming (by iteration) component. It can quickly understand the time fluctuation of each operator in each iteration of training and the shape information of the operator in different iterations.</p>
<figure class="align-default">
<img alt="dynamic_shape_summary.png" src="_images/dynamic_shape_summary.png" />
</figure>
<p><em>Figure: statistics of operator time (by iteration)</em></p>
<p>The figure above shows the analysis details of iteration time of different types of operators. You can view the iteration time curve of the specified operator type by filtering the specified operator type (the time shown here is the average time of the execution of different operator types).</p>
<figure class="align-default">
<img alt="dynamic_shape_detail.png" src="_images/dynamic_shape_detail.png" />
</figure>
<p><em>Figure: statistics of operator time-consuming details (by iteration)</em></p>
<p>The figure above shows the analysis details of iteration time of different operator instances. By filtering the specified operator name, the iteration time curve of the specified operator instance can be viewed.</p>
<figure class="align-default">
<img alt="dynamic_shape_info.png" src="_images/dynamic_shape_info.png" />
</figure>
<p><em>Figure: Shape information of operator (by iteration)</em></p>
<p>The figure above shows the shape information of the operator of a specific step. Click the corresponding point of the curve to check the shape information of the specified operator instance.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Dynamic Shape network currently only supports the function modules of operator time (by iteration), operator time statistics ranking, data preparation, timeline, CPU utilization and parallel strategy, but does not support the functions of step trace, memory usage and cluster communication.</p>
</div>
</section>
<section id="msprof-tool-to-assist-analysis">
<h3>Msprof tool to assist analysis<a class="headerlink" href="#msprof-tool-to-assist-analysis" title="Permalink to this headline"></a></h3>
<p>Users can collect detailed data of AI Core through profiler, and then analyze and view them through Msprof tool.</p>
<p>The sample code is as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">profiler</span> <span class="o">=</span> <span class="n">Profiler</span><span class="p">(</span><span class="n">output_path</span><span class="o">=</span><span class="s1">&#39;./data&#39;</span><span class="p">,</span> <span class="n">aicore_metrics</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">l2_cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>aicore_metrics is used to set the AI Core metric type, and l2_cache is used to set whether to collect l2 cache data. For parameter details, please refer to the API documentation.</p>
<p>MindSpore Profiler supports the collection of network performance data through the Msprof command line. For details about how to use the Msprof tool to collect and parse network performance data, please refer to the <code class="docutils literal notranslate"><span class="pre">Profiling</span> <span class="pre">Instructions</span> <span class="pre">(Training)</span></code> chapter of the <a class="reference external" href="https://support.huawei.com/enterprise/zh/doc/EDOC1100234052/2c2140b0">CANN Development Tools Guide</a> document.</p>
</section>
</section>
<section id="host-side-time-consumption-analysis">
<h2>Host side time consumption analysis<a class="headerlink" href="#host-side-time-consumption-analysis" title="Permalink to this headline"></a></h2>
<p>If the Host side time collection function is enabled, the Host side time-consuming of each stage can be saved in the specified directory after the training is completed. For example, when a Profiler is specified with <code class="docutils literal notranslate"><span class="pre">output_</span> <span class="pre">Path=&quot;/XXX/profiler_output&quot;</span></code> , the file containing time consumption data on the Host side will be saved in the “/XXX/profiler_output/profile/host_info” directory. The file is in json format and with the prefix <code class="docutils literal notranslate"><span class="pre">&quot;timeline_&quot;</span></code>, and suffix rank_id. The host side time-consuming file can be viewed by `` chrome://tracing `` . You can use W/S/A/D to zoom in, out, move left, and right to view time consuming information.</p>
</section>
<section id="resource-utilization">
<h2>Resource Utilization<a class="headerlink" href="#resource-utilization" title="Permalink to this headline"></a></h2>
<p>Resource utilization includes cpu usage analysis and memory usage
analysis.</p>
<figure class="align-default">
<img alt="resource_visibility.png" src="_images/resource_visibility.png" />
</figure>
<p><em>Figure:Overview of resource utilization</em></p>
<p>Overview of resource utilization：Including CPU utilization analysis and
memory usage analysis. You can view the details by clicking the View
Details button in the upper right corner.</p>
<section id="cpu-utilization-analysis">
<h3>CPU Utilization Analysis<a class="headerlink" href="#cpu-utilization-analysis" title="Permalink to this headline"></a></h3>
<p>CPU utilization, which is mainly used to assist performance debugging.
After the performance bottleneck is determined according to the queue
size, the performance can be debugged according to the CPU utilization
(if the user utilization is too low, increase the number of threads; if
the system utilization is too high, decrease the number of threads). CPU
utilization includes CPU utilization of the whole machine, process and
Data pipeline operation.</p>
<figure class="align-default">
<img alt="device_utilization.png" src="_images/device_cpu_utilization.png" />
</figure>
<p><em>Figure:CPU utilization of the whole machine</em></p>
<p>CPU utilization of the whole machine: Show the overall CPU usage of the
device in the training process, including user utilization, system
utilization, idle utilization, IO utilization, current number of active
processes, and context switching times. If the user utilization is low,
you can try to increase the number of operation threads to increase the
CPU utilization; if the system utilization is high, and the number of
context switching and CPU waiting for processing is large, it indicates
that the number of threads needs to be reduced accordingly.</p>
<figure class="align-default">
<img alt="process_cpu_utilization.png" src="_images/process_cpu_utilizaton.png" />
</figure>
<p><em>Figure:Process utilization</em></p>
<p>Process utilization: Show the CPU usage of a single process. The
combination of whole machine utilization and process utilization can
determine whether other processes affect the training process.</p>
<figure class="align-default">
<img alt="data_op_utilization.png" src="_images/data_op_utilization.png" />
</figure>
<p><em>Figure:Operator utilization</em></p>
<p>Operator utilization: Show the CPU utilization of Data pipeline single
operation. We can adjust the number of threads of the corresponding
operation according to the actual situation. If the number of threads is
small and takes up a lot of CPU, you can consider whether you need to
optimize the code.</p>
<p>Common scenarios of CPU utilization:</p>
<ul class="simple">
<li><p>According to the queue size, the network debugging personnel can
judge that the performance of MindData has a bottleneck. They can
adjust the number of threads by combining the utilization rate of the
whole machine and the utilization rate of the operator.</p></li>
<li><p>Developers can check the utilization of operators. If an operation
consumes CPU utilization, they can confirm whether the code needs to
be optimized.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The default sampling interval is 1000ms. You can change the sampling
interval through
<code class="docutils literal notranslate"><span class="pre">mindspore.dataset.config.get_monitor_sampling_interval()</span></code>. For
details：</p>
<p><a class="reference external" href="https://mindspore.cn/docs/en/master/api_python/dataset/mindspore.dataset.config.set_monitor_sampling_interval.html#mindspore.dataset.config.set_monitor_sampling_interval">dataset API sampling interval</a> .</p>
</div>
</section>
<section id="memory-analysis">
<h3>Memory Analysis<a class="headerlink" href="#memory-analysis" title="Permalink to this headline"></a></h3>
<p>This page is used to show the memory usage of the neural network model
on the <strong>device</strong>, which is an <strong>ideal prediction</strong> based on the
theoretical calculation results. The content of the page includes:</p>
<ul class="simple">
<li><p>An overview of the memory usage of the model, including the total
available memory, peak memory and other information.</p></li>
<li><p>The memory occupied varies in the execution order while the model is
running.</p></li>
<li><p>The memory usage of each operator is decomposed and displayed in the
table of <code class="docutils literal notranslate"><span class="pre">Operator</span> <span class="pre">Memory</span> <span class="pre">Allocation</span></code>.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Memory Analysis does not support heterogeneous training currently.</p>
</div>
<figure class="align-default">
<img alt="memory.png" src="_images/memory.png" />
</figure>
<p><em>Figure:Memory Analysis</em></p>
<p>Users can obtain the summary of memory usage via the
<code class="docutils literal notranslate"><span class="pre">Memory</span> <span class="pre">Allocation</span> <span class="pre">Overview</span></code>. In addition, they can obtain more
detailed information from <code class="docutils literal notranslate"><span class="pre">Memory</span> <span class="pre">Usage</span></code>, including:</p>
<ul class="simple">
<li><p><strong>Line Chart</strong>: Changes in model memory usage, including static
memory, total occupied memory and total available memory.</p></li>
<li><p><strong>Zooming</strong>: There is a zoom scroll bar under the line chart. Users
can zoom in or out the line chart by adjusting its size to observe
more details.</p></li>
<li><p><strong>FP/BP</strong>: The execution positions of the start of
<code class="docutils literal notranslate"><span class="pre">Forward</span> <span class="pre">Propagation</span></code> and the end of <code class="docutils literal notranslate"><span class="pre">Backward</span> <span class="pre">Propagation</span></code> of
the model on the line chart.</p></li>
<li><p><strong>Details of Nodes</strong>: Hovering over the line chart, the information
of the corresponding execution operator is shown, including the
execution order of the operator, the name of the operator, the memory
occupied by the operator, the total memory occupied by the model in
the current position, and the relative memory change compared with
the previous execution position.</p></li>
<li><p><strong>Memory Decomposition</strong>: Left clicking a position on the line chart,
the memory breakdowns of the execution position is shown in the table
below the line chart, called <code class="docutils literal notranslate"><span class="pre">Operator</span> <span class="pre">Memory</span> <span class="pre">Allocation</span></code>. The
table shows the memory decomposition of the corresponding execution
position, i.e., the output tensor of which operators are allocated
the occupied memory of the current execution position. The module
provides users with abundant information, including tensor name,
tensor size, tensor type, data type, shape, format, and the active
lifetime of tensor memory.</p></li>
</ul>
<figure class="align-default">
<img alt="memory_graphics.png" src="_images/memory_graphics.png" />
</figure>
<p><em>Figure:Memory Statistics</em></p>
</section>
<section id="host-side-memory-usage">
<h3>Host side memory usage<a class="headerlink" href="#host-side-memory-usage" title="Permalink to this headline"></a></h3>
<p>If the host side memory collection function is enabled, the memory usage can be saved in the specified directory after the training is completed. For example, when a Profiler is specified with <code class="docutils literal notranslate"><span class="pre">output_</span> <span class="pre">Path=&quot;/XXX/profiler_output&quot;</span></code> , the file containing host side memory data will be saved in the “/XXX/profiler_output/profile/host_info” directory. The file is in csv format and with prefix <code class="docutils literal notranslate"><span class="pre">&quot;host_memory_&quot;</span></code> and suffix rank_id. The meaning of the header is as follows:</p>
<ul class="simple">
<li><p>tid: The thread ID of the current thread when collecting host side memory.</p></li>
<li><p>pid: The process ID of the current process when collecting host side memory.</p></li>
<li><p>parent_pid: The process ID of the current process’s Parent process when collecting the host side memory.</p></li>
<li><p>module_name: Name of the module that collects host side memory, one or more event may be included in a module.</p></li>
<li><p>event: The event name which collected the host side memory, one or more stage may be included in a event.</p></li>
<li><p>stage: The stage name which collected the host side memory.</p></li>
<li><p>level: 0 means used by framework developers, and 1 means used by users(algorithm engineers).</p></li>
<li><p>start_end: The mark for the start or end of the stage, where 0 represents the start mark, 1 represents the end mark, and 2 represents an indistinguishable start or end.</p></li>
<li><p>custom_info: The component customization information used by framework developers to locate performance issues, possibly empty.</p></li>
<li><p>memory_usage: Host-side memory usage in kB, and 0 means no memory data is collected at the current stage.</p></li>
<li><p>time_stamp: Time stamp in us.</p></li>
</ul>
</section>
</section>
<section id="offline-analyse">
<h2>Offline Analyse<a class="headerlink" href="#offline-analyse" title="Permalink to this headline"></a></h2>
<p>When an error occurs during the training process leading to an abnormal exit, the performance file cannot be fully saved, and the Profiler provides offline parsing functionality. Currently, offline parsing only supports parsing the host side memory and host side time consumption.</p>
<p>For example, the partial code of the training script is as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="o">...</span>


<span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="n">net</span><span class="p">):</span>
    <span class="o">...</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">ms</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">GRAPH_MODE</span><span class="p">,</span> <span class="n">device_target</span><span class="o">=</span><span class="s2">&quot;Ascend&quot;</span><span class="p">)</span>

    <span class="c1"># Init Profiler</span>
    <span class="c1"># Note that the Profiler should be initialized before model.train</span>
    <span class="n">profiler</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Profiler</span><span class="p">(</span><span class="n">output_path</span><span class="o">=</span><span class="s1">&#39;/path/to/profiler_data&#39;</span><span class="p">)</span>

    <span class="c1"># Train Model</span>
    <span class="n">net</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
    <span class="n">train</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>  <span class="c1"># Error occur.</span>

    <span class="c1"># Profiler end</span>
    <span class="n">profiler</span><span class="o">.</span><span class="n">analyse</span><span class="p">()</span>
</pre></div>
</div>
<p>If an exception occurs in above code during the training process, resulting in the <cite>profiler.analyse()</cite> at the last line not being executed, the performance data will not be completely parsed. At this point, the offline interface can be used to parse data, and the example code is as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">Profiler</span>

<span class="n">profiler</span> <span class="o">=</span> <span class="n">Profiler</span><span class="p">(</span><span class="n">start_profile</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">profiler</span><span class="o">.</span><span class="n">analyse</span><span class="p">(</span><span class="n">offline_path</span><span class="o">=</span><span class="s1">&#39;/path/to/profiler_data&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>After offline parsing, you can view the host side data in the directory <cite>/path/to/profiler_data/profile/host_info</cite> .</p>
</section>
<section id="specifications">
<h2>Specifications<a class="headerlink" href="#specifications" title="Permalink to this headline"></a></h2>
<ul>
<li><p>To limit the data size generated by the Profiler, MindSpore Insight
suggests that for large neural network, the profiled steps should be
less than 10.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The number of steps can be controlled by controlling the size of
training dataset. For example, the <code class="docutils literal notranslate"><span class="pre">num_samples</span></code> parameter in
<code class="docutils literal notranslate"><span class="pre">mindspore.dataset.MindDataset</span></code> can control the size of the
dataset. For details, please refer to:
<a class="reference external" href="https://www.mindspore.cn/docs/en/master/api_python/dataset/mindspore.dataset.MindDataset.html">dataset API</a> .</p>
</div>
</li>
<li><p>The parse of Timeline data is time consuming, and usually the data of
a few steps is enough to analyze the results. In order to speed up
the data parse and UI display, Profiler will show at most 20M data
(Contain 10+ step information for large networks).</p></li>
<li><p>Enabling the profiler has a partial performance impact on the training process. If the impact is significant, data collection items can be reduced. The following is a comparison of the performance of the Resnet network before and after enabling the profiler:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 18%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 31%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>network：Resnet</p></th>
<th class="head"><p>Disable profiler</p></th>
<th class="head"><p>Enable profiler</p></th>
<th class="head"><p>Performance Comparison</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1P+PYNATIVE</p></td>
<td><p>31.18444ms</p></td>
<td><p>31.67689ms</p></td>
<td><p>+0.49245ms</p></td>
</tr>
<tr class="row-odd"><td><p>1P+GRAPH</p></td>
<td><p>30.38978ms</p></td>
<td><p>31.72489ms</p></td>
<td><p>+1.33511ms</p></td>
</tr>
<tr class="row-even"><td><p>8P+PYNATIVE</p></td>
<td><p>30.046ms</p></td>
<td><p>32.38599ms</p></td>
<td><p>+2.33999ms</p></td>
</tr>
<tr class="row-odd"><td><p>8P+GRAPH</p></td>
<td><p>24.06355ms</p></td>
<td><p>25.04324ms</p></td>
<td><p>+0.97969ms</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>The performance data in the chart shows the average time spent on one step during the training process of the resnet network on Ascend 910. (Note: There are performance fluctuations in network training, and the above data is for reference only)</p></li>
</ul>
</li>
</ul>
</section>
<section id="notices">
<h2>Notices<a class="headerlink" href="#notices" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Currently the training and inference process does not support
performance debugging, only individual training or inference is
supported.</p></li>
<li><p>Step trace analysis only supports single-graph scenarios in Graph mode, and does not support scenarios such as pynative, heterogeneous, and multi-subgraphs.</p></li>
<li><p>Enable profiling based on step, enable profiling based on epoch, step trace analysis and cluster analysis are only supported in Graph mode.</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="performance_profiling.html" class="btn btn-neutral float-left" title="Performance Profiling" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="performance_profiling_gpu.html" class="btn btn-neutral float-right" title="Performance Profiling (GPU)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, MindSpore.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 
</body>
</html>