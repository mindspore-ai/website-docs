<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Using Online Debugger &mdash; MindSpore master documentation</title><script>;(()=>{const e=localStorage.getItem("ms-theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;(e?"dark"===e:t)&&document.documentElement.setAttribute("data-o-theme","dark")})();</script><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script><script src="_static/jquery.js"></script>
        <script src="_static/js/theme.js"></script><script src="_static/underscore.js"></script><script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Using the Offline Debugger" href="debugger_offline.html" />
    <link rel="prev" title="Debugger" href="debugger.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> MindSpore
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="mindinsight_install.html">MindSpore Insight Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="summary_record.html">Collecting Summary Record</a></li>
<li class="toctree-l1"><a class="reference internal" href="dashboard.html">Viewing Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="lineage_and_scalars_comparison.html">Viewing Lineage and Scalars Comparison</a></li>
<li class="toctree-l1"><a class="reference internal" href="performance_profiling.html">Performance Profiling</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="debugger.html">Debugger</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Using Online Debugger</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#operation-process">Operation Process</a></li>
<li class="toctree-l3"><a class="reference internal" href="#debugger-environment-preparation">Debugger Environment Preparation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#launch-mindspore-insight-in-debugger-mode">Launch MindSpore Insight in Debugger Mode</a></li>
<li class="toctree-l4"><a class="reference internal" href="#run-the-training-script-in-debug-mode">Run the Training Script in Debug Mode</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#debugger-ui-introduction">Debugger UI Introduction</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#computational-graph">Computational Graph</a></li>
<li class="toctree-l4"><a class="reference internal" href="#node-list">Node List</a></li>
<li class="toctree-l4"><a class="reference internal" href="#graph-node-details">Graph Node Details</a></li>
<li class="toctree-l4"><a class="reference internal" href="#anomaly-check-list">Anomaly Check List</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setting-watchpoints">Setting Watchpoints</a></li>
<li class="toctree-l4"><a class="reference internal" href="#stack-list">Stack List</a></li>
<li class="toctree-l4"><a class="reference internal" href="#stack-information">Stack Information</a></li>
<li class="toctree-l4"><a class="reference internal" href="#recheck">Recheck</a></li>
<li class="toctree-l4"><a class="reference internal" href="#training-control">Training Control</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tensor-check-view">Tensor Check View</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#debugger-usage-example">Debugger Usage Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#notices">Notices</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="debugger_offline.html">Using the Offline Debugger</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="landscape.html">Training Optimization Process Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindinsight_commands.html">MindSpore Insight Commands</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tuning Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="accuracy_problem_preliminary_location.html">Guide to Locating Accuracy Problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="accuracy_optimization.html">Accuracy Problem Locating and Optimization Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="fixing_randomness.html">Fixed Randomness to Reproduce Run Results of Script</a></li>
<li class="toctree-l1"><a class="reference internal" href="performance_tuning_guide.html">Performance Tuning Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="performance_optimization.html">Performance Debugging Cases</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="mindinsight.debugger.html">mindinsight.debugger</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="training_visual_design.html">Overall Design of Training Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="graph_visual_design.html">Computational Graph Visualization Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensor_visual_design.html">Tensor Visualization Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="profiler_design.html">Performance Profiling Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">RELEASE NOTES</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="RELEASE.html">Release Notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MindSpore</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="debugger.html">Debugger</a> &raquo;</li>
      <li>Using Online Debugger</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/debugger_online.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="using-online-debugger">
<h1>Using Online Debugger<a class="headerlink" href="#using-online-debugger" title="Permalink to this headline"></a></h1>
<p><a class="reference external" href="https://gitee.com/mindspore/docs/blob/r2.2/docs/mindinsight/docs/source_en/debugger_online.md"><img alt="View Source On Gitee" src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/r2.2/resource/_static/logo_source_en.svg" /></a></p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline"></a></h2>
<p>This article describes how to use Debugger in online mode.</p>
</section>
<section id="operation-process">
<h2>Operation Process<a class="headerlink" href="#operation-process" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Launch MindSpore Insight in debugger mode and wait for the training.</p></li>
<li><p>Set debugger environment variables and run the training script.</p></li>
<li><p>After the training is connected, set watchpoints on the MindSpore Insight Debugger UI.</p></li>
<li><p>Analyze the training progress on MindSpore Insight Debugger UI.</p></li>
</ul>
</section>
<section id="debugger-environment-preparation">
<h2>Debugger Environment Preparation<a class="headerlink" href="#debugger-environment-preparation" title="Permalink to this headline"></a></h2>
<section id="launch-mindspore-insight-in-debugger-mode">
<h3>Launch MindSpore Insight in Debugger Mode<a class="headerlink" href="#launch-mindspore-insight-in-debugger-mode" title="Permalink to this headline"></a></h3>
<p>At first, install MindSpore Insight and launch it in debugger mode. MindSpore will send training information to MindSpore Insight Debugger Server in debugger mode, users can analyze the information on MindSpore Insight UI.</p>
<p>The command to launch MindSpore Insight in debugger mode is as follows:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>mindinsight start --port {PORT} --enable-debugger True --debugger-port {DEBUGGER_PORT}
</pre></div>
</div>
<p>The Debugger related parameters:</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Argument</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Scope</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--port</span> <span class="pre">{PORT}</span></code></p></td>
<td><p>Optional</p></td>
<td><p>Specifies the port number of the web visualization service.</p></td>
<td><p>Integer</p></td>
<td><p>8080</p></td>
<td><p>1~65535</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--enable-debugger</span> <span class="pre">{ENABLE_DEBUGGER}</span></code></p></td>
<td><p>Optional</p></td>
<td><p>Should be set to <code class="docutils literal notranslate"><span class="pre">True</span></code> or <code class="docutils literal notranslate"><span class="pre">1</span></code>, this will launch the MindSpore Insight debugger server; Default is <code class="docutils literal notranslate"><span class="pre">False</span></code>, not launch.</p></td>
<td><p>Boolean</p></td>
<td><p>False</p></td>
<td><p>True/False/1/0</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--debugger-port</span> <span class="pre">{DEBUGGER_PORT}</span></code></p></td>
<td><p>Optional</p></td>
<td><p>Specifies the port number of the debugger server.</p></td>
<td><p>Integer</p></td>
<td><p>50051</p></td>
<td><p>1~65535</p></td>
</tr>
</tbody>
</table>
<p>For more launch parameters, please refer to <a class="reference external" href="https://www.mindspore.cn/mindinsight/docs/en/r2.2/mindinsight_commands.html">MindSpore Insight Commands</a>.</p>
</section>
<section id="run-the-training-script-in-debug-mode">
<h3>Run the Training Script in Debug Mode<a class="headerlink" href="#run-the-training-script-in-debug-mode" title="Permalink to this headline"></a></h3>
<p>Run the training script in debug mode, you need to set <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">ENABLE_MS_DEBUGGER=1</span></code> or <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">ENABLE_MS_DEBUGGER=True</span></code> to specify the training is in the debugger mode, and set the debugger host and port to which the training is connected:
<code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">MS_DEBUGGER_HOST=127.0.0.1</span></code> (the service address must be consistent with MindSpore Insight host address);
<code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">MS_DEBUGGER_PORT=50051</span></code> (the port must be consistent with MindSpore Insight debugger-port).</p>
<p>If the memory space of your equipment is limited, you can use the partial memory reuse mode before starting the training to reduce the running space: <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">MS_DEBUGGER_PARTIAL_MEM=1</span></code>。</p>
<p>In addition, do not use data offload mode during training (you need to set <code class="docutils literal notranslate"><span class="pre">dataset_sink_mode</span></code> in <code class="docutils literal notranslate"><span class="pre">model.train</span></code> to <code class="docutils literal notranslate"><span class="pre">False</span></code>) to ensure that the debugger can obtain the training information of each step.</p>
<p>After the environment and training script are prepared, run the training script.</p>
</section>
</section>
<section id="debugger-ui-introduction">
<h2>Debugger UI Introduction<a class="headerlink" href="#debugger-ui-introduction" title="Permalink to this headline"></a></h2>
<p>After the training is connected, you can view the training meta information such as a computational graph on the MindSpore Insight Debugger UI which consists of the computational graph, node list, node information, watchpoint list, watchpoint hit list, stack list, and stack information.
The Debugger UI components are shown as follows.</p>
<p><img alt="debugger_init_page" src="_images/debugger_init_page.png" /></p>
<p><em>Figure 1: The initial UI of debugger</em></p>
<section id="computational-graph">
<h3>Computational Graph<a class="headerlink" href="#computational-graph" title="Permalink to this headline"></a></h3>
<p>Debugger will display the optimized computational graph in the upper middle area of the page.
Users can click the box (stand for one <code class="docutils literal notranslate"><span class="pre">scope</span></code>) to expand the graph, and analyze the nodes contained in that <code class="docutils literal notranslate"><span class="pre">scope</span></code>.</p>
<p>The area on the top shows the training metadata, such as the <code class="docutils literal notranslate"><span class="pre">Client</span> <span class="pre">IP</span></code> (address and port of the training script process),
<code class="docutils literal notranslate"><span class="pre">Device</span> <span class="pre">ID</span></code> being used and the current training <code class="docutils literal notranslate"><span class="pre">Step</span></code>.</p>
<p>In the GPU environment, the <code class="docutils literal notranslate"><span class="pre">Current</span> <span class="pre">Node</span></code> and <code class="docutils literal notranslate"><span class="pre">Next</span> <span class="pre">Node</span></code> buttons are used to return to the current execution node and execute the next node, respectively and are displayed in the upper right corner of the computational graph area.</p>
</section>
<section id="node-list">
<h3>Node List<a class="headerlink" href="#node-list" title="Permalink to this headline"></a></h3>
<p><img alt="debugger_search_node_type" src="_images/debugger_search_node_type.png" /></p>
<p><em>Figure 2: The node list filtered by node type</em></p>
<p>As shown in Figure 1, the computational graph <code class="docutils literal notranslate"><span class="pre">Node</span> <span class="pre">List</span></code> will be displayed on the left of the UI.
The <code class="docutils literal notranslate"><span class="pre">Node</span> <span class="pre">List</span></code> can be expanded according to the <code class="docutils literal notranslate"><span class="pre">scope</span></code> of the nodes.
When clicking one node in the list, the computational graph on the right will also be expanded and choose the corresponding node automatically.</p>
<p>You can filter nodes by <code class="docutils literal notranslate"><span class="pre">Graph</span> <span class="pre">File</span></code> and <code class="docutils literal notranslate"><span class="pre">Node</span> <span class="pre">Type</span></code> under <code class="docutils literal notranslate"><span class="pre">Node</span> <span class="pre">List</span></code>, as shown in Figure 2, and search for nodes by entering their names in the search box under <code class="docutils literal notranslate"><span class="pre">Node</span> <span class="pre">Type</span></code>.</p>
</section>
<section id="graph-node-details">
<h3>Graph Node Details<a class="headerlink" href="#graph-node-details" title="Permalink to this headline"></a></h3>
<p>After clicking a graph node, you can view its detailed information in the lower part of the UI, including the output and input, training steps (<code class="docutils literal notranslate"><span class="pre">Step</span></code>), as well as data types (<code class="docutils literal notranslate"><span class="pre">DType</span></code>), shapes (<code class="docutils literal notranslate"><span class="pre">Shape</span></code>), and values (<code class="docutils literal notranslate"><span class="pre">Value</span></code>) of a tensor, as shown in Figure 2. After clicking the <code class="docutils literal notranslate"><span class="pre">Download</span></code> in the <code class="docutils literal notranslate"><span class="pre">Value</span></code> column, tensor values can be download as <code class="docutils literal notranslate"><span class="pre">.npy</span></code> file, the default directory is <code class="docutils literal notranslate"><span class="pre">Downloads</span></code> folder.</p>
<p>In the GPU environment, select and right-click an executable graph node, and choose <code class="docutils literal notranslate"><span class="pre">Run</span> <span class="pre">to</span> <span class="pre">This</span> <span class="pre">Node</span></code> from the shortcut menu to run the training script to the selected node (no more than one step).</p>
<p>When the depth of the direct child node of a namespace or an aggregation node exceeds 70, the graph node page does not support expanding the node.
To see the tensor relationship inside the node, you can turn to the tensor relationship diagram page via a node related to it, refer to the <a class="reference external" href="https://www.mindspore.cn/mindinsight/docs/en/r2.2/faq.html">FAQ</a> for details.</p>
</section>
<section id="anomaly-check-list">
<h3>Anomaly Check List<a class="headerlink" href="#anomaly-check-list" title="Permalink to this headline"></a></h3>
<p>The anomaly check list shows all the set anomaly check rules. Anomaly check rule, referred to as watchpoint.</p>
<p><img alt="debugger_watch_point_list" src="_images/debugger_watch_point_list.png" /></p>
<p><em>Figure 3: The anomaly check list</em></p>
<p>As shown in Figure 3, the watchpoint list is in the lower left corner of the UI. The three icons from left to right in the upper right corner of the watchpoint list are used to <code class="docutils literal notranslate"><span class="pre">recheck</span></code>, <code class="docutils literal notranslate"><span class="pre">clear</span></code>, and <code class="docutils literal notranslate"><span class="pre">create</span></code> watchpoints.</p>
</section>
<section id="setting-watchpoints">
<h3>Setting Watchpoints<a class="headerlink" href="#setting-watchpoints" title="Permalink to this headline"></a></h3>
<p><img alt="debugger_set_watch_point" src="_images/debugger_set_watch_point.png" /></p>
<p><em>Figure 4: Creating watchpoint</em></p>
<p>To monitor and analyze the computation result of a node, you can set a watchpoint for the node in a computational graph. Figure 4 shows how to set a watchpoint. You can click the <code class="docutils literal notranslate"><span class="pre">+</span></code> icon in the upper right corner of the watchpoint list to add a watchpoint and select a check condition. For example, if you want to check whether a tensor is above the threshold, select a check condition, enter a threshold, and click OK to create a watchpoint.
After a watchpoint is created, manually select the node to be checked and click <code class="docutils literal notranslate"><span class="pre">√</span></code> next to the watchpoint. If you select <code class="docutils literal notranslate"><span class="pre">Weight</span> <span class="pre">check</span></code>, <code class="docutils literal notranslate"><span class="pre">Gradient</span> <span class="pre">check</span></code>, or <code class="docutils literal notranslate"><span class="pre">Activation</span> <span class="pre">value</span> <span class="pre">check</span></code> when creating a watchpoint, the weight, gradient, or activation node is automatically selected. You can manually change the selected node after clicking OK.</p>
<p>The following conditions are supported (abbreviations in parentheses):</p>
<ul class="simple">
<li><p>Tensor check</p>
<ul>
<li><p>Operator overflow (OO): Check whether overflow occurs during operator computation. Only the Ascend AI Processor is supported.</p></li>
<li><p>Whether tensor values are all 0 (TZ): Set the threshold to <code class="docutils literal notranslate"><span class="pre">Percentage</span> <span class="pre">of</span> <span class="pre">0</span> <span class="pre">values</span> <span class="pre">≥</span></code> to check the percentage of 0 tensor values.</p></li>
<li><p>Tensor overflow (TO): Check whether a tensor value overflow occurs.</p></li>
<li><p>Tensor value range (TR): Set a threshold to check the tensor value range. The options are <code class="docutils literal notranslate"><span class="pre">Percentage</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">value</span> <span class="pre">in</span> <span class="pre">the</span> <span class="pre">range</span> <span class="pre">&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">Percentage</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">value</span> <span class="pre">in</span> <span class="pre">the</span> <span class="pre">range</span> <span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">MAX-MIN&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">MAX-MIN&lt;</span></code>. If setting the threshold to <code class="docutils literal notranslate"><span class="pre">Percentage</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">value</span> <span class="pre">in</span> <span class="pre">the</span> <span class="pre">range</span> <span class="pre">&gt;</span></code> or <code class="docutils literal notranslate"><span class="pre">Percentage</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">value</span> <span class="pre">in</span> <span class="pre">the</span> <span class="pre">range</span> <span class="pre">&lt;</span></code>, you need to set the <code class="docutils literal notranslate"><span class="pre">Upper</span> <span class="pre">limit</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">range</span> <span class="pre">(inclusive)</span></code> or <code class="docutils literal notranslate"><span class="pre">Lower</span> <span class="pre">limit</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">range</span> <span class="pre">(inclusive)</span></code> at the same time.</p></li>
<li><p>Tensor above threshold (TL): Set a threshold to check whether the tensor value is too large. The options are <code class="docutils literal notranslate"><span class="pre">Average</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">absolute</span> <span class="pre">value</span> <span class="pre">&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">max</span> <span class="pre">&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">min</span> <span class="pre">&gt;</span></code>, and <code class="docutils literal notranslate"><span class="pre">mean</span> <span class="pre">&gt;</span></code>.</p></li>
<li><p>Tensor below threshold (TS): Set a threshold to check whether the tensor value is too small. The options are <code class="docutils literal notranslate"><span class="pre">Average</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">absolute</span> <span class="pre">value</span> <span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">max</span> <span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">min</span> <span class="pre">&lt;</span></code>, and <code class="docutils literal notranslate"><span class="pre">mean</span> <span class="pre">&lt;</span></code>.</p></li>
</ul>
</li>
<li><p>Weight check</p>
<ul>
<li><p>Weight change above threshold (WCL): Set a threshold to <code class="docutils literal notranslate"><span class="pre">Average</span> <span class="pre">change</span> <span class="pre">ratio</span> <span class="pre">&gt;</span></code> to check whether the weight value change is too large.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">Average</span> <span class="pre">change</span> <span class="pre">ratio</span></code> = <code class="docutils literal notranslate"><span class="pre">mean(abs(Current</span> <span class="pre">weight</span> <span class="pre">value</span> <span class="pre">-</span> <span class="pre">Weight</span> <span class="pre">value</span> <span class="pre">in</span> <span class="pre">previous</span> <span class="pre">step))/(mean(abs(Weight</span> <span class="pre">value</span> <span class="pre">in</span> <span class="pre">previous</span> <span class="pre">step))</span> <span class="pre">+</span> <span class="pre">Offset)</span></code>.</p></li>
</ul>
</li>
<li><p>Weight change below threshold (WCS): Set a threshold to <code class="docutils literal notranslate"><span class="pre">Average</span> <span class="pre">change</span> <span class="pre">ratio</span> <span class="pre">&lt;</span></code> to check whether the weight value change is too small.</p></li>
<li><p>Initial weight value (WI): Set a threshold to check the initial weight value. The options are <code class="docutils literal notranslate"><span class="pre">Percentage</span> <span class="pre">of</span> <span class="pre">0</span> <span class="pre">values</span> <span class="pre">≥</span></code>, <code class="docutils literal notranslate"><span class="pre">max</span> <span class="pre">&gt;</span></code>, and <code class="docutils literal notranslate"><span class="pre">min</span> <span class="pre">&lt;</span></code>.</p></li>
<li><p>Unchanged weight (WNC): Set the threshold to <code class="docutils literal notranslate"><span class="pre">Relative</span> <span class="pre">tolerance</span></code> to check whether the weight is updated.</p></li>
<li><p>Weight overflow (WO): Check whether a weight value overflow occurs.</p></li>
<li><p>Weight above threshold (WL): Set a threshold to check whether the weight value is too large. The options are <code class="docutils literal notranslate"><span class="pre">Average</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">absolute</span> <span class="pre">value</span> <span class="pre">&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">max</span> <span class="pre">&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">min</span> <span class="pre">&gt;</span></code>, and <code class="docutils literal notranslate"><span class="pre">mean</span> <span class="pre">&gt;</span></code>.</p></li>
<li><p>Weight below threshold (WS): Set a threshold to check whether the weight value is too small. The options are <code class="docutils literal notranslate"><span class="pre">Average</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">absolute</span> <span class="pre">value</span> <span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">max</span> <span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">min</span> <span class="pre">&lt;</span></code>, and <code class="docutils literal notranslate"><span class="pre">mean</span> <span class="pre">&lt;</span></code>.</p></li>
</ul>
</li>
<li><p>Activation value check</p>
<ul>
<li><p>Activation value range (AR): Set a threshold to check the activation value range. The options are <code class="docutils literal notranslate"><span class="pre">Percentage</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">value</span> <span class="pre">in</span> <span class="pre">the</span> <span class="pre">range</span> <span class="pre">&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">Percentage</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">value</span> <span class="pre">in</span> <span class="pre">the</span> <span class="pre">range</span> <span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">MAX-MIN&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">MAX-MIN&lt;</span></code>. If setting the threshold to <code class="docutils literal notranslate"><span class="pre">Percentage</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">value</span> <span class="pre">in</span> <span class="pre">the</span> <span class="pre">range</span> <span class="pre">&gt;</span></code> or <code class="docutils literal notranslate"><span class="pre">Percentage</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">value</span> <span class="pre">in</span> <span class="pre">the</span> <span class="pre">range</span> <span class="pre">&lt;</span></code>, you need to set the <code class="docutils literal notranslate"><span class="pre">Upper</span> <span class="pre">limit</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">range</span> <span class="pre">(inclusive)</span></code> or <code class="docutils literal notranslate"><span class="pre">Lower</span> <span class="pre">limit</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">range</span> <span class="pre">(inclusive)</span></code> at the same time.</p></li>
</ul>
</li>
<li><p>Gradient check</p>
<ul>
<li><p>Gradient explosion (GE): Check whether a gradient value overflow occurs.</p></li>
<li><p>Gradient above threshold (GL): Set a threshold to check whether the gradient value is too large. The options are <code class="docutils literal notranslate"><span class="pre">Average</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">absolute</span> <span class="pre">value</span> <span class="pre">&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">max</span> <span class="pre">&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">min</span> <span class="pre">&gt;</span></code>, and <code class="docutils literal notranslate"><span class="pre">mean</span> <span class="pre">&gt;</span></code>.</p></li>
<li><p>Gradient disappearance (GV): Set a threshold to check whether the gradient value is too small. The options are <code class="docutils literal notranslate"><span class="pre">Average</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">absolute</span> <span class="pre">value</span> <span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">max</span> <span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">min</span> <span class="pre">&lt;</span></code>, and <code class="docutils literal notranslate"><span class="pre">mean</span> <span class="pre">&lt;</span></code>.</p></li>
</ul>
</li>
</ul>
<p>After a watchpoint is generated, you can select or deselect nodes to be monitored in the node list, as shown in Figure 3. In addition, you can click the <code class="docutils literal notranslate"><span class="pre">clear</span> <span class="pre">watchpoint</span></code> icon or <code class="docutils literal notranslate"><span class="pre">X</span></code> icon to delete watchpoints.</p>
<p>During training, the debugger analyzes the outputs of these monitored nodes in real time. Once the watchpoint conditions are hit, the training is suspended. You can view the information about the hit nodes on the UI.</p>
<p><img alt="debugger_watch_point_hit" src="_images/debugger_watch_point_hit.png" /></p>
<p><em>Figure 5: Viewing hit nodes</em></p>
<p>The hit nodes are displayed on the left of the UI. If more than one watchpoints are set, UI can show the result of the specified watchpoint by choosing the watchpoint id in the watchpoint pull list.
If the training network consists of more than one sub graphs, you can choose the sub graph name in the graph file pull list to show the results of the specified sub graph.
For multi-card training, you can choose the logic card id in the logic card pull list to show the hit nodes on the specified card
(Only for offline debugger, online debugger does not support distributed training at present).</p>
<p>In the same sub graph, the hit nodes are sorted based on the node execution sequence. On the left of the node name, click on the expand icon, the hit watchpoints and watchpoint condition will be displayed. Each record displays the configured threshold and the actual value.
In addition, after you click a record, the corresponding node is displayed in the computational graph. You can view the node information to analyze the possible cause. Click <code class="docutils literal notranslate"><span class="pre">View</span></code> to enter the tensor check view. You can view the hit watchpoint information and optimization guide, as shown in Figure 8.</p>
</section>
<section id="stack-list">
<h3>Stack List<a class="headerlink" href="#stack-list" title="Permalink to this headline"></a></h3>
<p>You can click the switch button in the upper left corner on the debugger UI to switch from <code class="docutils literal notranslate"><span class="pre">Node</span> <span class="pre">List</span></code> or <code class="docutils literal notranslate"><span class="pre">Watchpoint</span> <span class="pre">Hit</span> <span class="pre">List</span></code> to <code class="docutils literal notranslate"><span class="pre">Stack</span> <span class="pre">List</span></code>.</p>
<p>You can view all stack information in the stack list. After you enter a keyword in the search box, the matched stack information is displayed. The list is displayed on multiple pages. You can click the page number at the bottom to quickly go to the corresponding page.</p>
<p>Click an item in the list to go to the node list where you can view the node related to the code.</p>
<p><img alt="debugger_stack_list" src="_images/debugger_stack_list.png" /></p>
<p><em>Figure 6: Stack list</em></p>
</section>
<section id="stack-information">
<h3>Stack Information<a class="headerlink" href="#stack-information" title="Permalink to this headline"></a></h3>
<p>When a node is located in the graph, click the <code class="docutils literal notranslate"><span class="pre">Stack</span> <span class="pre">Info</span></code> tab page below the graph to view the stack information related to the node.</p>
<p>On the Stack Info tab page, click Search in a row to search for all nodes related to the row. The search result is automatically displayed in the node list.</p>
<p><img alt="debugger_stack_info" src="_images/debugger_stack_info.png" /></p>
<p>Note: some operators are generated by the framework, such as <code class="docutils literal notranslate"><span class="pre">TupleGetItem</span></code>, <code class="docutils literal notranslate"><span class="pre">Append</span></code>, <code class="docutils literal notranslate"><span class="pre">UpdateState</span></code>, and so on. These operators may be associated with the code of the framework itself, or no code can be associated, which is normal.</p>
<p><em>Figure 7: Stack information</em></p>
</section>
<section id="recheck">
<h3>Recheck<a class="headerlink" href="#recheck" title="Permalink to this headline"></a></h3>
<p>To perform more detailed monitoring and analysis on a node, you can modify the node to be monitored, add or delete watchpoints, and then check the current step again. The <code class="docutils literal notranslate"><span class="pre">recheck</span></code> icon is in the upper right corner of the watchpoint list as shown in figure 3.</p>
</section>
<section id="training-control">
<h3>Training Control<a class="headerlink" href="#training-control" title="Permalink to this headline"></a></h3>
<p>At the bottom of the watchpoint setting panel is the training control panel, which shows the training control functions of the debugger,
with four buttons: <code class="docutils literal notranslate"><span class="pre">CONTINUE</span></code>, <code class="docutils literal notranslate"><span class="pre">PAUSE</span></code>, <code class="docutils literal notranslate"><span class="pre">TERMINATE</span></code> and <code class="docutils literal notranslate"><span class="pre">OK</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">OK</span></code> stands for executing the training for several steps, the number of the <code class="docutils literal notranslate"><span class="pre">step</span></code> can be specified in the above bar. The training will be paused until the <code class="docutils literal notranslate"><span class="pre">Watch</span> <span class="pre">Point</span> <span class="pre">List</span></code> is triggered, or the number of <code class="docutils literal notranslate"><span class="pre">step</span></code> is reached.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONTINUE</span></code> stands for executing the training until the <code class="docutils literal notranslate"><span class="pre">Watch</span> <span class="pre">Point</span> <span class="pre">List</span></code> is triggered, or the training is finished.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PAUSE</span></code> stands for pausing the training.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TERMINATE</span></code> stands for terminating the training.</p></li>
</ul>
</section>
<section id="tensor-check-view">
<h3>Tensor Check View<a class="headerlink" href="#tensor-check-view" title="Permalink to this headline"></a></h3>
<p>Some <code class="docutils literal notranslate"><span class="pre">tensors</span></code> have too many dimensions and cannot be directly displayed on the home page. You can click the corresponding <code class="docutils literal notranslate"><span class="pre">View</span></code> button to view the detailed information about the <code class="docutils literal notranslate"><span class="pre">tensor</span></code> value on the displayed tensor check view.</p>
<p><img alt="debugger_tensor_view_heatmap" src="_images/debugger_tensor_view_heatmap.png" /></p>
<p><em>Figure 8: Viewing tensors value heatmap</em></p>
<p>As shown in Figure 8, the tensor check view displays the <code class="docutils literal notranslate"><span class="pre">tensor</span></code> values in the upper part of the UI, the default value is in chart mode, which can display the distribution of current values. When the mouse moves to a position on the chart, the specific value of current coordinates will be displayed. Select <code class="docutils literal notranslate"><span class="pre">Table</span> <span class="pre">Mode</span></code> in the <code class="docutils literal notranslate"><span class="pre">Mode</span></code> pull box below the thermodynamic diagram, the <code class="docutils literal notranslate"><span class="pre">tensor</span></code> value in the form of table would be displayed, as shown in Figure 9.</p>
<p><img alt="debugger_tensor_view" src="_images/debugger_tensor_view.png" /></p>
<p><em>Figure 9: Viewing tensors value</em></p>
<p>In the tensor check view, you can set the <code class="docutils literal notranslate"><span class="pre">Dimension</span> <span class="pre">Selection</span></code> and click <code class="docutils literal notranslate"><span class="pre">Current</span> <span class="pre">Step</span></code>, <code class="docutils literal notranslate"><span class="pre">Previous</span> <span class="pre">step</span></code>, and <code class="docutils literal notranslate"><span class="pre">Comparison</span> <span class="pre">Result</span></code> to display and compare tensors. (Currently, the parameter node can be compared only with the previous one step.) In addition, you can set shards in <code class="docutils literal notranslate"><span class="pre">Dimension</span> <span class="pre">Selection</span></code> to display a <code class="docutils literal notranslate"><span class="pre">tensor</span></code> in the specified dimension.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">node</span> <span class="pre">information</span></code>, <code class="docutils literal notranslate"><span class="pre">current</span> <span class="pre">step</span></code>, and <code class="docutils literal notranslate"><span class="pre">statistics</span></code> are displayed on the top of the view. The optimization guide is displayed on the left of the view. When a watchpoint is hit, the hit information and optimization suggestions are displayed. The tensor relationship diagram and detailed <code class="docutils literal notranslate"><span class="pre">node</span> <span class="pre">information</span></code> are displayed on the lower part of the view.</p>
<p>Based on the tensor relationship diagram, you can analyze which tensors are used to compute the current tensor and which constants are affected by the current tensor. Abbreviations of watchpoint conditions are displayed on the diagram, helping you quickly identify the propagation path of tensor issues. Each condition abbreviation can be found in “Setting Watchpoints”.</p>
<p>Tensors can be downloaded in tensor check view. Users can download the desired tensor for in-depth analysis or processing.</p>
</section>
</section>
<section id="debugger-usage-example">
<h2>Debugger Usage Example<a class="headerlink" href="#debugger-usage-example" title="Permalink to this headline"></a></h2>
<ol class="arabic">
<li><p>Prepare the debugger environment, and open the MindSpore Insight Debugger UI.</p>
<p><img alt="debugger_waiting" src="_images/debugger_waiting.png" /></p>
<p><em>Figure 10: Debugger Start and Waiting for the Training</em></p>
<p>The Debugger server is launched and waiting for the training to connect.</p>
</li>
<li><p>Run the training script on terminal.</p></li>
<li><p>Wait for a moment. A dialog box is displayed on the MindSpore Insight UI, asking you whether to use the recommended watchpoints, as shown in the following figure.</p>
<p><img alt="debugger_ask_recommend" src="_images/debugger_ask_recommend.png" /></p>
<p><em>Figure 11: Debugger ask whether to use the recommended watchpoints</em></p>
</li>
<li><p>Later, you can see that the computational graph is displayed on the Debugger UI, as shown in Figure 1.</p></li>
<li><p>Set watchpoints.</p>
<p>Select the watchpoint conditions, as shown in Figure 4. Select or deselect certain nodes as shown in Figure 3. The debugger monitors whether outputs that meet the watchpoint conditions exist during the node computation process.
After setting the watchpoints, you can set <code class="docutils literal notranslate"><span class="pre">step</span></code> and click <code class="docutils literal notranslate"><span class="pre">OK</span></code>, or just click <code class="docutils literal notranslate"><span class="pre">CONTINUE</span></code> to continue the training.</p>
</li>
<li><p>Trigger watchpoints, as shown in Figure 5.</p>
<p>After watchpoints are hit, you can view the corresponding node information and stack information, find the exception cause on the tensor check view, or download the tensor to analyse the exception, and modify the script to rectify the fault.</p>
</li>
</ol>
</section>
<section id="notices">
<h2>Notices<a class="headerlink" href="#notices" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Scenarios:</p>
<ul>
<li><p>The debugger does not support distributed training scenarios.</p></li>
<li><p>The debugger does not support inference scenarios.</p></li>
<li><p>The debugger does not support the single-node multi-device or cluster scenario.</p></li>
<li><p>The debugger does not support connected to multiple training process.</p></li>
<li><p>The debugger does not support CPU scenarios.</p></li>
<li><p>The debugger does not support PyNative mode.</p></li>
<li><p>The debugger does not support multi networks scenarios.</p></li>
</ul>
</li>
<li><p>Impact on Performance:</p>
<ul>
<li><p>Debugger will slow down the training performance.</p></li>
<li><p>When too many <code class="docutils literal notranslate"><span class="pre">Watch</span> <span class="pre">Points</span></code> are set, the system may run out of memory.</p></li>
</ul>
</li>
<li><p>GPU Scenario:</p>
<ul>
<li><p>In the GPU scenario, only the parameter nodes that meet requirements can be compared with the previous step. For example, nodes executed on the <code class="docutils literal notranslate"><span class="pre">next</span> <span class="pre">node</span></code>, nodes selected when <code class="docutils literal notranslate"><span class="pre">Run</span> <span class="pre">to</span> <span class="pre">This</span> <span class="pre">Node</span></code> is chosen, and nodes input as <code class="docutils literal notranslate"><span class="pre">watchpoints</span></code> can be compared. In other cases, the <code class="docutils literal notranslate"><span class="pre">Compare</span> <span class="pre">with</span> <span class="pre">Previous</span> <span class="pre">Step</span></code> function cannot be used.</p></li>
</ul>
</li>
<li><p>When using the debugger, make sure that the version numbers of MindSpore Insight and MindSpore are the same.</p></li>
<li><p>Recheck only watchpoints that have tensor values.</p></li>
<li><p>To check overflow during computation, you need to enable the overflow detection function of the asynchronous dump. For details about how to enable the function, see <a class="reference external" href="https://www.mindspore.cn/tutorials/experts/en/r2.2/debug/dump.html#asynchronous-dump">Asynchronous Dump</a>.</p></li>
<li><p>The graph displayed by the debugger is the finally optimized execution graph. The called operator may have been integrated with other operators, or the name of the called operator is changed after optimization.</p></li>
<li><p>Enabling the debugger will turn off memory reuse mode, which may lead to an ‘out of memory’ error when the training network is too large.</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="debugger.html" class="btn btn-neutral float-left" title="Debugger" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="debugger_offline.html" class="btn btn-neutral float-right" title="Using the Offline Debugger" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright MindSpore.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 
</body>
</html>