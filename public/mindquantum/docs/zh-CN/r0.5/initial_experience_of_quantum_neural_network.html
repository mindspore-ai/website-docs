<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>量子神经网络初体验 &mdash; MindSpore master documentation</title><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="变分量子线路梯度计算进阶" href="get_gradient_of_PQC_with_mindquantum.html" />
    <link rel="prev" title="变分量子线路" href="parameterized_quantum_circuit.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> MindSpore
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">安装部署</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="mindquantum_install.html">安装MindQuantum</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">基础使用指南</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="parameterized_quantum_circuit.html">变分量子线路</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">量子神经网络初体验</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#量子神经网络的结构">量子神经网络的结构</a></li>
<li class="toctree-l2"><a class="reference internal" href="#简单的例子">简单的例子</a></li>
<li class="toctree-l2"><a class="reference internal" href="#环境准备">环境准备</a></li>
<li class="toctree-l2"><a class="reference internal" href="#搭建Encoder">搭建Encoder</a></li>
<li class="toctree-l2"><a class="reference internal" href="#搭建Ansatz">搭建Ansatz</a></li>
<li class="toctree-l2"><a class="reference internal" href="#构建哈密顿量">构建哈密顿量</a></li>
<li class="toctree-l2"><a class="reference internal" href="#生成变分量子线路模拟算子">生成变分量子线路模拟算子</a></li>
<li class="toctree-l2"><a class="reference internal" href="#搭建量子神经网络">搭建量子神经网络</a></li>
<li class="toctree-l2"><a class="reference internal" href="#训练">训练</a></li>
<li class="toctree-l2"><a class="reference internal" href="#结果呈现">结果呈现</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="get_gradient_of_PQC_with_mindquantum.html">变分量子线路梯度计算进阶</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">变分量子算法</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="classification_of_iris_by_qnn.html">通过量子神经网络对鸢尾花进行分类</a></li>
<li class="toctree-l1"><a class="reference internal" href="quantum_approximate_optimization_algorithm.html">量子近似优化算法</a></li>
<li class="toctree-l1"><a class="reference internal" href="qnn_for_nlp.html">量子神经网络在自然语言处理中的应用</a></li>
<li class="toctree-l1"><a class="reference internal" href="vqe_for_quantum_chemistry.html">在量子化学计算中应用量子变分求解器</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">通用量子算法</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="quantum_phase_estimation.html">量子相位估计算法</a></li>
<li class="toctree-l1"><a class="reference internal" href="grover_search_algorithm.html">基于MindQuantum的Grover搜索算法</a></li>
<li class="toctree-l1"><a class="reference internal" href="shor_algorithm.html">基于MindQuantum的Shor算法</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API参考</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="mindquantum.core.html">mindquantum.core</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindquantum.simulator.html">mindquantum.simulator</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindquantum.framework.html">mindquantum.framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindquantum.algorithm.html">mindquantum.algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindquantum.io.html">mindquantum.io</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindquantum.engine.html">mindquantum.engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="mindquantum.utils.html">mindquantum.utils</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MindSpore</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>量子神经网络初体验</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/initial_experience_of_quantum_neural_network.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars and line breaks on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
    white-space: pre;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="量子神经网络初体验">
<h1>量子神经网络初体验<a class="headerlink" href="#量子神经网络初体验" title="Permalink to this headline"></a></h1>
<p><a class="reference external" href="https://gitee.com/mindspore/docs/blob/r1.6/docs/mindquantum/docs/source_zh_cn/initial_experience_of_quantum_neural_network.ipynb"><img alt="查看源文件" src="https://gitee.com/mindspore/docs/raw/r1.6/resource/_static/logo_source.png" /></a></p>
<section id="量子神经网络的结构">
<h2>量子神经网络的结构<a class="headerlink" href="#量子神经网络的结构" title="Permalink to this headline"></a></h2>
<p>在MindQuantum中，量子神经网络（Quantum Neural Network, QNN）的结构如下图所示，其通常由三部分构成：</p>
<p>（1）一个（或多个）编码线路，用于将经典数据编码到量子数据（通常称为Encoder）；</p>
<p>（2）一个（或多个）训练线路，用于训练带参量子门中的参数（通常称为Ansatz）；</p>
<p>（3）一个（或多个）测量，用于检测测量值（例如在<code class="docutils literal notranslate"><span class="pre">Z</span></code>方向上测量，就是某个量子比特的量子态在<code class="docutils literal notranslate"><span class="pre">Z</span></code>轴上的投影，该测量得到的是量子态关于泡利<code class="docutils literal notranslate"><span class="pre">Z</span></code>算符（不限定于泡利<code class="docutils literal notranslate"><span class="pre">Z</span></code>算符，换成其它的算符亦可）的期望值）是否接近于目标期望值。</p>
<p><img alt="mindquantum" src="https://gitee.com/mindspore/docs/raw/r1.6/docs/mindquantum/docs/source_zh_cn/images/mindquantum.png" /></p>
<p>下面，我们通过一个简单的例子来体验一下如何使用MindQuantum。</p>
</section>
<section id="简单的例子">
<h2>简单的例子<a class="headerlink" href="#简单的例子" title="Permalink to this headline"></a></h2>
<p><img alt="example circuit" src="https://gitee.com/mindspore/docs/raw/r1.6/docs/mindquantum/docs/source_zh_cn/images/example_circuit.png" /></p>
<p>我们搭建如上图所示的量子神经网络，其中Encoder由一个<code class="docutils literal notranslate"><span class="pre">H</span></code>门，1个<code class="docutils literal notranslate"><span class="pre">RX</span></code>门、1个<code class="docutils literal notranslate"><span class="pre">RY</span></code>门和1个<code class="docutils literal notranslate"><span class="pre">RZ</span></code>门构成，Ansatz由1个<code class="docutils literal notranslate"><span class="pre">RX</span></code>门和1个<code class="docutils literal notranslate"><span class="pre">RY</span></code>门构成，测量则是作用在第0位量子比特上的泡利<code class="docutils literal notranslate"><span class="pre">Z</span></code>算符。</p>
<p>问题描述：我们将Encoder看成是系统对初始量子态的误差影响（参数<span class="math notranslate nohighlight">\(\alpha_0, \alpha_1\)</span>​和<span class="math notranslate nohighlight">\(\alpha_2\)</span>​是将原经典数据经过预处理（可选）后得到的某个固定值，即为已知值，在此分别设为0.2, 0.3和0.4）。我们需要训练一个Ansatz来抵消掉这个误差，使得最后的量子态还是处于<span class="math notranslate nohighlight">\(|0\rangle\)</span>​态。</p>
<p>思路：对末态执行泡利<code class="docutils literal notranslate"><span class="pre">Z</span></code>算符测量，此时的测量值就是此时的量子态关于泡利<code class="docutils literal notranslate"><span class="pre">Z</span></code>算符的期望值。由于<span class="math notranslate nohighlight">\(|0\rangle\)</span>​​是算符<code class="docutils literal notranslate"><span class="pre">Z</span></code>的本征态，且本征值为1，容易知道</p>
<div class="math notranslate nohighlight">
\[\langle 0|Z|0\rangle=1.\]</div>
<p>也就是说，目标期望值为1。可以通过测量得到的期望值来验证此时的状态是否为<span class="math notranslate nohighlight">\(|0\rangle\)</span>。</p>
<p>解决方案：通过训练Ansatz中的参数，希望测量值接近于目标期望值，换句话说，我们只需让测量值尽可能接近于<span class="math notranslate nohighlight">\(|0\rangle\)</span>态关于泡利<code class="docutils literal notranslate"><span class="pre">Z</span></code>算符对应的期望值，那么此时的状态就是<span class="math notranslate nohighlight">\(|0\rangle\)</span>，即Ansatz抵消了Encoder对初始量子态产生的误差。</p>
</section>
<section id="环境准备">
<h2>环境准备<a class="headerlink" href="#环境准备" title="Permalink to this headline"></a></h2>
<p>导入本教程所依赖的模块</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>                            <span class="c1"># 导入numpy库并简写为np</span>
<span class="kn">from</span> <span class="nn">mindquantum.core</span> <span class="kn">import</span> <span class="n">Circuit</span>          <span class="c1"># 导入Circuit模块，用于搭建量子线路</span>
<span class="kn">from</span> <span class="nn">mindquantum.core</span> <span class="kn">import</span> <span class="n">H</span><span class="p">,</span> <span class="n">RX</span><span class="p">,</span> <span class="n">RY</span><span class="p">,</span> <span class="n">RZ</span>    <span class="c1"># 导入量子门H, RX, RY, RZ</span>
</pre></div>
</div>
</div>
</section>
<section id="搭建Encoder">
<h2>搭建Encoder<a class="headerlink" href="#搭建Encoder" title="Permalink to this headline"></a></h2>
<p>根据图示的量子线路图，我们可以在MindQuantum中搭建Encoder。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># pylint: disable=W0104</span>
<span class="n">encoder</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">()</span>                   <span class="c1"># 初始化量子线路</span>
<span class="n">encoder</span> <span class="o">+=</span> <span class="n">H</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>                    <span class="c1"># H门作用在第0位量子比特</span>
<span class="n">encoder</span> <span class="o">+=</span> <span class="n">RX</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;alpha</span><span class="si">{</span><span class="mi">0</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>      <span class="c1"># RX(alpha_0)门作用在第0位量子比特</span>
<span class="n">encoder</span> <span class="o">+=</span> <span class="n">RY</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;alpha</span><span class="si">{</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>      <span class="c1"># RY(alpha_1)门作用在第0位量子比特</span>
<span class="n">encoder</span> <span class="o">+=</span> <span class="n">RZ</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;alpha</span><span class="si">{</span><span class="mi">2</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>      <span class="c1"># RZ(alpha_2)门作用在第0位量子比特</span>
<span class="n">encoder</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">no_grad</span><span class="p">()</span>           <span class="c1"># Encoder作为整个量子神经网络的第一层，不用对编码线路中的梯度求导数，因此加入no_grad()</span>
<span class="n">encoder</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>                     <span class="c1"># 总结Encoder</span>
<span class="n">encoder</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
==================Circuit Summary==================
|Total number of gates  : 4.                      |
|Parameter gates        : 3.                      |
|with 3 parameters are  : alpha0, alpha1, alpha2. |
|Number qubit of circuit: 1                       |
===================================================
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space: pre;"><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">q0: ──H────</span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">RX</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">(alpha0)────</span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">RY</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">(alpha1)────</span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">RZ</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">(alpha2)──</span>
</pre></div>
</div>
<p>从对Encoder的Summary中可以看到，该量子线路由4个量子门组成，其中有3个含参量子门且参数为<span class="math notranslate nohighlight">\(\alpha_0,\alpha_1,\alpha_2\)</span>​​​​，该量子线路调控的量子比特数为1。</p>
<p>然后，我们需要对Encoder中的参数进行赋值。由于Encoder中的参数<span class="math notranslate nohighlight">\(\alpha_0, \alpha_1\)</span>​和<span class="math notranslate nohighlight">\(\alpha_2\)</span>​分别为已知值0.2, 0.3和0.4，因此可以直接对参数进行赋值，并打印此时的状态。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">alpha0</span><span class="p">,</span> <span class="n">alpha1</span><span class="p">,</span> <span class="n">alpha2</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span>              <span class="c1"># alpha0, alpha1, alpha2为已知的固定值，分别赋值0.2, 0.3 和0.4</span>
<span class="n">state</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">get_qs</span><span class="p">(</span><span class="n">pr</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;alpha0&#39;</span><span class="p">:</span> <span class="n">alpha0</span><span class="p">,</span> <span class="s1">&#39;alpha1&#39;</span><span class="p">:</span> <span class="n">alpha1</span><span class="p">,</span> <span class="s1">&#39;alpha2&#39;</span><span class="p">:</span> <span class="n">alpha2</span><span class="p">},</span> <span class="n">ket</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(0.5669903122552596-0.1753906567580312j)¦0⟩
(0.800814626197614+0.08034947292077024j)¦1⟩
</pre></div></div>
</div>
<p>上述步骤为了展示MindQuantum可以演化量子线路（若量子线路中的量子门带参数，则需要对参数赋值）并得到演化后的末态。从上述打印可以看到，演化后得到的末态为<span class="math notranslate nohighlight">\(|0\rangle\)</span>​​​和<span class="math notranslate nohighlight">\(|1\rangle\)</span>​​​组成的叠加态，各项对应的振幅为上述打印的状态左边对应的数值。</p>
<p>说明：</p>
<p>（1）通过调用量子线路的<code class="docutils literal notranslate"><span class="pre">get_qs</span></code>函数，我们能够得到该量子线路在全零态基础上演化出来的量子态。</p>
<p>（2）<code class="docutils literal notranslate"><span class="pre">get_qs</span></code>的<code class="docutils literal notranslate"><span class="pre">pr</span></code>参数代表变分量子线路中的参数值，<code class="docutils literal notranslate"><span class="pre">ket</span></code>表示是否将量子态输出为右矢形式。</p>
</section>
<section id="搭建Ansatz">
<h2>搭建Ansatz<a class="headerlink" href="#搭建Ansatz" title="Permalink to this headline"></a></h2>
<p>同样地，我们也可以在MindQuantum中搭建Ansatz。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># pylint: disable=W0104</span>
<span class="n">ansatz</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">()</span>                           <span class="c1"># 初始化量子线路</span>
<span class="n">ansatz</span> <span class="o">+=</span> <span class="n">RX</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;theta</span><span class="si">{</span><span class="mi">0</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>              <span class="c1"># RX(theta_0)门作用在第0位量子比特</span>
<span class="n">ansatz</span> <span class="o">+=</span> <span class="n">RY</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;theta</span><span class="si">{</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>              <span class="c1"># RY(theta_1)门作用在第0位量子比特</span>
<span class="n">ansatz</span>                                       <span class="c1"># 打印量子线路</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space: pre;"><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">q0: ──</span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">RX</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">(theta0)────</span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">RY</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">(theta1)──</span>
</pre></div>
</div>
<p>从对Ansatz的Summary中可以看到，该量子线路由2个量子门组成，其中有2个含参量子门且参数为<span class="math notranslate nohighlight">\(\theta_0,\theta_1\)</span>​​，该量子线路调控的量子比特数为1。</p>
<p>然后，对Ansatz中的参数进行赋值。由于Ansatz为需要训练的量子线路，因此Ansatz中的参数<span class="math notranslate nohighlight">\(\theta_0\)</span>​​和<span class="math notranslate nohighlight">\(\theta_1\)</span>​​可以随机设定，通常默认设为初始值0。我们同样可以打印此时的量子态，不过这并不是必要的步骤，只是为了再次熟悉一下<code class="docutils literal notranslate"><span class="pre">get_qs</span></code>函数。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">theta0</span><span class="p">,</span> <span class="n">theta1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>                        <span class="c1"># 对theta0, theta1进行赋值，设为初始值0, 0</span>
<span class="n">state</span> <span class="o">=</span> <span class="n">ansatz</span><span class="o">.</span><span class="n">get_qs</span><span class="p">(</span><span class="n">pr</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">ansatz</span><span class="o">.</span><span class="n">params_name</span><span class="p">,</span> <span class="p">[</span><span class="n">theta0</span><span class="p">,</span> <span class="n">theta1</span><span class="p">])),</span> <span class="n">ket</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1¦0⟩
</pre></div></div>
</div>
<p>从上述打印可以看到，此时的状态为<span class="math notranslate nohighlight">\(|0\rangle\)</span>​​且振幅为1。这是因为对于Ansatz来说，默认的输入量子态为<span class="math notranslate nohighlight">\(|0\rangle\)</span>​​，而且其中的参数<span class="math notranslate nohighlight">\(\theta_0\)</span>​​和<span class="math notranslate nohighlight">\(\theta_1\)</span>​​都为0，此时的<code class="docutils literal notranslate"><span class="pre">RX(0)</span></code>门和<code class="docutils literal notranslate"><span class="pre">RY(0)</span></code>门都相当于<code class="docutils literal notranslate"><span class="pre">I</span></code>门，因此整个线路演化的过程就是<span class="math notranslate nohighlight">\(|0\rangle\)</span>​​经过<span class="math notranslate nohighlight">\(I\cdot I\)</span>，那么最后输出的态当然就是<span class="math notranslate nohighlight">\(|0\rangle\)</span>​​​了。</p>
<p>那么完整的量子线路就是Encoder加上Ansatz。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># pylint: disable=W0104</span>
<span class="n">circuit</span> <span class="o">=</span> <span class="n">encoder</span> <span class="o">+</span> <span class="n">ansatz</span>                   <span class="c1"># 完整的量子线路由Encoder和Ansatz组成</span>
<span class="n">circuit</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space: pre;"><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">q0: ──H────</span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">RX</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">(alpha0)────</span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">RY</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">(alpha1)────</span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">RZ</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">(alpha2)────</span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">RX</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">(theta0)────</span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">RY</span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">(theta1)──</span>
</pre></div>
</div>
<p>从对完整的量子线路的Summary中可以看到，该量子线路由6个量子门组成，其中有5个含参量子门且参数为<span class="math notranslate nohighlight">\(\alpha_0,\alpha_1,\alpha_2,\theta_0,\theta_1\)</span>​​​，该量子线路调控的量子比特数为1。</p>
</section>
<section id="构建哈密顿量">
<h2>构建哈密顿量<a class="headerlink" href="#构建哈密顿量" title="Permalink to this headline"></a></h2>
<p>我们对第0位量子比特执行泡利<code class="docutils literal notranslate"><span class="pre">Z</span></code>算符测量，构建对应的哈密顿量。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindquantum.core</span> <span class="kn">import</span> <span class="n">QubitOperator</span>           <span class="c1"># 导入QubitOperator模块，用于构造泡利算符</span>
<span class="kn">from</span> <span class="nn">mindquantum.core</span> <span class="kn">import</span> <span class="n">Hamiltonian</span>             <span class="c1"># 导入Hamiltonian模块，用于构建哈密顿量</span>

<span class="n">ham</span> <span class="o">=</span> <span class="n">Hamiltonian</span><span class="p">(</span><span class="n">QubitOperator</span><span class="p">(</span><span class="s1">&#39;Z0&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>           <span class="c1"># 对第0位量子比特执行泡利Z算符测量，且将系数设置为-1，构建对应的哈密顿量</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ham</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
-1 [Z0]
</pre></div></div>
</div>
<p>从上述打印可以看到，此时构建的哈密顿量为对第0位量子比特执行泡利<code class="docutils literal notranslate"><span class="pre">Z</span></code>算符测量，且系数为-1。之所以将系数设为-1，是因为在量子神经网络的训练中，Ansatz中的参数的梯度会一直下降，同时测量值也会一直减少。如果最后收敛于-1，那么此时对应的量子态是<span class="math notranslate nohighlight">\(|1\rangle\)</span>而不是<span class="math notranslate nohighlight">\(|0\rangle\)</span>​，如下所示</p>
<div class="math notranslate nohighlight">
\[\langle 1|Z|1\rangle=-1.\]</div>
<p>而我们所希望得到的是<span class="math notranslate nohighlight">\(|0\rangle\)</span>态。所以，将系数设为-1，那么当测量值为-1时，此时对应的量子态就是<span class="math notranslate nohighlight">\(|0\rangle\)</span>态，如下所示</p>
<div class="math notranslate nohighlight">
\[\langle 0|(-Z)|0\rangle=-1.\]</div>
<p>说明：</p>
<p>（1）QubitOperator是作用于量子比特的算子的总和，主要用于构造泡利算符；一般格式如下：QubitOperator(term=None, coefficient=1.0)；</p>
<p>（2）Hamiltonian是哈密顿量包装器，主要用于构建哈密顿量，一般格式如下：Hamiltonian(QubitOperator(‘X0 Y2’, 0.5))，X0和Y2表示泡利<code class="docutils literal notranslate"><span class="pre">X</span></code>算符作用在第0位量子比特，泡利<code class="docutils literal notranslate"><span class="pre">Y</span></code>算符作用在第2位量子比特，系数为0.5。</p>
</section>
<section id="生成变分量子线路模拟算子">
<h2>生成变分量子线路模拟算子<a class="headerlink" href="#生成变分量子线路模拟算子" title="Permalink to this headline"></a></h2>
<p>对于上述搭建的量子线路，我们可以在MindQuantum生成一个变分量子线路模拟算子对其进行模拟。</p>
<p>首先，为了方便，我们对Encoder和Ansatz中的参数数组分别命名为encoder_names和ansatz_names。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">encoder_names</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">params_name</span>                   <span class="c1"># Encoder中所有参数组成的数组，encoder.para_name系统会自动生成</span>
<span class="n">ansatz_names</span> <span class="o">=</span> <span class="n">ansatz</span><span class="o">.</span><span class="n">params_name</span>                     <span class="c1"># Ansatz中所有参数组成的数组，ansatz.para_name系统会自动生成</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;encoder_names = &#39;</span><span class="p">,</span> <span class="n">encoder</span><span class="o">.</span><span class="n">params_name</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">ansatz_names =&#39;</span><span class="p">,</span> <span class="n">ansatz</span><span class="o">.</span><span class="n">params_name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
encoder_names =  [&#39;alpha0&#39;, &#39;alpha1&#39;, &#39;alpha2&#39;]
ansatz_names = [&#39;theta0&#39;, &#39;theta1&#39;]
</pre></div></div>
</div>
<p>从上述打印可以看到，encoder_names为Encoder中所有参数<span class="math notranslate nohighlight">\(\alpha_0, \alpha_1, \alpha_2\)</span>​组成的数组，ansatz_names为Ansatz中所有参数<span class="math notranslate nohighlight">\(\theta_0,\theta_1\)</span>​组成的数组，这两个数组会在生成变分量子线路模拟算子时用到。</p>
<p>然后，我们通过<code class="docutils literal notranslate"><span class="pre">Simulator</span></code>模块得到变分量子线路演化和梯度求解的算子。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 导入Simulator模块</span>
<span class="kn">from</span> <span class="nn">mindquantum.simulator</span> <span class="kn">import</span> <span class="n">Simulator</span>

<span class="c1"># 生成一个基于projectq后端的模拟器，并设置模拟器的比特数为量子线路的比特数。</span>
<span class="n">sim</span> <span class="o">=</span> <span class="n">Simulator</span><span class="p">(</span><span class="s1">&#39;projectq&#39;</span><span class="p">,</span> <span class="n">circuit</span><span class="o">.</span><span class="n">n_qubits</span><span class="p">)</span>

<span class="c1"># 获取模拟器基于当前量子态的量子线路演化以及期望、梯度求解算子</span>
<span class="n">grad_ops</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_expectation_with_grad</span><span class="p">(</span><span class="n">ham</span><span class="p">,</span>
                                         <span class="n">circuit</span><span class="p">,</span>
                                         <span class="n">encoder_params_name</span><span class="o">=</span><span class="n">encoder_names</span><span class="p">,</span>
                                         <span class="n">ansatz_params_name</span><span class="o">=</span><span class="n">ansatz_names</span><span class="p">)</span>

<span class="c1"># Encoder中的alpha0, alpha1, alpha2这三个参数组成的数组，</span>
<span class="c1"># 将其数据类型转换为float32，并储存在encoder_data中。</span>
<span class="c1"># MindQuantum支持多样本的batch训练，Encoder数组是两个维度，</span>
<span class="c1"># 第一个维度为样本，第二个维度为特征（即参数）</span>
<span class="n">encoder_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">alpha0</span><span class="p">,</span> <span class="n">alpha1</span><span class="p">,</span> <span class="n">alpha2</span><span class="p">]])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="c1"># Ansatz中的theta0, theta1这两个参数组成的数组，将其数据类型转换为float32，</span>
<span class="c1"># 并储存在ansatzr_data中，Ansatz数据只有一个维度，特征（即参数）</span>
<span class="n">ansatz_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">theta0</span><span class="p">,</span> <span class="n">theta1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="c1"># 根据Encoder和Ansatz的数据，输出变分量子线路的测量值，Encoder中的参数的导数和Ansatz中的参数的导数</span>
<span class="n">measure_result</span><span class="p">,</span> <span class="n">encoder_grad</span><span class="p">,</span> <span class="n">ansatz_grad</span> <span class="o">=</span> <span class="n">grad_ops</span><span class="p">(</span><span class="n">encoder_data</span><span class="p">,</span> <span class="n">ansatz_data</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Measurement result: &#39;</span><span class="p">,</span> <span class="n">measure_result</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Gradient of encoder parameters: &#39;</span><span class="p">,</span> <span class="n">encoder_grad</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Gradient of ansatz parameters: &#39;</span><span class="p">,</span> <span class="n">ansatz_grad</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Measurement result:  [[0.29552022+0.j]]
Gradient of encoder parameters:  [[[0.+0.j 0.+0.j 0.+0.j]]]
Gradient of ansatz parameters:  [[[-0.37202556+0.j  0.87992317+0.j]]]
</pre></div></div>
</div>
<p>从上述打印可以看到，测量结果（期望值）为0.29552022，Encoder中的3个参数的导数为0，0，0（因为我们对Encoder设置了no_grad()），Ansatz中的2个参数的导数为-0.37202555，-0.87992316。</p>
<p>这里通过<code class="docutils literal notranslate"><span class="pre">get_expectation_with_grad</span></code>产生的只是一个算子，还不能进行训练，要把它放到量子神经网络里面才能进行训练。通过训练Ansatz中的参数，可以使得Ansatz中的参数的导数一直下降并接近于0，那么测量值也就会接近于-1。</p>
<p>说明：</p>
<p>（1）<code class="docutils literal notranslate"><span class="pre">Simulator</span></code>的<code class="docutils literal notranslate"><span class="pre">get_expectation_with_grad</span></code>用于生成变分量子线路来模拟算子，一般格式如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Simulator</span><span class="o">.</span><span class="n">get_expectation_with_grad</span><span class="p">(</span><span class="n">ham</span><span class="p">,</span>
                                    <span class="n">circ_right</span><span class="p">,</span>
                                    <span class="n">circ_left</span><span class="p">,</span>
                                    <span class="n">encoder_params_name</span><span class="p">,</span>
                                    <span class="n">ansatz_params_name</span><span class="p">,</span>
                                    <span class="n">parallel_worker</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>此函数适用于计算如下模型：</p>
<div class="math notranslate nohighlight">
\[E=\left&lt;0\right|U^\dagger_l(\theta) H U_r(\theta)\left|0\right&gt;\]</div>
<p>其中<code class="docutils literal notranslate"><span class="pre">circ_right</span></code>是<span class="math notranslate nohighlight">\(U_r\)</span>，<code class="docutils literal notranslate"><span class="pre">circ_left</span></code>是<span class="math notranslate nohighlight">\(U_l\)</span>，当不提供时，默认跟<code class="docutils literal notranslate"><span class="pre">circ_right</span></code>是相同的线路，<code class="docutils literal notranslate"><span class="pre">encoder_params_name</span></code>指定整个体系中哪些参数是属于编码器中的参数，编码器可以将经典数据通过feature mapping映射到高位希尔伯特空间中，<code class="docutils literal notranslate"><span class="pre">ansatz_params_name</span></code>指定整个体系中哪些参数是属于待训练线路中的参数，<code class="docutils literal notranslate"><span class="pre">parallel_worker</span></code>指定并行数，当需要编码的经典数据是一个batch时，合理设置此参数可以提高计算效率。</p>
<p>（2）MindSpore是一个全场景深度学习框架，旨在实现易开发、高效执行、全场景覆盖三大目标，提供支持异构加速的张量可微编程能力，支持云、服务器、边和端多种硬件平台。</p>
</section>
<section id="搭建量子神经网络">
<h2>搭建量子神经网络<a class="headerlink" href="#搭建量子神经网络" title="Permalink to this headline"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># pylint: disable=W0104</span>
<span class="kn">from</span> <span class="nn">mindquantum.framework</span> <span class="kn">import</span> <span class="n">MQLayer</span>          <span class="c1"># 导入MQLayer</span>
<span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>                             <span class="c1"># 导入mindspore</span>

<span class="n">ms</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>                                     <span class="c1"># 设置生成随机数的种子</span>
<span class="n">ms</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">PYNATIVE_MODE</span><span class="p">,</span> <span class="n">device_target</span><span class="o">=</span><span class="s2">&quot;CPU&quot;</span><span class="p">)</span>

<span class="n">QuantumNet</span> <span class="o">=</span> <span class="n">MQLayer</span><span class="p">(</span><span class="n">grad_ops</span><span class="p">)</span>
<span class="n">QuantumNet</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MQLayer&lt;
  (evolution): MQOps&lt;1 qubit projectq VQA Operator&gt;
  &gt;
</pre></div></div>
</div>
<p>上述打印可以看到，我们已经成功搭建了量子机器学习层，其可以无缝地跟MindSpore中其它的算子构成一张更大的机器学习网络。</p>
<p>说明：</p>
<p>（1）MindQuantum中的量子线路梯度计算算子都是在<code class="docutils literal notranslate"><span class="pre">PYNATIVE_MODE</span></code>下的，因此需要设置MindSpore的运行模式。</p>
<p>（2）我们也可以通过如下代码方式搭建量子机器学习层，只是在MindQuantum中，已经将下述过程封装打包，这样我们就可以直接利用MQLayer模块搭建量子机器学习层。对于更复杂的量子-经典混合神经网络，如下搭建方式会展示它的优势。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MQLayer</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expectation_with_grad</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MQLayer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evolution</span> <span class="o">=</span> <span class="n">MQOps</span><span class="p">(</span><span class="n">expectation_with_grad</span><span class="p">)</span>
        <span class="n">weight_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">evolution</span><span class="o">.</span><span class="n">expectation_with_grad</span><span class="o">.</span><span class="n">ansatz_params_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">initializer</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span>
                                            <span class="n">weight_size</span><span class="p">,</span>
                                            <span class="n">dtype</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
                                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;ansatz_weight&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evolution</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="训练">
<h2>训练<a class="headerlink" href="#训练" title="Permalink to this headline"></a></h2>
<p>我们采用Adam优化器优化Ansatz中的参数。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindspore.nn</span> <span class="kn">import</span> <span class="n">Adam</span><span class="p">,</span> <span class="n">TrainOneStepCell</span>                   <span class="c1"># 导入Adam模块和TrainOneStepCell模块</span>

<span class="n">opti</span> <span class="o">=</span> <span class="n">Adam</span><span class="p">(</span><span class="n">QuantumNet</span><span class="o">.</span><span class="n">trainable_params</span><span class="p">(),</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>     <span class="c1"># 需要优化的是Quantumnet中可训练的参数，学习率设为0.5</span>
<span class="n">net</span> <span class="o">=</span> <span class="n">TrainOneStepCell</span><span class="p">(</span><span class="n">QuantumNet</span><span class="p">,</span> <span class="n">opti</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">200</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">net</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">encoder_data</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0 :  [[0.2837115]]
10 :  [[-0.8851233]]
20 :  [[-0.97001773]]
30 :  [[-0.9929431]]
40 :  [[-0.9939507]]
50 :  [[-0.9967015]]
60 :  [[-0.99878186]]
70 :  [[-0.9995535]]
80 :  [[-0.9999011]]
90 :  [[-0.99998033]]
100 :  [[-0.9999989]]
110 :  [[-0.99999785]]
120 :  [[-0.999997]]
130 :  [[-0.9999987]]
140 :  [[-0.9999998]]
150 :  [[-1.]]
160 :  [[-0.99999994]]
170 :  [[-1.]]
180 :  [[-1.]]
190 :  [[-1.]]
</pre></div></div>
</div>
<p>从上述打印可以看到，最后测量值收敛于-1。</p>
<p>说明：</p>
<p>（1）Adam模块通过自适应矩估计算法更新梯度，可以优化Ansazt中的参数，输入的是神经网络中可训练的参数；一般格式如下：nn.Adam(net.trainable_params(), learning_rate=0.5)；</p>
<p>（2）TrainOneStepCell模块为网络训练包类，用优化器包装网络。生成的单元格使用输入“inputs”进行训练，将在构造函数中创建反向图，以更新参数，有不同的并行模式可用于训练。一般格式如下：nn.TrainOneStepCell(network, optimizer, sens=1.0)。</p>
</section>
<section id="结果呈现">
<h2>结果呈现<a class="headerlink" href="#结果呈现" title="Permalink to this headline"></a></h2>
<p>由于测量值已经收敛于-1，所以我们可以打印此时Ansatz中的参数。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">theta0</span><span class="p">,</span> <span class="n">theta1</span> <span class="o">=</span> <span class="n">QuantumNet</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">QuantumNet</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[ 2.2420275 -1.0756909]
</pre></div></div>
</div>
<p>从上述打印可以看到，此时Ansatz中的参数<span class="math notranslate nohighlight">\(\theta_1, \theta_2\)</span>分别为2.2420275和-1.0756909。</p>
<p>通过<code class="docutils literal notranslate"><span class="pre">get_qs</span></code>，可以输出量子线路在最优参数时的量子态。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pr</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;alpha0&#39;</span><span class="p">:</span> <span class="n">alpha0</span><span class="p">,</span> <span class="s1">&#39;alpha1&#39;</span><span class="p">:</span> <span class="n">alpha1</span><span class="p">,</span> <span class="s1">&#39;alpha2&#39;</span><span class="p">:</span> <span class="n">alpha2</span><span class="p">,</span> <span class="s1">&#39;theta0&#39;</span><span class="p">:</span> <span class="n">theta0</span><span class="p">,</span> <span class="s1">&#39;theta1&#39;</span><span class="p">:</span> <span class="n">theta1</span><span class="p">}</span>
<span class="n">state</span> <span class="o">=</span> <span class="n">circuit</span><span class="o">.</span><span class="n">get_qs</span><span class="p">(</span><span class="n">pr</span><span class="o">=</span><span class="n">pr</span><span class="p">,</span> <span class="n">ket</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(0.37129760050057437-0.9285139157007681j)¦0⟩
(1.4564552975271372e-05+6.455516706194153e-07j)¦1⟩
</pre></div></div>
</div>
<p>从上述打印可以看到，这就是量子线路在最优参数时的量子态。从其数值表示可以看到，这是一个接近于目标态<span class="math notranslate nohighlight">\(|0\rangle\)</span>​​​的态。最后，我们计算一下此量子态与目标态<span class="math notranslate nohighlight">\(|0\rangle\)</span>​​​​​的保真度（用于验证两个量子态的相似程度），并将保真度打印。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">state</span> <span class="o">=</span> <span class="n">circuit</span><span class="o">.</span><span class="n">get_qs</span><span class="p">(</span><span class="n">pr</span><span class="o">=</span><span class="n">pr</span><span class="p">)</span>
<span class="n">fid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vdot</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span><span class="o">**</span><span class="mi">2</span>            <span class="c1"># 保真度fidelity为向量内积的绝对值的模平方，即计算此时量子态对应的向量与|0&gt;态对应的向量[1,0]的内积的模平方</span>

<span class="nb">print</span><span class="p">(</span><span class="n">fid</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.9999999997874571
</pre></div></div>
</div>
<p>可以看到，此时的保真度为100.00%，也就是说，该状态与目标态<span class="math notranslate nohighlight">\(|0\rangle\)</span>​​的相似程度为100.00%。</p>
<p>综上所述，我们搭建了一个简单的量子神经网络，通过训练Ansatz中的参数，抵消了Encoder对初始量子态产生的误差，使得最后的量子态仍为<span class="math notranslate nohighlight">\(|0\rangle\)</span>​，且保真度达到100.00%。</p>
<p>至此，我们通过MindQuantum完成了对量子神经网络的初体验！赶紧动手体验一下量子编程的乐趣吧！</p>
<p>若想查询更多关于MindQuantum的API，请点击：<a class="reference external" href="https://mindspore.cn/mindquantum/">https://mindspore.cn/mindquantum/</a>。</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="parameterized_quantum_circuit.html" class="btn btn-neutral float-left" title="变分量子线路" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="get_gradient_of_PQC_with_mindquantum.html" class="btn btn-neutral float-right" title="变分量子线路梯度计算进阶" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, MindSpore.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>