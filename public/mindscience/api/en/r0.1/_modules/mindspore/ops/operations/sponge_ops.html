<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>mindspore.ops.operations.sponge_ops &mdash; MindSpore master documentation</title><link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../../index.html" class="icon icon-home"> MindSpore
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../mindsponge.html">MindSPONGE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mindelec.html">MindElec</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">MindSpore</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
      <li>mindspore.ops.operations.sponge_ops</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for mindspore.ops.operations.sponge_ops</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2021 Huawei Technologies Co., Ltd</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1"># http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>
<span class="c1"># ============================================================================</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Note:</span>
<span class="sd">  SPONGE operators. This is an experimental interface that is subject to change and/or deletion.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">math</span>

<span class="kn">from</span> <span class="nn">..primitive</span> <span class="kn">import</span> <span class="n">PrimitiveWithInfer</span><span class="p">,</span> <span class="n">prim_attr_register</span>
<span class="kn">from</span> <span class="nn">..._checkparam</span> <span class="kn">import</span> <span class="n">Rel</span>
<span class="kn">from</span> <span class="nn">..._checkparam</span> <span class="kn">import</span> <span class="n">Validator</span> <span class="k">as</span> <span class="n">validator</span>
<span class="kn">from</span> <span class="nn">...common</span> <span class="kn">import</span> <span class="n">dtype</span> <span class="k">as</span> <span class="n">mstype</span>


<div class="viewcode-block" id="BondForce"><a class="viewcode-back" href="../../../../mindsponge/mindspore.ops.BondForce.html#mindspore.ops.BondForce">[docs]</a><span class="k">class</span> <span class="nc">BondForce</span><span class="p">(</span><span class="n">PrimitiveWithInfer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the force exerted by the simple harmonic bond on the corresponding atoms.</span>
<span class="sd">    Assume the number of harmonic bonds is m and the number of atoms is n.</span>

<span class="sd">    Because there is a large amount of inputs and each of them are related,</span>
<span class="sd">    there is no way to construct `Examples` using random methods. For details, refer the webpage `SPONGE in MindSpore</span>
<span class="sd">    &lt;https://gitee.com/mindspore/mindscience/blob/master/MindSPONGE/docs/simple_formula.md&gt;`_.</span>

<span class="sd">    .. math::</span>

<span class="sd">        dr = (x_1-x_2, y_1-y_2, z_1-z_2)</span>

<span class="sd">    .. math::</span>

<span class="sd">        F = (F_x, F_y, F_z) = 2*k*(1 - r_0/|dr|)*dr</span>

<span class="sd">    Args:</span>
<span class="sd">        atom_numbers(int32): the number of atoms n.</span>
<span class="sd">        bond_numbers(int32): the number of harmonic bonds m.</span>

<span class="sd">    Inputs:</span>
<span class="sd">        - **uint_crd_f** (Tensor) - The unsigned int coordinate value of each atom.</span>
<span class="sd">          The data type is uint32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **scaler_f** (Tensor) - The 3-D scale factor (x, y, z),</span>
<span class="sd">          between the real space float coordinates and the unsigned int coordinates.</span>
<span class="sd">          The data type is float32  and the shape is :math:`(3,)`.</span>
<span class="sd">        - **atom_a** (Tensor) - The first atom index of each bond.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **atom_b** (Tensor) - The second atom index of each bond.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **bond_k** (Tensor) - The force constant of each bond.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **bond_r0** (Tensor) - The equlibrium length of each bond.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>

<span class="sd">    Outputs:</span>
<span class="sd">        - **frc_f** (Tensor) - The force felt by each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n, 3)`.</span>

<span class="sd">    Supported Platforms:</span>
<span class="sd">        ``GPU``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@prim_attr_register</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bond_numbers</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize BondForce.&quot;&quot;&quot;</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;bond_numbers&#39;</span><span class="p">,</span> <span class="n">bond_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bond_numbers</span> <span class="o">=</span> <span class="n">bond_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span> <span class="o">=</span> <span class="n">atom_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;bond_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bond_numbers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_prim_io_names</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;uint_crd_f&#39;</span><span class="p">,</span> <span class="s1">&#39;scaler_f&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_a&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_b&#39;</span><span class="p">,</span> <span class="s1">&#39;bond_k&#39;</span><span class="p">,</span> <span class="s1">&#39;bond_r0&#39;</span><span class="p">],</span>
                                <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;frc_f&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">infer_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_f_shape</span><span class="p">,</span> <span class="n">scaler_f_shape</span><span class="p">,</span> <span class="n">atom_a_shape</span><span class="p">,</span> <span class="n">atom_b_shape</span><span class="p">,</span> <span class="n">bond_k_shape</span><span class="p">,</span> <span class="n">bond_r0_shape</span><span class="p">):</span>
        <span class="n">cls_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bond_numbers</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scaler_f_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;scaler_f_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_a_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_a_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_b_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_b_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bond_k_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;bond_k_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bond_r0_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;bond_r0_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_shape[0]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_shape[1]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">scaler_f_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;scaler_f_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_a_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_b_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_b_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">bond_k_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;bond_k_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">bond_r0_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;bond_r0_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">uint_crd_f_shape</span>

    <span class="k">def</span> <span class="nf">infer_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_f_dtype</span><span class="p">,</span> <span class="n">scaler_f_type</span><span class="p">,</span> <span class="n">atom_a_type</span><span class="p">,</span> <span class="n">atom_b_type</span><span class="p">,</span> <span class="n">bond_k_type</span><span class="p">,</span> <span class="n">bond_r0_type</span><span class="p">):</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;uint_crd_f&#39;</span><span class="p">,</span> <span class="n">uint_crd_f_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">uint32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;scaler_f&#39;</span><span class="p">,</span> <span class="n">scaler_f_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_a&#39;</span><span class="p">,</span> <span class="n">atom_a_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_b&#39;</span><span class="p">,</span> <span class="n">atom_b_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;bond_k&#39;</span><span class="p">,</span> <span class="n">bond_k_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;bond_r0&#39;</span><span class="p">,</span> <span class="n">bond_r0_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bond_r0_type</span></div>


<div class="viewcode-block" id="BondEnergy"><a class="viewcode-back" href="../../../../mindsponge/mindspore.ops.BondEnergy.html#mindspore.ops.BondEnergy">[docs]</a><span class="k">class</span> <span class="nc">BondEnergy</span><span class="p">(</span><span class="n">PrimitiveWithInfer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the harmonic potential energy between each bonded atom pair.</span>
<span class="sd">    Assume our system has n atoms and m harmonic bonds.</span>

<span class="sd">    Because there is a large amount of inputs and each of them are related,</span>
<span class="sd">    there is no way to construct `Examples` using random methods. For details, refer the webpage `SPONGE in MindSpore</span>
<span class="sd">    &lt;https://gitee.com/mindspore/mindscience/blob/master/MindSPONGE/docs/simple_formula.md&gt;`_.</span>

<span class="sd">    .. math::</span>

<span class="sd">        dr = (x_1-x_2, y_1-y_2, z_1-z_2)</span>

<span class="sd">    .. math::</span>

<span class="sd">        E = k*(|dr| - r_0)^2</span>

<span class="sd">    Args:</span>
<span class="sd">        atom_numbers(int32): the number of atoms n.</span>
<span class="sd">        bond_numbers(int32): the number of harmonic bonds m.</span>

<span class="sd">    Inputs:</span>
<span class="sd">        - **uint_crd_f** (Tensor) - The unsigned int coordinate value of each atom.</span>
<span class="sd">          The data type is uint32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **scaler_f** (Tensor) - The 3-D scale factor (x, y, z),</span>
<span class="sd">          between the real space float coordinates and the unsigned int coordinates.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(3,)`.</span>
<span class="sd">        - **atom_a** (Tensor) - The first atom index of each bond.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **atom_b** (Tensor) - The second atom index of each bond.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **bond_k** (Tensor) - The force constant of each bond.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **bond_r0** (Tensor) - The equlibrium length of each bond.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>

<span class="sd">    Outputs:</span>
<span class="sd">        - **bond_ene** (Tensor) - The harmonic potential energy for each bond.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>

<span class="sd">    Supported Platforms:</span>
<span class="sd">        ``GPU``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@prim_attr_register</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bond_numbers</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize BondEnergy.&quot;&quot;&quot;</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;bond_numbers&#39;</span><span class="p">,</span> <span class="n">bond_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bond_numbers</span> <span class="o">=</span> <span class="n">bond_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span> <span class="o">=</span> <span class="n">atom_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;bond_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bond_numbers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_prim_io_names</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;uint_crd_f&#39;</span><span class="p">,</span> <span class="s1">&#39;scaler_f&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_a&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_b&#39;</span><span class="p">,</span> <span class="s1">&#39;bond_k&#39;</span><span class="p">,</span> <span class="s1">&#39;bond_r0&#39;</span><span class="p">],</span>
                                <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;bond_ene&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">infer_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_f_shape</span><span class="p">,</span> <span class="n">scaler_f_shape</span><span class="p">,</span> <span class="n">atom_a_shape</span><span class="p">,</span> <span class="n">atom_b_shape</span><span class="p">,</span> <span class="n">bond_k_shape</span><span class="p">,</span> <span class="n">bond_r0_shape</span><span class="p">):</span>
        <span class="n">cls_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bond_numbers</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scaler_f_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;scaler_f_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_a_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_a_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_b_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_b_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bond_k_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;bond_k_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bond_r0_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;bond_r0_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_shape[0]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_shape[1]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">scaler_f_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;scaler_f_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_a_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_b_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_b_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">bond_k_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;bond_k_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">bond_r0_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;bond_r0_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">bond_k_shape</span>

    <span class="k">def</span> <span class="nf">infer_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_f_dtype</span><span class="p">,</span> <span class="n">scaler_f_type</span><span class="p">,</span> <span class="n">atom_a_type</span><span class="p">,</span> <span class="n">atom_b_type</span><span class="p">,</span> <span class="n">bond_k_type</span><span class="p">,</span> <span class="n">bond_r0_type</span><span class="p">):</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;uint_crd_f&#39;</span><span class="p">,</span> <span class="n">uint_crd_f_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">uint32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;scaler_f&#39;</span><span class="p">,</span> <span class="n">scaler_f_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_a&#39;</span><span class="p">,</span> <span class="n">atom_a_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_b&#39;</span><span class="p">,</span> <span class="n">atom_b_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;bond_k&#39;</span><span class="p">,</span> <span class="n">bond_k_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;bond_r0&#39;</span><span class="p">,</span> <span class="n">bond_r0_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bond_r0_type</span></div>


<div class="viewcode-block" id="BondAtomEnergy"><a class="viewcode-back" href="../../../../mindsponge/mindspore.ops.BondAtomEnergy.html#mindspore.ops.BondAtomEnergy">[docs]</a><span class="k">class</span> <span class="nc">BondAtomEnergy</span><span class="p">(</span><span class="n">PrimitiveWithInfer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add the potential energy caused by simple harmonic bonds to the total</span>
<span class="sd">    potential energy of each atom.</span>

<span class="sd">    The calculation formula is the same as operator BondEnergy().</span>

<span class="sd">    Because there is a large amount of inputs and each of them are related,</span>
<span class="sd">    there is no way to construct `Examples` using random methods. For details, refer the webpage `SPONGE in MindSpore</span>
<span class="sd">    &lt;https://gitee.com/mindspore/mindscience/blob/master/MindSPONGE/docs/simple_formula.md&gt;`_.</span>

<span class="sd">    Args:</span>
<span class="sd">        atom_numbers(int32): the number of atoms n.</span>
<span class="sd">        bond_numbers(int32): the number of harmonic bonds m.</span>

<span class="sd">    Inputs:</span>
<span class="sd">        - **uint_crd_f** (Tensor) - The unsigned int coordinate value of each atom.</span>
<span class="sd">          The data type is uint32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **scaler_f** (Tensor) - The 3-D scale factor (x, y, z),</span>
<span class="sd">          between the real space float coordinates and the unsigned int coordinates.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(3,)`.</span>
<span class="sd">        - **atom_a** (Tensor) - The first atom index of each bond.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **atom_b** (Tensor) - The second atom index of each bond.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **bond_k** (Tensor) - The force constant of each bond.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **bond_r0** (Tensor) - The equlibrium length of each bond.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>

<span class="sd">    Outputs:</span>
<span class="sd">        - **atom_ene** (Tensor) - The accumulated potential energy for each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n,)`.</span>

<span class="sd">    Supported Platforms:</span>
<span class="sd">        ``GPU``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@prim_attr_register</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bond_numbers</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize BondAtomEnergy.&quot;&quot;&quot;</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;bond_numbers&#39;</span><span class="p">,</span> <span class="n">bond_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bond_numbers</span> <span class="o">=</span> <span class="n">bond_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span> <span class="o">=</span> <span class="n">atom_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;bond_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bond_numbers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_prim_io_names</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;uint_crd_f&#39;</span><span class="p">,</span> <span class="s1">&#39;scaler_f&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_a&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_b&#39;</span><span class="p">,</span> <span class="s1">&#39;bond_k&#39;</span><span class="p">,</span> <span class="s1">&#39;bond_r0&#39;</span><span class="p">],</span>
                                <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;atom_ene&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">infer_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_f_shape</span><span class="p">,</span> <span class="n">scaler_f_shape</span><span class="p">,</span> <span class="n">atom_a_shape</span><span class="p">,</span> <span class="n">atom_b_shape</span><span class="p">,</span> <span class="n">bond_k_shape</span><span class="p">,</span> <span class="n">bond_r0_shape</span><span class="p">):</span>
        <span class="n">cls_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bond_numbers</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scaler_f_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;scaler_f_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_a_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_a_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_b_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_b_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bond_k_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;bond_k_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bond_r0_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;bond_r0_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_shape[0]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_shape[1]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">scaler_f_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;scaler_f_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_a_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_b_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_b_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">bond_k_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;bond_k_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">bond_r0_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;bond_r0_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">n</span><span class="p">,]</span>

    <span class="k">def</span> <span class="nf">infer_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_f_dtype</span><span class="p">,</span> <span class="n">scaler_f_type</span><span class="p">,</span> <span class="n">atom_a_type</span><span class="p">,</span> <span class="n">atom_b_type</span><span class="p">,</span> <span class="n">bond_k_type</span><span class="p">,</span> <span class="n">bond_r0_type</span><span class="p">):</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;uint_crd_f&#39;</span><span class="p">,</span> <span class="n">uint_crd_f_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">uint32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;scaler_f&#39;</span><span class="p">,</span> <span class="n">scaler_f_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_a&#39;</span><span class="p">,</span> <span class="n">atom_a_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_b&#39;</span><span class="p">,</span> <span class="n">atom_b_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;bond_k&#39;</span><span class="p">,</span> <span class="n">bond_k_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;bond_r0&#39;</span><span class="p">,</span> <span class="n">bond_r0_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bond_r0_type</span></div>


<div class="viewcode-block" id="BondForceWithAtomEnergy"><a class="viewcode-back" href="../../../../mindsponge/mindspore.ops.BondForceWithAtomEnergy.html#mindspore.ops.BondForceWithAtomEnergy">[docs]</a><span class="k">class</span> <span class="nc">BondForceWithAtomEnergy</span><span class="p">(</span><span class="n">PrimitiveWithInfer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate bond force and harmonic potential energy together.</span>

<span class="sd">    The calculation formula is the same as operator BondForce() and BondEnergy().</span>

<span class="sd">    Because there is a large amount of inputs and each of them are related,</span>
<span class="sd">    there is no way to construct `Examples` using random methods. For details, refer the webpage `SPONGE in MindSpore</span>
<span class="sd">    &lt;https://gitee.com/mindspore/mindscience/blob/master/MindSPONGE/docs/simple_formula.md&gt;`_.</span>

<span class="sd">    Args:</span>
<span class="sd">        atom_numbers(int32): the number of atoms n.</span>
<span class="sd">        bond_numbers(int32): the number of harmonic bonds m.</span>

<span class="sd">    Inputs:</span>
<span class="sd">        - **uint_crd_f** (Tensor) - The unsigned int coordinate value of each atom.</span>
<span class="sd">          The data type is uint32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **scaler_f** (Tensor) - The 3-D scale factor (x, y, z),</span>
<span class="sd">          between the real space float coordinates and the unsigned int coordinates.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(3,)`.</span>
<span class="sd">        - **atom_a** (Tensor) - The first atom index of each bond.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **atom_b** (Tensor) - The second atom index of each bond.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **bond_k** (Tensor) - The force constant of each bond.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **bond_r0** (Tensor) - The equlibrium length of each bond.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>

<span class="sd">    Outputs:</span>
<span class="sd">        - **frc_f** (Tensor) - The force felt by each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **atom_e** (Tensor) - The accumulated potential energy for each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n,)`.</span>

<span class="sd">    Supported Platforms:</span>
<span class="sd">        ``GPU``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@prim_attr_register</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bond_numbers</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize BondForceWithAtomEnergy.&quot;&quot;&quot;</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;bond_numbers&#39;</span><span class="p">,</span> <span class="n">bond_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bond_numbers</span> <span class="o">=</span> <span class="n">bond_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span> <span class="o">=</span> <span class="n">atom_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;bond_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bond_numbers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_prim_io_names</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;uint_crd_f&#39;</span><span class="p">,</span> <span class="s1">&#39;scaler_f&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_a&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_b&#39;</span><span class="p">,</span> <span class="s1">&#39;bond_k&#39;</span><span class="p">,</span> <span class="s1">&#39;bond_r0&#39;</span><span class="p">],</span>
                                <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;frc_f&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_e&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">infer_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_f_shape</span><span class="p">,</span> <span class="n">scaler_f_shape</span><span class="p">,</span> <span class="n">atom_a_shape</span><span class="p">,</span> <span class="n">atom_b_shape</span><span class="p">,</span> <span class="n">bond_k_shape</span><span class="p">,</span> <span class="n">bond_r0_shape</span><span class="p">):</span>
        <span class="n">cls_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bond_numbers</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scaler_f_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;scaler_f_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_a_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_a_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_b_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_b_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bond_k_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;bond_k_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bond_r0_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;bond_r0_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_shape[0]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_shape[1]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">scaler_f_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;scaler_f_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_a_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_b_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_b_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">bond_k_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;bond_k_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">bond_r0_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;bond_r0_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">uint_crd_f_shape</span><span class="p">,</span> <span class="p">[</span><span class="n">n</span><span class="p">,]</span>

    <span class="k">def</span> <span class="nf">infer_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_f_dtype</span><span class="p">,</span> <span class="n">scaler_f_type</span><span class="p">,</span> <span class="n">atom_a_type</span><span class="p">,</span> <span class="n">atom_b_type</span><span class="p">,</span> <span class="n">bond_k_type</span><span class="p">,</span> <span class="n">bond_r0_type</span><span class="p">):</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;uint_crd_f&#39;</span><span class="p">,</span> <span class="n">uint_crd_f_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">uint32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;scaler_f&#39;</span><span class="p">,</span> <span class="n">scaler_f_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_a&#39;</span><span class="p">,</span> <span class="n">atom_a_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_b&#39;</span><span class="p">,</span> <span class="n">atom_b_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;bond_k&#39;</span><span class="p">,</span> <span class="n">bond_k_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;bond_r0&#39;</span><span class="p">,</span> <span class="n">bond_r0_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bond_r0_type</span><span class="p">,</span> <span class="n">bond_r0_type</span></div>


<div class="viewcode-block" id="BondForceWithAtomVirial"><a class="viewcode-back" href="../../../../mindsponge/mindspore.ops.BondForceWithAtomVirial.html#mindspore.ops.BondForceWithAtomVirial">[docs]</a><span class="k">class</span> <span class="nc">BondForceWithAtomVirial</span><span class="p">(</span><span class="n">PrimitiveWithInfer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate bond force and the virial coefficient caused by simple harmonic</span>
<span class="sd">    bond for each atom together.</span>

<span class="sd">    The calculation formula of the force part is the same as operator BondForce().</span>

<span class="sd">    Because there is a large amount of inputs and each of them are related,</span>
<span class="sd">    there is no way to construct `Examples` using random methods. For details, refer the webpage `SPONGE in MindSpore</span>
<span class="sd">    &lt;https://gitee.com/mindspore/mindscience/blob/master/MindSPONGE/docs/simple_formula.md&gt;`_.</span>

<span class="sd">    The Virial part is as follows:</span>

<span class="sd">    .. math::</span>

<span class="sd">        dr = (x_1-x_2, y_1-y_2, z_1-z_2)</span>

<span class="sd">    .. math::</span>

<span class="sd">        virial = |dr|*(|dr| - r_0)*k</span>

<span class="sd">    Args:</span>
<span class="sd">        atom_numbers(int32): the number of atoms n.</span>
<span class="sd">        bond_numbers(int32): the number of harmonic bonds m.</span>

<span class="sd">    Inputs:</span>
<span class="sd">        - **uint_crd_f** (Tensor) - The unsigned int coordinate value of each atom.</span>
<span class="sd">          The data type is uint32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **scaler_f** (Tensor) - The 3-D scale factor (x, y, z),</span>
<span class="sd">          between the real space float coordinates and the unsigned int coordinates.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(3,)`.</span>
<span class="sd">        - **atom_a** (Tensor) - The first atom index of each bond.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **atom_b** (Tensor) - The second atom index of each bond.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **bond_k** (Tensor) - The force constant of each bond.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **bond_r0** (Tensor) - The equlibrium length of each bond.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>

<span class="sd">    Outputs:</span>
<span class="sd">        - **frc_f** (Tensor) - Same as operator BondForce().</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **atom_v** (Tensor) - The accumulated virial coefficient for each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n,)`.</span>

<span class="sd">    Supported Platforms:</span>
<span class="sd">        ``GPU``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@prim_attr_register</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bond_numbers</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize BondForceWithAtomVirial.&quot;&quot;&quot;</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;bond_numbers&#39;</span><span class="p">,</span> <span class="n">bond_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bond_numbers</span> <span class="o">=</span> <span class="n">bond_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span> <span class="o">=</span> <span class="n">atom_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;bond_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bond_numbers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_prim_io_names</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;uint_crd_f&#39;</span><span class="p">,</span> <span class="s1">&#39;scaler_f&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_a&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_b&#39;</span><span class="p">,</span> <span class="s1">&#39;bond_k&#39;</span><span class="p">,</span> <span class="s1">&#39;bond_r0&#39;</span><span class="p">],</span>
                                <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;frc_f&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_v&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">infer_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_f_shape</span><span class="p">,</span> <span class="n">scaler_f_shape</span><span class="p">,</span> <span class="n">atom_a_shape</span><span class="p">,</span> <span class="n">atom_b_shape</span><span class="p">,</span> <span class="n">bond_k_shape</span><span class="p">,</span> <span class="n">bond_r0_shape</span><span class="p">):</span>
        <span class="n">cls_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bond_numbers</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scaler_f_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;scaler_f_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_a_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_a_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_b_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_b_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bond_k_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;bond_k_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bond_r0_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;bond_r0_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_shape[0]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_shape[1]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">scaler_f_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;scaler_f_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_a_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_b_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_b_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">bond_k_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;bond_k_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">bond_r0_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;bond_r0_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">uint_crd_f_shape</span><span class="p">,</span> <span class="p">[</span><span class="n">n</span><span class="p">,]</span>

    <span class="k">def</span> <span class="nf">infer_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_f_dtype</span><span class="p">,</span> <span class="n">scaler_f_type</span><span class="p">,</span> <span class="n">atom_a_type</span><span class="p">,</span> <span class="n">atom_b_type</span><span class="p">,</span> <span class="n">bond_k_type</span><span class="p">,</span> <span class="n">bond_r0_type</span><span class="p">):</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;uint_crd_f&#39;</span><span class="p">,</span> <span class="n">uint_crd_f_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">uint32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;scaler_f&#39;</span><span class="p">,</span> <span class="n">scaler_f_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_a&#39;</span><span class="p">,</span> <span class="n">atom_a_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_b&#39;</span><span class="p">,</span> <span class="n">atom_b_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;bond_k&#39;</span><span class="p">,</span> <span class="n">bond_k_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;bond_r0&#39;</span><span class="p">,</span> <span class="n">bond_r0_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bond_r0_type</span><span class="p">,</span> <span class="n">bond_r0_type</span></div>


<div class="viewcode-block" id="DihedralForce"><a class="viewcode-back" href="../../../../mindsponge/mindspore.ops.DihedralForce.html#mindspore.ops.DihedralForce">[docs]</a><span class="k">class</span> <span class="nc">DihedralForce</span><span class="p">(</span><span class="n">PrimitiveWithInfer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the force exerted by the dihedral term which made of 4-atoms</span>
<span class="sd">    on the corresponding atoms. Assume the number of dihedral terms is m and</span>
<span class="sd">    the number of atoms is n.</span>

<span class="sd">    Because there is a large amount of inputs and each of them are related,</span>
<span class="sd">    there is no way to construct `Examples` using random methods. For details, refer the webpage `SPONGE in MindSpore</span>
<span class="sd">    &lt;https://gitee.com/mindspore/mindscience/blob/master/MindSPONGE/docs/simple_formula.md&gt;`_.</span>

<span class="sd">    Args:</span>
<span class="sd">        dihedral_numbers(int32): the number of dihedral terms m.</span>

<span class="sd">    Inputs:</span>
<span class="sd">        - **uint_crd_f** (Tensor) - The unsigned int coordinates</span>
<span class="sd">          value of each atom. The data type is uint32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **scaler_f** (Tensor) - The 3-D scale factor between</span>
<span class="sd">          the real space float coordinates and the unsigned int coordinates.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(3,)`.</span>
<span class="sd">        - **atom_a** (Tensor) - The 1st atom index of each dihedral.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **atom_b** (Tensor) - The 2nd atom index of each dihedral.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **atom_c** (Tensor) - The 3rd atom index of each dihedral.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **atom_d** (Tensor) - The 4th atom index of each dihedral.</span>
<span class="sd">          4 atoms are connected in the form a-b-c-d.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **ipn** (Tensor) - The period of dihedral angle of each dihedral.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **pk** (Tensor) - The force constant of each dihedral.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **gamc** (Tensor) - k*cos(phi_0) of each dihedral.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **gams** (Tensor) - k*sin(phi_0) of each dihedral.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **pn** (Tensor) - The floating point form of ipn.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>

<span class="sd">    Outputs:</span>
<span class="sd">        - **frc_f** (Tensor) - The force felt by each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n, 3)`.</span>

<span class="sd">    Supported Platforms:</span>
<span class="sd">        ``GPU``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@prim_attr_register</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dihedral_numbers</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize DihedralForce.&quot;&quot;&quot;</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;dihedral_numbers&#39;</span><span class="p">,</span> <span class="n">dihedral_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_numbers</span> <span class="o">=</span> <span class="n">dihedral_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_prim_io_names</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;uint_crd_f&#39;</span><span class="p">,</span> <span class="s1">&#39;scaler_f&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_a&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_b&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_c&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_d&#39;</span><span class="p">,</span> <span class="s1">&#39;ipn&#39;</span><span class="p">,</span> <span class="s1">&#39;pk&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;gamc&#39;</span><span class="p">,</span> <span class="s1">&#39;gams&#39;</span><span class="p">,</span> <span class="s1">&#39;pn&#39;</span><span class="p">],</span>
                                <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;frc_f&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;dihedral_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_numbers</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">infer_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_f_shape</span><span class="p">,</span> <span class="n">scaler_f_shape</span><span class="p">,</span> <span class="n">atom_a_shape</span><span class="p">,</span> <span class="n">atom_b_shape</span><span class="p">,</span> <span class="n">atom_c_shape</span><span class="p">,</span> <span class="n">atom_d_shape</span><span class="p">,</span>
                    <span class="n">ipn_shape</span><span class="p">,</span> <span class="n">pk_shape</span><span class="p">,</span> <span class="n">gamc_shape</span><span class="p">,</span> <span class="n">gams_shape</span><span class="p">,</span> <span class="n">pn_shape</span><span class="p">):</span>
        <span class="n">cls_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_numbers</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scaler_f_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;scaler_f_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_a_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_a_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_b_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_b_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_c_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_c_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_d_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_d_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ipn_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;ipn_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pk_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;pk_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gamc_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;gamc_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gams_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;gams_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pn_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;pn_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>

        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_shape[1]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">scaler_f_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;scaler_f_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_a_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_a_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_b_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_b_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_c_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_c_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_d_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_d_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">ipn_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;ipn_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">pk_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;pk_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">gamc_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;gamc_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">gams_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;gams_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">pn_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;pn_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">uint_crd_f_shape</span>

    <span class="k">def</span> <span class="nf">infer_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_f_dtype</span><span class="p">,</span> <span class="n">scaler_f_type</span><span class="p">,</span> <span class="n">atom_a_type</span><span class="p">,</span> <span class="n">atom_b_type</span><span class="p">,</span> <span class="n">atom_c_type</span><span class="p">,</span> <span class="n">atom_d_type</span><span class="p">,</span>
                    <span class="n">ipn_type</span><span class="p">,</span> <span class="n">pk_type</span><span class="p">,</span> <span class="n">gamc_type</span><span class="p">,</span> <span class="n">gams_type</span><span class="p">,</span> <span class="n">pn_type</span><span class="p">):</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;uint_crd_f&#39;</span><span class="p">,</span> <span class="n">uint_crd_f_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">uint32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;scaler_f&#39;</span><span class="p">,</span> <span class="n">scaler_f_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_a&#39;</span><span class="p">,</span> <span class="n">atom_a_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_b&#39;</span><span class="p">,</span> <span class="n">atom_b_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_c&#39;</span><span class="p">,</span> <span class="n">atom_c_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_d&#39;</span><span class="p">,</span> <span class="n">atom_d_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;ipn&#39;</span><span class="p">,</span> <span class="n">ipn_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;pk&#39;</span><span class="p">,</span> <span class="n">pk_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;gamc&#39;</span><span class="p">,</span> <span class="n">gamc_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;gams&#39;</span><span class="p">,</span> <span class="n">gams_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;pn&#39;</span><span class="p">,</span> <span class="n">pn_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">pn_type</span></div>


<div class="viewcode-block" id="DihedralEnergy"><a class="viewcode-back" href="../../../../mindsponge/mindspore.ops.DihedralEnergy.html#mindspore.ops.DihedralEnergy">[docs]</a><span class="k">class</span> <span class="nc">DihedralEnergy</span><span class="p">(</span><span class="n">PrimitiveWithInfer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the potential energy caused by dihedral terms for each 4-atom pair.</span>
<span class="sd">    Assume our system has n atoms and m dihedral terms.</span>

<span class="sd">    Because there is a large amount of inputs and each of them are related,</span>
<span class="sd">    there is no way to construct `Examples` using random methods. For details, refer the webpage `SPONGE in MindSpore</span>
<span class="sd">    &lt;https://gitee.com/mindspore/mindscience/blob/master/MindSPONGE/docs/simple_formula.md&gt;`_.</span>

<span class="sd">    Args:</span>
<span class="sd">        dihedral_numbers(int32): the number of dihedral terms m.</span>

<span class="sd">    Inputs:</span>
<span class="sd">        - **uint_crd_f** (Tensor) - The unsigned int coordinates</span>
<span class="sd">          value of each atom.</span>
<span class="sd">          The data type is uint32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **scaler_f** (Tensor) - The 3-D scale factor between</span>
<span class="sd">          the real space float coordinates and the unsigned int coordinates.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(3,)`.</span>
<span class="sd">        - **atom_a** (Tensor) - The 1st atom index of each dihedral.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **atom_b** (Tensor) - The 2nd atom index of each dihedral.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **atom_c** (Tensor) - The 3rd atom index of each dihedral.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **atom_d** (Tensor) - The 4th atom index of each dihedral.</span>
<span class="sd">          4 atoms are connected in the form a-b-c-d.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **ipn** (Tensor) - The period of dihedral angle of each dihedral.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **pk** (Tensor) - The force constant of each dihedral.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **gamc** (Tensor) - k*cos(phi_0) of each dihedral.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **gams** (Tensor) - k*sin(phi_0) of each dihedral.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **pn** (Tensor) - The floating point form of ipn.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>

<span class="sd">    Outputs:</span>
<span class="sd">        - **ene** (Tensor) - The potential energy for each</span>
<span class="sd">          dihedral term. The data type is float32 and the shape is :math:`(m,)`.</span>

<span class="sd">    Supported Platforms:</span>
<span class="sd">        ``GPU``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@prim_attr_register</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dihedral_numbers</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize DihedralEnergy.&quot;&quot;&quot;</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;dihedral_numbers&#39;</span><span class="p">,</span> <span class="n">dihedral_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_numbers</span> <span class="o">=</span> <span class="n">dihedral_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_prim_io_names</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;uint_crd_f&#39;</span><span class="p">,</span> <span class="s1">&#39;scaler_f&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_a&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_b&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_c&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_d&#39;</span><span class="p">,</span> <span class="s1">&#39;ipn&#39;</span><span class="p">,</span> <span class="s1">&#39;pk&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;gamc&#39;</span><span class="p">,</span> <span class="s1">&#39;gams&#39;</span><span class="p">,</span> <span class="s1">&#39;pn&#39;</span><span class="p">],</span>
                                <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ene&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;dihedral_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_numbers</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">infer_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_f_shape</span><span class="p">,</span> <span class="n">scaler_f_shape</span><span class="p">,</span> <span class="n">atom_a_shape</span><span class="p">,</span> <span class="n">atom_b_shape</span><span class="p">,</span> <span class="n">atom_c_shape</span><span class="p">,</span> <span class="n">atom_d_shape</span><span class="p">,</span>
                    <span class="n">ipn_shape</span><span class="p">,</span> <span class="n">pk_shape</span><span class="p">,</span> <span class="n">gamc_shape</span><span class="p">,</span> <span class="n">gams_shape</span><span class="p">,</span> <span class="n">pn_shape</span><span class="p">):</span>
        <span class="n">cls_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_numbers</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scaler_f_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;scaler_f_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_a_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_a_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_b_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_b_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_c_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_c_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_d_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_d_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ipn_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;ipn_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pk_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;pk_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gamc_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;gamc_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gams_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;gams_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pn_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;pn_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>

        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_shape[1]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">scaler_f_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;scaler_f_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_a_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_a_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_b_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_b_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_c_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_c_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_d_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_d_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">ipn_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;ipn_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">pk_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;pk_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">gamc_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;gamc_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">gams_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;gams_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">pn_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;pn_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">m</span><span class="p">,]</span>

    <span class="k">def</span> <span class="nf">infer_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_f_dtype</span><span class="p">,</span> <span class="n">scaler_f_type</span><span class="p">,</span> <span class="n">atom_a_type</span><span class="p">,</span> <span class="n">atom_b_type</span><span class="p">,</span> <span class="n">atom_c_type</span><span class="p">,</span> <span class="n">atom_d_type</span><span class="p">,</span>
                    <span class="n">ipn_type</span><span class="p">,</span> <span class="n">pk_type</span><span class="p">,</span> <span class="n">gamc_type</span><span class="p">,</span> <span class="n">gams_type</span><span class="p">,</span> <span class="n">pn_type</span><span class="p">):</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;uint_crd_f&#39;</span><span class="p">,</span> <span class="n">uint_crd_f_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">uint32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;scaler_f&#39;</span><span class="p">,</span> <span class="n">scaler_f_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_a&#39;</span><span class="p">,</span> <span class="n">atom_a_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_b&#39;</span><span class="p">,</span> <span class="n">atom_b_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_c&#39;</span><span class="p">,</span> <span class="n">atom_c_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_d&#39;</span><span class="p">,</span> <span class="n">atom_d_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;ipn&#39;</span><span class="p">,</span> <span class="n">ipn_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;pk&#39;</span><span class="p">,</span> <span class="n">pk_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;gamc&#39;</span><span class="p">,</span> <span class="n">gamc_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;gams&#39;</span><span class="p">,</span> <span class="n">gams_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;pn&#39;</span><span class="p">,</span> <span class="n">pn_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">pn_type</span></div>


<div class="viewcode-block" id="DihedralAtomEnergy"><a class="viewcode-back" href="../../../../mindsponge/mindspore.ops.DihedralAtomEnergy.html#mindspore.ops.DihedralAtomEnergy">[docs]</a><span class="k">class</span> <span class="nc">DihedralAtomEnergy</span><span class="p">(</span><span class="n">PrimitiveWithInfer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add the potential energy caused by dihedral terms to the total potential</span>
<span class="sd">    energy of each atom.</span>

<span class="sd">    Because there is a large amount of inputs and each of them are related,</span>
<span class="sd">    there is no way to construct `Examples` using random methods. For details, refer the webpage `SPONGE in MindSpore</span>
<span class="sd">    &lt;https://gitee.com/mindspore/mindscience/blob/master/MindSPONGE/docs/simple_formula.md&gt;`_.</span>

<span class="sd">    The calculation formula is the same as operator DihedralEnergy().</span>

<span class="sd">    Args:</span>
<span class="sd">        dihedral_numbers(int32): the number of dihedral terms m.</span>

<span class="sd">    Inputs:</span>
<span class="sd">        - **uint_crd_f** (Tensor) - The unsigned int coordinates</span>
<span class="sd">          value of each atom. The data type is uint32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **scaler_f** (Tensor) - The 3-D scale factor between</span>
<span class="sd">          the real space float coordinates and the unsigned int coordinates.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(3,)`.</span>
<span class="sd">        - **atom_a** (Tensor) - The 1st atom index of each dihedral.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **atom_b** (Tensor) - The 2nd atom index of each dihedral.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **atom_c** (Tenso) - The 3rd atom index of each dihedral.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **atom_d** (Tensor) - The 4th atom index of each dihedral.</span>
<span class="sd">          4 atoms are connected in the form a-b-c-d. The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **ipn** (Tensor) - The period of dihedral angle of each dihedral.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **pk** (Tensor) - The force constant of each dihedral.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **gamc** (Tensor) - k*cos(phi_0) of each dihedral.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **gams** (Tensor) - k*sin(phi_0) of each dihedral.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **pn** (Tensor) - The floating point form of ipn.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>

<span class="sd">    Outputs:</span>
<span class="sd">        - **ene** (Tensor) - The accumulated potential</span>
<span class="sd">          energy for each atom. The data type is float32 and the shape is :math:`(n,)`.</span>

<span class="sd">    Supported Platforms:</span>
<span class="sd">        ``GPU``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@prim_attr_register</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dihedral_numbers</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize DihedralAtomEnergy.&quot;&quot;&quot;</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;dihedral_numbers&#39;</span><span class="p">,</span> <span class="n">dihedral_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_numbers</span> <span class="o">=</span> <span class="n">dihedral_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_prim_io_names</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;uint_crd_f&#39;</span><span class="p">,</span> <span class="s1">&#39;scaler_f&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_a&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_b&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_c&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_d&#39;</span><span class="p">,</span> <span class="s1">&#39;ipn&#39;</span><span class="p">,</span> <span class="s1">&#39;pk&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;gamc&#39;</span><span class="p">,</span> <span class="s1">&#39;gams&#39;</span><span class="p">,</span> <span class="s1">&#39;pn&#39;</span><span class="p">],</span>
                                <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ene&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;dihedral_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_numbers</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">infer_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_f_shape</span><span class="p">,</span> <span class="n">scaler_f_shape</span><span class="p">,</span> <span class="n">atom_a_shape</span><span class="p">,</span> <span class="n">atom_b_shape</span><span class="p">,</span> <span class="n">atom_c_shape</span><span class="p">,</span> <span class="n">atom_d_shape</span><span class="p">,</span>
                    <span class="n">ipn_shape</span><span class="p">,</span> <span class="n">pk_shape</span><span class="p">,</span> <span class="n">gamc_shape</span><span class="p">,</span> <span class="n">gams_shape</span><span class="p">,</span> <span class="n">pn_shape</span><span class="p">):</span>
        <span class="n">cls_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">uint_crd_f_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_numbers</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scaler_f_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;scaler_f_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_a_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_a_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_b_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_b_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_c_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_c_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_d_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_d_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ipn_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;ipn_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pk_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;pk_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gamc_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;gamc_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gams_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;gams_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pn_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;pn_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>

        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_shape[1]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">scaler_f_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;scaler_f_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_a_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_a_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_b_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_b_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_c_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_c_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_d_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_d_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">ipn_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;ipn_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">pk_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;pk_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">gamc_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;gamc_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">gams_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;gams_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">pn_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;pn_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">n</span><span class="p">,]</span>

    <span class="k">def</span> <span class="nf">infer_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_f_dtype</span><span class="p">,</span> <span class="n">scaler_f_type</span><span class="p">,</span> <span class="n">atom_a_type</span><span class="p">,</span> <span class="n">atom_b_type</span><span class="p">,</span> <span class="n">atom_c_type</span><span class="p">,</span> <span class="n">atom_d_type</span><span class="p">,</span>
                    <span class="n">ipn_type</span><span class="p">,</span> <span class="n">pk_type</span><span class="p">,</span> <span class="n">gamc_type</span><span class="p">,</span> <span class="n">gams_type</span><span class="p">,</span> <span class="n">pn_type</span><span class="p">):</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;uint_crd_f&#39;</span><span class="p">,</span> <span class="n">uint_crd_f_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">uint32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;scaler_f&#39;</span><span class="p">,</span> <span class="n">scaler_f_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_a&#39;</span><span class="p">,</span> <span class="n">atom_a_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_b&#39;</span><span class="p">,</span> <span class="n">atom_b_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_c&#39;</span><span class="p">,</span> <span class="n">atom_c_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_d&#39;</span><span class="p">,</span> <span class="n">atom_d_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;ipn&#39;</span><span class="p">,</span> <span class="n">ipn_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;pk&#39;</span><span class="p">,</span> <span class="n">pk_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;gamc&#39;</span><span class="p">,</span> <span class="n">gamc_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;gams&#39;</span><span class="p">,</span> <span class="n">gams_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;pn&#39;</span><span class="p">,</span> <span class="n">pn_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">pn_type</span></div>


<div class="viewcode-block" id="DihedralForceWithAtomEnergy"><a class="viewcode-back" href="../../../../mindsponge/mindspore.ops.DihedralForceWithAtomEnergy.html#mindspore.ops.DihedralForceWithAtomEnergy">[docs]</a><span class="k">class</span> <span class="nc">DihedralForceWithAtomEnergy</span><span class="p">(</span><span class="n">PrimitiveWithInfer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate dihedral force and potential energy together.</span>

<span class="sd">    The calculation formula is the same as operator DihedralForce() and DihedralEnergy().</span>

<span class="sd">    Because there is a large amount of inputs and each of them are related,</span>
<span class="sd">    there is no way to construct `Examples` using random methods. For details, refer the webpage `SPONGE in MindSpore</span>
<span class="sd">    &lt;https://gitee.com/mindspore/mindscience/blob/master/MindSPONGE/docs/simple_formula.md&gt;`_.</span>

<span class="sd">    Args:</span>
<span class="sd">        dihedral_numbers(int32): the number of dihedral terms m.</span>

<span class="sd">    Inputs:</span>
<span class="sd">        - **uint_crd_f** (Tensor) - The unsigned int coordinates</span>
<span class="sd">          value of each atom. The data type is uint32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **scaler_f** (Tensor) - The 3-D scale factor between</span>
<span class="sd">          the real space float coordinates and the unsigned int coordinates.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(3,)`.</span>
<span class="sd">        - **atom_a** (Tensor) - The 1st atom index of each dihedral.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **atom_b** (Tensor) - The 2nd atom index of each dihedral.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **atom_c** (Tenso) - The 3rd atom index of each dihedral.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **atom_d** (Tensor) - The 4th atom index of each dihedral.</span>
<span class="sd">          4 atoms are connected in the form a-b-c-d. The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **ipn** (Tensor) - The period of dihedral angle of each dihedral.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **pk** (Tensor) - The force constant of each dihedral.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **gamc** (Tensor) - k*cos(phi_0) of each dihedral.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **gams** (Tensor) - k*sin(phi_0) of each dihedral.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **pn** (Tensor) - The floating point form of ipn.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>

<span class="sd">    Outputs:</span>
<span class="sd">        - **frc_f** (Tensor) - Same as operator DihedralForce().</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **ene** (Tensor) - Same as operator DihedralAtomEnergy().</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n,)`.</span>

<span class="sd">    Supported Platforms:</span>
<span class="sd">        ``GPU``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@prim_attr_register</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dihedral_numbers</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize DihedralForceWithAtomEnergy.&quot;&quot;&quot;</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;dihedral_numbers&#39;</span><span class="p">,</span> <span class="n">dihedral_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_numbers</span> <span class="o">=</span> <span class="n">dihedral_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_prim_io_names</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;uint_crd_f&#39;</span><span class="p">,</span> <span class="s1">&#39;scaler_f&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_a&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_b&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_c&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_d&#39;</span><span class="p">,</span> <span class="s1">&#39;ipn&#39;</span><span class="p">,</span> <span class="s1">&#39;pk&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;gamc&#39;</span><span class="p">,</span> <span class="s1">&#39;gams&#39;</span><span class="p">,</span> <span class="s1">&#39;pn&#39;</span><span class="p">],</span>
                                <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;frc_f&#39;</span><span class="p">,</span> <span class="s1">&#39;ene&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;dihedral_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_numbers</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">infer_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_f_shape</span><span class="p">,</span> <span class="n">scaler_f_shape</span><span class="p">,</span> <span class="n">atom_a_shape</span><span class="p">,</span> <span class="n">atom_b_shape</span><span class="p">,</span> <span class="n">atom_c_shape</span><span class="p">,</span> <span class="n">atom_d_shape</span><span class="p">,</span>
                    <span class="n">ipn_shape</span><span class="p">,</span> <span class="n">pk_shape</span><span class="p">,</span> <span class="n">gamc_shape</span><span class="p">,</span> <span class="n">gams_shape</span><span class="p">,</span> <span class="n">pn_shape</span><span class="p">):</span>
        <span class="n">cls_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">uint_crd_f_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_numbers</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scaler_f_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;scaler_f_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_a_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_a_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_b_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_b_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_c_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_c_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_d_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_d_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ipn_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;ipn_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pk_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;pk_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gamc_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;gamc_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gams_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;gams_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pn_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;pn_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>

        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_shape[1]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">scaler_f_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;scaler_f_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_a_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_a_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_b_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_b_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_c_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_c_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_d_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_d_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">ipn_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;ipn_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">pk_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;pk_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">gamc_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;gamc_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">gams_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;gams_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">pn_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;pn_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">uint_crd_f_shape</span><span class="p">,</span> <span class="p">[</span><span class="n">n</span><span class="p">,]</span>

    <span class="k">def</span> <span class="nf">infer_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_f_dtype</span><span class="p">,</span> <span class="n">scaler_f_type</span><span class="p">,</span> <span class="n">atom_a_type</span><span class="p">,</span> <span class="n">atom_b_type</span><span class="p">,</span> <span class="n">atom_c_type</span><span class="p">,</span> <span class="n">atom_d_type</span><span class="p">,</span>
                    <span class="n">ipn_type</span><span class="p">,</span> <span class="n">pk_type</span><span class="p">,</span> <span class="n">gamc_type</span><span class="p">,</span> <span class="n">gams_type</span><span class="p">,</span> <span class="n">pn_type</span><span class="p">):</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;uint_crd_f&#39;</span><span class="p">,</span> <span class="n">uint_crd_f_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">uint32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;scaler_f&#39;</span><span class="p">,</span> <span class="n">scaler_f_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_a&#39;</span><span class="p">,</span> <span class="n">atom_a_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_b&#39;</span><span class="p">,</span> <span class="n">atom_b_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_c&#39;</span><span class="p">,</span> <span class="n">atom_c_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_d&#39;</span><span class="p">,</span> <span class="n">atom_d_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;ipn&#39;</span><span class="p">,</span> <span class="n">ipn_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;pk&#39;</span><span class="p">,</span> <span class="n">pk_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;gamc&#39;</span><span class="p">,</span> <span class="n">gamc_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;gams&#39;</span><span class="p">,</span> <span class="n">gams_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;pn&#39;</span><span class="p">,</span> <span class="n">pn_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">pn_type</span><span class="p">,</span> <span class="n">pn_type</span></div>


<div class="viewcode-block" id="AngleForce"><a class="viewcode-back" href="../../../../mindsponge/mindspore.ops.AngleForce.html#mindspore.ops.AngleForce">[docs]</a><span class="k">class</span> <span class="nc">AngleForce</span><span class="p">(</span><span class="n">PrimitiveWithInfer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the force exerted by angles made of 3 atoms on the</span>
<span class="sd">    corresponding atoms. Assume the number of angles is m and the</span>
<span class="sd">    number of atoms is n.</span>

<span class="sd">    Because there is a large amount of inputs and each of them are related,</span>
<span class="sd">    there is no way to construct `Examples` using random methods. For details, refer the webpage `SPONGE in MindSpore</span>
<span class="sd">    &lt;https://gitee.com/mindspore/mindscience/blob/master/MindSPONGE/docs/simple_formula.md&gt;`_.</span>

<span class="sd">    .. math::</span>
<span class="sd">        dr_{ab} = (x_b-x_a, y_b-y_a, z_b-z_a)</span>
<span class="sd">    .. math::</span>
<span class="sd">        dr_{cb} = (x_b-x_c, y_b-y_c, z_b-z_c)</span>
<span class="sd">    .. math::</span>
<span class="sd">        theta = arccos(inner_product(dr_{ab}, dr_{cb})/|dr_{ab}|/|dr_{cb}|)</span>
<span class="sd">    .. math::</span>
<span class="sd">        F_a = -2*k*(theta-theta_0)/sin(theta)*[cos(theta)/|dr_{ab}|^2*dr_{ab}</span>
<span class="sd">            - 1/|dr_{ab}|/|dr_{cb}|*dr_{cb}]</span>
<span class="sd">    .. math::</span>
<span class="sd">        F_c = -2*k*(theta-theta_0)/sin(theta)*[cos(theta)/|dr_{cb}|^2*dr_{cb}</span>
<span class="sd">            - 1/|dr_{cb}|/|dr_{ab}|*dr_{ab}]</span>
<span class="sd">    .. math::</span>
<span class="sd">        F_b = -F_a - F_c</span>

<span class="sd">    Args:</span>
<span class="sd">        angle_numbers(int32): the number of angles m.</span>

<span class="sd">    Inputs:</span>
<span class="sd">        - **uint_crd_f** (Tensor) - The unsigned int coordinate value of each atom.</span>
<span class="sd">          The data type is uint32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **scaler_f** (Tensor) - The 3-D scale factor between</span>
<span class="sd">          the real space float coordinates and the unsigned int coordinates.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(3,)`.</span>
<span class="sd">        - **atom_a** (Tensor) - The 1st atom index of each angle.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **atom_b** (Tensor) - The 2nd and the central atom index of each angle.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **atom_c** (Tensor) - The 3rd atom index of each angle.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **angle_k** (Tensor) - The force constant for each angle.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **angle_theta0** (Tensor) - The equilibrium position value for each angle.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>

<span class="sd">    Outputs:</span>
<span class="sd">        - **frc_f** (Tensor) - The force felt by each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n, 3)`.</span>

<span class="sd">    Supported Platforms:</span>
<span class="sd">        ``GPU``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@prim_attr_register</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle_numbers</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize AngleForce.&quot;&quot;&quot;</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;angle_numbers&#39;</span><span class="p">,</span> <span class="n">angle_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angle_numbers</span> <span class="o">=</span> <span class="n">angle_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_prim_io_names</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;uint_crd_f&#39;</span><span class="p">,</span> <span class="s1">&#39;scaler_f&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_a&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_b&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_c&#39;</span><span class="p">,</span> <span class="s1">&#39;angle_k&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;angle_theta0&#39;</span><span class="p">],</span>
                                <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;frc_f&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;angle_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle_numbers</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">infer_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_f_shape</span><span class="p">,</span> <span class="n">scaler_f_shape</span><span class="p">,</span> <span class="n">atom_a_shape</span><span class="p">,</span> <span class="n">atom_b_shape</span><span class="p">,</span> <span class="n">atom_c_shape</span><span class="p">,</span> <span class="n">angle_k_shape</span><span class="p">,</span>
                    <span class="n">angle_theta0_shape</span><span class="p">):</span>
        <span class="n">cls_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle_numbers</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scaler_f_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;scaler_f_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_a_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_a_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_b_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_b_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_c_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_c_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">angle_k_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;angle_k_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">angle_theta0_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;angle_theta0_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>

        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_shape[1]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">scaler_f_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;scaler_f_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_a_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_a_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_b_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_b_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_c_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_c_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">angle_k_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;angle_k_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">angle_theta0_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;angle_theta0_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">uint_crd_f_shape</span>

    <span class="k">def</span> <span class="nf">infer_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_f_dtype</span><span class="p">,</span> <span class="n">scaler_f_type</span><span class="p">,</span> <span class="n">atom_a_type</span><span class="p">,</span> <span class="n">atom_b_type</span><span class="p">,</span> <span class="n">atom_c_type</span><span class="p">,</span> <span class="n">angle_k_type</span><span class="p">,</span>
                    <span class="n">angle_theta0_type</span><span class="p">):</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;uint_crd_f&#39;</span><span class="p">,</span> <span class="n">uint_crd_f_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">uint32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;scaler_f&#39;</span><span class="p">,</span> <span class="n">scaler_f_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_a&#39;</span><span class="p">,</span> <span class="n">atom_a_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_b&#39;</span><span class="p">,</span> <span class="n">atom_b_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_c&#39;</span><span class="p">,</span> <span class="n">atom_c_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;angle_k&#39;</span><span class="p">,</span> <span class="n">angle_k_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;angle_theta0&#39;</span><span class="p">,</span> <span class="n">angle_theta0_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">angle_k_type</span></div>


<div class="viewcode-block" id="AngleEnergy"><a class="viewcode-back" href="../../../../mindsponge/mindspore.ops.AngleEnergy.html#mindspore.ops.AngleEnergy">[docs]</a><span class="k">class</span> <span class="nc">AngleEnergy</span><span class="p">(</span><span class="n">PrimitiveWithInfer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the energy caused by 3-atoms angle term. Assume the number of angles is m and the</span>
<span class="sd">    number of atoms is n.</span>

<span class="sd">    Because there is a large amount of inputs and each of them are related,</span>
<span class="sd">    there is no way to construct `Examples` using random methods. For details, refer the webpage `SPONGE in MindSpore</span>
<span class="sd">    &lt;https://gitee.com/mindspore/mindscience/blob/master/MindSPONGE/docs/simple_formula.md&gt;`_.</span>

<span class="sd">    .. math::</span>
<span class="sd">        dr_{ab} = (x_b-x_a, y_b-y_a, z_b-z_a)</span>
<span class="sd">    .. math::</span>
<span class="sd">        dr_{cb} = (x_b-x_c, y_b-y_c, z_b-z_c)</span>
<span class="sd">    .. math::</span>
<span class="sd">        theta = arccos(inner_product(dr_{ab}, dr_{cb})/|dr_{ab}|/|dr_{cb}|)</span>
<span class="sd">    .. math::</span>
<span class="sd">        E = k*(theta - theta_0)^2</span>

<span class="sd">    Args:</span>
<span class="sd">        angle_numbers(int32): the number of angles m.</span>

<span class="sd">    Inputs:</span>
<span class="sd">        - **uint_crd_f** (Tensor) - The unsigned int coordinate value of each atom.</span>
<span class="sd">          The data type is uint32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **scaler_f** (Tensor) - The 3-D scale factor between</span>
<span class="sd">          the real space float coordinates and the unsigned int coordinates.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(3,)`.</span>
<span class="sd">        - **atom_a** (Tensor) - The 1st atom index of each angle.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **atom_b** (Tensor) - The 2nd and the central atom index of each angle.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **atom_c** (Tensor) - The 3rd atom index of each angle.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **angle_k** (Tensor) - The force constant for each angle.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **angle_theta0** (Tensor) - The equilibrium position value for each angle.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>

<span class="sd">    Outputs:</span>
<span class="sd">        - **ene** (Tensor) - The potential energy for each angle term.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>

<span class="sd">    Supported Platforms:</span>
<span class="sd">        ``GPU``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@prim_attr_register</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle_numbers</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize AngleEnergy.&quot;&quot;&quot;</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;angle_numbers&#39;</span><span class="p">,</span> <span class="n">angle_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angle_numbers</span> <span class="o">=</span> <span class="n">angle_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_prim_io_names</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;uint_crd_f&#39;</span><span class="p">,</span> <span class="s1">&#39;scaler_f&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_a&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_b&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_c&#39;</span><span class="p">,</span> <span class="s1">&#39;angle_k&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;angle_theta0&#39;</span><span class="p">],</span>
                                <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ene&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;angle_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle_numbers</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">infer_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_f_shape</span><span class="p">,</span> <span class="n">scaler_f_shape</span><span class="p">,</span> <span class="n">atom_a_shape</span><span class="p">,</span> <span class="n">atom_b_shape</span><span class="p">,</span> <span class="n">atom_c_shape</span><span class="p">,</span> <span class="n">angle_k_shape</span><span class="p">,</span>
                    <span class="n">angle_theta0_shape</span><span class="p">):</span>
        <span class="n">cls_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle_numbers</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scaler_f_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;scaler_f_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_a_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_a_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_b_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_b_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_c_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_c_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">angle_k_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;angle_k_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">angle_theta0_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;angle_theta0_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>

        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_shape[1]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">scaler_f_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;scaler_f_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_a_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_a_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_b_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_b_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_c_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_c_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">angle_k_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;angle_k_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">angle_theta0_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;angle_theta0_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">m</span><span class="p">,]</span>

    <span class="k">def</span> <span class="nf">infer_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_f_dtype</span><span class="p">,</span> <span class="n">scaler_f_type</span><span class="p">,</span> <span class="n">atom_a_type</span><span class="p">,</span> <span class="n">atom_b_type</span><span class="p">,</span> <span class="n">atom_c_type</span><span class="p">,</span> <span class="n">angle_k_type</span><span class="p">,</span>
                    <span class="n">angle_theta0_type</span><span class="p">):</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;uint_crd_f&#39;</span><span class="p">,</span> <span class="n">uint_crd_f_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">uint32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;scaler_f&#39;</span><span class="p">,</span> <span class="n">scaler_f_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_a&#39;</span><span class="p">,</span> <span class="n">atom_a_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_b&#39;</span><span class="p">,</span> <span class="n">atom_b_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_c&#39;</span><span class="p">,</span> <span class="n">atom_c_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;angle_k&#39;</span><span class="p">,</span> <span class="n">angle_k_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;angle_theta0&#39;</span><span class="p">,</span> <span class="n">angle_theta0_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">angle_k_type</span></div>


<div class="viewcode-block" id="AngleAtomEnergy"><a class="viewcode-back" href="../../../../mindsponge/mindspore.ops.AngleAtomEnergy.html#mindspore.ops.AngleAtomEnergy">[docs]</a><span class="k">class</span> <span class="nc">AngleAtomEnergy</span><span class="p">(</span><span class="n">PrimitiveWithInfer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add the potential energy caused by angle terms to the total potential</span>
<span class="sd">    energy of each atom. Assume the number of angles is m and the</span>
<span class="sd">    number of atoms is n.</span>

<span class="sd">    The calculation formula is the same as operator AngleEnergy().</span>

<span class="sd">    Because there is a large amount of inputs and each of them are related,</span>
<span class="sd">    there is no way to construct `Examples` using random methods. For details, refer the webpage `SPONGE in MindSpore</span>
<span class="sd">    &lt;https://gitee.com/mindspore/mindscience/blob/master/MindSPONGE/docs/simple_formula.md&gt;`_.</span>

<span class="sd">    Args:</span>
<span class="sd">        angle_numbers(int32): the number of angles m.</span>

<span class="sd">    Inputs:</span>
<span class="sd">        - **uint_crd_f** (Tensor) - The unsigned int coordinate value of each atom.</span>
<span class="sd">          The data type is uint32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **scaler_f** (Tensor) - The 3-D scale factor between</span>
<span class="sd">          the real space float coordinates and the unsigned int coordinates.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(3,)`.</span>
<span class="sd">        - **atom_a** (Tensor) - The 1st atom index of each angle.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **atom_b** (Tensor) - The 2nd and the central atom index of each angle.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **atom_c** (Tensor) - The 3rd atom index of each angle.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **angle_k** (Tensor) - The force constant for each angle.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **angle_theta0** (Tensor) - The equilibrium position value for each angle.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>

<span class="sd">    Outputs:</span>
<span class="sd">        - **ene** (Tensor) - The accumulated potential energy for each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n,)`.</span>

<span class="sd">    Supported Platforms:</span>
<span class="sd">        ``GPU``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@prim_attr_register</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle_numbers</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize AngleAtomEnergy.&quot;&quot;&quot;</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;angle_numbers&#39;</span><span class="p">,</span> <span class="n">angle_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angle_numbers</span> <span class="o">=</span> <span class="n">angle_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_prim_io_names</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;uint_crd_f&#39;</span><span class="p">,</span> <span class="s1">&#39;scaler_f&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_a&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_b&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_c&#39;</span><span class="p">,</span> <span class="s1">&#39;angle_k&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;angle_theta0&#39;</span><span class="p">],</span>
                                <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ene&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;angle_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle_numbers</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">infer_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_f_shape</span><span class="p">,</span> <span class="n">scaler_f_shape</span><span class="p">,</span> <span class="n">atom_a_shape</span><span class="p">,</span> <span class="n">atom_b_shape</span><span class="p">,</span> <span class="n">atom_c_shape</span><span class="p">,</span> <span class="n">angle_k_shape</span><span class="p">,</span>
                    <span class="n">angle_theta0_shape</span><span class="p">):</span>
        <span class="n">cls_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">uint_crd_f_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle_numbers</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scaler_f_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;scaler_f_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_a_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_a_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_b_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_b_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_c_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_c_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">angle_k_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;angle_k_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">angle_theta0_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;angle_theta0_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>

        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_shape[1]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">scaler_f_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;scaler_f_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_a_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_a_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_b_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_b_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_c_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_c_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">angle_k_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;angle_k_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">angle_theta0_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;angle_theta0_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">n</span><span class="p">,]</span>

    <span class="k">def</span> <span class="nf">infer_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_f_dtype</span><span class="p">,</span> <span class="n">scaler_f_type</span><span class="p">,</span> <span class="n">atom_a_type</span><span class="p">,</span> <span class="n">atom_b_type</span><span class="p">,</span> <span class="n">atom_c_type</span><span class="p">,</span> <span class="n">angle_k_type</span><span class="p">,</span>
                    <span class="n">angle_theta0_type</span><span class="p">):</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;uint_crd_f&#39;</span><span class="p">,</span> <span class="n">uint_crd_f_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">uint32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;scaler_f&#39;</span><span class="p">,</span> <span class="n">scaler_f_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_a&#39;</span><span class="p">,</span> <span class="n">atom_a_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_b&#39;</span><span class="p">,</span> <span class="n">atom_b_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_c&#39;</span><span class="p">,</span> <span class="n">atom_c_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;angle_k&#39;</span><span class="p">,</span> <span class="n">angle_k_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;angle_theta0&#39;</span><span class="p">,</span> <span class="n">angle_theta0_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">angle_k_type</span></div>


<div class="viewcode-block" id="AngleForceWithAtomEnergy"><a class="viewcode-back" href="../../../../mindsponge/mindspore.ops.AngleForceWithAtomEnergy.html#mindspore.ops.AngleForceWithAtomEnergy">[docs]</a><span class="k">class</span> <span class="nc">AngleForceWithAtomEnergy</span><span class="p">(</span><span class="n">PrimitiveWithInfer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate angle force and potential energy together. Assume the number of angles is m and the</span>
<span class="sd">    number of atoms is n.</span>

<span class="sd">    The calculation formula is the same as operator AngleForce() and AngleEnergy().</span>

<span class="sd">    Because there is a large amount of inputs and each of them are related,</span>
<span class="sd">    there is no way to construct `Examples` using random methods. For details, refer the webpage `SPONGE in MindSpore</span>
<span class="sd">    &lt;https://gitee.com/mindspore/mindscience/blob/master/MindSPONGE/docs/simple_formula.md&gt;`_.</span>

<span class="sd">    Args:</span>
<span class="sd">        angle_numbers(int32): the number of angles m.</span>

<span class="sd">    Inputs:</span>
<span class="sd">        - **uint_crd_f** (Tensor) - The unsigned int coordinate value of each atom.</span>
<span class="sd">          The data type is uint32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **scaler_f** (Tensor) - The 3-D scale factor between</span>
<span class="sd">          the real space float coordinates and the unsigned int coordinates.</span>
<span class="sd">          The data type is float and the shape is :math:`(3,)`.</span>
<span class="sd">        - **atom_a** (Tensor) - The 1st atom index of each angle.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **atom_b** (Tensor) - The 2nd and the central atom index of each angle.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **atom_c** (Tensor) - The 3rd atom index of each angle.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **angle_k** (Tensor) - The force constant for each angle.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **angle_theta0** (Tensor) - The equilibrium position value for each angle.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>

<span class="sd">    Outputs:</span>
<span class="sd">        - **frc_f** (Tensor) - same as operator AngleForce().</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **ene** (Tensor) - same as operator AngleAtomEnergy().</span>
<span class="sd">          The data type is float and the shape is :math:`(n,)`.</span>

<span class="sd">    Supported Platforms:</span>
<span class="sd">        ``GPU``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@prim_attr_register</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle_numbers</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize AngleForceWithAtomEnergy.&quot;&quot;&quot;</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;angle_numbers&#39;</span><span class="p">,</span> <span class="n">angle_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angle_numbers</span> <span class="o">=</span> <span class="n">angle_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_prim_io_names</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;uint_crd_f&#39;</span><span class="p">,</span> <span class="s1">&#39;scaler_f&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_a&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_b&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_c&#39;</span><span class="p">,</span> <span class="s1">&#39;angle_k&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;angle_theta0&#39;</span><span class="p">],</span>
                                <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;frc_f&#39;</span><span class="p">,</span> <span class="s1">&#39;ene&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;angle_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle_numbers</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">infer_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_f_shape</span><span class="p">,</span> <span class="n">scaler_f_shape</span><span class="p">,</span> <span class="n">atom_a_shape</span><span class="p">,</span> <span class="n">atom_b_shape</span><span class="p">,</span> <span class="n">atom_c_shape</span><span class="p">,</span> <span class="n">angle_k_shape</span><span class="p">,</span>
                    <span class="n">angle_theta0_shape</span><span class="p">):</span>
        <span class="n">cls_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">uint_crd_f_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle_numbers</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scaler_f_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;scaler_f_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_a_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_a_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_b_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_b_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_c_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_c_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">angle_k_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;angle_k_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">angle_theta0_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;angle_theta0_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>

        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_shape[1]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">scaler_f_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;scaler_f_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_a_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_a_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_b_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_b_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_c_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_c_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">angle_k_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;angle_k_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">angle_theta0_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;angle_theta0_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">uint_crd_f_shape</span><span class="p">,</span> <span class="p">[</span><span class="n">n</span><span class="p">,]</span>

    <span class="k">def</span> <span class="nf">infer_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_f_dtype</span><span class="p">,</span> <span class="n">scaler_f_type</span><span class="p">,</span> <span class="n">atom_a_type</span><span class="p">,</span> <span class="n">atom_b_type</span><span class="p">,</span> <span class="n">atom_c_type</span><span class="p">,</span> <span class="n">angle_k_type</span><span class="p">,</span>
                    <span class="n">angle_theta0_type</span><span class="p">):</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;uint_crd_f&#39;</span><span class="p">,</span> <span class="n">uint_crd_f_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">uint32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;scaler_f&#39;</span><span class="p">,</span> <span class="n">scaler_f_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_a&#39;</span><span class="p">,</span> <span class="n">atom_a_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_b&#39;</span><span class="p">,</span> <span class="n">atom_b_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_c&#39;</span><span class="p">,</span> <span class="n">atom_c_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;angle_k&#39;</span><span class="p">,</span> <span class="n">angle_k_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;angle_theta0&#39;</span><span class="p">,</span> <span class="n">angle_theta0_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">angle_k_type</span><span class="p">,</span> <span class="n">angle_k_type</span></div>


<div class="viewcode-block" id="Dihedral14LJForce"><a class="viewcode-back" href="../../../../mindsponge/mindspore.ops.Dihedral14LJForce.html#mindspore.ops.Dihedral14LJForce">[docs]</a><span class="k">class</span> <span class="nc">Dihedral14LJForce</span><span class="p">(</span><span class="n">PrimitiveWithInfer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the Lennard-Jones part of 1,4 dihedral force correction</span>
<span class="sd">    for each necessary dihedral terms on the corresponding atoms.</span>

<span class="sd">    Assume the number of necessary dihedral 1,4 terms is m, the number of atoms is n,</span>
<span class="sd">    and the number of Lennard-Jones types for all atoms is P, which means</span>
<span class="sd">    there will be q = P*(P+1)/2 types of possible Lennard-Jones interactions</span>
<span class="sd">    for all kinds of atom pairs.</span>

<span class="sd">    Because there is a large amount of inputs and each of them are related,</span>
<span class="sd">    there is no way to construct `Examples` using random methods. For details, refer the webpage `SPONGE in MindSpore</span>
<span class="sd">    &lt;https://gitee.com/mindspore/mindscience/blob/master/MindSPONGE/docs/simple_formula.md&gt;`_.</span>

<span class="sd">    .. math::</span>
<span class="sd">        dr = (x_a-x_b, y_a-y_b, z_a-z_b)</span>
<span class="sd">    .. math::</span>
<span class="sd">        F = k*(-12*A/|dr|^{14} + 6*B/|dr|^{8})*dr</span>

<span class="sd">    Args:</span>
<span class="sd">        nb14_numbers (int32): the number of necessary dihedral 1,4 terms m.</span>
<span class="sd">        atom_numbers (int32): the number of atoms n.</span>

<span class="sd">    Inputs:</span>
<span class="sd">        - **uint_crd_f** (Tensor) - The unsigned int coordinate value of each atom.</span>
<span class="sd">          The data type is uint32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **LJ_type** (Tensor) - The Lennard-Jones type of each atom.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(n,)`.</span>
<span class="sd">        - **charge** (Tensor) - The charge of each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n,)`.</span>
<span class="sd">        - **boxlength_f** (Tensor) - The length of molecular simulation box in 3 dimensions.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(3,)`.</span>
<span class="sd">        - **a_14** (Tensor) - The first atom index of each dihedral 1,4 term.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **b_14** (Tensor) - The second atom index of each dihedral 1,4 term.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **lj_scale_factor** (Tensor) - The scale factor for the</span>
<span class="sd">          Lennard-Jones part of force correction of each dihedral 1,4 term.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **LJ_type_A** (Tensor) - The A parameter in Lennard-Jones scheme of each atom pair type.</span>
<span class="sd">          q is the number of atom pair. The data type is float32 and the shape is :math:`(q,)`.</span>
<span class="sd">        - **LJ_type_B** (Tensor) - The B parameter in Lennard-Jones shceme of each atom pair type.</span>
<span class="sd">          q is the number of atom pair. The data type is float32 and the shape is :math:`(q,)`.</span>

<span class="sd">    Outputs:</span>
<span class="sd">        - **frc_f** (Tensor) - The force felt by each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n, 3)`.</span>

<span class="sd">    Supported Platforms:</span>
<span class="sd">        ``GPU``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@prim_attr_register</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nb14_numbers</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize Dihedral14LJForce.&quot;&quot;&quot;</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;nb14_numbers&#39;</span><span class="p">,</span> <span class="n">nb14_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_14_numbers</span> <span class="o">=</span> <span class="n">nb14_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span> <span class="o">=</span> <span class="n">atom_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_prim_io_names</span><span class="p">(</span>
            <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;uint_crd_f&#39;</span><span class="p">,</span> <span class="s1">&#39;LJtype&#39;</span><span class="p">,</span> <span class="s1">&#39;charge&#39;</span><span class="p">,</span> <span class="s1">&#39;boxlength_f&#39;</span><span class="p">,</span> <span class="s1">&#39;a_14&#39;</span><span class="p">,</span> <span class="s1">&#39;b_14&#39;</span><span class="p">,</span> <span class="s1">&#39;lj_scale_factor&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;LJ_type_A&#39;</span><span class="p">,</span> <span class="s1">&#39;LJ_type_B&#39;</span><span class="p">],</span>
            <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;frc_f&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;dihedral_14_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_14_numbers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">infer_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_f_shape</span><span class="p">,</span> <span class="n">ljtype_shape</span><span class="p">,</span> <span class="n">charge_shape</span><span class="p">,</span> <span class="n">boxlength_f_shape</span><span class="p">,</span> <span class="n">a_14_shape</span><span class="p">,</span> <span class="n">b_14_shape</span><span class="p">,</span>
                    <span class="n">lj_scale_factor_shape</span><span class="p">,</span> <span class="n">lj_type_a_shape</span><span class="p">,</span> <span class="n">lj_type_b_shape</span><span class="p">):</span>
        <span class="n">cls_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_14_numbers</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">lj_type_a_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ljtype_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;LJtype_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">charge_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;charge_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">boxlength_f_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;boxlength_f_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a_14_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;a_14_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b_14_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;b_14_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lj_scale_factor_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;lj_scale_factor_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lj_type_b_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;LJ_type_B_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>

        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f[0]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f[1]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">ljtype_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;LJtype&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">charge_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;charge&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">boxlength_f_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;boxlength_f&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">lj_type_b_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;LJ_type_B&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">a_14_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;a_14_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">b_14_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;b_14_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">lj_scale_factor_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;lj_scale_factor_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">uint_crd_f_shape</span>

    <span class="k">def</span> <span class="nf">infer_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_f_dtype</span><span class="p">,</span> <span class="n">ljtype_dtype</span><span class="p">,</span> <span class="n">charge_dtype</span><span class="p">,</span> <span class="n">boxlength_f_type</span><span class="p">,</span> <span class="n">a_14_type</span><span class="p">,</span> <span class="n">b_14_type</span><span class="p">,</span>
                    <span class="n">lj_scale_factor_type</span><span class="p">,</span> <span class="n">lj_type_a_type</span><span class="p">,</span> <span class="n">lj_type_b_type</span><span class="p">):</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;uint_crd_f&#39;</span><span class="p">,</span> <span class="n">uint_crd_f_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">uint32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;LJtype&#39;</span><span class="p">,</span> <span class="n">ljtype_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;charge&#39;</span><span class="p">,</span> <span class="n">charge_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;boxlength_f&#39;</span><span class="p">,</span> <span class="n">boxlength_f_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;a_14&#39;</span><span class="p">,</span> <span class="n">a_14_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;b_14&#39;</span><span class="p">,</span> <span class="n">b_14_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;lj_scale_factor&#39;</span><span class="p">,</span> <span class="n">lj_scale_factor_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;LJ_type_A&#39;</span><span class="p">,</span> <span class="n">lj_type_a_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;LJ_type_B&#39;</span><span class="p">,</span> <span class="n">lj_type_b_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lj_type_b_type</span></div>


<div class="viewcode-block" id="Dihedral14LJEnergy"><a class="viewcode-back" href="../../../../mindsponge/mindspore.ops.Dihedral14LJEnergy.html#mindspore.ops.Dihedral14LJEnergy">[docs]</a><span class="k">class</span> <span class="nc">Dihedral14LJEnergy</span><span class="p">(</span><span class="n">PrimitiveWithInfer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the Lennard-Jones part of 1,4 dihedral energy correction for</span>
<span class="sd">    each necessary dihedral terms on the corresponding atoms.</span>

<span class="sd">    Because there is a large amount of inputs and each of them are related,</span>
<span class="sd">    there is no way to construct `Examples` using random methods. For details, refer the webpage `SPONGE in MindSpore</span>
<span class="sd">    &lt;https://gitee.com/mindspore/mindscience/blob/master/MindSPONGE/docs/simple_formula.md&gt;`_.</span>

<span class="sd">    .. math::</span>
<span class="sd">        dr = (x_a-x_b, y_a-y_b, z_a-z-b)</span>
<span class="sd">    .. math::</span>
<span class="sd">        E = k*(A/|dr|^{12} - B/|dr|^{6})</span>

<span class="sd">    Args:</span>
<span class="sd">        nb14_numbers (int32): the number of necessary dihedral 1,4 terms m.</span>
<span class="sd">        atom_numbers (int32): the number of atoms n.</span>

<span class="sd">    Inputs:</span>
<span class="sd">        - **uint_crd_f** (Tensor) - The unsigned int coordinate value of each atom.</span>
<span class="sd">          The data type is uint32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **LJ_type** (Tensor) - The Lennard-Jones type of each atom.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(n,)`.</span>
<span class="sd">        - **charge** (Tensor) - The charge of each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n,)`.</span>
<span class="sd">        - **boxlength_f** (Tensor) - The length of molecular simulation box in 3 dimensions.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(3,)`.</span>
<span class="sd">        - **a_14** (Tensor) - The first atom index of each dihedral 1,4 term.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **b_14** (Tensor) - The second atom index of each dihedral 1,4 term.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **lj_scale_factor** (Tensor) - The scale factor for the</span>
<span class="sd">          Lennard-Jones part of force correction of each dihedral 1,4 term.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **LJ_type_A** (Tensor) - The A parameter in Lennard-Jones scheme of each atom pair type.</span>
<span class="sd">          q is the number of atom pair. The data type is float32 and the shape is :math:`(q,)`.</span>
<span class="sd">        - **LJ_type_B** (Tensor) - The B parameter in Lennard-Jones shceme of each atom pair type.</span>
<span class="sd">          q is the number of atom pair. The data type is float32 and the shape is :math:`(q,)`.</span>

<span class="sd">    Outputs:</span>
<span class="sd">        - **ene** (Tensor) - The Lennard-Jones potential energy correction.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>

<span class="sd">    Supported Platforms:</span>
<span class="sd">        ``GPU``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@prim_attr_register</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nb14_numbers</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize Dihedral14LJEnergy&quot;&quot;&quot;</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;nb14_numbers&#39;</span><span class="p">,</span> <span class="n">nb14_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_14_numbers</span> <span class="o">=</span> <span class="n">nb14_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span> <span class="o">=</span> <span class="n">atom_numbers</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_prim_io_names</span><span class="p">(</span>
            <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;uint_crd_f&#39;</span><span class="p">,</span> <span class="s1">&#39;LJtype&#39;</span><span class="p">,</span> <span class="s1">&#39;charge&#39;</span><span class="p">,</span> <span class="s1">&#39;boxlength_f&#39;</span><span class="p">,</span> <span class="s1">&#39;a_14&#39;</span><span class="p">,</span> <span class="s1">&#39;b_14&#39;</span><span class="p">,</span> <span class="s1">&#39;lj_scale_factor&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;LJ_type_A&#39;</span><span class="p">,</span> <span class="s1">&#39;LJ_type_B&#39;</span><span class="p">],</span>
            <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ene&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;dihedral_14_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_14_numbers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">infer_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_f_shape</span><span class="p">,</span> <span class="n">ljtype_shape</span><span class="p">,</span> <span class="n">charge_shape</span><span class="p">,</span> <span class="n">boxlength_f_shape</span><span class="p">,</span> <span class="n">a_14_shape</span><span class="p">,</span> <span class="n">b_14_shape</span><span class="p">,</span>
                    <span class="n">lj_scale_factor_shape</span><span class="p">,</span> <span class="n">lj_type_a_shape</span><span class="p">,</span> <span class="n">lj_type_b_shape</span><span class="p">):</span>
        <span class="n">cls_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_14_numbers</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">lj_type_a_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ljtype_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;LJtype_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">charge_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;charge_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">boxlength_f_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;boxlength_f_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a_14_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;a_14_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b_14_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;b_14_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lj_scale_factor_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;lj_scale_factor_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lj_type_b_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;LJ_type_B_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>

        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f[0]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f[1]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">ljtype_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;LJtype&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">charge_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;charge&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">boxlength_f_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;boxlength_f&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">lj_type_b_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;LJ_type_B&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">a_14_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;a_14_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">b_14_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;b_14_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">lj_scale_factor_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;lj_scale_factor_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dihedral_14_numbers</span><span class="p">,]</span>

    <span class="k">def</span> <span class="nf">infer_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_f_dtype</span><span class="p">,</span> <span class="n">ljtype_dtype</span><span class="p">,</span> <span class="n">charge_dtype</span><span class="p">,</span> <span class="n">boxlength_f_type</span><span class="p">,</span> <span class="n">a_14_type</span><span class="p">,</span> <span class="n">b_14_type</span><span class="p">,</span>
                    <span class="n">lj_scale_factor_type</span><span class="p">,</span> <span class="n">lj_type_a_type</span><span class="p">,</span> <span class="n">lj_type_b_type</span><span class="p">):</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;uint_crd_f&#39;</span><span class="p">,</span> <span class="n">uint_crd_f_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">uint32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;LJtype&#39;</span><span class="p">,</span> <span class="n">ljtype_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;charge&#39;</span><span class="p">,</span> <span class="n">charge_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;boxlength_f&#39;</span><span class="p">,</span> <span class="n">boxlength_f_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;a_14&#39;</span><span class="p">,</span> <span class="n">a_14_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;b_14&#39;</span><span class="p">,</span> <span class="n">b_14_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;lj_scale_factor&#39;</span><span class="p">,</span> <span class="n">lj_scale_factor_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;LJ_type_A&#39;</span><span class="p">,</span> <span class="n">lj_type_a_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;LJ_type_B&#39;</span><span class="p">,</span> <span class="n">lj_type_b_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">lj_type_a_type</span></div>


<div class="viewcode-block" id="Dihedral14LJForceWithDirectCF"><a class="viewcode-back" href="../../../../mindsponge/mindspore.ops.Dihedral14LJForceWithDirectCF.html#mindspore.ops.Dihedral14LJForceWithDirectCF">[docs]</a><span class="k">class</span> <span class="nc">Dihedral14LJForceWithDirectCF</span><span class="p">(</span><span class="n">PrimitiveWithInfer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the Lennard-Jones part and the Coulomb part of force correction</span>
<span class="sd">    for each necessary dihedral 1,4 terms.</span>

<span class="sd">    Because there is a large amount of inputs and each of them are related,</span>
<span class="sd">    there is no way to construct `Examples` using random methods. For details, refer the webpage `SPONGE in MindSpore</span>
<span class="sd">    &lt;https://gitee.com/mindspore/mindscience/blob/master/MindSPONGE/docs/simple_formula.md&gt;`_.</span>

<span class="sd">    The calculation formula of the Lennard-Jones part is the same as operator</span>
<span class="sd">    Dihedral14LJForce(), and the Coulomb part is as follows:</span>

<span class="sd">    .. math::</span>
<span class="sd">            dr = (x_a-x_b, y_a-y_b, z_a-z_b)</span>
<span class="sd">    .. math::</span>
<span class="sd">            F = -k*q_a*q_b/|r|^3*dr</span>

<span class="sd">    Args:</span>
<span class="sd">        nb14_numbers (int32): the number of necessary dihedral 1,4 terms m.</span>
<span class="sd">        atom_numbers (int32): the number of atoms n.</span>

<span class="sd">    Inputs:</span>
<span class="sd">        - **uint_crd_f** (Tensor) - The unsigned int coordinate value of each atom.</span>
<span class="sd">          The data type is uint32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **LJ_type** (Tensor) - The Lennard-Jones type of each atom.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(n,)`.</span>
<span class="sd">        - **charge** (Tensor) - The charge of each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n,)`.</span>
<span class="sd">        - **boxlength_f** (Tensor) - The length of molecular simulation box in 3 dimensions.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(3,)`.</span>
<span class="sd">        - **a_14** (Tensor) - The first atom index of each dihedral 1,4 term.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **b_14** (Tensor) - The second atom index of each dihedral 1,4 term.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **lj_scale_factor** (Tensor) - The scale factor for the</span>
<span class="sd">          Lennard-Jones part of force correction of each dihedral 1,4 term.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **cf_scale_factor** (Tensor) - The scale factor for the</span>
<span class="sd">          Coulomb part of force correction for each dihedral 1,4 terms.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **LJ_type_A** (Tensor) - The A parameter in Lennard-Jones scheme of each atom pair type.</span>
<span class="sd">          q is the number of atom pair. The data type is float32 and the shape is :math:`(q,)`.</span>
<span class="sd">        - **LJ_type_B** (Tensor) - The B parameter in Lennard-Jones shceme of each atom pair type.</span>
<span class="sd">          q is the number of atom pair. The data type is float32 and the shape is :math:`(q,)`.</span>

<span class="sd">    Outputs:</span>
<span class="sd">        - **frc_f** (Tensor) - The force felt by each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n, 3)`</span>

<span class="sd">    Supported Platforms:</span>
<span class="sd">        ``GPU``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@prim_attr_register</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nb14_numbers</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize Dihedral14LJForceWithDirectCF.&quot;&quot;&quot;</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;nb14_numbers&#39;</span><span class="p">,</span> <span class="n">nb14_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_14_numbers</span> <span class="o">=</span> <span class="n">nb14_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span> <span class="o">=</span> <span class="n">atom_numbers</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_prim_io_names</span><span class="p">(</span>
            <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;uint_crd_f&#39;</span><span class="p">,</span> <span class="s1">&#39;LJtype&#39;</span><span class="p">,</span> <span class="s1">&#39;charge&#39;</span><span class="p">,</span> <span class="s1">&#39;boxlength_f&#39;</span><span class="p">,</span> <span class="s1">&#39;a_14&#39;</span><span class="p">,</span> <span class="s1">&#39;b_14&#39;</span><span class="p">,</span> <span class="s1">&#39;lj_scale_factor&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;cf_scale_factor&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;LJ_type_A&#39;</span><span class="p">,</span> <span class="s1">&#39;LJ_type_B&#39;</span><span class="p">],</span>
            <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;frc_f&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;dihedral_14_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_14_numbers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">infer_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_f_shape</span><span class="p">,</span> <span class="n">ljtype_shape</span><span class="p">,</span> <span class="n">charge_shape</span><span class="p">,</span> <span class="n">boxlength_f_shape</span><span class="p">,</span> <span class="n">a_14_shape</span><span class="p">,</span> <span class="n">b_14_shape</span><span class="p">,</span>
                    <span class="n">lj_scale_factor_shape</span><span class="p">,</span> <span class="n">cf_scale_factor_shape</span><span class="p">,</span> <span class="n">lj_type_a_shape</span><span class="p">,</span> <span class="n">lj_type_b_shape</span><span class="p">):</span>
        <span class="n">cls_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_14_numbers</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">lj_type_a_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ljtype_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;LJtype_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">charge_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;charge_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">boxlength_f_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;boxlength_f_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a_14_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;a_14_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b_14_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;b_14_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lj_scale_factor_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;lj_scale_factor_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cf_scale_factor_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;cf_scale_factor_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lj_type_b_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;LJ_type_B_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>

        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_shape[0]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_shape[1]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">ljtype_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;LJtype_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">charge_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;charge_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">boxlength_f_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;boxlength_f_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">lj_type_b_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;LJ_type_B_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">a_14_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;a_14_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">b_14_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;b_14_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">lj_scale_factor_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;lj_scale_factor_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">cf_scale_factor_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;cf_scale_factor_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">infer_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_f_dtype</span><span class="p">,</span> <span class="n">ljtype_dtype</span><span class="p">,</span> <span class="n">charge_dtype</span><span class="p">,</span> <span class="n">boxlength_f_type</span><span class="p">,</span> <span class="n">a_14_type</span><span class="p">,</span> <span class="n">b_14_type</span><span class="p">,</span>
                    <span class="n">lj_scale_factor_type</span><span class="p">,</span> <span class="n">cf_scale_factor_type</span><span class="p">,</span> <span class="n">lj_type_a_type</span><span class="p">,</span> <span class="n">lj_type_b_type</span><span class="p">):</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;uint_crd_f&#39;</span><span class="p">,</span> <span class="n">uint_crd_f_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">uint32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;LJtype&#39;</span><span class="p">,</span> <span class="n">ljtype_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;charge&#39;</span><span class="p">,</span> <span class="n">charge_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;boxlength_f&#39;</span><span class="p">,</span> <span class="n">boxlength_f_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;a_14&#39;</span><span class="p">,</span> <span class="n">a_14_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;b_14&#39;</span><span class="p">,</span> <span class="n">b_14_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;lj_scale_factor&#39;</span><span class="p">,</span> <span class="n">lj_scale_factor_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;cf_scale_factor&#39;</span><span class="p">,</span> <span class="n">cf_scale_factor_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;LJ_type_A&#39;</span><span class="p">,</span> <span class="n">lj_type_a_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;LJ_type_B&#39;</span><span class="p">,</span> <span class="n">lj_type_b_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">lj_type_a_type</span></div>


<div class="viewcode-block" id="Dihedral14LJCFForceWithAtomEnergy"><a class="viewcode-back" href="../../../../mindsponge/mindspore.ops.Dihedral14LJCFForceWithAtomEnergy.html#mindspore.ops.Dihedral14LJCFForceWithAtomEnergy">[docs]</a><span class="k">class</span> <span class="nc">Dihedral14LJCFForceWithAtomEnergy</span><span class="p">(</span><span class="n">PrimitiveWithInfer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the Lennard-Jones and Coulumb energy correction and force correction</span>
<span class="sd">    for each necessary dihedral 1,4 terms together and add them to the total force</span>
<span class="sd">    and potential energy for each atom.</span>

<span class="sd">    The calculation formula of force correction is the same as operator</span>
<span class="sd">    :class:`Dihedral14LJForceWithDirectCF`, and the energy correction part is the same</span>
<span class="sd">    as operator :class:`Dihedral14LJEnergy` and :class:`Dihedral14CFEnergy`.</span>

<span class="sd">    Because there is a large amount of inputs and each of them are related,</span>
<span class="sd">    there is no way to construct `Examples` using random methods. For details, refer the webpage `SPONGE in MindSpore</span>
<span class="sd">    &lt;https://gitee.com/mindspore/mindscience/blob/master/MindSPONGE/docs/simple_formula.md&gt;`_.</span>

<span class="sd">    Args:</span>
<span class="sd">        nb14_numbers (int32): the number of necessary dihedral 1,4 terms m.</span>
<span class="sd">        atom_numbers (int32): the number of atoms n.</span>

<span class="sd">    Inputs:</span>
<span class="sd">        - **uint_crd_f** (Tensor) - The unsigned int coordinate value of each atom.</span>
<span class="sd">          The data type is uint32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **LJ_type** (Tensor) - The Lennard-Jones type of each atom.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(n,)`.</span>
<span class="sd">        - **charge** (Tensor) - The charge of each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n,)`.</span>
<span class="sd">        - **boxlength_f** (Tensor) - The length of molecular simulation box in 3 dimensions.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(3,)`.</span>
<span class="sd">        - **a_14** (Tensor) - The first atom index of each dihedral 1,4 term.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **b_14** (Tensor) - The second atom index of each dihedral 1,4 term.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **lj_scale_factor** (Tensor) - The scale factor for the</span>
<span class="sd">          Lennard-Jones part of force correction of each dihedral 1,4 term.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **cf_scale_factor** (Tensor) - The scale factor for the</span>
<span class="sd">          Coulomb part of force correction for each dihedral 1,4 terms.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **LJ_type_A** (Tensor) - The A parameter in Lennard-Jones scheme of each atom pair type.</span>
<span class="sd">          q is the number of atom pair. The data type is float32 and the shape is :math:`(q,)`.</span>
<span class="sd">        - **LJ_type_B** (Tensor) - The B parameter in Lennard-Jones shceme of each atom pair type.</span>
<span class="sd">          q is the number of atom pair. The data type is float32 and the shape is :math:`(q,)`.</span>

<span class="sd">    Outputs:</span>
<span class="sd">        - **frc_f** (Tensor) - The force felt by each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **atom_energy** (Tensor) - The accumulated potential energy for each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n,)`.</span>

<span class="sd">    Supported Platforms:</span>
<span class="sd">        ``GPU``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@prim_attr_register</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nb14_numbers</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize Dihedral14LJCFForceWithAtomEnergy.&quot;&quot;&quot;</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;nb14_numbers&#39;</span><span class="p">,</span> <span class="n">nb14_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_14_numbers</span> <span class="o">=</span> <span class="n">nb14_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span> <span class="o">=</span> <span class="n">atom_numbers</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_prim_io_names</span><span class="p">(</span>
            <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;uint_crd_f&#39;</span><span class="p">,</span> <span class="s1">&#39;LJtype&#39;</span><span class="p">,</span> <span class="s1">&#39;charge&#39;</span><span class="p">,</span> <span class="s1">&#39;boxlength_f&#39;</span><span class="p">,</span> <span class="s1">&#39;a_14&#39;</span><span class="p">,</span> <span class="s1">&#39;b_14&#39;</span><span class="p">,</span> <span class="s1">&#39;lj_scale_factor&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;cf_scale_factor&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;LJ_type_A&#39;</span><span class="p">,</span> <span class="s1">&#39;LJ_type_B&#39;</span><span class="p">],</span>
            <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;frc_f&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_energy&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;dihedral_14_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_14_numbers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">infer_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_f_shape</span><span class="p">,</span> <span class="n">ljtype_shape</span><span class="p">,</span> <span class="n">charge_shape</span><span class="p">,</span> <span class="n">boxlength_f_shape</span><span class="p">,</span> <span class="n">a_14_shape</span><span class="p">,</span> <span class="n">b_14_shape</span><span class="p">,</span>
                    <span class="n">lj_scale_factor_shape</span><span class="p">,</span> <span class="n">cf_scale_factor_shape</span><span class="p">,</span> <span class="n">lj_type_a_shape</span><span class="p">,</span> <span class="n">lj_type_b_shape</span><span class="p">):</span>
        <span class="n">cls_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_14_numbers</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">lj_type_a_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ljtype_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;LJtype_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">charge_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;charge_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">boxlength_f_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;boxlength_f_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a_14_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;a_14_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b_14_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;b_14_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lj_scale_factor_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;lj_scale_factor_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cf_scale_factor_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;cf_scale_factor_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lj_type_b_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;LJ_type_B_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>

        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_shape[0]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_shape[1]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">ljtype_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;LJtype_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">charge_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;charge_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">boxlength_f_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;boxlength_f_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">lj_type_b_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;LJ_type_B_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">a_14_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;a_14_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">b_14_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;b_14_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">lj_scale_factor_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;lj_scale_factor_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">cf_scale_factor_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;cf_scale_factor_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">uint_crd_f_shape</span><span class="p">,</span> <span class="n">charge_shape</span>

    <span class="k">def</span> <span class="nf">infer_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_f_dtype</span><span class="p">,</span> <span class="n">ljtype_dtype</span><span class="p">,</span> <span class="n">charge_dtype</span><span class="p">,</span> <span class="n">boxlength_f_type</span><span class="p">,</span> <span class="n">a_14_type</span><span class="p">,</span> <span class="n">b_14_type</span><span class="p">,</span>
                    <span class="n">lj_scale_factor_type</span><span class="p">,</span> <span class="n">cf_scale_factor_type</span><span class="p">,</span> <span class="n">lj_type_a_type</span><span class="p">,</span> <span class="n">lj_type_b_type</span><span class="p">):</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;uint_crd_f&#39;</span><span class="p">,</span> <span class="n">uint_crd_f_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">uint32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;LJtype&#39;</span><span class="p">,</span> <span class="n">ljtype_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;charge&#39;</span><span class="p">,</span> <span class="n">charge_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;boxlength_f&#39;</span><span class="p">,</span> <span class="n">boxlength_f_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;a_14&#39;</span><span class="p">,</span> <span class="n">a_14_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;b_14&#39;</span><span class="p">,</span> <span class="n">b_14_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;lj_scale_factor&#39;</span><span class="p">,</span> <span class="n">lj_scale_factor_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;cf_scale_factor&#39;</span><span class="p">,</span> <span class="n">cf_scale_factor_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;LJ_type_A&#39;</span><span class="p">,</span> <span class="n">lj_type_a_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;LJ_type_B&#39;</span><span class="p">,</span> <span class="n">lj_type_b_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">charge_dtype</span><span class="p">,</span> <span class="n">charge_dtype</span></div>


<div class="viewcode-block" id="Dihedral14LJAtomEnergy"><a class="viewcode-back" href="../../../../mindsponge/mindspore.ops.Dihedral14LJAtomEnergy.html#mindspore.ops.Dihedral14LJAtomEnergy">[docs]</a><span class="k">class</span> <span class="nc">Dihedral14LJAtomEnergy</span><span class="p">(</span><span class="n">PrimitiveWithInfer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add the potential energy caused by Lennard-Jones energy correction for each</span>
<span class="sd">    necessary dihedral 1,4 terms to the total potential energy of each atom.</span>

<span class="sd">    The calculation formula is the same as operator Dihedral14LJEnergy().</span>

<span class="sd">    Because there is a large amount of inputs and each of them are related,</span>
<span class="sd">    there is no way to construct `Examples` using random methods. For details, refer the webpage `SPONGE in MindSpore</span>
<span class="sd">    &lt;https://gitee.com/mindspore/mindscience/blob/master/MindSPONGE/docs/simple_formula.md&gt;`_.</span>

<span class="sd">    Args:</span>
<span class="sd">        nb14_numbers (int32): the number of necessary dihedral 1,4 terms m.</span>
<span class="sd">        atom_numbers (int32): the number of atoms n.</span>

<span class="sd">    Inputs:</span>
<span class="sd">        - **uint_crd_f** (Tensor) - The unsigned int coordinate value of each atom.</span>
<span class="sd">          The data type is uint32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **LJ_type** (Tensor) - The Lennard-Jones type of each atom.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(n,)`.</span>
<span class="sd">        - **charge** (Tensor) - The charge of each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n,)`.</span>
<span class="sd">        - **boxlength_f** (Tensor) - The length of molecular simulation box in 3 dimensions.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(3,)`.</span>
<span class="sd">        - **a_14** (Tensor) - The first atom index of each dihedral 1,4 term.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **b_14** (Tensor) - The second atom index of each dihedral 1,4 term.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **lj_scale_factor** (Tensor) - The scale factor for the</span>
<span class="sd">          Lennard-Jones part of force correction of each dihedral 1,4 term.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **cf_scale_factor** (Tensor) - The scale factor for the</span>
<span class="sd">          Coulomb part of force correction for each dihedral 1,4 terms.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **LJ_type_A** (Tensor) - The A parameter in Lennard-Jones scheme of each atom pair type.</span>
<span class="sd">          q is the number of atom pair. The data type is float32 and the shape is :math:`(q,)`.</span>
<span class="sd">        - **LJ_type_B** (Tensor) - The B parameter in Lennard-Jones shceme of each atom pair type.</span>
<span class="sd">          q is the number of atom pair. The data type is float32 and the shape is :math:`(q,)`.</span>

<span class="sd">    Outputs:</span>
<span class="sd">        - **ene** (Tensor) - The accumulated potential energy of each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n,)`.</span>

<span class="sd">    Supported Platforms:</span>
<span class="sd">        ``GPU``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@prim_attr_register</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nb14_numbers</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize Dihedral14LJAtomEnergy.&quot;&quot;&quot;</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;nb14_numbers&#39;</span><span class="p">,</span> <span class="n">nb14_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_14_numbers</span> <span class="o">=</span> <span class="n">nb14_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span> <span class="o">=</span> <span class="n">atom_numbers</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_prim_io_names</span><span class="p">(</span>
            <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;uint_crd_f&#39;</span><span class="p">,</span> <span class="s1">&#39;LJtype&#39;</span><span class="p">,</span> <span class="s1">&#39;charge&#39;</span><span class="p">,</span> <span class="s1">&#39;boxlength_f&#39;</span><span class="p">,</span> <span class="s1">&#39;a_14&#39;</span><span class="p">,</span> <span class="s1">&#39;b_14&#39;</span><span class="p">,</span> <span class="s1">&#39;lj_scale_factor&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;LJ_type_A&#39;</span><span class="p">,</span> <span class="s1">&#39;LJ_type_B&#39;</span><span class="p">],</span>
            <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ene&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;dihedral_14_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_14_numbers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">infer_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_f_shape</span><span class="p">,</span> <span class="n">ljtype_shape</span><span class="p">,</span> <span class="n">charge_shape</span><span class="p">,</span> <span class="n">boxlength_f_shape</span><span class="p">,</span> <span class="n">a_14_shape</span><span class="p">,</span> <span class="n">b_14_shape</span><span class="p">,</span>
                    <span class="n">lj_scale_factor_shape</span><span class="p">,</span> <span class="n">lj_type_a_shape</span><span class="p">,</span> <span class="n">lj_type_b_shape</span><span class="p">):</span>
        <span class="n">cls_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">lj_type_a_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ljtype_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;LJtype_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">charge_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;charge_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">boxlength_f_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;boxlength_f_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a_14_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;a_14_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b_14_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;b_14_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lj_scale_factor_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;lj_scale_factor_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lj_type_b_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;LJ_type_B_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>

        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_shape[0]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_shape[1]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">ljtype_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;LJtype_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">charge_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;charge_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">boxlength_f_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;boxlength_f_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">lj_type_b_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;LJ_type_B_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_14_numbers</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">a_14_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;a_14_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">b_14_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;b_14_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">lj_scale_factor_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;lj_scale_factor_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ljtype_shape</span>

    <span class="k">def</span> <span class="nf">infer_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_f_dtype</span><span class="p">,</span> <span class="n">ljtype_dtype</span><span class="p">,</span> <span class="n">charge_dtype</span><span class="p">,</span> <span class="n">boxlength_f_type</span><span class="p">,</span> <span class="n">a_14_type</span><span class="p">,</span> <span class="n">b_14_type</span><span class="p">,</span>
                    <span class="n">lj_scale_factor_type</span><span class="p">,</span> <span class="n">lj_type_a_type</span><span class="p">,</span> <span class="n">lj_type_b_type</span><span class="p">):</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;uint_crd_f&#39;</span><span class="p">,</span> <span class="n">uint_crd_f_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">uint32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;LJtype&#39;</span><span class="p">,</span> <span class="n">ljtype_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;charge&#39;</span><span class="p">,</span> <span class="n">charge_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;boxlength_f&#39;</span><span class="p">,</span> <span class="n">boxlength_f_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;a_14&#39;</span><span class="p">,</span> <span class="n">a_14_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;b_14&#39;</span><span class="p">,</span> <span class="n">b_14_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;lj_scale_factor&#39;</span><span class="p">,</span> <span class="n">lj_scale_factor_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;LJ_type_A&#39;</span><span class="p">,</span> <span class="n">lj_type_a_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;LJ_type_B&#39;</span><span class="p">,</span> <span class="n">lj_type_b_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">lj_type_a_type</span></div>


<div class="viewcode-block" id="Dihedral14CFEnergy"><a class="viewcode-back" href="../../../../mindsponge/mindspore.ops.Dihedral14CFEnergy.html#mindspore.ops.Dihedral14CFEnergy">[docs]</a><span class="k">class</span> <span class="nc">Dihedral14CFEnergy</span><span class="p">(</span><span class="n">PrimitiveWithInfer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the Coulumb part of 1,4 dihedral energy correction for</span>
<span class="sd">    each necessary dihedral terms on the corresponding atoms.</span>

<span class="sd">    Because there is a large amount of inputs and each of them are related,</span>
<span class="sd">    there is no way to construct `Examples` using random methods. For details, refer the webpage `SPONGE in MindSpore</span>
<span class="sd">    &lt;https://gitee.com/mindspore/mindscience/blob/master/MindSPONGE/docs/simple_formula.md&gt;`_.</span>

<span class="sd">    .. math::</span>

<span class="sd">        dr = (x_a-x_b, y_a-y_b, z_a-z_b)</span>

<span class="sd">    .. math::</span>
<span class="sd">        E = k*q_a*q_b/|dr|</span>

<span class="sd">    Args:</span>
<span class="sd">        nb14_numbers (int32): the number of necessary dihedral 1,4 terms m.</span>
<span class="sd">        atom_numbers (int32): the number of atoms n.</span>

<span class="sd">    Inputs:</span>
<span class="sd">        - **uint_crd_f** (Tensor) - The unsigned int coordinate value of each atom.</span>
<span class="sd">          The data type is uint32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **LJ_type** (Tensor) - The Lennard-Jones type of each atom.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(n,)`.</span>
<span class="sd">        - **charge** (Tensor) - The charge of each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n,)`.</span>
<span class="sd">        - **boxlength_f** (Tensor) - The length of molecular simulation box in 3 dimensions.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(3,)`.</span>
<span class="sd">        - **a_14** (Tensor) - The first atom index of each dihedral 1,4 term.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **b_14** (Tensor) - The second atom index of each dihedral 1,4 term.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **cf_scale_factor** (Tensor) - The scale factor for the</span>
<span class="sd">          Coulomb part of force correction for each dihedral 1,4 terms.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>

<span class="sd">    Outputs:</span>
<span class="sd">        - **ene** (Tensor) - The accumulated potential energy of each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>

<span class="sd">    Supported Platforms:</span>
<span class="sd">        ``GPU``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@prim_attr_register</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nb14_numbers</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize Dihedral14CFEnergy.&quot;&quot;&quot;</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;nb14_numbers&#39;</span><span class="p">,</span> <span class="n">nb14_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_14_numbers</span> <span class="o">=</span> <span class="n">nb14_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span> <span class="o">=</span> <span class="n">atom_numbers</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_prim_io_names</span><span class="p">(</span>
            <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;uint_crd_f&#39;</span><span class="p">,</span> <span class="s1">&#39;LJtype&#39;</span><span class="p">,</span> <span class="s1">&#39;charge&#39;</span><span class="p">,</span> <span class="s1">&#39;boxlength_f&#39;</span><span class="p">,</span> <span class="s1">&#39;a_14&#39;</span><span class="p">,</span> <span class="s1">&#39;b_14&#39;</span><span class="p">,</span> <span class="s1">&#39;cj_scale_factor&#39;</span><span class="p">],</span>
            <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ene&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;dihedral_14_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_14_numbers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">infer_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_f_shape</span><span class="p">,</span> <span class="n">ljtype_shape</span><span class="p">,</span> <span class="n">charge_shape</span><span class="p">,</span> <span class="n">boxlength_f_shape</span><span class="p">,</span> <span class="n">a_14_shape</span><span class="p">,</span> <span class="n">b_14_shape</span><span class="p">,</span>
                    <span class="n">cf_scale_factor_shape</span><span class="p">):</span>
        <span class="n">cls_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ljtype_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;LJtype_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">charge_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;charge_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">boxlength_f_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;boxlength_f_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a_14_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;a_14_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b_14_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;b_14_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cf_scale_factor_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;cf_scale_factor_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>

        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_shape[0]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_shape[1]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">ljtype_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;LJtype_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">charge_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;charge_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">boxlength_f_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;boxlength_f_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_14_numbers</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">a_14_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;a_14_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">b_14_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;b_14_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">cf_scale_factor_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;cf_scale_factor_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dihedral_14_numbers</span><span class="p">,]</span>

    <span class="k">def</span> <span class="nf">infer_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_f_dtype</span><span class="p">,</span> <span class="n">ljtype_dtype</span><span class="p">,</span> <span class="n">charge_dtype</span><span class="p">,</span> <span class="n">boxlength_f_type</span><span class="p">,</span> <span class="n">a_14_type</span><span class="p">,</span> <span class="n">b_14_type</span><span class="p">,</span>
                    <span class="n">cf_scale_factor_type</span><span class="p">):</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;uint_crd_f&#39;</span><span class="p">,</span> <span class="n">uint_crd_f_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">uint32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;LJtype&#39;</span><span class="p">,</span> <span class="n">ljtype_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;charge&#39;</span><span class="p">,</span> <span class="n">charge_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;boxlength_f&#39;</span><span class="p">,</span> <span class="n">boxlength_f_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;a_14&#39;</span><span class="p">,</span> <span class="n">a_14_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;b_14&#39;</span><span class="p">,</span> <span class="n">b_14_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;lj_scale_factor&#39;</span><span class="p">,</span> <span class="n">cf_scale_factor_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">charge_dtype</span></div>


<div class="viewcode-block" id="Dihedral14CFAtomEnergy"><a class="viewcode-back" href="../../../../mindsponge/mindspore.ops.Dihedral14CFAtomEnergy.html#mindspore.ops.Dihedral14CFAtomEnergy">[docs]</a><span class="k">class</span> <span class="nc">Dihedral14CFAtomEnergy</span><span class="p">(</span><span class="n">PrimitiveWithInfer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add the potential energy caused by Coulumb energy correction for each</span>
<span class="sd">    necessary dihedral 1,4 terms to the total potential energy of each atom.</span>

<span class="sd">    The calculation formula is the same as operator :class:`Dihedral14CFEnergy`.</span>

<span class="sd">    Because there is a large amount of inputs and each of them are related,</span>
<span class="sd">    there is no way to construct `Examples` using random methods. For details, refer the webpage `SPONGE in MindSpore</span>
<span class="sd">    &lt;https://gitee.com/mindspore/mindscience/blob/master/MindSPONGE/docs/simple_formula.md&gt;`_.</span>

<span class="sd">    Args:</span>
<span class="sd">        nb14_numbers (int32): the number of necessary dihedral 1,4 terms m.</span>
<span class="sd">        atom_numbers (int32): the number of atoms n.</span>

<span class="sd">    Inputs:</span>
<span class="sd">        - **uint_crd_f** (Tensor) - The unsigned int coordinate value of each atom.</span>
<span class="sd">          The data type is uint32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **LJ_type** (Tensor) - The Lennard-Jones type of each atom.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(n,)`.</span>
<span class="sd">        - **charge** (Tensor) - The charge of each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n,)`.</span>
<span class="sd">        - **boxlength_f** (Tensor) - The length of molecular simulation box in 3 dimensions.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(3,)`.</span>
<span class="sd">        - **a_14** (Tensor) - The first atom index of each dihedral 1,4 term.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **b_14** (Tensor) - The second atom index of each dihedral 1,4 term.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **cf_scale_factor** (Tensor) - The scale factor for the</span>
<span class="sd">          Coulomb part of force correction for each dihedral 1,4 terms.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(m,)`.</span>

<span class="sd">    Outputs:</span>
<span class="sd">        - **ene** (Tensor) - The accumulated potential energy of each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n,)`</span>


<span class="sd">    Supported Platforms:</span>
<span class="sd">        ``GPU``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@prim_attr_register</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nb14_numbers</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize Dihedral14CFAtomEnergy.&quot;&quot;&quot;</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;nb14_numbers&#39;</span><span class="p">,</span> <span class="n">nb14_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_14_numbers</span> <span class="o">=</span> <span class="n">nb14_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span> <span class="o">=</span> <span class="n">atom_numbers</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_prim_io_names</span><span class="p">(</span>
            <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;uint_crd_f&#39;</span><span class="p">,</span> <span class="s1">&#39;LJtype&#39;</span><span class="p">,</span> <span class="s1">&#39;charge&#39;</span><span class="p">,</span> <span class="s1">&#39;boxlength_f&#39;</span><span class="p">,</span> <span class="s1">&#39;a_14&#39;</span><span class="p">,</span> <span class="s1">&#39;b_14&#39;</span><span class="p">,</span> <span class="s1">&#39;cf_scale_factor&#39;</span><span class="p">],</span>
            <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ene&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;dihedral_14_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_14_numbers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">infer_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_f_shape</span><span class="p">,</span> <span class="n">ljtype_shape</span><span class="p">,</span> <span class="n">charge_shape</span><span class="p">,</span> <span class="n">boxlength_f_shape</span><span class="p">,</span> <span class="n">a_14_shape</span><span class="p">,</span> <span class="n">b_14_shape</span><span class="p">,</span>
                    <span class="n">cf_scale_factor_shape</span><span class="p">):</span>
        <span class="n">cls_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ljtype_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;LJtype_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">charge_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;charge_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">boxlength_f_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;boxlength_f_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a_14_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;a_14_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b_14_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;b_14_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cf_scale_factor_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;cf_scale_factor_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>

        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_shape[0]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd_f_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_f_shape[1]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">ljtype_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;LJtype_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">charge_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;charge_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">boxlength_f_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;boxlength_f_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_14_numbers</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">a_14_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;a_14_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">b_14_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;b_14_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">cf_scale_factor_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;cf_scale_factor_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ljtype_shape</span>

    <span class="k">def</span> <span class="nf">infer_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_f_dtype</span><span class="p">,</span> <span class="n">ljtype_dtype</span><span class="p">,</span> <span class="n">charge_dtype</span><span class="p">,</span> <span class="n">boxlength_f_type</span><span class="p">,</span> <span class="n">a_14_type</span><span class="p">,</span> <span class="n">b_14_type</span><span class="p">,</span>
                    <span class="n">cf_scale_factor_type</span><span class="p">):</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;uint_crd_f&#39;</span><span class="p">,</span> <span class="n">uint_crd_f_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">uint32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;LJtype&#39;</span><span class="p">,</span> <span class="n">ljtype_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;charge&#39;</span><span class="p">,</span> <span class="n">charge_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;boxlength_f&#39;</span><span class="p">,</span> <span class="n">boxlength_f_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;a_14&#39;</span><span class="p">,</span> <span class="n">a_14_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;b_14&#39;</span><span class="p">,</span> <span class="n">b_14_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;cf_scale_factor&#39;</span><span class="p">,</span> <span class="n">cf_scale_factor_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">charge_dtype</span></div>


<div class="viewcode-block" id="PMEReciprocalForce"><a class="viewcode-back" href="../../../../mindsponge/mindspore.ops.PMEReciprocalForce.html#mindspore.ops.PMEReciprocalForce">[docs]</a><span class="k">class</span> <span class="nc">PMEReciprocalForce</span><span class="p">(</span><span class="n">PrimitiveWithInfer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the reciprocal part of long-range Coulumb force using</span>
<span class="sd">    PME(Particle Meshed Ewald) method. Assume the number of atoms is n.</span>

<span class="sd">    The detailed calculation formula of PME(Particle Meshed Ewald) method</span>
<span class="sd">    can be found in this paper: A Smooth Particle Mesh Ewald Method. DOI:</span>
<span class="sd">    10.1063/1.470117.</span>

<span class="sd">    Because there is a large amount of inputs and each of them are related,</span>
<span class="sd">    there is no way to construct `Examples` using random methods. For details, refer the webpage `SPONGE in MindSpore</span>
<span class="sd">    &lt;https://gitee.com/mindspore/mindscience/blob/master/MindSPONGE/docs/simple_formula.md&gt;`_.</span>

<span class="sd">    Args:</span>
<span class="sd">        atom_numbers(int32): the number of atoms, n.</span>
<span class="sd">        beta(float32): the PME beta parameter, determined by the</span>
<span class="sd">                       non-bond cutoff value and simulation precision tolerance.</span>
<span class="sd">        fftx(int32): the number of points for Fourier transform in dimension X.</span>
<span class="sd">        ffty(int32): the number of points for Fourier transform in dimension Y.</span>
<span class="sd">        fftz(int32): the number of points for Fourier transform in dimension Z.</span>
<span class="sd">        box_length_0(float32): the value of boxlength idx 0</span>
<span class="sd">        box_length_1(float32): the value of boxlength idx 1</span>
<span class="sd">        box_length_2(float32): the value of boxlength idx 2</span>

<span class="sd">    Inputs:</span>
<span class="sd">        - **uint_crd** (Tensor) - The unsigned int coordinates value of each atom.</span>
<span class="sd">          The data type is uint32 and the shape is :math:`(n, 3)`</span>
<span class="sd">        - **charge** (Tensor) - The charge carried by each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n,)`</span>

<span class="sd">    Outputs:</span>
<span class="sd">        - **force** (Tensor) - The force felt by each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n, 3)`</span>

<span class="sd">    Supported Platforms:</span>
<span class="sd">        ``GPU``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@prim_attr_register</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">fftx</span><span class="p">,</span> <span class="n">ffty</span><span class="p">,</span> <span class="n">fftz</span><span class="p">,</span> <span class="n">box_length_0</span><span class="p">,</span> <span class="n">box_length_1</span><span class="p">,</span> <span class="n">box_length_2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize PMEReciprocalForce.&quot;&quot;&quot;</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;beta&#39;</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;fftx&#39;</span><span class="p">,</span> <span class="n">fftx</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;ffty&#39;</span><span class="p">,</span> <span class="n">ffty</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;fftz&#39;</span><span class="p">,</span> <span class="n">fftz</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;box_length_0&#39;</span><span class="p">,</span> <span class="n">box_length_0</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;box_length_1&#39;</span><span class="p">,</span> <span class="n">box_length_1</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;box_length_2&#39;</span><span class="p">,</span> <span class="n">box_length_2</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span> <span class="o">=</span> <span class="n">atom_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="n">beta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fftx</span> <span class="o">=</span> <span class="n">fftx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ffty</span> <span class="o">=</span> <span class="n">ffty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fftz</span> <span class="o">=</span> <span class="n">fftz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">box_length_0</span> <span class="o">=</span> <span class="n">box_length_0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">box_length_1</span> <span class="o">=</span> <span class="n">box_length_1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">box_length_2</span> <span class="o">=</span> <span class="n">box_length_2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_prim_io_names</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;boxlength&#39;</span><span class="p">,</span> <span class="s1">&#39;uint_crd&#39;</span><span class="p">,</span> <span class="s1">&#39;charge&#39;</span><span class="p">],</span>
                                <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;force&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;beta&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;fftx&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fftx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;ffty&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ffty</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;fftz&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fftz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;box_length_0&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_length_0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;box_length_1&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_length_1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;box_length_2&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_length_2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">infer_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_shape</span><span class="p">,</span> <span class="n">charge_shape</span><span class="p">):</span>
        <span class="n">cls_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uint_crd_shape</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">charge_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;charge_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>

        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_shape[0]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_shape[1]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">charge_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;charge_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">uint_crd_shape</span>

    <span class="k">def</span> <span class="nf">infer_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_type</span><span class="p">,</span> <span class="n">charge_type</span><span class="p">):</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;uint_crd&#39;</span><span class="p">,</span> <span class="n">uint_crd_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">uint32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;charge&#39;</span><span class="p">,</span> <span class="n">charge_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">charge_type</span></div>


<div class="viewcode-block" id="PMEExcludedForce"><a class="viewcode-back" href="../../../../mindsponge/mindspore.ops.PMEExcludedForce.html#mindspore.ops.PMEExcludedForce">[docs]</a><span class="k">class</span> <span class="nc">PMEExcludedForce</span><span class="p">(</span><span class="n">PrimitiveWithInfer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the excluded  part of long-range Coulumb force using</span>
<span class="sd">    PME(Particle Meshed Ewald) method. Assume the number of atoms is</span>
<span class="sd">    n, and the length of excluded list is E.</span>

<span class="sd">    Because there is a large amount of inputs and each of them are related,</span>
<span class="sd">    there is no way to construct `Examples` using random methods. For details, refer the webpage `SPONGE in MindSpore</span>
<span class="sd">    &lt;https://gitee.com/mindspore/mindscience/blob/master/MindSPONGE/docs/simple_formula.md&gt;`_.</span>

<span class="sd">    Args:</span>
<span class="sd">        atom_numbers(int32): the number of atoms, n.</span>
<span class="sd">        excluded_numbers(int32): the length of excluded list, E.</span>
<span class="sd">        beta(float32): the PME beta parameter, determined by the</span>
<span class="sd">          non-bond cutoff value and simulation precision tolerance.</span>

<span class="sd">    Inputs:</span>
<span class="sd">        - **uint_crd** (Tensor) - The unsigned int coordinates value of each atom.</span>
<span class="sd">          The data type is uint32 and the shape is :math:`(n, 3)`</span>
<span class="sd">        - **scaler** (Tensor) - The scale factor between real space</span>
<span class="sd">          coordinates and its unsigned int value. The data type is float32 and the shape is :math:`(3,)`</span>
<span class="sd">        - **charge** (Tensor) - The charge carried by each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n,)`</span>
<span class="sd">        - **excluded_list_start** (Tensor) - The start excluded index</span>
<span class="sd">          in excluded list for each atom. The data type is int32 and the shape is :math:`(n,)`</span>
<span class="sd">        - **excluded_list** (Tensor) - The contiguous join of excluded</span>
<span class="sd">          list of each atom. E is the number of excluded atoms. The data type is int32 and the shape is :math:`(E,)`</span>
<span class="sd">        - **excluded_atom_numbers** (Tensor) - The number of atom excluded</span>
<span class="sd">          in excluded list for each atom. The data type is int32 and the shape is :math:`(n,)`</span>

<span class="sd">    Outputs:</span>
<span class="sd">        - **force** (Tensor) - The force felt by each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n, 3)`</span>

<span class="sd">    Supported Platforms:</span>
<span class="sd">        ``GPU``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@prim_attr_register</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">,</span> <span class="n">excluded_numbers</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize PMEExcludedForce.&quot;&quot;&quot;</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;excluded_numbers&#39;</span><span class="p">,</span> <span class="n">excluded_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;beta&#39;</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span> <span class="o">=</span> <span class="n">atom_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">excluded_numbers</span> <span class="o">=</span> <span class="n">excluded_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="n">beta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_prim_io_names</span><span class="p">(</span>
            <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;uint_crd&#39;</span><span class="p">,</span> <span class="s1">&#39;sacler&#39;</span><span class="p">,</span> <span class="s1">&#39;charge&#39;</span><span class="p">,</span> <span class="s1">&#39;excluded_list_start&#39;</span><span class="p">,</span> <span class="s1">&#39;excluded_list&#39;</span><span class="p">,</span> <span class="s1">&#39;excluded_atom_numbers&#39;</span><span class="p">],</span>
            <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;force&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;excluded_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">excluded_numbers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;beta&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">infer_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_shape</span><span class="p">,</span> <span class="n">sacler_shape</span><span class="p">,</span> <span class="n">charge_shape</span><span class="p">,</span> <span class="n">excluded_list_start_shape</span><span class="p">,</span> <span class="n">excluded_list_shape</span><span class="p">,</span>
                    <span class="n">excluded_atom_numbers_shape</span><span class="p">):</span>
        <span class="n">cls_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uint_crd_shape</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sacler_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;sacler_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">charge_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;charge_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">excluded_list_start_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;excluded_list_start_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">excluded_atom_numbers_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;excluded_atom_numbers_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>

        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_shape[0]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_shape[1]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">sacler_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;sacler_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">charge_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;charge_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">excluded_list_start_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;excluded_list_start_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">excluded_atom_numbers_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;excluded_atom_numbers_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">uint_crd_shape</span>

    <span class="k">def</span> <span class="nf">infer_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd_type</span><span class="p">,</span> <span class="n">sacler_type</span><span class="p">,</span> <span class="n">charge_type</span><span class="p">,</span> <span class="n">excluded_list_start_type</span><span class="p">,</span> <span class="n">excluded_list_type</span><span class="p">,</span>
                    <span class="n">excluded_atom_numbers_type</span><span class="p">):</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;sacler&#39;</span><span class="p">,</span> <span class="n">sacler_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;uint_crd&#39;</span><span class="p">,</span> <span class="n">uint_crd_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">uint32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;charge&#39;</span><span class="p">,</span> <span class="n">charge_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;excluded_list_start&#39;</span><span class="p">,</span> <span class="n">excluded_list_start_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;excluded_list&#39;</span><span class="p">,</span> <span class="n">excluded_list_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;excluded_atom_numbers&#39;</span><span class="p">,</span> <span class="n">excluded_atom_numbers_type</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">charge_type</span></div>


<div class="viewcode-block" id="PMEEnergy"><a class="viewcode-back" href="../../../../mindsponge/mindspore.ops.PMEEnergy.html#mindspore.ops.PMEEnergy">[docs]</a><span class="k">class</span> <span class="nc">PMEEnergy</span><span class="p">(</span><span class="n">PrimitiveWithInfer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the Coulumb energy of the system using PME method.</span>

<span class="sd">    Because there is a large amount of inputs and each of them are related,</span>
<span class="sd">    there is no way to construct `Examples` using random methods. For details, refer the webpage `SPONGE in MindSpore</span>
<span class="sd">    &lt;https://gitee.com/mindspore/mindscience/blob/master/MindSPONGE/docs/simple_formula.md&gt;`_.</span>

<span class="sd">    .. math::</span>

<span class="sd">        E = sum_{ij} q_iq_j/r_{ij}</span>

<span class="sd">    Args:</span>
<span class="sd">        atom_numbers(int32): the number of atoms, n.</span>
<span class="sd">        excluded_numbers(int32): the length of excluded list, E.</span>
<span class="sd">        beta(float32): the PME beta parameter, determined by the</span>
<span class="sd">                       non-bond cutoff value and simulation precision tolerance.</span>
<span class="sd">        fftx(int32): the number of points for Fourier transform in dimension X.</span>
<span class="sd">        ffty(int32): the number of points for Fourier transform in dimension Y.</span>
<span class="sd">        fftz(int32): the number of points for Fourier transform in dimension Z.</span>
<span class="sd">        box_length_0(float32): the value of boxlength idx 0</span>
<span class="sd">        box_length_1(float32): the value of boxlength idx 1</span>
<span class="sd">        box_length_2(float32): the value of boxlength idx 2</span>


<span class="sd">    Inputs:</span>
<span class="sd">        - **uint_crd** (Tensor) - The unsigned int coordinates value of each atom.</span>
<span class="sd">          The data type is uint32 and the shape is :math:`(n, 3)`</span>
<span class="sd">        - **charge** (Tensor) - The charge carried by each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n,)`</span>
<span class="sd">        - **nl_numbers** - (Tensor) - The each atom.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(n, 3)`</span>
<span class="sd">        - **nl_serial** - (Tensor) - The neighbor list of each atom, the max number is 800.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(n, 800)`</span>
<span class="sd">        - **scaler** (Tensor) - The scale factor between real space</span>
<span class="sd">          coordinates and its unsigned int value. The data type is float32 and the shape is :math:`(3,)`</span>
<span class="sd">        - **excluded_list_start** (Tensor) - The start excluded index</span>
<span class="sd">          in excluded list for each atom. The data type is int32 and the shape is :math:`(n,)`</span>
<span class="sd">        - **excluded_list** (Tensor) - The contiguous join of excluded</span>
<span class="sd">          list of each atom. E is the number of excluded atoms. The data type is int32 and the shape is :math:`(E,)`</span>
<span class="sd">        - **excluded_atom_numbers** (Tensor) - The number of atom excluded</span>
<span class="sd">          in excluded list for each atom. The data type is int32 and the shape is :math:`(n,)`</span>

<span class="sd">    Outputs:</span>
<span class="sd">        - **reciprocal_ene** (Tensor) - The reciprocal term of PME energy.</span>
<span class="sd">          The data type is float32 and the the shape is :math:`(1,)`.</span>
<span class="sd">        - **self_ene** (Tensor) - The self term of PME energy.</span>
<span class="sd">          The data type is float32 and the the shape is :math:`(1,)`.</span>
<span class="sd">        - **direct_ene** (Tensor) - The direct term of PME energy.</span>
<span class="sd">          The data type is float32 and the the shape is :math:`(1,)`.</span>
<span class="sd">        - **correction_ene** (Tensor) - The correction term of PME energy.</span>
<span class="sd">          The data type is float32 and the the shape is :math:`(1,)`.</span>

<span class="sd">    Supported Platforms:</span>
<span class="sd">        ``GPU``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@prim_attr_register</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">,</span> <span class="n">excluded_numbers</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">fftx</span><span class="p">,</span> <span class="n">ffty</span><span class="p">,</span> <span class="n">fftz</span><span class="p">,</span> <span class="n">box_length_0</span><span class="p">,</span> <span class="n">box_length_1</span><span class="p">,</span>
                 <span class="n">box_length_2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize PMEEnergy.&quot;&quot;&quot;</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;excluded_numbers&#39;</span><span class="p">,</span> <span class="n">excluded_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;beta&#39;</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;fftx&#39;</span><span class="p">,</span> <span class="n">fftx</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;ffty&#39;</span><span class="p">,</span> <span class="n">ffty</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;fftz&#39;</span><span class="p">,</span> <span class="n">fftz</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;box_length_0&#39;</span><span class="p">,</span> <span class="n">box_length_0</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;box_length_1&#39;</span><span class="p">,</span> <span class="n">box_length_1</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;box_length_2&#39;</span><span class="p">,</span> <span class="n">box_length_2</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span> <span class="o">=</span> <span class="n">atom_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">excluded_numbers</span> <span class="o">=</span> <span class="n">excluded_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="n">beta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fftx</span> <span class="o">=</span> <span class="n">fftx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ffty</span> <span class="o">=</span> <span class="n">ffty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fftz</span> <span class="o">=</span> <span class="n">fftz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">box_length_0</span> <span class="o">=</span> <span class="n">box_length_0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">box_length_1</span> <span class="o">=</span> <span class="n">box_length_1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">box_length_2</span> <span class="o">=</span> <span class="n">box_length_2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_prim_io_names</span><span class="p">(</span>
            <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;box_length&#39;</span><span class="p">,</span> <span class="s1">&#39;uint_crd&#39;</span><span class="p">,</span> <span class="s1">&#39;charge&#39;</span><span class="p">,</span> <span class="s1">&#39;nl_numbers&#39;</span><span class="p">,</span> <span class="s1">&#39;nl_serial&#39;</span><span class="p">,</span> <span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="s1">&#39;excluded_list_start&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;excluded_list&#39;</span><span class="p">,</span> <span class="s1">&#39;excluded_atom_numbers&#39;</span><span class="p">],</span>
            <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;reciprocal_ene&#39;</span><span class="p">,</span> <span class="s1">&#39;self_ene&#39;</span><span class="p">,</span> <span class="s1">&#39;direct_ene&#39;</span><span class="p">,</span> <span class="s1">&#39;correction_ene&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;excluded_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">excluded_numbers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;beta&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;fftx&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fftx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;ffty&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ffty</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;fftz&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fftz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;box_length_0&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_length_0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;box_length_1&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_length_1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;box_length_2&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_length_2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">infer_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd</span><span class="p">,</span> <span class="n">charge</span><span class="p">,</span> <span class="n">nl_numbers</span><span class="p">,</span> <span class="n">nl_serial</span><span class="p">,</span> <span class="n">scaler</span><span class="p">,</span> <span class="n">excluded_list_start</span><span class="p">,</span>
                    <span class="n">excluded_list</span><span class="p">,</span> <span class="n">excluded_atom_numbers</span><span class="p">):</span>
        <span class="n">cls_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uint_crd</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">charge</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;charge_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nl_numbers</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;nl_numbers_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nl_serial</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">LE</span><span class="p">,</span> <span class="s2">&quot;nl_serial_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">excluded_list_start</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;excluded_list_start_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">excluded_atom_numbers</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;excluded_atom_numbers_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">excluded_list</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">GE</span><span class="p">,</span> <span class="s2">&quot;excluded_list&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>

        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_shape[0]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_shape[1]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">charge</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;charge_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">nl_numbers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;nl_numbers_shape[0]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">nl_serial</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">LE</span><span class="p">,</span> <span class="s2">&quot;nl_serial_shape[0]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">nl_serial</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">800</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">LE</span><span class="p">,</span> <span class="s2">&quot;nl_serial_shape[1]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">excluded_list_start</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;excluded_list_start_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">excluded_atom_numbers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;excluded_atom_numbers_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">excluded_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">GE</span><span class="p">,</span> <span class="s2">&quot;excluded_list_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span>

    <span class="k">def</span> <span class="nf">infer_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd</span><span class="p">,</span> <span class="n">charge</span><span class="p">,</span> <span class="n">nl_numbers</span><span class="p">,</span> <span class="n">nl_serial</span><span class="p">,</span> <span class="n">scaler</span><span class="p">,</span> <span class="n">excluded_list_start</span><span class="p">,</span>
                    <span class="n">excluded_list</span><span class="p">,</span> <span class="n">excluded_atom_numbers</span><span class="p">):</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;uint_crd&#39;</span><span class="p">,</span> <span class="n">uint_crd</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">uint32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;charge&#39;</span><span class="p">,</span> <span class="n">charge</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;nl_numbers&#39;</span><span class="p">,</span> <span class="n">nl_numbers</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;nl_serial&#39;</span><span class="p">,</span> <span class="n">nl_serial</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;excluded_list_start&#39;</span><span class="p">,</span> <span class="n">excluded_list_start</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;excluded_list&#39;</span><span class="p">,</span> <span class="n">excluded_list</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;excluded_atom_numbers&#39;</span><span class="p">,</span> <span class="n">excluded_atom_numbers</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">charge</span><span class="p">,</span> <span class="n">charge</span><span class="p">,</span> <span class="n">charge</span><span class="p">,</span> <span class="n">charge</span></div>


<div class="viewcode-block" id="LJEnergy"><a class="viewcode-back" href="../../../../mindsponge/mindspore.ops.LJEnergy.html#mindspore.ops.LJEnergy">[docs]</a><span class="k">class</span> <span class="nc">LJEnergy</span><span class="p">(</span><span class="n">PrimitiveWithInfer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the Van der Waals interaction energy described by Lennard-Jones</span>
<span class="sd">    potential for each atom. Assume the number of atoms is n, and the number</span>
<span class="sd">    of Lennard-Jones types for all atoms is P, which means there will be</span>
<span class="sd">    q = P*(P+1)/2 types of possible Lennard-Jones interactions for all kinds</span>
<span class="sd">    of atom pairs.</span>

<span class="sd">    Because there is a large amount of inputs and each of them are related,</span>
<span class="sd">    there is no way to construct `Examples` using random methods. For details, refer the webpage `SPONGE in MindSpore</span>
<span class="sd">    &lt;https://gitee.com/mindspore/mindscience/blob/master/MindSPONGE/docs/simple_formula.md&gt;`_.</span>

<span class="sd">    .. math::</span>

<span class="sd">        dr = (x_a-x_b, y_a-y_b, z_a-z_b)</span>

<span class="sd">    .. math::</span>
<span class="sd">        E = A/|dr|^{12} - B/|dr|^{6}</span>

<span class="sd">    Args:</span>
<span class="sd">        atom_numbers(int32): the number of atoms, n.</span>
<span class="sd">        cutoff_square(float32): the square value of cutoff.</span>

<span class="sd">    Inputs:</span>
<span class="sd">        - **uint_crd** (Tensor) - The unsigned int coordinate value of each atom.</span>
<span class="sd">            The data type is uint32 and the shape is :math:`(n, 3)`</span>
<span class="sd">        - **LJtype** (Tensor) - The Lennard-Jones type of each atom.</span>
<span class="sd">           The data type is int32 and the shape is :math:`(n,)`</span>
<span class="sd">        - **charge** (Tensor) - The charge carried by each atom.</span>
<span class="sd">           The data type is float32 and the shape is :math:`(n,)`</span>
<span class="sd">        - **scaler** (Tensor) - The scale factor between real</span>
<span class="sd">          space coordinate and its unsigned int value. The data type is float32 and the shape is :math:`(3,)`</span>
<span class="sd">        - **nl_numbers** - (Tensor) - The each atom.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(n,)`</span>
<span class="sd">        - **nl_serial** - (Tensor) - The neighbor list of each atom, the max number is 800.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(n, 800)`.</span>
<span class="sd">        - **d_LJ_A** (Tensor) - The Lennard-Jones A coefficient of each kind of atom pair.</span>
<span class="sd">          q is the number of atom pair. The data type is float32 and the shape is :math:`(q,)`.</span>
<span class="sd">        - **d_LJ_B** (Tensor) - The Lennard-Jones B coefficient of each kind of atom pair.</span>
<span class="sd">          q is the number of atom pair. The data type is float32 and the shape is :math:`(q,)`.</span>

<span class="sd">    Outputs:</span>
<span class="sd">        - **d_LJ_energy_atom** (Tensor) - The Lennard-Jones potential energy of each atom.</span>
<span class="sd">           The data type is float32 and the shape is :math:`(n,)`.</span>
<span class="sd">        - **d_LJ_energy_sum** (Scalar), the sum of Lennard-Jones potential energy of each atom.</span>
<span class="sd">          The data type is float32.</span>

<span class="sd">    Supported Platforms:</span>
<span class="sd">        ``GPU``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@prim_attr_register</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">,</span> <span class="n">cutoff_square</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize LJEnergy.&quot;&quot;&quot;</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;cutoff_square&#39;</span><span class="p">,</span> <span class="n">cutoff_square</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span> <span class="o">=</span> <span class="n">atom_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_square</span> <span class="o">=</span> <span class="n">cutoff_square</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_prim_io_names</span><span class="p">(</span>
            <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;uint_crd&#39;</span><span class="p">,</span> <span class="s1">&#39;LJtype&#39;</span><span class="p">,</span> <span class="s1">&#39;charge&#39;</span><span class="p">,</span> <span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="s1">&#39;nl_numbers&#39;</span><span class="p">,</span> <span class="s1">&#39;nl_serial&#39;</span><span class="p">,</span> <span class="s1">&#39;d_LJ_A&#39;</span><span class="p">,</span> <span class="s1">&#39;d_LJ_B&#39;</span><span class="p">],</span>
            <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;d_LJ_energy_atom&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;cutoff_square&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_square</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">infer_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd</span><span class="p">,</span> <span class="n">ljtype</span><span class="p">,</span> <span class="n">charge</span><span class="p">,</span> <span class="n">scaler</span><span class="p">,</span> <span class="n">nl_numbers</span><span class="p">,</span> <span class="n">nl_serial</span><span class="p">,</span> <span class="n">d_lj_a</span><span class="p">,</span> <span class="n">d_lj_b</span><span class="p">):</span>
        <span class="n">cls_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">d_lj_a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uint_crd</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ljtype</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;LJtype_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">charge</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;charge_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scaler</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;scaler_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nl_numbers</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;nl_numbers_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nl_serial</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;nl_serial_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d_lj_b</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;d_LJ_B_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>

        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_shape[0]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_shape[1]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">ljtype</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;LJtype_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">charge</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;charge_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">scaler</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;scaler_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">nl_numbers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;nl_numbers_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">nl_serial</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;nl_serial_shape[0]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">nl_serial</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">800</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">LE</span><span class="p">,</span> <span class="s2">&quot;nl_serial_shape[1]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d_lj_a</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;d_LJ_A_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">d_lj_a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;d_LJ_A_shape[0]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">d_lj_b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;d_LJ_B_shape[0]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">charge</span>

    <span class="k">def</span> <span class="nf">infer_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd</span><span class="p">,</span> <span class="n">ljtype</span><span class="p">,</span> <span class="n">charge</span><span class="p">,</span> <span class="n">scaler</span><span class="p">,</span> <span class="n">nl_numbers</span><span class="p">,</span> <span class="n">nl_serial</span><span class="p">,</span> <span class="n">d_lj_a</span><span class="p">,</span> <span class="n">d_lj_b</span><span class="p">):</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;uint_crd&#39;</span><span class="p">,</span> <span class="n">uint_crd</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">uint32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;LJtype&#39;</span><span class="p">,</span> <span class="n">ljtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;charge&#39;</span><span class="p">,</span> <span class="n">charge</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;nl_numbers&#39;</span><span class="p">,</span> <span class="n">nl_numbers</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;nl_serial&#39;</span><span class="p">,</span> <span class="n">nl_serial</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;d_LJ_A&#39;</span><span class="p">,</span> <span class="n">d_lj_a</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;d_LJ_B&#39;</span><span class="p">,</span> <span class="n">d_lj_b</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">charge</span></div>


<div class="viewcode-block" id="LJForce"><a class="viewcode-back" href="../../../../mindsponge/mindspore.ops.LJForce.html#mindspore.ops.LJForce">[docs]</a><span class="k">class</span> <span class="nc">LJForce</span><span class="p">(</span><span class="n">PrimitiveWithInfer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the Van der Waals interaction force described by Lennard-Jones</span>
<span class="sd">    potential energy for each atom.</span>

<span class="sd">    Because there is a large amount of inputs and each of them are related,</span>
<span class="sd">    there is no way to construct `Examples` using random methods. For details, refer the webpage `SPONGE in MindSpore</span>
<span class="sd">    &lt;https://gitee.com/mindspore/mindscience/blob/master/MindSPONGE/docs/simple_formula.md&gt;`_.</span>

<span class="sd">    .. math::</span>

<span class="sd">        dr = (x_a-x_b, y_a-y_b, z_a-z_b)</span>

<span class="sd">    .. math::</span>

<span class="sd">        F = (-12*A/|dr|^{14} + 6*B/|dr|^{8}) * dr</span>

<span class="sd">    Args:</span>
<span class="sd">        atom_numbers(int32): the number of atoms, n.</span>
<span class="sd">        cutoff_square(float32): the square value of cutoff.</span>

<span class="sd">    Inputs:</span>
<span class="sd">        - **uint_crd** (Tensor) - The unsigned int coordinates value of each atom.</span>
<span class="sd">          The data type is uint32 and the shape is :math:`(n, 3)`</span>
<span class="sd">        - **LJtype** (Tensor) - The Lennard-Jones type of each atom.</span>
<span class="sd">           The data type is int32 and the shape is :math:`(n,)`</span>
<span class="sd">        - **charge** (Tensor) - The charge carried by each atom.</span>
<span class="sd">           The data type is float32 and the shape is :math:`(n,)`</span>
<span class="sd">        - **scaler** (Tensor) - The scale factor between real space</span>
<span class="sd">          coordinates and its unsigned int value. The data type is float32 and the shape is :math:`(3,)`</span>
<span class="sd">        - **nl_numbers** - (Tensor) - The each atom.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(n,)`</span>
<span class="sd">        - **nl_serial** - (Tensor) - The neighbor list of each atom, the max number is 800.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(n, 800)`.</span>
<span class="sd">        - **d_LJ_A** (Tensor) - The Lennard-Jones A coefficient of each kind of atom pair.</span>
<span class="sd">          q is the number of atom pair. The data type is float32 and the shape is :math:`(q,)`.</span>
<span class="sd">        - **d_LJ_B** (Tensor) - The Lennard-Jones B coefficient of each kind of atom pair.</span>
<span class="sd">          q is the number of atom pair. The data type is float32 and the shape is :math:`(q,)`.</span>

<span class="sd">    outputs:</span>
<span class="sd">        - **frc** (Tensor) - The force felt by each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n, 3)`.</span>

<span class="sd">    Supported Platforms:</span>
<span class="sd">        ``GPU``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@prim_attr_register</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">,</span> <span class="n">cutoff_square</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize LJForce.&quot;&quot;&quot;</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;cutoff_square&#39;</span><span class="p">,</span> <span class="n">cutoff_square</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span> <span class="o">=</span> <span class="n">atom_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_square</span> <span class="o">=</span> <span class="n">cutoff_square</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_prim_io_names</span><span class="p">(</span>
            <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;uint_crd&#39;</span><span class="p">,</span> <span class="s1">&#39;LJtype&#39;</span><span class="p">,</span> <span class="s1">&#39;charge&#39;</span><span class="p">,</span> <span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="s1">&#39;nl_numbers&#39;</span><span class="p">,</span> <span class="s1">&#39;nl_serial&#39;</span><span class="p">,</span> <span class="s1">&#39;d_LJ_A&#39;</span><span class="p">,</span> <span class="s1">&#39;d_LJ_B&#39;</span><span class="p">],</span>
            <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;frc&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;cutoff_square&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_square</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">infer_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd</span><span class="p">,</span> <span class="n">ljtype</span><span class="p">,</span> <span class="n">charge</span><span class="p">,</span> <span class="n">scaler</span><span class="p">,</span> <span class="n">nl_numbers</span><span class="p">,</span> <span class="n">nl_serial</span><span class="p">,</span> <span class="n">d_lj_a</span><span class="p">,</span> <span class="n">d_lj_b</span><span class="p">):</span>
        <span class="n">cls_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">d_lj_a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uint_crd</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ljtype</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;LJtype_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">charge</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;charge_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scaler</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;scaler_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nl_numbers</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;nl_numbers_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nl_serial</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;nl_serial_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d_lj_b</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;d_LJ_B_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>

        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_shape[0]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_shape[1]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">ljtype</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;LJtype_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">charge</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;charge_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">scaler</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;scaler_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">nl_numbers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;nl_numbers_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">nl_serial</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;nl_serial_shape[0]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">nl_serial</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">800</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;nl_serial_shape[1]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d_lj_a</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;d_LJ_A_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">d_lj_a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;d_LJ_A_shape[0]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">d_lj_b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;d_LJ_B_shape[0]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">uint_crd</span>

    <span class="k">def</span> <span class="nf">infer_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd</span><span class="p">,</span> <span class="n">ljtype</span><span class="p">,</span> <span class="n">charge</span><span class="p">,</span> <span class="n">scaler</span><span class="p">,</span> <span class="n">nl_numbers</span><span class="p">,</span> <span class="n">nl_serial</span><span class="p">,</span> <span class="n">d_lj_a</span><span class="p">,</span> <span class="n">d_lj_b</span><span class="p">):</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;uint_crd&#39;</span><span class="p">,</span> <span class="n">uint_crd</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">uint32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;LJtype&#39;</span><span class="p">,</span> <span class="n">ljtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;charge&#39;</span><span class="p">,</span> <span class="n">charge</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;nl_numbers&#39;</span><span class="p">,</span> <span class="n">nl_numbers</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;nl_serial&#39;</span><span class="p">,</span> <span class="n">nl_serial</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;d_LJ_A&#39;</span><span class="p">,</span> <span class="n">d_lj_a</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;d_LJ_B&#39;</span><span class="p">,</span> <span class="n">d_lj_b</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">charge</span></div>


<div class="viewcode-block" id="LJForceWithPMEDirectForce"><a class="viewcode-back" href="../../../../mindsponge/mindspore.ops.LJForceWithPMEDirectForce.html#mindspore.ops.LJForceWithPMEDirectForce">[docs]</a><span class="k">class</span> <span class="nc">LJForceWithPMEDirectForce</span><span class="p">(</span><span class="n">PrimitiveWithInfer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the Lennard-Jones force and PME direct force together.</span>

<span class="sd">    The calculation formula of Lennard-Jones part is the same as operator</span>
<span class="sd">    LJForce(), and the PME direct part is within PME method.</span>

<span class="sd">    Because there is a large amount of inputs and each of them are related,</span>
<span class="sd">    there is no way to construct `Examples` using random methods. For details, refer the webpage `SPONGE in MindSpore</span>
<span class="sd">    &lt;https://gitee.com/mindspore/mindscience/blob/master/MindSPONGE/docs/simple_formula.md&gt;`_.</span>

<span class="sd">    Args:</span>
<span class="sd">        atom_numbers(int32): the number of atoms, n.</span>
<span class="sd">        cutoff_square(float32): the square value of cutoff.</span>
<span class="sd">        pme_beta(float32): PME beta parameter, same as operator PMEReciprocalForce().</span>

<span class="sd">    Inputs:</span>
<span class="sd">        - **uint_crd** (Tensor) - The unsigned int coordinate value of each atom.</span>
<span class="sd">          The data type is uint32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **LJtype** (Tensor) - The Lennard-Jones type of each atom.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(n,)`.</span>
<span class="sd">        - **charge** (Tensor) - The charge carried by each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n,)`.</span>
<span class="sd">        - **scaler** (Tensor) - The scale factor between real</span>
<span class="sd">          space coordinate and its unsigned int value.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(3,)`.</span>
<span class="sd">        - **nl_numbers** - (Tensor) - The each atom.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(n,)`.</span>
<span class="sd">        - **nl_serial** - (Tensor) - The neighbor list of each atom, the max number is 800.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(n, 800)`.</span>
<span class="sd">        - **d_LJ_A** (Tensor) - The Lennard-Jones A coefficient of each kind of atom pair.</span>
<span class="sd">          q is the number of atom pair. The data type is float32 and the shape is :math:`(q,)`.</span>
<span class="sd">        - **d_LJ_B** (Tensor) - The Lennard-Jones B coefficient of each kind of atom pair.</span>
<span class="sd">          q is the number of atom pair. The data type is float32 and the shape is :math:`(q,)`.</span>

<span class="sd">    Outputs:</span>
<span class="sd">        - **frc** (Tensor), The force felt by each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n, 3)`.</span>

<span class="sd">    Supported Platforms:</span>
<span class="sd">        ``GPU``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@prim_attr_register</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">,</span> <span class="n">cutoff</span><span class="p">,</span> <span class="n">pme_beta</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize LJForceWithPMEDirectForce.&quot;&quot;&quot;</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;cutoff&#39;</span><span class="p">,</span> <span class="n">cutoff</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;pme_beta&#39;</span><span class="p">,</span> <span class="n">pme_beta</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span> <span class="o">=</span> <span class="n">atom_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span> <span class="o">=</span> <span class="n">cutoff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pme_beta</span> <span class="o">=</span> <span class="n">pme_beta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_prim_io_names</span><span class="p">(</span>
            <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;uint_crd&#39;</span><span class="p">,</span> <span class="s1">&#39;LJtype&#39;</span><span class="p">,</span> <span class="s1">&#39;charge&#39;</span><span class="p">,</span> <span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="s1">&#39;nl_numbers&#39;</span><span class="p">,</span> <span class="s1">&#39;nl_serial&#39;</span><span class="p">,</span> <span class="s1">&#39;d_LJ_A&#39;</span><span class="p">,</span> <span class="s1">&#39;d_LJ_B&#39;</span><span class="p">],</span>
            <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;frc&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;cutoff&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;pme_beta&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pme_beta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">infer_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd</span><span class="p">,</span> <span class="n">ljtype</span><span class="p">,</span> <span class="n">charge</span><span class="p">,</span> <span class="n">scaler</span><span class="p">,</span> <span class="n">nl_numbers</span><span class="p">,</span> <span class="n">nl_serial</span><span class="p">,</span> <span class="n">d_lj_a</span><span class="p">,</span> <span class="n">d_lj_b</span><span class="p">):</span>
        <span class="n">cls_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">d_lj_a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uint_crd</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ljtype</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;LJtype_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">charge</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;charge_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scaler</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;scaler_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nl_numbers</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;nl_numbers_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nl_serial</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;nl_serial_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d_lj_b</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;d_LJ_B_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>

        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_shape[0]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_shape[1]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">ljtype</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;LJtype_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">charge</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;charge_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">scaler</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;scaler_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">nl_numbers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;nl_numbers_shape&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">nl_serial</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;nl_serial_shape[0]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">nl_serial</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">800</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;nl_serial_shape[1]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d_lj_a</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;d_LJ_A_dim&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">d_lj_a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;d_LJ_A_shape[0]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">d_lj_b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;d_LJ_B_shape[0]&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">uint_crd</span>

    <span class="k">def</span> <span class="nf">infer_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uint_crd</span><span class="p">,</span> <span class="n">ljtype</span><span class="p">,</span> <span class="n">charge</span><span class="p">,</span> <span class="n">scaler</span><span class="p">,</span> <span class="n">nl_numbers</span><span class="p">,</span> <span class="n">nl_serial</span><span class="p">,</span> <span class="n">d_lj_a</span><span class="p">,</span> <span class="n">d_lj_b</span><span class="p">):</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;uint_crd&#39;</span><span class="p">,</span> <span class="n">uint_crd</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">uint32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;LJtype&#39;</span><span class="p">,</span> <span class="n">ljtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;charge&#39;</span><span class="p">,</span> <span class="n">charge</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;nl_numbers&#39;</span><span class="p">,</span> <span class="n">nl_numbers</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;nl_serial&#39;</span><span class="p">,</span> <span class="n">nl_serial</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;d_LJ_A&#39;</span><span class="p">,</span> <span class="n">d_lj_a</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;d_LJ_B&#39;</span><span class="p">,</span> <span class="n">d_lj_b</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">charge</span></div>


<div class="viewcode-block" id="MDTemperature"><a class="viewcode-back" href="../../../../mindsponge/mindspore.ops.MDTemperature.html#mindspore.ops.MDTemperature">[docs]</a><span class="k">class</span> <span class="nc">MDTemperature</span><span class="p">(</span><span class="n">PrimitiveWithInfer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the MD temperature.</span>

<span class="sd">    Because there is a large amount of inputs and each of them are related,</span>
<span class="sd">    there is no way to construct `Examples` using random methods. For details, refer the webpage `SPONGE in MindSpore</span>
<span class="sd">    &lt;https://gitee.com/mindspore/mindscience/blob/master/MindSPONGE/docs/simple_formula.md&gt;`_.</span>

<span class="sd">    Args:</span>
<span class="sd">        residue_numbers (int32): the number of residues m.</span>
<span class="sd">        atom_numbers (int32): the number of atoms n.</span>

<span class="sd">    Inputs:</span>
<span class="sd">        - **start** (Tensor) - The start atom index of each residue.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **end** (Tensor) - The end atom index of each residue.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(m,)`.</span>
<span class="sd">        - **atom_vel_f** (Tensor) - The velocity of each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **atom_mass** (Tensor) - The mass of each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n,)`.</span>

<span class="sd">    Outputs:</span>
<span class="sd">        - **ek** (Tensor) - The temperature of each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n,)`.</span>

<span class="sd">    Supported Platforms:</span>
<span class="sd">        ``GPU``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@prim_attr_register</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">residue_numbers</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize MDTemperature.&quot;&quot;&quot;</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;residue_numbers&#39;</span><span class="p">,</span> <span class="n">residue_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">residue_numbers</span> <span class="o">=</span> <span class="n">residue_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span> <span class="o">=</span> <span class="n">atom_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;residue_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">residue_numbers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_prim_io_names</span><span class="p">(</span>
            <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_vel_f&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_mass&#39;</span><span class="p">],</span>
            <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ek&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">infer_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_shape</span><span class="p">,</span> <span class="n">end_shape</span><span class="p">,</span> <span class="n">atom_vel_f_shape</span><span class="p">,</span> <span class="n">atom_mass_shape</span><span class="p">):</span>
        <span class="n">cls_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">residue_numbers</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">start_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">start_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">end_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">end_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_vel_f_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_vel_f&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_vel_f_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_vel_f&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_mass_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_mass&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_mass_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_mass&quot;</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">n</span><span class="p">,]</span>

    <span class="k">def</span> <span class="nf">infer_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_dtype</span><span class="p">,</span> <span class="n">end_dtype</span><span class="p">,</span> <span class="n">atom_vel_f_dtype</span><span class="p">,</span> <span class="n">atom_mass_dtype</span><span class="p">):</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="n">start_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="n">end_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_vel_f&#39;</span><span class="p">,</span> <span class="n">atom_vel_f_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_mass&#39;</span><span class="p">,</span> <span class="n">atom_mass_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">atom_mass_dtype</span></div>


<span class="k">class</span> <span class="nc">MDIterationLeapFrogWithRF</span><span class="p">(</span><span class="n">PrimitiveWithInfer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    One step of classical leap frog algorithm to solve the finite difference</span>
<span class="sd">    Hamiltonian equations of motion for certain system, using Langevin dynamics</span>
<span class="sd">    with Liu&#39;s thermostat scheme. Assume the number of atoms is n and the target</span>
<span class="sd">    control temperature is T.</span>

<span class="sd">    Detailed iteration formula can be found in this paper: A unified thermostat</span>
<span class="sd">    scheme for efficient configurational sampling for classical/quantum canonical</span>
<span class="sd">    ensembles via molecular dynamics. DOI: 10.1063/1.4991621.</span>

<span class="sd">    Because there is a large amount of inputs and each of them are related,</span>
<span class="sd">    there is no way to construct `Examples` using random methods. For details, refer the webpage `SPONGE in MindSpore</span>
<span class="sd">    &lt;https://gitee.com/mindspore/mindscience/blob/master/MindSPONGE/docs/simple_formula.md&gt;`_.</span>

<span class="sd">    Inputs:</span>
<span class="sd">        - **float4_numbers** (Scalar) - total length to store random numbers.</span>
<span class="sd">          The data type is int32.</span>
<span class="sd">        - **atom_numbers** (Scalar) - The number of atoms n.</span>
<span class="sd">          The data type is int32.</span>
<span class="sd">        - **dt** (Scalar) - time step for finite difference. The data type is float32.</span>
<span class="sd">        - **half_dt** (Scalar) - half of time step for finite difference.</span>
<span class="sd">          The data type is float32.</span>
<span class="sd">        - **exp_gamma** (Scalar) - parameter in Liu&#39;s dynamic, equals</span>
<span class="sd">          exp(-gamma_ln * dt), where gamma_ln is the firction factor in Langvin</span>
<span class="sd">          dynamics. The data type is float32.</span>
<span class="sd">        - **max_velocity** (Scalar) - The upper limit of velocity, when the</span>
<span class="sd">          veclocity overflows, scale it to the upper limit. The data type is float32.</span>
<span class="sd">        - **is_max_velocity** (Scalar) - whether the max velocity control is</span>
<span class="sd">          open or not. The data type is int32.</span>
<span class="sd">        - **mass_inverse** (Tensor) - The inverse value of</span>
<span class="sd">          mass of each atom. The data type is float32 and the shape is :math:`(n,)`.</span>
<span class="sd">        - **sqrt_mass** (Tensor) - The inverse square root value</span>
<span class="sd">          of effect mass in Liu&#39;s dynamics of each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n,)`.</span>
<span class="sd">        - **vel** (Tensor) - The velocity of each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **crd** (Tensor) - The coordinate of each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **frc** (Tensor) - The force felt by each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **acc** (Tensor) - The acceleration of each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **random force** (Tensor) - The random forces.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n, 3)`.</span>

<span class="sd">    Outputs:</span>
<span class="sd">        - **res** (Scalar) - The data type is float32.</span>

<span class="sd">    Supported Platforms:</span>
<span class="sd">        ``GPU``</span>
<span class="sd">    Examples:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@prim_attr_register</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">float4_numbers</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">,</span> <span class="n">half_dt</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">exp_gamma</span><span class="p">,</span> <span class="n">is_max_velocity</span><span class="p">,</span> <span class="n">max_velocity</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize MDIterationLeapFrogWithRF.&quot;&quot;&quot;</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;float4_numbers&#39;</span><span class="p">,</span> <span class="n">float4_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;half_dt&#39;</span><span class="p">,</span> <span class="n">half_dt</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;dt&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;exp_gamma&#39;</span><span class="p">,</span> <span class="n">exp_gamma</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;is_max_velocity&#39;</span><span class="p">,</span> <span class="n">is_max_velocity</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;max_velocity&#39;</span><span class="p">,</span> <span class="n">max_velocity</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">float4_numbers</span> <span class="o">=</span> <span class="n">float4_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span> <span class="o">=</span> <span class="n">atom_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">half_dt</span> <span class="o">=</span> <span class="n">half_dt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="n">dt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exp_gamma</span> <span class="o">=</span> <span class="n">exp_gamma</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_max_velocity</span> <span class="o">=</span> <span class="n">is_max_velocity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_velocity</span> <span class="o">=</span> <span class="n">max_velocity</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_prim_io_names</span><span class="p">(</span>
            <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mass_inverse&#39;</span><span class="p">,</span> <span class="s1">&#39;sqrt_mass&#39;</span><span class="p">,</span> <span class="s1">&#39;vel_in&#39;</span><span class="p">,</span> <span class="s1">&#39;crd_in&#39;</span><span class="p">,</span> <span class="s1">&#39;frc_in&#39;</span><span class="p">,</span> <span class="s1">&#39;acc_in&#39;</span><span class="p">,</span> <span class="s1">&#39;random_force&#39;</span><span class="p">],</span>
            <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;res&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;float4_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">float4_numbers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;half_dt&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">half_dt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;dt&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;exp_gamma&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">exp_gamma</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;is_max_velocity&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_max_velocity</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;max_velocity&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_velocity</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">infer_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mass_inverse_shape</span><span class="p">,</span> <span class="n">sqrt_mass_shape</span><span class="p">,</span> <span class="n">vel_in_shape</span><span class="p">,</span> <span class="n">crd_in_shape</span><span class="p">,</span> <span class="n">frc_in_shape</span><span class="p">,</span> <span class="n">acc_in_shape</span><span class="p">,</span>
                    <span class="n">random_force_shape</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mass_inverse_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;mass_inverse&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sqrt_mass_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;mass_inverse&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">mass_inverse_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;mass_inverse&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">sqrt_mass_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;mass_inverse&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">vel_in_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;vel_in&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">vel_in_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;vel_in&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">crd_in_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;crd_in&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">crd_in_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;crd_in&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">frc_in_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;frc_in&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">frc_in_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;frc_in&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">acc_in_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;acc_in&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">acc_in_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;acc_in&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">random_force_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;random_force&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">random_force_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;random_force&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span><span class="mi">1</span><span class="p">,]</span>

    <span class="k">def</span> <span class="nf">infer_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mass_inverse_dtype</span><span class="p">,</span> <span class="n">sqrt_mass_dtype</span><span class="p">,</span> <span class="n">vel_in_dtype</span><span class="p">,</span> <span class="n">crd_in_dtype</span><span class="p">,</span> <span class="n">frc_in_dtype</span><span class="p">,</span> <span class="n">acc_in_dtype</span><span class="p">,</span>
                    <span class="n">rf_dtype</span><span class="p">):</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;mass_inverse&#39;</span><span class="p">,</span> <span class="n">mass_inverse_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;sqrt_mass&#39;</span><span class="p">,</span> <span class="n">sqrt_mass_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;vel_in&#39;</span><span class="p">,</span> <span class="n">vel_in_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;crd_in&#39;</span><span class="p">,</span> <span class="n">crd_in_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;frc_in&#39;</span><span class="p">,</span> <span class="n">frc_in_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;acc_in&#39;</span><span class="p">,</span> <span class="n">acc_in_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;rf&#39;</span><span class="p">,</span> <span class="n">rf_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mstype</span><span class="o">.</span><span class="n">float32</span>


<div class="viewcode-block" id="MDIterationLeapFrogLiujian"><a class="viewcode-back" href="../../../../mindsponge/mindspore.ops.MDIterationLeapFrogLiujian.html#mindspore.ops.MDIterationLeapFrogLiujian">[docs]</a><span class="k">class</span> <span class="nc">MDIterationLeapFrogLiujian</span><span class="p">(</span><span class="n">PrimitiveWithInfer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    One step of classical leap frog algorithm to solve the finite difference</span>
<span class="sd">    Hamiltonian equations of motion for certain system, using Langevin dynamics</span>
<span class="sd">    with Liu&#39;s thermostat scheme. Assume the number of atoms is n and the target</span>
<span class="sd">    control temperature is T.</span>

<span class="sd">    Detailed iteration formula can be found in this paper: A unified thermostat</span>
<span class="sd">    scheme for efficient configurational sampling for classical/quantum canonical</span>
<span class="sd">    ensembles via molecular dynamics. DOI: 10.1063/1.4991621.</span>

<span class="sd">    Because there is a large amount of inputs and each of them are related,</span>
<span class="sd">    there is no way to construct `Examples` using random methods. For details, refer the webpage `SPONGE in MindSpore</span>
<span class="sd">    &lt;https://gitee.com/mindspore/mindscience/blob/master/MindSPONGE/docs/simple_formula.md&gt;`_.</span>

<span class="sd">    Args:</span>
<span class="sd">        atom_numbers(int32): the number of atoms n.</span>
<span class="sd">        dt(float32): time step for finite difference.</span>
<span class="sd">        half_dt(float32): half of time step for finite difference.</span>
<span class="sd">        exp_gamma(float32): parameter in Liu&#39;s dynamic.</span>

<span class="sd">    Inputs:</span>
<span class="sd">        - **inverse_mass** (Tensor) - The inverse value of</span>
<span class="sd">          mass of each atom. The data type is float32 and the shape is :math:`(n)`.</span>
<span class="sd">        - **sqrt_mass_inverse** (Tensor) - The inverse square root value</span>
<span class="sd">          of effect mass in Liu&#39;s dynamics of each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n,)`.</span>
<span class="sd">        - **vel** (Tensor) - The velocity of each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **crd** (Tensor) - The coordinate of each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **frc** (Tensor) - The force felt by each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **acc** (Tensor) - The acceleration of each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **rand_state** (Tensor) - Random state to generate</span>
<span class="sd">          random force. The data type is float32 and the shape is :math:`(math.ceil(n * 3.0 / 4.0) * 16, )`.</span>
<span class="sd">        - **rand_frc** (Tensor) - The random forces.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n, 3)`.</span>

<span class="sd">    Outputs:</span>
<span class="sd">        - **output** (Tensor) - The output coordinates.</span>
<span class="sd">          The data type is float32, and the shape is :math:`(n, 3)`.</span>

<span class="sd">    Supported Platforms:</span>
<span class="sd">        ``GPU``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@prim_attr_register</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">,</span> <span class="n">half_dt</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">exp_gamma</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize MDIterationLeapFrogLiujian.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span> <span class="o">=</span> <span class="n">atom_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">half_dt</span> <span class="o">=</span> <span class="n">half_dt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="n">dt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exp_gamma</span> <span class="o">=</span> <span class="n">exp_gamma</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;half_dt&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">half_dt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;dt&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;exp_gamma&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">exp_gamma</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_prim_io_names</span><span class="p">(</span>
            <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;inverse_mass&#39;</span><span class="p">,</span> <span class="s1">&#39;sqrt_mass_inverse&#39;</span><span class="p">,</span> <span class="s1">&#39;vel&#39;</span><span class="p">,</span> <span class="s1">&#39;crd&#39;</span><span class="p">,</span> <span class="s1">&#39;frc&#39;</span><span class="p">,</span> <span class="s1">&#39;acc&#39;</span><span class="p">,</span> <span class="s1">&#39;rand_state&#39;</span><span class="p">,</span> <span class="s1">&#39;rand_frc&#39;</span><span class="p">],</span>
            <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">infer_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inverse_mass</span><span class="p">,</span> <span class="n">sqrt_mass_inverse</span><span class="p">,</span> <span class="n">vel</span><span class="p">,</span> <span class="n">crd</span><span class="p">,</span> <span class="n">frc</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">rand_state</span><span class="p">,</span> <span class="n">rand_frc</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inverse_mass</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;inverse_mass&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sqrt_mass_inverse</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;sqrt_mass_inverse&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">inverse_mass</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;inverse_mass&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">sqrt_mass_inverse</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;sqrt_mass_inverse&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rand_state</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;rand_state_dim&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rand_frc</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;rand_frc_dim&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vel</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;vel_dim&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">crd</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;crd_dim&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">frc</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;frc_dim&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">acc</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;acc_dim&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">vel</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;vel_shape[0]&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">vel</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;vel_shape[1]&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">crd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;crd_shape[0]&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">crd</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;crd_shape[1]&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">frc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;frc_shape[0]&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">frc</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;frc_shape[1]&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">acc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;acc_shape[0]&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">acc</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;acc_shape[1]&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">rand_frc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;rand_frc_shape[0]&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">rand_frc</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;rand_frc_shape[1]&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">rand_state</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">/</span> <span class="mf">4.0</span><span class="p">)</span> <span class="o">*</span> <span class="mi">16</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;rand_state&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">infer_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inverse_mass</span><span class="p">,</span> <span class="n">sqrt_mass_inverse</span><span class="p">,</span> <span class="n">vel</span><span class="p">,</span> <span class="n">crd</span><span class="p">,</span> <span class="n">frc</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">rand_state</span><span class="p">,</span> <span class="n">rand_frc</span><span class="p">):</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;inverse_mass&#39;</span><span class="p">,</span> <span class="n">inverse_mass</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;sqrt_mass_inverse&#39;</span><span class="p">,</span> <span class="n">sqrt_mass_inverse</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;vel&#39;</span><span class="p">,</span> <span class="n">vel</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;crd&#39;</span><span class="p">,</span> <span class="n">crd</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;frc&#39;</span><span class="p">,</span> <span class="n">frc</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;acc&#39;</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;rand_frc&#39;</span><span class="p">,</span> <span class="n">rand_frc</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;rand_state&#39;</span><span class="p">,</span> <span class="n">rand_state</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mstype</span><span class="o">.</span><span class="n">float32</span></div>


<span class="k">class</span> <span class="nc">CrdToUintCrd</span><span class="p">(</span><span class="n">PrimitiveWithInfer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert FP32 coordinate to Uint32 coordinate.</span>

<span class="sd">    Because there is a large amount of inputs and each of them are related,</span>
<span class="sd">    there is no way to construct `Examples` using random methods. For details, refer the webpage `SPONGE in MindSpore</span>
<span class="sd">    &lt;https://gitee.com/mindspore/mindscience/blob/master/MindSPONGE/docs/simple_formula.md&gt;`_.</span>

<span class="sd">    Args:</span>
<span class="sd">        atom_numbers(int32): the number of atoms n.</span>

<span class="sd">    Inputs:</span>
<span class="sd">        - **crd_to_uint_crd_cof** (Tensor) - The scale factor</span>
<span class="sd">          between the unsigned int value and the real space coordinates.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(3,)`.</span>
<span class="sd">        - **crd** (Tensor) - The coordinate of each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n, 3)`.</span>

<span class="sd">    Outputs:</span>
<span class="sd">        - **output** (Scalar) - The data type is uint32.</span>

<span class="sd">    Supported Platforms:</span>
<span class="sd">        ``GPU``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@prim_attr_register</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize CrdToUintCrd.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span> <span class="o">=</span> <span class="n">atom_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_prim_io_names</span><span class="p">(</span>
            <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;crd_to_uint_crd_cof&#39;</span><span class="p">,</span> <span class="s1">&#39;crd&#39;</span><span class="p">],</span>
            <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">infer_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crd_to_uint_crd_cof</span><span class="p">,</span> <span class="n">crd</span><span class="p">):</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">crd_to_uint_crd_cof</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;crd_to_uint_crd_cof_shape&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">crd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;crd[0]&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">crd</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;crd[1]&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">crd</span>

    <span class="k">def</span> <span class="nf">infer_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crd_to_uint_crd_cof</span><span class="p">,</span> <span class="n">crd</span><span class="p">):</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;crd_to_uint_crd_cof&#39;</span><span class="p">,</span> <span class="n">crd_to_uint_crd_cof</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;crd&#39;</span><span class="p">,</span> <span class="n">crd</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mstype</span><span class="o">.</span><span class="n">uint32</span>


<div class="viewcode-block" id="MDIterationSetupRandState"><a class="viewcode-back" href="../../../../mindsponge/mindspore.ops.MDIterationSetupRandState.html#mindspore.ops.MDIterationSetupRandState">[docs]</a><span class="k">class</span> <span class="nc">MDIterationSetupRandState</span><span class="p">(</span><span class="n">PrimitiveWithInfer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the random state of the iteration.</span>

<span class="sd">    Because there is a large amount of inputs and each of them are related,</span>
<span class="sd">    there is no way to construct `Examples` using random methods. For details, refer the webpage `SPONGE in MindSpore</span>
<span class="sd">    &lt;https://gitee.com/mindspore/mindscience/blob/master/MindSPONGE/docs/simple_formula.md&gt;`_.</span>

<span class="sd">    Args:</span>
<span class="sd">        atom_numbers(int32): the number of atoms n.</span>
<span class="sd">        seed(int32): random seed.</span>

<span class="sd">    Outputs:</span>
<span class="sd">        - **output** (Tensor) random state.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(ceil(n * 3 / 4),)`.</span>

<span class="sd">    Supported Platforms:</span>
<span class="sd">        ``GPU``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@prim_attr_register</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">,</span> <span class="n">seed</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize MDIterationSetupRandState.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span> <span class="o">=</span> <span class="n">atom_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;seed&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_prim_io_names</span><span class="p">(</span>
            <span class="n">inputs</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">infer_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">float4_numbers</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">/</span> <span class="mf">4.0</span><span class="p">)</span>
        <span class="n">curandsize</span> <span class="o">=</span> <span class="mi">64</span> <span class="o">/</span> <span class="mi">4</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">float4_numbers</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">curandsize</span><span class="p">),]</span>

    <span class="k">def</span> <span class="nf">infer_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">mstype</span><span class="o">.</span><span class="n">float32</span></div>


<span class="k">class</span> <span class="nc">TransferCrd</span><span class="p">(</span><span class="n">PrimitiveWithInfer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transfer the coordinates to angular and radial.</span>

<span class="sd">    Because there is a large amount of inputs and each of them are related,</span>
<span class="sd">    there is no way to construct `Examples` using random methods. For details, refer the webpage `SPONGE in MindSpore</span>
<span class="sd">    &lt;https://gitee.com/mindspore/mindscience/blob/master/MindSPONGE/docs/simple_formula.md&gt;`_.</span>

<span class="sd">    Args:</span>
<span class="sd">        start_serial(int32): the index start position.</span>
<span class="sd">        end_serial(int32): the index end position.</span>
<span class="sd">        number(int32): the length of angular and radial.</span>

<span class="sd">    Inputs:</span>
<span class="sd">        - **crd** (Tensor) - The coordinate of each atom.</span>
<span class="sd">          n is the number of atoms. The data type is float32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **old_crd** (Tensor) - The last coordinate of each atom.</span>
<span class="sd">          n is the number of atoms. The data type is float32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **box** (Tensor) - The length of 3 dimensions of the simulation box.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(3,)`.</span>

<span class="sd">    Outputs:</span>
<span class="sd">        - **radial** (Tensor) - The array of radial transferred from coordinates.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(number,)`.</span>
<span class="sd">        - **angular** (Tensor) - The array of angular transferred from coordinates.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(number,)`.</span>
<span class="sd">        - **nowarp_crd** (Tensor) - The modified coordinate of each atom for</span>
<span class="sd">          computing radial and angular. The data type is float32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **box_map_times** (Tensor) - The box map times for radial and  angular.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(n, 3)`.</span>

<span class="sd">    Supported Platforms:</span>
<span class="sd">        ``GPU``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@prim_attr_register</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_serial</span><span class="p">,</span> <span class="n">end_serial</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize TransferCrd.&quot;&quot;&quot;</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;start_serial&#39;</span><span class="p">,</span> <span class="n">start_serial</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;end_serial&#39;</span><span class="p">,</span> <span class="n">end_serial</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;number&#39;</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_serial</span> <span class="o">=</span> <span class="n">start_serial</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_serial</span> <span class="o">=</span> <span class="n">end_serial</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="o">=</span> <span class="n">number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span> <span class="o">=</span> <span class="n">atom_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;start_serial&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_serial</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;end_serial&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_serial</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;number&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_prim_io_names</span><span class="p">(</span>
            <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;crd&#39;</span><span class="p">,</span> <span class="s1">&#39;old_crd&#39;</span><span class="p">,</span> <span class="s1">&#39;box&#39;</span><span class="p">],</span>
            <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;radial&#39;</span><span class="p">,</span> <span class="s1">&#39;angular&#39;</span><span class="p">,</span> <span class="s1">&#39;nowarp_crd&#39;</span><span class="p">,</span> <span class="s1">&#39;box_map_times&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">infer_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crd_shape</span><span class="p">,</span> <span class="n">old_crd_shape</span><span class="p">,</span> <span class="n">box_shape</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">crd_shape</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;crd_dim&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">crd_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;crd_shape[0]&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">crd_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;crd_shape[1]&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">old_crd_shape</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;old_crd_dim&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">old_crd_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;old_crd_shape[0]&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">old_crd_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;old_crd_shape[1]&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">box_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;box_dim&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">box_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;box_shape[0]&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">,],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">,],</span> <span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">infer_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crd_dtype</span><span class="p">,</span> <span class="n">old_crd_dtype</span><span class="p">,</span> <span class="n">box_dtype</span><span class="p">):</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;crd&#39;</span><span class="p">,</span> <span class="n">crd_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;old_crd&#39;</span><span class="p">,</span> <span class="n">old_crd_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;box&#39;</span><span class="p">,</span> <span class="n">box_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">mstype</span><span class="o">.</span><span class="n">int32</span>


<div class="viewcode-block" id="FFT3D"><a class="viewcode-back" href="../../../../mindsponge/mindspore.ops.FFT3D.html#mindspore.ops.FFT3D">[docs]</a><span class="k">class</span> <span class="nc">FFT3D</span><span class="p">(</span><span class="n">PrimitiveWithInfer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Forward FFT with Three-Dimensional Input.</span>

<span class="sd">    .. warning::</span>
<span class="sd">        This is an experimental prototype that is subject to change and/or deletion.</span>

<span class="sd">    Inputs:</span>
<span class="sd">        - **input_tensor** (Tensor) - Three dimensional tensor, supported</span>
<span class="sd">          data type is float32.</span>

<span class="sd">    Outputs:</span>
<span class="sd">        - **output_tensor** (Tensor) - The tensor after undergoing fast Fourier</span>
<span class="sd">          transform, the data type is complex64.</span>

<span class="sd">    Supported Platforms:</span>
<span class="sd">        ``GPU``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@prim_attr_register</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_prim_io_names</span><span class="p">(</span>
            <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;input_tensor&#39;</span><span class="p">],</span>
            <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;output_tensor&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">infer_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;fftx&#39;</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;ffty&#39;</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;fftz&#39;</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">infer_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_dtype</span><span class="p">):</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;input_tensor&#39;</span><span class="p">,</span> <span class="n">input_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mstype</span><span class="o">.</span><span class="n">complex64</span></div>


<div class="viewcode-block" id="IFFT3D"><a class="viewcode-back" href="../../../../mindsponge/mindspore.ops.IFFT3D.html#mindspore.ops.IFFT3D">[docs]</a><span class="k">class</span> <span class="nc">IFFT3D</span><span class="p">(</span><span class="n">PrimitiveWithInfer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inverse FFT with Three-Dimensional Input.</span>

<span class="sd">    .. warning::</span>
<span class="sd">        This is an experimental prototype that is subject to change and/or deletion.</span>

<span class="sd">    Inputs:</span>
<span class="sd">        - **input_tensor** (Tensor) - Three dimensional input tensor, supported data</span>
<span class="sd">          type is complex64.</span>

<span class="sd">    Outputs:</span>
<span class="sd">        - **output_tensor** (Tensor) - Returns the tensor after undergoing</span>
<span class="sd">          inverse Fourier transform, the data type is float32.</span>

<span class="sd">    Supported Platforms:</span>
<span class="sd">        ``GPU``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@prim_attr_register</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_prim_io_names</span><span class="p">(</span>
            <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;input_tensor&#39;</span><span class="p">],</span>
            <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;output_tensor&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">infer_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;fftx&#39;</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;ffty&#39;</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;fftz&#39;</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">infer_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_dtype</span><span class="p">):</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;input_tensor&#39;</span><span class="p">,</span> <span class="n">input_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">complex64</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mstype</span><span class="o">.</span><span class="n">float32</span></div>


<div class="viewcode-block" id="NeighborListUpdate"><a class="viewcode-back" href="../../../../mindsponge/mindspore.ops.NeighborListUpdate.html#mindspore.ops.NeighborListUpdate">[docs]</a><span class="k">class</span> <span class="nc">NeighborListUpdate</span><span class="p">(</span><span class="n">PrimitiveWithInfer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update (or construct if first time) the Verlet neighbor list for the</span>
<span class="sd">    calculation of short-ranged force. Assume the number of atoms is N,</span>
<span class="sd">    the number of grids divided is G, the maximum number of atoms in one</span>
<span class="sd">    grid is m, the maximum number of atoms in single atom&#39;s neighbor list</span>
<span class="sd">    is L, and the number of total atom in excluded list is E.</span>

<span class="sd">    Args:</span>
<span class="sd">        grid_numbers(int32): the total number of grids divided.</span>
<span class="sd">        not_first_time(int32): whether to construct the neighbor</span>
<span class="sd">          list first time or not.</span>
<span class="sd">        nxy(int32): the total number of grids divided in xy plane.</span>
<span class="sd">        excluded_atom_numbers(int32): the total atom numbers in the excluded list.</span>
<span class="sd">        cutoff(float32): the cutoff distance for short-range force calculation.</span>
<span class="sd">        skin(float32): the overflow value of cutoff to maintain a neighbor list.</span>
<span class="sd">        cutoff_square(float32): the suqare value of cutoff.</span>
<span class="sd">        half_skin_square(float32): skin*skin/4, indicates the maximum</span>
<span class="sd">          square value of the distance atom allowed to move between two updates.</span>
<span class="sd">        cutoff_with_skin(float32): cutoff + skin, indicates the</span>
<span class="sd">          radius of the neighbor list for each atom.</span>
<span class="sd">        half_cutoff_with_skin(float32): cutoff_with_skin/2.</span>
<span class="sd">        cutoff_with_skin_square(float32): the square value of cutoff_with_skin.</span>
<span class="sd">        refresh_interval(int32): the number of iteration steps between two updates of neighbor list.</span>
<span class="sd">        max_atom_in_grid_numbers(int32): the maximum number of atoms in one grid k.</span>

<span class="sd">    Inputs:</span>
<span class="sd">        - **atom_numbers_in_grid_bucket** (Tensor) - The number of atoms in each grid bucket.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(G,)`.</span>
<span class="sd">        - **bucket** (Tensor) - (Tensor) - The atom indices in each grid bucket.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(G, k)`.</span>
<span class="sd">        - **crd** (Tensor) - The coordinates of each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **box_length** (Tensor) - The box length of the simulation box.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(3,)`.</span>
<span class="sd">        - **grid_N** (Tensor) - The number of grids divided of 3 dimensions of the simulation box.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(3,)`.</span>
<span class="sd">        - **grid_length_inverse** (Tensor) - The inverse value of grid length.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(3,)`.</span>
<span class="sd">        - **atom_in_grid_serial** (Tensor) - The grid index for each atom.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(n,)`.</span>
<span class="sd">        - **old_crd** (Tensor) - The coordinates before update of each atom.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **crd_to_uint_crd_cof** (Tensor) - The scale factor between the unsigned int coordinate and the real one.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(3,)`.</span>
<span class="sd">        - **uint_crd** (Tensor) - The unsigned int coordinates value fo each atom.</span>
<span class="sd">          The data type is unsigned int32 and the shape is :math:`(n, 3)`.</span>
<span class="sd">        - **gpointer** (Tensor) - The nearest neighbor grids (including self) of each grid.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(G, 125)`.</span>
<span class="sd">        - **nl_atom_numbers** (Tensor) - The number of atoms in neighbor list of each atom.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(n,)`.</span>
<span class="sd">        - **nl_atom_serial** (Tensor) - The indices of atoms in neighbor list of each atom.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(n, m)`.</span>
<span class="sd">        - **uint_dr_to_dr_cof** (Tensor) - The scale factor.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(3,)`.</span>
<span class="sd">        - **excluded_list_start** (Tensor) - The start excluded index in excluded list for each atom.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(n,)`.</span>
<span class="sd">        - **excluded_list** (Tensor) - The contiguous join of excluded list of each atom.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(E,)`.</span>
<span class="sd">        - **excluded_numbers** (Tensor) - The number of atom excluded in excluded list for each atom.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(n,)`.</span>
<span class="sd">        - **need_refresh_flag** (Tensor) - Whether the neighbor list of each atom need update or not.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(1,)`.</span>
<span class="sd">        - **refresh_count** (Tensor) - Count how many iteration steps have passed since last update.</span>
<span class="sd">          The data type is int32 and the shape is :math:`(1,)` or :math:`()`.</span>

<span class="sd">    Outputs:</span>
<span class="sd">        - **res** (Tensor) - The return value after updating successfully.</span>
<span class="sd">          The data type is float32 and the shape is :math:`(1,)`.</span>

<span class="sd">    Supported Platforms:</span>
<span class="sd">        ``GPU``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@prim_attr_register</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid_numbers</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">,</span> <span class="n">not_first_time</span><span class="p">,</span> <span class="n">nxy</span><span class="p">,</span> <span class="n">excluded_atom_numbers</span><span class="p">,</span>
                 <span class="n">cutoff_square</span><span class="p">,</span> <span class="n">half_skin_square</span><span class="p">,</span> <span class="n">cutoff_with_skin</span><span class="p">,</span> <span class="n">half_cutoff_with_skin</span><span class="p">,</span> <span class="n">cutoff_with_skin_square</span><span class="p">,</span>
                 <span class="n">refresh_interval</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">skin</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">max_atom_in_grid_numbers</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">max_neighbor_numbers</span><span class="o">=</span><span class="mi">800</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_numbers</span> <span class="o">=</span> <span class="n">grid_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span> <span class="o">=</span> <span class="n">atom_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_interval</span> <span class="o">=</span> <span class="n">refresh_interval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">not_first_time</span> <span class="o">=</span> <span class="n">not_first_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span> <span class="o">=</span> <span class="n">cutoff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skin</span> <span class="o">=</span> <span class="n">skin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_atom_in_grid_numbers</span> <span class="o">=</span> <span class="n">max_atom_in_grid_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nxy</span> <span class="o">=</span> <span class="n">nxy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">excluded_atom_numbers</span> <span class="o">=</span> <span class="n">excluded_atom_numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_square</span> <span class="o">=</span> <span class="n">cutoff_square</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">half_skin_square</span> <span class="o">=</span> <span class="n">half_skin_square</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_with_skin</span> <span class="o">=</span> <span class="n">cutoff_with_skin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">half_cutoff_with_skin</span> <span class="o">=</span> <span class="n">half_cutoff_with_skin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_with_skin_square</span> <span class="o">=</span> <span class="n">cutoff_with_skin_square</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_neighbor_numbers</span> <span class="o">=</span> <span class="n">max_neighbor_numbers</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;grid_numbers&#39;</span><span class="p">,</span> <span class="n">grid_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="n">atom_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;refresh_interval&#39;</span><span class="p">,</span> <span class="n">refresh_interval</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;not_first_time&#39;</span><span class="p">,</span> <span class="n">not_first_time</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;cutoff&#39;</span><span class="p">,</span> <span class="n">cutoff</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;skin&#39;</span><span class="p">,</span> <span class="n">skin</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;max_atom_in_grid_numbers&#39;</span><span class="p">,</span> <span class="n">max_atom_in_grid_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;nxy&#39;</span><span class="p">,</span> <span class="n">nxy</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;excluded_atom_numbers&#39;</span><span class="p">,</span> <span class="n">excluded_atom_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;cutoff_square&#39;</span><span class="p">,</span> <span class="n">cutoff_square</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;half_skin_square&#39;</span><span class="p">,</span> <span class="n">half_skin_square</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;cutoff_with_skin&#39;</span><span class="p">,</span> <span class="n">cutoff_with_skin</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;half_cutoff_with_skin&#39;</span><span class="p">,</span> <span class="n">half_cutoff_with_skin</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;cutoff_with_skin_square&#39;</span><span class="p">,</span> <span class="n">cutoff_with_skin_square</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_value_type</span><span class="p">(</span><span class="s1">&#39;max_neighbor_numbers&#39;</span><span class="p">,</span> <span class="n">max_neighbor_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_prim_io_names</span><span class="p">(</span>
            <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;atom_numbers_in_grid_bucket&#39;</span><span class="p">,</span> <span class="s1">&#39;bucket&#39;</span><span class="p">,</span> <span class="s1">&#39;crd&#39;</span><span class="p">,</span> <span class="s1">&#39;box_length&#39;</span><span class="p">,</span> <span class="s1">&#39;grid_N&#39;</span><span class="p">,</span> <span class="s1">&#39;grid_length_inverse&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;atom_in_grid_serial&#39;</span><span class="p">,</span> <span class="s1">&#39;old_crd&#39;</span><span class="p">,</span> <span class="s1">&#39;crd_to_uint_crd_cof&#39;</span><span class="p">,</span> <span class="s1">&#39;uint_crd&#39;</span><span class="p">,</span> <span class="s1">&#39;gpointer&#39;</span><span class="p">,</span> <span class="s1">&#39;nl_atom_numbers&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;nl_atom_serial&#39;</span><span class="p">,</span> <span class="s1">&#39;uint_dr_to_dr_cof&#39;</span><span class="p">,</span> <span class="s1">&#39;excluded_list_start&#39;</span><span class="p">,</span> <span class="s1">&#39;excluded_list&#39;</span><span class="p">,</span> <span class="s1">&#39;excluded_numbers&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;need_refresh_flag&#39;</span><span class="p">,</span> <span class="s1">&#39;refresh_count&#39;</span><span class="p">],</span> <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;res&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;grid_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_numbers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;atom_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;refresh_interval&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">refresh_interval</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;not_first_time&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">not_first_time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;cutoff&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;skin&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">skin</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;max_atom_in_grid_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_atom_in_grid_numbers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;nxy&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nxy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;excluded_atom_numbers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">excluded_atom_numbers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;cutoff_square&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_square</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;half_skin_square&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">half_skin_square</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;cutoff_with_skin&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_with_skin</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;half_cutoff_with_skin&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">half_cutoff_with_skin</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_prim_attr</span><span class="p">(</span><span class="s1">&#39;cutoff_with_skin_square&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_with_skin_square</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">infer_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom_numbers_in_grid_bucket_shape</span><span class="p">,</span> <span class="n">bucket_shape</span><span class="p">,</span> <span class="n">crd_shape</span><span class="p">,</span> <span class="n">box_length_shape</span><span class="p">,</span> <span class="n">grid_n_shape</span><span class="p">,</span>
                    <span class="n">grid_length_inverse_shape</span><span class="p">,</span> <span class="n">atom_in_grid_serial_shape</span><span class="p">,</span> <span class="n">old_crd_shape</span><span class="p">,</span> <span class="n">crd_to_uint_crd_cof_shape</span><span class="p">,</span>
                    <span class="n">uint_crd_shape</span><span class="p">,</span> <span class="n">gpointer_shape</span><span class="p">,</span> <span class="n">nl_atom_numbers_shape</span><span class="p">,</span> <span class="n">nl_atom_serial_shape</span><span class="p">,</span>
                    <span class="n">uint_dr_to_dr_cof_shape</span><span class="p">,</span> <span class="n">excluded_list_start_shape</span><span class="p">,</span> <span class="n">excluded_list_shape</span><span class="p">,</span> <span class="n">excluded_numbers_shape</span><span class="p">,</span>
                    <span class="n">need_refresh_flag_shape</span><span class="p">,</span> <span class="n">refresh_count_shape</span><span class="p">):</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_numbers_in_grid_bucket_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span>
                            <span class="s2">&quot;atom_numbers_in_grid_bucket_dim&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bucket_shape</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;bucket_dim&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">crd_shape</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;crd_dim&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">box_length_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;box_length_dim&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">grid_n_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;grid_n_dim&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">grid_length_inverse_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;grid_length_inverse_dim&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_in_grid_serial_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_in_grid_serial_dim&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">old_crd_shape</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;old_crd_dim&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">crd_to_uint_crd_cof_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;crd_to_uint_crd_cof_dim&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uint_crd_shape</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd_dim&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gpointer_shape</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;gpointer_dim&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nl_atom_numbers_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;nl_atom_numbers_dim&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nl_atom_serial_shape</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;nl_atom_serial_dim&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uint_dr_to_dr_cof_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_dr_to_dr_cof_dim&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">excluded_list_start_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;excluded_list_start_dim&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">excluded_list_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;excluded_list_dim&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">excluded_numbers_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;excluded_numbers_dim&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">need_refresh_flag_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;need_refresh_flag_dim&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">refresh_count_shape</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">LE</span><span class="p">,</span> <span class="s2">&quot;refresh_count_dim&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_numbers_in_grid_bucket_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_numbers</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span>
                            <span class="s2">&quot;atom_numbers_in_grid_bucket&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">bucket_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_numbers</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;bucket&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">bucket_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_atom_in_grid_numbers</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;bucket&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">crd_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;crd&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">crd_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;crd&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">box_length_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;box_length&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">grid_n_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;grid_N&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">grid_length_inverse_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;grid_length_inverse&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">atom_in_grid_serial_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;atom_in_grid_serial&quot;</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">old_crd_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;old_crd&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">old_crd_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;old_crd&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">crd_to_uint_crd_cof_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;crd_to_uint_crd_cof&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_crd_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_crd&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">gpointer_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_numbers</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;gpointer&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">gpointer_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">125</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;gpointer&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">nl_atom_numbers_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;nl_atom_numbers&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">nl_atom_serial_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;nl_atom_serial&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">nl_atom_serial_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_neighbor_numbers</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;nl_atom_serial&quot;</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">uint_dr_to_dr_cof_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;uint_dr_to_dr_cof&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">excluded_list_start_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;excluded_list_start&quot;</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">excluded_list_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">excluded_atom_numbers</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;excluded_list&quot;</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">excluded_numbers_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_numbers</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;excluded_numbers&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">need_refresh_flag_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;need_refresh_flag&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">refresh_count_shape</span><span class="p">:</span>
            <span class="n">validator</span><span class="o">.</span><span class="n">check_int</span><span class="p">(</span><span class="n">refresh_count_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rel</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="s2">&quot;refresh_count_shape&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="mi">1</span><span class="p">,]</span>

    <span class="k">def</span> <span class="nf">infer_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom_numbers_in_grid_bucket_dtype</span><span class="p">,</span> <span class="n">bucket_dtype</span><span class="p">,</span> <span class="n">crd_dtype</span><span class="p">,</span> <span class="n">box_length_dtype</span><span class="p">,</span> <span class="n">grid_n_dtype</span><span class="p">,</span>
                    <span class="n">grid_length_inverse_dtype</span><span class="p">,</span> <span class="n">atom_in_grid_serial_dtype</span><span class="p">,</span> <span class="n">old_crd_dtype</span><span class="p">,</span> <span class="n">crd_to_uint_crd_cof_dtype</span><span class="p">,</span>
                    <span class="n">uint_crd_dtype</span><span class="p">,</span> <span class="n">gpointer_dtype</span><span class="p">,</span> <span class="n">nl_atom_numbers_dtype</span><span class="p">,</span> <span class="n">nl_atom_serial_dtype</span><span class="p">,</span>
                    <span class="n">uint_dr_to_dr_cof_dtype</span><span class="p">,</span> <span class="n">excluded_list_start_dtype</span><span class="p">,</span> <span class="n">excluded_list_dtype</span><span class="p">,</span> <span class="n">excluded_numbers_dtype</span><span class="p">,</span>
                    <span class="n">need_refresh_flag_dtype</span><span class="p">,</span> <span class="n">refresh_count_dtype</span><span class="p">):</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_numbers_in_grid_bucket&#39;</span><span class="p">,</span> <span class="n">atom_numbers_in_grid_bucket_dtype</span><span class="p">,</span>
                                           <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;bucket&#39;</span><span class="p">,</span> <span class="n">bucket_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;crd&#39;</span><span class="p">,</span> <span class="n">crd_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;box_length&#39;</span><span class="p">,</span> <span class="n">box_length_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;grid_N&#39;</span><span class="p">,</span> <span class="n">grid_n_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;grid_length_inverse&#39;</span><span class="p">,</span> <span class="n">grid_length_inverse_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;atom_in_grid_serial&#39;</span><span class="p">,</span> <span class="n">atom_in_grid_serial_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;old_crd&#39;</span><span class="p">,</span> <span class="n">old_crd_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;crd_to_uint_crd_cof&#39;</span><span class="p">,</span> <span class="n">crd_to_uint_crd_cof_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;uint_crd&#39;</span><span class="p">,</span> <span class="n">uint_crd_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">uint32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;gpointer&#39;</span><span class="p">,</span> <span class="n">gpointer_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;nl_atom_numbers&#39;</span><span class="p">,</span> <span class="n">nl_atom_numbers_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;nl_atom_serial&#39;</span><span class="p">,</span> <span class="n">nl_atom_serial_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;uint_dr_to_dr_cof&#39;</span><span class="p">,</span> <span class="n">uint_dr_to_dr_cof_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;excluded_list_start&#39;</span><span class="p">,</span> <span class="n">excluded_list_start_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;excluded_list&#39;</span><span class="p">,</span> <span class="n">excluded_list_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;excluded_numbers&#39;</span><span class="p">,</span> <span class="n">excluded_numbers_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;need_refresh_flag&#39;</span><span class="p">,</span> <span class="n">need_refresh_flag_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">validator</span><span class="o">.</span><span class="n">check_tensor_dtype_valid</span><span class="p">(</span><span class="s1">&#39;refresh_count&#39;</span><span class="p">,</span> <span class="n">refresh_count_dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">mstype</span><span class="o">.</span><span class="n">int32</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mstype</span><span class="o">.</span><span class="n">float32</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, MindSpore.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>