<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Molecular Simulation &mdash; MindSpore master documentation</title><link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Molecular Structure Prediction" href="structure_prediction.html" />
    <link rel="prev" title="Physics Data Fusion" href="../intro/physics_plus_data_driven.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> MindSpore
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Molecular Simulation Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro/physics_driven.html">Physics Driven</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/data_driven.html">Data Driven</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/physics_plus_data_driven.html">Physics Data Fusion</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Molecular Simulation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#systemmolecule-module">System(Molecule) Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#potential-force-field-module">Potential (Force Field) Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#updater-optimizer-module">Updater (Optimizer) Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#simulationcell">SimulationCell</a></li>
<li class="toctree-l2"><a class="reference internal" href="#callback">Callback</a></li>
<li class="toctree-l2"><a class="reference internal" href="#simulation-track-file-h5md">Simulation Track File: H5MD</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tutorial">Tutorial</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="structure_prediction.html">Molecular Structure Prediction</a></li>
<li class="toctree-l1"><a class="reference internal" href="property_prediction.html">Molecular Properties Prediction</a></li>
<li class="toctree-l1"><a class="reference internal" href="design.html">Molecular Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic.html">Molecular Foundation Model</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../mindsponge.cell.html">mindsponge.cell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindsponge.common.html">mindsponge.common</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindsponge.data.html">mindsponge.data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mindsponge.metrics.html">mindsponge.metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../constant.html">Constants</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">RELEASE NOTES</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../RELEASE.html">Release Notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MindSpore</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Molecular Simulation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/user/simulation.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="molecular-simulation">
<h1>Molecular Simulation<a class="headerlink" href="#molecular-simulation" title="Permalink to this headline"></a></h1>
<p><a href="https://gitee.com/mindspore/docs/blob/r2.0.0-alpha/docs/mindsponge/docs/source_en/user/simulation.md" target="_blank"><img src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/r2.0.0-alpha/resource/_static/logo_source_en.png"></a></p>
<p>MindSPONGE has adopted a unique “AI-like” molecular simulation program architecture:</p>
<p><img alt="MindSPONGE" src="../_images/mindsponge.png" /></p>
<p>The feature of the architecture is that it turns molecular simulation into a special AI training process, which allows MindSPONGE perform molecular dynamics simulations in the same way that MindSpore can for training network models.</p>
<p>Firstly, both MindSpore and MindSPONGE require three basic cells or function modules, and there is a one-to-one correspondence between them:</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="text-left head"><p>MindSpore</p></th>
<th class="text-left head"><p></p></th>
<th class="text-left head"><p>MindSPONGE</p></th>
<th class="text-left head"><p></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>Model</p></td>
<td class="text-left"><p>network</p></td>
<td class="text-left"><p>System</p></td>
<td class="text-left"><p>system</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Loss Function</p></td>
<td class="text-left"><p>loss_fn</p></td>
<td class="text-left"><p>Potential Function</p></td>
<td class="text-left"><p>potential</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Optimizer</p></td>
<td class="text-left"><p>optimizer</p></td>
<td class="text-left"><p>Updater</p></td>
<td class="text-left"><p>updater</p></td>
</tr>
</tbody>
</table>
<p>Once the three functional modules are set up, they need to be encapsulated so that training or simulation can be performed.</p>
<p>For example, the code for a typical MindSpore training network would be:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindspore.nn</span> <span class="kn">import</span> <span class="n">WithLossCell</span>
<span class="kn">from</span> <span class="nn">mindspore.train</span> <span class="kn">import</span> <span class="n">Model</span>
<span class="kn">from</span> <span class="nn">mindspore.train</span> <span class="kn">import</span> <span class="n">LossMonitor</span>
<span class="kn">from</span> <span class="nn">mindspore.train</span> <span class="kn">import</span> <span class="n">ModelCheckpoint</span><span class="p">,</span> <span class="n">CheckpointConfig</span>
<span class="c1"># Combination Method 1:</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">loss_fn</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">)</span>
<span class="c1"># Combination Method 2:</span>
<span class="n">loss_net</span> <span class="o">=</span> <span class="n">WithLossCell</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">loss_fn</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">loss_net</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">)</span>
<span class="c1"># Set Callback function：</span>
<span class="n">monitor_cb</span> <span class="o">=</span> <span class="n">LossMonitor</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ckpoint_cb</span> <span class="o">=</span> <span class="n">ModelCheckpoint</span><span class="p">(</span><span class="s1">&#39;network&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">CheckpointConfig</span><span class="p">(</span><span class="mi">32</span><span class="p">))</span>
<span class="c1"># Perform training process：</span>
<span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">monitor_cb</span><span class="p">,</span> <span class="n">ckpoint_cb</span><span class="p">])</span>
</pre></div>
</div>
<p>The code for molecular dynamics simulations using MindSPONGE is very similar to the code above:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindsponge</span> <span class="kn">import</span> <span class="n">SimulationCell</span>
<span class="kn">from</span> <span class="nn">mindsponge</span> <span class="kn">import</span> <span class="n">Sponge</span>
<span class="kn">from</span> <span class="nn">mindsponge.callback</span> <span class="kn">import</span> <span class="n">RunInfo</span>
<span class="kn">from</span> <span class="nn">mindsponge.callback</span> <span class="kn">import</span> <span class="n">WriteH5MD</span>
<span class="c1"># Combination Method 1:</span>
<span class="n">md</span> <span class="o">=</span> <span class="n">Sponge</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">potential</span><span class="p">,</span> <span class="n">updater</span><span class="p">)</span>
<span class="c1"># Combination Method 2:</span>
<span class="n">sim</span> <span class="o">=</span> <span class="n">SimulationCell</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">potential</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">md</span> <span class="o">=</span> <span class="n">Sponge</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span> <span class="n">updater</span><span class="p">)</span>
<span class="c1"># Set Callback function：</span>
<span class="n">run_info</span> <span class="o">=</span> <span class="n">RunInfo</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">cb_h5md</span> <span class="o">=</span> <span class="n">WriteH5MD</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="s1">&#39;traj.h5md&#39;</span><span class="p">,</span> <span class="n">save_freq</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="c1"># Perform training process：</span>
<span class="n">md</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">run_info</span><span class="p">,</span> <span class="n">cb_h5md</span><span class="p">])</span>
</pre></div>
</div>
<p>It can be seen that there are two encapsulation methods in MindSpore. One is to directly use the top-level module Model of MindSpore to encapsulate the network model, loss function loss_fn and optimizer, which is suitable for the simplest training of supervised learning. The other encapsulation method is to first use the WithLossCell module to wrap the network Model and loss function loss_fn, and then use the Model module to wrap the wrapped WithLossCell module and optimizer. This situation applies to more complex training. For example, the training of generative adversarial networks (GANs) using MindSpore can be implemented through the heavy-load mode of WithLossCell.</p>
<p>Sponge is the top module used by MindSPONGE to encapsulate the three functional modules. There are also two ways to encapsulate the three basic units. The first one is to directly encapsulate the simulation system, potential energy function and updater with Sponge, which is also suitable for the most common simulation. In the other one, SimulationCell is used to encapsulate the simulation system and potential function, and then the encapsulated SimulationCell and updater are wrapped in Sponge. In this case, some complex simulation functions can be realized by adjusting SimulationCell parameters, such as adjusting cutoff radius and setting bias potential, etc.</p>
<p>After encapsulating the three basic units, MindSpore executes the training process by calling the train() function of the Model module, while MindSPONGE executes the simulation process by calling the run() function of the Sponge module. In MindSpore, different callback functions can be used to process the information in the training process (without changing the calculation diagram). For example, LossMonitor() function can be used to monitor the parameter changes in the training process, and ModelCheckpoint() function can be used to save network parameters. However, MindSPONGE can also use a callback function to process information during simulation. For example, RunInfo() function is used to print parameter information during training, and WriteH5MD() is used to record the changes of system coordinates during simulation as a simulation trajectory.</p>
<section id="systemmolecule-module">
<h2>System(Molecule) Module<a class="headerlink" href="#systemmolecule-module" title="Permalink to this headline"></a></h2>
<p>The system (molecular) module is used to describe the chemical properties of the molecular system, such as chemical composition, topological information, spatial coordinates, etc. System simulation of the basic class (parent) is mindsponge system. The Molecule, it contains the main parameters are:</p>
<ul class="simple">
<li><p>atom_name: Indicate the atom name of each atom in the system, which is used to distinguish different atoms</p></li>
<li><p>atom_type: Specify the atom type of each atom in the system, which is used to set force field parameters</p></li>
<li><p>Atomic mass (atom_mass) : Specify the mass of each atom in the system</p></li>
<li><p>atom_charge: Point charge of each atom in the system</p></li>
<li><p>coordinate: The space coordinate of the atom of the system</p></li>
<li><p>Periodic box (pbc_box) : Size of periodic boundary condition “protocell” box</p></li>
<li><p>bond: Bond connection between atoms (single and double bonds are not distinguished)</p></li>
<li><p>residue: Used to distinguish between molecular fragments in macromolecules or different molecules in the system. (The concept of residue in Molecule is similar to that of residue in the PDB document. Each residue can be used to represent not only a single amino acid residue but also a single small molecule, such as water and inorganic salt ions.)</p></li>
</ul>
<p>The Molecule class can be initialized by passing in the above arguments artificially:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindsponge</span> <span class="kn">import</span> <span class="n">Molecule</span>

<span class="n">system</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">(</span>
    <span class="n">atom_name</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;H1&#39;</span><span class="p">,</span> <span class="s1">&#39;H2&#39;</span><span class="p">],</span>
    <span class="n">atom_type</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;OW&#39;</span><span class="p">,</span> <span class="s1">&#39;HW&#39;</span><span class="p">,</span> <span class="s1">&#39;HW&#39;</span><span class="p">],</span>
    <span class="n">atom_mass</span><span class="o">=</span><span class="p">[</span><span class="mi">16</span><span class="p">,</span> <span class="mf">1.008</span><span class="p">,</span> <span class="mf">1.008</span><span class="p">],</span>
    <span class="n">coordinate</span><span class="o">=</span><span class="p">[</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="mf">0.0333</span><span class="p">,</span> <span class="mf">0.0943</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="p">],</span>
    <span class="n">bond</span><span class="o">=</span><span class="p">[[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]],</span>
<span class="p">)</span>
</pre></div>
</div>
<p>For Protein molecules, the protein class, a subclass of Molecule, can be initialized by reading the PDB file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="w">    </span>from<span class="w"> </span>mindsponge<span class="w"> </span>import<span class="w"> </span>Protein
<span class="w">    </span><span class="nv">system</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Protein<span class="o">(</span><span class="nv">pdb</span><span class="o">=</span><span class="s1">&#39;protein.pdb&#39;</span><span class="o">)</span>
</pre></div>
</div>
</section>
<section id="potential-force-field-module">
<h2>Potential (Force Field) Module<a class="headerlink" href="#potential-force-field-module" title="Permalink to this headline"></a></h2>
<p>Simulation module is used to describe the potential energy function used in simulation process. The basic class (parent) of potential energy is mindsponge.potential.PotentialCell. However, in the classical molecular simulation, force field is used as the potential energy function, and in MindSPONGE, it is a force field module. Force field module is the basic class for mindsponge.potential.ForceFieldBase, it’s a subclass for PotentialCell. The classical molecular force field generally contains different energy terms, the common energy terms include bond length, bond angles, dihedral angles, Coulomb interaction, van der Waals interaction and so on. Some of the commonly used energy are embedded in mindsponge.potential.energy, these energy terms can be put into ForceFieldBase as a list to initialize the class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindsponge</span> <span class="kn">import</span> <span class="n">ForceFieldBase</span>
<span class="kn">from</span> <span class="nn">mindsponge.potential.energy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">bond_energy</span> <span class="o">=</span> <span class="n">BondEnergy</span><span class="p">(</span><span class="n">bond_index</span><span class="p">,</span> <span class="n">force_constant</span><span class="o">=</span><span class="n">rk_init</span><span class="p">,</span> <span class="n">bond_length</span><span class="o">=</span><span class="n">req_init</span><span class="p">)</span>
<span class="n">angle_energy</span> <span class="o">=</span> <span class="n">AngleEnergy</span><span class="p">(</span><span class="n">angle_index</span><span class="p">,</span> <span class="n">force_constant</span><span class="o">=</span><span class="n">tk_init</span><span class="p">,</span> <span class="n">bond_angle</span><span class="o">=</span><span class="n">teq_init</span><span class="p">)</span>
<span class="n">dihedral_energy</span> <span class="o">=</span> <span class="n">DihedralEnergy</span><span class="p">(</span><span class="n">dihedral_index</span><span class="p">,</span> <span class="n">force_constant</span><span class="o">=</span><span class="n">pk_init</span><span class="p">,</span> <span class="n">periodicity</span><span class="o">=</span><span class="n">pn_init</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="n">phase_init</span><span class="p">)</span>
<span class="n">ele_energy</span> <span class="o">=</span> <span class="n">CoulombEnergy</span><span class="p">(</span><span class="n">atom_charge</span><span class="o">=</span><span class="n">system</span><span class="o">.</span><span class="n">atom_charge</span><span class="p">)</span>
<span class="n">vdw_energy</span> <span class="o">=</span> <span class="n">LennardJonesEnergy</span><span class="p">(</span><span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="n">epsilon</span><span class="p">)</span>
<span class="n">potential</span> <span class="o">=</span> <span class="n">ForceFieldBase</span><span class="p">(</span>
    <span class="n">energy</span><span class="o">=</span><span class="p">[</span><span class="n">bond_energy</span><span class="p">,</span>
            <span class="n">angle_energy</span><span class="p">,</span>
            <span class="n">dihedral_energy</span><span class="p">,</span>
            <span class="n">ele_energy</span><span class="p">,</span>
            <span class="n">vdw_energy</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
<p>For the complete set of molecular force field, ForceField class, a subclass of ForceFieldBase, can also be used to initialize by passing system module and force field parameter file, such as establishing a potential function of AMBER FF14SB force field:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="w">    </span>from<span class="w"> </span>mindsponge<span class="w"> </span>import<span class="w"> </span>ForceField
<span class="w">    </span><span class="nv">potential</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>ForceField<span class="o">(</span>system,<span class="w"> </span><span class="s1">&#39;AMBER.FF14SB&#39;</span><span class="o">)</span>
</pre></div>
</div>
<p>The string ‘AMBER.FF14SB’ here is essentially the filename of a YAML format force field parameter file. The rules of MindSPONGE reading the force field parameters is that, first of all, in the current directory to find whether there is a file with the same name. If there exists the file, read it. If there is no file, it will continue to search in MindSPONGE.data.forcefield directory and read the same file.</p>
<p>Note that if ForceField class is used to build a potential function, then its initialization process will reconstruct force-related parameters such as the atom type of the incoming system (molecular) module system. This is because atom types of different molecular force fields are often different. However, when using system modules for modeling, MindSPONGE does not require specifying molecular force field before modeling like most traditional MD simulation software. Therefore, in many cases, the system (molecular) module does not set atom_type when initializing, so when ForceField is used to create a potential function, The atomtype (atom_type), charge (atom_charge), and mass (atom_mass) are automatically set according to the atom name (atom_name) in the system (molecule) module.</p>
</section>
<section id="updater-optimizer-module">
<h2>Updater (Optimizer) Module<a class="headerlink" href="#updater-optimizer-module" title="Permalink to this headline"></a></h2>
<p>In MindSPONGE, the Updater is used to update the atomic coordinates of the simulation system during the simulation process. The Updater is essentially an optimizer. Its basic class mindsponge.optimizer.Updater is also a subclass of mindspore.nn.Optimizer. In fact, MindSpore optimizers such as Adam can be used directly as the upgrader of MindSPONGE, and the simulation process is equivalent to energy minimization of the simulation system.</p>
<p>And MindSPONGE’s Updater allows for fine-tuning of the simulation using different controllers. The controller, whose basic class is mindsponge.control.Controller, can be used to adjust and update seven variables of coordinate, velocity, force, energy, kinetic energy, virial and PBC box in the simulation process. Common controllers include the Integrator, Thermostat, Barostat, and Constraint. The Updater of the base class can be initialized by accepting a list of controller classes and updating the parameters in the order of the controllers in the list during the simulation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindsponge</span> <span class="kn">import</span> <span class="n">Updater</span>
<span class="kn">from</span> <span class="nn">mindsponge.control</span> <span class="kn">import</span> <span class="n">VelocityVerlet</span>
<span class="kn">from</span> <span class="nn">mindsponge.control</span> <span class="kn">import</span> <span class="n">Langevin</span>
<span class="kn">from</span> <span class="nn">mindsponge.control</span> <span class="kn">import</span> <span class="n">BerendsenBarostat</span>
<span class="kn">from</span> <span class="nn">mindsponge.control</span> <span class="kn">import</span> <span class="n">Lincs</span>

<span class="n">integrator</span> <span class="o">=</span> <span class="n">VelocityVerlet</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">thermostat</span><span class="o">=</span><span class="n">Langevin</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="mi">300</span><span class="p">))</span>

<span class="n">opt</span> <span class="o">=</span> <span class="n">Updater</span><span class="p">(</span>
    <span class="n">system</span><span class="p">,</span>
    <span class="n">controller</span><span class="o">=</span><span class="p">[</span>
    <span class="n">integrator</span><span class="p">,</span>
        <span class="n">Lincs</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="s1">&#39;h-bonds’),</span>
        <span class="n">BerendsenBarostat</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">],</span>
<span class="n">velocity</span><span class="o">=</span><span class="n">velocity</span><span class="p">,</span>
<span class="n">time_step</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>For general molecular dynamics simulations, you can use a subclass of the Updater, mindsponge.control.MolecularDynamics as an update and set up an integrator, thermostat, barostat, and constraint to initialize it:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindsponge</span> <span class="kn">import</span> <span class="n">MolecularDynamics</span>
<span class="kn">from</span> <span class="nn">mindsponge.control</span> <span class="kn">import</span> <span class="n">VelocityVerlet</span>
<span class="kn">from</span> <span class="nn">mindsponge.control</span> <span class="kn">import</span> <span class="n">Langevin</span>
<span class="kn">from</span> <span class="nn">mindsponge.control</span> <span class="kn">import</span> <span class="n">BerendsenBarostat</span>
<span class="kn">from</span> <span class="nn">mindsponge.control</span> <span class="kn">import</span> <span class="n">Lincs</span>

<span class="n">opt</span> <span class="o">=</span> <span class="n">MolecularDynamics</span> <span class="p">(</span>
    <span class="n">system</span><span class="p">,</span>
    <span class="n">integrator</span><span class="o">=</span><span class="n">VelocityVerlet</span><span class="p">(</span><span class="n">system</span><span class="p">),</span>
    <span class="n">thermostat</span><span class="o">=</span><span class="n">Langevin</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="mi">300</span><span class="p">),</span>
    <span class="n">barostat</span><span class="o">=</span><span class="n">BerendsenBarostat</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">constraint</span><span class="o">=</span><span class="n">Lincs</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="s1">&#39;h-bonds&#39;</span><span class="p">),</span>
    <span class="n">velocity</span><span class="o">=</span><span class="n">velocity</span><span class="p">,</span>
    <span class="n">time_step</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="simulationcell">
<h2>SimulationCell<a class="headerlink" href="#simulationcell" title="Permalink to this headline"></a></h2>
<p>s mentioned above, in addition to directly using the top module Sponge of MindSPONGE to encapsulate three functional modules, namely system (molecule) module, potential energy (force field) module and refresher (optimizer) module, SimulationCell can also be used to encapsulate the system (molecular) module and potential energy (force field) module. Besides encapsulating two modules, SimulationCell can also set neighbour list, bias potential and post-processing mode of potential energy (wrapper) when initializing:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindsponge</span> <span class="kn">import</span> <span class="n">SimulationCell</span>
<span class="kn">from</span> <span class="nn">mindsponge.partition</span> <span class="kn">import</span> <span class="n">NeighbourList</span>
<span class="kn">from</span> <span class="nn">mindsponge.potential.bias</span> <span class="kn">import</span> <span class="n">MetaD</span>
<span class="kn">from</span> <span class="nn">mindsponge.core.wrapper</span> <span class="kn">import</span> <span class="n">ReplicaExchange</span>

<span class="n">neighbour_list</span> <span class="o">=</span> <span class="n">NeighbourList</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">use_grids</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">simulation</span> <span class="o">=</span> <span class="n">SimulationCell</span><span class="p">(</span>
    <span class="n">system</span><span class="o">=</span><span class="n">system</span><span class="p">,</span>
    <span class="n">potential</span><span class="o">=</span><span class="n">potential</span><span class="p">,</span>
    <span class="n">neighbour_list</span><span class="o">=</span><span class="n">neighbour_list</span><span class="p">,</span>
    <span class="n">bias</span><span class="o">=</span><span class="n">MetaDynamics</span><span class="p">(</span><span class="n">colvar</span><span class="o">=</span><span class="n">colvar</span><span class="p">),</span>
    <span class="n">wrapper</span><span class="o">=</span><span class="n">ReplicaExchange</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="mi">100</span><span class="p">),</span>
    <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="callback">
<h2>Callback<a class="headerlink" href="#callback" title="Permalink to this headline"></a></h2>
<p>In the AI framework, callback function is used to carry out some operations without changing the calculation graph, such as monitoring and recording the change of the loss function in the training process, verifying whether the parameters in the training process are up to standard, and stopping the training process according to the verification result. In MindSPONGE, Callback can also be used to implement operations that do not affect the simulation process, such as monitoring important simulation parameters, recording simulation tracks, calculating physical quantities and CVs (collective variables) in the simulation process, etc.</p>
<p>Currently, MindSPONGE has two built-in Callback functions:</p>
<ul class="simple">
<li><p>RunInfo: Used to print intermediate quantities of the simulation process, such as energy, temperature, pressure, etc.</p></li>
<li><p>WriteH5MD: Output simulation track in H5MD format.</p></li>
</ul>
</section>
<section id="simulation-track-file-h5md">
<h2>Simulation Track File: H5MD<a class="headerlink" href="#simulation-track-file-h5md" title="Permalink to this headline"></a></h2>
<p>MindSPONGE uses H5MD as the default file format for recording analog tracks. H5MD (HDF5 Molecular Data) is a MD simulation trajectory file Format based on HDF5 (Hierarchical Data Format 5) format proposed by Dr Pierre de Buyl and others from the Free University of Brussels in Belgium in 2014 (de Buyl, P.; Colberg, P. H.; Höfling, F. H5MD: A Structured, Efficient, and Portable File Format for Molecular Data [J]. Comput Phys Commun 2014, 185(6): 1546-1553.).</p>
<p>Jonas Landsgesell and Sascha Ehrhardt of the University of Stuttgart, Germany, have developed an <a class="reference external" href="https://github.com/h5md/VMD-h5mdplugin">VMD plug-in</a> that allows us to view a simulation trace file in the H5MD format. However, this plugin is buggy and has not been updated since 2019. We forked the <a class="reference external" href="https://gitee.com/helloyesterday/VMD-h5mdplugin">original repository</a>, fixed bugs, and made some minor changes to the original program, adding functions such as unit conversion of coordinates, and changing the default file extension from.h5 to.h5MD. <a class="reference external" href="https://www.mdanalysis.org/">MDAnalysis</a> can also be used to read the simulated trajectory information of the H5MD file.</p>
<p>Thanks to the multi-tiered data structure of HDF5, H5MD itself is highly scalable, in addition to recording simulation tracks, and can record relevant data during simulation. MindSPONGE recorded potential energy, kinetic energy, temperature, pressure and other information in the simulation process in the observables directory of H5MD file. This information can be viewed using some HDF5 readers, such as the <a class="reference external" href="https://www.silx.org/doc/silx/latest/">Silx Viewer</a>:</p>
<p><img alt="silx" src="../_images/silx.png" /></p>
</section>
<section id="tutorial">
<h2>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline"></a></h2>
<p>A tutorial on molecular dynamics simulations using the MindSPONGE is available at <a class="reference external" href="https://gitee.com/mindspore/mindscience/tree/r0.2.0-alpha/MindSPONGE/tutorials/basic">MindScience</a>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../intro/physics_plus_data_driven.html" class="btn btn-neutral float-left" title="Physics Data Fusion" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="structure_prediction.html" class="btn btn-neutral float-right" title="Molecular Structure Prediction" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, MindSpore.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>