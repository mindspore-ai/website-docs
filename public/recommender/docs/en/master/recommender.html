<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>mindspore_rec &mdash; MindSpore master documentation</title><script>;(()=>{const e=localStorage.getItem("ms-theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;(e?"dark"===e:t)&&document.documentElement.setAttribute("data-o-theme","dark")})();</script><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Release Notes" href="RELEASE.html" />
    <link rel="prev" title="Online Learning" href="online_learning.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> MindSpore
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="install.html">MindSpore Recommender Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="offline_learning.html">Offline Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="online_learning.html">Online Learning</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API References</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">mindspore_rec</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">RELEASE NOTES</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="RELEASE.html">Release Notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MindSpore</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>mindspore_rec</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/recommender.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="mindspore-rec">
<h1>mindspore_rec<a class="headerlink" href="#mindspore-rec" title="Permalink to this headline"></a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="mindspore_rec.RecModel">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mindspore_rec.</span></span><span class="sig-name descname"><span class="pre">RecModel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">network</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loss_fn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optimizer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metrics</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eval_network</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eval_indexes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">amp_level</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'O0'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">boost_level</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'O0'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_rec/train/rec_model.html#RecModel"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindspore_rec.RecModel" title="Permalink to this definition"></a></dt>
<dd><p>A high-level API for recommending network models, providing interfaces such as online training.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>network</strong> (<em>Cell</em>) – A training network.</p></li>
<li><p><strong>loss_fn</strong> (<em>Cell</em>) – Objective function. If <cite>loss_fn</cite> is None, the <cite>network</cite> should contain the calculation of loss
and parallel if needed. Default: None.</p></li>
<li><p><strong>optimizer</strong> (<em>Cell</em>) – Optimizer for updating the weights. If <cite>optimizer</cite> is None, the <cite>network</cite> needs to
do backpropagation and update weights. Default value: None.</p></li>
<li><p><strong>metrics</strong> (<em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#dict" title="(in Python v3.8)"><em>dict</em></a><em>, </em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#set" title="(in Python v3.8)"><em>set</em></a><em>]</em>) – A Dictionary or a set of metrics for model evaluation.
eg: {‘accuracy’, ‘recall’}. Default: None.</p></li>
<li><p><strong>eval_network</strong> (<em>Cell</em>) – Network for evaluation. If not defined, <cite>network</cite> and <cite>loss_fn</cite> would be wrapped as
<cite>eval_network</cite> . Default: None.</p></li>
<li><p><strong>eval_indexes</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#list" title="(in Python v3.8)"><em>list</em></a>) – It is used when eval_network is defined. If <cite>eval_indexes</cite> is None by default, all outputs
of the <cite>eval_network</cite> would be passed to metrics. If <cite>eval_indexes</cite> is set, it must contain
three elements: the positions of loss value, predicted value and label in outputs of the
<cite>eval_network</cite>. In this case, the loss value will be passed to the <cite>Loss</cite> metric, the
predicted value and label will be passed to other metrics.
<a class="reference external" href="https://www.mindspore.cn/docs/en/master/api_python/train/mindspore.train.Metric.html?#mindspore.train.Metric.set_indexes">mindspore.train.Metric.set_indexes</a>
is recommended instead of <cite>eval_indexes</cite>.
Default: None.</p></li>
<li><p><strong>amp_level</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – <p>Option for argument <cite>level</cite> in <a class="reference external" href="https://www.mindspore.cn/docs/en/master/api_python/amp/mindspore.amp.build_train_network.html">mindspore.amp.build_train_network</a>,
level for mixed precision training. Supports [“O0”, “O2”, “O3”, “auto”]. Default: “O0”.</p>
<ul>
<li><p>”O0”: Do not change.</p></li>
<li><p>”O2”: Cast network to float16, keep BatchNorm run in float32, using dynamic loss scale.</p></li>
<li><p>”O3”: Cast network to float16, the BatchNorm is also cast to float16, loss scale will not be used.</p></li>
<li><p>auto: Set level to recommended level in different devices. Set level to “O2” on GPU, set
level to “O3” on Ascend. The recommended level is chosen by the expert experience, not applicable to all
scenarios. User should specify the level for special network.</p></li>
</ul>
<p>”O2” is recommended on GPU, “O3” is recommended on Ascend.
The BatchNorm strategy can be changed by <cite>keep_batchnorm_fp32</cite> settings in <cite>kwargs</cite>. <cite>keep_batchnorm_fp32</cite>
must be a bool. The loss scale strategy can be changed by <cite>loss_scale_manager</cite> setting in <cite>kwargs</cite>.
<cite>loss_scale_manager</cite> should be a subclass of <a class="reference external" href="https://www.mindspore.cn/docs/en/master/api_python/amp/mindspore.amp.LossScaleManager.html">mindspore.amp.LossScaleManager</a>.
The more detailed explanation of <cite>amp_level</cite> setting can be found at <a class="reference external" href="https://www.mindspore.cn/docs/en/master/api_python/amp/mindspore.amp.build_train_network.html">mindspore.amp.build_train_network</a>.</p>
</p></li>
<li><p><strong>boost_level</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – <p>Option for argument <cite>level</cite> in <cite>mindspore.boost</cite>, level for boost mode
training. Supports [“O0”, “O1”, “O2”]. Default: “O0”.</p>
<ul>
<li><p>”O0”: Do not change.</p></li>
<li><p>”O1”: Cast the operators in white_list to float16, the remaining operators are kept in float32.</p></li>
<li><p>”O1”: Enable the boost mode, the performance is improved by about 20%, and
the accuracy is the same as the original accuracy.</p></li>
<li><p>”O2”: Enable the boost mode, the performance is improved by about 30%, and
the accuracy is reduced by less than 3%.</p></li>
</ul>
<p>If you want to config boost mode by yourself, you can set boost_config_dict as <cite>boost.py</cite>.
In order for this function to work, you need to set the optimizer, eval_network or metric parameters
at the same time.</p>
<p>Notice: The current optimization enabled by default only applies to some networks, and not all networks
can obtain the same benefits.  It is recommended to enable this function on
the Graph mode + Ascend platform, and for better acceleration, refer to the documentation to configure
boost_config_dict.</p>
</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mindspore_rec.RecModel.online_train">
<span class="sig-name descname"><span class="pre">online_train</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">train_dataset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">callbacks</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset_sink_mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sink_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_rec/train/rec_model.html#RecModel.online_train"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindspore_rec.RecModel.online_train" title="Permalink to this definition"></a></dt>
<dd><p>Online training API for recommend model.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If dataset_sink_mode is True, data will be sent to device queue. If the device is Ascend, features
of data will be transferred one by one. The limitation of data transmission per time is 256M.</p>
<p>When dataset_sink_mode is True, the <cite>step_end</cite> method of the instance of Callback will be called at the end
of epoch, and dataset will be bound to this model and cannot be used by other models.</p>
<p>When setting device target is CPU, the training process will be performed with dataset not sink mode.</p>
<p>The dataset for online training is unbounded, it has an infinite number of batch data,
which is the main difference from the offline training dataset.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>train_dataset</strong> (<em>Dataset</em>) – A training dataset iterator. If <cite>loss_fn</cite> is defined, the data and label will be
passed to the <cite>network</cite> and the <cite>loss_fn</cite> respectively, so a tuple (data, label)
should be returned from dataset. If there is multiple data or labels, set <cite>loss_fn</cite>
to None and implement calculation of loss in <cite>network</cite>,
then a tuple (data1, data2, data3, …) with all data returned from dataset will be
passed to the <cite>network</cite>.
The train dataset is unbounded.</p></li>
<li><p><strong>callbacks</strong> (<em>Optional</em><em>[</em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#list" title="(in Python v3.8)"><em>list</em></a><em>[</em><em>Callback</em><em>]</em><em>, </em><em>Callback</em><em>]</em>) – List of callback objects or callback object,
which should be executed while training.
Default: None.</p></li>
<li><p><strong>dataset_sink_mode</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a>) – Determines whether to pass the data through dataset channel.
Configure device target of CPU, the training process will be performed with
dataset not sink. Default: True.</p></li>
<li><p><strong>sink_size</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – Controls how many batches of data in each sink. Default: 1</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="online_learning.html" class="btn btn-neutral float-left" title="Online Learning" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="RELEASE.html" class="btn btn-neutral float-right" title="Release Notes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, MindSpore.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 
</body>
</html>