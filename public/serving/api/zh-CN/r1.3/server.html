<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>mindspore_serving.server &mdash; MindSpore master documentation</title><script>;(()=>{const e=localStorage.getItem("ms-theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;(e?"dark"===e:t)&&document.documentElement.setAttribute("data-o-theme","dark")})();</script><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script><script src="_static/jquery.js"></script>
        <script src="_static/js/theme.js"></script><script src="_static/underscore.js"></script><script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="mindspore_serving.client" href="client.html" />
    <link rel="prev" title="MindSpore Serving API" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> MindSpore
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">mindspore_serving.server</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#module-mindspore_serving.server.register">mindspore_serving.server.register</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-mindspore_serving.server.distributed">mindspore_serving.server.distributed</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="client.html">mindspore_serving.client</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MindSpore</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>mindspore_serving.server</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/server.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-mindspore_serving.server">
<span id="mindspore-serving-server"></span><h1>mindspore_serving.server<a class="headerlink" href="#module-mindspore_serving.server" title="Permalink to this headline"></a></h1>
<p>MindSpore Serving is a lightweight and high-performance service module that helps MindSpore developers efficiently
deploy online inference services in the production environment.</p>
<p>MindSpore Serving server API, which can be used to start servables, gRPC and RESTful server. A servable corresponds to
the service provided by a model. The client sends inference tasks and receives inference results through gRPC and
RESTful server.</p>
<dl class="py class">
<dt class="sig sig-object py" id="mindspore_serving.server.SSLConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mindspore_serving.server.</span></span><span class="sig-name descname"><span class="pre">SSLConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">certificate</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">private_key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">custom_ca</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verify_client</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/master/_master.html#SSLConfig"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindspore_serving.server.SSLConfig" title="Permalink to this definition"></a></dt>
<dd><p>The server’s ssl_config encapsulates necessary parameters for SSL-enabled connections.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>certificate</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – File holding the PEM-encoded certificate chain as a byte string to use or None if no
certificate chain should be used.</p></li>
<li><p><strong>private_key</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – File holding the PEM-encoded private key as a byte string, or None if no private key should
be used.</p></li>
<li><p><strong>custom_ca</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>optional</em>) – File holding the PEM-encoded root certificates as a byte string. When verify_client
is True, custom_ca must be provided. When verify_client is False, this parameter will be ignored.
Default: None.</p></li>
<li><p><strong>verify_client</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a><em>, </em><em>optional</em>) – If verify_client is true, use mutual authentication. If false, use one-way
authentication. Default: False.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – The type or value of the parameters are invalid.</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mindspore_serving.server.ServableStartConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mindspore_serving.server.</span></span><span class="sig-name descname"><span class="pre">ServableStartConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">servable_directory</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">servable_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device_ids</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">version_number</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dec_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dec_mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'AES-GCM'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/_servable_local.html#ServableStartConfig"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindspore_serving.server.ServableStartConfig" title="Permalink to this definition"></a></dt>
<dd><p>Servable startup configuration.</p>
<p>For more detail, please refer to
<a class="reference external" href="https://www.mindspore.cn/serving/docs/zh-CN/r1.3/serving_example.html">MindSpore-based Inference Service Deployment</a> and
<a class="reference external" href="https://www.mindspore.cn/serving/docs/zh-CN/r1.3/serving_model.html">Servable Provided Through Model Configuration</a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>servable_directory</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – The directory where the servable is located in. There expects to has a directory
named <cite>servable_name</cite>.</p></li>
<li><p><strong>servable_name</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – The servable name.</p></li>
<li><p><strong>device_ids</strong> (<em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>, </em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#list" title="(in Python v3.8)"><em>list</em></a><em>[</em><a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>]</em><em>, </em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#tuple" title="(in Python v3.8)"><em>tuple</em></a><em>[</em><a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>]</em><em>]</em>) – The device list the model loads into and runs in.</p></li>
<li><p><strong>version_number</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>, </em><em>optional</em>) – Servable version number to be loaded. The version number should be a positive
integer, starting from 1, and 0 means to load the latest version. Default: 0.</p></li>
<li><p><strong>device_type</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>optional</em>) – <p>Currently supports “Ascend”, “GPU” and None. Default: None.</p>
<ul>
<li><p>”Ascend”: the platform expected to be Ascend910 or Ascend310, etc.</p></li>
<li><p>”GPU”: the platform expected to be Nvidia GPU.</p></li>
<li><p>None: the platform is determined by the MindSpore environment.</p></li>
</ul>
</p></li>
<li><p><strong>dec_key</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#bytes" title="(in Python v3.8)"><em>bytes</em></a><em>, </em><em>optional</em>) – Byte type key used for decryption. The valid length is 16, 24, or 32. Default: None.</p></li>
<li><p><strong>dec_mode</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>optional</em>) – Specifies the decryption mode, take effect when dec_key is set.
Option: ‘AES-GCM’ or ‘AES-CBC’. Default: ‘AES-GCM’.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – The type or value of the parameters are invalid.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mindspore_serving.server.start_grpc_server">
<span class="sig-prename descclassname"><span class="pre">mindspore_serving.server.</span></span><span class="sig-name descname"><span class="pre">start_grpc_server</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">address</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_msg_mb_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ssl_config</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/master/_master.html#start_grpc_server"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindspore_serving.server.start_grpc_server" title="Permalink to this definition"></a></dt>
<dd><p>Start gRPC server for the communication between serving client and server.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>address</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – <p>gRPC server address, the address can be {ip}:{port} or unix:{unix_domain_file_path}.</p>
<ul>
<li><p>{ip}:{port} - Internet domain socket address.</p></li>
<li><p>unix:{unix_domain_file_path} - Unix domain socket address, which is used to communicate with multiple
processes on the same machine. {unix_domain_file_path} can be relative or absolute file path,
but the directory where the file is located must already exist.</p></li>
</ul>
</p></li>
<li><p><strong>max_msg_mb_size</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>, </em><em>optional</em>) – The maximum acceptable gRPC message size in megabytes(MB), value range
[1, 512]. Default: 100.</p></li>
<li><p><strong>ssl_config</strong> (<a class="reference internal" href="#mindspore_serving.server.SSLConfig" title="mindspore_serving.server.SSLConfig"><em>mindspore_serving.server.SSLConfig</em></a><em>, </em><em>optional</em>) – The server’s ssl_config, if None, disabled ssl.
Default: None.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – Failed to start the gRPC server: parameter verification failed, the gRPC address is wrong or
    the port is duplicate.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore_serving</span> <span class="kn">import</span> <span class="n">server</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">server</span><span class="o">.</span><span class="n">start_grpc_server</span><span class="p">(</span><span class="s2">&quot;0.0.0.0:5500&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mindspore_serving.server.start_restful_server">
<span class="sig-prename descclassname"><span class="pre">mindspore_serving.server.</span></span><span class="sig-name descname"><span class="pre">start_restful_server</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">address</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_msg_mb_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ssl_config</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/master/_master.html#start_restful_server"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindspore_serving.server.start_restful_server" title="Permalink to this definition"></a></dt>
<dd><p>Start RESTful server for the communication between serving client and server.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>address</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – RESTful server address, the address should be Internet domain socket address.</p></li>
<li><p><strong>max_msg_mb_size</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>, </em><em>optional</em>) – The maximum acceptable RESTful message size in megabytes(MB), value range
[1, 512]. Default: 100.</p></li>
<li><p><strong>ssl_config</strong> (<a class="reference internal" href="#mindspore_serving.server.SSLConfig" title="mindspore_serving.server.SSLConfig"><em>mindspore_serving.server.SSLConfig</em></a><em>, </em><em>optional</em>) – The server’s ssl_config, if None, disabled ssl.
Default: None.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – Failed to start the RESTful server: parameter verification failed, the RESTful address is wrong
    or the port is duplicate.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore_serving</span> <span class="kn">import</span> <span class="n">server</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">server</span><span class="o">.</span><span class="n">start_restful_server</span><span class="p">(</span><span class="s2">&quot;0.0.0.0:5900&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mindspore_serving.server.start_servables">
<span class="sig-prename descclassname"><span class="pre">mindspore_serving.server.</span></span><span class="sig-name descname"><span class="pre">start_servables</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">servable_configs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/_server.html#start_servables"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindspore_serving.server.start_servables" title="Permalink to this definition"></a></dt>
<dd><p>Start up servables.</p>
<p>It can be used to start multiple different servables. One servable can be deployed on multiple chips,
and each chip runs a servable copy.</p>
<p>On Ascend 910 hardware platform, each copy of each servable owns one chip. Different servables or different versions
of the same servable need to be deployed on different chips.
On Ascend 310 and GPU hardware platform, one chip can be shared by multi servables, and different servables or
different versions of the same servable can be deployed on the same chip to realize chip reuse.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>servable_configs</strong> (<em>Union</em><em>[</em><a class="reference internal" href="#mindspore_serving.server.ServableStartConfig" title="mindspore_serving.server.ServableStartConfig"><em>ServableStartConfig</em></a><em>, </em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#list" title="(in Python v3.8)"><em>list</em></a><em>[</em><a class="reference internal" href="#mindspore_serving.server.ServableStartConfig" title="mindspore_serving.server.ServableStartConfig"><em>ServableStartConfig</em></a><em>]</em><em>, </em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#tuple" title="(in Python v3.8)"><em>tuple</em></a><em>[</em><a class="reference internal" href="#mindspore_serving.server.ServableStartConfig" title="mindspore_serving.server.ServableStartConfig"><em>ServableStartConfig</em></a><em>]</em><em>]</em>) – The
startup configs of one or more servables.</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – Failed to start one or more servables. For log of one servable, please refer to subdirectory
    serving_logs.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore_serving</span> <span class="kn">import</span> <span class="n">server</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">servable_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">resnet_config</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">ServableStartConfig</span><span class="p">(</span><span class="n">servable_dir</span><span class="p">,</span> <span class="s2">&quot;resnet&quot;</span><span class="p">,</span> <span class="n">device_ids</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">add_config</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">ServableStartConfig</span><span class="p">(</span><span class="n">servable_dir</span><span class="p">,</span> <span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="n">device_ids</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">server</span><span class="o">.</span><span class="n">start_servables</span><span class="p">(</span><span class="n">servable_configs</span><span class="o">=</span><span class="p">(</span><span class="n">resnet_config</span><span class="p">,</span> <span class="n">add_config</span><span class="p">))</span>  <span class="c1"># press Ctrl+C to stop</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">server</span><span class="o">.</span><span class="n">start_grpc_server</span><span class="p">(</span><span class="s2">&quot;0.0.0.0:5500&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mindspore_serving.server.stop">
<span class="sig-prename descclassname"><span class="pre">mindspore_serving.server.</span></span><span class="sig-name descname"><span class="pre">stop</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/master/_master.html#stop"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindspore_serving.server.stop" title="Permalink to this definition"></a></dt>
<dd><p>Stop the running of serving server.</p>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore_serving</span> <span class="kn">import</span> <span class="n">server</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">server</span><span class="o">.</span><span class="n">start_grpc_server</span><span class="p">(</span><span class="s2">&quot;0.0.0.0:5500&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">server</span><span class="o">.</span><span class="n">start_restful_server</span><span class="p">(</span><span class="s2">&quot;0.0.0.0:1500&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">server</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<section id="module-mindspore_serving.server.register">
<span id="mindspore-serving-server-register"></span><h2>mindspore_serving.server.register<a class="headerlink" href="#module-mindspore_serving.server.register" title="Permalink to this headline"></a></h2>
<p>Servable register interface, used in servable_config.py of one servable.
See how to configure servable_config.py file, please refer to
<a class="reference external" href="https://www.mindspore.cn/serving/docs/zh-CN/r1.3/serving_model.html">Servable Provided Through Model Configuration</a>.</p>
<dl class="py class">
<dt class="sig sig-object py" id="mindspore_serving.server.register.AclOptions">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mindspore_serving.server.register.</span></span><span class="sig-name descname"><span class="pre">AclOptions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/register/servable.html#AclOptions"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindspore_serving.server.register.AclOptions" title="Permalink to this definition"></a></dt>
<dd><p>Helper class to set acl options.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>insert_op_cfg_path</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>optional</em>) – Path of aipp config file.</p></li>
<li><p><strong>input_format</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>optional</em>) – Manually specify the model input format, the value can be “ND”, “NCHW”, “NHWC”,
“CHWN”, “NC1HWC0”, or “NHWC1C0”.</p></li>
<li><p><strong>input_shape</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>optional</em>) – Manually specify the model input shape, such as
“input_op_name1: n1,c2,h3,w4;input_op_name2: n4,c3,h2,w1”.</p></li>
<li><p><strong>output_type</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>optional</em>) – Manually specify the model output type, the value can be “FP16”, “UINT8” or “FP32”,
Default: “FP32”.</p></li>
<li><p><strong>precision_mode</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>optional</em>) – Model precision mode, the value can be “force_fp16”，”allow_fp32_to_fp16”，
“must_keep_origin_dtype” or “allow_mix_precision”. Default: “force_fp16”.</p></li>
<li><p><strong>op_select_impl_mode</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>optional</em>) – The operator selection mode, the value can be “high_performance” or
“high_precision”. Default: “high_performance”.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – Acl option is invalid, or value is not str.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore_serving.server</span> <span class="kn">import</span> <span class="n">register</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">options</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">AclOptions</span><span class="p">(</span><span class="n">op_select_impl_mode</span><span class="o">=</span><span class="s2">&quot;high_precision&quot;</span><span class="p">,</span> <span class="n">precision_mode</span><span class="o">=</span><span class="s2">&quot;allow_fp32_to_fp16&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">register</span><span class="o">.</span><span class="n">declare_servable</span><span class="p">(</span><span class="n">servable_file</span><span class="o">=</span><span class="s2">&quot;deeptext.mindir&quot;</span><span class="p">,</span> <span class="n">model_format</span><span class="o">=</span><span class="s2">&quot;MindIR&quot;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mindspore_serving.server.register.GpuOptions">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mindspore_serving.server.register.</span></span><span class="sig-name descname"><span class="pre">GpuOptions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/register/servable.html#GpuOptions"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindspore_serving.server.register.GpuOptions" title="Permalink to this definition"></a></dt>
<dd><p>Helper class to set gpu options.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>precision_mode</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>optional</em>) – inference operator selection, and the value can be “origin”, “fp16”.
Default: “origin”.</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – Gpu option is invalid, or value is not str.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore_serving.server</span> <span class="kn">import</span> <span class="n">register</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">options</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">GpuOptions</span><span class="p">(</span><span class="n">precision_mode</span><span class="o">=</span><span class="s2">&quot;origin&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">register</span><span class="o">.</span><span class="n">declare_servable</span><span class="p">(</span><span class="n">servable_file</span><span class="o">=</span><span class="s2">&quot;deeptext.mindir&quot;</span><span class="p">,</span> <span class="n">model_format</span><span class="o">=</span><span class="s2">&quot;MindIR&quot;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mindspore_serving.server.register.PipelineServable">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mindspore_serving.server.register.</span></span><span class="sig-name descname"><span class="pre">PipelineServable</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">servable_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">version_number</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/register/pipeline.html#PipelineServable"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindspore_serving.server.register.PipelineServable" title="Permalink to this definition"></a></dt>
<dd><p>Create Pipeline Servable for Servable calls.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This is a beta interface and may be changed in the future.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>servable_name</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – The name of servable.</p></li>
<li><p><strong>method</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – The name of method supplied by servable.</p></li>
<li><p><strong>version_number</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>, </em><em>optional</em>) – The number of version supplied by servable. Default: 0.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – The type or value of the parameters is invalid, or other errors happened.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore_serving.server</span> <span class="kn">import</span> <span class="n">distributed</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore_serving.server</span> <span class="kn">import</span> <span class="n">register</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">distributed</span><span class="o">.</span><span class="n">declare_servable</span><span class="p">(</span><span class="n">rank_size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">stage_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">with_batch_dim</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@register</span><span class="o">.</span><span class="n">register_method</span><span class="p">(</span><span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">fun</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">y</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">call_servable</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">y</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">servable</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">PipelineServable</span><span class="p">(</span><span class="n">servable_name</span><span class="o">=</span><span class="s2">&quot;service&quot;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;fun&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@register</span><span class="o">.</span><span class="n">register_pipeline</span><span class="p">(</span><span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">y</span> <span class="o">=</span> <span class="n">servable</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">y</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="mindspore_serving.server.register.PipelineServable.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/register/pipeline.html#PipelineServable.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindspore_serving.server.register.PipelineServable.run" title="Permalink to this definition"></a></dt>
<dd><p>Servable calls function in Pipeline register function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>args</strong> (<a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.17)"><em>numpy.ndarray</em></a>) – One or more input numpy arrays.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>numpy.ndarray, A numpy array object is returned if there is only one output; otherwise, a numpy array tuple
is returned.</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – The type or value of the parameters is invalid, or other errors happened.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mindspore_serving.server.register.call_postprocess">
<span class="sig-prename descclassname"><span class="pre">mindspore_serving.server.register.</span></span><span class="sig-name descname"><span class="pre">call_postprocess</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">postprocess_fun</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/register/method.html#call_postprocess"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindspore_serving.server.register.call_postprocess" title="Permalink to this definition"></a></dt>
<dd><p>For method registration, define the postprocessing function and its’ parameters.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The length of ‘args’ should be equal to the inputs number of postprocess_fun.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>postprocess_fun</strong> (<em>function</em>) – Python function for postprocess.</p></li>
<li><p><strong>args</strong> – Preprocess inputs. The length of ‘args’ should equal to the input parameters number
of implemented python function.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – The type or value of the parameters are invalid, or other error happened.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mindspore_serving.server.register.call_postprocess_pipeline">
<span class="sig-prename descclassname"><span class="pre">mindspore_serving.server.register.</span></span><span class="sig-name descname"><span class="pre">call_postprocess_pipeline</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">postprocess_fun</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/register/method.html#call_postprocess_pipeline"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindspore_serving.server.register.call_postprocess_pipeline" title="Permalink to this definition"></a></dt>
<dd><p>For method registration, define the postprocessing pipeline function and its’ parameters.</p>
<p>A single request can include multiple instances, so multiple queued requests will also have multiple instances.
If you need to process multiple instances through multi thread or other parallel processing capability
in <cite>preprocess</cite> or <cite>postprocess</cite>, such as using MindData concurrency ability to process multiple input
images in <cite>preprocess</cite>, MindSpore Serving provides ‘call_preprocess_pipeline’ and ‘call_pstprocess_pipeline’
to register such preprocessing and postprocessing. For more detail,
please refer to <a class="reference external" href="https://gitee.com/mindspore/serving/blob/master/example/resnet/resnet50/servable_config.py">Resnet50 model configuration example</a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>postprocess_fun</strong> (<em>function</em>) – Python pipeline function for postprocess.</p></li>
<li><p><strong>args</strong> – Preprocess inputs. The length of ‘args’ should equal to the input parameters number
of implemented python function.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – The type or value of the parameters are invalid, or other error happened.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mindspore_serving.server.register.call_preprocess">
<span class="sig-prename descclassname"><span class="pre">mindspore_serving.server.register.</span></span><span class="sig-name descname"><span class="pre">call_preprocess</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">preprocess_fun</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/register/method.html#call_preprocess"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindspore_serving.server.register.call_preprocess" title="Permalink to this definition"></a></dt>
<dd><p>For method registration, define the preprocessing function and its’ parameters.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The length of ‘args’ should be equal to the inputs number of preprocess_fun.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>preprocess_fun</strong> (<em>function</em>) – Python function for preprocess.</p></li>
<li><p><strong>args</strong> – Preprocess inputs. The length of ‘args’ should equal to the input parameters number
of implemented python function.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – The type or value of the parameters are invalid, or other error happened.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore_serving.server</span> <span class="kn">import</span> <span class="n">register</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">add_trans_datatype</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">x1</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="n">x2</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">register</span><span class="o">.</span><span class="n">declare_servable</span><span class="p">(</span><span class="n">servable_file</span><span class="o">=</span><span class="s2">&quot;tensor_add.mindir&quot;</span><span class="p">,</span> <span class="n">model_format</span><span class="o">=</span><span class="s2">&quot;MindIR&quot;</span><span class="p">,</span> <span class="n">with_batch_dim</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@register</span><span class="o">.</span><span class="n">register_method</span><span class="p">(</span><span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span> <span class="c1"># register add_cast method in add</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">add_cast</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">call_preprocess</span><span class="p">(</span><span class="n">add_trans_datatype</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>  <span class="c1"># cast input to float32</span>
<span class="gp">... </span>    <span class="n">y</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">call_servable</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">y</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mindspore_serving.server.register.call_preprocess_pipeline">
<span class="sig-prename descclassname"><span class="pre">mindspore_serving.server.register.</span></span><span class="sig-name descname"><span class="pre">call_preprocess_pipeline</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">preprocess_fun</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/register/method.html#call_preprocess_pipeline"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindspore_serving.server.register.call_preprocess_pipeline" title="Permalink to this definition"></a></dt>
<dd><p>For method registration, define the preprocessing pipeline function and its’ parameters.</p>
<p>A single request can include multiple instances, so multiple queued requests will also have multiple instances.
If you need to process multiple instances through multi thread or other parallel processing capability
in <cite>preprocess</cite> or <cite>postprocess</cite>, such as using MindData concurrency ability to process multiple input
images in <cite>preprocess</cite>, MindSpore Serving provides ‘call_preprocess_pipeline’ and ‘call_pstprocess_pipeline’
to register such preprocessing and postprocessing. For more detail,
please refer to <a class="reference external" href="https://gitee.com/mindspore/serving/blob/master/example/resnet/resnet50/servable_config.py">Resnet50 model configuration example</a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>preprocess_fun</strong> (<em>function</em>) – Python pipeline function for preprocess.</p></li>
<li><p><strong>args</strong> – Preprocess inputs. The length of ‘args’ should equal to the input parameters number
of implemented python function.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – The type or value of the parameters are invalid, or other error happened.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore_serving.server</span> <span class="kn">import</span> <span class="n">register</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">add_trans_datatype</span><span class="p">(</span><span class="n">instances</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">instance</span> <span class="ow">in</span> <span class="n">instances</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">x1</span> <span class="o">=</span> <span class="n">instance</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">... </span>        <span class="n">x2</span> <span class="o">=</span> <span class="n">instance</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">... </span>        <span class="k">yield</span> <span class="n">x1</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="n">x2</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">register</span><span class="o">.</span><span class="n">declare_servable</span><span class="p">(</span><span class="n">servable_file</span><span class="o">=</span><span class="s2">&quot;tensor_add.mindir&quot;</span><span class="p">,</span> <span class="n">model_format</span><span class="o">=</span><span class="s2">&quot;MindIR&quot;</span><span class="p">,</span> <span class="n">with_batch_dim</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@register</span><span class="o">.</span><span class="n">register_method</span><span class="p">(</span><span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span> <span class="c1"># register add_cast method in add</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">add_cast</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">call_preprocess_pipeline</span><span class="p">(</span><span class="n">add_trans_datatype</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>  <span class="c1"># cast input to float32</span>
<span class="gp">... </span>    <span class="n">y</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">call_servable</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">y</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mindspore_serving.server.register.call_servable">
<span class="sig-prename descclassname"><span class="pre">mindspore_serving.server.register.</span></span><span class="sig-name descname"><span class="pre">call_servable</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subgraph</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/register/method.html#call_servable"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindspore_serving.server.register.call_servable" title="Permalink to this definition"></a></dt>
<dd><p>For method registration, define the inputs data of model inference.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The length of ‘args’ should be equal to the inputs number of model.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>args</strong> – Model’s inputs, the length of ‘args’ should be equal to the inputs number of model.</p></li>
<li><p><strong>subgraph</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>, </em><em>optional</em>) – The number of subgraph in model. Number starts at 0. Default: 0.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – The type or value of the parameters are invalid, or other error happened.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore_serving.server</span> <span class="kn">import</span> <span class="n">register</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">register</span><span class="o">.</span><span class="n">declare_servable</span><span class="p">(</span><span class="n">servable_file</span><span class="o">=</span><span class="s2">&quot;tensor_add.mindir&quot;</span><span class="p">,</span> <span class="n">model_format</span><span class="o">=</span><span class="s2">&quot;MindIR&quot;</span><span class="p">,</span> <span class="n">with_batch_dim</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@register</span><span class="o">.</span><span class="n">register_method</span><span class="p">(</span><span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span> <span class="c1"># register add_common method in add</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">add_common</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">y</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">call_servable</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">y</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mindspore_serving.server.register.declare_servable">
<span class="sig-prename descclassname"><span class="pre">mindspore_serving.server.register.</span></span><span class="sig-name descname"><span class="pre">declare_servable</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">servable_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_format</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">with_batch_dim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">options</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">without_batch_dim_inputs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/register/servable.html#declare_servable"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindspore_serving.server.register.declare_servable" title="Permalink to this definition"></a></dt>
<dd><p>declare the servable info.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>servable_file</strong> (<em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#list" title="(in Python v3.8)"><em>list</em></a><em>[</em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>]</em><em>]</em>) – Model files name.</p></li>
<li><p><strong>model_format</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – Model format, “OM” or “MindIR”, case ignored.</p></li>
<li><p><strong>with_batch_dim</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a><em>, </em><em>optional</em>) – Whether the first shape dim of the inputs and outputs of model is batch dim.
Default: True.</p></li>
<li><p><strong>options</strong> (<em>Union</em><em>[</em><a class="reference internal" href="#mindspore_serving.server.register.AclOptions" title="mindspore_serving.server.register.AclOptions"><em>AclOptions</em></a><em>, </em><a class="reference internal" href="#mindspore_serving.server.register.GpuOptions" title="mindspore_serving.server.register.GpuOptions"><em>GpuOptions</em></a><em>]</em><em>, </em><em>optional</em>) – Options of model, supports AclOptions or GpuOptions.
Default: None.</p></li>
<li><p><strong>without_batch_dim_inputs</strong> (<em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>, </em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#tuple" title="(in Python v3.8)"><em>tuple</em></a><em>[</em><a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>]</em><em>, </em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#list" title="(in Python v3.8)"><em>list</em></a><em>[</em><a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>]</em><em>]</em><em>, </em><em>optional</em>) – Index of inputs that without batch
dim when with_batch_dim is True. Default: None.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – The type or value of the parameters are invalid.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mindspore_serving.server.register.register_method">
<span class="sig-prename descclassname"><span class="pre">mindspore_serving.server.register.</span></span><span class="sig-name descname"><span class="pre">register_method</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output_names</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/register/method.html#register_method"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindspore_serving.server.register.register_method" title="Permalink to this definition"></a></dt>
<dd><p>Register method for servable.</p>
<p>Define the data flow of preprocess, model inference and postprocess in the method. Preprocess and postprocess
are optional.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The method definition is only used to define data flow of preprocess, model inference and postprocess,
and cannot contain branch structures such as if, for, and while.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>output_names</strong> (<em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#tuple" title="(in Python v3.8)"><em>tuple</em></a><em>[</em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>]</em><em>, </em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#list" title="(in Python v3.8)"><em>list</em></a><em>[</em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>]</em><em>]</em>) – The output names of method. The input names is
the args names of the registered function.</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – The type or value of the parameters are invalid, or other error happened.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore_serving.server</span> <span class="kn">import</span> <span class="n">register</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">add_trans_datatype</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">):</span>
<span class="gp">... </span>     <span class="k">return</span> <span class="n">x1</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="n">x2</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">register</span><span class="o">.</span><span class="n">declare_servable</span><span class="p">(</span><span class="n">servable_file</span><span class="o">=</span><span class="s2">&quot;tensor_add.mindir&quot;</span><span class="p">,</span> <span class="n">model_format</span><span class="o">=</span><span class="s2">&quot;MindIR&quot;</span><span class="p">,</span> <span class="n">with_batch_dim</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@register</span><span class="o">.</span><span class="n">register_method</span><span class="p">(</span><span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span> <span class="c1"># register add_cast method in add</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">add_cast</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">call_preprocess</span><span class="p">(</span><span class="n">add_trans_datatype</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>  <span class="c1"># cast input to float32</span>
<span class="gp">... </span>    <span class="n">y</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">call_servable</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">y</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mindspore_serving.server.register.register_pipeline">
<span class="sig-prename descclassname"><span class="pre">mindspore_serving.server.register.</span></span><span class="sig-name descname"><span class="pre">register_pipeline</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output_names</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/register/method.html#register_pipeline"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindspore_serving.server.register.register_pipeline" title="Permalink to this definition"></a></dt>
<dd><p>register method for Pipeline Servable.</p>
<p>Define the data flow of Pipeline Servable Method. Pipeline servable is optional.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This is a beta interface and may be changed in the future.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>output_names</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#tuple" title="(in Python v3.8)"><em>tuple</em></a><em> or </em><em>list of str</em>) – The output names of pipeline. The input names is
the args names of the registered function.</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – The type or value of the parameters is invalid, or other error happened.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore_serving.server</span> <span class="kn">import</span> <span class="n">distributed</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore_serving.server</span> <span class="kn">import</span> <span class="n">register</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore_serving.server.register</span> <span class="kn">import</span> <span class="n">PipelineServable</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">distributed</span><span class="o">.</span><span class="n">declare_servable</span><span class="p">(</span><span class="n">rank_size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">stage_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">with_batch_dim</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@register</span><span class="o">.</span><span class="n">register_method</span><span class="p">(</span><span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">fun</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">y</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">call_servable</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">y</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">servable</span> <span class="o">=</span> <span class="n">PipelineServable</span><span class="p">(</span><span class="n">servable_name</span><span class="o">=</span><span class="s2">&quot;service&quot;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;fun&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@register</span><span class="o">.</span><span class="n">register_pipeline</span><span class="p">(</span><span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">y</span> <span class="o">=</span> <span class="n">servable</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">y</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="module-mindspore_serving.server.distributed">
<span id="mindspore-serving-server-distributed"></span><h2>mindspore_serving.server.distributed<a class="headerlink" href="#module-mindspore_serving.server.distributed" title="Permalink to this headline"></a></h2>
<p>The interface to startup serving server with distributed servable.
See how to configure and startup distributed model, please refer to
<a class="reference external" href="https://www.mindspore.cn/serving/docs/zh-CN/r1.3/serving_distributed_example.html">MindSpore Serving-based Distributed Inference Service Deployment</a>.</p>
<dl class="py function">
<dt class="sig sig-object py" id="mindspore_serving.server.distributed.declare_servable">
<span class="sig-prename descclassname"><span class="pre">mindspore_serving.server.distributed.</span></span><span class="sig-name descname"><span class="pre">declare_servable</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rank_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stage_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">with_batch_dim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">without_batch_dim_inputs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/worker/distributed/register.html#declare_servable"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindspore_serving.server.distributed.declare_servable" title="Permalink to this definition"></a></dt>
<dd><p>declare distributed servable in servable_config.py.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>rank_size</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – Te rank size of the distributed model.</p></li>
<li><p><strong>stage_size</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – The stage size of the distributed model.</p></li>
<li><p><strong>with_batch_dim</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a><em>, </em><em>optional</em>) – Whether the first shape dim of the inputs and outputs of model is batch.
Default: True.</p></li>
<li><p><strong>without_batch_dim_inputs</strong> (<em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>, </em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#tuple" title="(in Python v3.8)"><em>tuple</em></a><em>[</em><a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>]</em><em>, </em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#list" title="(in Python v3.8)"><em>list</em></a><em>[</em><a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>]</em><em>]</em><em>, </em><em>optional</em>) – Index of inputs that without batch dim
when with_batch_dim is True. Default: None.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – The type or value of the parameters are invalid.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore_serving.server</span> <span class="kn">import</span> <span class="n">distributed</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">distributed</span><span class="o">.</span><span class="n">declare_servable</span><span class="p">(</span><span class="n">rank_size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">stage_size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mindspore_serving.server.distributed.start_servable">
<span class="sig-prename descclassname"><span class="pre">mindspore_serving.server.distributed.</span></span><span class="sig-name descname"><span class="pre">start_servable</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">servable_directory</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">servable_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rank_table_json_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">version_number</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">distributed_address</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'0.0.0.0:6200'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wait_agents_time_in_seconds</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/distributed/_distributed.html#start_servable"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindspore_serving.server.distributed.start_servable" title="Permalink to this definition"></a></dt>
<dd><p>Start up the servable named ‘servable_name’ defined in ‘servable_directory’.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>servable_directory</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – The directory where the servable is located in. There expects to has a directory
named <cite>servable_name</cite>. For more detail:
<a class="reference external" href="https://www.mindspore.cn/serving/docs/zh-CN/r1.3/serving_model.html">How to config Servable</a> .</p></li>
<li><p><strong>servable_name</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – The servable name.</p></li>
<li><p><strong>version_number</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>, </em><em>optional</em>) – Servable version number to be loaded. The version number should be a positive
integer, starting from 1, and 0 means to load the latest version. Default: 1.</p></li>
<li><p><strong>rank_table_json_file</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – The ranke table json file name.</p></li>
<li><p><strong>distributed_address</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>optional</em>) – The distributed worker address the worker agents linked to.
Default: “0.0.0.0:6200”.</p></li>
<li><p><strong>wait_agents_time_in_seconds</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>, </em><em>optional</em>) – The maximum time in seconds the worker waiting ready of all agents,
0 means unlimited time. Default: 0.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – Failed to start the distributed servable.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore_serving.server</span> <span class="kn">import</span> <span class="n">distributed</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">servable_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">distributed</span><span class="o">.</span><span class="n">start_servable</span><span class="p">(</span><span class="n">servable_dir</span><span class="p">,</span> <span class="s2">&quot;matmul&quot;</span><span class="p">,</span> <span class="n">startup_worker_agents</span><span class="o">=</span><span class="s2">&quot;hccl_8p.json&quot;</span><span class="p">,</span> \
<span class="gp">... </span>                           <span class="n">distributed_address</span><span class="o">=</span><span class="s2">&quot;127.0.0.1:6200&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mindspore_serving.server.distributed.startup_agents">
<span class="sig-prename descclassname"><span class="pre">mindspore_serving.server.distributed.</span></span><span class="sig-name descname"><span class="pre">startup_agents</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">distributed_address</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_files</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">group_config_files</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">agent_start_port</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">7000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">agent_ip</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rank_start</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dec_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dec_mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'AES-GCM'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/worker/distributed/agent_startup.html#startup_agents"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mindspore_serving.server.distributed.startup_agents" title="Permalink to this definition"></a></dt>
<dd><p>Start up all needed agents on current machine.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>distributed_address</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – The distributed worker address the agents linked to.</p></li>
<li><p><strong>model_files</strong> (<em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#list" title="(in Python v3.8)"><em>list</em></a><em>[</em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>]</em><em>, </em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#tuple" title="(in Python v3.8)"><em>tuple</em></a><em>[</em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>]</em><em>]</em>) – All model files need in current machine, absolute path or path
relative to this startup python script.</p></li>
<li><p><strong>group_config_files</strong> (<em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#list" title="(in Python v3.8)"><em>list</em></a><em>[</em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>]</em><em>, </em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#tuple" title="(in Python v3.8)"><em>tuple</em></a><em>[</em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>]</em><em>]</em><em>, </em><em>optional</em>) – All group config files need in current machine,
absolute path or path relative to this startup python script, default None, which means there are no
configuration files. Default: None.</p></li>
<li><p><strong>agent_start_port</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>, </em><em>optional</em>) – The starting agent port of the agents link to worker. Default: 7000.</p></li>
<li><p><strong>agent_ip</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>optional</em>) – The local agent ip, if it’s None, the agent ip will be obtained from rank table file.
Default None. Parameter agent_ip and parameter rank_start must have values at the same time,
or both None at the same time. Default: None.</p></li>
<li><p><strong>rank_start</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>, </em><em>optional</em>) – The starting rank id of this machine, if it’s None, the rank ip will be obtained
from rank table file. Default None. Parameter agent_ip and parameter rank_start must have values at the same
time, or both None at the same time. Default: None.</p></li>
<li><p><strong>dec_key</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#bytes" title="(in Python v3.8)"><em>bytes</em></a><em>, </em><em>optional</em>) – Byte type key used for decryption. The valid length is 16, 24, or 32. Default: None.</p></li>
<li><p><strong>dec_mode</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>optional</em>) – Specifies the decryption mode, take effect when dec_key is set.
Option: ‘AES-GCM’ or ‘AES-CBC’. Default: ‘AES-GCM’.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – Failed to start agents.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore_serving.server</span> <span class="kn">import</span> <span class="n">distributed</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model_files</span> <span class="o">=</span> <span class="p">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="n">model_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;models/device</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">/matmul.mindir&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">distributed</span><span class="o">.</span><span class="n">startup_agents</span><span class="p">(</span><span class="n">distributed_address</span><span class="o">=</span><span class="s2">&quot;127.0.0.1:6200&quot;</span><span class="p">,</span> <span class="n">model_files</span><span class="o">=</span><span class="n">model_files</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="MindSpore Serving API" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="client.html" class="btn btn-neutral float-right" title="mindspore_serving.client" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, MindSpore.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 
</body>
</html>