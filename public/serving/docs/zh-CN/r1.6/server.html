

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>mindspore_serving.server &mdash; MindSpore master documentation</title>
  

  
   
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  
  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="mindspore_serving.client" href="client.html" />
    <link rel="prev" title="实现多子图和有状态模型的服务部署" href="serving_multi_subgraphs.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> MindSpore
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">安装部署</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="serving_install.html">安装MindSpore Serving</a></li>
</ul>
<p class="caption"><span class="caption-text">使用指南</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="serving_example.html">基于MindSpore Serving部署推理服务</a></li>
<li class="toctree-l1"><a class="reference internal" href="serving_distributed_example.html">基于MindSpore Serving部署分布式推理服务</a></li>
<li class="toctree-l1"><a class="reference internal" href="serving_grpc.html">基于gRPC接口访问MindSpore Serving服务</a></li>
<li class="toctree-l1"><a class="reference internal" href="serving_restful.html">基于RESTful接口访问MindSpore Serving服务</a></li>
<li class="toctree-l1"><a class="reference internal" href="serving_model.html">通过配置模型提供Servable</a></li>
<li class="toctree-l1"><a class="reference internal" href="serving_multi_subgraphs.html">实现多子图和有状态模型的服务部署</a></li>
</ul>
<p class="caption"><span class="caption-text">API参考</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">mindspore_serving.server</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#module-mindspore_serving.server.register">mindspore_serving.server.register</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-mindspore_serving.server.distributed">mindspore_serving.server.distributed</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="client.html">mindspore_serving.client</a></li>
</ul>
<p class="caption"><span class="caption-text">参考文档</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MindSpore</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>mindspore_serving.server</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/server.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="module-mindspore_serving.server">
<span id="mindspore-serving-server"></span><h1>mindspore_serving.server<a class="headerlink" href="#module-mindspore_serving.server" title="Permalink to this headline">¶</a></h1>
<p>MindSpore Serving is a lightweight and high-performance service module that helps MindSpore developers efficiently
deploy online inference services in the production environment.</p>
<p>MindSpore Serving server API, which can be used to start servables, gRPC and RESTful server. A servable corresponds to
the service provided by a model. The client sends inference tasks and receives inference results through gRPC and
RESTful server.</p>
<dl class="function">
<dt id="mindspore_serving.server.start_grpc_server">
<code class="sig-prename descclassname">mindspore_serving.server.</code><code class="sig-name descname">start_grpc_server</code><span class="sig-paren">(</span><em class="sig-param">address</em>, <em class="sig-param">max_msg_mb_size=100</em>, <em class="sig-param">ssl_config=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/master/_master.html#start_grpc_server"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mindspore_serving.server.start_grpc_server" title="Permalink to this definition">¶</a></dt>
<dd><p>Start gRPC server for the communication between serving client and server.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>address</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – <p>gRPC server address, the address can be {ip}:{port} or unix:{unix_domain_file_path}.</p>
<ul>
<li><p>{ip}:{port} - Internet domain socket address.</p></li>
<li><p>unix:{unix_domain_file_path} - Unix domain socket address, which is used to communicate with multiple
processes on the same machine. {unix_domain_file_path} can be relative or absolute file path,
but the directory where the file is located must already exist.</p></li>
</ul>
</p></li>
<li><p><strong>max_msg_mb_size</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>, </em><em>optional</em>) – The maximum acceptable gRPC message size in megabytes(MB), value range
[1, 512]. Default: 100.</p></li>
<li><p><strong>ssl_config</strong> (<a class="reference internal" href="#mindspore_serving.server.SSLConfig" title="mindspore_serving.server.SSLConfig"><em>mindspore_serving.server.SSLConfig</em></a><em>, </em><em>optional</em>) – The server’s ssl_config, if None, disabled ssl.
Default: None.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – Failed to start the gRPC server: parameter verification failed, the gRPC address is wrong or
    the port is duplicate.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore_serving</span> <span class="kn">import</span> <span class="n">server</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">server</span><span class="o">.</span><span class="n">start_grpc_server</span><span class="p">(</span><span class="s2">&quot;0.0.0.0:5500&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="mindspore_serving.server.start_restful_server">
<code class="sig-prename descclassname">mindspore_serving.server.</code><code class="sig-name descname">start_restful_server</code><span class="sig-paren">(</span><em class="sig-param">address</em>, <em class="sig-param">max_msg_mb_size=100</em>, <em class="sig-param">ssl_config=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/master/_master.html#start_restful_server"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mindspore_serving.server.start_restful_server" title="Permalink to this definition">¶</a></dt>
<dd><p>Start RESTful server for the communication between serving client and server.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>address</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – RESTful server address, the address should be Internet domain socket address.</p></li>
<li><p><strong>max_msg_mb_size</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>, </em><em>optional</em>) – The maximum acceptable RESTful message size in megabytes(MB), value range
[1, 512]. Default: 100.</p></li>
<li><p><strong>ssl_config</strong> (<a class="reference internal" href="#mindspore_serving.server.SSLConfig" title="mindspore_serving.server.SSLConfig"><em>mindspore_serving.server.SSLConfig</em></a><em>, </em><em>optional</em>) – The server’s ssl_config, if None, disabled ssl.
Default: None.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – Failed to start the RESTful server: parameter verification failed, the RESTful address is wrong
    or the port is duplicate.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore_serving</span> <span class="kn">import</span> <span class="n">server</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">server</span><span class="o">.</span><span class="n">start_restful_server</span><span class="p">(</span><span class="s2">&quot;0.0.0.0:5900&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="mindspore_serving.server.stop">
<code class="sig-prename descclassname">mindspore_serving.server.</code><code class="sig-name descname">stop</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/master/_master.html#stop"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mindspore_serving.server.stop" title="Permalink to this definition">¶</a></dt>
<dd><p>Stop the running of serving server.</p>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore_serving</span> <span class="kn">import</span> <span class="n">server</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">server</span><span class="o">.</span><span class="n">start_grpc_server</span><span class="p">(</span><span class="s2">&quot;0.0.0.0:5500&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">server</span><span class="o">.</span><span class="n">start_restful_server</span><span class="p">(</span><span class="s2">&quot;0.0.0.0:1500&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">server</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="mindspore_serving.server.start_servables">
<code class="sig-prename descclassname">mindspore_serving.server.</code><code class="sig-name descname">start_servables</code><span class="sig-paren">(</span><em class="sig-param">servable_configs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/_server.html#start_servables"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mindspore_serving.server.start_servables" title="Permalink to this definition">¶</a></dt>
<dd><p>Start up servables.</p>
<p>It can be used to start multiple different servables. One servable can be deployed on multiple chips,
and each chip runs a servable copy.</p>
<p>On Ascend 910 hardware platform, each copy of each servable owns one chip. Different servables or different versions
of the same servable need to be deployed on different chips.
On Ascend 310 and GPU hardware platform, one chip can be shared by multi servables, and different servables or
different versions of the same servable can be deployed on the same chip to realize chip reuse.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>servable_configs</strong> (<em>Union</em><em>[</em><a class="reference internal" href="#mindspore_serving.server.ServableStartConfig" title="mindspore_serving.server.ServableStartConfig"><em>ServableStartConfig</em></a><em>, </em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#list" title="(in Python v3.8)"><em>list</em></a><em>[</em><a class="reference internal" href="#mindspore_serving.server.ServableStartConfig" title="mindspore_serving.server.ServableStartConfig"><em>ServableStartConfig</em></a><em>]</em><em>, </em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#tuple" title="(in Python v3.8)"><em>tuple</em></a><em>[</em><a class="reference internal" href="#mindspore_serving.server.ServableStartConfig" title="mindspore_serving.server.ServableStartConfig"><em>ServableStartConfig</em></a><em>]</em><em>]</em>) – The
startup configs of one or more servables.</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – Failed to start one or more servables. For log of one servable, please refer to subdirectory
    serving_logs.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore_serving</span> <span class="kn">import</span> <span class="n">server</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">servable_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">resnet_config</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">ServableStartConfig</span><span class="p">(</span><span class="n">servable_dir</span><span class="p">,</span> <span class="s2">&quot;resnet&quot;</span><span class="p">,</span> <span class="n">device_ids</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">add_config</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">ServableStartConfig</span><span class="p">(</span><span class="n">servable_dir</span><span class="p">,</span> <span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="n">device_ids</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">server</span><span class="o">.</span><span class="n">start_servables</span><span class="p">(</span><span class="n">servable_configs</span><span class="o">=</span><span class="p">(</span><span class="n">resnet_config</span><span class="p">,</span> <span class="n">add_config</span><span class="p">))</span>  <span class="c1"># press Ctrl+C to stop</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">server</span><span class="o">.</span><span class="n">start_grpc_server</span><span class="p">(</span><span class="s2">&quot;0.0.0.0:5500&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="mindspore_serving.server.ServableStartConfig">
<em class="property">class </em><code class="sig-prename descclassname">mindspore_serving.server.</code><code class="sig-name descname">ServableStartConfig</code><span class="sig-paren">(</span><em class="sig-param">servable_directory</em>, <em class="sig-param">servable_name</em>, <em class="sig-param">device_ids=None</em>, <em class="sig-param">version_number=0</em>, <em class="sig-param">device_type=None</em>, <em class="sig-param">num_parallel_workers=0</em>, <em class="sig-param">dec_key=None</em>, <em class="sig-param">dec_mode=&quot;AES-GCM&quot;</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/_servable_local.html#ServableStartConfig"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mindspore_serving.server.ServableStartConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>Servable startup configuration.</p>
<p>For more detail, please refer to
<a class="reference external" href="https://www.mindspore.cn/serving/docs/zh-CN/r1.6/serving_example.html">MindSpore-based Inference Service Deployment</a> and
<a class="reference external" href="https://www.mindspore.cn/serving/docs/zh-CN/r1.6/serving_model.html">Servable Provided Through Model Configuration</a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>servable_directory</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – The directory where the servable is located in. There expects to has a directory
named <cite>servable_name</cite>.</p></li>
<li><p><strong>servable_name</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – The servable name.</p></li>
<li><p><strong>device_ids</strong> (<em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>, </em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#list" title="(in Python v3.8)"><em>list</em></a><em>[</em><a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>]</em><em>, </em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#tuple" title="(in Python v3.8)"><em>tuple</em></a><em>[</em><a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>]</em><em>]</em><em>, </em><em>optional</em>) – The device list the model loads into and runs in.
Used when device type is Nvidia GPU, Ascend 310/310P/910. Default None.</p></li>
<li><p><strong>version_number</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>, </em><em>optional</em>) – Servable version number to be loaded. The version number should be a positive
integer, starting from 1, and 0 means to load the latest version. Default: 0.</p></li>
<li><p><strong>device_type</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>optional</em>) – <p>Currently supports “Ascend”, “GPU”, “CPU” and None. Default: None.</p>
<ul>
<li><p>”Ascend”: the platform expected to be Ascend 310/310P/910, etc.</p></li>
<li><p>”GPU”: the platform expected to be Nvidia GPU.</p></li>
<li><p>”CPU”: the platform expected to be CPU.</p></li>
<li><p>None: the platform is determined by the MindSpore environment.</p></li>
</ul>
</p></li>
<li><p><strong>num_parallel_workers</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>, </em><em>optional</em>) – This feature is currently in beta.
The number of processes processing python tasks, at least the number
of device cards used specified by the parameter device_ids. It will be adjusted to the number of device
cards when it is less than the number of device cards. Default: 0.</p></li>
<li><p><strong>dec_key</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#bytes" title="(in Python v3.8)"><em>bytes</em></a><em>, </em><em>optional</em>) – Byte type key used for decryption. The valid length is 16, 24, or 32. Default: None.</p></li>
<li><p><strong>dec_mode</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>optional</em>) – Specifies the decryption mode, take effect when dec_key is set.
Option: ‘AES-GCM’ or ‘AES-CBC’. Default: ‘AES-GCM’.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – The type or value of the parameters are invalid.</p>
</dd>
</dl>
</dd></dl>

<dl class="class">
<dt id="mindspore_serving.server.SSLConfig">
<em class="property">class </em><code class="sig-prename descclassname">mindspore_serving.server.</code><code class="sig-name descname">SSLConfig</code><span class="sig-paren">(</span><em class="sig-param">certificate</em>, <em class="sig-param">private_key</em>, <em class="sig-param">custom_ca=None</em>, <em class="sig-param">verify_client=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/master/_master.html#SSLConfig"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mindspore_serving.server.SSLConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>The server’s ssl_config encapsulates necessary parameters for SSL-enabled connections.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>certificate</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – File holding the PEM-encoded certificate chain as a byte string to use or None if no
certificate chain should be used.</p></li>
<li><p><strong>private_key</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – File holding the PEM-encoded private key as a byte string, or None if no private key should
be used.</p></li>
<li><p><strong>custom_ca</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>optional</em>) – File holding the PEM-encoded root certificates as a byte string. When verify_client
is True, custom_ca must be provided. When verify_client is False, this parameter will be ignored.
Default: None.</p></li>
<li><p><strong>verify_client</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a><em>, </em><em>optional</em>) – If verify_client is true, use mutual authentication. If false, use one-way
authentication. Default: False.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – The type or value of the parameters are invalid.</p>
</dd>
</dl>
</dd></dl>

<div class="section" id="module-mindspore_serving.server.register">
<span id="mindspore-serving-server-register"></span><h2>mindspore_serving.server.register<a class="headerlink" href="#module-mindspore_serving.server.register" title="Permalink to this headline">¶</a></h2>
<p>Servable register interface, used in servable_config.py of one servable.
See how to configure servable_config.py file, please refer to
<a class="reference external" href="https://www.mindspore.cn/serving/docs/zh-CN/r1.6/serving_model.html">Servable Provided Through Model Configuration</a>.</p>
<dl class="function">
<dt id="mindspore_serving.server.register.declare_model">
<code class="sig-prename descclassname">mindspore_serving.server.register.</code><code class="sig-name descname">declare_model</code><span class="sig-paren">(</span><em class="sig-param">model_file</em>, <em class="sig-param">model_format</em>, <em class="sig-param">with_batch_dim=True</em>, <em class="sig-param">options=None</em>, <em class="sig-param">without_batch_dim_inputs=None</em>, <em class="sig-param">context=None</em>, <em class="sig-param">config_file=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/register/model.html#declare_model"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mindspore_serving.server.register.declare_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Declare one model when importing servable_config.py of one servable.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This interface should take effect when importing servable_config.py by the serving server. Therefore, it’s
recommended that this interface be used globally in servable_config.py.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The parameter ‘options’ is deprecated from version 1.6.0 and will be removed in a future version, use
parameter ‘context’ instead.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model_file</strong> (<em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#list" title="(in Python v3.8)"><em>list</em></a><em>[</em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>]</em><em>]</em>) – Model files name.</p></li>
<li><p><strong>model_format</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – Model format, “OM”, “MindIR” or “MindIR_Opt”, case ignored.</p></li>
<li><p><strong>with_batch_dim</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a><em>, </em><em>optional</em>) – Whether the first shape dim of the inputs and outputs of model is batch dim.
Default: True.</p></li>
<li><p><strong>options</strong> (<em>Union</em><em>[</em><a class="reference internal" href="#mindspore_serving.server.register.AclOptions" title="mindspore_serving.server.register.AclOptions"><em>AclOptions</em></a><em>, </em><a class="reference internal" href="#mindspore_serving.server.register.GpuOptions" title="mindspore_serving.server.register.GpuOptions"><em>GpuOptions</em></a><em>]</em><em>, </em><em>optional</em>) – Options of model, supports AclOptions or GpuOptions.
Default: None.</p></li>
<li><p><strong>context</strong> (<a class="reference internal" href="#mindspore_serving.server.register.Context" title="mindspore_serving.server.register.Context"><em>Context</em></a>) – Context is used to store environment variables during execution. Default: None.</p></li>
<li><p><strong>without_batch_dim_inputs</strong> (<em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>, </em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#tuple" title="(in Python v3.8)"><em>tuple</em></a><em>[</em><a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>]</em><em>, </em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#list" title="(in Python v3.8)"><em>list</em></a><em>[</em><a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>]</em><em>]</em><em>, </em><em>optional</em>) – Index of inputs that without batch
dim when with_batch_dim is True. Default: None.</p></li>
<li><p><strong>config_file</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>optional</em>) – Config file for model to set mix precision inference. The file path can be an
absolute path or a relative path to the directory in which servable_config.py resides.
Default: None.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – The type or value of the parameters are invalid.</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Model, identification of this model.</p>
</dd>
</dl>
</dd></dl>

<dl class="class">
<dt id="mindspore_serving.server.register.Model">
<em class="property">class </em><code class="sig-prename descclassname">mindspore_serving.server.register.</code><code class="sig-name descname">Model</code><span class="sig-paren">(</span><em class="sig-param">model_key</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/register/model.html#Model"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mindspore_serving.server.register.Model" title="Permalink to this definition">¶</a></dt>
<dd><p>Indicate a model. User should not construct Model object directly, it’s need to returned from declare_model
or declare_servable</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>model_key</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – Model key identifies the model.</p>
</dd>
</dl>
<dl class="method">
<dt id="mindspore_serving.server.register.Model.call">
<code class="sig-name descname">call</code><span class="sig-paren">(</span><em class="sig-param">*args</em>, <em class="sig-param">subgraph=0</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/register/model.html#Model.call"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mindspore_serving.server.register.Model.call" title="Permalink to this definition">¶</a></dt>
<dd><p>Invoke the model inference interface based on instances.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is a beta interface and may not function stably.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>subgraph</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>, </em><em>optional</em>) – Subgraph index, used when there are multiply sub-graphs in one model.</p></li>
<li><p><strong>args</strong> – tuple/list of instances, or inputs of one instance.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – Inputs are invalid.</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Tuple of instances when input parameter ‘args’ is tuple/list, or outputs of one instance.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore_serving.server</span> <span class="kn">import</span> <span class="n">register</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">mindspore.dataset.vision.c_transforms</span> <span class="k">as</span> <span class="nn">VC</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">declare_model</span><span class="p">(</span><span class="n">model_file</span><span class="o">=</span><span class="s2">&quot;resnet_bs32.mindir&quot;</span><span class="p">,</span> <span class="n">model_format</span><span class="o">=</span><span class="s2">&quot;MindIR&quot;</span><span class="p">)</span> <span class="c1"># batch_size=32</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">preprocess</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">decode</span> <span class="o">=</span> <span class="n">VC</span><span class="o">.</span><span class="n">Decode</span><span class="p">()</span>
<span class="gp">... </span>    <span class="n">resize</span> <span class="o">=</span> <span class="n">VC</span><span class="o">.</span><span class="n">Resize</span><span class="p">([</span><span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">])</span>
<span class="gp">... </span>    <span class="n">normalize</span> <span class="o">=</span> <span class="n">VC</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="p">[</span><span class="mf">125.307</span><span class="p">,</span> <span class="mf">122.961</span><span class="p">,</span> <span class="mf">113.8575</span><span class="p">],</span> <span class="n">std</span><span class="o">=</span><span class="p">[</span><span class="mf">51.5865</span><span class="p">,</span> <span class="mf">50.847</span><span class="p">,</span> <span class="mf">51.255</span><span class="p">])</span>
<span class="gp">... </span>    <span class="n">hwc2chw</span> <span class="o">=</span> <span class="n">VC</span><span class="o">.</span><span class="n">HWC2CHW</span><span class="p">()</span>
<span class="gp">... </span>    <span class="n">image</span> <span class="o">=</span> <span class="n">decode</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">image</span> <span class="o">=</span> <span class="n">resize</span><span class="p">(</span><span class="n">image</span><span class="p">)</span> <span class="c1"># [3,224,224]</span>
<span class="gp">... </span>    <span class="n">image</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">image</span><span class="p">)</span> <span class="c1"># [3,224,224]</span>
<span class="gp">... </span>    <span class="n">image</span> <span class="o">=</span> <span class="n">hwc2chw</span><span class="p">(</span><span class="n">image</span><span class="p">)</span> <span class="c1"># [3,224,224]</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="nb">input</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">postprocess</span><span class="p">(</span><span class="n">score</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">call_resnet_model</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">image</span> <span class="o">=</span> <span class="n">preprocess</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">score</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>  <span class="c1"># for only one instance</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">postprocess</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">call_resnet_model_batch</span><span class="p">(</span><span class="n">instances</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">input_instances</span> <span class="o">=</span> <span class="p">[]</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">instance</span> <span class="ow">in</span> <span class="n">instances</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">image</span> <span class="o">=</span> <span class="n">instance</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># only one input</span>
<span class="gp">... </span>        <span class="n">image</span> <span class="o">=</span> <span class="n">preprocess</span><span class="p">(</span><span class="n">image</span><span class="p">)</span> <span class="c1"># [3,224,224]</span>
<span class="gp">... </span>        <span class="n">input_instances</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">image</span><span class="p">])</span>
<span class="gp">... </span>    <span class="n">output_instances</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">input_instances</span><span class="p">)</span>  <span class="c1"># for multiply instances</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">instance</span> <span class="ow">in</span> <span class="n">output_instances</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">score</span> <span class="o">=</span> <span class="n">instance</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># only one output for each instance</span>
<span class="gp">... </span>        <span class="n">index</span> <span class="o">=</span> <span class="n">postprocess</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">yield</span> <span class="n">index</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@register</span><span class="o">.</span><span class="n">register_method</span><span class="p">(</span><span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">predict_v1</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>  <span class="c1"># without pipeline, call model with only one instance a time</span>
<span class="gp">... </span>    <span class="n">index</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">add_stage</span><span class="p">(</span><span class="n">call_resnet_model</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">outputs_count</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">index</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@register</span><span class="o">.</span><span class="n">register_method</span><span class="p">(</span><span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">predict_v2</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>  <span class="c1"># without pipeline, call model with maximum 32 instances a time</span>
<span class="gp">... </span>    <span class="n">index</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">add_stage</span><span class="p">(</span><span class="n">call_resnet_model_batch</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">outputs_count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">index</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@register</span><span class="o">.</span><span class="n">register_method</span><span class="p">(</span><span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">predict_v3</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>  <span class="c1"># pipeline</span>
<span class="gp">... </span>    <span class="n">image</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">add_stage</span><span class="p">(</span><span class="n">preprocess</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">outputs_count</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">score</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">add_stage</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">outputs_count</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">index</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">add_stage</span><span class="p">(</span><span class="n">postprocess</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span> <span class="n">outputs_count</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">index</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="mindspore_serving.server.register.AclOptions">
<em class="property">class </em><code class="sig-prename descclassname">mindspore_serving.server.register.</code><code class="sig-name descname">AclOptions</code><span class="sig-paren">(</span><em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/register/model.html#AclOptions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mindspore_serving.server.register.AclOptions" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper class to set Ascend device infos.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>‘AclOptions’ is deprecated from version 1.6.0 and will be removed in a future version, use
<a class="reference internal" href="#mindspore_serving.server.register.AscendDeviceInfo" title="mindspore_serving.server.register.AscendDeviceInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">mindspore_serving.server.register.AscendDeviceInfo</span></code></a> instead.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>insert_op_cfg_path</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>optional</em>) – Path of aipp config file.</p></li>
<li><p><strong>input_format</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>optional</em>) – Manually specify the model input format, the value can be “ND”, “NCHW”, “NHWC”,
“CHWN”, “NC1HWC0”, or “NHWC1C0”.</p></li>
<li><p><strong>input_shape</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>optional</em>) – Manually specify the model input shape, such as
“input_op_name1: n1,c2,h3,w4;input_op_name2: n4,c3,h2,w1”.</p></li>
<li><p><strong>output_type</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>optional</em>) – Manually specify the model output type, the value can be “FP16”, “UINT8” or “FP32”,
Default: “FP32”.</p></li>
<li><p><strong>precision_mode</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>optional</em>) – Model precision mode, the value can be “force_fp16”，”allow_fp32_to_fp16”，
“must_keep_origin_dtype” or “allow_mix_precision”. Default: “force_fp16”.</p></li>
<li><p><strong>op_select_impl_mode</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>optional</em>) – The operator selection mode, the value can be “high_performance” or
“high_precision”. Default: “high_performance”.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – Acl option is invalid, or value is not str.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore_serving.server</span> <span class="kn">import</span> <span class="n">register</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">options</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">AclOptions</span><span class="p">(</span><span class="n">op_select_impl_mode</span><span class="o">=</span><span class="s2">&quot;high_precision&quot;</span><span class="p">,</span> <span class="n">precision_mode</span><span class="o">=</span><span class="s2">&quot;allow_fp32_to_fp16&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">register</span><span class="o">.</span><span class="n">declare_servable</span><span class="p">(</span><span class="n">servable_file</span><span class="o">=</span><span class="s2">&quot;deeptext.mindir&quot;</span><span class="p">,</span> <span class="n">model_format</span><span class="o">=</span><span class="s2">&quot;MindIR&quot;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="mindspore_serving.server.register.GpuOptions">
<em class="property">class </em><code class="sig-prename descclassname">mindspore_serving.server.register.</code><code class="sig-name descname">GpuOptions</code><span class="sig-paren">(</span><em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/register/model.html#GpuOptions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mindspore_serving.server.register.GpuOptions" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper class to set gpu options.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>‘GpuOptions’ is deprecated from version 1.6.0 and will be removed in a future version, use
<a class="reference internal" href="#mindspore_serving.server.register.GPUDeviceInfo" title="mindspore_serving.server.register.GPUDeviceInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">mindspore_serving.server.register.GPUDeviceInfo</span></code></a> instead.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>precision_mode</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>optional</em>) – inference operator selection, and the value can be “origin”, “fp16”.
Default: “origin”.</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – Gpu option is invalid, or value is not str.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore_serving.server</span> <span class="kn">import</span> <span class="n">register</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">options</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">GpuOptions</span><span class="p">(</span><span class="n">precision_mode</span><span class="o">=</span><span class="s2">&quot;origin&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">register</span><span class="o">.</span><span class="n">declare_servable</span><span class="p">(</span><span class="n">servable_file</span><span class="o">=</span><span class="s2">&quot;deeptext.mindir&quot;</span><span class="p">,</span> <span class="n">model_format</span><span class="o">=</span><span class="s2">&quot;MindIR&quot;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="mindspore_serving.server.register.AscendDeviceInfo">
<em class="property">class </em><code class="sig-prename descclassname">mindspore_serving.server.register.</code><code class="sig-name descname">AscendDeviceInfo</code><span class="sig-paren">(</span><em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/register/model.html#AscendDeviceInfo"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mindspore_serving.server.register.AscendDeviceInfo" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper class to set Ascend device infos. For more details about the parameters, see
<a class="reference external" href="https://support.huaweicloud.com/tg-cannApplicationDev330/atlasatc_16_0037.html">parameters description of ATC tool</a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>insert_op_cfg_path</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>optional</em>) – Path of aipp config file.</p></li>
<li><p><strong>input_format</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>optional</em>) – Manually specify the model input format, the value can be “ND”, “NCHW”, “NHWC”,
“CHWN”, “NC1HWC0”, or “NHWC1C0”.</p></li>
<li><p><strong>input_shape</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>optional</em>) – Manually specify the model input shape, such as
“input_op_name1: n1,c2,h3,w4;input_op_name2: n4,c3,h2,w1”.</p></li>
<li><p><strong>output_type</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>optional</em>) – Manually specify the model output type, the value can be “FP16”, “UINT8” or “FP32”,
Default: “FP32”.</p></li>
<li><p><strong>precision_mode</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>optional</em>) – Model precision mode, the value can be “force_fp16”，”allow_fp32_to_fp16”，
“must_keep_origin_dtype” or “allow_mix_precision”. Default: “force_fp16”.</p></li>
<li><p><strong>op_select_impl_mode</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>optional</em>) – The operator selection mode, the value can be “high_performance” or
“high_precision”. Default: “high_performance”.</p></li>
<li><p><strong>fusion_switch_config_path</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>optional</em>) – Configuration file path of the convergence rule, including graph
convergence and UB convergence. The system has built-in graph convergence and UB convergence rules, which
are enableed by default. You can disable the reuls specified in the file by setting this parameter.</p></li>
<li><p><strong>buffer_optimize_mode</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>optional</em>) – The value can be “l1_optimize”, “l2_optimize”, “off_optimize” or
“l1_and_l2_optimize”. Default “l2_optimize”.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – Acl device info is invalid.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore_serving.server</span> <span class="kn">import</span> <span class="n">register</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">Context</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span><span class="o">.</span><span class="n">append_device_info</span><span class="p">(</span><span class="n">register</span><span class="o">.</span><span class="n">AscendDeviceInfo</span><span class="p">(</span><span class="n">input_format</span><span class="o">=</span><span class="s2">&quot;NCHW&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">declare_model</span><span class="p">(</span><span class="n">model_file</span><span class="o">=</span><span class="s2">&quot;deeptext.ms&quot;</span><span class="p">,</span> <span class="n">model_format</span><span class="o">=</span><span class="s2">&quot;MindIR_Opt&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="mindspore_serving.server.register.CPUDeviceInfo">
<em class="property">class </em><code class="sig-prename descclassname">mindspore_serving.server.register.</code><code class="sig-name descname">CPUDeviceInfo</code><span class="sig-paren">(</span><em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/register/model.html#CPUDeviceInfo"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mindspore_serving.server.register.CPUDeviceInfo" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper class to set cpu device info.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>precision_mode</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>optional</em>) – inference operator selection, and the value can be “origin”, “fp16”.
Default: “origin”.</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – Cpu option is invalid, or value is not str.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore_serving.server</span> <span class="kn">import</span> <span class="n">register</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">Context</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span><span class="o">.</span><span class="n">append_device_info</span><span class="p">(</span><span class="n">register</span><span class="o">.</span><span class="n">CPUDeviceInfo</span><span class="p">(</span><span class="n">precision_mode</span><span class="o">=</span><span class="s2">&quot;fp16&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">declare_model</span><span class="p">(</span><span class="n">model_file</span><span class="o">=</span><span class="s2">&quot;deeptext.ms&quot;</span><span class="p">,</span> <span class="n">model_format</span><span class="o">=</span><span class="s2">&quot;MindIR_Opt&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="mindspore_serving.server.register.GPUDeviceInfo">
<em class="property">class </em><code class="sig-prename descclassname">mindspore_serving.server.register.</code><code class="sig-name descname">GPUDeviceInfo</code><span class="sig-paren">(</span><em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/register/model.html#GPUDeviceInfo"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mindspore_serving.server.register.GPUDeviceInfo" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper class to set gpu device info.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>precision_mode</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>optional</em>) – inference operator selection, and the value can be “origin”, “fp16”.
Default: “origin”.</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – Gpu option is invalid, or value is not str.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore_serving.server</span> <span class="kn">import</span> <span class="n">register</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">Context</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span><span class="o">.</span><span class="n">append_device_info</span><span class="p">(</span><span class="n">register</span><span class="o">.</span><span class="n">GPUDeviceInfo</span><span class="p">(</span><span class="n">precision_mode</span><span class="o">=</span><span class="s2">&quot;fp16&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">declare_model</span><span class="p">(</span><span class="n">model_file</span><span class="o">=</span><span class="s2">&quot;deeptext.mindir&quot;</span><span class="p">,</span> <span class="n">model_format</span><span class="o">=</span><span class="s2">&quot;MindIR&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="mindspore_serving.server.register.Context">
<em class="property">class </em><code class="sig-prename descclassname">mindspore_serving.server.register.</code><code class="sig-name descname">Context</code><span class="sig-paren">(</span><em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/register/model.html#Context"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mindspore_serving.server.register.Context" title="Permalink to this definition">¶</a></dt>
<dd><p>Context is used to store environment variables during execution. When using mindspore lite and the device type is
Ascend or Gpu, the extra CPUDeviceInfo will be used.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>thread_num</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>, </em><em>optional</em>) – Set the number of threads at runtime. Only valid when using mindspore lite.</p></li>
<li><p><strong>thread_affinity_core_list</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#tuple" title="(in Python v3.8)"><em>tuple</em></a><em>[</em><a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>]</em><em>, </em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#list" title="(in Python v3.8)"><em>list</em></a><em>[</em><a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>]</em><em>, </em><em>optional</em>) – Set the thread lists to CPU cores.
Only valid when using mindspore lite.</p></li>
<li><p><strong>enable_parallel</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a><em>, </em><em>optional</em>) – Set the status whether to perform model inference or training in parallel.
Only valid when using mindspore lite.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore_serving.server</span> <span class="kn">import</span> <span class="n">register</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">Context</span><span class="p">(</span><span class="n">thread_num</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">thread_affinity_core_list</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">enable_parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span><span class="o">.</span><span class="n">append_device_info</span><span class="p">(</span><span class="n">register</span><span class="o">.</span><span class="n">GPUDeviceInfo</span><span class="p">(</span><span class="n">precision_mode</span><span class="o">=</span><span class="s2">&quot;fp16&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">declare_model</span><span class="p">(</span><span class="n">model_file</span><span class="o">=</span><span class="s2">&quot;tensor_add.mindir&quot;</span><span class="p">,</span> <span class="n">model_format</span><span class="o">=</span><span class="s2">&quot;MindIR&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – type or value of input parameters are invalid.</p>
</dd>
</dl>
<dl class="method">
<dt id="mindspore_serving.server.register.Context.append_device_info">
<code class="sig-name descname">append_device_info</code><span class="sig-paren">(</span><em class="sig-param">device_info</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/register/model.html#Context.append_device_info"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mindspore_serving.server.register.Context.append_device_info" title="Permalink to this definition">¶</a></dt>
<dd><p>Append one user-defined device info to the context</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>device_info</strong> (<em>Union</em><em>[</em><a class="reference internal" href="#mindspore_serving.server.register.CPUDeviceInfo" title="mindspore_serving.server.register.CPUDeviceInfo"><em>CPUDeviceInfo</em></a><em>, </em><a class="reference internal" href="#mindspore_serving.server.register.GPUDeviceInfo" title="mindspore_serving.server.register.GPUDeviceInfo"><em>GPUDeviceInfo</em></a><em>, </em><a class="reference internal" href="#mindspore_serving.server.register.AscendDeviceInfo" title="mindspore_serving.server.register.AscendDeviceInfo"><em>AscendDeviceInfo</em></a><em>]</em>) – User-defined device info for one
device, otherwise default values are used. You can customize device info for each device, and the system
selects the required device info based on the actual backend device and inference package.</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – type or value of input parameters are invalid.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="mindspore_serving.server.register.register_method">
<code class="sig-prename descclassname">mindspore_serving.server.register.</code><code class="sig-name descname">register_method</code><span class="sig-paren">(</span><em class="sig-param">output_names</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/register/method.html#register_method"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mindspore_serving.server.register.register_method" title="Permalink to this definition">¶</a></dt>
<dd><p>Define a method of the servable when importing servable_config.py of one servable. MindSpore Serving supports a
service consisting of multiple python functions and multiple models.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This interface should take effect when importing servable_config.py by the serving server. Therefore, it’s
recommended that this interface be used globally in servable_config.py.</p>
</div>
<p>A method is an interface for clients to access the servable, and the servable can include one or more methods.
This interface will defines the signatures and pipeline of the method.</p>
<p>The signatures includes the method name, input and outputs names of the method. When accessing a service, the client
needs to specify the servable name, the method name, and provide one or more inference instances. Each instance
specifies the input data by the input names and obtains the output data by the outputs names.</p>
<p>The pipeline consists of one or more stages, each stage can be a python function or a model. This is, a pipline can
include one or more python functions and one or more models. In addition, the interface also defines the data flow
of these stages.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>output_names</strong> (<em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#tuple" title="(in Python v3.8)"><em>tuple</em></a><em>[</em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>]</em><em>, </em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#list" title="(in Python v3.8)"><em>list</em></a><em>[</em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>]</em><em>]</em>) – The output names of method. The input names is
the args names of the registered function.</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – The type or value of the parameters are invalid, or other error happened.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore_serving.server</span> <span class="kn">import</span> <span class="n">register</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">add_model</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">declare_model</span><span class="p">(</span><span class="n">model_file</span><span class="o">=</span><span class="s2">&quot;tensor_add.mindir&quot;</span><span class="p">,</span> <span class="n">model_format</span><span class="o">=</span><span class="s2">&quot;MindIR&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sub_model</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">declare_model</span><span class="p">(</span><span class="n">model_file</span><span class="o">=</span><span class="s2">&quot;tensor_sub.mindir&quot;</span><span class="p">,</span> <span class="n">model_format</span><span class="o">=</span><span class="s2">&quot;MindIR&quot;</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@register</span><span class="o">.</span><span class="n">register_method</span><span class="p">(</span><span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span> <span class="c1"># register predict method in servable</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">):</span> <span class="c1"># x1+x2-x3</span>
<span class="gp">... </span>    <span class="n">y</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">add_stage</span><span class="p">(</span><span class="n">add_model</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">outputs_count</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">y</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">add_stage</span><span class="p">(</span><span class="n">sub_model</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x3</span><span class="p">,</span> <span class="n">outputs_count</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">y</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="mindspore_serving.server.register.add_stage">
<code class="sig-prename descclassname">mindspore_serving.server.register.</code><code class="sig-name descname">add_stage</code><span class="sig-paren">(</span><em class="sig-param">stage</em>, <em class="sig-param">*args</em>, <em class="sig-param">outputs_count</em>, <em class="sig-param">batch_size=None</em>, <em class="sig-param">tag=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/register/method.html#add_stage"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mindspore_serving.server.register.add_stage" title="Permalink to this definition">¶</a></dt>
<dd><p>Used in the functions wrapped by register_method, define a stage that call a function/model and indicates the
input data used by the function/model.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The length of ‘args’ should be equal to the inputs number of function or model.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stage</strong> (<em>Union</em><em>(</em><em>function</em><em>, </em><a class="reference internal" href="#mindspore_serving.server.register.Model" title="mindspore_serving.server.register.Model"><em>Model</em></a><em>)</em>) – User-defined python function or Model object return by declare_model.</p></li>
<li><p><strong>outputs_count</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – outputs count of stage</p></li>
<li><p><strong>batch_size</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>, </em><em>optional</em>) – <p>This parameter is valid only when stage is a function and the function
can process multi instances at a time. default None.</p>
<ul>
<li><p>None, The input of the function will be the inputs of one instance.</p></li>
<li><p>0, The input of the function will be tuple object of instances, and the maximum number
of the instances is determined by the server based on the batch size of models.</p></li>
<li><p>int value &gt;= 1, The input of the function will be tuple object of instances, and the maximum number
of the instances is the value specified by ‘batch_size’.</p></li>
</ul>
</p></li>
<li><p><strong>args</strong> – Stage inputs placeholders, which come from the inputs of the function wrapped by register_method or the
outputs of add_stage. The length of ‘args’ should equal to the input number of the function or model.</p></li>
<li><p><strong>tag</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>optional</em>) – Customized flag of the stage, such as “Preprocess”, default None.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – The type or value of the parameters are invalid, or other error happened.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore_serving.server</span> <span class="kn">import</span> <span class="n">register</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">add_model</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">declare_model</span><span class="p">(</span><span class="n">model_file</span><span class="o">=</span><span class="s2">&quot;tensor_add.mindir&quot;</span><span class="p">,</span> <span class="n">model_format</span><span class="o">=</span><span class="s2">&quot;MindIR&quot;</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">preprocess</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">x1</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="n">x2</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@register</span><span class="o">.</span><span class="n">register_method</span><span class="p">(</span><span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span> <span class="c1"># register add_common method in add</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">add_common</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">add_stage</span><span class="p">(</span><span class="n">preprocess</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">outputs_count</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># call preprocess in stage 1</span>
<span class="gp">... </span>    <span class="n">y</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">add_stage</span><span class="p">(</span><span class="n">add_model</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">outputs_count</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># call add model in stage 2</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">y</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="mindspore_serving.server.register.declare_servable">
<code class="sig-prename descclassname">mindspore_serving.server.register.</code><code class="sig-name descname">declare_servable</code><span class="sig-paren">(</span><em class="sig-param">servable_file</em>, <em class="sig-param">model_format</em>, <em class="sig-param">with_batch_dim=True</em>, <em class="sig-param">options=None</em>, <em class="sig-param">without_batch_dim_inputs=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/register/model.html#declare_servable"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mindspore_serving.server.register.declare_servable" title="Permalink to this definition">¶</a></dt>
<dd><p>declare one model.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>‘register.declare_servable’ is deprecated from version 1.5.0 and will be removed in a future version, use
<a class="reference internal" href="#mindspore_serving.server.register.declare_model" title="mindspore_serving.server.register.declare_model"><code class="xref py py-class docutils literal notranslate"><span class="pre">mindspore_serving.server.register.declare_model</span></code></a> instead.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>servable_file</strong> (<em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#list" title="(in Python v3.8)"><em>list</em></a><em>[</em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>]</em><em>]</em>) – Model files name.</p></li>
<li><p><strong>model_format</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – Model format, “OM” or “MindIR”, case ignored.</p></li>
<li><p><strong>with_batch_dim</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a><em>, </em><em>optional</em>) – Whether the first shape dim of the inputs and outputs of model is batch dim.
Default: True.</p></li>
<li><p><strong>options</strong> (<em>Union</em><em>[</em><a class="reference internal" href="#mindspore_serving.server.register.AclOptions" title="mindspore_serving.server.register.AclOptions"><em>AclOptions</em></a><em>, </em><a class="reference internal" href="#mindspore_serving.server.register.GpuOptions" title="mindspore_serving.server.register.GpuOptions"><em>GpuOptions</em></a><em>]</em><em>, </em><em>optional</em>) – Options of model, supports AclOptions or GpuOptions.
Default: None.</p></li>
<li><p><strong>without_batch_dim_inputs</strong> (<em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>, </em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#tuple" title="(in Python v3.8)"><em>tuple</em></a><em>[</em><a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>]</em><em>, </em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#list" title="(in Python v3.8)"><em>list</em></a><em>[</em><a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>]</em><em>]</em><em>, </em><em>optional</em>) – Index of inputs that without batch
dim when with_batch_dim is True. Default: None.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – The type or value of the parameters are invalid.</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Model, identification of this model, used as input of add_stage.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="mindspore_serving.server.register.call_preprocess">
<code class="sig-prename descclassname">mindspore_serving.server.register.</code><code class="sig-name descname">call_preprocess</code><span class="sig-paren">(</span><em class="sig-param">preprocess_fun</em>, <em class="sig-param">*args</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/register/method.html#call_preprocess"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mindspore_serving.server.register.call_preprocess" title="Permalink to this definition">¶</a></dt>
<dd><p>For method registration, define the preprocessing function and its’ parameters.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>‘call_preprocess’ is deprecated from version 1.5.0 and will be removed in a future version, use
<a class="reference internal" href="#mindspore_serving.server.register.add_stage" title="mindspore_serving.server.register.add_stage"><code class="xref py py-class docutils literal notranslate"><span class="pre">mindspore_serving.server.register.add_stage</span></code></a> instead.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The length of ‘args’ should be equal to the inputs number of preprocess_fun.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>preprocess_fun</strong> (<em>function</em>) – Python function for preprocess.</p></li>
<li><p><strong>args</strong> – Preprocess inputs. The length of ‘args’ should equal to the input parameters number
of implemented python function.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – The type or value of the parameters are invalid, or other error happened.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore_serving.server</span> <span class="kn">import</span> <span class="n">register</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">add_trans_datatype</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">x1</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="n">x2</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">register</span><span class="o">.</span><span class="n">declare_servable</span><span class="p">(</span><span class="n">servable_file</span><span class="o">=</span><span class="s2">&quot;tensor_add.mindir&quot;</span><span class="p">,</span> <span class="n">model_format</span><span class="o">=</span><span class="s2">&quot;MindIR&quot;</span><span class="p">,</span> <span class="n">with_batch_dim</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@register</span><span class="o">.</span><span class="n">register_method</span><span class="p">(</span><span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span> <span class="c1"># register add_cast method in add</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">add_cast</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">call_preprocess</span><span class="p">(</span><span class="n">add_trans_datatype</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>  <span class="c1"># cast input to float32</span>
<span class="gp">... </span>    <span class="n">y</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">call_servable</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">y</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="mindspore_serving.server.register.call_preprocess_pipeline">
<code class="sig-prename descclassname">mindspore_serving.server.register.</code><code class="sig-name descname">call_preprocess_pipeline</code><span class="sig-paren">(</span><em class="sig-param">preprocess_fun</em>, <em class="sig-param">*args</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/register/method.html#call_preprocess_pipeline"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mindspore_serving.server.register.call_preprocess_pipeline" title="Permalink to this definition">¶</a></dt>
<dd><p>For method registration, define the preprocessing pipeline function and its’ parameters.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>‘call_preprocess_pipeline’ is deprecated from version 1.5.0 and will be removed in a future version, use
<a class="reference internal" href="#mindspore_serving.server.register.add_stage" title="mindspore_serving.server.register.add_stage"><code class="xref py py-class docutils literal notranslate"><span class="pre">mindspore_serving.server.register.add_stage</span></code></a> instead.</p>
</div>
<p>A single request can include multiple instances, so multiple queued requests will also have multiple instances.
If you need to process multiple instances through multi thread or other parallel processing capability
in <cite>preprocess</cite> or <cite>postprocess</cite>, such as using MindData concurrency ability to process multiple input
images in <cite>preprocess</cite>, MindSpore Serving provides ‘call_preprocess_pipeline’ and ‘call_postprocess_pipeline’
to register such preprocessing and postprocessing. For more detail,
please refer to <a class="reference external" href="https://gitee.com/mindspore/serving/blob/r1.6/example/resnet/resnet50/servable_config.py">Resnet50 model configuration example</a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>preprocess_fun</strong> (<em>function</em>) – Python pipeline function for preprocess.</p></li>
<li><p><strong>args</strong> – Preprocess inputs. The length of ‘args’ should equal to the input parameters number
of implemented python function.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – The type or value of the parameters are invalid, or other error happened.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore_serving.server</span> <span class="kn">import</span> <span class="n">register</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">add_trans_datatype</span><span class="p">(</span><span class="n">instances</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">instance</span> <span class="ow">in</span> <span class="n">instances</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">x1</span> <span class="o">=</span> <span class="n">instance</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">... </span>        <span class="n">x2</span> <span class="o">=</span> <span class="n">instance</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">... </span>        <span class="k">yield</span> <span class="n">x1</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="n">x2</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">register</span><span class="o">.</span><span class="n">declare_servable</span><span class="p">(</span><span class="n">servable_file</span><span class="o">=</span><span class="s2">&quot;tensor_add.mindir&quot;</span><span class="p">,</span> <span class="n">model_format</span><span class="o">=</span><span class="s2">&quot;MindIR&quot;</span><span class="p">,</span> <span class="n">with_batch_dim</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@register</span><span class="o">.</span><span class="n">register_method</span><span class="p">(</span><span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span> <span class="c1"># register add_cast method in add</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">add_cast</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">call_preprocess_pipeline</span><span class="p">(</span><span class="n">add_trans_datatype</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>  <span class="c1"># cast input to float32</span>
<span class="gp">... </span>    <span class="n">y</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">call_servable</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">y</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="mindspore_serving.server.register.call_servable">
<code class="sig-prename descclassname">mindspore_serving.server.register.</code><code class="sig-name descname">call_servable</code><span class="sig-paren">(</span><em class="sig-param">*args</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/register/method.html#call_servable"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mindspore_serving.server.register.call_servable" title="Permalink to this definition">¶</a></dt>
<dd><p>For method registration, define the inputs data of model inference.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>‘call_servable’ is deprecated from version 1.5.0 and will be removed in a future version, use
<a class="reference internal" href="#mindspore_serving.server.register.add_stage" title="mindspore_serving.server.register.add_stage"><code class="xref py py-class docutils literal notranslate"><span class="pre">mindspore_serving.server.register.add_stage</span></code></a> instead.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The length of ‘args’ should be equal to the inputs number of model.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>args</strong> – Model’s inputs, the length of ‘args’ should be equal to the inputs number of model.</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – The type or value of the parameters are invalid, or other error happened.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore_serving.server</span> <span class="kn">import</span> <span class="n">register</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">register</span><span class="o">.</span><span class="n">declare_servable</span><span class="p">(</span><span class="n">servable_file</span><span class="o">=</span><span class="s2">&quot;tensor_add.mindir&quot;</span><span class="p">,</span> <span class="n">model_format</span><span class="o">=</span><span class="s2">&quot;MindIR&quot;</span><span class="p">,</span> <span class="n">with_batch_dim</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@register</span><span class="o">.</span><span class="n">register_method</span><span class="p">(</span><span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span> <span class="c1"># register add_common method in add</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">add_common</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">y</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">call_servable</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">y</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="mindspore_serving.server.register.call_postprocess">
<code class="sig-prename descclassname">mindspore_serving.server.register.</code><code class="sig-name descname">call_postprocess</code><span class="sig-paren">(</span><em class="sig-param">postprocess_fun</em>, <em class="sig-param">*args</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/register/method.html#call_postprocess"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mindspore_serving.server.register.call_postprocess" title="Permalink to this definition">¶</a></dt>
<dd><p>For method registration, define the postprocessing function and its’ parameters.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>‘call_postprocess’ is deprecated from version 1.5.0 and will be removed in a future version, use
<a class="reference internal" href="#mindspore_serving.server.register.add_stage" title="mindspore_serving.server.register.add_stage"><code class="xref py py-class docutils literal notranslate"><span class="pre">mindspore_serving.server.register.add_stage</span></code></a> instead.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The length of ‘args’ should be equal to the inputs number of postprocess_fun.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>postprocess_fun</strong> (<em>function</em>) – Python function for postprocess.</p></li>
<li><p><strong>args</strong> – Preprocess inputs. The length of ‘args’ should equal to the input parameters number
of implemented python function.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – The type or value of the parameters are invalid, or other error happened.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="mindspore_serving.server.register.call_postprocess_pipeline">
<code class="sig-prename descclassname">mindspore_serving.server.register.</code><code class="sig-name descname">call_postprocess_pipeline</code><span class="sig-paren">(</span><em class="sig-param">postprocess_fun</em>, <em class="sig-param">*args</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/register/method.html#call_postprocess_pipeline"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mindspore_serving.server.register.call_postprocess_pipeline" title="Permalink to this definition">¶</a></dt>
<dd><p>For method registration, define the postprocessing pipeline function and its’ parameters.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>‘call_postprocess_pipeline’ is deprecated from version 1.5.0 and will be removed in a future version, use
<a class="reference internal" href="#mindspore_serving.server.register.add_stage" title="mindspore_serving.server.register.add_stage"><code class="xref py py-class docutils literal notranslate"><span class="pre">mindspore_serving.server.register.add_stage</span></code></a> instead.</p>
</div>
<p>A single request can include multiple instances, so multiple queued requests will also have multiple instances.
If you need to process multiple instances through multi thread or other parallel processing capability
in <cite>preprocess</cite> or <cite>postprocess</cite>, such as using MindData concurrency ability to process multiple input
images in <cite>preprocess</cite>, MindSpore Serving provides ‘call_preprocess_pipeline’ and ‘call_postprocess_pipeline’
to register such preprocessing and postprocessing. For more detail,
please refer to <a class="reference external" href="https://gitee.com/mindspore/serving/blob/r1.6/example/resnet/resnet50/servable_config.py">Resnet50 model configuration example</a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>postprocess_fun</strong> (<em>function</em>) – Python pipeline function for postprocess.</p></li>
<li><p><strong>args</strong> – Preprocess inputs. The length of ‘args’ should equal to the input parameters number
of implemented python function.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – The type or value of the parameters are invalid, or other error happened.</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-mindspore_serving.server.distributed">
<span id="mindspore-serving-server-distributed"></span><h2>mindspore_serving.server.distributed<a class="headerlink" href="#module-mindspore_serving.server.distributed" title="Permalink to this headline">¶</a></h2>
<p>The interface to startup serving server with distributed servable.
See how to configure and startup distributed model, please refer to
<a class="reference external" href="https://www.mindspore.cn/serving/docs/zh-CN/r1.6/serving_distributed_example.html">MindSpore Serving-based Distributed Inference Service Deployment</a>.</p>
<dl class="function">
<dt id="mindspore_serving.server.distributed.start_servable">
<code class="sig-prename descclassname">mindspore_serving.server.distributed.</code><code class="sig-name descname">start_servable</code><span class="sig-paren">(</span><em class="sig-param">servable_directory</em>, <em class="sig-param">servable_name</em>, <em class="sig-param">rank_table_json_file</em>, <em class="sig-param">version_number=1</em>, <em class="sig-param">distributed_address=&quot;0.0.0.0:6200&quot;</em>, <em class="sig-param">wait_agents_time_in_seconds=0</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/distributed/_distributed.html#start_servable"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mindspore_serving.server.distributed.start_servable" title="Permalink to this definition">¶</a></dt>
<dd><p>Start up the servable named ‘servable_name’ defined in ‘servable_directory’.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>servable_directory</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – The directory where the servable is located in. There expects to has a directory
named <cite>servable_name</cite>. For more detail:
<a class="reference external" href="https://www.mindspore.cn/serving/docs/zh-CN/r1.6/serving_model.html">How to config Servable</a> .</p></li>
<li><p><strong>servable_name</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – The servable name.</p></li>
<li><p><strong>version_number</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>, </em><em>optional</em>) – Servable version number to be loaded. The version number should be a positive
integer, starting from 1, and 0 means to load the latest version. Default: 1.</p></li>
<li><p><strong>rank_table_json_file</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – The ranke table json file name.</p></li>
<li><p><strong>distributed_address</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>optional</em>) – The distributed worker address the worker agents linked to.
Default: “0.0.0.0:6200”.</p></li>
<li><p><strong>wait_agents_time_in_seconds</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>, </em><em>optional</em>) – The maximum time in seconds the worker waiting ready of all agents,
0 means unlimited time. Default: 0.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – Failed to start the distributed servable.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore_serving.server</span> <span class="kn">import</span> <span class="n">distributed</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">servable_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">distributed</span><span class="o">.</span><span class="n">start_servable</span><span class="p">(</span><span class="n">servable_dir</span><span class="p">,</span> <span class="s2">&quot;matmul&quot;</span><span class="p">,</span> <span class="n">startup_worker_agents</span><span class="o">=</span><span class="s2">&quot;hccl_8p.json&quot;</span><span class="p">,</span> \
<span class="gp">... </span>                           <span class="n">distributed_address</span><span class="o">=</span><span class="s2">&quot;127.0.0.1:6200&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="mindspore_serving.server.distributed.startup_agents">
<code class="sig-prename descclassname">mindspore_serving.server.distributed.</code><code class="sig-name descname">startup_agents</code><span class="sig-paren">(</span><em class="sig-param">distributed_address</em>, <em class="sig-param">model_files</em>, <em class="sig-param">group_config_files=None</em>, <em class="sig-param">agent_start_port=7000</em>, <em class="sig-param">agent_ip=None</em>, <em class="sig-param">rank_start=None</em>, <em class="sig-param">dec_key=None</em>, <em class="sig-param">dec_mode=&quot;AES-GCM&quot;</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/worker/distributed/agent_startup.html#startup_agents"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mindspore_serving.server.distributed.startup_agents" title="Permalink to this definition">¶</a></dt>
<dd><p>Start up all needed agents on current machine.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>distributed_address</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – The distributed worker address the agents linked to.</p></li>
<li><p><strong>model_files</strong> (<em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#list" title="(in Python v3.8)"><em>list</em></a><em>[</em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>]</em><em>, </em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#tuple" title="(in Python v3.8)"><em>tuple</em></a><em>[</em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>]</em><em>]</em>) – All model files need in current machine, absolute path or path
relative to this startup python script.</p></li>
<li><p><strong>group_config_files</strong> (<em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#list" title="(in Python v3.8)"><em>list</em></a><em>[</em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>]</em><em>, </em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#tuple" title="(in Python v3.8)"><em>tuple</em></a><em>[</em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>]</em><em>]</em><em>, </em><em>optional</em>) – All group config files need in current machine,
absolute path or path relative to this startup python script, default None, which means there are no
configuration files. Default: None.</p></li>
<li><p><strong>agent_start_port</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>, </em><em>optional</em>) – The starting agent port of the agents link to worker. Default: 7000.</p></li>
<li><p><strong>agent_ip</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>optional</em>) – The local agent ip, if it’s None, the agent ip will be obtained from rank table file.
Default None. Parameter agent_ip and parameter rank_start must have values at the same time,
or both None at the same time. Default: None.</p></li>
<li><p><strong>rank_start</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>, </em><em>optional</em>) – The starting rank id of this machine, if it’s None, the rank ip will be obtained
from rank table file. Default None. Parameter agent_ip and parameter rank_start must have values at the same
time, or both None at the same time. Default: None.</p></li>
<li><p><strong>dec_key</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#bytes" title="(in Python v3.8)"><em>bytes</em></a><em>, </em><em>optional</em>) – Byte type key used for decryption. The valid length is 16, 24, or 32. Default: None.</p></li>
<li><p><strong>dec_mode</strong> (<a class="reference external" href="https://docs.python.org/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a><em>, </em><em>optional</em>) – Specifies the decryption mode, take effect when dec_key is set.
Option: ‘AES-GCM’ or ‘AES-CBC’. Default: ‘AES-GCM’.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – Failed to start agents.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore_serving.server</span> <span class="kn">import</span> <span class="n">distributed</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model_files</span> <span class="o">=</span> <span class="p">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="n">model_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;models/device</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">/matmul.mindir&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">distributed</span><span class="o">.</span><span class="n">startup_agents</span><span class="p">(</span><span class="n">distributed_address</span><span class="o">=</span><span class="s2">&quot;127.0.0.1:6200&quot;</span><span class="p">,</span> <span class="n">model_files</span><span class="o">=</span><span class="n">model_files</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="mindspore_serving.server.distributed.declare_servable">
<code class="sig-prename descclassname">mindspore_serving.server.distributed.</code><code class="sig-name descname">declare_servable</code><span class="sig-paren">(</span><em class="sig-param">rank_size</em>, <em class="sig-param">stage_size</em>, <em class="sig-param">with_batch_dim=True</em>, <em class="sig-param">without_batch_dim_inputs=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mindspore_serving/server/worker/distributed/register.html#declare_servable"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#mindspore_serving.server.distributed.declare_servable" title="Permalink to this definition">¶</a></dt>
<dd><p>declare distributed servable in servable_config.py.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>rank_size</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – Te rank size of the distributed model.</p></li>
<li><p><strong>stage_size</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – The stage size of the distributed model.</p></li>
<li><p><strong>with_batch_dim</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a><em>, </em><em>optional</em>) – Whether the first shape dim of the inputs and outputs of model is batch.
Default: True.</p></li>
<li><p><strong>without_batch_dim_inputs</strong> (<em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>, </em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#tuple" title="(in Python v3.8)"><em>tuple</em></a><em>[</em><a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>]</em><em>, </em><a class="reference external" href="https://docs.python.org/library/stdtypes.html#list" title="(in Python v3.8)"><em>list</em></a><em>[</em><a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a><em>]</em><em>]</em><em>, </em><em>optional</em>) – Index of inputs that without batch dim
when with_batch_dim is True. Default: None.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – The type or value of the parameters are invalid.</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Model, identification of this model, used as input of add_stage.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mindspore_serving.server</span> <span class="kn">import</span> <span class="n">distributed</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">distributed</span><span class="o">.</span><span class="n">declare_servable</span><span class="p">(</span><span class="n">rank_size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">stage_size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="client.html" class="btn btn-neutral float-right" title="mindspore_serving.client" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="serving_multi_subgraphs.html" class="btn btn-neutral float-left" title="实现多子图和有状态模型的服务部署" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, MindSpore.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   
</body>
</html>