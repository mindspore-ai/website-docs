<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Testing Model Security Using Fuzz Testing &mdash; MindSpore r1.1 documentation</title>
      <link rel="stylesheet" href="../_static/css/bootstrap.min.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/training.css" type="text/css" /><link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/js/training.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Using Membership Inference to Test Model Security" href="test_model_security_membership_inference.html" />
    <link rel="prev" title="Protecting User Privacy with Differential Privacy Mechanism" href="protect_user_privacy_with_differential_privacy.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> MindSpore
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Quick Start</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quick_start/quick_start.html">Implementing an Image Classification Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quick_start/linear_regression.html">Implementing Simple Linear Function Fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quick_start/quick_video.html">Hands-on Installation and Experience</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Basic Use</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../use/data_preparation.html">Loading Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../use/defining_the_network.html">Defining the Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../use/save_model.html">Saving Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../use/load_model_for_inference_and_transfer.html">Loading a Model for Inference and Transfer Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../use/publish_model.html">Publishing Models using MindSpore Hub</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Process Data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="convert_dataset.html">Converting Dataset to MindRecord</a></li>
<li class="toctree-l1"><a class="reference internal" href="optimize_data_processing.html">Optimizing the Data Processing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Build Networks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="custom_operator.html">Custom Operator</a></li>
<li class="toctree-l1"><a class="reference internal" href="migrate_script.html">Migrating Training Scripts from Third Party Frameworks</a></li>
<li class="toctree-l1"><a class="reference internal" href="apply_deep_probability_programming.html">Deep Probabilistic Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="achieve_high_order_differentiation.html">Achieve High Order Differentiation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Model Optimization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="debug_in_pynative_mode.html">Debugging in PyNative Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom_debugging_info.html">Custom Debugging Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="visualization_tutorials.html">Training Process Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="enable_auto_augmentation.html">Auto Augmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="evaluate_the_model_during_training.html">Evaluating the Model during Training</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Performance Optimization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="distributed_training_tutorials.html">Distributed Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="enable_mixed_precision.html">Enabling Mixed Precision</a></li>
<li class="toctree-l1"><a class="reference internal" href="enable_graph_kernel_fusion.html">Enabling Graph Kernel Fusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="apply_gradient_accumulation.html">Applying Gradient Accumulation Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="enable_cache.html">Application of Single-Node Tensor Cache</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Model Compression</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="apply_quantization_aware_training.html">Applying Quantization Aware Training</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Model Security and Privacy</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="improve_model_security_nad.html">Improving Model Security with NAD Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="protect_user_privacy_with_differential_privacy.html">Protecting User Privacy with Differential Privacy Mechanism</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Testing Model Security Using Fuzz Testing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#implementation">Implementation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#importing-library-files">Importing Library Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#parameter-configuration">Parameter Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fuzz-testing-application">Fuzz Testing Application</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="test_model_security_membership_inference.html">Using Membership Inference to Test Model Security</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Application</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="cv.html">Computer Vision</a></li>
<li class="toctree-l1"><a class="reference internal" href="nlp.html">Natural Language Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="hpc.html">High Performance Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="use_on_the_cloud.html">Use MindSpore on the Cloud</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MindSpore</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Testing Model Security Using Fuzz Testing</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/advanced_use/test_model_security_fuzzing.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="testing-model-security-using-fuzz-testing">
<h1>Testing Model Security Using Fuzz Testing<a class="headerlink" href="#testing-model-security-using-fuzz-testing" title="Permalink to this headline"></a></h1>
<p><code class="docutils literal notranslate"><span class="pre">Linux</span></code> <code class="docutils literal notranslate"><span class="pre">Ascend</span></code> <code class="docutils literal notranslate"><span class="pre">GPU</span></code> <code class="docutils literal notranslate"><span class="pre">CPU</span></code> <code class="docutils literal notranslate"><span class="pre">Model</span> <span class="pre">Evaluation</span></code> <code class="docutils literal notranslate"><span class="pre">Enterprise</span></code> <code class="docutils literal notranslate"><span class="pre">Expert</span></code>
<a href="https://gitee.com/mindspore/docs/blob/r1.1/tutorials/training/source_en/advanced_use/test_model_security_fuzzing.md" target="_blank"><img src="../_static/logo_source.png"></a>  </p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline"></a></h2>
<p>The decision logic of traditional software is determined by the code logic. Traditional software determines whether the test is adequate based on the code line coverage rate. Ideally, the higher the coverage rate is, the more adequate the code test is. However, for deep neural network, the decision logic of the program is determined by the training data, network structure, and parameters through a black box mechanism. The code line coverage fails to evaluate the test adequacy. A more suitable test evaluation criterion needs to be selected according to the deep network features to guide the neural network to perform a more adequate test and find more corner error cases, thereby ensuring universality and robustness of a model.</p>
<p>The fuzz testing module of MindArmour uses the neuron coverage rate as the test evaluation criterion. Neuron coverage is the range of the number of neurons observed and activated and the range of the neuron output value through a set of inputs. The neuron coverage is used to guide input mutation so that the input can activate more neurons and neuron values can be distributed in a wider range. In this way, we can explore different types of model output results and incorrect behaviors.</p>
<p>The LeNet model and MNIST dataset are used as an example to describe how to use Fuzz testing.</p>
<blockquote>
<div><p>This example is for CPUs, GPUs, and Ascend 910 AI processors. You can download the complete sample code at <a class="reference external" href="https://gitee.com/mindspore/mindarmour/blob/r1.1/examples/ai_fuzzer/lenet5_mnist_fuzzing.py">https://gitee.com/mindspore/mindarmour/blob/r1.1/examples/ai_fuzzer/lenet5_mnist_fuzzing.py</a>.</p>
</div></blockquote>
</section>
<section id="implementation">
<h2>Implementation<a class="headerlink" href="#implementation" title="Permalink to this headline"></a></h2>
<section id="importing-library-files">
<h3>Importing Library Files<a class="headerlink" href="#importing-library-files" title="Permalink to this headline"></a></h3>
<p>The following lists the required common modules, MindSpore-related modules, Fuzz testing feature modules, and configuration log labels and log levels.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">Model</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">context</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">load_checkpoint</span><span class="p">,</span> <span class="n">load_param_into_net</span>

<span class="kn">from</span> <span class="nn">mindarmour.fuzz_testing</span> <span class="kn">import</span> <span class="n">Fuzzer</span>
<span class="kn">from</span> <span class="nn">mindarmour.fuzz_testing</span> <span class="kn">import</span> <span class="n">ModelCoverageMetrics</span>
<span class="kn">from</span> <span class="nn">mindarmour.utils.logger</span> <span class="kn">import</span> <span class="n">LogUtil</span>

<span class="kn">from</span> <span class="nn">examples.common.dataset.data_processing</span> <span class="kn">import</span> <span class="n">generate_mnist_dataset</span>
<span class="kn">from</span> <span class="nn">examples.common.networks.lenet5.lenet5_net</span> <span class="kn">import</span> <span class="n">LeNet5</span>

<span class="n">LOGGER</span> <span class="o">=</span> <span class="n">LogUtil</span><span class="o">.</span><span class="n">get_instance</span><span class="p">()</span>
<span class="n">TAG</span> <span class="o">=</span> <span class="s1">&#39;Fuzz_testing&#39;</span>
<span class="n">LOGGER</span><span class="o">.</span><span class="n">set_level</span><span class="p">(</span><span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="parameter-configuration">
<h3>Parameter Configuration<a class="headerlink" href="#parameter-configuration" title="Permalink to this headline"></a></h3>
<p>Configure necessary information, including the environment information and execution mode.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">context</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">GRAPH_MODE</span><span class="p">,</span> <span class="n">device_target</span><span class="o">=</span><span class="s2">&quot;Ascend&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>For details about the API configuration, see the <code class="docutils literal notranslate"><span class="pre">context.set_context</span></code>.</p>
</section>
<section id="fuzz-testing-application">
<h3>Fuzz Testing Application<a class="headerlink" href="#fuzz-testing-application" title="Permalink to this headline"></a></h3>
<ol class="arabic">
<li><p>Create a LeNet model and load the MNIST dataset. The operation is the same as that for <a class="reference external" href="https://www.mindspore.cn/tutorial/training/en/r1.1/advanced_use/improve_model_security_nad.html">Model Security</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="c1"># Lenet model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
<span class="c1"># get training data</span>
<span class="n">mnist_path</span> <span class="o">=</span> <span class="s2">&quot;../common/dataset/MNIST/&quot;</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">32</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">generate_mnist_dataset</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mnist_path</span><span class="p">,</span> <span class="s2">&quot;train&quot;</span><span class="p">),</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">train_images</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">create_tuple_iterator</span><span class="p">():</span>
    <span class="n">images</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">train_images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">images</span><span class="p">)</span>
<span class="n">train_images</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">train_images</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># get test data</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">32</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">generate_mnist_dataset</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mnist_path</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">),</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">test_images</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">test_labels</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">create_tuple_iterator</span><span class="p">():</span>
    <span class="n">images</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">()</span>
    <span class="n">test_images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">images</span><span class="p">)</span>
    <span class="n">test_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
<span class="n">test_images</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">test_images</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">test_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">test_labels</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Configure Fuzzer parameters.</p>
<p>Set the data mutation method and parameters. Multiple methods can be configured at the same time. Currently, the following data mutation methods are supported:</p>
<ul class="simple">
<li><p>Image affine transformation methods: Translate, Scale, Shear, and Rotate.</p></li>
<li><p>Methods based on image pixel value changes: Contrast, Brightness, Blur, and Noise.</p></li>
<li><p>Methods for generating adversarial examples based on white-box and black-box attacks: FGSM, PGD, and MDIIM.</p></li>
</ul>
<p>The data mutation method must include the method based on the image pixel value changes.</p>
<p>The first two image transform methods support user-defined configuration parameters and randomly generated parameters by algorithms. For user-defined configuration parameters see the class methods corresponding to <a class="reference external" href="https://gitee.com/mindspore/mindarmour/blob/r1.1/mindarmour/fuzz_testing/image_transform.py">https://gitee.com/mindspore/mindarmour/blob/r1.1/mindarmour/fuzz_testing/image_transform.py</a>. For randomly generated parameters by algorithms you can set method’s params to <code class="docutils literal notranslate"><span class="pre">'auto_param':</span> <span class="pre">[True]</span></code>. The mutation parameters are randomly generated within the recommended range.</p>
<p>For details about how to set parameters based on the attack defense method, see the corresponding attack method class.</p>
<p>The following is an example for configure Fuzzer parameters.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mutate_config</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="s1">&#39;Blur&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;radius&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">],</span>
                             <span class="s1">&#39;auto_param&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]}},</span>
                 <span class="p">{</span><span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="s1">&#39;Contrast&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;auto_param&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">]}},</span>
                 <span class="p">{</span><span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="s1">&#39;Translate&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;auto_param&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">]}},</span>
                 <span class="p">{</span><span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="s1">&#39;Brightness&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;auto_param&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">]}},</span>
                 <span class="p">{</span><span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="s1">&#39;Noise&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;auto_param&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">]}},</span>
                 <span class="p">{</span><span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="s1">&#39;Scale&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;auto_param&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">]}},</span>
                 <span class="p">{</span><span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="s1">&#39;Shear&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;auto_param&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">]}},</span>
                 <span class="p">{</span><span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="s1">&#39;FGSM&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;eps&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">]}}</span>
                <span class="p">]</span>
</pre></div>
</div>
<p>Set evaluation metrics. Currently, the following evaluation metrics are supported:</p>
<ul class="simple">
<li><p>General evaluation metric: accuracy.</p></li>
<li><p>Neuron coverage rate metrics: kmnc, nbc, and snac.</p></li>
<li><p>Adversarial attack evaluation metric: attack_success_rate.
You can set this parameter to <code class="docutils literal notranslate"><span class="pre">auto</span></code>. By default, all evaluation metrics are used.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">eval_metrics</span> <span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">,</span> <span class="s1">&#39;kmnc&#39;</span><span class="p">,</span> <span class="s1">&#39;attack_success_rate&#39;</span><span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>Initialize the seed queue. Each seed in the seed queue has two values: original image and image label. Here we select 100 samples as initial seed queue.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># make initial seeds</span>
<span class="n">initial_seeds</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">img</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">test_images</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">):</span>
 <span class="n">initial_seeds</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">img</span><span class="p">,</span> <span class="n">label</span><span class="p">])</span>
<span class="n">initial_seeds</span> <span class="o">=</span> <span class="n">initial_seeds</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>Test the neuron coverage rate before the fuzz testing.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">segmented_num</span><span class="o">=</span><span class="mi">1000</span>
<span class="n">neuron_num</span><span class="o">=</span><span class="mi">10</span>
<span class="n">model_coverage_test</span> <span class="o">=</span> <span class="n">ModelCoverageMetrics</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">segmented_num</span><span class="p">,</span> <span class="n">neuron_num</span><span class="p">,</span> <span class="n">train_images</span><span class="p">)</span>
<span class="n">model_coverage_test</span><span class="o">.</span><span class="n">calculate_coverage</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">test_images</span><span class="p">[:</span><span class="mi">100</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s1">&#39;KMNC of this test is : </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">model_coverage_test</span><span class="o">.</span><span class="n">get_kmnc</span><span class="p">())</span>
</pre></div>
</div>
<p>Result:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="n">KMNC</span> <span class="n">of</span> <span class="n">this</span> <span class="n">test</span> <span class="ow">is</span> <span class="p">:</span> <span class="mf">0.0851</span>
</pre></div>
</div>
</li>
<li><p>Perform the fuzz testing.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">eval_metrics</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span>
<span class="n">model_fuzz_test</span> <span class="o">=</span> <span class="n">Fuzzer</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_images</span><span class="p">,</span> <span class="n">neuron_num</span><span class="p">,</span> <span class="n">segmented_num</span><span class="p">)</span>
<span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">metrics</span> <span class="o">=</span> <span class="n">model_fuzz_test</span><span class="o">.</span><span class="n">fuzzing</span><span class="p">(</span><span class="n">mutate_config</span><span class="p">,</span> <span class="n">initial_seeds</span><span class="p">,</span> <span class="n">eval_metrics</span><span class="o">=</span><span class="n">eval_metrics</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Experiment results.</p>
<p>The results of fuzz testing contains five aspect data:</p>
<ul class="simple">
<li><p>fuzz_samples: mutated samples in fuzz testing.</p></li>
<li><p>true_labels: the ground truth labels of fuzz_samples.</p></li>
<li><p>fuzz_pred: predictions of tested model about fuzz_samples.</p></li>
<li><p>fuzz_strategies: the methods used to mutate fuzz_samples.</p></li>
<li><p>metrics_report: metrics report of fuzz testing.</p></li>
</ul>
<p>The first 4 returns can be used to further calculated complex metrics and analyze the robustness of the model.</p>
<p>Run the following command to view the result:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">metrics</span><span class="p">:</span>
   <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">metrics</span><span class="p">:</span>
      <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
</pre></div>
</div>
<p>The fuzz testing result is as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Accuracy</span><span class="p">:</span> <span class="mf">0.7929</span>
<span class="n">Attack_success_rate</span><span class="p">:</span> <span class="mf">0.3939</span>
<span class="n">Neural_coverage_KMNC</span><span class="p">:</span> <span class="mf">0.4797</span>
</pre></div>
</div>
<p>Before the fuzzing test, the KMNC neuron coverage rate of the seed is 8.5%. After the fuzzing test, the KMNC neuron coverage rate is 47.97%, and the neuron coverage rate and sample diversity increase. After the fuzzing test, the accuracy rate of the model to generate samples is 79.29%, and the attack success rate is 39.39% for samples using the adversarial attack method. Since the initial seed, the mutation method and the corresponding parameters are all randomly selected, it is normal that the result floats to some extent.</p>
<p>Original image:</p>
<p><img alt="fuzz_seed" src="../_images/fuzz_seed.png" /></p>
<p>Mutation images generated by fuzzing:</p>
<p><img alt="fuzz_res" src="../_images/fuzz_res.png" /></p>
</li>
</ol>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="protect_user_privacy_with_differential_privacy.html" class="btn btn-neutral float-left" title="Protecting User Privacy with Differential Privacy Mechanism" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="test_model_security_membership_inference.html" class="btn btn-neutral float-right" title="Using Membership Inference to Test Model Security" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, MindSpore.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 
</body>
</html>