

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Image Classification Transfer Learning &mdash; MindSpore master documentation</title>
  

  
   
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  
  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        
        
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Model Adversarial Attack" href="fgsm.html" />
    <link rel="prev" title="ResNet-50 for Image Classification" href="resnet50.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> MindSpore
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">CV</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="resnet50.html">ResNet-50 for Image Classification</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Image Classification Transfer Learning</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#preparing-data">Preparing Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#downloading-a-dataset">Downloading a Dataset</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#loading-a-dataset">Loading a Dataset</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#dataset-visualization">Dataset Visualization</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#training-a-model">Training a Model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#fine-tuning-the-model">Fine-tuning the Model</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#training-and-evaluation">Training and Evaluation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#visualizing-model-prediction">Visualizing Model Prediction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#training-using-fixed-features">Training Using Fixed Features</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#training-and-evaluation-1">Training and Evaluation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#visualizing-model-prediction-1">Visualizing Model Prediction</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="fgsm.html">Model Adversarial Attack</a></li>
<li class="toctree-l1"><a class="reference internal" href="dcgan.html">Generating Cartoon Head Portrait via DCGAN</a></li>
</ul>
<p class="caption"><span class="caption-text">NLP</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../nlp/sentiment_analysis.html">Sentiment Classification Implemented by RNN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nlp/sequence_labeling.html">LSTM+CRF Sequence Labeling</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MindSpore</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Image Classification Transfer Learning</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/cv/transfer_learning.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="image-classification-transfer-learning">
<h1>Image Classification Transfer Learning<a class="headerlink" href="#image-classification-transfer-learning" title="Permalink to this headline">¶</a></h1>
<p><a href="https://gitee.com/mindspore/docs/blob/r1.8/tutorials/application/source_en/cv/transfer_learning.md" target="_blank"><img src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/r1.8/resource/_static/logo_source_en.png"></a></p>
<p>In an actual application scenario, the training dataset is insufficient. As a result, few people train the entire network from the beginning. Generally, training is performed on a very large basic dataset to obtain a pre-trained model, and then the model is used to initialize a weight parameter of the network, or the model is applied to a specific task as a fixed feature extraction device. The following uses the transfer learning method to classify wolf and dog images in the ImageNet dataset.</p>
<blockquote>
<div><p>For details about transfer learning, see <a class="reference external" href="https://cs231n.github.io/transfer-learning/#tf">Stanford University CS231n</a>.</p>
</div></blockquote>
<div class="section" id="preparing-data">
<h2>Preparing Data<a class="headerlink" href="#preparing-data" title="Permalink to this headline">¶</a></h2>
<div class="section" id="downloading-a-dataset">
<h3>Downloading a Dataset<a class="headerlink" href="#downloading-a-dataset" title="Permalink to this headline">¶</a></h3>
<p>Download the <a class="reference external" href="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/notebook/datasets/intermediate/Canidae_data.zip">dog and wolf classification dataset</a> used in the case. The images in the dataset come from ImageNet. Each class has about 120 training images and 30 validation images. Use the <code class="docutils literal notranslate"><span class="pre">mindvision.dataset.DownLoad</span></code> API to download the dataset and decompress it to the current directory.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindvision.dataset</span> <span class="kn">import</span> <span class="n">DownLoad</span>

<span class="n">dataset_url</span> <span class="o">=</span> <span class="s2">&quot;https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/notebook/datasets/intermediate/Canidae_data.zip&quot;</span>
<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;./&quot;</span>

<span class="n">dl</span> <span class="o">=</span> <span class="n">DownLoad</span><span class="p">()</span>
<span class="n">dl</span><span class="o">.</span><span class="n">download_and_extract_archive</span><span class="p">(</span><span class="n">dataset_url</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
<p>The dataset directory structure is as follows:</p>
<div class="highlight-Text notranslate"><div class="highlight"><pre><span></span>data/
└── Canidae
    ├── train
    │   ├── dogs
    │   └── wolves
    └── val
        ├── dogs
        └── wolves
</pre></div>
</div>
</div>
</div>
<div class="section" id="loading-a-dataset">
<h2>Loading a Dataset<a class="headerlink" href="#loading-a-dataset" title="Permalink to this headline">¶</a></h2>
<p>The wolf and dog dataset is extracted from the ImageNet classification dataset. The <code class="docutils literal notranslate"><span class="pre">mindvision.dataset.ImageNet</span></code> API is used to load the dataset. This API has performed the default image augmentation operation on the images in the ImageNet classification dataset.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindvision.dataset</span> <span class="kn">import</span> <span class="n">ImageNet</span>

<span class="c1"># Dataset directory path</span>
<span class="n">data_path</span> <span class="o">=</span> <span class="s2">&quot;./data/Canidae/&quot;</span>

<span class="c1"># Create a training dataset.</span>
<span class="n">dataset_train</span> <span class="o">=</span> <span class="n">ImageNet</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                         <span class="n">resize</span><span class="o">=</span><span class="mi">224</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">repeat_num</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">dataset_train</span> <span class="o">=</span> <span class="n">dataset_train</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

<span class="c1"># Create an evaluation dataset.</span>
<span class="n">dataset_val</span> <span class="o">=</span> <span class="n">ImageNet</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s2">&quot;val&quot;</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                       <span class="n">resize</span><span class="o">=</span><span class="mi">224</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">repeat_num</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">dataset_val</span> <span class="o">=</span> <span class="n">dataset_val</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<div class="section" id="dataset-visualization">
<h3>Dataset Visualization<a class="headerlink" href="#dataset-visualization" title="Permalink to this headline">¶</a></h3>
<p>The return value of the training dataset loaded from the <code class="docutils literal notranslate"><span class="pre">mindvision.dataset.ImageNet</span></code> API is a dictionary. You can use the <code class="docutils literal notranslate"><span class="pre">create_dict_iterator</span></code> API to create a data iterator and use <code class="docutils literal notranslate"><span class="pre">next</span></code> to iteratively access the dataset. Here, <code class="docutils literal notranslate"><span class="pre">batch_size</span></code> is set to <strong>18</strong>. Therefore, you can use <code class="docutils literal notranslate"><span class="pre">next</span></code> to obtain 18 images and label data can be obtained at a time.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">dataset_train</span><span class="o">.</span><span class="n">create_dict_iterator</span><span class="p">())</span>
<span class="n">images</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tensor of image&quot;</span><span class="p">,</span> <span class="n">images</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Labels:&quot;</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">Tensor</span> <span class="n">of</span> <span class="n">image</span> <span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">)</span>
    <span class="n">Labels</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>Visualize the obtained images and label data. The title is a label name corresponding to an image.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># **class_name** corresponds to **label**. Labels are marked in ascending order of the folder character string.</span>
<span class="n">class_name</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;dogs&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;wolves&quot;</span><span class="p">}</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)):</span>
    <span class="c1"># Obtain an image and its label.</span>
    <span class="n">data_image</span> <span class="o">=</span> <span class="n">images</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">()</span>
    <span class="n">data_label</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="c1"># Process images for display.</span>
    <span class="n">data_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">data_image</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.485</span><span class="p">,</span> <span class="mf">0.456</span><span class="p">,</span> <span class="mf">0.406</span><span class="p">])</span>
    <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.229</span><span class="p">,</span> <span class="mf">0.224</span><span class="p">,</span> <span class="mf">0.225</span><span class="p">])</span>
    <span class="n">data_image</span> <span class="o">=</span> <span class="n">std</span> <span class="o">*</span> <span class="n">data_image</span> <span class="o">+</span> <span class="n">mean</span>
    <span class="n">data_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">data_image</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1"># Display the image.</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data_image</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">class_name</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">())])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p><img alt="png" src="../_images/output_8_0.png" /></p>
</div>
</div>
<div class="section" id="training-a-model">
<h2>Training a Model<a class="headerlink" href="#training-a-model" title="Permalink to this headline">¶</a></h2>
<p>The following uses the ResNet-50 model for training. Use the <code class="docutils literal notranslate"><span class="pre">mindvision.classification.models.resnet50</span></code> API in MindSpore Vision to define the ResNet-50. When the <code class="docutils literal notranslate"><span class="pre">pretrained</span></code> parameter in the API is set to <strong>True</strong>, <a class="reference external" href="https://download.mindspore.cn/vision/classification/resnet50_224.ckpt">the ResNet-50 pre-trained model</a> is automatically downloaded and the weight parameter is loaded to the network.</p>
<div class="section" id="fine-tuning-the-model">
<h3>Fine-tuning the Model<a class="headerlink" href="#fine-tuning-the-model" title="Permalink to this headline">¶</a></h3>
<p>The pre-trained model in ResNet-50 is used to classify 1000 categories in the ImageNet dataset. Here, only the wolves and dogs are classified. Therefore, you need to reset the classifier in the pre-trained model and fine-tune the network.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore.nn</span> <span class="k">as</span> <span class="nn">nn</span>
<span class="kn">from</span> <span class="nn">mindvision.classification.models</span> <span class="kn">import</span> <span class="n">resnet50</span>
<span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>

<span class="n">net</span> <span class="o">=</span> <span class="n">resnet50</span><span class="p">(</span><span class="n">pretrained</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Define a fully-connected layer.</span>
<span class="k">class</span> <span class="nc">DenseHead</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_channel</span><span class="p">,</span> <span class="n">num_classes</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DenseHead</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dense</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">input_channel</span><span class="p">,</span> <span class="n">num_classes</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dense</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># Size of the input layer of the fully-connected layer</span>
<span class="n">in_channels</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">dense</span><span class="o">.</span><span class="n">in_channels</span>
<span class="c1"># The number of output channels is 2.</span>
<span class="n">head</span> <span class="o">=</span> <span class="n">DenseHead</span><span class="p">(</span><span class="n">in_channels</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="c1"># Reset the fully-connected layer.</span>
<span class="n">net</span><span class="o">.</span><span class="n">head</span> <span class="o">=</span> <span class="n">head</span>

<span class="c1"># Define an optimizer and a loss function.</span>
<span class="n">opt</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Momentum</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">net</span><span class="o">.</span><span class="n">trainable_params</span><span class="p">(),</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
<span class="n">loss</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">SoftmaxCrossEntropyWithLogits</span><span class="p">(</span><span class="n">sparse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">reduction</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>

<span class="c1"># Instantiate the model.</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">loss</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Accuracy&quot;</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Accuracy</span><span class="p">()})</span>
</pre></div>
</div>
<div class="section" id="training-and-evaluation">
<h4>Training and Evaluation<a class="headerlink" href="#training-and-evaluation" title="Permalink to this headline">¶</a></h4>
<p>Train and evaluate the network, and use the <code class="docutils literal notranslate"><span class="pre">mindvision.engine.callback.ValAccMonitor</span></code> API in MindSpore Vision to print the loss value and the evaluation accuracy of the training. After the training is completed, save the CKPT file with the highest evaluation accuracy, <code class="docutils literal notranslate"><span class="pre">best.ckpt</span></code>, in the current directory.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindvision.engine.callback</span> <span class="kn">import</span> <span class="n">ValAccMonitor</span>
<span class="kn">from</span> <span class="nn">mindspore.train.callback</span> <span class="kn">import</span> <span class="n">TimeMonitor</span>

<span class="n">num_epochs</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">num_epochs</span><span class="p">,</span>
            <span class="n">dataset_train</span><span class="p">,</span>
            <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">ValAccMonitor</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">dataset_val</span><span class="p">,</span> <span class="n">num_epochs</span><span class="p">),</span> <span class="n">TimeMonitor</span><span class="p">()])</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="o">--------------------</span>
    <span class="n">Epoch</span><span class="p">:</span> <span class="p">[</span>  <span class="mi">0</span> <span class="o">/</span>  <span class="mi">10</span><span class="p">],</span> <span class="n">Train</span> <span class="n">Loss</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.469</span><span class="p">],</span> <span class="n">Accuracy</span><span class="p">:</span>  <span class="mf">1.000</span>
    <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">6525.242</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">501.942</span> <span class="n">ms</span>
    <span class="o">--------------------</span>
    <span class="n">Epoch</span><span class="p">:</span> <span class="p">[</span>  <span class="mi">1</span> <span class="o">/</span>  <span class="mi">10</span><span class="p">],</span> <span class="n">Train</span> <span class="n">Loss</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.134</span><span class="p">],</span> <span class="n">Accuracy</span><span class="p">:</span>  <span class="mf">1.000</span>
    <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">2549.441</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">196.111</span> <span class="n">ms</span>
    <span class="o">--------------------</span>
    <span class="n">Epoch</span><span class="p">:</span> <span class="p">[</span>  <span class="mi">2</span> <span class="o">/</span>  <span class="mi">10</span><span class="p">],</span> <span class="n">Train</span> <span class="n">Loss</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.069</span><span class="p">],</span> <span class="n">Accuracy</span><span class="p">:</span>  <span class="mf">1.000</span>
    <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">2561.402</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">197.031</span> <span class="n">ms</span>
    <span class="o">--------------------</span>
    <span class="n">Epoch</span><span class="p">:</span> <span class="p">[</span>  <span class="mi">3</span> <span class="o">/</span>  <span class="mi">10</span><span class="p">],</span> <span class="n">Train</span> <span class="n">Loss</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.131</span><span class="p">],</span> <span class="n">Accuracy</span><span class="p">:</span>  <span class="mf">1.000</span>
    <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">2564.437</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">197.264</span> <span class="n">ms</span>
    <span class="o">--------------------</span>
    <span class="n">Epoch</span><span class="p">:</span> <span class="p">[</span>  <span class="mi">4</span> <span class="o">/</span>  <span class="mi">10</span><span class="p">],</span> <span class="n">Train</span> <span class="n">Loss</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.097</span><span class="p">],</span> <span class="n">Accuracy</span><span class="p">:</span>  <span class="mf">1.000</span>
    <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">2563.061</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">197.159</span> <span class="n">ms</span>
    <span class="o">--------------------</span>
    <span class="n">Epoch</span><span class="p">:</span> <span class="p">[</span>  <span class="mi">5</span> <span class="o">/</span>  <span class="mi">10</span><span class="p">],</span> <span class="n">Train</span> <span class="n">Loss</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.037</span><span class="p">],</span> <span class="n">Accuracy</span><span class="p">:</span>  <span class="mf">1.000</span>
    <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">2569.943</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">197.688</span> <span class="n">ms</span>
    <span class="o">--------------------</span>
    <span class="n">Epoch</span><span class="p">:</span> <span class="p">[</span>  <span class="mi">6</span> <span class="o">/</span>  <span class="mi">10</span><span class="p">],</span> <span class="n">Train</span> <span class="n">Loss</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.011</span><span class="p">],</span> <span class="n">Accuracy</span><span class="p">:</span>  <span class="mf">1.000</span>
    <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">2577.678</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">198.283</span> <span class="n">ms</span>
    <span class="o">--------------------</span>
    <span class="n">Epoch</span><span class="p">:</span> <span class="p">[</span>  <span class="mi">7</span> <span class="o">/</span>  <span class="mi">10</span><span class="p">],</span> <span class="n">Train</span> <span class="n">Loss</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.018</span><span class="p">],</span> <span class="n">Accuracy</span><span class="p">:</span>  <span class="mf">1.000</span>
    <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">2574.261</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">198.020</span> <span class="n">ms</span>
    <span class="o">--------------------</span>
    <span class="n">Epoch</span><span class="p">:</span> <span class="p">[</span>  <span class="mi">8</span> <span class="o">/</span>  <span class="mi">10</span><span class="p">],</span> <span class="n">Train</span> <span class="n">Loss</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.036</span><span class="p">],</span> <span class="n">Accuracy</span><span class="p">:</span>  <span class="mf">1.000</span>
    <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">2568.633</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">197.587</span> <span class="n">ms</span>
    <span class="o">--------------------</span>
    <span class="n">Epoch</span><span class="p">:</span> <span class="p">[</span> <span class="mi">9</span> <span class="o">/</span>  <span class="mi">10</span><span class="p">],</span> <span class="n">Train</span> <span class="n">Loss</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.016</span><span class="p">],</span> <span class="n">Accuracy</span><span class="p">:</span>  <span class="mf">1.000</span>
    <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">2558.043</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">196.773</span> <span class="n">ms</span>
    <span class="o">================================================================================</span>
    <span class="n">End</span> <span class="n">of</span> <span class="n">validation</span> <span class="n">the</span> <span class="n">best</span> <span class="n">Accuracy</span> <span class="ow">is</span><span class="p">:</span>  <span class="mf">1.000</span><span class="p">,</span> <span class="n">save</span> <span class="n">the</span> <span class="n">best</span> <span class="n">ckpt</span> <span class="n">file</span> <span class="ow">in</span> <span class="o">./</span><span class="n">best</span><span class="o">.</span><span class="n">ckpt</span>
</pre></div>
</div>
</div>
<div class="section" id="visualizing-model-prediction">
<h4>Visualizing Model Prediction<a class="headerlink" href="#visualizing-model-prediction" title="Permalink to this headline">¶</a></h4>
<p>Define the <code class="docutils literal notranslate"><span class="pre">visualize_mode</span></code> function to visualize model prediction.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>


<span class="k">def</span> <span class="nf">visualize_model</span><span class="p">(</span><span class="n">best_ckpt_path</span><span class="p">,</span> <span class="n">val_ds</span><span class="p">):</span>
    <span class="n">num_class</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Perform binary classification on wolf and dog images.</span>
    <span class="n">net</span> <span class="o">=</span> <span class="n">resnet50</span><span class="p">(</span><span class="n">num_class</span><span class="p">)</span>
    <span class="c1"># Load model parameters.</span>
    <span class="n">param_dict</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">load_checkpoint</span><span class="p">(</span><span class="n">best_ckpt_path</span><span class="p">)</span>
    <span class="n">ms</span><span class="o">.</span><span class="n">load_param_into_net</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">param_dict</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
    <span class="c1"># Load the validation dataset.</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">val_ds</span><span class="o">.</span><span class="n">create_dict_iterator</span><span class="p">())</span>
    <span class="n">images</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">()</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">()</span>
    <span class="n">class_name</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;dogs&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;wolves&quot;</span><span class="p">}</span>
    <span class="c1"># Predict the image type.</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">]))</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Display the image and the predicted value of the image.</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># If the prediction is correct, the color is blue. If the prediction is incorrect, the color is red.</span>
        <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span> <span class="k">if</span> <span class="n">pred</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">else</span> <span class="s1">&#39;red&#39;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;predict:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">class_name</span><span class="p">[</span><span class="n">pred</span><span class="p">[</span><span class="n">i</span><span class="p">]]),</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
        <span class="n">picture_show</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">images</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.485</span><span class="p">,</span> <span class="mf">0.456</span><span class="p">,</span> <span class="mf">0.406</span><span class="p">])</span>
        <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.229</span><span class="p">,</span> <span class="mf">0.224</span><span class="p">,</span> <span class="mf">0.225</span><span class="p">])</span>
        <span class="n">picture_show</span> <span class="o">=</span> <span class="n">std</span> <span class="o">*</span> <span class="n">picture_show</span> <span class="o">+</span> <span class="n">mean</span>
        <span class="n">picture_show</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">picture_show</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">picture_show</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>Obtain the <strong>best.ckpt</strong> file by model fine-tuning and predict the wolf and dog image data of the validation set. If the prediction font is blue, the prediction is correct. If the prediction font is red, the prediction is incorrect.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">visualize_model</span><span class="p">(</span><span class="s1">&#39;best.ckpt&#39;</span><span class="p">,</span> <span class="n">dataset_val</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="png" src="../_images/output_16_0.png" /></p>
</div>
</div>
<div class="section" id="training-using-fixed-features">
<h3>Training Using Fixed Features<a class="headerlink" href="#training-using-fixed-features" title="Permalink to this headline">¶</a></h3>
<p>When fixed features are used for training, all network layers except the last layer need to be frozen. You can set <code class="docutils literal notranslate"><span class="pre">requires_grad</span> <span class="pre">==</span> <span class="pre">False</span></code> to freeze parameters so that the gradient is not computed in backward propagation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore.nn</span> <span class="k">as</span> <span class="nn">nn</span>
<span class="kn">from</span> <span class="nn">mindvision.classification.models</span> <span class="kn">import</span> <span class="n">resnet50</span>
<span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>

<span class="n">net_work</span> <span class="o">=</span> <span class="n">resnet50</span><span class="p">(</span><span class="n">pretrained</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Size of the input layer of the fully-connected layer</span>
<span class="n">in_channels</span> <span class="o">=</span> <span class="n">net_work</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">dense</span><span class="o">.</span><span class="n">in_channels</span>
<span class="c1"># The number of output channels is 2.</span>
<span class="n">head</span> <span class="o">=</span> <span class="n">DenseHead</span><span class="p">(</span><span class="n">in_channels</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="c1"># Reset the fully-connected layer.</span>
<span class="n">net_work</span><span class="o">.</span><span class="n">head</span> <span class="o">=</span> <span class="n">head</span>

<span class="c1"># Freeze all parameters except those at the last layer.</span>
<span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">net_work</span><span class="o">.</span><span class="n">get_parameters</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;head.dense.weight&quot;</span><span class="p">,</span> <span class="s2">&quot;head.dense.bias&quot;</span><span class="p">]:</span>
        <span class="n">param</span><span class="o">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># Define an optimizer and a loss function.</span>
<span class="n">opt</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Momentum</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">net_work</span><span class="o">.</span><span class="n">trainable_params</span><span class="p">(),</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">loss</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">SoftmaxCrossEntropyWithLogits</span><span class="p">(</span><span class="n">sparse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">reduction</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>

<span class="c1"># Instantiate the model.</span>
<span class="n">model1</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">net_work</span><span class="p">,</span> <span class="n">loss</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Accuracy&quot;</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Accuracy</span><span class="p">()})</span>
</pre></div>
</div>
<div class="section" id="training-and-evaluation-1">
<h4>Training and Evaluation<a class="headerlink" href="#training-and-evaluation-1" title="Permalink to this headline">¶</a></h4>
<p>Start to train a model. This saves more than half of the time compared with not pre-training a model because some gradients do not need to be computed at this time.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Dataset used for training</span>
<span class="kn">from</span> <span class="nn">mindvision.engine.callback</span> <span class="kn">import</span> <span class="n">ValAccMonitor</span>
<span class="kn">from</span> <span class="nn">mindspore.train.callback</span> <span class="kn">import</span> <span class="n">TimeMonitor</span>

<span class="n">ds_train</span> <span class="o">=</span> <span class="n">ImageNet</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">resize</span><span class="o">=</span><span class="mi">224</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">repeat_num</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ds_train</span> <span class="o">=</span> <span class="n">ds_train</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">ds_val</span> <span class="o">=</span> <span class="n">ImageNet</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s2">&quot;val&quot;</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">resize</span><span class="o">=</span><span class="mi">224</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">repeat_num</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ds_val</span> <span class="o">=</span> <span class="n">ds_val</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

<span class="n">num_epochs</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">model1</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">num_epochs</span><span class="p">,</span>
             <span class="n">ds_train</span><span class="p">,</span>
             <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">ValAccMonitor</span><span class="p">(</span><span class="n">model1</span><span class="p">,</span> <span class="n">ds_val</span><span class="p">,</span> <span class="n">num_epochs</span><span class="p">),</span> <span class="n">TimeMonitor</span><span class="p">()])</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="o">--------------------</span>
    <span class="n">Epoch</span><span class="p">:</span> <span class="p">[</span>  <span class="mi">1</span> <span class="o">/</span>  <span class="mi">10</span><span class="p">],</span> <span class="n">Train</span> <span class="n">Loss</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.598</span><span class="p">],</span> <span class="n">Accuracy</span><span class="p">:</span>  <span class="mf">0.981</span>
    <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">3602.971</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">277.152</span> <span class="n">ms</span>
    <span class="o">--------------------</span>
    <span class="n">Epoch</span><span class="p">:</span> <span class="p">[</span>  <span class="mi">2</span> <span class="o">/</span>  <span class="mi">10</span><span class="p">],</span> <span class="n">Train</span> <span class="n">Loss</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.516</span><span class="p">],</span> <span class="n">Accuracy</span><span class="p">:</span>  <span class="mf">0.870</span>
    <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">1422.890</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">109.453</span> <span class="n">ms</span>
    <span class="o">--------------------</span>
    <span class="n">Epoch</span><span class="p">:</span> <span class="p">[</span>  <span class="mi">3</span> <span class="o">/</span>  <span class="mi">10</span><span class="p">],</span> <span class="n">Train</span> <span class="n">Loss</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.388</span><span class="p">],</span> <span class="n">Accuracy</span><span class="p">:</span>  <span class="mf">1.000</span>
    <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">2254.670</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">173.436</span> <span class="n">ms</span>
    <span class="o">--------------------</span>
    <span class="n">Epoch</span><span class="p">:</span> <span class="p">[</span>  <span class="mi">4</span> <span class="o">/</span>  <span class="mi">10</span><span class="p">],</span> <span class="n">Train</span> <span class="n">Loss</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.362</span><span class="p">],</span> <span class="n">Accuracy</span><span class="p">:</span>  <span class="mf">1.000</span>
    <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">2181.150</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">167.781</span> <span class="n">ms</span>
    <span class="o">--------------------</span>
    <span class="n">Epoch</span><span class="p">:</span> <span class="p">[</span>  <span class="mi">5</span> <span class="o">/</span>  <span class="mi">10</span><span class="p">],</span> <span class="n">Train</span> <span class="n">Loss</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.332</span><span class="p">],</span> <span class="n">Accuracy</span><span class="p">:</span>  <span class="mf">1.000</span>
    <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">2173.812</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">167.216</span> <span class="n">ms</span>
    <span class="o">--------------------</span>
    <span class="n">Epoch</span><span class="p">:</span> <span class="p">[</span>  <span class="mi">6</span> <span class="o">/</span>  <span class="mi">10</span><span class="p">],</span> <span class="n">Train</span> <span class="n">Loss</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.306</span><span class="p">],</span> <span class="n">Accuracy</span><span class="p">:</span>  <span class="mf">1.000</span>
    <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">2205.381</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">169.645</span> <span class="n">ms</span>
    <span class="o">--------------------</span>
    <span class="n">Epoch</span><span class="p">:</span> <span class="p">[</span>  <span class="mi">7</span> <span class="o">/</span>  <span class="mi">10</span><span class="p">],</span> <span class="n">Train</span> <span class="n">Loss</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.285</span><span class="p">],</span> <span class="n">Accuracy</span><span class="p">:</span>  <span class="mf">1.000</span>
    <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">2180.671</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">167.744</span> <span class="n">ms</span>
    <span class="o">--------------------</span>
    <span class="n">Epoch</span><span class="p">:</span> <span class="p">[</span>  <span class="mi">8</span> <span class="o">/</span>  <span class="mi">10</span><span class="p">],</span> <span class="n">Train</span> <span class="n">Loss</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.244</span><span class="p">],</span> <span class="n">Accuracy</span><span class="p">:</span>  <span class="mf">1.000</span>
    <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">2166.159</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">166.628</span> <span class="n">ms</span>
    <span class="o">--------------------</span>
    <span class="n">Epoch</span><span class="p">:</span> <span class="p">[</span>  <span class="mi">9</span> <span class="o">/</span>  <span class="mi">10</span><span class="p">],</span> <span class="n">Train</span> <span class="n">Loss</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.259</span><span class="p">],</span> <span class="n">Accuracy</span><span class="p">:</span>  <span class="mf">1.000</span>
    <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">2169.718</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">166.901</span> <span class="n">ms</span>
    <span class="o">--------------------</span>
    <span class="n">Epoch</span><span class="p">:</span> <span class="p">[</span> <span class="mi">10</span> <span class="o">/</span>  <span class="mi">10</span><span class="p">],</span> <span class="n">Train</span> <span class="n">Loss</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.280</span><span class="p">],</span> <span class="n">Accuracy</span><span class="p">:</span>  <span class="mf">1.000</span>
    <span class="n">epoch</span> <span class="n">time</span><span class="p">:</span> <span class="mf">2182.844</span> <span class="n">ms</span><span class="p">,</span> <span class="n">per</span> <span class="n">step</span> <span class="n">time</span><span class="p">:</span> <span class="mf">167.911</span> <span class="n">ms</span>
    <span class="o">================================================================================</span>
    <span class="n">End</span> <span class="n">of</span> <span class="n">validation</span> <span class="n">the</span> <span class="n">best</span> <span class="n">Accuracy</span> <span class="ow">is</span><span class="p">:</span>  <span class="mf">1.000</span><span class="p">,</span> <span class="n">save</span> <span class="n">the</span> <span class="n">best</span> <span class="n">ckpt</span> <span class="n">file</span> <span class="ow">in</span> <span class="o">./</span><span class="n">best</span><span class="o">.</span><span class="n">ckpt</span>
</pre></div>
</div>
</div>
<div class="section" id="visualizing-model-prediction-1">
<h4>Visualizing Model Prediction<a class="headerlink" href="#visualizing-model-prediction-1" title="Permalink to this headline">¶</a></h4>
<p>Obtain the <strong>best.ckpt</strong> file from fixed features and predict the wolf and dog image data of the validation set. If the prediction font is blue, the prediction is correct. If the prediction font is red, the prediction is incorrect.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">visualize_model</span><span class="p">(</span><span class="s1">&#39;best.ckpt&#39;</span><span class="p">,</span> <span class="n">dataset_val</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="png" src="../_images/output_22_0.png" /></p>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="fgsm.html" class="btn btn-neutral float-right" title="Model Adversarial Attack" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="resnet50.html" class="btn btn-neutral float-left" title="ResNet-50 for Image Classification" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2022, MindSpore.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   
	<script async="async" src="https://cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>