

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Supporting Python Objects in Dataset Pipeline &mdash; MindSpore master documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/bootstrap.min.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/training.css" type="text/css" />
   
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  
  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/js/training.js"></script>
        
        
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Advanced Automatic Differentiation" href="../derivation.html" />
    <link rel="prev" title="Graph Data Loading and Processing" href="augment_graph_data.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> MindSpore
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Quick Start</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../beginner/introduction.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../beginner/quick_start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../beginner/tensor.html">Tensor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../beginner/dataset.html">Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../beginner/transforms.html">Transforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../beginner/model.html">Building a Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../beginner/autograd.html">Automatic Differentiation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../beginner/train.html">Model Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../beginner/save_load.html">Saving and Loading the Model</a></li>
</ul>
<p class="caption"><span class="caption-text">Advanced</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../model.html">Advanced Encapsulation: Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">Model Module Customization</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../dataset.html">Advanced Data Processing</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="sampler.html">Data Sampling</a></li>
<li class="toctree-l2"><a class="reference internal" href="record.html">Converting Dataset to MindRecord</a></li>
<li class="toctree-l2"><a class="reference internal" href="eager.html">Lightweight Data Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="augment_graph_data.html">Graph Data Loading and Processing</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Supporting Python Objects in Dataset Pipeline</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../derivation.html">Advanced Automatic Differentiation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compute_graph.html">Computational Graph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mixed_precision.html">Automatic Mix Precision</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">MindSpore</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../dataset.html">Advanced Data Processing</a> &raquo;</li>
        
      <li>Supporting Python Objects in Dataset Pipeline</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/advanced/dataset/python_objects.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <p><a href="https://gitee.com/mindspore/docs/blob/master/tutorials/source_en/advanced/dataset/python_objects.md" target="_blank"><img src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/master/resource/_static/logo_source_en.png"></a></p>
<div class="section" id="supporting-python-objects-in-dataset-pipeline">
<h1>Supporting Python Objects in Dataset Pipeline<a class="headerlink" href="#supporting-python-objects-in-dataset-pipeline" title="Permalink to this headline">¶</a></h1>
<p>Dataset pipeline accepts Python dictionaries as a distinct input type for some operations. The main difference compared to other types is that Python dictionaries will not be converted to a C++ equivalent, and instead a reference will be maintained in the pipeline.</p>
<p>Note that while currently only <code class="docutils literal notranslate"><span class="pre">dict</span></code> objects are supported and can be passed to the pipeline, you may wrap other Python types inside a dictionary and send them to Dataset pipeline to achieve the same behavior.</p>
<div class="section" id="handling-python-dict-objects">
<h2>Handling Python <code class="docutils literal notranslate"><span class="pre">dict</span></code> Objects<a class="headerlink" href="#handling-python-dict-objects" title="Permalink to this headline">¶</a></h2>
<div class="section" id="sending-python-dict-to-dataset-pipeline">
<h3>Sending Python <code class="docutils literal notranslate"><span class="pre">dict</span></code> to Dataset Pipeline<a class="headerlink" href="#sending-python-dict-to-dataset-pipeline" title="Permalink to this headline">¶</a></h3>
<p>Sending Python <code class="docutils literal notranslate"><span class="pre">dict</span></code> objects to the Dataset pipeline is possible through different methods:</p>
<ol class="simple">
<li><p>using a <code class="docutils literal notranslate"><span class="pre">GeneratorDataset</span></code>, the user can customize it to return a <code class="docutils literal notranslate"><span class="pre">dict</span></code> object, or</p></li>
<li><p>within a pyfunc used in a <code class="docutils literal notranslate"><span class="pre">map</span></code> operation, the user can customize it to return a <code class="docutils literal notranslate"><span class="pre">dict</span></code> object, or</p></li>
<li><p>similarly, customize the <code class="docutils literal notranslate"><span class="pre">per_batch_map</span></code> function of a <code class="docutils literal notranslate"><span class="pre">batch</span></code> operation to return a <code class="docutils literal notranslate"><span class="pre">dict</span></code> object.</p></li>
</ol>
</div>
<div class="section" id="consuming-python-dict-from-dataset-pipeline">
<h3>Consuming Python <code class="docutils literal notranslate"><span class="pre">dict</span></code> from Dataset Pipeline<a class="headerlink" href="#consuming-python-dict-from-dataset-pipeline" title="Permalink to this headline">¶</a></h3>
<p>When sending data to the model (or using a standalone iterator), Dataset pipeline attempts to convert all <em>values</em> inside <code class="docutils literal notranslate"><span class="pre">dict</span></code> objects to NumPy arrays (and later to <code class="docutils literal notranslate"><span class="pre">Tensor</span></code> if <code class="docutils literal notranslate"><span class="pre">output_numpy</span></code> is set to <code class="docutils literal notranslate"><span class="pre">False</span></code>). This means that all numerical and string values will be converted to arrays.</p>
<p>Note that this step will be applied recursively to all <em>values</em> inside nested dictionaries as well as all <em>elements</em> inside lists and tuples.</p>
<p>For other types that cannot be converted to NumPy arrays (such as class objects), they are passed directly.</p>
<blockquote>
<div><p>This feature is currently only supported when <code class="docutils literal notranslate"><span class="pre">dataset_sink_mode</span></code> is set to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</div></blockquote>
</div>
</div>
<div class="section" id="generatordataset">
<h2>GeneratorDataset<a class="headerlink" href="#generatordataset" title="Permalink to this headline">¶</a></h2>
<p>Each dictionary is considered as one column, whereas there is no limit on the internal items it stores (number and type of keys/values).
Here is an example of sending <code class="docutils literal notranslate"><span class="pre">dict</span></code> objects to the Dataset pipeline using <code class="docutils literal notranslate"><span class="pre">GeneratorDataset</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore.dataset</span> <span class="k">as</span> <span class="nn">ds</span>

<span class="k">def</span> <span class="nf">my_generator</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">col1</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;number&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;square&quot;</span><span class="p">:</span> <span class="n">i</span> <span class="o">**</span> <span class="mi">2</span><span class="p">}</span>
        <span class="n">col2</span> <span class="o">=</span> <span class="n">i</span>
        <span class="k">yield</span> <span class="p">(</span><span class="n">col1</span><span class="p">,</span> <span class="n">col2</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">GeneratorDataset</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">my_generator</span><span class="p">,</span> <span class="n">column_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;col1&quot;</span><span class="p">,</span> <span class="s2">&quot;col2&quot;</span><span class="p">])</span>

<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">create_dict_iterator</span><span class="p">(</span><span class="n">num_epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">output_numpy</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;col1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;number&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;square&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span> <span class="s1">&#39;col2&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int64</span><span class="p">)}</span>
<span class="p">{</span><span class="s1">&#39;col1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;number&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;square&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span> <span class="s1">&#39;col2&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int64</span><span class="p">)}</span>
<span class="p">{</span><span class="s1">&#39;col1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;number&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;square&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">(</span><span class="mi">4</span><span class="p">)},</span> <span class="s1">&#39;col2&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int64</span><span class="p">)}</span>
<span class="p">{</span><span class="s1">&#39;col1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;number&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="s1">&#39;square&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">(</span><span class="mi">9</span><span class="p">)},</span> <span class="s1">&#39;col2&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int64</span><span class="p">)}</span>
<span class="p">{</span><span class="s1">&#39;col1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;number&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="s1">&#39;square&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">(</span><span class="mi">16</span><span class="p">)},</span> <span class="s1">&#39;col2&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int64</span><span class="p">)}</span>
</pre></div>
</div>
</div>
<div class="section" id="map-operation">
<h2>Map Operation<a class="headerlink" href="#map-operation" title="Permalink to this headline">¶</a></h2>
<p>Similar to <code class="docutils literal notranslate"><span class="pre">GeneratorDataset</span></code>, each <code class="docutils literal notranslate"><span class="pre">dict</span></code> object is treated as one column and there is no limitation on its content.</p>
<blockquote>
<div><p>Except for user-defined functions, none of the existing Dataset pipeline transforms (<code class="docutils literal notranslate"><span class="pre">mindspore.dataset.transforms</span></code>) support inputs of type <code class="docutils literal notranslate"><span class="pre">dict</span></code>.</p>
</div></blockquote>
<p>Here is an example of adding <code class="docutils literal notranslate"><span class="pre">dict</span></code> objects to the Dataset pipeline using <code class="docutils literal notranslate"><span class="pre">map</span></code> operation and a pyfunc:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore.dataset</span> <span class="k">as</span> <span class="nn">ds</span>

<span class="k">def</span> <span class="nf">my_generator</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">i</span>

<span class="k">def</span> <span class="nf">my_pyfunc</span><span class="p">(</span><span class="n">col1</span><span class="p">):</span>
    <span class="n">new_col1</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;original_col1&quot;</span><span class="p">:</span> <span class="n">col1</span><span class="p">,</span> <span class="s2">&quot;square&quot;</span><span class="p">:</span> <span class="n">col1</span> <span class="o">**</span> <span class="mi">2</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">new_col1</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">GeneratorDataset</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">my_generator</span><span class="p">,</span> <span class="n">column_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;col1&quot;</span><span class="p">])</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">operations</span><span class="o">=</span><span class="n">my_pyfunc</span><span class="p">,</span> <span class="n">input_columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;col1&quot;</span><span class="p">])</span>

<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">create_dict_iterator</span><span class="p">(</span><span class="n">num_epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">output_numpy</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;col1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;original_col1&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;square&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">(</span><span class="mi">0</span><span class="p">)}}</span>
<span class="p">{</span><span class="s1">&#39;col1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;original_col1&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;square&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">(</span><span class="mi">1</span><span class="p">)}}</span>
<span class="p">{</span><span class="s1">&#39;col1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;original_col1&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;square&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">(</span><span class="mi">4</span><span class="p">)}}</span>
<span class="p">{</span><span class="s1">&#39;col1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;original_col1&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="s1">&#39;square&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">(</span><span class="mi">9</span><span class="p">)}}</span>
<span class="p">{</span><span class="s1">&#39;col1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;original_col1&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="s1">&#39;square&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">(</span><span class="mi">16</span><span class="p">)}}</span>
</pre></div>
</div>
</div>
<div class="section" id="batch-operation">
<h2>Batch Operation<a class="headerlink" href="#batch-operation" title="Permalink to this headline">¶</a></h2>
<p>When Batch operation is invoked on a dataset with a column containing dictionary objects, Dataset pipeline attempts to group corresponding values inside the dictionaries together. Thus, it is necessary for all the dictionaries to have identical keys.</p>
<p>If the user has provided a <code class="docutils literal notranslate"><span class="pre">per_batch_map</span></code> function, corresponding items inside the dictionaries (with respect to each key) will be grouped into Python lists.</p>
<p>If the user has not provided a <code class="docutils literal notranslate"><span class="pre">per_batch_map</span></code> function, corresponding items inside the dictionaries will be grouped into a NumPy array and the result of the Batch operation (for that column) will be one dictionary where all values are NumPy arrays. If such conversion results in an array of type <code class="docutils literal notranslate"><span class="pre">np.object_</span></code>, due to limitations on the model training side, an error message will be shown to the user and the Dataset pipeline terminates.</p>
<p>Also, note that if the <code class="docutils literal notranslate"><span class="pre">per_batch_map</span></code> returns a single <code class="docutils literal notranslate"><span class="pre">dict</span></code> for a column, it must return dictionaries for other columns as well.</p>
<p>Here is an example of adding <code class="docutils literal notranslate"><span class="pre">dict</span></code> objects to the Dataset pipeline using <code class="docutils literal notranslate"><span class="pre">batch</span></code> operation with a <code class="docutils literal notranslate"><span class="pre">per_batch_map</span></code> function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">mindspore.dataset</span> <span class="k">as</span> <span class="nn">ds</span>

<span class="k">def</span> <span class="nf">my_generator</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">i</span>

<span class="k">def</span> <span class="nf">my_per_batch_map</span><span class="p">(</span><span class="n">col1</span><span class="p">,</span> <span class="n">batch_info</span><span class="p">):</span>
    <span class="n">new_col1</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;original_col1&quot;</span><span class="p">:</span> <span class="n">col1</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">)}</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">new_col1</span><span class="p">,)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">GeneratorDataset</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">my_generator</span><span class="p">,</span> <span class="n">column_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;col1&quot;</span><span class="p">])</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">batch_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">per_batch_map</span><span class="o">=</span><span class="n">my_per_batch_map</span><span class="p">)</span>

<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">create_dict_iterator</span><span class="p">(</span><span class="n">num_epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">output_numpy</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;col1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;original_col1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">array</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">array</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">array</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">array</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">array</span><span class="p">(</span><span class="mi">4</span><span class="p">)],</span> <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])}}</span>
<span class="p">{</span><span class="s1">&#39;col1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;original_col1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">array</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">array</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">array</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span> <span class="n">array</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">array</span><span class="p">(</span><span class="mi">9</span><span class="p">)],</span> <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])}}</span>
<span class="p">{</span><span class="s1">&#39;col1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;original_col1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">array</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">array</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span> <span class="n">array</span><span class="p">(</span><span class="mi">12</span><span class="p">),</span> <span class="n">array</span><span class="p">(</span><span class="mi">13</span><span class="p">),</span> <span class="n">array</span><span class="p">(</span><span class="mi">14</span><span class="p">)],</span> <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])}}</span>
</pre></div>
</div>
<p>The following is a complex example demonstrating how to use a Python dictionary object with <code class="docutils literal notranslate"><span class="pre">GeneratorDataset</span></code>, <code class="docutils literal notranslate"><span class="pre">map</span></code> operation with a pyfunc and <code class="docutils literal notranslate"><span class="pre">batch</span></code> operation with no <code class="docutils literal notranslate"><span class="pre">per_batch_map</span></code> function. Note that since there is no <code class="docutils literal notranslate"><span class="pre">per_batch_map</span></code> in this code, a single NumPy array is returned for “powers” key.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">mindspore.dataset</span> <span class="k">as</span> <span class="nn">ds</span>

<span class="k">def</span> <span class="nf">my_generator</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">col1</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;nested_dict&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;powers&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])}}</span>
        <span class="n">col2</span> <span class="o">=</span> <span class="n">i</span>
        <span class="k">yield</span> <span class="p">(</span><span class="n">col1</span><span class="p">,</span> <span class="n">col2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">my_pyfunc</span><span class="p">(</span><span class="n">col1</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col1</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
    <span class="n">new_col1</span> <span class="o">=</span> <span class="n">col1</span><span class="p">[</span><span class="s2">&quot;nested_dict&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">new_col1</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">GeneratorDataset</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">my_generator</span><span class="p">,</span> <span class="n">column_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;col1&quot;</span><span class="p">,</span> <span class="s2">&quot;col2&quot;</span><span class="p">])</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">operations</span><span class="o">=</span><span class="n">my_pyfunc</span><span class="p">,</span> <span class="n">input_columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;col1&quot;</span><span class="p">])</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">batch_size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">create_dict_iterator</span><span class="p">(</span><span class="n">num_epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">output_numpy</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;col1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;powers&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([[</span> <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">],</span>
       <span class="p">[</span> <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">],</span>
       <span class="p">[</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">8</span><span class="p">],</span>
       <span class="p">[</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span> <span class="mi">27</span><span class="p">],</span>
       <span class="p">[</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">64</span><span class="p">]])},</span> <span class="s1">&#39;col2&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int64</span><span class="p">)}</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../derivation.html" class="btn btn-neutral float-right" title="Advanced Automatic Differentiation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="augment_graph_data.html" class="btn btn-neutral float-left" title="Graph Data Loading and Processing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2022, MindSpore.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   
	<script async="async" src="https://cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>