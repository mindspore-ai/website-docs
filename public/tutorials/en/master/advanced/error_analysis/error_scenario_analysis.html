<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Error Analysis &mdash; MindSpore master documentation</title>
      <link rel="stylesheet" href="../../_static/css/bootstrap.min.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/training.css" type="text/css" /><link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/js/training.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Common Data Processing Errors and Analysis Methods" href="minddata_debug.html" />
    <link rel="prev" title="Error Reporting Analysis" href="../error_analysis.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> MindSpore
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Quick Start</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../beginner/introduction.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../beginner/quick_start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../beginner/tensor.html">Tensor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../beginner/dataset.html">Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../beginner/transforms.html">Transforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../beginner/model.html">Building a Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../beginner/autograd.html">Automatic Differentiation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../beginner/train.html">Model Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../beginner/save_load.html">Saving and Loading the Model</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../model.html">Advanced Encapsulation: Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">Model Module Customization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dataset.html">Advanced Data Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../derivation.html">Advanced Automatic Differentiation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compute_graph.html">Computational Graph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mixed_precision.html">Automatic Mix Precision</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../error_analysis.html">Error Reporting Analysis</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Error Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="minddata_debug.html">Common Data Processing Errors and Analysis Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="mindrt_debug.html">Network Construction and Training Error Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="cann_error_cases.html">CANN Common Error Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="mindir.html">IR File Analysis</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">MindSpore</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../error_analysis.html">Error Reporting Analysis</a> &raquo;</li>
      <li>Error Analysis</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/advanced/error_analysis/error_scenario_analysis.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="error-analysis">
<h1>Error Analysis<a class="headerlink" href="#error-analysis" title="Permalink to this headline"></a></h1>
<p><a class="reference external" href="https://gitee.com/mindspore/docs/blob/master/tutorials/source_en/advanced/error_analysis/error_scenario_analysis.md"><img alt="View Source On Gitee" src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/master/resource/_static/logo_source_en.png" /></a>  </p>
<p>As mentioned before, error analysis refers to analyzing and inferring possible error causes based on the obtained network and framework information (such as error messages and network code).</p>
<p>During error analysis, the first step is to identify the scenario where the error occurs and determine whether the error is caused by data loading and processing or network construction and training. You can determine whether it is a data or network problem based on the format of the error message. In the distributed parallel scenario, you can use a single-device execution network for verification. If there is no data loading and processing or network construction and training problem, the error is caused by a parallel scenario problem. The following describes the error analysis methods in different scenarios.</p>
<section id="data-loading-and-processing-error-analysis">
<h2>Data Loading and Processing Error Analysis<a class="headerlink" href="#data-loading-and-processing-error-analysis" title="Permalink to this headline"></a></h2>
<p>When an error is reported during data processing, check whether C++ error messages are contained as shown in Figure 1. Typically, the name of the data processing operation using the C++ language is the same as that using Python. Therefore, you can determine the data processing operation that reports the error based on the error message and locate the error in the Python code.</p>
<p><img alt="minddata-errmsg" src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/master/tutorials/source_zh_cn/advanced/error_analysis/images/minddata_errmsg.png" /></p>
<p><em>Figure 1</em></p>
<p>As shown in the following figure, <code class="docutils literal notranslate"><span class="pre">batch_op.cc</span></code> reports a C++ error. The batch operation combines multiple consecutive pieces of data in a dataset into a batch for data processing, which is implemented at the backend. According to the error description, the input data does not meet the parameter requirements of the batch operation. Data to be batch operated has the same shape, and the sizes of different shapes are displayed.</p>
<p>Data loading and processing has three phases: data preparation, data loading, and data augmentation. The following table lists common errors.</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Error Type</p></th>
<th class="head"><p>Error Description</p></th>
<th class="head"><p>Case Analysis</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Data preparation error</p></td>
<td><p>The dataset is faulty, involving a path or MindRecord file problem.</p></td>
<td><p><a class="reference external" href="https://www.mindspore.cn/tutorials/en/master/advanced/error_analysis/minddata_debug.html">Error Case</a></p></td>
</tr>
<tr class="row-odd"><td><p>Data loading error</p></td>
<td><p>Incorrect resource configuration, customized loading method, or iterator usage in the data loading phase.</p></td>
<td><p><a class="reference external" href="https://www.mindspore.cn/tutorials/en/master/advanced/error_analysis/minddata_debug.html">Error Case</a></p></td>
</tr>
<tr class="row-even"><td><p>Data augmentation error</p></td>
<td><p>Unmatched data format/size, high resource usage, or multi-thread suspension.</p></td>
<td><p><a class="reference external" href="https://www.mindspore.cn/tutorials/en/master/advanced/error_analysis/minddata_debug.html">Error Case</a></p></td>
</tr>
</tbody>
</table>
</section>
<section id="network-construction-and-training-error-analysis">
<h2>Network Construction and Training Error Analysis<a class="headerlink" href="#network-construction-and-training-error-analysis" title="Permalink to this headline"></a></h2>
<p>The network construction and training process can be executed in the dynamic graph mode or static graph mode, and has two phases: build and execution. The error analysis method varies according to the execution phase in different modes.</p>
<p>The following table lists common network construction and training errors.</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Error Type</p></th>
<th class="head"><p>Error Description</p></th>
<th class="head"><p>Case Analysis</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Incorrect context configuration</p></td>
<td><p>An error occurs when the system configures the context.</p></td>
<td><p><a class="reference external" href="https://mindspore.cn/tutorials/en/master/advanced/error_analysis/mindrt_debug.html">Error Analysis</a></p></td>
</tr>
<tr class="row-odd"><td><p>Syntax error</p></td>
<td><p>Python syntax errors and MindSpore static graph syntax errors, such as unsupported control flow syntax and tensor slicing errors</p></td>
<td><p><a class="reference external" href="https://mindspore.cn/tutorials/en/master/advanced/error_analysis/mindrt_debug.html">Error Analysis</a></p></td>
</tr>
<tr class="row-even"><td><p>Operator build error</p></td>
<td><p>The operator parameter value, type, or shape does not meet the requirements, or the operator function is restricted.</p></td>
<td><p><a class="reference external" href="https://mindspore.cn/tutorials/en/master/advanced/error_analysis/mindrt_debug.html">Error Analysis</a></p></td>
</tr>
<tr class="row-odd"><td><p>Operator execution error</p></td>
<td><p>Input data exceptions, operator implementation errors, function restrictions, resource restrictions, etc.</p></td>
<td><p><a class="reference external" href="https://mindspore.cn/tutorials/en/master/advanced/error_analysis/mindrt_debug.html">Error Analysis</a></p></td>
</tr>
<tr class="row-even"><td><p>Insufficient resources</p></td>
<td><p>The device memory is insufficient, the number of function call stacks exceeds the threshold, and the number of flow resources exceeds the threshold.</p></td>
<td><p><a class="reference external" href="https://mindspore.cn/tutorials/en/master/advanced/error_analysis/mindrt_debug.html">Error Analysis</a></p></td>
</tr>
</tbody>
</table>
<section id="error-analysis-of-the-dynamic-graph-mode">
<h3>Error Analysis of the Dynamic Graph Mode<a class="headerlink" href="#error-analysis-of-the-dynamic-graph-mode" title="Permalink to this headline"></a></h3>
<p>In dynamic graph mode, the program is executed line by line according to the code writing sequence, and the execution result can be returned in time. Figure 2 shows the error message reported during dynamic graph build. The error message is from the Python frontend, indicating that the number of function parameters does not meet the requirements. Through the Python call stack, you can locate the error code: <code class="docutils literal notranslate"><span class="pre">c</span> <span class="pre">=</span> <span class="pre">self.mul(b,</span> <span class="pre">self.func(a,a,b))</span></code>.</p>
<p>Generally, the error message may contain <code class="docutils literal notranslate"><span class="pre">WARNING</span></code> logs. During error analysis, analyze the error message following Traceback first.</p>
<p><img alt="pynative-errmsg" src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/master/tutorials/source_zh_cn/advanced/error_analysis/images/pynative_errmsg.png" /></p>
<p><em>Figure 2</em></p>
<p>In dynamic graph mode, common network construction and training errors are found in environment configuration, Python syntax, and operator usage. The general analysis method is as follows:</p>
<ul class="simple">
<li><p>Determine the object where the error is reported based on the error description, for example, the operator API name.</p></li>
<li><p>Locate the code line where the error is reported based on the Python call stack information.</p></li>
<li><p>Analyze the code input data and calculation logic at the position where the error occurs, and find the error cause based on the description and specifications of the error object in the <a class="reference external" href="https://www.mindspore.cn/docs/en/master/api_python/mindspore.html">MindSpore API</a>.</p></li>
</ul>
</section>
<section id="error-analysis-of-the-static-graph-mode">
<h3>Error Analysis of the Static Graph Mode<a class="headerlink" href="#error-analysis-of-the-static-graph-mode" title="Permalink to this headline"></a></h3>
<p>In static graph mode, MindSpore builds the network structure into a computational graph, and then performs the computation operations involved in the graph. Therefore, errors reported in static graph mode include computational graph build errors and computational graph execution errors. Figure 3 shows the error message reported during computational graph build. When an error occurs, the <code class="docutils literal notranslate"><span class="pre">analyze_failed.ir</span></code> file is automatically saved to help analyze the location of the error code.</p>
<p><img alt="graph-errmsg" src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/master/tutorials/source_zh_cn/advanced/images/graph_errmsg.png" /></p>
<p><em>Figure 3</em></p>
<p>The general error analysis method in static graph mode is as follows:</p>
<p>Check whether the error is caused by graph build or graph execution based on the error description.</p>
<ul class="simple">
<li><p>If the error is reported during computational graph build, analyze the cause and location of the failure based on the error description and the <code class="docutils literal notranslate"><span class="pre">analyze_failed.ir</span></code> file automatically saved when the error occurs.</p></li>
<li><p>If the error is reported during computational graph execution, the error may be caused by insufficient resources or improper operator execution. You need to further distinguish the error based on the error message. If the error is reported during operator execution, locate the operator, use the dump function to save the input data of the operator, and analyze the cause of the error based on the input data.</p></li>
</ul>
<p>For details about how to analyze and infer the failure cause, see the analysis methods described in <a class="reference external" href="https://www.mindspore.cn/tutorials/en/master/advanced/error_analysis/mindir.html#how-to-derive-the-cause-of-the-failure-based-on-the-analyze-fail-ir-file-analysis-graph"><code class="docutils literal notranslate"><span class="pre">analyze_failed.ir</span></code></a>.</p>
<p>For details about how to use Dump to save the operator input data, see <a class="reference external" href="https://www.mindspore.cn/tutorials/experts/en/master/debug/dump.html">Dump Function Debugging</a>.</p>
</section>
</section>
<section id="distributed-parallel-error-analysis">
<h2>Distributed Parallel Error Analysis<a class="headerlink" href="#distributed-parallel-error-analysis" title="Permalink to this headline"></a></h2>
<p>MindSpore provides the distributed parallel training function and supports multiple parallel modes. The following table lists common distributed parallel training errors and possible causes.</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Error Type</p></th>
<th class="head"><p>Error Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Incorrect policy configuration</p></td>
<td><p>Incorrect operator logic.</p></td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p>Incorrect scalar policy configuration.</p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p>No policy configuration.</p></td>
</tr>
<tr class="row-odd"><td><p>Parallel script error</p></td>
<td><p>Incorrect script startup, or unmatched parallel configuration and startup task.</p></td>
</tr>
</tbody>
</table>
<section id="incorrect-policy-configuration">
<h3>Incorrect Policy Configuration<a class="headerlink" href="#incorrect-policy-configuration" title="Permalink to this headline"></a></h3>
<p>Policy check errors may be reported after you enable automatic parallelism using <code class="docutils literal notranslate"><span class="pre">mindspore.set_auto_parallel_context(parallel_mode=&quot;semi_auto_parallel&quot;)</span></code>. These policy check errors are reported due to specific operator slicing restrictions. The following uses three examples to describe how to analyze the three types of errors.</p>
<section id="incorrect-operator-logic">
<h4>Incorrect Operator Logic<a class="headerlink" href="#incorrect-operator-logic" title="Permalink to this headline"></a></h4>
<p>The error message is as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">ERROR</span><span class="p">]</span><span class="n">Check</span> <span class="n">StridedSliceInfo1414</span><span class="p">:</span> <span class="n">When</span> <span class="n">there</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">mask</span><span class="p">,</span> <span class="n">the</span> <span class="nb">input</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">supported</span> <span class="n">to</span> <span class="n">be</span> <span class="n">split</span>
</pre></div>
</div>
<p>The following shows a piece of possible error code where the network input is a [2, 4] tensor. The network is sliced to obtain the first half of dimension 0 in the input tensor. It is equivalent to the x[:1, :]operation in NumPy, where x is the input tensor. On the network, the (2,1) policy is configured for the stridedslice operator to slice dimension 0.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tensor</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)))</span>
<span class="n">stridedslice</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">StridedSlice</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">MyStridedSlice</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MyStridedSlice</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="n">stridedslice</span><span class="o">.</span><span class="n">shard</span><span class="p">(((</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),))</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># x is a two-dimensional tensor</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<p>Error cause:</p>
<p>The piece of code performs the slice operation on dimension 0. However, the configured policy (2,1) indicates that the slice operation is performed on both dimension 0 and dimension 1 of the input tensor. According to the description of operator slicing in the <a class="reference external" href="https://www.mindspore.cn/docs/en/master/note/operator_list_parallel.html">MindSpore API</a>,</p>
<blockquote>
<div><p>only the mask whose value is all 0s is supported. All dimensions that are sliced must be extracted together. The input dimensions whose strides is not set to 1 cannot be sliced.</p>
</div></blockquote>
<p>Dimensions that are sliced cannot be separately extracted. Therefore, the policy must be modified as follows:</p>
<p>Change the policy of dimension 0 from 2 to 1. In this way, dimension 0 will be sliced into one, that is, dimension 0 will not be sliced. Therefore, the policy meets the operator restrictions and the policy check is successful.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyStridedSlice</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MyStridedSlice</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="n">stridedslice</span><span class="o">.</span><span class="n">shard</span><span class="p">(((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),))</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># x is a two-dimensional tensor</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="incorrect-scalar-policy-configuration">
<h4>Incorrect Scalar Policy Configuration<a class="headerlink" href="#incorrect-scalar-policy-configuration" title="Permalink to this headline"></a></h4>
<p>Error message:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">ERROR</span><span class="p">]</span> <span class="n">The</span> <span class="n">strategy</span> <span class="ow">is</span> <span class="o">...</span><span class="p">,</span> <span class="n">strategy</span> <span class="nb">len</span><span class="p">:</span><span class="o">.</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">equal</span> <span class="n">to</span> <span class="n">inputs</span> <span class="nb">len</span><span class="p">:</span><span class="o">.</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span>
</pre></div>
</div>
<p>Possible error code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MySub</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MySub</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sub</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">Sub</span><span class="p">()</span><span class="o">.</span><span class="n">shard</span><span class="p">(((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)))</span>
    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># x is a two-dimensional tensor</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>The input of many operators can be scalars, such as addition, subtraction, multiplication, and division operations and axis of operators such as concat and gather. For such operations with scalar input, do not configure policies for these scalars. If the preceding method is used to configure a policy for the subtraction operation and the policy (1,) is configured for scalar 1, an error is reported.
That is, the length of the policy whose index is 1 is 1, which is not equal to the length 0 of the corresponding input. In this case, the input is a scalar.</p>
<p>Modified code:</p>
<p>In this case, set an empty policy for the scalar or do not set any policy (recommended method).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">sub</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">Sub</span><span class="p">()</span><span class="o">.</span><span class="n">shard</span><span class="p">(((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),()))</span>

<span class="bp">self</span><span class="o">.</span><span class="n">sub</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">Sub</span><span class="p">()</span><span class="o">.</span><span class="n">shard</span><span class="p">(((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),))</span>
</pre></div>
</div>
</section>
<section id="no-policy-configuration">
<h4>No Policy Configuration<a class="headerlink" href="#no-policy-configuration" title="Permalink to this headline"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">ERROR</span><span class="p">]</span><span class="n">The</span> <span class="n">strategy</span> <span class="ow">is</span> <span class="p">((</span><span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">shape</span> <span class="mi">4</span> <span class="n">can</span> <span class="ow">not</span> <span class="n">be</span> <span class="n">divisible</span> <span class="n">by</span> <span class="n">strategy</span> <span class="n">value</span> <span class="mi">8</span>
</pre></div>
</div>
<p>Possible error code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MySub</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MySub</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sub</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">Sub</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># x is a two-dimensional tensor</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>The following piece of code runs training in an 8-device environment in semi-automatic parallel mode. No policy is configured for the Sub operator in the example and the default policy of the Sub operator is data parallel. Assume that the input x is a matrix of size [2, 4]. After the build starts, an error is reported, indicating that the input dimensions are insufficient for slicing. In this case, you need to modify the policy as follows (ensure that the number of dimensions for slicing are less than that of the input tensor):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MySub</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MySub</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sub</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">Sub</span><span class="p">()</span><span class="o">.</span><span class="n">shard</span><span class="p">(((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">()))</span>
    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># x is a two-dimensional tensor</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>(2, 1) indicates that dimension 0 of the first input tensor is sliced into two parts, and dimension 1 is sliced into one, that is, dimension 1 is not sliced. The second input of <code class="docutils literal notranslate"><span class="pre">ops.Sub</span></code> is a scalar that cannot be sliced. Therefore, the slicing policy is set to empty ().</p>
</section>
</section>
<section id="parallel-script-error">
<h3>Parallel Script Error<a class="headerlink" href="#parallel-script-error" title="Permalink to this headline"></a></h3>
<p>The following is a piece of code for running an 8-device Ascend environment and using the bash script to start the training task.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="nb">set</span><span class="w"> </span>-e
<span class="nv">EXEC_PATH</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">RANK_SIZE</span><span class="o">=</span><span class="m">8</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">RANK_TABLE_FILE</span><span class="o">=</span><span class="si">${</span><span class="nv">EXEC_PATH</span><span class="si">}</span>/rank_table_8pcs.json

<span class="k">for</span><span class="o">((</span><span class="nv">i</span><span class="o">=</span><span class="m">0</span><span class="p">;</span>i&lt;RANK_SIZE<span class="p">;</span>i++<span class="o">))</span>
<span class="k">do</span>
<span class="w">    </span>rm<span class="w"> </span>-rf<span class="w"> </span>device<span class="nv">$i</span>
<span class="w">    </span>mkdir<span class="w"> </span>device<span class="nv">$i</span>
<span class="w">    </span>cp<span class="w"> </span>./train.py<span class="w"> </span>./device<span class="nv">$i</span>
<span class="w">    </span><span class="nb">cd</span><span class="w"> </span>./device<span class="nv">$i</span>
<span class="w">    </span><span class="nb">export</span><span class="w"> </span><span class="nv">DEVICE_ID</span><span class="o">=</span><span class="nv">$i</span>
<span class="w">    </span><span class="nb">export</span><span class="w"> </span><span class="nv">RANK_ID</span><span class="o">=</span><span class="nv">$i</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;start training for device </span><span class="nv">$i</span><span class="s2">&quot;</span>
<span class="w">    </span>env<span class="w"> </span>&gt;<span class="w"> </span>env<span class="nv">$i</span>.log
<span class="w">    </span>python<span class="w"> </span>./train.py<span class="w"> </span>&gt;<span class="w"> </span>train.log<span class="nv">$i</span><span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">    </span><span class="nb">cd</span><span class="w"> </span>../
<span class="k">done</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;The program launch succeed, the log is under device0/train.log0.&quot;</span>
</pre></div>
</div>
<p>Errors may occur in the following scenarios:</p>
<ol class="arabic simple">
<li><p>The number of training tasks (<code class="docutils literal notranslate"><span class="pre">RANK_SIZE</span></code>) started using the for loop does not match the number of devices configured in the <code class="docutils literal notranslate"><span class="pre">rank_table_8pcs.json</span></code> configuration file. As a result, an error is reported.</p></li>
<li><p>The command for executing the training script is not executed in asynchronous mode (<code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">./train.py</span> <span class="pre">&gt;</span> <span class="pre">train.log$i</span> <span class="pre">2&gt;&amp;1</span></code>). As a result, training tasks are started at different time, and an error is reported. In this case, add the <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> operator to the end of the command, indicating that the command is executed asynchronously in the subshell. In this way, multiple tasks can be started synchronously.</p></li>
</ol>
<p>In parallel scenarios, you may encounter the <code class="docutils literal notranslate"><span class="pre">Distribute</span> <span class="pre">Task</span> <span class="pre">Failed</span></code> error. In this case, analyze whether the error occurs in the computational graph build phase or the execution phase of printing training loss to further locate the error.</p>
<p>For details, visit the following website:</p>
<p>For more information about distributed parallel errors in MindSpore, see <a class="reference external" href="https://www.hiascend.com/forum/thread-0231108039303484155-1-1.html">Distributed Task Failed</a>.</p>
</section>
</section>
<section id="cann-error-analysis">
<h2>CANN Error Analysis<a class="headerlink" href="#cann-error-analysis" title="Permalink to this headline"></a></h2>
<blockquote>
<div><ul class="simple">
<li><p>This section is only applicable to Ascend platform, CANN (Compute Architecture for Neural Networks) is Huawei heterogeneous computing architecture for AI scenarios, and MindSpore of Ascend platform runs on top of CANN.</p></li>
</ul>
</div></blockquote>
<p>When running MindSpore on the Ascend platform, certain scenarios will encounter errors from the underlying CANN. Such errors are generally reported in the log with the <code class="docutils literal notranslate"><span class="pre">Ascend</span> <span class="pre">error</span> <span class="pre">occurred</span></code> keyword, and the error message consists of the error code and the error content, as follows:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">ERROR</span><span class="p">]</span><span class="w"> </span><span class="n">PROFILER</span><span class="p">(</span><span class="mi">138694</span><span class="p">,</span><span class="n">ffffaa6c8480</span><span class="p">,</span><span class="n">python</span><span class="p">)</span><span class="o">:</span><span class="mi">2022</span><span class="mo">-01</span><span class="mi">-10-14</span><span class="o">:</span><span class="mi">19</span><span class="o">:</span><span class="mf">56.741.053</span><span class="w"> </span><span class="p">[</span><span class="n">mindspore</span><span class="o">/</span><span class="n">ccsrc</span><span class="o">/</span><span class="n">profiler</span><span class="o">/</span><span class="n">device</span><span class="o">/</span><span class="n">ascend</span><span class="o">/</span><span class="n">ascend_profiling</span><span class="p">.</span><span class="n">cc</span><span class="o">:</span><span class="mi">51</span><span class="p">]</span><span class="w"> </span><span class="n">ReportErrorMessage</span><span class="p">]</span><span class="w"> </span><span class="n">Ascend</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">occurred</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">message</span><span class="o">:</span>
<span class="nl">EK0001</span><span class="p">:</span><span class="w"> </span><span class="n">Path</span><span class="w"> </span><span class="p">[</span><span class="o">/</span><span class="n">ms_test</span><span class="o">/</span><span class="n">csj</span><span class="o">/</span><span class="n">csj</span><span class="o">/</span><span class="n">user_scene</span><span class="o">/</span><span class="n">profiler_chinese_中文</span><span class="o">/</span><span class="n">resnet</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">profiler</span><span class="p">]</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">[</span><span class="n">profilerResultPath</span><span class="p">]</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">invalid</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">exist</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">Path</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">contain</span><span class="w"> </span><span class="n">A</span><span class="o">-</span><span class="n">Za</span><span class="o">-</span><span class="n">z0</span><span class="mi">-9</span><span class="o">-</span><span class="n">_</span><span class="p">.</span>
</pre></div>
</div>
<p>One of the CANN error codes consists of 6 characters, such as <code class="docutils literal notranslate"><span class="pre">EK0001</span></code> above, which contains three fields:</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="text-left head"><p>Field 1</p></th>
<th class="text-left head"><p>Field 2</p></th>
<th class="text-left head"><p>Field 3</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>Level (1 position)</p></td>
<td class="text-left"><p>Module (1 position)</p></td>
<td class="text-left"><p>Error code (4 positions)</p></td>
</tr>
</tbody>
</table>
<p>Among them, the level is divided into E, W, I, respectively, indicating error, alarm, prompt class. Module indicates the CANN module that reports errors, as shown in the following table:</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="text-left head"><p>Err error code</p></th>
<th class="text-left head"><p>CANN module</p></th>
<th class="text-left head"><p>Err error code</p></th>
<th class="text-left head"><p>CANN module</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>E10000-E19999</p></td>
<td class="text-left"><p>GE</p></td>
<td class="text-left"><p>EE0000-EE9999</p></td>
<td class="text-left"><p>runtime</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>E20000-E29999</p></td>
<td class="text-left"><p>FE</p></td>
<td class="text-left"><p>EF0000-EF9999</p></td>
<td class="text-left"><p>LxFusion</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>E30000-E39999</p></td>
<td class="text-left"><p>AICPU</p></td>
<td class="text-left"><p>EG0000-EG9999</p></td>
<td class="text-left"><p>mstune</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>E40000-E49999</p></td>
<td class="text-left"><p>TEFusion</p></td>
<td class="text-left"><p>EH0000-EH9999</p></td>
<td class="text-left"><p>ACL</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>E50000-E89999</p></td>
<td class="text-left"><p>AICORE</p></td>
<td class="text-left"><p>EI0000-EJ9999</p></td>
<td class="text-left"><p>HCCL&amp;HCCP</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>E90000-EB9999</p></td>
<td class="text-left"><p>TBE Compiling front and back ends</p></td>
<td class="text-left"><p>EK0000-EK9999</p></td>
<td class="text-left"><p>Profiling</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>EC0000-EC9999</p></td>
<td class="text-left"><p>Autotune</p></td>
<td class="text-left"><p>EL0000-EL9999</p></td>
<td class="text-left"><p>Driver</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>ED0000-ED9999</p></td>
<td class="text-left"><p>RLTune</p></td>
<td class="text-left"><p>EZ0000-EZ9999</p></td>
<td class="text-left"><p>Operator public error</p></td>
</tr>
</tbody>
</table>
<blockquote>
<div><p>AICORE operator: The AI Core operator is the main component of the computational core of the Ascend AI processor and is responsible for performing computationally intensive operator related to vector and tensor.
AICPU operator: AI CPU operator is the AI CPU responsible for executing CPU-like operator (including control operator, scalar and vector, and other general-purpose computations) in the Hayes SoC of the Ascend processor.</p>
</div></blockquote>
<p>Among the 4-bit error codes, 0000~8999 are user-class errors and 9000~9999 are internal error codes. Generally, user-class error users can correct the error by themselves according to the error message, while internal error codes need to contact Huawei for troubleshooting. You can go to <a class="reference external" href="https://gitee.com/mindspore">MindSpore Community</a> or <a class="reference external" href="https://gitee.com/ascend">Ascend Community</a> to submit issue to get help. Some common error reporting scenarios are shown in the following table:</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Common Error Types</p></th>
<th class="head"><p>Error Description</p></th>
<th class="head"><p>Case Analysis</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>AICORE Operator Compilation Problem</p></td>
<td><p>AICORE Operator Error During Compilation</p></td>
<td><p><a class="reference external" href="https://www.mindspore.cn/tutorials/en/master/advanced/error_analysis/cann_error_cases.html#aicore-operator-compilation-problem">AICORE Operator Compilation Problem</a></p></td>
</tr>
<tr class="row-odd"><td><p>AICORE Operator Execution Problem</p></td>
<td><p>AICORE Operator Error During Execution</p></td>
<td><p><a class="reference external" href="https://mindspore.cn/tutorials/en/master/advanced/error_analysis/cann_error_cases.html#aicore-operator-execution-problem">AICORE Operator Execution Problem</a></p></td>
</tr>
<tr class="row-even"><td><p>AICPU Operator Execution Problem</p></td>
<td><p>AICPU Operator Error During Execution</p></td>
<td><p><a class="reference external" href="https://mindspore.cn/tutorials/en/master/advanced/error_analysis/cann_error_cases.html#aicpu-operator-execution-problem">AICPU Operator Execution Problem</a></p></td>
</tr>
<tr class="row-odd"><td><p>runtime FAQ</p></td>
<td><p>Including input data exceptions, operator implementation errors, functional limitations, resource limitations, etc.</p></td>
<td><p><a class="reference external" href="https://mindspore.cn/tutorials/en/master/advanced/error_analysis/cann_error_cases.html#runtime-faq">runtime FAQ</a></p></td>
</tr>
<tr class="row-even"><td><p>HCCL &amp; HCCP FAQ</p></td>
<td><p>Common communication problems during multi-machine multi-card training, including socket build timeout, notify wait timeout, ranktable configuration error, etc.</p></td>
<td><p><a class="reference external" href="https://mindspore.cn/tutorials/en/master/advanced/error_analysis/cann_error_cases.html#hccl-hccp-faq">HCCL &amp; HCCP FAQ</a></p></td>
</tr>
<tr class="row-odd"><td><p>profiling FAQ</p></td>
<td><p>Errors when running profiling for performance tuning</p></td>
<td><p><a class="reference external" href="https://mindspore.cn/tutorials/en/master/advanced/error_analysis/cann_error_cases.html#profiling-faq">profiling FAQ</a></p></td>
</tr>
</tbody>
</table>
<p>For more information about CANN errors, refer to the <a class="reference external" href="https://www.hiascend.com/document/moreVersion/zh/CANNCommunityEdition/">Ascend CANN Developer Documentation</a> to check the troubleshooting section of the corresponding CANN version.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../error_analysis.html" class="btn btn-neutral float-left" title="Error Reporting Analysis" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="minddata_debug.html" class="btn btn-neutral float-right" title="Common Data Processing Errors and Analysis Methods" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, MindSpore.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 
</body>
</html>