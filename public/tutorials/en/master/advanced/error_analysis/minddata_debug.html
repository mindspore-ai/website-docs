<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Common Data Processing Errors and Analysis Methods &mdash; MindSpore master documentation</title>
      <link rel="stylesheet" href="../../_static/css/bootstrap.min.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/training.css" type="text/css" /><link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/js/training.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Network Construction and Training Error Analysis" href="mindrt_debug.html" />
    <link rel="prev" title="Error Analysis" href="error_scenario_analysis.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> MindSpore
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Quick Start</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../beginner/introduction.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../beginner/quick_start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../beginner/tensor.html">Tensor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../beginner/dataset.html">Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../beginner/transforms.html">Transforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../beginner/model.html">Building a Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../beginner/autograd.html">Automatic Differentiation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../beginner/train.html">Model Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../beginner/save_load.html">Saving and Loading the Model</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../model.html">Advanced Encapsulation: Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">Model Module Customization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dataset.html">Advanced Data Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../derivation.html">Advanced Automatic Differentiation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compute_graph.html">Computational Graph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mixed_precision.html">Automatic Mix Precision</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../error_analysis.html">Error Reporting Analysis</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="error_scenario_analysis.html">Error Analysis</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Common Data Processing Errors and Analysis Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="mindrt_debug.html">Network Construction and Training Error Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="cann_error_cases.html">CANN Common Error Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="mindir.html">IR File Analysis</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">MindSpore</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../error_analysis.html">Error Reporting Analysis</a> &raquo;</li>
      <li>Common Data Processing Errors and Analysis Methods</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/advanced/error_analysis/minddata_debug.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="common-data-processing-errors-and-analysis-methods">
<h1>Common Data Processing Errors and Analysis Methods<a class="headerlink" href="#common-data-processing-errors-and-analysis-methods" title="Permalink to this headline"></a></h1>
<p><a href="https://gitee.com/mindspore/docs/blob/master/tutorials/source_en/advanced/error_analysis/minddata_debug.md" target="_blank"><img src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/master/resource/_static/logo_source_en.png"></a>  </p>
<section id="data-preparation">
<h2>Data Preparation<a class="headerlink" href="#data-preparation" title="Permalink to this headline"></a></h2>
<p>Common errors you may encounter in the data preparation phase include dataset path and MindRecord file errors when you read or save data from or to a path or when you read or write a MindRecord file.</p>
<section id="the-dataset-path-contains-chinese-characters">
<h3>The Dataset Path Contains Chinese Characters<a class="headerlink" href="#the-dataset-path-contains-chinese-characters" title="Permalink to this headline"></a></h3>
<p>Error log:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>RuntimeError: Unexpected error. Failed to open file, file path E:\深度学习\models-master\official\cv\ssd\MindRecord_COCO\test.mindrecord
</pre></div>
</div>
<p>Two solutions are available:</p>
<ol class="arabic simple">
<li><p>Specify the output path of the MindRecord dataset to a path containing only English characters.</p></li>
<li><p>Upgrade MindSpore to a version later than 1.6.0.</p></li>
</ol>
<p>For details, visit the following website:</p>
<p><a class="reference external" href="https://www.hiascend.com/forum/thread-0231107679243990127-1-1.html">MindRecord Data Preparation - Unexpected error. Failed to open file_MindSpore</a></p>
</section>
<section id="mindrecord-file-error">
<h3>MindRecord File Error<a class="headerlink" href="#mindrecord-file-error" title="Permalink to this headline"></a></h3>
<section id="the-duplicate-file-is-not-deleted">
<h4>The Duplicate File Is Not Deleted<a class="headerlink" href="#the-duplicate-file-is-not-deleted" title="Permalink to this headline"></a></h4>
<p>Error log:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>MRMOpenError: [MRMOpenError]: MindRecord File could not open successfully.
</pre></div>
</div>
<p>Solution:</p>
<ol class="arabic simple">
<li><p>Add the file deletion logic to the code to ensure that the MindRecord file with the same name in the directory is deleted before the file is saved.</p></li>
<li><p>In versions later than MindSpore 1.6.0, when defining the <code class="docutils literal notranslate"><span class="pre">FileWriter</span></code> object, add <code class="docutils literal notranslate"><span class="pre">overwrite=True</span></code> to implement overwriting.</p></li>
</ol>
<p>For details, visit the following website:</p>
<p><a class="reference external" href="https://www.hiascend.com/forum/thread-0231107679243990127-1-1.html">MindSpore Data Preparation - MindRecord File could not open successfully</a></p>
</section>
<section id="the-file-is-moved">
<h4>The File Is Moved<a class="headerlink" href="#the-file-is-moved" title="Permalink to this headline"></a></h4>
<p>Error log:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>RuntimeError: Thread ID 1 Unexpected error. Fail to open ./data/cora
RuntimeError: Unexpected error. Invalid file, DB file can not match file
</pre></div>
</div>
<p>When MindSpore 1.4 or an earlier version is used, in the Windows environment, after a MindRecord dataset file is generated and moved, the file cannot be loaded to MindSpore.</p>
<p>Solution:</p>
<ol class="arabic simple">
<li><p>Do not move the MindRecord file generated in the Windows environment.</p></li>
<li><p>Upgrade MindSpore to 1.5.0 or a later version and regenerate a MindRecord dataset. Then, the dataset can be copied and moved properly.</p></li>
</ol>
<p>For details, visit the following website:</p>
<p><a class="reference external" href="https://www.hiascend.com/forum/thread-0229106992212728097-1-1.html">MindSpore Data Preparation - Invalid file,DB file can not match_MindSpore</a></p>
</section>
<section id="the-user-defined-data-type-is-incorrect">
<h4>The User-defined Data Type Is Incorrect<a class="headerlink" href="#the-user-defined-data-type-is-incorrect" title="Permalink to this headline"></a></h4>
<p>Error log:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>RuntimeError: Unexpected error. Invalid data, the number of schema should be positive but got: 0. Please check the input schema.
</pre></div>
</div>
<p>Solution:</p>
<p>Modify the input data type to ensure that it is consistent with the type definition in the script.</p>
<p>For details, visit the following website:</p>
<p><a class="reference external" href="https://www.hiascend.com/forum/thread-0231107678315400125-1-1.html">MindSpore Data Preparation - Unexpected error. Invalid data</a></p>
</section>
</section>
</section>
<section id="data-loading">
<h2>Data Loading<a class="headerlink" href="#data-loading" title="Permalink to this headline"></a></h2>
<p>In the data loading phase, errors may be reported in resource configuration, <code class="docutils literal notranslate"><span class="pre">GeneratorDataset</span></code>, and iterators.</p>
<section id="resource-configuration">
<h3>Resource Configuration<a class="headerlink" href="#resource-configuration" title="Permalink to this headline"></a></h3>
<section id="incorrect-number-of-cpu-cores">
<h4>Incorrect Number of CPU Cores<a class="headerlink" href="#incorrect-number-of-cpu-cores" title="Permalink to this headline"></a></h4>
<p>Error log:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>RuntimeError: Thread ID 140706176251712 Unexpected error. GeneratorDataset&#39;s num_workers=8, this value is not within the required range of [1, cpu_thread_cnt=2].
</pre></div>
</div>
<p>Solution:</p>
<ol class="arabic simple">
<li><p>Add the following code to manually configure the number of CPU cores: <code class="docutils literal notranslate"><span class="pre">ds.config.set_num_parallel_workers()</span></code></p></li>
<li><p>Upgrade to MindSpore 1.6.0, which automatically adapts to the number of CPU cores in the hardware to prevent errors caused by insufficient CPU cores.</p></li>
</ol>
<p>For details, visit the following website:</p>
<p><a class="reference external" href="https://www.hiascend.com/forum/thread-0215121940801939033-1-1.html">MindSpore Data Loading - Unexpected error. GeneratorDataset’s num_workers=8, this value is not within the required range of</a></p>
</section>
<section id="incorrect-pagesize-setting">
<h4>Incorrect PageSize Setting<a class="headerlink" href="#incorrect-pagesize-setting" title="Permalink to this headline"></a></h4>
<p>Error log:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>RuntimeError: Syntax error. Invalid data, Page size: 1048576 is too small to save a blob row.
</pre></div>
</div>
<p>Solution:</p>
<p>Call the set_page_size API to set pagesize to a larger value. The setting method is as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindspore.mindrecord</span> <span class="kn">import</span> <span class="n">FileWriter</span>
<span class="n">writer</span> <span class="o">=</span> <span class="n">FileWriter</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="s2">&quot;test.mindrecord&quot;</span><span class="p">,</span> <span class="n">shard_num</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">writer</span><span class="o">.</span><span class="n">set_page_size</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">26</span><span class="p">)</span> <span class="c1"># 128MB</span>
</pre></div>
</div>
<p>For details, visit the following website:</p>
<p><a class="reference external" href="https://www.hiascend.com/forum/thread-0231107680001698128-1-1.html">MindSpore Data Loading - Invalid data,Page size is too small”</a></p>
</section>
</section>
<section id="generatordataset">
<h3><code class="docutils literal notranslate"><span class="pre">GeneratorDataset</span></code><a class="headerlink" href="#generatordataset" title="Permalink to this headline"></a></h3>
<section id="suspended-generatordataset-thread">
<h4>Suspended <code class="docutils literal notranslate"><span class="pre">GeneratorDataset</span></code> Thread<a class="headerlink" href="#suspended-generatordataset-thread" title="Permalink to this headline"></a></h4>
<p>No error log is generated, and the thread is suspended.</p>
<p>During customized data processing, the <code class="docutils literal notranslate"><span class="pre">numpy.ndarray</span></code> and <code class="docutils literal notranslate"><span class="pre">mindspore.Tensor</span></code> data type are mixed and the <code class="docutils literal notranslate"><span class="pre">numpy.array(Tensor)</span></code> type is incorrectly used for conversion. As a result, the global interpreter lock (GIL) cannot be released and the <code class="docutils literal notranslate"><span class="pre">GeneratorDataset</span></code> cannot work properly.</p>
<p>Solution:</p>
<ol class="arabic simple">
<li><p>When defining the first input parameter <code class="docutils literal notranslate"><span class="pre">source</span></code> of <code class="docutils literal notranslate"><span class="pre">GeneratorDataset</span></code>, use the <code class="docutils literal notranslate"><span class="pre">numpy.ndarray</span></code> data type if a Python function needs to be invoked.</p></li>
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">Tensor.asnumpy()</span></code> method to convert <code class="docutils literal notranslate"><span class="pre">Tensor</span></code> to <code class="docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>.</p></li>
</ol>
<p>For details, visit the following website:</p>
<p><a class="reference external" href="https://www.hiascend.com/forum/thread-0232106992052900089-1-1.html">MindSpore Data Loading - Suspended GeneratorDataset Thread</a></p>
</section>
<section id="incorrect-user-defined-return-type">
<h4>Incorrect User-defined Return Type<a class="headerlink" href="#incorrect-user-defined-return-type" title="Permalink to this headline"></a></h4>
<p>Error log:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Unexpected</span> <span class="n">error</span><span class="o">.</span> <span class="n">Invalid</span> <span class="n">data</span> <span class="nb">type</span><span class="o">.</span>
</pre></div>
</div>
<p>Error description:</p>
<p>A user-defined <code class="docutils literal notranslate"><span class="pre">Dataset</span></code> or <code class="docutils literal notranslate"><span class="pre">map</span></code> operation returns data of the dict type, not a numpy array or a tuple consisting of numpy arrays. Data types (such as dict and object) other than numpy array or a tuple consisting of numpy arrays are not controllable and the data storage mode is unclear. As a result, the <code class="docutils literal notranslate"><span class="pre">Invalid</span> <span class="pre">type</span></code> error is reported.</p>
<p>Solution:</p>
<ol class="arabic simple">
<li><p>Check the return type of the customized data processing. The return type must be numpy array or a tuple consisting of numpy arrays.</p></li>
<li><p>Check the return type of the <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code> function during customized data loading. The return type must be a tuple consisting of numpy arrays.</p></li>
</ol>
<p>For details, visit the following website:</p>
<p><a class="reference external" href="https://www.hiascend.com/forum/thread-0231107678315400125-1-1.html">MindSpore Dataset Loading - Unexpected error. Invalid data type_MindSpore</a></p>
</section>
<section id="user-defined-sampler-initialization-error">
<h4>User-defined Sampler Initialization Error<a class="headerlink" href="#user-defined-sampler-initialization-error" title="Permalink to this headline"></a></h4>
<p>Error log:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>AttributeError: &#39;IdentitySampler&#39; object has no attribute &#39;child_sampler&#39;
</pre></div>
</div>
<p>Solution:</p>
<p>In the user-defined sampler initialization method ‘__init__()’, use ‘super().__init__()’ to invoke the constructor of the parent class.</p>
<p>For details, visit the following website:</p>
<p><a class="reference external" href="https://www.hiascend.com/forum/thread-0229107679386960150-1-1.html">MindSpore Dataset Loading - ‘IdentitySampler’ has no attribute child_sampler</a></p>
</section>
<section id="repeated-access-definition">
<h4>Repeated Access Definition<a class="headerlink" href="#repeated-access-definition" title="Permalink to this headline"></a></h4>
<p>Error log:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">For</span> <span class="s1">&#39;Tensor&#39;</span><span class="p">,</span> <span class="n">the</span> <span class="nb">type</span> <span class="n">of</span> <span class="s2">&quot;input_data&quot;</span> <span class="n">should</span> <span class="n">be</span> <span class="n">one</span> <span class="n">of</span> <span class="o">...</span>
</pre></div>
</div>
<p>Solution:</p>
<p>Select a proper data input method: random access (<code class="docutils literal notranslate"><span class="pre">__getitem__</span></code>) or sequential access (iter, next).</p>
<p>For details, visit the following website:</p>
<p><a class="reference external" href="https://www.hiascend.com/forum/thread-0229107683010760153-1-1.html">MindSpore Dataset Loading - the type of <code class="docutils literal notranslate"><span class="pre">input_data</span></code> should be one of</a></p>
</section>
<section id="inconsistency-between-the-fields-returned-by-the-user-defined-data-and-the-defined-fields">
<h4>Inconsistency Between the Fields Returned by the User-defined Data and the Defined Fields<a class="headerlink" href="#inconsistency-between-the-fields-returned-by-the-user-defined-data-and-the-defined-fields" title="Permalink to this headline"></a></h4>
<p>Error log:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>RuntimeError: Exception thrown from PyFunc. Invalid python function, the &#39;source&#39; of &#39;GeneratorDataset&#39; should return same number of NumPy arrays as specified in column_names
</pre></div>
</div>
<p>Solution:</p>
<p>Check whether the fields returned by <code class="docutils literal notranslate"><span class="pre">GeneratorDataset</span></code> are the same as those defined in <code class="docutils literal notranslate"><span class="pre">columns</span></code>.</p>
<p>For details, visit the following website:</p>
<p><a class="reference external" href="https://www.hiascend.com/forum/thread-0232107680321371137-1-1.html">MindSpore Dataset Loading -Exception thrown from PyFunc</a></p>
</section>
<section id="incorrect-user-script">
<h4>Incorrect User Script<a class="headerlink" href="#incorrect-user-script" title="Permalink to this headline"></a></h4>
<p>Error log:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>TypeError: parse() missing 1 required positionnal argument: &#39;self&#39;
</pre></div>
</div>
<p>Solution:</p>
<p>Debug the code step by step and check the syntax in the script to see whether ‘()’ is missing.</p>
<p>For details, visit the following website:</p>
<p><a class="reference external" href="https://www.hiascend.com/forum/thread-0235121940704650030-1-1.html">MindSpore Dataset Loading - parse() missing 1 required positional</a></p>
</section>
<section id="incorrect-use-of-tensor-operations-or-operators-in-custom-datasets">
<h4>Incorrect Use of Tensor Operations or Operators in Custom Datasets<a class="headerlink" href="#incorrect-use-of-tensor-operations-or-operators-in-custom-datasets" title="Permalink to this headline"></a></h4>
<p>Error log:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>RuntimeError: Exception thrown from PyFunc. RuntimeError: mindspore/ccsrc/pipeline/pynative/pynative_execute.cc:1116 GetOpOutput] : The pointer[cnode] is null.
</pre></div>
</div>
<p>Error description:</p>
<p>Tensor operations or operators are used in custom datasets. Because data processing is performed in multi-thread parallel mode and tensor operations or operators do not support multi-thread parallel execution, an error is reported.</p>
<p>Solution:</p>
<p>In the user-defined Pyfunc, do not use MindSpore tensor operations or operators in <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code> in the dataset. You are advised to convert the input parameters to the Numpy type and then perform Numpy operations to implement related functions.</p>
<p>For details, visit the following website:</p>
<p><a class="reference external" href="https://www.hiascend.com/forum/thread-0230106992306834091-1-1.html">MindSpore Dataset Loading - The pointer[cnode] is null</a></p>
</section>
<section id="index-out-of-range-due-to-incorrect-iteration-initialization">
<h4>Index Out of Range Due to Incorrect Iteration Initialization<a class="headerlink" href="#index-out-of-range-due-to-incorrect-iteration-initialization" title="Permalink to this headline"></a></h4>
<p>Error log:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">list</span> <span class="n">index</span> <span class="n">out</span> <span class="n">of</span> <span class="nb">range</span>
</pre></div>
</div>
<p>Solution:</p>
<p>Remove unnecessary <code class="docutils literal notranslate"><span class="pre">index</span></code> member variables, or set <code class="docutils literal notranslate"><span class="pre">index</span></code> to 0 before each iteration to perform the reset operation.</p>
<p>For details, visit the following website:</p>
<p><a class="reference external" href="https://www.hiascend.com/forum/thread-0232107679694236136-1-1.html">MindSpore Dataset Loading - list index out of range</a></p>
</section>
<section id="no-iteration-initialization">
<h4>No Iteration Initialization<a class="headerlink" href="#no-iteration-initialization" title="Permalink to this headline"></a></h4>
<p>Error log:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Unable</span> <span class="n">to</span> <span class="n">fetch</span> <span class="n">data</span> <span class="kn">from</span> <span class="nn">GeneratorDataset</span><span class="p">,</span> <span class="k">try</span> <span class="n">iterate</span> <span class="n">the</span> <span class="n">source</span> <span class="n">function</span> <span class="n">of</span> <span class="n">GeneratorDataset</span> <span class="ow">or</span> <span class="n">check</span> <span class="n">value</span> <span class="n">of</span> <span class="n">num_epochs</span> <span class="n">when</span> <span class="n">create</span> <span class="n">iterator</span><span class="o">.</span>
</pre></div>
</div>
<p>The value of <code class="docutils literal notranslate"><span class="pre">len</span></code> is inconsistent with that of <code class="docutils literal notranslate"><span class="pre">iter</span></code> because iteration initialization is not performed.</p>
<p>Solution:</p>
<p>Clear the value of <code class="docutils literal notranslate"><span class="pre">iter</span></code>.</p>
<p>For details, visit the following website:</p>
<p><a class="reference external" href="https://www.hiascend.com/forum/thread-0215121940606533032-1-1.html">MindSpore Dataset Loading - Unable to fetch data from GeneratorDataset</a></p>
</section>
</section>
<section id="iterator">
<h3>Iterator<a class="headerlink" href="#iterator" title="Permalink to this headline"></a></h3>
<section id="repeated-iterator-creation">
<h4>Repeated Iterator Creation<a class="headerlink" href="#repeated-iterator-creation" title="Permalink to this headline"></a></h4>
<p>Error log:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">oserror</span><span class="p">:</span> <span class="p">[</span><span class="n">errno</span> <span class="mi">24</span><span class="p">]</span> <span class="n">too</span> <span class="n">many</span> <span class="nb">open</span> <span class="n">files</span>
</pre></div>
</div>
<p>Error description:</p>
<p>If <code class="docutils literal notranslate"><span class="pre">iter()</span></code> is repeatedly called, iterators are repeatedly created. However, because <code class="docutils literal notranslate"><span class="pre">GeneratorDataset</span></code> loads datasets in multi-thread mode by default, the handles opened each time cannot be released before the main process stops. As a result, the number of opened handles keeps increasing.</p>
<p>Solution:</p>
<p>Use the dict iterator <code class="docutils literal notranslate"><span class="pre">create_dict_iterator()</span></code> and tuple iterator <code class="docutils literal notranslate"><span class="pre">create_tuple_iterator()</span></code> provided by MindSpore.</p>
<p>For details, visit the following website:</p>
<p><a class="reference external" href="https://www.hiascend.com/forum/thread-0231107678973789126-1-1.html">MindSpore Data Loading - too many open files</a></p>
</section>
<section id="improper-data-acquisition-from-the-iterator">
<h4>Improper Data Acquisition from the Iterator<a class="headerlink" href="#improper-data-acquisition-from-the-iterator" title="Permalink to this headline"></a></h4>
<p>Error log:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;DictIterator&#39;</span> <span class="n">has</span> <span class="n">no</span> <span class="n">attribute</span> <span class="s1">&#39;get_next&#39;</span>
</pre></div>
</div>
<p>Solution:</p>
<p>You can obtain the next piece of data from the iterator in either of the following ways:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">item</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">ds_test</span><span class="o">.</span><span class="n">create_dict_iterator</span><span class="p">())</span>

<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">ds_test</span><span class="o">.</span><span class="n">create_dict_iterator</span><span class="p">():</span>
</pre></div>
</div>
<p>For details, visit the following website:</p>
<p><a class="reference external" href="https://www.hiascend.com/forum/thread-0230107679565465123-1-1.html">MindSpore Dataset Loading - ‘DictIterator’ has no attribute ‘get_next’</a></p>
</section>
</section>
</section>
<section id="data-augmentation">
<h2>Data Augmentation<a class="headerlink" href="#data-augmentation" title="Permalink to this headline"></a></h2>
<p>In the data augmentation phase, the read data is processed. Currently, MindSpore supports common data processing operations, such as shuffle, batch, repeat, and concat. You may encounter the following errors in this phase: data type errors, interface parameter type errors, consumption node conflict, data batch errors, and memory resource errors.</p>
<section id="incorrect-data-type-for-invoking-a-third-party-library-api-in-a-user-defined-data-augmentation-operation">
<h3>Incorrect Data Type for Invoking A Third-party Library API in A User-defined Data Augmentation Operation<a class="headerlink" href="#incorrect-data-type-for-invoking-a-third-party-library-api-in-a-user-defined-data-augmentation-operation" title="Permalink to this headline"></a></h3>
<p>Error log:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>TypeError: Invalid object with type&#39;&lt;class &#39;PIL.Image.Image&#39;&gt;&#39; and value&#39;&lt;PIL.Image.Image image mode=RGB size=180x180 at 0xFFFF6132EA58&gt;&#39;.
</pre></div>
</div>
<p>Solution:</p>
<p>Check the data type requirements of the third-party library API used in the user-defined function, and convert the input data type to the data type expected by the API.</p>
<p>For details, visit the following website:</p>
<p><a class="reference external" href="https://www.hiascend.com/forum/thread-0229107679078336149-1-1.html">MindSpore Data Augmentation - TypeError: Invalid with type</a></p>
</section>
<section id="incorrect-parameter-type-in-a-user-defined-data-augmentation-operation">
<h3>Incorrect Parameter Type in A User-defined Data Augmentation Operation<a class="headerlink" href="#incorrect-parameter-type-in-a-user-defined-data-augmentation-operation" title="Permalink to this headline"></a></h3>
<p>Error log:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Exception thrown from PyFunc. TypeError: args should be Numpy narray. Got &lt;class &#39;tuple&#39;&gt;.
</pre></div>
</div>
<p>Solution:</p>
<p>Change the number of input parameters of <code class="docutils literal notranslate"><span class="pre">call</span></code> (except <code class="docutils literal notranslate"><span class="pre">self</span></code>) to the number of parameters in <code class="docutils literal notranslate"><span class="pre">input_columns</span></code> and their type to numpy.ndarray. If <code class="docutils literal notranslate"><span class="pre">input_columns</span></code> is ignored, the number of all data columns is used by default.</p>
<p>For details, visit the following website:</p>
<p><a class="reference external" href="https://www.hiascend.com/forum/thread-0230107678833189122-1-1.html">MindSpore Data Augmentation - args should be Numpy narray</a></p>
</section>
<section id="consumption-node-conflict-in-the-dataset">
<h3>Consumption Node Conflict in the Dataset<a class="headerlink" href="#consumption-node-conflict-in-the-dataset" title="Permalink to this headline"></a></h3>
<p>Error log:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ValueError: The data pipeline is not a tree (i.e. one node has 2 consumers)
</pre></div>
</div>
<p>Error description:</p>
<p>A branch occurs in the dataset definition. As a result, the dataset cannot determine the direction.</p>
<p>Solution:</p>
<p>Check the dataset name. Generally, retain the same dataset name.</p>
<p>For details, visit the following website:</p>
<p><a class="reference external" href="https://www.hiascend.com/forum/thread-0230107678474985121-1-1.html">MindSpore Data Augmentation - The data pipeline is not a tree</a></p>
</section>
<section id="improper-batch-operation-due-to-inconsistent-data-shapes">
<h3>Improper Batch Operation Due to Inconsistent Data Shapes<a class="headerlink" href="#improper-batch-operation-due-to-inconsistent-data-shapes" title="Permalink to this headline"></a></h3>
<p>Error log:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>RuntimeError: Unexpected error. Inconsistent batch shapes, batch operation expect same shape for each data row, but got inconsistent shape in column 0, expected shape for this column is:, got shape:
</pre></div>
</div>
<p>Solution:</p>
<ol class="arabic simple">
<li><p>Check the shapes of the data that requires the batch operation. If the shapes are inconsistent, cancel the batch operation.</p></li>
<li><p>If you need to perform the batch operation on the data with inconsistent shapes, sort out the dataset and unify the shapes of the input data by padding.</p></li>
</ol>
<p>For details, visit the following website:</p>
<p><a class="reference external" href="https://www.hiascend.com/forum/thread-0254121940499220038-1-1.html">MindSpore Data Augmentation - Unexpected error. Inconsistent batch</a></p>
</section>
<section id="high-memory-usage-due-to-data-augmentation">
<h3>High Memory Usage Due to Data Augmentation<a class="headerlink" href="#high-memory-usage-due-to-data-augmentation" title="Permalink to this headline"></a></h3>
<p>Error description:</p>
<p>If the memory is insufficient when MindSpore performs data augmentation, MindSpore may automatically exit. In MindSpore 1.7 and later versions, an alarm is generated when the memory usage exceeds 80%. When performing large-scale data training, pay attention to the memory usage to prevent direct exit due to high memory usage.</p>
<p>For details, visit the following website:</p>
<p><a class="reference external" href="https://www.hiascend.com/forum/thread-0230107679768460124-1-1.html">MindSpore Data Augmentation - Automatic Exit Due to Insufficient Memory</a></p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="error_scenario_analysis.html" class="btn btn-neutral float-left" title="Error Analysis" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="mindrt_debug.html" class="btn btn-neutral float-right" title="Network Construction and Training Error Analysis" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, MindSpore.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 
</body>
</html>