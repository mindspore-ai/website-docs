<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reading IR &mdash; MindSpore master documentation</title><link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-1fEPhSsRKlFKGfK3eO710tEweHh1fwokU5wFGDHO+vg=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Using Dump in the Graph Mode" href="dump.html" />
    <link rel="prev" title="Custom Debugging Information" href="custom_debug.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> MindSpore
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Data Processing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dataset/augment.html">Auto Augmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dataset/cache.html">Single-Node Data Cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dataset/optimize.html">Optimizing the Data Processing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Graph Compilation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../network/control_flow.html">Process Control Statements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../network/op_overload.html">Compiling Performance Optimization for Static Graph Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../network/jit_class.html">Calling the Custom Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../network/constexpr.html">Construct Constants In the Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../network/dependency_control.html">Dependency Control</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Model Training Optimization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../optimize/execution_opt.html">Sinking Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../optimize/gradient_accumulation.html">Gradient Accumulation Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../optimize/adaptive_summation.html">Adaptive Gradient Summation Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../optimize/dimention_reduce_training.html">Dimension Reduction Training Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../optimize/thor.html">Second-order Optimization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Custom Operator</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../operation/op_custom.html">Custom Operators (Custom-based)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../operation/ms_kernel.html">MindSpore Hybrid Syntax Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../operation/op_custom_adv.html">Advanced Usage of Custom Operators</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Automatic Vectorization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../vmap/vmap.html">Automatic Vectorization (Vmap)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Model Inference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../infer/inference.html">Inference Model Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infer/ascend_310_air.html">Inference on the Ascend 310 AI Processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infer/model_compression.html">Model Compression</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Debugging and Tuning</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="function_debug.html">Function Debug</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="error_analyze.html">Error Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="custom_debug.html">Custom Debugging Information</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Reading IR</a></li>
<li class="toctree-l2"><a class="reference internal" href="dump.html">Using Dump in the Graph Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="pynative_debug.html">Debugging in PyNative Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="pynative.html">Applying PyNative Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="fixing_randomness.html">Fixed Randomness to Reproduce Run Results of Script</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="performance_optimization.html">Performance Tuning</a></li>
<li class="toctree-l1"><a class="reference external" href="https://mindspore.cn/mindinsight/docs/en/r1.11/accuracy_problem_preliminary_location.html">Precision Optimization↗</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Distributed Parallel</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../parallel/introduction.html">Distributed Parallel Training Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parallel/parallel_training_quickstart.html">Quick Start Distributed Parallel Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parallel/communicate_ops.html">Distributed Set Communication Primitives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parallel/distributed_case.html">Distributed Case</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parallel/distributed_inference.html">Distributed Inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parallel/save_load.html">Saving and Loading Models in Hybrid Parallel Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parallel/fault_recover.html">Distributed Fault Recovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parallel/multi_dimensional.html">Multi Dimensional</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parallel/resilience_train_and_predict.html">Distributed Resilience Training and Inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parallel/other_features.html">Other Features</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Environment Variables</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../env/env_var_list.html">Environment Variables</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MindSpore</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="function_debug.html">Function Debug</a> &raquo;</li>
      <li>Reading IR</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/debug/mindir.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="reading-ir">
<h1>Reading IR<a class="headerlink" href="#reading-ir" title="Permalink to this headline"></a></h1>
<p><a class="reference external" href="https://gitee.com/mindspore/docs/blob/r1.11/tutorials/experts/source_en/debug/mindir.md"><img alt="View Source On Gitee" src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/r1.11/resource/_static/logo_source_en.png" /></a></p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline"></a></h2>
<p>When a model compiled using MindSpore runs in the graph mode <code class="docutils literal notranslate"><span class="pre">set_context(mode=GRAPH_MODE)</span></code> and <code class="docutils literal notranslate"><span class="pre">set_context(save_graphs=2)</span></code> is set in the configuration, some intermediate files will be generated during graph compliation. These intermediate files are called IR files. Currently, there are two IR files:</p>
<ul class="simple">
<li><p>.ir file: An IR file that describes the model structure in text format and can be directly viewed using any text editors. By setting environment variable <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">MS_DEV_SAVE_GRAPTHS_SORT_MODE=1</span></code>, an deep sorted ir can be generated. It can be switched back to the default ir file by setting environment variable <code class="docutils literal notranslate"><span class="pre">MS_DEV_SAVE_GRAPTHS_SORT_MODE</span></code> to any other value rather than 1.</p></li>
<li><p>.dot file: When <code class="docutils literal notranslate"><span class="pre">set_context(save_graphs=3)</span></code> is set in the configuration, an IR file that describes the topology relationships between different nodes. You can use this file by <a class="reference external" href="http://graphviz.org/">graphviz</a> as the input to generate images for users to view the model structure. For models with multiple operators, it is recommended using the visualization component <a class="reference external" href="https://www.mindspore.cn/mindinsight/docs/en/r1.11/dashboard.html#computational-graph-visualization">MindSpore Insight</a> to visualize computing graphs.</p></li>
</ul>
</section>
<section id="saving-ir">
<h2>Saving IR<a class="headerlink" href="#saving-ir" title="Permalink to this headline"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">set_context(save_graphs=2)</span></code> is used to save the intermediate code in each compilation phase. The intermediate code can be saved in two formats, and the .ir file with the extension ‘.ir’ is saved by default. If <code class="docutils literal notranslate"><span class="pre">set_context(save_graphs=3)</span></code> is set, a graphical .ir file with the extension <code class="docutils literal notranslate"><span class="pre">.dot</span></code> is printed. When the network scale is small, you are advised to use the graphical format that is more intuitive. When the network scale is large, you are advised to use the text format that is more efficient.</p>
<p>You can run the graphviz command to convert a .dot file to the picture format. For example, you can run the <code class="docutils literal notranslate"><span class="pre">dot</span> <span class="pre">-Tpng</span> <span class="pre">*.dot</span> <span class="pre">-o</span> <span class="pre">*.png</span></code> command to convert a <code class="docutils literal notranslate"><span class="pre">.dot</span></code> file to a .png file.</p>
<p>In the training script <code class="docutils literal notranslate"><span class="pre">train.py</span></code>, we add the following code to the <code class="docutils literal notranslate"><span class="pre">set_context</span></code> function, when running the training script, MindSpore will automatically store the IR file generated during compilation to the specified path.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">set_context</span><span class="p">(</span><span class="n">save_graphs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">save_graphs_path</span><span class="o">=</span><span class="s2">&quot;path/to/ir/files&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>After the training command is executed, several files were generated under the specified path.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>.
├──00_parse_0000.ir
├──00_parse_0001.dot
├──01_symbol_resolve_0002.ir
├──01_symbol_resolve_0003.dot
├──02_combine_like_graphs_0004.ir
├──02_combine_like_graphs_0005.dot
├──03_inference_opt_prepare_0006.ir
├──03_inference_opt_prepare_0007.dot
├──04_abstract_specialize_0008.ir
├──04_abstract_specialize_0009.dot
...
</pre></div>
</div>
<p>The IR files starting with digits and underscores are generated during the ME graph compilation. The compute graph is saved in each phase of the <code class="docutils literal notranslate"><span class="pre">pipeline</span></code>. Let’s see the important phases.</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">parse</span></code> phase parses the entrance function and this phase generates MindIR initially. If viewing the IR file, we can see that only the graph information of the top Cell is parsed in this phase.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">symbol_resolve</span></code> phase recursively parses entrance function, mainly recursive resolution entry functions directly or indirectly reference to other functions and objects. When using the unsupported syntax, it will get an error in this phase.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">abstract_specialize</span></code> phase means that the data type and shape information for all nodes in the IR is deduced from the input information. When you want to know the shape or data type of a specific operator in IR, you can view this IR file.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">optimize</span></code> phase refers hardware-independent optimization is performed. The automatic differential and automatic parallel functions are also performed. This stage can be subdivided into several substages. In the list of IR files, where the files prefixed with <code class="docutils literal notranslate"><span class="pre">opt_pass_</span> <span class="pre">[ordinal]</span></code> are IR files saved after the end of these sub-stages, non-framework developers do not need to pay too much attention.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">validate</span></code> phase will verify the compiled compute graph and check the temporary operators which should be removed in the prior phase. If any temporary operator exists, the process will report an error and exit.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">task_emit</span></code> phase will transfer the compute graph to the backend for further processing.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">execute</span></code> phase will execute the compute graph. The IR graph in this stage is the final graph in the phase of frontend.</p></li>
</ul>
<p>In addition, because the backend is closer to the bottom layer, non-framework developers do not need to pay much attention to other IR files saved during the backend optimization process (such as files that begin with <code class="docutils literal notranslate"><span class="pre">hwopt</span></code>). Non-framework developers only need to look at the file named <code class="docutils literal notranslate"><span class="pre">graph_build_[Graph</span> <span class="pre">Sequence</span> <span class="pre">Number]_[IR</span> <span class="pre">File</span> <span class="pre">Sequence</span> <span class="pre">Number].ir</span></code>, i.e. IR after all front and back end optimizations.</p>
<blockquote>
<div><p>Multiple files may be saved because the backend is optimized on subgraphs, which is different from the mechanism by which multiple subgraphs on the front end are saved in the same file.</p>
</div></blockquote>
</section>
<section id="ir-file-contents-introduction">
<h2>IR File Contents Introduction<a class="headerlink" href="#ir-file-contents-introduction" title="Permalink to this headline"></a></h2>
<p>The following is an example to describe the contents of the IR file. Run the script:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">import</span> <span class="nn">mindspore.nn</span> <span class="k">as</span> <span class="nn">nn</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">ops</span>

<span class="n">ms</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">GRAPH_MODE</span><span class="p">)</span>
<span class="n">ms</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">save_graphs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">save_graphs_path</span><span class="o">=</span><span class="s2">&quot;./&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">Add</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sub</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">Sub</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mul</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">Mul</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">div</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">Div</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">c</span>

<span class="n">input1</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">ms</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">input2</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">ms</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">net</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">net</span><span class="p">(</span><span class="n">input1</span><span class="p">,</span> <span class="n">input2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</pre></div>
</div>
<section id="ir-introduction">
<h3>ir Introduction<a class="headerlink" href="#ir-introduction" title="Permalink to this headline"></a></h3>
<p>Use a text editing software (for example, <code class="docutils literal notranslate"><span class="pre">vi</span></code>) to open the <code class="docutils literal notranslate"><span class="pre">04_abstract_specialize_0012.ir</span></code> file output after execution. The file contents are as follows (Here is MindSpore 2.0, and the content may have some imperceptible changes with the version upgrade):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>  1 #IR entry      : @1_Default_wrapper.24
  2 #Total subgraph: 3
  3
  4 #attrs         :
  5 #Total params  : 2
  6
  7 %para1_x : &lt;Tensor[Float32], ()&gt;
  8 %para2_y : &lt;Tensor[Float32], ()&gt;
  9
 10 subgraph attr:
 11 undeterminate : 0
 12 subgraph instance: 2_Default.23 : 0x556cab47cd00
 13 # In file testir1.py:19/    def construct(self, x, y):/
 14 subgraph @2_Default.23(%para3_x, %para4_y) {
 15   %0(a) = Sub(%para3_x, Tensor(shape=[], dtype=Float32, value=1)) {instance name: sub} primitive_attrs: {output_names: [output], input_names: [x, y]}
 16       : (&lt;Tensor[Float32], ()&gt;, &lt;Tensor[Float32], (), value=...&gt;) -&gt; (&lt;Tensor[Float32], ()&gt;)
 17       # scope: (Default)
 18       # In file testir1.py:20/        a = self.sub(x, 1)/
 19   %1(b) = Add(%0, %para4_y) {instance name: add} primitive_attrs: {output_names: [output], input_names: [x, y]}
 20       : (&lt;Tensor[Float32], ()&gt;, &lt;Tensor[Float32], ()&gt;) -&gt; (&lt;Tensor[Float32], ()&gt;)
 21       # scope: (Default)
 22       # In file testir1.py:21/        b = self.add(a, y)/
 23   %2([CNode]5) = call @3_func.22(%0, %1)
 24       : (&lt;Tensor[Float32], ()&gt;, &lt;Tensor[Float32], ()&gt;) -&gt; (&lt;Tensor[Float32], ()&gt;)
 25       # scope: (Default)
 26       # In file testir1.py:22/        c = self.mul(b, self.func(a, b))/
 27   %3(c) = Mul(%1, %2) {instance name: mul} primitive_attrs: {output_names: [output], input_names: [x, y]}
 28       : (&lt;Tensor[Float32], ()&gt;, &lt;Tensor[Float32], ()&gt;) -&gt; (&lt;Tensor[Float32], ()&gt;)
 29       # scope: (Default)
 30       # In file testir1.py:22/        c = self.mul(b, self.func(a, b))/
 31   Return(%3)
 32       : (&lt;Tensor[Float32], ()&gt;)
 33       # scope: (Default)
 34       # In file testir1.py:23/        return c/
 35 }
 36 # order:
 37 #   1: @2_Default.23:a{[0]: ValueNode `&lt;PrimitivePy&gt;` Sub, [1]: x, [2]: ValueNode `&lt;Tensor&gt;` Tensor(shape=[], dtype=Float32, value=1)}
 38 #   2: @2_Default.23:b{[0]: ValueNode `&lt;PrimitivePy&gt;` Add, [1]: a, [2]: y}
 39 #   3: @2_Default.23:[CNode]5{[0]: ValueNode `&lt;FuncGraph&gt;` 3_func.22, [1]: a, [2]: b}
 40 #   4: @2_Default.23:c{[0]: ValueNode `&lt;PrimitivePy&gt;` Mul, [1]: b, [2]: [CNode]5}
 41 #   5: @2_Default.23:[CNode]17{[0]: ValueNode `&lt;Primitive&gt;` Return, [1]: c}
 42
 43
 44 subgraph attr:
 45 undeterminate : 0
 46 subgraph instance: 3_func.22 : 0x556cab481200
 47 # In file testir1.py:16/    def func(x, y):/
 48 subgraph @3_func.22(%para5_x, %para6_y) {
 49   %0([CNode]19) = Div(%para5_x, %para6_y) {instance name: div} primitive_attrs: {output_names: [output], input_names: [x, y]}
 50       : (&lt;Tensor[Float32], ()&gt;, &lt;Tensor[Float32], ()&gt;) -&gt; (&lt;Tensor[Float32], ()&gt;)
 51       # scope: (Default)
 52       # In file testir1.py:17/        return self.div(x, y)/
 53   Return(%0)
 54       : (&lt;Tensor[Float32], ()&gt;)
 55       # scope: (Default)
 56       # In file testir1.py:17/        return self.div(x, y)/
 57 }
 58 # order:
 59 #   1: @3_func.22:[CNode]19{[0]: ValueNode `&lt;PrimitivePy&gt;` Div, [1]: x, [2]: y}
 60 #   2: @3_func.22:[CNode]21{[0]: ValueNode `&lt;Primitive&gt;` Return, [1]: [CNode]19}
 61
 62
 63 subgraph attr:
 64 subgraph instance: 1_Default_wrapper.24 : 0x556cab47b0e0
 65 # In file testir1.py:19/    def construct(self, x, y):/
 66 subgraph @1_Default_wrapper.24() {
 67   %0([CNode]6) = call @2_Default.23(%para1_x, %para2_y)
 68       : (&lt;Tensor[Float32], ()&gt;, &lt;Tensor[Float32], ()&gt;) -&gt; (&lt;Tensor[Float32], ()&gt;)
 69       # scope: (Default)
 70   Return(%0)
 71       : (&lt;Tensor[Float32], ()&gt;)
 72       # scope: (Default)
 73       # In file testir1.py:23/        return c/
 74 }
 75 # order:
 76 #   1: @1_Default_wrapper.24:[CNode]6{[0]: ValueNode `&lt;FuncGraph&gt;` 2_Default.23, [1]: x, [2]: y}
 77 #   2: @1_Default_wrapper.24:[CNode]18{[0]: ValueNode `&lt;Primitive&gt;` Return, [1]: [CNode]6}
</pre></div>
</div>
<p>The above contents can be divided into two parts. The first part is the input list and the second part is the graph structure:</p>
<ul class="simple">
<li><p>Line 1 tells us <code class="docutils literal notranslate"><span class="pre">1_construct_wrapper.24</span></code>, the name of the top MindSpore graph about the network, which is the entry graph.</p></li>
<li><p>Line 2 tells us the number of subgraph parsed by the network. There are 3 graphs in this IR. Line 42 is the entry graph <code class="docutils literal notranslate"><span class="pre">1_construct_wrapper.24</span></code>. Line 32 is graph <code class="docutils literal notranslate"><span class="pre">3_func.22</span></code>, parsed from the <code class="docutils literal notranslate"><span class="pre">func(x,</span> <span class="pre">y)</span></code> defined in the network. Line 12 is graph <code class="docutils literal notranslate"><span class="pre">2_construct.23</span></code>, parsed from the function <code class="docutils literal notranslate"><span class="pre">construct</span></code>.</p></li>
<li><p>Line 5 tells us how many inputs are in the network.</p></li>
<li><p>Line 7 to 8 are the input list, which is in the format of <code class="docutils literal notranslate"><span class="pre">%para[No.]_[name]</span> <span class="pre">:</span> <span class="pre">&lt;[data_type]x[shape]&gt;</span></code>.</p></li>
</ul>
<p>Taking graph <code class="docutils literal notranslate"><span class="pre">2_construct.23</span></code> as an example:</p>
<ul class="simple">
<li><p>Line 10 to 41 indicate the graph structure, which contains several nodes, namely, <code class="docutils literal notranslate"><span class="pre">CNode</span></code>. In this example, there are <code class="docutils literal notranslate"><span class="pre">Sub</span></code>, <code class="docutils literal notranslate"><span class="pre">Add</span></code>, <code class="docutils literal notranslate"><span class="pre">Mul</span></code> defined in the function <code class="docutils literal notranslate"><span class="pre">__init__</span></code>.</p></li>
<li><p>Line 23 shows that figure <code class="docutils literal notranslate"><span class="pre">3_func.22</span></code> is called in the form of <code class="docutils literal notranslate"><span class="pre">call</span> <span class="pre">&#64;3_func.22</span></code>, corresponding to the execution of the two-digit division of the function <code class="docutils literal notranslate"><span class="pre">func</span></code> in the script.</p></li>
<li><p>Line 36 to 41 shows the execution order of the compute nodes in the graph, corresponding to the order of code execution. The information format is: <code class="docutils literal notranslate"><span class="pre">No.:</span> <span class="pre">belonging</span> <span class="pre">graph:node</span> <span class="pre">name{[0]:</span> <span class="pre">the</span> <span class="pre">first</span> <span class="pre">input,</span> <span class="pre">[1]:</span> <span class="pre">the</span> <span class="pre">second</span> <span class="pre">input,</span> <span class="pre">...}</span></code>. For <code class="docutils literal notranslate"><span class="pre">CNode</span></code>, the first input indicates how to compute for this <code class="docutils literal notranslate"><span class="pre">CNode</span></code>.</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">CNode</span></code> (<a class="reference external" href="https://www.mindspore.cn/docs/en/r1.11/design/mindir.html#syntax">check the design of ANF-IR</a>) information format is as follows: from left to right, the ordinal number, node name - debug_name, operator name - op_name, input node - arg, attributes of the node - primitive_attrs, input and output specifications, source code parsing call stack and other information. Because the ANF graph is a unidirectional acyclic graph, the connection between nodes is displayed only based on the input relationship. The corresponding source code reflects the relationship between the <code class="docutils literal notranslate"><span class="pre">CNode</span></code> and the script source code. For example, line 15 is parsed from <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">=</span> <span class="pre">self.sub(x,</span> <span class="pre">1)</span></code>.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>  %[No.]([debug_name]) = [op_name]([arg], ...) primitive_attrs: {[key]: [value], ...}
      : (&lt;[input data_type]x[input shape]&gt;, ...) -&gt; (&lt;[output data_type]x[output shape]&gt;, ...)
      # Corresponding source code
</pre></div>
</div>
<p>About the corresponding source code:</p>
<ul class="simple">
<li><p>There are two mode for the corresponding source code displaying. The first mode is to display the complete call stack, such as <code class="docutils literal notranslate"><span class="pre">15_execute_0141.ir</span></code> on the frontend and <code class="docutils literal notranslate"><span class="pre">graph_build_0_136.ir</span></code> on the backend. The second mode only displays one code line for reducing the size of the IR file, which eliminates the call stack, such as <code class="docutils literal notranslate"><span class="pre">04_abstract_specialize_0012.ir</span></code>.</p></li>
<li><p>If the operator is a back propagation operator, the associated code line will not only display its own code, but also the corresponding forward code, identified by “Corresponding forward node candidate:”.</p></li>
<li><p>If the operator is a fusion operator, the associated code line will display the fusion related code, identified by “Corresponding code candidate:”, where the separator “-” is used to distinguish different codes.</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>After several optimizations by the compiler, the node may undergo several changes (such as operator splitting and operator merging). The source code parsing call stack information of the node may not be in a one-to-one correspondence with the script. This is only an auxiliary method.</p></li>
<li><p>After the <code class="docutils literal notranslate"><span class="pre">kernel</span> <span class="pre">select</span></code> phase at the backend, two lines of input and output specification information (that is, the content after <code class="docutils literal notranslate"><span class="pre">:</span></code>) will appear. The first line represents the specifications on the <code class="docutils literal notranslate"><span class="pre">HOST</span></code> side, and the second line represents the specifications on the <code class="docutils literal notranslate"><span class="pre">DEVICE</span></code> side.</p></li>
</ul>
</div></blockquote>
</section>
<section id="deep-sorted-ir-introduction">
<h3>deep sorted ir Introduction<a class="headerlink" href="#deep-sorted-ir-introduction" title="Permalink to this headline"></a></h3>
<p>Use a text editing software (for example, <code class="docutils literal notranslate"><span class="pre">vi</span></code>) to open the <code class="docutils literal notranslate"><span class="pre">04_abstract_specialize_0008.ir</span></code> file after setting environment variable <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">MS_DEV_SAVE_GRAPTHS_SORT_MODE=1</span></code>. The file contents are as follows (Here is MindSpore 2.0, and the content may have some imperceptible changes with the version upgrade):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>  1 #IR entry      : @1_construct.Default_wrapper.22
  2 #Total subgraph: 3
  3
  4 #attrs         :
  5 #Total params  : 2
  6
  7 %para1_x : &lt;Tensor[Float32], ()&gt;
  8 %para2_y : &lt;Tensor[Float32], ()&gt;
  9
 10 subgraph attr:
 11 subgraph instance: 1_construct.Default_wrapper.22 : 0x5568122fcf90
 12 # In file kldtest.py:19/    def construct(self, x, y):/
 13 subgraph @1_construct.Default_wrapper.22() {
 14   %0([CNode]2) = call @2_construct.Default.23(%para1_x, %para2_y)
 15       : (&lt;Tensor[Float32], ()&gt;, &lt;Tensor[Float32], ()&gt;) -&gt; (&lt;Tensor[Float32], ()&gt;)
 16       # scope: (Default)
 17   Return(%0)
 18       : (&lt;Tensor[Float32], ()&gt;)
 19       # scope: (Default)
 20       # In file kldtest.py:23/        return c/
 21 }
 22 # order:
 23 #   1: @1_construct.Default_wrapper.22:[CNode]2{[0]: ValueNode `&lt;FuncGraph&gt;` 2_construct.Default.23, [1]: x, [2]: y}
 24 #   2: @1_construct.Default_wrapper.22:[CNode]4{[0]: ValueNode `&lt;Primitive&gt;` Return, [1]: [CNode]2}
 25
 26
 27 subgraph attr:
 28 undeterminate : 0
 29 subgraph instance: 2_construct.Default.23 : 0x5568122fe9c0
 30 # In file kldtest.py:19/    def construct(self, x, y):/
 31 subgraph @2_construct.Default.23(%para3_x, %para4_y) {
 32   %0(a) = Sub(%para3_x, Tensor(shape=[], dtype=Float32, value=1)) {instance name: sub} primitive_attrs:  {output_names: [output], input_names: [x, y]}
 33       : (&lt;Tensor[Float32], ()&gt;, &lt;Tensor[Float32], (), value=...&gt;) -&gt; (&lt;Tensor[Float32], ()&gt;)
 34       # scope: (Default)
 35       # In file kldtest.py:20/        a = self.sub(x, 1)/
 36   %1(b) = Add(%0, %para4_y) {instance name: add} primitive_attrs: {output_names: [output], input_names: [x, y]}
 37       : (&lt;Tensor[Float32], ()&gt;, &lt;Tensor[Float32], ()&gt;) -&gt; (&lt;Tensor[Float32], ()&gt;)
 38       # scope: (Default)
 39       # In file kldtest.py:21/        b = self.add(a, y)/
 40   %2([CNode]9) = call @3_func.24(%0, %1)
 41       : (&lt;Tensor[Float32], ()&gt;, &lt;Tensor[Float32], ()&gt;) -&gt; (&lt;Tensor[Float32], ()&gt;)
 42       # scope: (Default)
 43       # In file kldtest.py:22/        c = self.mul(b, self.func(a, b))/
 44   %3(c) = Mul(%1, %2) {instance name: mul} primitive_attrs: {output_names: [output], input_names: [x, y]}
 45       : (&lt;Tensor[Float32], ()&gt;, &lt;Tensor[Float32], ()&gt;) -&gt; (&lt;Tensor[Float32], ()&gt;)
 46       # scope: (Default)
 47       # In file kldtest.py:22/        c = self.mul(b, self.func(a, b))/
 48   Return(%3)
 49       : (&lt;Tensor[Float32], ()&gt;)
 50       # scope: (Default)
 51       # In file kldtest.py:23/        return c/
 52 }
 53 # order:
 54 #   1: @2_construct.Default.23:a{[0]: ValueNode `&lt;PrimitivePy&gt;` Sub, [1]: x, [2]: ValueNode `&lt;Tensor&gt;` Tensor(shape=[], dtype=Float32, value=1)}
 55 #   2: @2_construct.Default.23:b{[0]: ValueNode `&lt;PrimitivePy&gt;` Add, [1]: a, [2]: y}
 56 #   3: @2_construct.Default.23:[CNode]9{[0]: ValueNode `&lt;FuncGraph&gt;` 3_func.24, [1]: a, [2]: b}
 57 #   4: @2_construct.Default.23:c{[0]: ValueNode `&lt;PrimitivePy&gt;` Mul, [1]: b, [2]: [CNode]9}
 58 #   5: @2_construct.Default.23:[CNode]18{[0]: ValueNode `&lt;Primitive&gt;` Return, [1]: c}
 59
 60
 61 subgraph attr:
 62 undeterminate : 0
 63 subgraph instance: 3_func.24 : 0x556812302e20
 64 # In file kldtest.py:16/    def func(x, y):/
 65 subgraph @3_func.24(%para3_x, %para4_y) {
 66   %0([CNode]20) = Div(%para3_x, %para4_y) {instance name: div} primitive_attrs: {output_names: [output], input_names: [x, y]}
 67       : (&lt;Tensor[Float32], ()&gt;, &lt;Tensor[Float32], ()&gt;) -&gt; (&lt;Tensor[Float32], ()&gt;)
 68       # scope: (Default)
 69       # In file kldtest.py:17/        return self.div(x, y)/
 70   Return(%0)
 71       : (&lt;Tensor[Float32], ()&gt;)
 72       # scope: (Default)
 73       # In file kldtest.py:17/        return self.div(x, y)/
 74 }
 75 # order:
 76 #   1: @3_func.24:[CNode]20{[0]: ValueNode `&lt;PrimitivePy&gt;` Div, [1]: x, [2]: y}
 77 #   2: @3_func.24:[CNode]21{[0]: ValueNode `&lt;Primitive&gt;` Return, [1]: [CNode]20}
</pre></div>
</div>
<p>Above, it lists all the graphs beginning with the entry graph.</p>
</section>
<section id="dot-introduction">
<h3>dot Introduction<a class="headerlink" href="#dot-introduction" title="Permalink to this headline"></a></h3>
<p>We can use this file by <a class="reference external" href="http://graphviz.org/">graphviz</a> as the input to generate images for users to view the model structure. For example, under the Linux operating system, we can convert a PNG image by the following command.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>dot<span class="w"> </span>-Tpng<span class="w"> </span>-o<span class="w"> </span>04_abstract_specialize_0014.png<span class="w"> </span>04_abstract_specialize_0014.dot
</pre></div>
</div>
<p>The transformed image is shown below, and we can visually see the model structure. The different black boxes distinguish different subgraphs, and the blue arrows between graphs represent calling another graph. The blue area represents the parameter, the rectangle represents the parameter list of the graph, the hexagon and the black arrow represent the parameter as the input of the CNode to participate in the calculation process. The yellow rectangle represents the CNode. As can be seen from the picture, the CNode input starts from index 0, and the 0th input (that is, the purple or green area) represents what calculation the operator will perform, which is connected by a dotted arrow. The type is usually an operator primitive, or it can also be another graph. The rest inputs are the parameters required for the calculation.</p>
<p><img alt="04_abstract_specialize_0014.png" src="../_images/dot_to_png.png" /></p>
<p>For models with multiple operators, the picture will be very large. It is recommended by using the visualization component <a class="reference external" href="https://www.mindspore.cn/mindinsight/docs/en/r1.11/dashboard.html#computational-graph-visualization">MindSpore Insight</a> to visualize compute graphs.</p>
</section>
</section>
<section id="how-to-derive-the-cause-of-the-failure-based-on-the-analyze-fail-ir-file-analysis-graph">
<h2>How to derive the cause of the failure based on the analyze_fail.ir file analysis graph<a class="headerlink" href="#how-to-derive-the-cause-of-the-failure-based-on-the-analyze-fail-ir-file-analysis-graph" title="Permalink to this headline"></a></h2>
<p>In the process of MindSpore compiling a graph, the exceptions about graph evaluating fail usually happen. But we can find the reason by analyzing the exception information and analyze_fail.ir.</p>
<section id="example-1-parameters-number-mismatch">
<h3>Example 1: parameters number mismatch<a class="headerlink" href="#example-1-parameters-number-mismatch" title="Permalink to this headline"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>  <span class="mi">1</span> <span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
  <span class="mi">2</span> <span class="kn">import</span> <span class="nn">mindspore.nn</span> <span class="k">as</span> <span class="nn">nn</span>
  <span class="mi">3</span>
  <span class="mi">4</span> <span class="kn">from</span> <span class="nn">mindspore.nn</span> <span class="kn">import</span> <span class="n">Cell</span>
  <span class="mi">5</span> <span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">ops</span>
  <span class="mi">6</span>
  <span class="mi">7</span>
  <span class="mi">8</span> <span class="n">ms</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">GRAPH_MODE</span><span class="p">)</span>
  <span class="mi">9</span> <span class="n">ms</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">save_graphs</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
 <span class="mi">10</span>
 <span class="mi">11</span> <span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
 <span class="mi">12</span>     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
 <span class="mi">13</span>         <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
 <span class="mi">14</span>         <span class="bp">self</span><span class="o">.</span><span class="n">add</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">Add</span><span class="p">()</span>
 <span class="mi">15</span>         <span class="bp">self</span><span class="o">.</span><span class="n">sub</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">Sub</span><span class="p">()</span>
 <span class="mi">16</span>         <span class="bp">self</span><span class="o">.</span><span class="n">mul</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">Mul</span><span class="p">()</span>
 <span class="mi">17</span>         <span class="bp">self</span><span class="o">.</span><span class="n">div</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">Div</span><span class="p">()</span>
 <span class="mi">18</span>
 <span class="mi">19</span>     <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
 <span class="mi">20</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
 <span class="mi">21</span>
 <span class="mi">22</span>     <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
 <span class="mi">23</span>         <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
 <span class="mi">24</span>         <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
 <span class="mi">25</span>         <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
 <span class="mi">26</span>         <span class="k">return</span> <span class="n">c</span>
 <span class="mi">27</span>
 <span class="mi">28</span> <span class="n">input1</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">ms</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
 <span class="mi">29</span> <span class="n">input2</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">ms</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
 <span class="mi">30</span> <span class="n">net</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
 <span class="mi">31</span> <span class="n">out</span> <span class="o">=</span> <span class="n">net</span><span class="p">(</span><span class="n">input1</span><span class="p">,</span> <span class="n">input2</span><span class="p">)</span>
 <span class="mi">32</span> <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</pre></div>
</div>
<p>An error happens.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>  1 [EXCEPTION] ANALYZER(31946,7f6f03941740,python):2021-09-18-15:10:49.094.863 [mindspore/ccsrc/pipeline/jit/static_analysis/stack_frame.cc:85] DoJump] The parameters number of the function is 2, but the number of provided arguments is 3.
  2 FunctionGraph ID : func.18
  3 NodeInfo: In file test.py(17)
  4     def func(x, y):IR file with different graph printing order
  5
  6 Traceback (most recent call last):
  7   File &quot;test.py&quot;, line 29, in &lt;module&gt;
  8     out = net(input1, input2)
  9   File &quot;/home/workspace/mindspore/mindspore/nn/cell.py&quot;, line 404, in __call__
 10     out = self.compile_and_run(*inputs)
 11   File &quot;/home/workspace/mindspore/mindspore/nn/cell.py&quot;, line 682, in compile_and_run
 12     self.compile(*inputs)
 13   File &quot;/home/workspace/mindspore/mindspore/nn/cell.py&quot;, line 669, in compile
 14     _cell_graph_executor.compile(self, *inputs, phase=self.phase, auto_parallel_mode=self._auto_parallel_mode)
 15   File &quot;/home/workspace/mindspore/mindspore/common/api.py&quot;, line 542, in compile
 16     result = self._graph_executor.compile(obj, args_list, phase, use_vm, self.queue_name)
 17 TypeError: mindspore/ccsrc/pipeline/jit/static_analysis/stack_frame.cc:85 DoJump] The parameters number of the function is 2, but the number of provided arguments is 3.
 18 FunctionGraph ID : func.18
 19 NodeInfo: In file test.py(17)
 20     def func(x, y):
 21
 22 The function call stack (See file &#39;/home/workspace/mindspore/rank_0/om/analyze_fail.ir&#39; for more details):
 23 # 0 In file test.py(24)
 24         return c
 25         ^
 26 # 1 In file test.py(23)
 27         c = self.mul(b, self.func(a, a, b))
 28                         ^
</pre></div>
</div>
<p>Above exception is “TypeError: mindspore/ccsrc/pipeline/jit/static_analysis/stack_frame.cc:85 DoJump] The parameters number of the function is 2, but the number of provided arguments is 3…”.
And it tells us <code class="docutils literal notranslate"><span class="pre">FunctionGraph</span> <span class="pre">ID</span> <span class="pre">:</span> <span class="pre">func.18</span></code> only needs two parameters, but actually gives 3.
We can find the related code is <code class="docutils literal notranslate"><span class="pre">self.func(a,</span> <span class="pre">a,</span> <span class="pre">b)</span></code> from ‘The function call stack … In file test.py(23)’.
Easily, by checking the code, we know that we gave too much parameter to the calling function.</p>
<p>Sometimes when the exception information is not enough easy to understand, or we want to see the part of graph information that have evaluated, we use text editing software (e.g., vi) to open the file (in parentheses on line 20) that prompts in the error message: <code class="docutils literal notranslate"><span class="pre">/home/workspace/mindspore/rank_0/om/analyze_fail.ir</span></code> with the following content (Here is MindSpore 2.0, and the content may have some imperceptible changes with the version upgrade):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>  1 # 1.This file shows the parsed IR info when graph evaluating failed to help find the problem.
  2 # 2.You can search the last `------------------------&gt;` to the node which is inferred failed.
  3 # 3.Refer to https://www.mindspore.cn/search?inputValue=analyze_fail.ir to get more instructions.
  4 # ===============================================================================
  5
  6 subgraph attr:
  7 subgraph instance: Default_wrapper.8 : 0x55b95477d120
  8 # In file testir1.py:22/    def construct(self, x, y):/
  9 subgraph @Default_wrapper.8(
 10         %para1_x : &lt;Tensor[Float32], ()&gt;
 11         , %para2_y : &lt;Tensor[Float32], ()&gt;
 12     ) {
 13
 14 #------------------------&gt; 0
 15   %1([CNode]6) = call @Default.7(%para1_x, %para2_y)
 16       :(&lt;Tensor[Float32], ()&gt;, &lt;Tensor[Float32], ()&gt;) -&gt; (`&lt;null&gt;`)
 17       #scope: Default
 18   Primitive::Return{prim_type=1}(%1)
 19       :(`&lt;null&gt;`)
 20       #scope: Default
 21       # In file testir1.py:26/        return c/
 22 }
 23 # order:
 24 #   1: @Default_wrapper.8:[CNode]6{[0]: ValueNode `&lt;FuncGraph&gt;` Default.7, [1]: x, [2]: y}
 25 #   2: @Default_wrapper.8:[CNode]18{[0]: ValueNode `&lt;Primitive&gt;` Return, [1]: [CNode]6}
 26
 27
 28 subgraph attr:
 29 subgraph instance: Default.7 : 0x55b95477c800
 30 # In file testir1.py:22/    def construct(self, x, y):/
 31 subgraph @Default.7(
 32         %para3_x : &lt;Tensor[Float32], ()&gt;
 33         , %para4_y : &lt;Tensor[Float32], ()&gt;
 34     ) {
 35   %1(a) = DoSignaturePrimitive::S-Prim-Sub{prim_type=1}[output_names=[&quot;output&quot;], input_names=[&quot;x&quot;, &quot;y&quot;]](%para3_x, I64(1))
 36       :(&lt;Tensor[Float32], ()&gt;, &lt;Int64, NoShape&gt;) -&gt; (&lt;Tensor[Float32], ()&gt;)
 37       #scope: Default
 38       # In file testir1.py:23/        a = self.sub(x, 1)/
 39   %2(b) = DoSignaturePrimitive::S-Prim-Add{prim_type=1}[output_names=[&quot;output&quot;], input_names=[&quot;x&quot;, &quot;y&quot;]](%1, %para4_y)
 40       :(&lt;Tensor[Float32], ()&gt;, &lt;Tensor[Float32], ()&gt;) -&gt; (&lt;Tensor[Float32], ()&gt;)
 41       #scope: Default
 42       # In file testir1.py:24/        b = self.add(a, y)/
 43
 44 #------------------------&gt; 1
 45   %3([CNode]5) = call @func.20(%1, %1, %2)
 46       :(&lt;Tensor[Float32], ()&gt;, &lt;Tensor[Float32], ()&gt;, &lt;Tensor[Float32], ()&gt;) -&gt; (`&lt;null&gt;`)
 47       #scope: Default
 48       # In file testir1.py:25/        c = self.mul(b, self.func(a, a, b))/
 49   %4(c) = DoSignaturePrimitive::S-Prim-Mul{prim_type=1}[output_names=[&quot;output&quot;], input_names=[&quot;x&quot;, &quot;y&quot;]](%2, %3)
 50       :(&lt;Tensor[Float32], ()&gt;, `&lt;null&gt;`) -&gt; (`&lt;null&gt;`)
 51       #scope: Default
 52       # In file testir1.py:25/        c = self.mul(b, self.func(a, a, b))/
 53   Primitive::Return{prim_type=1}(%4)
 54       :(`&lt;null&gt;`)
 55       #scope: Default
 56       # In file testir1.py:26/        return c/
 57 }
 58 # order:
 59 #   1: @Default.7:a{[0]: a, [1]: ValueNode `&lt;Int64Imm&gt;` 1, [2]: ValueNode `&lt;Float&gt;` Float32}
 60 #   2: @Default.7:a{[0]: ValueNode `&lt;DoSignaturePrimitive&gt;` S-Prim-Sub, [1]: x, [2]: ValueNode `&lt;Int64Imm&gt;` 1}
 61 #   3: @Default.7:b{[0]: ValueNode `&lt;DoSignaturePrimitive&gt;` S-Prim-Add, [1]: a, [2]: y}
 62 #   4: @Default.7:[CNode]5{[0]: ValueNode `&lt;FuncGraph&gt;` func.20, [1]: a, [2]: a, [3]: b}
 63 #   5: @Default.7:c{[0]: ValueNode `&lt;DoSignaturePrimitive&gt;` S-Prim-Mul, [1]: b, [2]: [CNode]5}
 64 #   6: @Default.7:[CNode]17{[0]: ValueNode `&lt;Primitive&gt;` Return, [1]: c}
 65
 66
 67 #===============================================================================
 68 # num of function graphs in stack: 2
</pre></div>
</div>
<p>The file <code class="docutils literal notranslate"><span class="pre">analyze_fail.ir</span></code> has the same information format with deep sorted ir file. The only difference is <code class="docutils literal notranslate"><span class="pre">analyze_fail.ir</span></code> will locate the node which inferring failed.
Searching the point by the text of <code class="docutils literal notranslate"><span class="pre">------------------------&gt;</span></code>, we reach the last position of the <code class="docutils literal notranslate"><span class="pre">------------------------&gt;</span> <span class="pre">1</span></code> at line 44. This last arrow points to the node that derives the error, which is <code class="docutils literal notranslate"><span class="pre">%3([CNode]5)</span> <span class="pre">=</span> <span class="pre">call</span> <span class="pre">&#64;func.20(%1,</span> <span class="pre">%1,</span> <span class="pre">%2)</span> <span class="pre">....</span></code>, which expresses the information of the node in IR. How to view the deep sorted ir file has been described in the <code class="docutils literal notranslate"><span class="pre">deep</span> <span class="pre">sorted</span> <span class="pre">ir</span> <span class="pre">Introduction</span></code> section earlier, and will not be repeated here.
The node at line 45 to 48 have an error. Its IR expression is <code class="docutils literal notranslate"><span class="pre">%3([CNode]5)</span> <span class="pre">=</span> <span class="pre">call</span> <span class="pre">&#64;func.20(%1,</span> <span class="pre">%1,</span> <span class="pre">%2)</span> <span class="pre">...</span></code>. We can know the node have 3 parameters from <code class="docutils literal notranslate"><span class="pre">(%1,</span> <span class="pre">%1,</span> <span class="pre">%2)</span></code>. From the source parsing call stack, it can be known that the function is actually <code class="docutils literal notranslate"><span class="pre">self.func</span></code>, which is defined in the script as <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">dunc(x,</span> <span class="pre">y):...</span></code>.
In the function definition, only two parameters are needed, so there will be a deduction failure error, and we need to modify the number of parameters passed in the script to solve the problem.</p>
</section>
<section id="example-2-biasadd-inputs-shape-mismatch">
<h3>Example 2: BiasAdd inputs shape mismatch<a class="headerlink" href="#example-2-biasadd-inputs-shape-mismatch" title="Permalink to this headline"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>  <span class="mi">1</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
  <span class="mi">2</span> <span class="kn">import</span> <span class="nn">mindspore</span>
  <span class="mi">3</span> <span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">nn</span><span class="p">,</span> <span class="n">ops</span><span class="p">,</span> <span class="n">set_context</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">Parameter</span>
  <span class="mi">4</span> <span class="kn">from</span> <span class="nn">mindspore.common.initializer</span> <span class="kn">import</span> <span class="n">initializer</span>
  <span class="mi">5</span>
  <span class="mi">6</span> <span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
  <span class="mi">7</span>   <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="mi">8</span>     <span class="nb">super</span><span class="p">(</span><span class="n">Net</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
  <span class="mi">9</span>     <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">initializer</span><span class="p">(</span><span class="s1">&#39;normal&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">8</span><span class="p">]),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;weight&quot;</span><span class="p">)</span>
 <span class="mi">10</span>     <span class="bp">self</span><span class="o">.</span><span class="n">bias</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">initializer</span><span class="p">(</span><span class="s1">&#39;zeros&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">4</span><span class="p">]),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;bias&quot;</span><span class="p">)</span>
 <span class="mi">11</span>
 <span class="mi">12</span>     <span class="bp">self</span><span class="o">.</span><span class="n">matmul</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">MatMul</span><span class="p">()</span>
 <span class="mi">13</span>     <span class="bp">self</span><span class="o">.</span><span class="n">bias_add</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">BiasAdd</span><span class="p">()</span>
 <span class="mi">14</span>
 <span class="mi">15</span>   <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x1</span><span class="p">):</span>
 <span class="mi">16</span>     <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span>
 <span class="mi">17</span>     <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bias_add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bias</span><span class="p">)</span>
 <span class="mi">18</span>     <span class="k">return</span> <span class="n">x</span>
 <span class="mi">19</span>
 <span class="mi">20</span> <span class="n">net</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
 <span class="mi">21</span> <span class="n">x</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="mi">32</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span> <span class="n">mindspore</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
 <span class="mi">22</span> <span class="n">out</span> <span class="o">=</span> <span class="n">net</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
 <span class="mi">23</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;out&#39;</span><span class="p">,</span> <span class="n">out</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<p>An error happens.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span> Traceback (most recent call last):
  File &quot;test.py&quot;, line 22, in &lt;module&gt;
    out = net(x)
  File &quot;/home/workspace/mindspore/build/package/mindspore/nn/cell.py&quot;, line 573, in __call__
    out = self.compile_and_run(*args)
  File &quot;/home/workspace/mindspore/build/package/mindspore/nn/cell.py&quot;, line 956, in compile_and_run
    self.compile(*inputs)
  File &quot;/home/workspace/mindspore/build/package/mindspore/nn/cell.py&quot;, line 929, in compile
    _cell_graph_executor.compile(self, *inputs, phase=self.phase, auto_parallel_mode=self._auto_parallel_mode)
  File &quot;/home/workspace/mindspore/build/package/mindspore/common/api.py&quot;, line 1076, in compile
    result = self._graph_executor.compile(obj, args_list, phase, self._use_vm_mode())
ValueError: For &#39;BiasAdd&#39;, bias[0] shape must be equal to input_x[1] shape when data_format is NHWC or input_x[1] shape, but got bias[0] shape: 4, input_x[1] or input_x[1] shape: 8.

----------------------------------------------------
- The Traceback of Net Construct Code:
----------------------------------------------------
The function call stack (See file &#39;/home/workspace/mindspore/rank_0/om/analyze_fail.ir&#39; for more details. Get instructions about `analyze_fail.ir` at https://www.mindspore.cn/search?inputValue=analyze_fail.ir):
# 0 In file test.py(17)
    x = self.bias_add(x, self.bias)
        ^

----------------------------------------------------
- C++ Call Stack: (For framework developers)
----------------------------------------------------
mindspore/core/ops/bias_add.cc:71 BiasAddInferShape
</pre></div>
</div>
<p>The above reports that the errors is caused by the mismatching of the shape of the first input and the second input of the operator <code class="docutils literal notranslate"><span class="pre">BiasAdd</span></code>. To further understand what changes have taken place in the shape of the operator, we use text editing software (e.g., vi) to open the file that prompts in the error message: <code class="docutils literal notranslate"><span class="pre">/home/workspace/mindspore/rank_0/om/analyze_fail.ir</span></code> with the following content (Here is MindSpore 2.0, and the content may have some imperceptible changes with the version upgrade):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>  1 # 1.This file shows the parsed IR info when graph evaluating failed to help find the problem.
  2 # 2.You can search the last `------------------------&gt;` to the node which is inferred failed.
  3 # 3.Refer to https://www.mindspore.cn/search?inputValue=analyze_fail.ir to get more instructions.
  4 # ===============================================================================
  5
  6 subgraph attr:
  7 subgraph instance: Default_wrapper.1 : 0x55ef771b9dd0
  8 # In file testir1.py:14/    def construct(self, x1):/
  9 subgraph @Default_wrapper.1(
 10         %para1_x1 : &lt;Tensor[Float32], (3, 32)&gt;
 11         , %para2_bias : &lt;Ref[Tensor(F32)], (4)&gt;  :  has_default
 12         , %para3_weight : &lt;Ref[Tensor(F32)], (32, 8)&gt;  :  has_default
 13     ) {
 14
 15 #------------------------&gt; 0
 16   %1([CNode]3) = call @Default.2(%para1_x1)
 17       :(&lt;Tensor[Float32], (3, 32)&gt;) -&gt; (`&lt;null&gt;`)
 18       #scope: Default
 19   Primitive::Return{prim_type=1}(%1)
 20       :(`&lt;null&gt;`)
 21       #scope: Default
 22       # In file testir1.py:17/        return x/
 23 }
 24 # order:
 25 #   1: @Default_wrapper.1:[CNode]3{[0]: ValueNode `&lt;FuncGraph&gt;` Default.2, [1]: x1}
 26 #   2: @Default_wrapper.1:[CNode]4{[0]: ValueNode `&lt;Primitive&gt;` Return, [1]: [CNode]3}
 27
 28
 29 subgraph attr:
 30 subgraph instance: Default.2 : 0x55ef771b11a0
 31 # In file testir1.py:14/    def construct(self, x1):/
 32 subgraph @Default.2 parent: [subgraph @Default_wrapper.1](
 33         %para4_x1 : &lt;Tensor[Float32], (3, 32)&gt;
 34     ) {
 35   %1(x) = DoSignaturePrimitive::S-Prim-MatMul{prim_type=1}[output_names=[&quot;output&quot;], transpose_a=Bool(0), input_names=[&quot;x1&quot;, &quot;x2&quot;], transpose_x2=Bool(0), transpose_x1=Bool(0), transpose_b=Bool(    0)](%para4_x1, %para3_weight)
 36       :(&lt;Tensor[Float32], (3, 32)&gt;, &lt;Ref[Tensor(F32)], (32, 8)&gt;) -&gt; (&lt;Tensor[Float32], (3, 8)&gt;)
 37       #scope: Default
 38       # In file testir1.py:15/        x = self.matmul(x1, self.weight)/
 39
 40 #------------------------&gt; 1
 41   %2(x) = DoSignaturePrimitive::S-Prim-BiasAdd{prim_type=1}[output_names=[&quot;output&quot;], format=&quot;NCHW&quot;, input_names=[&quot;x&quot;, &quot;b&quot;], data_format=&quot;NCHW&quot;](%1, %para2_bias)
 42       :(&lt;Tensor[Float32], (3, 8)&gt;, &lt;Ref[Tensor(F32)], (4)&gt;) -&gt; (`&lt;null&gt;`)
 43       #scope: Default
 44       # In file testir1.py:16/        x = self.bias_add(x, self.bias)/
 45   Primitive::Return{prim_type=1}(%2)
 46       :(`&lt;null&gt;`)
 47       #scope: Default
 48       # In file testir1.py:17/        return x/
 49 }
 50 # order:
 51 #   1: @Default.2:x{[0]: ValueNode `&lt;DoSignaturePrimitive&gt;` S-Prim-MatMul, [1]: x1, [2]: weight}
 52 #   2: @Default.2:x{[0]: ValueNode `&lt;DoSignaturePrimitive&gt;` S-Prim-BiasAdd, [1]: x, [2]: bias}
 53 #   3: @Default.2:[CNode]5{[0]: ValueNode `&lt;Primitive&gt;` Return, [1]: x}
 54
 55
 56 #===============================================================================
 57 # num of function graphs in stack: 2/3 (Ignored 1 internal frames).
</pre></div>
</div>
<p>Search <code class="docutils literal notranslate"><span class="pre">------------------------&gt;</span></code> to the position where inferring failed at line 41. According to <code class="docutils literal notranslate"><span class="pre">...(%1,</span> <span class="pre">%para2_bias)</span>&#160;&#160;&#160; <span class="pre">:(&lt;Tensor[Float32],</span> <span class="pre">(3,</span> <span class="pre">8)&gt;,</span> <span class="pre">&lt;Ref[Tensor(F32)],</span> <span class="pre">(4)&gt;)</span> <span class="pre">-&gt;</span> <span class="pre">(</span></code><null><code class="docutils literal notranslate"><span class="pre">)</span></code>, <code class="docutils literal notranslate"><span class="pre">BiasAdd</span></code>’s inputs are <code class="docutils literal notranslate"><span class="pre">%1</span></code> and <code class="docutils literal notranslate"><span class="pre">%para2_bias</span></code>. That <code class="docutils literal notranslate"><span class="pre">%1</span></code>’ with shape <code class="docutils literal notranslate"><span class="pre">[3,</span> <span class="pre">8]</span></code> and <code class="docutils literal notranslate"><span class="pre">%para2_bias</span></code> with shape <code class="docutils literal notranslate"><span class="pre">[4]</span></code> doesn’t meet the requirement about <code class="docutils literal notranslate"><span class="pre">bias</span> <span class="pre">(Tensor)</span> <span class="pre">-</span> <span class="pre">The</span> <span class="pre">bias</span> <span class="pre">tensor,</span> <span class="pre">with</span> <span class="pre">shape</span> <span class="pre">(C).</span> <span class="pre">C</span> <span class="pre">must</span> <span class="pre">be</span> <span class="pre">the</span> <span class="pre">same</span> <span class="pre">as</span> <span class="pre">channel</span> <span class="pre">dimension</span> <span class="pre">C</span> <span class="pre">of</span> <span class="pre">input_x...</span></code> for <code class="docutils literal notranslate"><span class="pre">BiasAdd</span></code> API. Thus, an error happens.</p>
<p>To solve this problem, we need modify the shape of <code class="docutils literal notranslate"><span class="pre">%1</span></code> or <code class="docutils literal notranslate"><span class="pre">%para2_bias</span></code> (namely <code class="docutils literal notranslate"><span class="pre">self.bias</span></code>).</p>
<ul class="simple">
<li><p>For <code class="docutils literal notranslate"><span class="pre">%para2_bias</span></code> (namely <code class="docutils literal notranslate"><span class="pre">self.bias</span></code>), we modify the shape of <code class="docutils literal notranslate"><span class="pre">self.bias</span></code> by <code class="docutils literal notranslate"><span class="pre">self.bias</span> <span class="pre">=</span> <span class="pre">Parameter(initializer('zeros',</span> <span class="pre">[8]),</span> <span class="pre">name=&quot;bias&quot;)</span></code>.</p></li>
<li><p>For <code class="docutils literal notranslate"><span class="pre">%1</span></code>, we need know what <code class="docutils literal notranslate"><span class="pre">%1</span></code> is. According to line 35, <code class="docutils literal notranslate"><span class="pre">%1</span></code> is a <code class="docutils literal notranslate"><span class="pre">MatMul</span></code> with output shape <code class="docutils literal notranslate"><span class="pre">[3,</span> <span class="pre">8]</span></code>. Its inputs are <code class="docutils literal notranslate"><span class="pre">(%para4_x1,</span> <span class="pre">%para3_weight)</span></code>. The first input (namely given arg <code class="docutils literal notranslate"><span class="pre">x</span></code>) shape is <code class="docutils literal notranslate"><span class="pre">[3,</span> <span class="pre">32]</span></code> and the second input (namely <code class="docutils literal notranslate"><span class="pre">self.weight</span></code>) shape is <code class="docutils literal notranslate"><span class="pre">[32,</span> <span class="pre">8]</span></code>. To meet the requirement of <code class="docutils literal notranslate"><span class="pre">BiasAdd</span></code> with the data shape <code class="docutils literal notranslate"><span class="pre">[4]</span></code>, the shape of <code class="docutils literal notranslate"><span class="pre">%1</span></code> output needs to be <code class="docutils literal notranslate"><span class="pre">[3,</span> <span class="pre">4]</span></code>. Therefore, we modify <code class="docutils literal notranslate"><span class="pre">self.weight</span></code> by <code class="docutils literal notranslate"><span class="pre">self.weight</span> <span class="pre">=</span> <span class="pre">Parameter(initializer('normal',</span> <span class="pre">[32,</span> <span class="pre">4]),</span> <span class="pre">name=&quot;weight&quot;)</span></code>.</p></li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="custom_debug.html" class="btn btn-neutral float-left" title="Custom Debugging Information" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="dump.html" class="btn btn-neutral float-right" title="Using Dump in the Graph Mode" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright MindSpore.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 
</body>
</html>