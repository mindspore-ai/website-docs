<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Error Analysis &mdash; MindSpore master documentation</title><script>;(()=>{const e=localStorage.getItem("ms-theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;(e?"dark"===e:t)&&document.documentElement.setAttribute("data-o-theme","dark")})();</script><link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script><script src="../_static/jquery.js"></script>
        <script src="../_static/js/theme.js"></script><script src="../_static/underscore.js"></script><script src="../_static/doctools.js"></script><script crossorigin="anonymous" integrity="sha256-1fEPhSsRKlFKGfK3eO710tEweHh1fwokU5wFGDHO+vg=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Custom Debugging Information" href="custom_debug.html" />
    <link rel="prev" title="Function Debug" href="function_debug.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> MindSpore
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Data Processing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dataset/augment.html">Auto Augmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dataset/cache.html">Single-Node Data Cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dataset/optimize.html">Optimizing the Data Processing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Graph Compilation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../network/control_flow.html">Process Control Statements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../network/op_overload.html">Compiling Performance Optimization for Static Graph Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../network/jit_class.html">Calling the Custom Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../network/constexpr.html">Construct Constants In the Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../network/dependency_control.html">Dependency Control</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Model Training Optimization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../optimize/execution_opt.html">Sinking Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../optimize/gradient_accumulation.html">Gradient Accumulation Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../optimize/adaptive_summation.html">Adaptive Gradient Summation Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../optimize/dimention_reduce_training.html">Dimension Reduction Training Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../optimize/thor.html">Second-order Optimization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Custom Operator</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../operation/op_custom.html">Custom Operators (Custom-based)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../operation/ms_kernel.html">MindSpore Hybrid Syntax Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../operation/op_custom_adv.html">Advanced Usage of Custom Operators</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Automatic Vectorization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../vmap/vmap.html">Automatic Vectorization (Vmap)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Model Inference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../infer/inference.html">Inference Model Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infer/gpu_mindir.html">Inference on a GPU</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infer/ascend_910_mindir.html">Inference on the Ascend 910 AI processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infer/ascend_310_mindir.html">Inference Using the MindIR Model on Ascend 310 AI Processors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infer/ascend_310_air.html">Inference on the Ascend 310 AI Processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infer/model_compression.html">Model Compression</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Debugging and Tuning</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="function_debug.html">Function Debug</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Error Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="custom_debug.html">Custom Debugging Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="mindir.html">Reading IR</a></li>
<li class="toctree-l2"><a class="reference internal" href="dump.html">Using Dump in the Graph Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="pynative_debug.html">Debugging in PyNative Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="pynative.html">Applying PyNative Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="fixing_randomness.html">Fixed Randomness to Reproduce Run Results of Script</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="performance_optimization.html">Performance Tuning</a></li>
<li class="toctree-l1"><a class="reference external" href="https://mindspore.cn/mindinsight/docs/en/r2.0.0-alpha/accuracy_problem_preliminary_location.html">Precision Optimization↗</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Distributed Parallel</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../parallel/introduction.html">Distributed Parallel Training Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parallel/parallel_training_quickstart.html">Quick Start Distributed Parallel Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parallel/communicate_ops.html">Distributed Set Communication Primitives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parallel/distributed_case.html">Distributed Case</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parallel/distributed_inference.html">Distributed Inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parallel/save_load.html">Saving and Loading Models in Hybrid Parallel Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parallel/fault_recover.html">Distributed Fault Recovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parallel/multi_dimensional.html">Multi Dimensional</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parallel/resilience_train_and_predict.html">Distributed Resilience Training and Inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parallel/other_features.html">Other Features</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Environment Variables</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../env/env_var_list.html">Environment Variables</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MindSpore</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="function_debug.html">Function Debug</a> &raquo;</li>
      <li>Error Analysis</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/debug/error_analyze.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="error-analysis">
<h1>Error Analysis<a class="headerlink" href="#error-analysis" title="Permalink to this headline"></a></h1>
<p><a href="https://gitee.com/mindspore/docs/blob/r2.0.0-alpha/tutorials/experts/source_en/debug/error_analyze.md" target="_blank"><img src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/r2.0.0-alpha/resource/_static/logo_source_en.png"></a>  </p>
<p>As mentioned before, error analysis refers to analyzing and inferring possible error causes based on the obtained network and framework information (such as error messages and network code).</p>
<p>During error analysis, the first step is to identify the scenario where the error occurs and determine whether the error is caused by data loading and processing or network construction and training. You can determine whether it is a data or network problem based on the format of the error message. In the distributed parallel scenario, you can use a single-device execution network for verification. If there is no data loading and processing or network construction and training problem, the error is caused by a parallel scenario problem. The following describes the error analysis methods in different scenarios.</p>
<section id="data-loading-and-processing-error-analysis">
<h2>Data Loading and Processing Error Analysis<a class="headerlink" href="#data-loading-and-processing-error-analysis" title="Permalink to this headline"></a></h2>
<p>When an error is reported during data processing, check whether C++ error messages are contained as shown in Figure 1. Typically, the name of the data processing operation using the C++ language is the same as that using Python. Therefore, you can determine the data processing operation that reports the error based on the error message and locate the error in the Python code.</p>
<p><img alt="minddata-errmsg" src="https://gitee.com/mindspore/docs/raw/r2.0.0-alpha/tutorials/experts/source_zh_cn/debug/images/minddata_errmsg.png" /></p>
<p>Figure 1</p>
<p>As shown in the following figure, <code class="docutils literal notranslate"><span class="pre">batch_op.cc</span></code> reports a C++ error. The batch operation combines multiple consecutive pieces of data in a dataset into a batch for data processing, which is implemented at the backend. According to the error description, the input data does not meet the parameter requirements of the batch operation. Data to be batch operated has the same shape, and the sizes of different shapes are displayed.</p>
<p>Data loading and processing has three phases: data preparation, data loading, and data augmentation. The following table lists common errors.</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Error Type</p></th>
<th class="head"><p>Error Description</p></th>
<th class="head"><p>Case Analysis</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Data preparation error</p></td>
<td><p>The dataset is faulty, involving a path or MindRecord file problem.</p></td>
<td><p><a class="reference external" href="https://www.mindspore.cn/tutorials/experts/en/r2.0.0-alpha/debug/minddata_debug.html">Error Case</a></p></td>
</tr>
<tr class="row-odd"><td><p>Data loading error</p></td>
<td><p>Incorrect resource configuration, customized loading method, or iterator usage in the data loading phase.</p></td>
<td><p><a class="reference external" href="https://www.mindspore.cn/tutorials/experts/en/r2.0.0-alpha/debug/minddata_debug.html">Error Case</a></p></td>
</tr>
<tr class="row-even"><td><p>Data augmentation error</p></td>
<td><p>Unmatched data format/size, high resource usage, or multi-thread suspension.</p></td>
<td><p><a class="reference external" href="https://www.mindspore.cn/tutorials/experts/en/r2.0.0-alpha/debug/minddata_debug.html">Error Case</a></p></td>
</tr>
</tbody>
</table>
</section>
<section id="network-construction-and-training-error-analysis">
<h2>Network Construction and Training Error Analysis<a class="headerlink" href="#network-construction-and-training-error-analysis" title="Permalink to this headline"></a></h2>
<p>The network construction and training process can be executed in the dynamic graph mode or static graph mode, and has two phases: build and execution. The error analysis method varies according to the execution phase in different modes.</p>
<p>The following table lists common network construction and training errors.</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Error Type</p></th>
<th class="head"><p>Error Description</p></th>
<th class="head"><p>Case Analysis</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Incorrect context configuration</p></td>
<td><p>An error occurs when the system configures the context.</p></td>
<td><p><a class="reference external" href="https://mindspore.cn/tutorials/experts/en/r2.0.0-alpha/debug/mindrt_debug.html">Error Analysis</a></p></td>
</tr>
<tr class="row-odd"><td><p>Syntax error</p></td>
<td><p>Python syntax errors and MindSpore static graph syntax errors, such as unsupported control flow syntax and tensor slicing errors</p></td>
<td><p><a class="reference external" href="https://mindspore.cn/tutorials/experts/en/r2.0.0-alpha/debug/mindrt_debug.html">Error Analysis</a></p></td>
</tr>
<tr class="row-even"><td><p>Operator build error</p></td>
<td><p>The operator parameter value, type, or shape does not meet the requirements, or the operator function is restricted.</p></td>
<td><p><a class="reference external" href="https://mindspore.cn/tutorials/experts/en/r2.0.0-alpha/debug/mindrt_debug.html">Error Analysis</a></p></td>
</tr>
<tr class="row-odd"><td><p>Operator execution error</p></td>
<td><p>Input data exceptions, operator implementation errors, function restrictions, resource restrictions, etc.</p></td>
<td><p><a class="reference external" href="https://mindspore.cn/tutorials/experts/en/r2.0.0-alpha/debug/mindrt_debug.html">Error Analysis</a></p></td>
</tr>
<tr class="row-even"><td><p>Insufficient resources</p></td>
<td><p>The device memory is insufficient, the number of function call stacks exceeds the threshold, and the number of flow resources exceeds the threshold.</p></td>
<td><p><a class="reference external" href="https://mindspore.cn/tutorials/experts/en/r2.0.0-alpha/debug/mindrt_debug.html">Error Analysis</a></p></td>
</tr>
</tbody>
</table>
<ul>
<li><p>Error analysis of the dynamic graph mode</p>
<p>In dynamic graph mode, the program is executed line by line according to the code writing sequence, and the execution result can be returned in time. Figure 2 shows the error message reported during dynamic graph build. The error message is from the Python frontend, indicating that the number of function parameters does not meet the requirements. Through the Python call stack, you can locate the error code: <code class="docutils literal notranslate"><span class="pre">c</span> <span class="pre">=</span> <span class="pre">self.mul(b,</span> <span class="pre">self.func(a,a,b))</span></code>.</p>
<p>Generally, the error message may contain <code class="docutils literal notranslate"><span class="pre">WARNING</span></code> logs. During error analysis, analyze the error message following Traceback first.</p>
<p><img alt="pynative-errmsg" src="https://gitee.com/mindspore/docs/raw/r2.0.0-alpha/tutorials/experts/source_zh_cn/debug/images/pynative_errmsg.png" /></p>
<p>Figure 2</p>
<p>In dynamic graph mode, common network construction and training errors are found in environment configuration, Python syntax, and operator usage. The general analysis method is as follows:</p>
<ul class="simple">
<li><p>Determine the object where the error is reported based on the error description, for example, the operator API name.</p></li>
<li><p>Locate the code line where the error is reported based on the Python call stack information.</p></li>
<li><p>Analyze the code input data and calculation logic at the position where the error occurs, and find the error cause based on the description and specifications of the error object in the <a class="reference external" href="https://www.mindspore.cn/docs/en/r2.0.0-alpha/api_python/mindspore.html">MindSpore API</a>.</p></li>
</ul>
</li>
<li><p>Error analysis of the static graph mode</p>
<p>In static graph mode, MindSpore builds the network structure into a computational graph, and then performs the computation operations involved in the graph. Therefore, errors reported in static graph mode include computational graph build errors and computational graph execution errors. Figure 3 shows the error message reported during computational graph build. When an error occurs, the <code class="docutils literal notranslate"><span class="pre">analyze_failed.dat</span></code> file is automatically saved to help analyze the location of the error code.</p>
<p><img alt="graph-errmsg" src="https://gitee.com/mindspore/docs/raw/r2.0.0-alpha/tutorials/experts/source_zh_cn/debug/images/graph_errmsg.png" /></p>
<p>Figure 3</p>
<p>The general error analysis method in static graph mode is as follows:</p>
<p>Check whether the error is caused by graph build or graph execution based on the error description.</p>
<ul class="simple">
<li><p>If the error is reported during computational graph build, analyze the cause and location of the failure based on the error description and the <code class="docutils literal notranslate"><span class="pre">analyze_failed.dat</span></code> file automatically saved when the error occurs.</p></li>
<li><p>If the error is reported during computational graph execution, the error may be caused by insufficient resources or improper operator execution. You need to further distinguish the error based on the error message. If the error is reported during operator execution, locate the operator, use the dump function to save the input data of the operator, and analyze the cause of the error based on the input data.</p></li>
</ul>
<p>For details about how to analyze and infer the failure cause, see the analysis methods described in <a class="reference external" href="https://www.mindspore.cn/tutorials/experts/en/r2.0.0-alpha/debug/mindir.html#example-1-parameters-number-mismatch"><code class="docutils literal notranslate"><span class="pre">analyze_failed.dat</span></code></a>.</p>
<p>For details about how to use Dump to save the operator input data, see <a class="reference external" href="https://www.mindspore.cn/tutorials/experts/en/r2.0.0-alpha/debug/dump.html">Dump Function Debugging</a>.</p>
</li>
</ul>
</section>
<section id="distributed-parallel-error-analysis">
<h2>Distributed Parallel Error Analysis<a class="headerlink" href="#distributed-parallel-error-analysis" title="Permalink to this headline"></a></h2>
<p>MindSpore provides the distributed parallel training function and supports multiple parallel modes. The following table lists common distributed parallel training errors and possible causes.</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Error Type</p></th>
<th class="head"><p>Error Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Incorrect policy configuration</p></td>
<td><p>Incorrect operator logic.</p></td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p>Incorrect scalar policy configuration.</p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p>No policy configuration.</p></td>
</tr>
<tr class="row-odd"><td><p>Parallel script error</p></td>
<td><p>Incorrect script startup, or unmatched parallel configuration and startup task.</p></td>
</tr>
</tbody>
</table>
<ul>
<li><p>Incorrect policy configuration</p>
<p>Policy check errors may be reported after you enable automatic parallelism using <code class="docutils literal notranslate"><span class="pre">mindspore.set_auto_parallel_context(parallel_mode=&quot;semi_auto_parallel&quot;)</span></code>. These policy check errors are reported due to specific operator slicing restrictions. The following uses three examples to describe how to analyze the three types of errors.</p>
<ul>
<li><p>Incorrect operator logic</p>
<p>The error message is as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">ERROR</span><span class="p">]</span><span class="n">Check</span> <span class="n">StridedSliceInfo1414</span><span class="p">:</span> <span class="n">When</span> <span class="n">there</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">mask</span><span class="p">,</span> <span class="n">the</span> <span class="nb">input</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">supported</span> <span class="n">to</span> <span class="n">be</span> <span class="n">split</span>
</pre></div>
</div>
<p>The following shows a piece of possible error code where the network input is a [2, 4] tensor. The network is sliced to obtain the first half of dimension 0 in the input tensor. It is equivalent to the x[:1, :]operation in NumPy, where x is the input tensor. On the network, the (2,1) policy is configured for the stridedslice operator to slice dimension 0.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tensor</span> <span class="o">=</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)))</span>
<span class="n">stridedslice</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">StridedSlice</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">MyStridedSlice</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MyStridedSlice</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="n">stridedslice</span><span class="o">.</span><span class="n">shard</span><span class="p">(((</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),))</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># x is a two-dimensional tensor</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<p>Error cause:</p>
<p>The piece of code performs the slice operation on dimension 0. However, the configured policy (2,1) indicates that the slice operation is performed on both dimension 0 and dimension 1 of the input tensor. According to the description of operator slicing in the <a class="reference external" href="https://www.mindspore.cn/docs/en/r2.0.0-alpha/note/operator_list_parallel.html">MindSpore API</a>,</p>
<blockquote>
<div><p>only the mask whose value is all 0s is supported. All dimensions that are sliced must be extracted together. The input dimensions whose strides is not set to 1 cannot be sliced.</p>
</div></blockquote>
<p>Dimensions that are sliced cannot be separately extracted. Therefore, the policy must be modified as follows:</p>
<p>Change the policy of dimension 0 from 2 to 1. In this way, dimension 0 will be sliced into one, that is, dimension 0 will not be sliced. Therefore, the policy meets the operator restrictions and the policy check is successful.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyStridedSlice</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MyStridedSlice</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="n">stridedslice</span><span class="o">.</span><span class="n">shard</span><span class="p">(((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),))</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># x is a two-dimensional tensor</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Incorrect scalar policy configuration</p>
<p>Error message:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">ERROR</span><span class="p">]</span> <span class="n">The</span> <span class="n">strategy</span> <span class="ow">is</span> <span class="o">...</span><span class="p">,</span> <span class="n">strategy</span> <span class="nb">len</span><span class="p">:</span><span class="o">.</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">equal</span> <span class="n">to</span> <span class="n">inputs</span> <span class="nb">len</span><span class="p">:</span><span class="o">.</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span>
</pre></div>
</div>
<p>Possible error code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MySub</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MySub</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sub</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">Sub</span><span class="p">()</span><span class="o">.</span><span class="n">shard</span><span class="p">(((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)))</span>
    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># x is a two-dimensional tensor</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>The input of many operators can be scalars, such as addition, subtraction, multiplication, and division operations and axis of operators such as concat and gather. For such operations with scalar input, do not configure policies for these scalars. If the preceding method is used to configure a policy for the subtraction operation and the policy (1,) is configured for scalar 1, an error is reported.
That is, the length of the policy whose index is 1 is 1, which is not equal to the length 0 of the corresponding input. In this case, the input is a scalar.</p>
<p>Modified code:</p>
<p>In this case, set an empty policy for the scalar or do not set any policy (recommended method).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">sub</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">Sub</span><span class="p">()</span><span class="o">.</span><span class="n">shard</span><span class="p">(((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),()))</span>

<span class="bp">self</span><span class="o">.</span><span class="n">sub</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">Sub</span><span class="p">()</span><span class="o">.</span><span class="n">shard</span><span class="p">(((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),))</span>
</pre></div>
</div>
</li>
<li><p>No policy configuration</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">ERROR</span><span class="p">]</span><span class="n">The</span> <span class="n">strategy</span> <span class="ow">is</span> <span class="p">((</span><span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">shape</span> <span class="mi">4</span> <span class="n">can</span> <span class="ow">not</span> <span class="n">be</span> <span class="n">divisible</span> <span class="n">by</span> <span class="n">strategy</span> <span class="n">value</span> <span class="mi">8</span>
</pre></div>
</div>
<p>Possible error code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MySub</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MySub</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sub</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">Sub</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># x is a two-dimensional tensor</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>The following piece of code runs training in an 8-device environment in semi-automatic parallel mode. No policy is configured for the Sub operator in the example and the default policy of the Sub operator is data parallel. Assume that the input x is a matrix of size [2, 4]. After the build starts, an error is reported, indicating that the input dimensions are insufficient for slicing. In this case, you need to modify the policy as follows (ensure that the number of dimensions for slicing are less than that of the input tensor):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MySub</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MySub</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sub</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">Sub</span><span class="p">()</span><span class="o">.</span><span class="n">shard</span><span class="p">(((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">()))</span>
    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># x is a two-dimensional tensor</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>(2, 1) indicates that dimension 0 of the first input tensor is sliced into two parts, and dimension 1 is sliced into one, that is, dimension 1 is not sliced. The second input of <code class="docutils literal notranslate"><span class="pre">ops.Sub</span></code> is a scalar that cannot be sliced. Therefore, the slicing policy is set to empty ().</p>
</li>
</ul>
</li>
<li><p>Parallel script error</p>
<p>The following is a piece of code for running an 8-device Ascend environment and using the bash script to start the training task.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="nb">set</span><span class="w"> </span>-e
<span class="nv">EXEC_PATH</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">RANK_SIZE</span><span class="o">=</span><span class="m">8</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">RANK_TABLE_FILE</span><span class="o">=</span><span class="si">${</span><span class="nv">EXEC_PATH</span><span class="si">}</span>/rank_table_8pcs.json

<span class="k">for</span><span class="o">((</span><span class="nv">i</span><span class="o">=</span><span class="m">0</span><span class="p">;</span>i&lt;RANK_SIZE<span class="p">;</span>i++<span class="o">))</span>
<span class="k">do</span>
<span class="w">    </span>rm<span class="w"> </span>-rf<span class="w"> </span>device<span class="nv">$i</span>
<span class="w">    </span>mkdir<span class="w"> </span>device<span class="nv">$i</span>
<span class="w">    </span>cp<span class="w"> </span>./train.py<span class="w"> </span>./device<span class="nv">$i</span>
<span class="w">    </span><span class="nb">cd</span><span class="w"> </span>./device<span class="nv">$i</span>
<span class="w">    </span><span class="nb">export</span><span class="w"> </span><span class="nv">DEVICE_ID</span><span class="o">=</span><span class="nv">$i</span>
<span class="w">    </span><span class="nb">export</span><span class="w"> </span><span class="nv">RANK_ID</span><span class="o">=</span><span class="nv">$i</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;start training for device </span><span class="nv">$i</span><span class="s2">&quot;</span>
<span class="w">    </span>env<span class="w"> </span>&gt;<span class="w"> </span>env<span class="nv">$i</span>.log
<span class="w">    </span>python<span class="w"> </span>./train.py<span class="w"> </span>&gt;<span class="w"> </span>train.log<span class="nv">$i</span><span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">    </span><span class="nb">cd</span><span class="w"> </span>../
<span class="k">done</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;The program launch succeed, the log is under device0/train.log0.&quot;</span>
</pre></div>
</div>
<p>Errors may occur in the following scenarios:</p>
<ol class="arabic simple">
<li><p>The number of training tasks (<code class="docutils literal notranslate"><span class="pre">RANK_SIZE</span></code>) started using the for loop does not match the number of devices configured in the <code class="docutils literal notranslate"><span class="pre">rank_table_8pcs.json</span></code> configuration file. As a result, an error is reported.</p></li>
<li><p>The command for executing the training script is not executed in asynchronous mode (<code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">./train.py</span> <span class="pre">&gt;</span> <span class="pre">train.log$i</span> <span class="pre">2&gt;&amp;1</span></code>). As a result, training tasks are started at different time, and an error is reported. In this case, add the <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> operator to the end of the command, indicating that the command is executed asynchronously in the subshell. In this way, multiple tasks can be started synchronously.</p></li>
</ol>
<p>In parallel scenarios, you may encounter the <code class="docutils literal notranslate"><span class="pre">Distribute</span> <span class="pre">Task</span> <span class="pre">Failed</span></code> error. In this case, analyze whether the error occurs in the computational graph build phase or the execution phase of printing training loss to further locate the error.</p>
<p>For details, visit the following website:</p>
<p>For more information about distributed parallel errors in MindSpore, see <a class="reference external" href="https://bbs.huaweicloud.com/forum/thread-181820-1-1.html">Distributed Task Failed</a>.</p>
</li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="function_debug.html" class="btn btn-neutral float-left" title="Function Debug" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="custom_debug.html" class="btn btn-neutral float-right" title="Custom Debugging Information" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright MindSpore.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 
</body>
</html>