

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Network Construction and Training Error Analysis &mdash; MindSpore master documentation</title>
  

  
   
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  
  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        
        
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> MindSpore
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Data Processing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dataset/augment.html">Auto Augmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dataset/cache.html">Single-Node Data Cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dataset/optimize.html">Optimizing the Data Processing</a></li>
</ul>
<p class="caption"><span class="caption-text">Graph Compilation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../network/control_flow.html">Process Control Statements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../network/op_overload.html">Compiling Performance Optimization for Static Graph Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../network/jit_class.html">Calling the Custom Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../network/constexpr.html">Construct Constants In the Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../network/dependency_control.html">Dependency Control</a></li>
</ul>
<p class="caption"><span class="caption-text">Model Training Optimization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../optimize/execution_opt.html">Sinking Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../optimize/gradient_accumulation.html">Gradient Accumulation Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../optimize/adaptive_summation.html">Adaptive Gradient Summation Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../optimize/dimention_reduce_training.html">Dimension Reduction Training Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../optimize/thor.html">Second-order Optimization</a></li>
</ul>
<p class="caption"><span class="caption-text">Custom Operator</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../operation/op_custom.html">Custom Operators (Custom-based)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../operation/ms_kernel.html">MindSpore Hybrid Syntax Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../operation/op_custom_adv.html">Advanced Usage of Custom Operators</a></li>
</ul>
<p class="caption"><span class="caption-text">Automatic Vectorization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../vmap/vmap.html">Automatic Vectorization (Vmap)</a></li>
</ul>
<p class="caption"><span class="caption-text">Model Inference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../infer/inference.html">Inference Model Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infer/gpu_mindir.html">Inference on a GPU</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infer/ascend_910_mindir.html">Inference on the Ascend 910 AI processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infer/ascend_310_mindir.html">Inference Using the MindIR Model on Ascend 310 AI Processors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infer/ascend_310_air.html">Inference on the Ascend 310 AI Processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infer/model_compression.html">Model Compression</a></li>
</ul>
<p class="caption"><span class="caption-text">Debugging and Tuning</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="function_debug.html">Function Debug</a></li>
<li class="toctree-l1"><a class="reference internal" href="performance_optimization.html">Performance Tuning</a></li>
<li class="toctree-l1"><a class="reference external" href="https://mindspore.cn/mindinsight/docs/en/r2.0.0-alpha/accuracy_problem_preliminary_location.html">Precision Optimization↗</a></li>
</ul>
<p class="caption"><span class="caption-text">Distributed Parallel</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../parallel/introduction.html">Distributed Parallel Training Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parallel/parallel_training_quickstart.html">Quick Start Distributed Parallel Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parallel/communicate_ops.html">Distributed Set Communication Primitives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parallel/distributed_case.html">Distributed Case</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parallel/distributed_inference.html">Distributed Inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parallel/save_load.html">Saving and Loading Models in Hybrid Parallel Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parallel/fault_recover.html">Distributed Fault Recovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parallel/multi_dimensional.html">Multi Dimensional</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parallel/resilience_train_and_predict.html">Distributed Resilience Training and Inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parallel/other_features.html">Other Features</a></li>
</ul>
<p class="caption"><span class="caption-text">Environment Variables</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../env/env_var_list.html">Environment Variables</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MindSpore</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Network Construction and Training Error Analysis</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/debug/mindrt_debug.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="network-construction-and-training-error-analysis">
<h1>Network Construction and Training Error Analysis<a class="headerlink" href="#network-construction-and-training-error-analysis" title="Permalink to this headline">¶</a></h1>
<p><a href="https://gitee.com/mindspore/docs/blob/r2.0.0-alpha/tutorials/experts/source_en/debug/mindrt_debug.md" target="_blank"><img src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/r2.0.0-alpha/resource/_static/logo_source_en.png"></a>  </p>
<p>The following lists the common network construction and training errors in static graph mode.</p>
<div class="section" id="incorrect-context-configuration">
<h2>Incorrect Context Configuration<a class="headerlink" href="#incorrect-context-configuration" title="Permalink to this headline">¶</a></h2>
<p>When performing network training, you must run the following command to specify the backend device: <code class="docutils literal notranslate"><span class="pre">set_context(device_target=device)</span></code>. MindSpore supports CPU, GPU, and Ascend. If a GPU backend device is incorrectly specified as Ascend by running <code class="docutils literal notranslate"><span class="pre">set_context(device_target=&quot;Ascend&quot;)</span></code>, the following error message will be displayed:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ne">ValueError</span><span class="p">:</span> <span class="n">For</span> <span class="s1">&#39;set_context&#39;</span><span class="p">,</span> <span class="n">package</span> <span class="nb">type</span> <span class="n">mindspore</span><span class="o">-</span><span class="n">gpu</span> <span class="n">support</span> <span class="s1">&#39;device_target&#39;</span> <span class="nb">type</span> <span class="n">gpu</span> <span class="ow">or</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">but</span> <span class="n">got</span> <span class="n">Ascend</span><span class="o">.</span>
</pre></div>
</div>
<p>The running backend specified by the script must match the actual hardware device.</p>
<p>For details, visit the following website:</p>
<p><a class="reference external" href="https://bbs.huaweicloud.com/forum/thread-183514-1-1.html">MindSpore Configuration Error - ‘set_context’ Configuration Error</a></p>
<p>For details about the context configuration, see <a class="reference external" href="https://www.mindspore.cn/docs/en/r2.0.0-alpha/api_python/mindspore/mindspore.set_context.html">‘set_context’</a>.</p>
</div>
<div class="section" id="syntax-errors">
<h2>Syntax Errors<a class="headerlink" href="#syntax-errors" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p>Incorrect construct parameter</p>
<p>In MindSpore, the basic unit of the neural network is <code class="docutils literal notranslate"><span class="pre">nn.Cell</span></code>. All the models or neural network layers must inherit this base class. As a member function of this base class, <code class="docutils literal notranslate"><span class="pre">construct</span></code> defines the calculation logic to be executed and must be rewritten in all inherited classes. The function prototype of <code class="docutils literal notranslate"><span class="pre">construct</span></code> is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">inputs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</pre></div>
</div>
<p>When the function is rewritten, the following error message may be displayed:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ne">TypeError</span><span class="p">:</span> <span class="n">The</span> <span class="n">function</span> <span class="n">construct</span> <span class="n">needs</span> <span class="mi">0</span> <span class="n">positional</span> <span class="n">argument</span> <span class="ow">and</span> <span class="mi">0</span> <span class="n">default</span> <span class="n">argument</span><span class="p">,</span> <span class="n">but</span> <span class="n">provided</span> <span class="mi">1</span>
</pre></div>
</div>
<p>This is because the function parameter list is incorrect when the user-defined <code class="docutils literal notranslate"><span class="pre">construct</span></code> function is implemented, for example, <code class="docutils literal notranslate"><span class="pre">&quot;def</span> <span class="pre">construct(*inputs,</span> <span class="pre">**kwargs):&quot;</span></code>, where <code class="docutils literal notranslate"><span class="pre">self</span></code> is missing. In this case, an error is reported when MindSpore parses the syntax.</p>
<p>For details, visit the following website:</p>
<p><a class="reference external" href="https://bbs.huaweicloud.com/forum/thread-178902-1-1.html">MindSpore Syntax Error - ‘construct’ Definition Error</a></p>
</li>
<li><p>Incorrect control flow syntax</p>
<p>In static graph mode, Python code is not executed by the Python interpreter. Instead, the code is built into a static computational graph for execution. The control flow syntax supported by MindSpore includes if, for, and while statements. The attributes of the objects returned by different branches of the if statement may be inconsistent. As a result, an error is reported. The error message is displayed as follows:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="nl">TypeError</span><span class="p">:</span><span class="w"> </span><span class="n">Cannot</span><span class="w"> </span><span class="n">join</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">branches</span><span class="p">,</span><span class="w"> </span><span class="n">perhaps</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">make</span><span class="w"> </span><span class="n">them</span><span class="w"> </span><span class="n">equal</span><span class="p">.</span>
<span class="n">Type</span><span class="w"> </span><span class="n">Join</span><span class="w"> </span><span class="n">Failed</span><span class="o">:</span><span class="w"> </span><span class="n">dtype1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Float32</span><span class="p">,</span><span class="w"> </span><span class="n">dtype2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Float16</span><span class="p">.</span>
</pre></div>
</div>
<p>According to the error message, the return values of different branches of the if statement are of different types. One is float32, and the other is float16. As a result, a build error is reported.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="nl">ValueError</span><span class="p">:</span><span class="w"> </span><span class="n">Cannot</span><span class="w"> </span><span class="n">join</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">branches</span><span class="p">,</span><span class="w"> </span><span class="n">perhaps</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">make</span><span class="w"> </span><span class="n">them</span><span class="w"> </span><span class="n">equal</span><span class="p">.</span>
<span class="n">Shape</span><span class="w"> </span><span class="n">Join</span><span class="w"> </span><span class="n">Failed</span><span class="o">:</span><span class="w"> </span><span class="n">shape1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">),</span><span class="w"> </span><span class="n">shape2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">().</span>
</pre></div>
</div>
<p>According to the error message, the dimension shapes of the return values of different branches of the if statement are different. One is a 4-bit tensor of <code class="docutils literal notranslate"><span class="pre">2*3*4*5</span></code>, and the other is a scalar. As a result, a build error is reported.</p>
<p>For details, visit the following website:</p>
<p><a class="reference external" href="https://www.mindspore.cn/docs/en/r2.0.0-alpha/faq/network_compilation.html">MindSpore Syntax Error - Type (Shape) Join Failed</a></p>
<p>The number of loops of the for and while statements may exceed the permitted range. As a result, the function call stack exceeds the threshold. The error message is displayed as follows:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="nl">RuntimeError</span><span class="p">:</span><span class="w"> </span><span class="n">Exceed</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">depth</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">function</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">depth</span><span class="o">:</span><span class="w"> </span><span class="mi">1001</span><span class="p">,</span><span class="w"> </span><span class="n">simulate</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">depth</span><span class="o">:</span><span class="w"> </span><span class="mi">997</span><span class="p">).</span>
</pre></div>
</div>
<p>One solution to the problem that the function call stack exceeds the threshold is to simplify the network structure and reduce the number of loops. Another method is to use <code class="docutils literal notranslate"><span class="pre">set_context(max_call_depth=value)</span></code> to increase the threshold of the function call stack.</p>
<p>For details, visit the following website:</p>
<p><a class="reference external" href="https://bbs.huaweicloud.com/forum/thread-182165-1-1.html">MindSpore Syntax Error - Exceed function call depth limit</a></p>
</li>
</ul>
</div>
<div class="section" id="operator-build-errors">
<h2>Operator Build Errors<a class="headerlink" href="#operator-build-errors" title="Permalink to this headline">¶</a></h2>
<p>Operator build errors are mainly caused by input parameters that do not meet requirements or operator functions that are not supported.</p>
<p>For example, when the ReduceSum operator is used, the following error message is displayed if the input data exceeds eight dimensions:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span>RuntimeError: ({&#39;errCode&#39;: &#39;E80012&#39;, &#39;op_name&#39;: &#39;reduce_sum_d&#39;, &#39;param_name&#39;: &#39;x&#39;, &#39;min_value&#39;: 0, &#39;max_value&#39;: 8, &#39;real_value&#39;: 10}, &#39;In op, the num of dimensions of input/output[x] should be in the range of [0, 8], but actually is [10].&#39;)
</pre></div>
</div>
<p>For details, visit the following website:</p>
<p><a class="reference external" href="https://bbs.huaweicloud.com/forum/thread-182168-1-1.html">MindSpore Operator Build Error - ReduceSum Operator Does Not Support Input of More Than Eight Dimensions</a></p>
<p>For example, the Parameter parameter does not support automatic type conversion. When the Parameter operator is used, an error is reported during data type conversion. The error message is as follows:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span>RuntimeError: Data type conversion of &#39;Parameter&#39; is not supported, so data type int32 cannot be converted to data type float32 automatically.
</pre></div>
</div>
<p>For details, visit the following website:</p>
<p><a class="reference external" href="https://bbs.huaweicloud.com/forum/thread-182175-1-1.html">MindSpore Operator Build Error - Error Reported Due to Inconsistent ScatterNdUpdate Operator Parameter Types</a></p>
</div>
<div class="section" id="operator-execution-errors">
<h2>Operator Execution Errors<a class="headerlink" href="#operator-execution-errors" title="Permalink to this headline">¶</a></h2>
<p>Operator execution errors are mainly caused by improper input data , operator implementation, or operator initialization. Generally, the analogy method can be used to analyze operator execution errors.</p>
<p>For details, see the following example:</p>
<p><a class="reference external" href="https://bbs.huaweicloud.com/forum/thread-182191-1-1.html">MindSpore Operator Execution Error - nn.GroupNorm Operator Output Exception</a></p>
</div>
<div class="section" id="insufficient-resources">
<h2>Insufficient Resources<a class="headerlink" href="#insufficient-resources" title="Permalink to this headline">¶</a></h2>
<p>During network debugging, <code class="docutils literal notranslate"><span class="pre">Out</span> <span class="pre">Of</span> <span class="pre">Memory</span></code> errors often occur. MindSpore divides the memory into four layers for management on the Ascend device, including runtime, context, dual cursors, and memory overcommitment.</p>
<p>For details about memory management and FAQs of MindSpore on the Ascend device, see <a class="reference external" href="https://bbs.huaweicloud.com/forum/thread-171161-1-1.html">MindSpore Ascend Memory Management</a>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2022, MindSpore.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   
	<script async="async" src="https://cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>