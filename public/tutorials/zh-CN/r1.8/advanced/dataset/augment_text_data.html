

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>文本数据加载与增强 &mdash; MindSpore master documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/bootstrap.min.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/training.css" type="text/css" />
   
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  
  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/js/training.js"></script>
        
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="图数据加载与处理" href="augment_graph_data.html" />
    <link rel="prev" title="图像数据加载与增强" href="augment_image_data.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> MindSpore
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">初学教程</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../beginner/introduction.html">基本介绍</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../beginner/quick_start.html">快速入门：手写数字识别</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../beginner/tensor.html">张量 Tensor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../beginner/dataset.html">数据处理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../beginner/model.html">创建网络</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../beginner/autograd.html">自动微分</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../beginner/train.html">模型训练</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../beginner/save_load.html">保存与加载</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../beginner/infer.html">推理与部署</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">进阶教程</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../linear_fitting.html">进阶案例：线性拟合</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../dataset.html">数据处理</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="sampler.html">数据采样</a></li>
<li class="toctree-l2"><a class="reference internal" href="transform.html">数据处理</a></li>
<li class="toctree-l2"><a class="reference internal" href="iterator.html">数据迭代</a></li>
<li class="toctree-l2"><a class="reference internal" href="record.html">格式转换</a></li>
<li class="toctree-l2"><a class="reference internal" href="custom.html">自定义数据集</a></li>
<li class="toctree-l2"><a class="reference internal" href="augment_common_data.html">通用数据加载与增强</a></li>
<li class="toctree-l2"><a class="reference internal" href="augment_image_data.html">图像数据加载与增强</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">文本数据加载与增强</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#加载文本数据">加载文本数据</a></li>
<li class="toctree-l3"><a class="reference internal" href="#文本数据增强">文本数据增强</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#构造与使用词汇表">构造与使用词汇表</a></li>
<li class="toctree-l4"><a class="reference internal" href="#分词器">分词器</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="augment_graph_data.html">图数据加载与处理</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../network.html">网络构建</a></li>
<li class="toctree-l1"><a class="reference internal" href="../train.html">训练与评估</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pynative_graph.html">动态图与静态图</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">MindSpore</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../dataset.html">数据处理</a> &raquo;</li>
      <li>文本数据加载与增强</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/advanced/dataset/augment_text_data.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars and line breaks on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
    white-space: pre;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="文本数据加载与增强">
<h1>文本数据加载与增强<a class="headerlink" href="#文本数据加载与增强" title="Permalink to this headline"></a></h1>
<p><a class="reference external" href="https://obs.dualstack.cn-north-4.myhuaweicloud.com/mindspore-website/notebook/r1.8/tutorials/zh_cn/advanced/dataset/mindspore_augment_text_data.ipynb"><img alt="下载Notebook" src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/r1.8/resource/_static/logo_notebook.png" /></a>  <a class="reference external" href="https://obs.dualstack.cn-north-4.myhuaweicloud.com/mindspore-website/notebook/r1.8/tutorials/zh_cn/advanced/dataset/mindspore_augment_text_data.py"><img alt="下载样例代码" src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/r1.8/resource/_static/logo_download_code.png" /></a>  <a class="reference external" href="https://gitee.com/mindspore/docs/blob/r1.8/tutorials/source_zh_cn/advanced/dataset/augment_text_data.ipynb"><img alt="查看源文件" src="https://mindspore-website.obs.cn-north-4.myhuaweicloud.com/website-images/r1.8/resource/_static/logo_source.png" /></a></p>
<p>随着可获得的文本数据逐步增多，对文本数据进行预处理，以便获得可用于网络训练所需干净数据的诉求也更为迫切。文本数据集预处理通常包括文本数据集加载与数据增强两部分。</p>
<p>文本数据加载通常包含以下三种方式：</p>
<ol class="arabic simple">
<li><p>通过文本读取的Dataset接口如<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/r1.8/api_python/dataset/mindspore.dataset.CLUEDataset.html#mindspore.dataset.CLUEDataset">ClueDataset</a>、<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/r1.8/api_python/dataset/mindspore.dataset.TextFileDataset.html#mindspore.dataset.TextFileDataset">TextFileDataset</a>进行读取。</p></li>
<li><p>将数据集转成标准格式（如MindRecord格式），再通过对应接口（如<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/r1.8/api_python/dataset/mindspore.dataset.MindDataset.html#mindspore.dataset.MindDataset">MindDataset</a>）进行读取。</p></li>
<li><p>通过GeneratorDataset接口，接收用户自定义的数据集加载函数，进行数据加载，用法可参考<a class="reference external" href="https://www.mindspore.cn/tutorials/zh-CN/r1.8/advanced/dataset/custom.html">自定义数据集加载</a>章节。</p></li>
</ol>
<section id="加载文本数据">
<h2>加载文本数据<a class="headerlink" href="#加载文本数据" title="Permalink to this headline"></a></h2>
<p>下面我们以从TXT文件中读取数据为例，介绍<code class="docutils literal notranslate"><span class="pre">TextFileDataset</span></code>的使用方式，更多文本数据集加载相关信息可参考<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/r1.8/api_python/mindspore.dataset.html#文本">API文档</a>。</p>
<ol class="arabic simple">
<li><p>准备文本数据，内容如下：</p></li>
</ol>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Welcome to Beijing
北京欢迎您！
我喜欢China!
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>创建<code class="docutils literal notranslate"><span class="pre">tokenizer.txt</span></code>文件并复制文本数据到该文件中，将该文件存放在./datasets路径下。执行如下代码：</p></li>
</ol>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;./datasets&#39;</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s1">&#39;./datasets&#39;</span><span class="p">)</span>

<span class="c1"># 把上面的文本数据写入文件tokenizer.txt</span>
<span class="n">file_handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./datasets/tokenizer.txt&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">file_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Welcome to Beijing </span><span class="se">\n</span><span class="s1">北京欢迎您！ </span><span class="se">\n</span><span class="s1">我喜欢China! </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">file_handle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>上面的代码执行完后，数据集结构为：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>./datasets
└── tokenizer.txt
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>从TXT文件中加载数据集并打印。代码如下：</p></li>
</ol>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore.dataset</span> <span class="k">as</span> <span class="nn">ds</span>
<span class="kn">import</span> <span class="nn">mindspore.dataset.text</span> <span class="k">as</span> <span class="nn">text</span>

<span class="c1"># 定义文本数据集的加载路径</span>
<span class="n">DATA_FILE</span> <span class="o">=</span> <span class="s1">&#39;./datasets/tokenizer.txt&#39;</span>

<span class="c1"># 从tokenizer.txt中加载数据集</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">TextFileDataset</span><span class="p">(</span><span class="n">DATA_FILE</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">create_dict_iterator</span><span class="p">(</span><span class="n">output_numpy</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">to_str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Welcome to Beijing
北京欢迎您！
我喜欢China!
</pre></div></div>
</div>
</section>
<section id="文本数据增强">
<h2>文本数据增强<a class="headerlink" href="#文本数据增强" title="Permalink to this headline"></a></h2>
<p>针对文本数据增强，常用操作包含文本分词、词汇表查找等：</p>
<ul class="simple">
<li><p>文本分词：将原始一长串句子分割成多个基本的词汇。</p></li>
<li><p>词汇表查找：查找分割后各词汇对应的id，并将句子中包含的id组成词向量传入网络进行训练。</p></li>
</ul>
<p>下面对数据增强过程中用到的分词功能、词汇表查找等功能进行介绍，更多关于文本处理API的使用说明，可以参考<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/r1.8/api_python/mindspore.dataset.text.html">API文档</a>。</p>
<section id="构造与使用词汇表">
<h3>构造与使用词汇表<a class="headerlink" href="#构造与使用词汇表" title="Permalink to this headline"></a></h3>
<p>词汇表提供了单词与id对应的映射关系，通过词汇表，输入单词能找到对应的单词id，反之依据单词id也能获取对应的单词。</p>
<p>MindSpore提供了多种构造词汇表（Vocab）的方法，可以从字典、文件、列表以及Dataset对象中获取原始数据，以便构造词汇表，对应的接口为：<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/r1.8/api_python/dataset_text/mindspore.dataset.text.Vocab.html#mindspore.dataset.text.Vocab.from_dict">from_dict</a>、<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/r1.8/api_python/dataset_text/mindspore.dataset.text.Vocab.html#mindspore.dataset.text.Vocab.from_file">from_file</a>、<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/r1.8/api_python/dataset_text/mindspore.dataset.text.Vocab.html#mindspore.dataset.text.Vocab.from_list">from_list</a>、<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/r1.8/api_python/dataset_text/mindspore.dataset.text.Vocab.html#mindspore.dataset.text.Vocab.from_dataset">from_dataset</a>。</p>
<p>以from_dict为例，构造Vocab的方式如下，传入的dict中包含多组单词和id对。</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindspore.dataset</span> <span class="kn">import</span> <span class="n">text</span>

<span class="c1"># 构造词汇表</span>
<span class="n">vocab</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">Vocab</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span><span class="s2">&quot;home&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;behind&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;the&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;world&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;&lt;unk&gt;&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">})</span>
</pre></div>
</div>
</div>
<p>Vocab提供了单词与id之间相互查询的方法，即：<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/r1.8/api_python/dataset_text/mindspore.dataset.text.Vocab.html#mindspore.dataset.text.Vocab.tokens_to_ids">tokens_to_ids</a>和<a class="reference external" href="https://www.mindspore.cn/docs/zh-CN/r1.8/api_python/dataset_text/mindspore.dataset.text.Vocab.html#mindspore.dataset.text.Vocab.ids_to_tokens">ids_to_tokens</a>方法，用法如下所示：</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 根据单词查找id</span>
<span class="n">ids</span> <span class="o">=</span> <span class="n">vocab</span><span class="o">.</span><span class="n">tokens_to_ids</span><span class="p">([</span><span class="s2">&quot;home&quot;</span><span class="p">,</span> <span class="s2">&quot;world&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ids: &quot;</span><span class="p">,</span> <span class="n">ids</span><span class="p">)</span>

<span class="c1"># 根据id查找单词</span>
<span class="n">tokens</span> <span class="o">=</span> <span class="n">vocab</span><span class="o">.</span><span class="n">ids_to_tokens</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;tokens: &quot;</span><span class="p">,</span> <span class="n">tokens</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ids:  [3, 5]
tokens:  [&#39;behind&#39;, &#39;world&#39;]
</pre></div></div>
</div>
<p>从上面打印的结果可以看出：</p>
<ul class="simple">
<li><p>单词<code class="docutils literal notranslate"><span class="pre">&quot;home&quot;</span></code>和<code class="docutils literal notranslate"><span class="pre">&quot;world&quot;</span></code>的id分别为<code class="docutils literal notranslate"><span class="pre">3</span></code>和<code class="docutils literal notranslate"><span class="pre">5</span></code>；</p></li>
<li><p>id为<code class="docutils literal notranslate"><span class="pre">2</span></code>的单词为<code class="docutils literal notranslate"><span class="pre">&quot;behind&quot;</span></code>，id为<code class="docutils literal notranslate"><span class="pre">5</span></code>的单词为<code class="docutils literal notranslate"><span class="pre">&quot;world&quot;</span></code>；</p></li>
</ul>
<p>这一结果也与词汇表一致。此外Vocab也是多种分词器（如WordpieceTokenizer）的必要入参，分词时会将句子中存在于词汇表的单词，前后分割开，变成单独的一个词汇，之后通过查找词汇表能够获取对应的词汇id。</p>
</section>
<section id="分词器">
<h3>分词器<a class="headerlink" href="#分词器" title="Permalink to this headline"></a></h3>
<p>分词就是将连续的字序列按照一定的规范划分成词序列的过程，合理的分词有助于语义理解。</p>
<p>MindSpore提供了多种不同用途的分词器，如BasicTokenizer、BertTokenizer、JiebaTokenizer等，能够帮助用户高性能地处理文本。用户可以构建自己的字典，使用适当的标记器将句子拆分为不同的标记，并通过查找操作获取字典中标记的索引。此外，用户也可以根据需要实现自定义的分词器。</p>
<blockquote>
<div><p>下面介绍几种常用分词器的使用方法，更多分词器相关信息请参考<a class="reference external" href="https://mindspore.cn/docs/zh-CN/r1.8/api_python/mindspore.dataset.text.html">API文档</a>。</p>
</div></blockquote>
<section id="berttokenizer">
<h4>BertTokenizer<a class="headerlink" href="#berttokenizer" title="Permalink to this headline"></a></h4>
<p><code class="docutils literal notranslate"><span class="pre">BertTokenizer</span></code>操作是通过调用<code class="docutils literal notranslate"><span class="pre">BasicTokenizer</span></code>和<code class="docutils literal notranslate"><span class="pre">WordpieceTokenizer</span></code>来进行分词的。</p>
<p>下面的样例首先构建了一个文本数据集和字符串列表，然后通过<code class="docutils literal notranslate"><span class="pre">BertTokenizer</span></code>对数据集进行分词，并展示了分词前后的文本结果。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore.dataset</span> <span class="k">as</span> <span class="nn">ds</span>
<span class="kn">import</span> <span class="nn">mindspore.dataset.text</span> <span class="k">as</span> <span class="nn">text</span>

<span class="c1"># 构造待分词数据</span>
<span class="n">input_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;床前明月光&quot;</span><span class="p">,</span> <span class="s2">&quot;疑是地上霜&quot;</span><span class="p">,</span> <span class="s2">&quot;举头望明月&quot;</span><span class="p">,</span> <span class="s2">&quot;低头思故乡&quot;</span><span class="p">,</span> <span class="s2">&quot;I am making small mistakes during working hours&quot;</span><span class="p">,</span>
              <span class="s2">&quot;😀嘿嘿😃哈哈😄大笑😁嘻嘻&quot;</span><span class="p">,</span> <span class="s2">&quot;繁體字&quot;</span><span class="p">]</span>

<span class="c1"># 加载文本数据集</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">NumpySlicesDataset</span><span class="p">(</span><span class="n">input_list</span><span class="p">,</span> <span class="n">column_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">],</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;------------------------before tokenization----------------------------&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">create_dict_iterator</span><span class="p">(</span><span class="n">output_numpy</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">to_str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
------------------------before tokenization----------------------------
床前明月光
疑是地上霜
举头望明月
低头思故乡
I am making small mistakes during working hours
😀嘿嘿😃哈哈😄大笑😁嘻嘻
繁體字
</pre></div></div>
</div>
<p>上面为数据集未被分词前的数据打印情况，下面使用<code class="docutils literal notranslate"><span class="pre">BertTokenizer</span></code>分词器对数据集进行分词。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 构建词汇表</span>
<span class="n">vocab_list</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;床&quot;</span><span class="p">,</span> <span class="s2">&quot;前&quot;</span><span class="p">,</span> <span class="s2">&quot;明&quot;</span><span class="p">,</span> <span class="s2">&quot;月&quot;</span><span class="p">,</span> <span class="s2">&quot;光&quot;</span><span class="p">,</span> <span class="s2">&quot;疑&quot;</span><span class="p">,</span> <span class="s2">&quot;是&quot;</span><span class="p">,</span> <span class="s2">&quot;地&quot;</span><span class="p">,</span> <span class="s2">&quot;上&quot;</span><span class="p">,</span> <span class="s2">&quot;霜&quot;</span><span class="p">,</span> <span class="s2">&quot;举&quot;</span><span class="p">,</span> <span class="s2">&quot;头&quot;</span><span class="p">,</span> <span class="s2">&quot;望&quot;</span><span class="p">,</span> <span class="s2">&quot;低&quot;</span><span class="p">,</span> <span class="s2">&quot;思&quot;</span><span class="p">,</span> <span class="s2">&quot;故&quot;</span><span class="p">,</span> <span class="s2">&quot;乡&quot;</span><span class="p">,</span>
    <span class="s2">&quot;繁&quot;</span><span class="p">,</span> <span class="s2">&quot;體&quot;</span><span class="p">,</span> <span class="s2">&quot;字&quot;</span><span class="p">,</span> <span class="s2">&quot;嘿&quot;</span><span class="p">,</span> <span class="s2">&quot;哈&quot;</span><span class="p">,</span> <span class="s2">&quot;大&quot;</span><span class="p">,</span> <span class="s2">&quot;笑&quot;</span><span class="p">,</span> <span class="s2">&quot;嘻&quot;</span><span class="p">,</span> <span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="s2">&quot;am&quot;</span><span class="p">,</span> <span class="s2">&quot;mak&quot;</span><span class="p">,</span> <span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;small&quot;</span><span class="p">,</span> <span class="s2">&quot;mistake&quot;</span><span class="p">,</span>
    <span class="s2">&quot;##s&quot;</span><span class="p">,</span> <span class="s2">&quot;during&quot;</span><span class="p">,</span> <span class="s2">&quot;work&quot;</span><span class="p">,</span> <span class="s2">&quot;##ing&quot;</span><span class="p">,</span> <span class="s2">&quot;hour&quot;</span><span class="p">,</span> <span class="s2">&quot;😀&quot;</span><span class="p">,</span> <span class="s2">&quot;😃&quot;</span><span class="p">,</span> <span class="s2">&quot;😄&quot;</span><span class="p">,</span> <span class="s2">&quot;😁&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="s2">&quot;12&quot;</span><span class="p">,</span>
    <span class="s2">&quot;28&quot;</span><span class="p">,</span> <span class="s2">&quot;40&quot;</span><span class="p">,</span> <span class="s2">&quot;16&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;[CLS]&quot;</span><span class="p">,</span> <span class="s2">&quot;[SEP]&quot;</span><span class="p">,</span> <span class="s2">&quot;[UNK]&quot;</span><span class="p">,</span> <span class="s2">&quot;[PAD]&quot;</span><span class="p">,</span> <span class="s2">&quot;[MASK]&quot;</span><span class="p">,</span> <span class="s2">&quot;[unused1]&quot;</span><span class="p">,</span> <span class="s2">&quot;[unused10]&quot;</span><span class="p">]</span>

<span class="c1"># 加载词汇表</span>
<span class="n">vocab</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">Vocab</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">vocab_list</span><span class="p">)</span>

<span class="c1"># 使用BertTokenizer分词器对文本数据集进行分词操作</span>
<span class="n">tokenizer_op</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">BertTokenizer</span><span class="p">(</span><span class="n">vocab</span><span class="o">=</span><span class="n">vocab</span><span class="p">)</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">operations</span><span class="o">=</span><span class="n">tokenizer_op</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;------------------------after tokenization-----------------------------&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">create_dict_iterator</span><span class="p">(</span><span class="n">num_epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">output_numpy</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">to_str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
------------------------after tokenization-----------------------------
[&#39;床&#39; &#39;前&#39; &#39;明&#39; &#39;月&#39; &#39;光&#39;]
[&#39;疑&#39; &#39;是&#39; &#39;地&#39; &#39;上&#39; &#39;霜&#39;]
[&#39;举&#39; &#39;头&#39; &#39;望&#39; &#39;明&#39; &#39;月&#39;]
[&#39;低&#39; &#39;头&#39; &#39;思&#39; &#39;故&#39; &#39;乡&#39;]
[&#39;I&#39; &#39;am&#39; &#39;mak&#39; &#39;##ing&#39; &#39;small&#39; &#39;mistake&#39; &#39;##s&#39; &#39;during&#39; &#39;work&#39; &#39;##ing&#39;
 &#39;hour&#39; &#39;##s&#39;]
[&#39;😀&#39; &#39;嘿&#39; &#39;嘿&#39; &#39;😃&#39; &#39;哈&#39; &#39;哈&#39; &#39;😄&#39; &#39;大&#39; &#39;笑&#39; &#39;😁&#39; &#39;嘻&#39; &#39;嘻&#39;]
[&#39;繁&#39; &#39;體&#39; &#39;字&#39;]
</pre></div></div>
</div>
<p>从上面两次的打印结果可以看出，数据集中的句子、词语和表情符号等都被<code class="docutils literal notranslate"><span class="pre">BertTokenizer</span></code>分词器以词汇表中的词汇为最小单元进行了分割，“故乡”被分割成了‘故’和‘乡’，“明月”被分割成了‘明’和‘月’。值得注意的是，“mistakes”被分割成了‘mistake’和‘##s’。</p>
</section>
<section id="jiebatokenizer">
<h4>JiebaTokenizer<a class="headerlink" href="#jiebatokenizer" title="Permalink to this headline"></a></h4>
<p><code class="docutils literal notranslate"><span class="pre">JiebaTokenizer</span></code>操作是基于jieba的中文分词。</p>
<p>以下示例代码完成下载字典文件<code class="docutils literal notranslate"><span class="pre">hmm_model.utf8</span></code>和<code class="docutils literal notranslate"><span class="pre">jieba.dict.utf8</span></code>，并将其放到指定位置。</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mindvision.dataset</span> <span class="kn">import</span> <span class="n">DownLoad</span>

<span class="c1"># 字典文件存放路径</span>
<span class="n">dl_path</span> <span class="o">=</span> <span class="s2">&quot;./dictionary&quot;</span>

<span class="c1"># 获取字典文件源</span>
<span class="n">dl_url_hmm</span> <span class="o">=</span> <span class="s2">&quot;https://obs.dualstack.cn-north-4.myhuaweicloud.com/mindspore-website/notebook/datasets/hmm_model.utf8&quot;</span>
<span class="n">dl_url_jieba</span> <span class="o">=</span> <span class="s2">&quot;https://obs.dualstack.cn-north-4.myhuaweicloud.com/mindspore-website/notebook/datasets/jieba.dict.utf8&quot;</span>

<span class="c1"># 下载字典文件</span>
<span class="n">dl</span> <span class="o">=</span> <span class="n">DownLoad</span><span class="p">()</span>
<span class="n">dl</span><span class="o">.</span><span class="n">download_url</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">dl_url_hmm</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">dl_path</span><span class="p">)</span>
<span class="n">dl</span><span class="o">.</span><span class="n">download_url</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">dl_url_jieba</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">dl_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>下载的文件放置的目录结构如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>./dictionary/
├── hmm_model.utf8
└── jieba.dict.utf8
</pre></div>
</div>
<p>下面的样例首先构建了一个文本数据集，然后使用HMM与MP字典文件创建<code class="docutils literal notranslate"><span class="pre">JiebaTokenizer</span></code>对象，并对数据集进行分词，最后展示了分词前后的文本结果。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore.dataset</span> <span class="k">as</span> <span class="nn">ds</span>
<span class="kn">import</span> <span class="nn">mindspore.dataset.text</span> <span class="k">as</span> <span class="nn">text</span>

<span class="c1"># 构造待分词数据</span>
<span class="n">input_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;明天天气太好了我们一起去外面玩吧&quot;</span><span class="p">]</span>

<span class="c1"># 加载数据集</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">NumpySlicesDataset</span><span class="p">(</span><span class="n">input_list</span><span class="p">,</span> <span class="n">column_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">],</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;------------------------before tokenization----------------------------&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">create_dict_iterator</span><span class="p">(</span><span class="n">output_numpy</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">to_str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
------------------------before tokenization----------------------------
明天天气太好了我们一起去外面玩吧
</pre></div></div>
</div>
<p>上面为数据集未被分词前的数据打印情况，下面使用<code class="docutils literal notranslate"><span class="pre">JiebaTokenizer</span></code>分词器对数据集进行分词。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">HMM_FILE</span> <span class="o">=</span> <span class="s2">&quot;./dictionary/hmm_model.utf8&quot;</span>
<span class="n">MP_FILE</span> <span class="o">=</span> <span class="s2">&quot;./dictionary/jieba.dict.utf8&quot;</span>

<span class="c1"># 使用JiebaTokenizer分词器对数据集进行分词</span>
<span class="n">jieba_op</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">JiebaTokenizer</span><span class="p">(</span><span class="n">HMM_FILE</span><span class="p">,</span> <span class="n">MP_FILE</span><span class="p">)</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">operations</span><span class="o">=</span><span class="n">jieba_op</span><span class="p">,</span> <span class="n">input_columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">],</span> <span class="n">num_parallel_workers</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;------------------------after tokenization-----------------------------&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">create_dict_iterator</span><span class="p">(</span><span class="n">num_epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">output_numpy</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">to_str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
------------------------after tokenization-----------------------------
[&#39;明天&#39; &#39;天气&#39; &#39;太好了&#39; &#39;我们&#39; &#39;一起&#39; &#39;去&#39; &#39;外面&#39; &#39;玩吧&#39;]
</pre></div></div>
</div>
<p>从上面两次打印结果来看，数据集中的句子被<code class="docutils literal notranslate"><span class="pre">JiebaTokenizer</span></code>分词器以词语为最小单元进行了划分。</p>
</section>
<section id="sentencepiecetokenizer">
<h4>SentencePieceTokenizer<a class="headerlink" href="#sentencepiecetokenizer" title="Permalink to this headline"></a></h4>
<p><code class="docutils literal notranslate"><span class="pre">SentencePieceTokenizer</span></code>操作是基于开源自然语言处理工具包<a class="reference external" href="https://github.com/google/sentencepiece">SentencePiece</a>封装的分词器。</p>
<p>以下示例代码将下载文本数据集文件<code class="docutils literal notranslate"><span class="pre">botchan.txt</span></code>，并将其放置到指定位置。</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 数据集存放位置</span>
<span class="n">dl_path</span> <span class="o">=</span> <span class="s2">&quot;./datasets&quot;</span>

<span class="c1"># 获取语料数据源</span>
<span class="n">dl_url_botchan</span> <span class="o">=</span> <span class="s2">&quot;https://obs.dualstack.cn-north-4.myhuaweicloud.com/mindspore-website/notebook/datasets/botchan.txt&quot;</span>

<span class="c1"># 下载语料数据</span>
<span class="n">dl</span><span class="o">.</span><span class="n">download_url</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">dl_url_botchan</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">dl_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>下载的文件放置的目录结构如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>./datasets/
└── botchan.txt
</pre></div>
</div>
<p>下面的样例首先构建了一个文本数据集，然后从<code class="docutils literal notranslate"><span class="pre">vocab_file</span></code>文件中构建一个<code class="docutils literal notranslate"><span class="pre">vocab</span></code>对象，再通过<code class="docutils literal notranslate"><span class="pre">SentencePieceTokenizer</span></code>对数据集进行分词，并展示了分词前后的文本结果。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore.dataset</span> <span class="k">as</span> <span class="nn">ds</span>
<span class="kn">import</span> <span class="nn">mindspore.dataset.text</span> <span class="k">as</span> <span class="nn">text</span>
<span class="kn">from</span> <span class="nn">mindspore.dataset.text</span> <span class="kn">import</span> <span class="n">SentencePieceModel</span><span class="p">,</span> <span class="n">SPieceTokenizerOutType</span>

<span class="c1"># 构造待分词数据</span>
<span class="n">input_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Nothing in the world is difficult for one who sets his mind on it.&quot;</span><span class="p">]</span>

<span class="c1"># 加载数据集</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">NumpySlicesDataset</span><span class="p">(</span><span class="n">input_list</span><span class="p">,</span> <span class="n">column_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">],</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;------------------------before tokenization----------------------------&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">create_dict_iterator</span><span class="p">(</span><span class="n">output_numpy</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">to_str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
------------------------before tokenization----------------------------
Nothing in the world is difficult for one who sets his mind on it.
</pre></div></div>
</div>
<p>上面为数据集未被分词前的数据打印情况，下面使用<code class="docutils literal notranslate"><span class="pre">SentencePieceTokenizer</span></code>分词器对数据集进行分词。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 语料数据文件存放路径</span>
<span class="n">vocab_file</span> <span class="o">=</span> <span class="s2">&quot;./datasets/botchan.txt&quot;</span>

<span class="c1"># 从语料数据中学习构建词汇表</span>
<span class="n">vocab</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">SentencePieceVocab</span><span class="o">.</span><span class="n">from_file</span><span class="p">([</span><span class="n">vocab_file</span><span class="p">],</span> <span class="mi">5000</span><span class="p">,</span> <span class="mf">0.9995</span><span class="p">,</span> <span class="n">SentencePieceModel</span><span class="o">.</span><span class="n">WORD</span><span class="p">,</span> <span class="p">{})</span>

<span class="c1"># 使用SentencePieceTokenizer分词器对数据集进行分词</span>
<span class="n">tokenizer_op</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">SentencePieceTokenizer</span><span class="p">(</span><span class="n">vocab</span><span class="p">,</span> <span class="n">out_type</span><span class="o">=</span><span class="n">SPieceTokenizerOutType</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">operations</span><span class="o">=</span><span class="n">tokenizer_op</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;------------------------after tokenization-----------------------------&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">create_dict_iterator</span><span class="p">(</span><span class="n">num_epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">output_numpy</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">to_str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
------------------------after tokenization-----------------------------
[&#39;▁Nothing&#39; &#39;▁in&#39; &#39;▁the&#39; &#39;▁world&#39; &#39;▁is&#39; &#39;▁difficult&#39; &#39;▁for&#39; &#39;▁one&#39; &#39;▁who&#39;
 &#39;▁sets&#39; &#39;▁his&#39; &#39;▁mind&#39; &#39;▁on&#39; &#39;▁it.&#39;]
</pre></div></div>
</div>
<p>从上面两次打印结果来看，数据集中的句子被<code class="docutils literal notranslate"><span class="pre">SentencePieceTokenizer</span></code>分词器以词语为最小单元进行了划分。在<code class="docutils literal notranslate"><span class="pre">SentencePieceTokenizer</span></code>分词器的处理过程中，空格作为普通符号处理，并使用下划线标记空格。</p>
</section>
<section id="unicodechartokenizer">
<h4>UnicodeCharTokenizer<a class="headerlink" href="#unicodechartokenizer" title="Permalink to this headline"></a></h4>
<p><code class="docutils literal notranslate"><span class="pre">UnicodeCharTokenizer</span></code>操作是根据Unicode字符集来分词的。</p>
<p>下面的样例首先构建了一个文本数据集，然后通过<code class="docutils literal notranslate"><span class="pre">UnicodeCharTokenizer</span></code>对数据集进行分词，并展示了分词前后的文本结果。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore.dataset</span> <span class="k">as</span> <span class="nn">ds</span>
<span class="kn">import</span> <span class="nn">mindspore.dataset.text</span> <span class="k">as</span> <span class="nn">text</span>

<span class="c1"># 构造待分词数据</span>
<span class="n">input_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Welcome to Beijing!&quot;</span><span class="p">,</span> <span class="s2">&quot;北京欢迎您！&quot;</span><span class="p">,</span> <span class="s2">&quot;我喜欢China!&quot;</span><span class="p">]</span>

<span class="c1"># 加载数据集</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">NumpySlicesDataset</span><span class="p">(</span><span class="n">input_list</span><span class="p">,</span> <span class="n">column_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">],</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;------------------------before tokenization----------------------------&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">create_dict_iterator</span><span class="p">(</span><span class="n">output_numpy</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">to_str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
------------------------before tokenization----------------------------
Welcome to Beijing!
北京欢迎您！
我喜欢China!
</pre></div></div>
</div>
<p>上面为数据集未被分词前的数据打印情况，下面使用<code class="docutils literal notranslate"><span class="pre">UnicodeCharTokenizer</span></code>分词器对数据集进行分词。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 使用UnicodeCharTokenizer分词器对数据集进行分词</span>
<span class="n">tokenizer_op</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">UnicodeCharTokenizer</span><span class="p">()</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">operations</span><span class="o">=</span><span class="n">tokenizer_op</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;------------------------after tokenization-----------------------------&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">create_dict_iterator</span><span class="p">(</span><span class="n">num_epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">output_numpy</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">to_str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
------------------------after tokenization-----------------------------
[&#39;W&#39;, &#39;e&#39;, &#39;l&#39;, &#39;c&#39;, &#39;o&#39;, &#39;m&#39;, &#39;e&#39;, &#39; &#39;, &#39;t&#39;, &#39;o&#39;, &#39; &#39;, &#39;B&#39;, &#39;e&#39;, &#39;i&#39;, &#39;j&#39;, &#39;i&#39;, &#39;n&#39;, &#39;g&#39;, &#39;!&#39;]
[&#39;北&#39;, &#39;京&#39;, &#39;欢&#39;, &#39;迎&#39;, &#39;您&#39;, &#39;！&#39;]
[&#39;我&#39;, &#39;喜&#39;, &#39;欢&#39;, &#39;C&#39;, &#39;h&#39;, &#39;i&#39;, &#39;n&#39;, &#39;a&#39;, &#39;!&#39;]
</pre></div></div>
</div>
<p>从上面两次打印结果可以看出，数据集中的句子被<code class="docutils literal notranslate"><span class="pre">UnicodeCharTokenizer</span></code>分词器进行分割，中文以单个汉字为最小单元，英文以单个字母为最小单元。</p>
</section>
<section id="whitespacetokenizer">
<h4>WhitespaceTokenizer<a class="headerlink" href="#whitespacetokenizer" title="Permalink to this headline"></a></h4>
<p><code class="docutils literal notranslate"><span class="pre">WhitespaceTokenizer</span></code>操作是根据空格来进行分词的。</p>
<p>下面的样例首先构建了一个文本数据集，然后通过<code class="docutils literal notranslate"><span class="pre">WhitespaceTokenizer</span></code>对数据集进行分词，并展示了分词前后的文本结果。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore.dataset</span> <span class="k">as</span> <span class="nn">ds</span>
<span class="kn">import</span> <span class="nn">mindspore.dataset.text</span> <span class="k">as</span> <span class="nn">text</span>

<span class="c1"># 构造待分词数据</span>
<span class="n">input_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Welcome to Beijing!&quot;</span><span class="p">,</span> <span class="s2">&quot;北京欢迎您！&quot;</span><span class="p">,</span> <span class="s2">&quot;我喜欢China!&quot;</span><span class="p">,</span> <span class="s2">&quot;床前明月光，疑是地上霜。&quot;</span><span class="p">]</span>

<span class="c1"># 加载数据集</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">NumpySlicesDataset</span><span class="p">(</span><span class="n">input_list</span><span class="p">,</span> <span class="n">column_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">],</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;------------------------before tokenization----------------------------&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">create_dict_iterator</span><span class="p">(</span><span class="n">output_numpy</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">to_str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
------------------------before tokenization----------------------------
Welcome to Beijing!
北京欢迎您！
我喜欢China!
床前明月光，疑是地上霜。
</pre></div></div>
</div>
<p>上面为数据集未被分词前的数据打印情况，下面使用<code class="docutils literal notranslate"><span class="pre">WhitespaceTokenizer</span></code>分词器对数据集进行分词。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 使用WhitespaceTokenizer分词器对数据集进行分词</span>
<span class="n">tokenizer_op</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">WhitespaceTokenizer</span><span class="p">()</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">operations</span><span class="o">=</span><span class="n">tokenizer_op</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;------------------------after tokenization-----------------------------&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">create_dict_iterator</span><span class="p">(</span><span class="n">num_epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">output_numpy</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">to_str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
------------------------after tokenization-----------------------------
[&#39;Welcome&#39;, &#39;to&#39;, &#39;Beijing!&#39;]
[&#39;北京欢迎您！&#39;]
[&#39;我喜欢China!&#39;]
[&#39;床前明月光，疑是地上霜。&#39;]
</pre></div></div>
</div>
<p>从上面两次打印结果可以看出，数据集中的句子被<code class="docutils literal notranslate"><span class="pre">WhitespaceTokenizer</span></code>分词器以空格为分隔符进行分割。</p>
</section>
<section id="wordpiecetokenizer">
<h4>WordpieceTokenizer<a class="headerlink" href="#wordpiecetokenizer" title="Permalink to this headline"></a></h4>
<p><code class="docutils literal notranslate"><span class="pre">WordpieceTokenizer</span></code>操作是基于单词集来进行划分的，划分依据可以是单词集中的单个单词，或者多个单词的组合形式。</p>
<p>下面的样例首先构建了一个文本数据集，然后从单词列表中构建<code class="docutils literal notranslate"><span class="pre">vocab</span></code>对象，通过<code class="docutils literal notranslate"><span class="pre">WordpieceTokenizer</span></code>对数据集进行分词，并展示了分词前后的文本结果。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mindspore.dataset</span> <span class="k">as</span> <span class="nn">ds</span>
<span class="kn">import</span> <span class="nn">mindspore.dataset.text</span> <span class="k">as</span> <span class="nn">text</span>

<span class="c1"># 构造待分词数据</span>
<span class="n">input_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;My&quot;</span><span class="p">,</span> <span class="s2">&quot;favorite&quot;</span><span class="p">,</span> <span class="s2">&quot;book&quot;</span><span class="p">,</span> <span class="s2">&quot;is&quot;</span><span class="p">,</span> <span class="s2">&quot;love&quot;</span><span class="p">,</span> <span class="s2">&quot;during&quot;</span><span class="p">,</span> <span class="s2">&quot;the&quot;</span><span class="p">,</span> <span class="s2">&quot;cholera&quot;</span><span class="p">,</span> <span class="s2">&quot;era&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;what&quot;</span><span class="p">,</span>
              <span class="s2">&quot;我&quot;</span><span class="p">,</span> <span class="s2">&quot;最&quot;</span><span class="p">,</span> <span class="s2">&quot;喜&quot;</span><span class="p">,</span> <span class="s2">&quot;欢&quot;</span><span class="p">,</span> <span class="s2">&quot;的&quot;</span><span class="p">,</span> <span class="s2">&quot;书&quot;</span><span class="p">,</span> <span class="s2">&quot;是&quot;</span><span class="p">,</span> <span class="s2">&quot;霍&quot;</span><span class="p">,</span> <span class="s2">&quot;乱&quot;</span><span class="p">,</span> <span class="s2">&quot;时&quot;</span><span class="p">,</span> <span class="s2">&quot;期&quot;</span><span class="p">,</span> <span class="s2">&quot;的&quot;</span><span class="p">,</span> <span class="s2">&quot;爱&quot;</span><span class="p">,</span> <span class="s2">&quot;情&quot;</span><span class="p">,</span> <span class="s2">&quot;。&quot;</span><span class="p">,</span> <span class="s2">&quot;好&quot;</span><span class="p">]</span>

<span class="c1"># 构造英文词汇表</span>
<span class="n">vocab_english</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;book&quot;</span><span class="p">,</span> <span class="s2">&quot;cholera&quot;</span><span class="p">,</span> <span class="s2">&quot;era&quot;</span><span class="p">,</span> <span class="s2">&quot;favor&quot;</span><span class="p">,</span> <span class="s2">&quot;##ite&quot;</span><span class="p">,</span> <span class="s2">&quot;My&quot;</span><span class="p">,</span> <span class="s2">&quot;is&quot;</span><span class="p">,</span> <span class="s2">&quot;love&quot;</span><span class="p">,</span> <span class="s2">&quot;dur&quot;</span><span class="p">,</span> <span class="s2">&quot;##ing&quot;</span><span class="p">,</span> <span class="s2">&quot;the&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">]</span>

<span class="c1"># 构造中文词汇表</span>
<span class="n">vocab_chinese</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;我&#39;</span><span class="p">,</span> <span class="s1">&#39;最&#39;</span><span class="p">,</span> <span class="s1">&#39;喜&#39;</span><span class="p">,</span> <span class="s1">&#39;欢&#39;</span><span class="p">,</span> <span class="s1">&#39;的&#39;</span><span class="p">,</span> <span class="s1">&#39;书&#39;</span><span class="p">,</span> <span class="s1">&#39;是&#39;</span><span class="p">,</span> <span class="s1">&#39;霍&#39;</span><span class="p">,</span> <span class="s1">&#39;乱&#39;</span><span class="p">,</span> <span class="s1">&#39;时&#39;</span><span class="p">,</span> <span class="s1">&#39;期&#39;</span><span class="p">,</span> <span class="s1">&#39;爱&#39;</span><span class="p">,</span> <span class="s1">&#39;情&#39;</span><span class="p">,</span> <span class="s1">&#39;。&#39;</span><span class="p">]</span>

<span class="c1"># 加载数据集</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">NumpySlicesDataset</span><span class="p">(</span><span class="n">input_list</span><span class="p">,</span> <span class="n">column_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">],</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;------------------------before tokenization----------------------------&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">create_dict_iterator</span><span class="p">(</span><span class="n">output_numpy</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">to_str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
------------------------before tokenization----------------------------
My
favorite
book
is
love
during
the
cholera
era
.
what
我
最
喜
欢
的
书
是
霍
乱
时
期
的
爱
情
。
好
</pre></div></div>
</div>
<p>上面为数据集未被分词前的数据打印情况，此处特意构造了词汇表中没有的单词“what”和“好”，下面使用<code class="docutils literal notranslate"><span class="pre">WordpieceTokenizer</span></code>分词器对数据集进行分词。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 使用WordpieceTokenizer分词器对数据集进行分词</span>
<span class="n">vocab</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">Vocab</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">vocab_english</span><span class="o">+</span><span class="n">vocab_chinese</span><span class="p">)</span>
<span class="n">tokenizer_op</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">WordpieceTokenizer</span><span class="p">(</span><span class="n">vocab</span><span class="o">=</span><span class="n">vocab</span><span class="p">)</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">operations</span><span class="o">=</span><span class="n">tokenizer_op</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;------------------------after tokenization-----------------------------&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">create_dict_iterator</span><span class="p">(</span><span class="n">num_epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">output_numpy</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">to_str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
------------------------after tokenization-----------------------------
[&#39;My&#39;]
[&#39;favor&#39; &#39;##ite&#39;]
[&#39;book&#39;]
[&#39;is&#39;]
[&#39;love&#39;]
[&#39;dur&#39; &#39;##ing&#39;]
[&#39;the&#39;]
[&#39;cholera&#39;]
[&#39;era&#39;]
[&#39;.&#39;]
[&#39;[UNK]&#39;]
[&#39;我&#39;]
[&#39;最&#39;]
[&#39;喜&#39;]
[&#39;欢&#39;]
[&#39;的&#39;]
[&#39;书&#39;]
[&#39;是&#39;]
[&#39;霍&#39;]
[&#39;乱&#39;]
[&#39;时&#39;]
[&#39;期&#39;]
[&#39;的&#39;]
[&#39;爱&#39;]
[&#39;情&#39;]
[&#39;。&#39;]
[&#39;[UNK]&#39;]
</pre></div></div>
</div>
<p>从上面两次打印结果可以看出，数据集中的词语被<code class="docutils literal notranslate"><span class="pre">WordpieceTokenizer</span></code>分词器以构造的词汇表进行分词，“My”仍然被分为“My”，“love”仍然被分为“love”。值得注意的是，“favorite”被分为了“favor”和“##ite”，由于“word”和“好”在词汇表中未找到，所以使用[UNK]表示。</p>
</section>
</section>
</section>
</section>


           </div>
           
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="augment_image_data.html" class="btn btn-neutral float-left" title="图像数据加载与增强" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="augment_graph_data.html" class="btn btn-neutral float-right" title="图数据加载与处理" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, MindSpore.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   
	<script async="async" src="https://cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>