

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>mindspore_xai.explainer.neighbor.pseudo_linear_coef &mdash; MindSpore master documentation</title>
  

  
   
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  
  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/language_data.js"></script>
        
        
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home" alt="Documentation Home"> MindSpore
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">MindSpore XAI Installation</a></li>
</ul>
<p class="caption"><span class="caption-text">Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../using_cv_explainers.html">Using CV Explainers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../using_cv_benchmarks.html">Using CV Benchmarks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../using_tabular_explainers.html">Using Tabular Explainers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../using_tabsim.html">Using TabSim Data Simulator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../using_tbnet.html">Using TB-Net Whitebox Recommendation Model</a></li>
</ul>
<p class="caption"><span class="caption-text">API References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../mindspore_xai.explainer.html">mindspore_xai.explainer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mindspore_xai.benchmark.html">mindspore_xai.benchmark</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mindspore_xai.tool.html">mindspore_xai.tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mindspore_xai.visual.html">mindspore_xai.visual</a></li>
</ul>
<p class="caption"><span class="caption-text">FAQ</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../troubleshoot.html">Troubleshooting</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">MindSpore</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>mindspore_xai.explainer.neighbor.pseudo_linear_coef</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for mindspore_xai.explainer.neighbor.pseudo_linear_coef</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2022 Huawei Technologies Co., Ltd</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1"># http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>
<span class="c1"># ============================================================================</span>
<span class="sd">&quot;&quot;&quot;Pseudo Linear Coefficients (PLC).&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="kn">import</span> <span class="nn">mindspore</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">nn</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">ops</span>
<span class="kn">from</span> <span class="nn">mindspore</span> <span class="kn">import</span> <span class="n">ms_function</span>
<span class="kn">from</span> <span class="nn">mindspore.train._utils</span> <span class="kn">import</span> <span class="n">check_value_type</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">mindspore_xai.common.utils</span> <span class="kn">import</span> <span class="n">is_notebook</span>
<span class="kn">from</span> <span class="nn">mindspore_xai.tool.tab.neighbor</span> <span class="kn">import</span> <span class="n">SimpleNN</span>


<span class="n">_squeeze</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">Squeeze</span><span class="p">()</span>
<span class="n">_square</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">Square</span><span class="p">()</span>
<span class="n">_sqrt</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">Sqrt</span><span class="p">()</span>
<span class="n">_zeros</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">Zeros</span><span class="p">()</span>
<span class="n">_log</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">Log</span><span class="p">()</span>
<span class="n">_not</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">LogicalNot</span><span class="p">()</span>
<span class="n">_is_finite</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">IsFinite</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">_StepwiseComputer</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper of computing PLC for stepwise classifiers.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eps</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eps</span> <span class="o">=</span> <span class="n">eps</span>

    <span class="nd">@ms_function</span>
    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queries</span><span class="p">,</span> <span class="n">nearests</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Computation.&quot;&quot;&quot;</span>
        <span class="n">displaces</span> <span class="o">=</span> <span class="n">nearests</span> <span class="o">-</span> <span class="n">queries</span>
        <span class="n">dists</span> <span class="o">=</span> <span class="n">_sqrt</span><span class="p">(</span><span class="n">_square</span><span class="p">(</span><span class="n">displaces</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">is_same</span> <span class="o">=</span> <span class="n">dists</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eps</span>
        <span class="n">dists</span> <span class="o">+=</span> <span class="n">is_same</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">dists</span> <span class="o">=</span> <span class="n">dists</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">unit_vecs</span> <span class="o">=</span> <span class="n">displaces</span> <span class="o">/</span> <span class="n">dists</span>
        <span class="n">unit_vecs</span> <span class="o">*=</span> <span class="n">_not</span><span class="p">(</span><span class="n">is_same</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">plc</span> <span class="o">=</span> <span class="n">unit_vecs</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">queries</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">plc</span>


<span class="k">class</span> <span class="nc">_Computer</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper of computing PLC.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classifier</span><span class="p">,</span> <span class="n">riemann</span><span class="p">,</span> <span class="n">eps</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_classifier</span> <span class="o">=</span> <span class="n">classifier</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_riemann</span> <span class="o">=</span> <span class="n">riemann</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_t</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span><span class="n">p</span> <span class="o">/</span> <span class="n">riemann</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">riemann</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_t</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eps</span> <span class="o">=</span> <span class="n">eps</span>

    <span class="nd">@ms_function</span>
    <span class="k">def</span> <span class="nf">_pre_compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">nearest</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prepare for the actual computation.&quot;&quot;&quot;</span>
        <span class="n">displace</span> <span class="o">=</span> <span class="n">_squeeze</span><span class="p">(</span><span class="n">nearest</span> <span class="o">-</span> <span class="n">query</span><span class="p">)</span>
        <span class="n">sq_dist</span> <span class="o">=</span> <span class="n">_square</span><span class="p">(</span><span class="n">displace</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">query</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_t</span><span class="p">)</span> <span class="o">+</span> <span class="n">nearest</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_t</span>
        <span class="k">return</span> <span class="n">displace</span><span class="p">,</span> <span class="n">sq_dist</span><span class="p">,</span> <span class="n">u</span>

    <span class="nd">@ms_function</span>
    <span class="k">def</span> <span class="nf">_compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">displace</span><span class="p">,</span> <span class="n">sq_dist</span><span class="p">,</span> <span class="n">fu</span><span class="p">,</span> <span class="n">plc_sum</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Do compute the PLC.&quot;&quot;&quot;</span>
        <span class="c1"># Riemann sum</span>
        <span class="n">minus_fu</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">fu</span>
        <span class="n">log_fu</span> <span class="o">=</span> <span class="n">_log</span><span class="p">(</span><span class="n">fu</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eps</span><span class="p">)</span>
        <span class="n">log_minus_fu</span> <span class="o">=</span> <span class="n">_log</span><span class="p">(</span><span class="n">minus_fu</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eps</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">fu</span> <span class="o">*</span> <span class="n">log_fu</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">minus_fu</span> <span class="o">*</span> <span class="n">log_minus_fu</span><span class="p">)</span>
        <span class="n">ig_h</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_riemann</span>
        <span class="n">ig_h</span> <span class="o">/=</span> <span class="mf">0.69314718056</span>  <span class="c1"># ln(2)=0.69314718056, change to base 2</span>

        <span class="n">sample_plc</span> <span class="o">=</span> <span class="p">(</span><span class="n">displace</span> <span class="o">*</span> <span class="p">(</span><span class="n">fu</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">fu</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">/</span> <span class="p">(</span><span class="n">sq_dist</span> <span class="o">*</span> <span class="n">ig_h</span><span class="p">)</span>
        <span class="n">sample_plc</span> <span class="o">=</span> <span class="n">sample_plc</span><span class="o">.</span><span class="n">masked_fill</span><span class="p">(</span><span class="n">_not</span><span class="p">(</span><span class="n">_is_finite</span><span class="p">(</span><span class="n">sample_plc</span><span class="p">)),</span> <span class="mf">0.0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">plc_sum</span> <span class="o">+</span> <span class="n">sample_plc</span>

    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">nearest</span><span class="p">,</span> <span class="n">plc_sum</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Computation.&quot;&quot;&quot;</span>
        <span class="n">displace</span><span class="p">,</span> <span class="n">sq_dist</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pre_compute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">nearest</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sq_dist</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eps</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">plc_sum</span>
        <span class="n">fu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_classifier</span><span class="p">(</span><span class="n">u</span><span class="p">)[:,</span> <span class="n">target</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute</span><span class="p">(</span><span class="n">displace</span><span class="p">,</span> <span class="n">sq_dist</span><span class="p">,</span> <span class="n">fu</span><span class="p">,</span> <span class="n">plc_sum</span><span class="p">)</span>


<div class="viewcode-block" id="PseudoLinearCoef"><a class="viewcode-back" href="../../../../mindspore_xai.explainer.html#mindspore_xai.explainer.PseudoLinearCoef">[docs]</a><span class="k">class</span> <span class="nc">PseudoLinearCoef</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pseudo Linear Coefficients (PLC) for classifiers.</span>

<span class="sd">        PLC is a global attribution method, it is a measure of feature sensitivities around the classifier&#39;s decision</span>
<span class="sd">        boundaries from the data distribution&#39;s point of view.</span>

<span class="sd">        PLC of class A:</span>

<span class="sd">        .. math::</span>

<span class="sd">            \vec{R}(A)=\int \vec{S}(A,nearest_{A}(x),x)p_{\neg A}(x)dx</span>

<span class="sd">        PLC of class A (target class) relative to class B (view point class), it is called Relative PLC:</span>

<span class="sd">        .. math::</span>

<span class="sd">            \vec{R}(A,B)=\int \vec{S}(A,nearest_{A}(x),x)p_{B}(x)dx</span>

<span class="sd">        Where:</span>

<span class="sd">        .. math::</span>

<span class="sd">            nearest_A(x):=\underset{g\in G}{argmin}(\left \| g-x \right \|)\text{ }s.t.\text{ } g\neq x,f_A(g)</span>
<span class="sd">            \geq \xi</span>

<span class="sd">            \vec{S}(A,a,x)=\left\{\begin{matrix}</span>
<span class="sd">            \vec{0} &amp; \text{if }f_A(x)\geq \xi \\</span>
<span class="sd">            \frac{a-x}{\left \| a-x \right \|} &amp; \text{if }f_A(\cdot )\text{ is a step function}\\</span>
<span class="sd">            \frac{(a-x)(f_{A}(a)-f_A(x))}{\left \| a-x \right \|^{2}\int_{0}^{1}h(f_A(u(t)))dt} &amp; \text{else}</span>
<span class="sd">            \end{matrix}\right.</span>

<span class="sd">        .. math::</span>

<span class="sd">            u(t)=ta+(1-t)x</span>

<span class="sd">        .. math::</span>

<span class="sd">            h(f_{A})=-f_{A}log_2(f_{A})-(1-f_A)log_2(1-f_A)</span>

<span class="sd">        :math:`G` is the universal sample set, :math:`f_A(\cdot )` is the predicted probability of class A,</span>
<span class="sd">        :math:`\xi` is the decision threshold (usually 0.5). :math:`p_{\neg A}` and :math:`p_{B}` are the PDF of</span>
<span class="sd">        sample&#39;s distribution of non A class(es) and class B representatively. Beware that the ground truth labels take</span>
<span class="sd">        no part in PLC, a sample&#39;s classes are determined by the classifier.</span>

<span class="sd">        Note:</span>
<span class="sd">            If `predictor` is a function, `stepwise` is `False` and it is running in graph mode then</span>
<span class="sd">            `predictor` must complies with the</span>
<span class="sd">            `static graph syntax &lt;https://mindspore.cn/docs/en/master/note/static_graph_syntax_support.html&gt;`_. PLC may</span>
<span class="sd">            not be accurate if there are many samples classified to more than one class.</span>

<span class="sd">        Args:</span>
<span class="sd">            predictor (Cell, Callable): The classifier :math:`f(\cdot )` to be explained, it must take an input tensor</span>
<span class="sd">                with shape :math:`(N, K)` and output a probability tensor with shape :math:`(N, L)`. :math:`K` is the</span>
<span class="sd">                number of features. Both input and output tensors should have dtype `ms.float32` or `ms.float64` .</span>
<span class="sd">            num_classes (int): The number of classes :math:`L`.</span>
<span class="sd">            class_names (list[str], tuple[str], optional): List/tuple of class names, ordered according to whatever the</span>
<span class="sd">                classifier is using. If not present, class names will be &#39;Class 0&#39;, &#39;Class 1&#39;, ... Default: ``None``.</span>
<span class="sd">            feature_names (list[str], tuple[str], optional): List/tuple of feature names corresponding to the columns in</span>
<span class="sd">                the training data. If not present, feature names will be &#39;feature 0&#39;, &#39;feature 1&#39;, ...</span>
<span class="sd">                Default: ``None``.</span>
<span class="sd">            stepwise (bool, optional): Set to ``True`` if `predictor` outputs 0s and 1s only. Default: `False`.</span>
<span class="sd">            threshold (float, optional): Decision threshold :math:`\xi` of classification. Default: ``0.5``.</span>
<span class="sd">            monte_carlo (int, optional): The number of Monte Carlo samples for computing the integrals :math:`\vec{R}`.</span>
<span class="sd">                Default: ``1000``. Higher the number more lengthy and accurate the computation.</span>
<span class="sd">            riemann (int, optional): The number of Riemann sum partitions for computing the integrals</span>
<span class="sd">                :math:`\int_{0}^{1}h(f_A(u(t)))dt`. Default: ``1000``. Higher the number more lengthy and accurate the</span>
<span class="sd">                computation.</span>
<span class="sd">            batch_size(int, optional): Batch size for `predictor` when finding nearest neighbors. Default: ``2000``.</span>
<span class="sd">            eps (float, optional): Degree of tolerance. This value must be greater than 0. Default: ``1e-9``.</span>

<span class="sd">        Inputs:</span>
<span class="sd">            - **features** (Tensor) - The universal sample set :math:`G`. Practically, it is often the training set or</span>
<span class="sd">              its random subset. The shape must be :math:`(|G|, K)`, :math:`|G|` is the total number of samples. The</span>
<span class="sd">              input tensor should have dtype `ms.float32` or `ms.float64` .</span>
<span class="sd">            - **max_classes** (int, optional)- Maximum number of classes to be shown. Default: ``5``.</span>
<span class="sd">            - **max_features** (int, optional) - Maximum number of features to be shown. Default: ``5``.</span>
<span class="sd">            - **show** (bool, optional) - Show the explanation figures, ``None`` means automatically show</span>
<span class="sd">              the explanation figures if it is running on JupyterLab. Default: ``None``.</span>

<span class="sd">        Outputs:</span>
<span class="sd">            - **plc** (Tensor) - Pseudo Linear Coefficients in shape of :math:`(L, K)`.</span>
<span class="sd">            - **relative plc** (Tensor) - Relative Pseudo Linear Coefficients in shape of :math:`(L, L, K)`. The first</span>
<span class="sd">              :math:`L` axis is for the target classes and the second one is for the view point classes.</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: Be raised for any argument or input type problem.</span>
<span class="sd">            ValueError: Be raised for any input value problem.</span>
<span class="sd">            AttributeError: Be raised for underlying is missing any required attribute.</span>

<span class="sd">        Supported Platforms:</span>
<span class="sd">            ``Ascend`` ``GPU`` ``CPU``</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; import numpy as np</span>
<span class="sd">            &gt;&gt;&gt; import mindspore as ms</span>
<span class="sd">            &gt;&gt;&gt; from mindspore import nn</span>
<span class="sd">            &gt;&gt;&gt; from mindspore import ops</span>
<span class="sd">            &gt;&gt;&gt; from mindspore_xai.explainer import PseudoLinearCoef</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; class Classifier(nn.Cell):</span>
<span class="sd">            ...     def construct(self, x):</span>
<span class="sd">            ...         y = ops.Zeros()((x.shape[0], 3), ms.float32)</span>
<span class="sd">            ...         y[:, 0] = -x[:, 0] + x[:, 1] + x[: ,2] - 0.5</span>
<span class="sd">            ...         y[:, 1] =  x[:, 0] - x[:, 1] + x[: ,2] - 0.5</span>
<span class="sd">            ...         y[:, 2] =  x[:, 0] + x[:, 1] - x[: ,2] - 0.5</span>
<span class="sd">            ...         return ops.Sigmoid()(y * 10)</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; classifier = Classifier()</span>
<span class="sd">            &gt;&gt;&gt; explainer = PseudoLinearCoef(classifier, num_classes=3)</span>
<span class="sd">            &gt;&gt;&gt; features = ms.Tensor(np.random.uniform(size=(10000, 5)), dtype=ms.float32)  # 5 features</span>
<span class="sd">            &gt;&gt;&gt; plc, relative_plc = explainer(features)</span>
<span class="sd">            &gt;&gt;&gt; print(str(plc.shape))</span>
<span class="sd">            (3, 5)</span>
<span class="sd">            &gt;&gt;&gt; print(str(relative_plc.shape))</span>
<span class="sd">            (3, 3, 5)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predictor</span><span class="p">,</span> <span class="n">num_classes</span><span class="p">,</span> <span class="n">class_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">feature_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stepwise</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                 <span class="n">monte_carlo</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">riemann</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-9</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">callable</span><span class="p">(</span><span class="n">predictor</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">predictor</span><span class="p">,</span> <span class="n">nn</span><span class="o">.</span><span class="n">Cell</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;predictor must be Cell object or function.&quot;</span><span class="p">)</span>
        <span class="n">check_value_type</span><span class="p">(</span><span class="s2">&quot;num_classes&quot;</span><span class="p">,</span> <span class="n">num_classes</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
        <span class="n">check_value_type</span><span class="p">(</span><span class="s2">&quot;class_names&quot;</span><span class="p">,</span> <span class="n">class_names</span><span class="p">,</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)])</span>
        <span class="k">if</span> <span class="ow">not</span><span class="p">((</span><span class="n">class_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">class_names</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The elements in class_names should be str.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_names</span><span class="p">(</span><span class="s2">&quot;class_names&quot;</span><span class="p">,</span> <span class="n">class_names</span><span class="p">,</span> <span class="n">num_classes</span><span class="p">)</span>
        <span class="n">check_value_type</span><span class="p">(</span><span class="s2">&quot;feature_names&quot;</span><span class="p">,</span> <span class="n">feature_names</span><span class="p">,</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)])</span>
        <span class="k">if</span> <span class="ow">not</span><span class="p">((</span><span class="n">feature_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">feature_names</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The elements in feature_names should be str.&quot;</span><span class="p">)</span>
        <span class="n">check_value_type</span><span class="p">(</span><span class="s2">&quot;stepwise&quot;</span><span class="p">,</span> <span class="n">stepwise</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
        <span class="n">check_value_type</span><span class="p">(</span><span class="s2">&quot;threshold&quot;</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_values</span><span class="p">(</span><span class="s2">&quot;threshold&quot;</span><span class="p">,</span> <span class="n">threshold</span><span class="p">)</span>
        <span class="n">check_value_type</span><span class="p">(</span><span class="s2">&quot;monte_carlo&quot;</span><span class="p">,</span> <span class="n">monte_carlo</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_values</span><span class="p">(</span><span class="s2">&quot;monte_carlo&quot;</span><span class="p">,</span> <span class="n">monte_carlo</span><span class="p">)</span>
        <span class="n">check_value_type</span><span class="p">(</span><span class="s2">&quot;riemann&quot;</span><span class="p">,</span> <span class="n">riemann</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_values</span><span class="p">(</span><span class="s2">&quot;riemann&quot;</span><span class="p">,</span> <span class="n">riemann</span><span class="p">)</span>
        <span class="n">check_value_type</span><span class="p">(</span><span class="s2">&quot;batch_size&quot;</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_values</span><span class="p">(</span><span class="s2">&quot;batch_size&quot;</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span>
        <span class="n">check_value_type</span><span class="p">(</span><span class="s2">&quot;eps&quot;</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_values</span><span class="p">(</span><span class="s2">&quot;eps&quot;</span><span class="p">,</span> <span class="n">eps</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_classifier</span> <span class="o">=</span> <span class="n">predictor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_classes</span> <span class="o">=</span> <span class="n">num_classes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_class_names</span> <span class="o">=</span> <span class="n">class_names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_feature_names</span> <span class="o">=</span> <span class="n">feature_names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stepwise</span> <span class="o">=</span> <span class="n">stepwise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_threshold</span> <span class="o">=</span> <span class="n">threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_monte_carlo</span> <span class="o">=</span> <span class="n">monte_carlo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_batch_size</span> <span class="o">=</span> <span class="n">batch_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eps</span> <span class="o">=</span> <span class="n">eps</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stepwise</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_computer</span> <span class="o">=</span> <span class="n">_StepwiseComputer</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_computer</span> <span class="o">=</span> <span class="n">_Computer</span><span class="p">(</span><span class="n">predictor</span><span class="p">,</span> <span class="n">riemann</span><span class="p">,</span> <span class="n">eps</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_computer</span><span class="o">.</span><span class="n">set_train</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">max_classes</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute PLC and Relative PLC.&quot;&quot;&quot;</span>
        <span class="n">check_value_type</span><span class="p">(</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">((</span><span class="n">features</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">ms</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">ms</span><span class="o">.</span><span class="n">float64</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The features tensor should have dtype ms.float32 or ms.float64.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_names</span><span class="p">(</span><span class="s2">&quot;feature_names&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feature_names</span><span class="p">,</span> <span class="n">features</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">check_value_type</span><span class="p">(</span><span class="s2">&quot;max_classes&quot;</span><span class="p">,</span> <span class="n">max_classes</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_values</span><span class="p">(</span><span class="s2">&quot;max_classes&quot;</span><span class="p">,</span> <span class="n">max_classes</span><span class="p">)</span>
        <span class="n">check_value_type</span><span class="p">(</span><span class="s2">&quot;max_features&quot;</span><span class="p">,</span> <span class="n">max_features</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_values</span><span class="p">(</span><span class="s2">&quot;max_features&quot;</span><span class="p">,</span> <span class="n">max_features</span><span class="p">)</span>
        <span class="n">check_value_type</span><span class="p">(</span><span class="s2">&quot;show&quot;</span><span class="p">,</span> <span class="n">show</span><span class="p">,</span> <span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)])</span>

        <span class="k">if</span> <span class="n">show</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">show</span> <span class="o">=</span> <span class="n">is_notebook</span><span class="p">()</span>

        <span class="n">nn_finder</span> <span class="o">=</span> <span class="n">SimpleNN</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_classifier</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_classes</span><span class="p">,</span>
                             <span class="n">batch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_batch_size</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_threshold</span><span class="p">)</span>

        <span class="n">plc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_classes</span><span class="p">,</span> <span class="n">features</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">relative_plc</span> <span class="o">=</span> <span class="n">_zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_classes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_classes</span><span class="p">,</span> <span class="n">features</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">ms</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="c1"># may different from features.shape[0]</span>
        <span class="n">all_finder_samples_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">nn_finder</span><span class="o">.</span><span class="n">sample_count</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_classes</span><span class="p">)])</span>
        <span class="n">pairs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">t</span><span class="p">,</span> <span class="n">vp</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_classes</span><span class="p">)</span> <span class="k">for</span> <span class="n">vp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_classes</span><span class="p">)</span> <span class="k">if</span> <span class="n">t</span> <span class="o">!=</span> <span class="n">vp</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">target</span><span class="p">,</span> <span class="n">view_point</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">pairs</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Compute Pseudo Linear Coef.&#39;</span><span class="p">):</span>
            <span class="n">vp_samples</span> <span class="o">=</span> <span class="n">nn_finder</span><span class="o">.</span><span class="n">sample_count</span><span class="p">(</span><span class="n">view_point</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">vp_samples</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">total_vp_samples</span> <span class="o">=</span> <span class="n">all_finder_samples_count</span> <span class="o">-</span> <span class="n">nn_finder</span><span class="o">.</span><span class="n">sample_count</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
            <span class="n">plc_ele</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_relative</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">view_point</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">nn_finder</span><span class="p">)</span>
            <span class="n">relative_plc</span><span class="p">[</span><span class="n">target</span><span class="p">,</span> <span class="n">view_point</span><span class="p">]</span> <span class="o">=</span> <span class="n">plc_ele</span>
            <span class="n">vp_weight</span> <span class="o">=</span> <span class="n">vp_samples</span> <span class="o">/</span> <span class="n">total_vp_samples</span>
            <span class="n">plc</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">plc_ele</span> <span class="o">*</span> <span class="n">vp_weight</span><span class="p">)</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
            <span class="n">plc_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plc_to_list</span><span class="p">(</span><span class="n">plc</span><span class="p">,</span> <span class="n">max_classes</span><span class="p">)</span>
            <span class="n">sorted_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">abs</span><span class="p">,</span> <span class="n">plc_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feature_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_feature_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;feature </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">plc_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]))]</span>
            <span class="n">sorted_feat</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sorted_id</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_feature_names</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">target</span><span class="p">,</span> <span class="n">target_plc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">plc_list</span><span class="p">):</span>
                <span class="n">target_plc</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sorted_id</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">target_plc</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">max_features</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_feature_names</span><span class="p">):</span>
                    <span class="n">target_plc</span><span class="p">,</span> <span class="n">sorted_feat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_limit_feat</span><span class="p">(</span><span class="n">target_plc</span><span class="p">,</span> <span class="n">sorted_feat</span><span class="p">,</span> <span class="n">max_features</span><span class="p">)</span>
                <span class="n">title</span><span class="p">,</span> <span class="n">yaxis_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_display_format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_class_names</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span>
                                                          <span class="n">sorted_feat</span><span class="p">,</span> <span class="n">target_plc</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">target</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">plc_list</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_display</span><span class="p">(</span><span class="n">target_plc</span><span class="p">,</span> <span class="n">yaxis_label</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_classes</span><span class="o">-</span><span class="n">max_classes</span><span class="p">,</span>
                                  <span class="n">features</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">max_features</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_display</span><span class="p">(</span><span class="n">target_plc</span><span class="p">,</span> <span class="n">yaxis_label</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">plc</span><span class="p">),</span> <span class="n">relative_plc</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_plc_to_list</span><span class="p">(</span><span class="n">plc</span><span class="p">,</span> <span class="n">max_classes</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert the plc tensor to list.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">plc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">max_classes</span><span class="p">:</span>
            <span class="n">plc</span> <span class="o">=</span> <span class="n">plc</span><span class="p">[:</span><span class="n">max_classes</span><span class="p">]</span>
        <span class="n">plc_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">plc</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">plc_list</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_check_names</span><span class="p">(</span><span class="n">var_name</span><span class="p">,</span> <span class="n">input_names</span><span class="p">,</span> <span class="n">num_data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check the length of the feature names and class names.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span><span class="p">((</span><span class="n">input_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">num_data</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_names</span><span class="p">))):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The length of </span><span class="si">{}</span><span class="s1"> should be equal to </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var_name</span><span class="p">,</span> <span class="n">num_data</span><span class="p">))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_check_values</span><span class="p">(</span><span class="n">var_name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check the values.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The value of </span><span class="si">{}</span><span class="s1"> should be greater than 0.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var_name</span><span class="p">))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_display_format</span><span class="p">(</span><span class="n">class_names</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">sorted_feat</span><span class="p">,</span> <span class="n">target_plc</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create title and labels for the graph.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">class_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">class_names</span><span class="p">[</span><span class="n">target</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Class </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

        <span class="n">yaxis_label</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> : </span><span class="si">{1:.5g}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sorted_feat</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="nb">float</span><span class="p">(</span><span class="n">target_plc</span><span class="p">[</span><span class="n">x</span><span class="p">]))</span>
                       <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sorted_feat</span><span class="p">))]</span>
        <span class="k">return</span> <span class="n">title</span><span class="p">,</span> <span class="n">yaxis_label</span>

<div class="viewcode-block" id="PseudoLinearCoef.plot"><a class="viewcode-back" href="../../../../mindspore_xai.explainer.html#mindspore_xai.explainer.PseudoLinearCoef.plot">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">plc</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">feature_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the specific bidirectional chart for a PLC or Relative PLC pair.</span>

<span class="sd">        Args:</span>
<span class="sd">            plc (Tensor): Pseudo Linear Coefficients or Relative Pseudo Linear Coefficients in shape of :math:`(K,)`.</span>
<span class="sd">            title (str, optional): Chart title. If not present, chart title will not be displayed. Default: ``None``.</span>
<span class="sd">            feature_names (list[str], tuple[str], optional): Feature names. If not present, feature names will be</span>
<span class="sd">                &#39;feature 0&#39;, &#39;feature 1&#39;, ... Default: ``None``.</span>
<span class="sd">            max_features (int, optional): Maximum number of features to be shown. Default: ``5``.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Be raised for any input value problem.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; from mindspore import Tensor</span>
<span class="sd">            &gt;&gt;&gt; from mindspore_xai.explainer import PseudoLinearCoef</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; plc = Tensor([[0.1, 0.6, 0.8], [-2, 0.2, 0.4], [0.4, 0.1, -0.1]])</span>
<span class="sd">            &gt;&gt;&gt; PseudoLinearCoef.plot(plc[0], title=&#39;Chart Title&#39;, feature_names=[&#39;f1&#39;,&#39;f2&#39;,&#39;f3&#39;])</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; relative_plc = Tensor([[[0., 0., 0.], [-2, 0.2, 0.4]], [[0.4, 0.1, -0.1], [0., 0., 0.]]])</span>
<span class="sd">            &gt;&gt;&gt; PseudoLinearCoef.plot(relative_plc[0, 1], title=&#39;Chart Title&#39;, feature_names=[&#39;f1&#39;,&#39;f2&#39;,&#39;f3&#39;])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_value_type</span><span class="p">(</span><span class="s2">&quot;plc&quot;</span><span class="p">,</span> <span class="n">plc</span><span class="p">,</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">((</span><span class="n">plc</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">ms</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">plc</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">ms</span><span class="o">.</span><span class="n">float64</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The plc tensor should have dtype ms.float32 or ms.float64.&quot;</span><span class="p">)</span>
        <span class="n">check_value_type</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)])</span>
        <span class="n">check_value_type</span><span class="p">(</span><span class="s2">&quot;feature_names&quot;</span><span class="p">,</span> <span class="n">feature_names</span><span class="p">,</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)])</span>
        <span class="k">if</span> <span class="ow">not</span><span class="p">((</span><span class="n">feature_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">feature_names</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The elements in feature_names should be str.&quot;</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_check_names</span><span class="p">(</span><span class="s2">&quot;feature_names&quot;</span><span class="p">,</span> <span class="n">feature_names</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">plc</span><span class="p">))</span>
        <span class="n">check_value_type</span><span class="p">(</span><span class="s2">&quot;max_features&quot;</span><span class="p">,</span> <span class="n">max_features</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_check_values</span><span class="p">(</span><span class="s2">&quot;max_features&quot;</span><span class="p">,</span> <span class="n">max_features</span><span class="p">)</span>

        <span class="n">sorted_plc</span><span class="p">,</span> <span class="n">sorted_feat</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_sort_order</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">plc</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">()),</span> <span class="n">feature_names</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_plc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_features</span><span class="p">:</span>
            <span class="n">sorted_plc</span><span class="p">,</span> <span class="n">sorted_feat</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_limit_feat</span><span class="p">(</span><span class="n">sorted_plc</span><span class="p">,</span> <span class="n">sorted_feat</span><span class="p">,</span> <span class="n">max_features</span><span class="p">)</span>
        <span class="n">yaxis_label</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> : </span><span class="si">{1:.5g}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sorted_feat</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="nb">float</span><span class="p">(</span><span class="n">sorted_plc</span><span class="p">[</span><span class="n">x</span><span class="p">]))</span>
                       <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sorted_plc</span><span class="p">))]</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_display</span><span class="p">(</span><span class="n">sorted_plc</span><span class="p">,</span> <span class="n">yaxis_label</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_plc</span><span class="p">)</span> <span class="o">-</span> <span class="n">max_features</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_limit_feat</span><span class="p">(</span><span class="n">sorted_plc</span><span class="p">,</span> <span class="n">sorted_feat</span><span class="p">,</span> <span class="n">max_features</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Limit the number of features.&quot;&quot;&quot;</span>
        <span class="n">sorted_plc</span> <span class="o">=</span> <span class="n">sorted_plc</span><span class="p">[</span><span class="o">-</span><span class="n">max_features</span><span class="p">:]</span>
        <span class="n">sorted_feat</span> <span class="o">=</span> <span class="n">sorted_feat</span><span class="p">[</span><span class="o">-</span><span class="n">max_features</span><span class="p">:]</span>
        <span class="k">return</span> <span class="n">sorted_plc</span><span class="p">,</span> <span class="n">sorted_feat</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_sort_order</span><span class="p">(</span><span class="n">plc</span><span class="p">,</span> <span class="n">feature_names</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Arrange the value with their id in descending order.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">feature_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">feature_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;feature </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">plc</span><span class="p">))]</span>
        <span class="n">sort_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">abs</span><span class="p">,</span> <span class="n">plc</span><span class="p">)))</span>
        <span class="n">feature_names</span><span class="p">,</span> <span class="n">plc</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sort_id</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">feature_names</span><span class="p">,</span> <span class="n">plc</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">plc</span><span class="p">,</span> <span class="n">feature_names</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_display</span><span class="p">(</span><span class="n">plc</span><span class="p">,</span> <span class="n">yaxis_label</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">classes_left</span><span class="p">,</span> <span class="n">features_left</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Display the graph for the PLC and relative PLC.&quot;&quot;&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">plc</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)))</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;green&#39;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;red&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">plc</span><span class="p">]</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">plc</span><span class="p">))</span> <span class="o">+</span> <span class="mf">.5</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">plc</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">yaxis_label</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">classes_left</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">features_left</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> more class(es) and </span><span class="si">{}</span><span class="s1"> more feature(s)... &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">classes_left</span><span class="p">,</span> <span class="n">features_left</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">classes_left</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> more class(es)... &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">classes_left</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">features_left</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> more feature(s)... &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">features_left</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="PseudoLinearCoef.normalize"><a class="viewcode-back" href="../../../../mindspore_xai.explainer.html#mindspore_xai.explainer.PseudoLinearCoef.normalize">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">plc</span><span class="p">,</span> <span class="n">per_vector</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-9</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Normalize Pseudo Linear Coefficients to range [-1, 1].</span>

<span class="sd">        Warning:</span>
<span class="sd">            Normalizing PLC from unnormalized features may lead to misleading results.</span>

<span class="sd">        Args:</span>
<span class="sd">            plc (Tensor): The PLC or Relative PLC to be normalized.</span>
<span class="sd">            per_vector (bool, optional): Normalize within each :math:`\vec{R}` vector. Default: ``False``.</span>
<span class="sd">            eps (float, optional): Degree of tolerance. This value must be greater than 0. Default: ``1e-9``.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tensor, the normalized values.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; from mindspore import Tensor</span>
<span class="sd">            &gt;&gt;&gt; from mindspore_xai.explainer import PseudoLinearCoef</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; plc = Tensor([[0.1, 0.6, 0.8], [-2, 0.2, 0.4], [0.4, 0.1, -0.1]])</span>
<span class="sd">            &gt;&gt;&gt; print(PseudoLinearCoef.normalize(plc))</span>
<span class="sd">            [[ 0.05  0.3   0.4 ]</span>
<span class="sd">             [-1.    0.1   0.2 ]</span>
<span class="sd">             [ 0.2   0.05 -0.05]]</span>
<span class="sd">            &gt;&gt;&gt; print(PseudoLinearCoef.normalize(plc, per_vector=True))</span>
<span class="sd">            [[ 0.125  0.75   1.   ]</span>
<span class="sd">             [-1.     0.1    0.2  ]</span>
<span class="sd">             [ 1.     0.25  -0.25 ]]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_value_type</span><span class="p">(</span><span class="s2">&quot;plc&quot;</span><span class="p">,</span> <span class="n">plc</span><span class="p">,</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span><span class="p">((</span><span class="n">plc</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">ms</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">plc</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">ms</span><span class="o">.</span><span class="n">float64</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The plc tensor should have dtype ms.float32 or ms.float64.&quot;</span><span class="p">)</span>
        <span class="n">check_value_type</span><span class="p">(</span><span class="s2">&quot;per_vector&quot;</span><span class="p">,</span> <span class="n">per_vector</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
        <span class="n">check_value_type</span><span class="p">(</span><span class="s2">&quot;eps&quot;</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_check_values</span><span class="p">(</span><span class="s2">&quot;eps&quot;</span><span class="p">,</span> <span class="n">eps</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">plc</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">plc</span>

        <span class="k">if</span> <span class="n">per_vector</span> <span class="ow">and</span> <span class="n">plc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">plc</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span><span class="o">.</span><span class="n">masked_fill</span><span class="p">(</span><span class="n">scale</span> <span class="o">&lt;</span> <span class="n">eps</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">plc</span> <span class="o">/</span> <span class="n">scale</span>

        <span class="n">scale</span> <span class="o">=</span> <span class="n">plc</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">scale</span> <span class="o">&gt;</span> <span class="n">eps</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">plc</span> <span class="o">/</span> <span class="n">scale</span>
        <span class="k">return</span> <span class="n">plc</span></div>

    <span class="k">def</span> <span class="nf">_relative</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">view_point</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">nn_finder</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute Relative PLC.&quot;&quot;&quot;</span>
        <span class="n">vp_samples_count</span> <span class="o">=</span> <span class="n">nn_finder</span><span class="o">.</span><span class="n">sample_count</span><span class="p">(</span><span class="n">view_point</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_monte_carlo</span> <span class="o">&lt;</span> <span class="n">vp_samples_count</span><span class="p">:</span>
            <span class="n">picked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">vp_samples_count</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_monte_carlo</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">queries</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="n">nn_finder</span><span class="o">.</span><span class="n">sample_idxs</span><span class="p">(</span><span class="n">view_point</span><span class="p">)[</span><span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">picked</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">int32</span><span class="p">)]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">queries</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="n">nn_finder</span><span class="o">.</span><span class="n">sample_idxs</span><span class="p">(</span><span class="n">view_point</span><span class="p">)]</span>

        <span class="n">nearests</span> <span class="o">=</span> <span class="n">nn_finder</span><span class="p">(</span><span class="n">queries</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stepwise</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_computer</span><span class="p">(</span><span class="n">queries</span><span class="p">,</span> <span class="n">nearests</span><span class="p">)</span>

        <span class="n">plc_sum</span> <span class="o">=</span> <span class="n">_zeros</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ms</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">ms</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">query</span><span class="p">,</span> <span class="n">nearest</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">queries</span><span class="p">,</span> <span class="n">nearests</span><span class="p">),</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="n">queries</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                   <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Class </span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s1"> Relative to Class </span><span class="si">{</span><span class="n">view_point</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">):</span>
            <span class="n">plc_sum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_computer</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">nearest</span><span class="p">,</span> <span class="n">plc_sum</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">plc_sum</span> <span class="o">/</span> <span class="n">queries</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2022, MindSpore.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   
	<script async="async" src="https://cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>